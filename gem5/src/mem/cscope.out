cscope 15 $HOME/workspace/CGRA/gem5/src/mem               0001238338
	@abstract_mem.cc

45 
	~"¬ch/»gi¡”s.hh
"

46 
	~"cÚfig/the_i§.hh
"

47 
	~"debug/LLSC.hh
"

48 
	~"debug/MemÜyAcûss.hh
"

49 
	~"mem/ab¡¿ù_mem.hh
"

50 
	~"mem/·ck‘_acûss.hh
"

51 
	~"sim/sy¡em.hh
"

53 
usšg
 
Çme¥aû
 
	g¡d
;

55 
	gAb¡¿ùMemÜy
::
	$Ab¡¿ùMemÜy
(cÚ¡ 
P¬ams
 *
p
) :

56 
	`MemObjeù
(
p
), 
	`¿nge
(
	`·¿ms
()->
¿nge
), 
	`pmemAddr
(
NULL
),

57 
	`cÚfTabËR•Ü‹d
(
p
->
cÚf_bË_»pÜ‹d
), 
	`šAddrM­
Õ->
š_addr_m­
),

58 
	$_sy¡em
(
NULL
)

60 ià(
	`size
(è% 
TheISA
::
PageBy‹s
 != 0)

61 
	`·nic
("Memory Size‚ot divisible by…age size\n");

62 
	}
}

65 
	gAb¡¿ùMemÜy
::
	$£tBackšgStÜe
(
ušt8_t
* 
pmem_addr
)

67 
pmemAddr
 = 
pmem_addr
;

68 
	}
}

71 
	gAb¡¿ùMemÜy
::
	$»gSts
()

73 
usšg
 
Çme¥aû
 
Sts
;

75 
	`as£¹
(
	`sy¡em
());

77 
by‹sR—d


78 .
	`š™
(
	`sy¡em
()->
	`maxMa¡”s
())

79 .
	`Çme
(name() + ".bytes_read")

80 .
	`desc
("Number of bytes„ead fromhis memory")

81 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

83 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

84 
by‹sR—d
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

86 
by‹sIn¡R—d


87 .
	`š™
(
	`sy¡em
()->
	`maxMa¡”s
())

88 .
	`Çme
(name() + ".bytes_inst_read")

89 .
	`desc
("Number of instructions bytes„ead fromhis memory")

90 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

92 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

93 
by‹sIn¡R—d
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

95 
by‹sWr™‹n


96 .
	`š™
(
	`sy¡em
()->
	`maxMa¡”s
())

97 .
	`Çme
(name() + ".bytes_written")

98 .
	`desc
("Number of bytes writtenohis memory")

99 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

101 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

102 
by‹sWr™‹n
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

104 
numR—ds


105 .
	`š™
(
	`sy¡em
()->
	`maxMa¡”s
())

106 .
	`Çme
(name() + ".num_reads")

107 .
	`desc
("Number of„ead„equests„espondedo byhis memory")

108 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

110 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

111 
numR—ds
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

113 
numWr™es


114 .
	`š™
(
	`sy¡em
()->
	`maxMa¡”s
())

115 .
	`Çme
(name() + ".num_writes")

116 .
	`desc
("Number of write„equests„espondedo byhis memory")

117 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

119 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

120 
numWr™es
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

122 
numOth”


123 .
	`š™
(
	`sy¡em
()->
	`maxMa¡”s
())

124 .
	`Çme
(name() + ".num_other")

125 .
	`desc
("Number of other„equests„espondedo byhis memory")

126 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

128 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

129 
numOth”
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

131 
bwR—d


132 .
	`Çme
(name() + ".bw_read")

133 .
	`desc
("Total„ead bandwidth fromhis memory (bytes/s)")

134 .
	`´ecisiÚ
(0)

135 .
	`´”eq
(
by‹sR—d
)

136 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

138 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

139 
bwR—d
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

142 
bwIn¡R—d


143 .
	`Çme
(name() + ".bw_inst_read")

144 .
	`desc
("Instruction„ead bandwidth fromhis memory (bytes/s)")

145 .
	`´ecisiÚ
(0)

146 .
	`´”eq
(
by‹sIn¡R—d
)

147 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

149 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

150 
bwIn¡R—d
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

152 
bwWr™e


153 .
	`Çme
(name() + ".bw_write")

154 .
	`desc
("Write bandwidth fromhis memory (bytes/s)")

155 .
	`´ecisiÚ
(0)

156 .
	`´”eq
(
by‹sWr™‹n
)

157 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

159 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

160 
bwWr™e
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

162 
bwTÙ®


163 .
	`Çme
(name() + ".bw_total")

164 .
	`desc
("Total bandwidtho/fromhis memory (bytes/s)")

165 .
	`´ecisiÚ
(0)

166 .
	`´”eq
(
bwTÙ®
)

167 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

169 
i
 = 0; i < 
	`sy¡em
()->
	`maxMa¡”s
(); i++) {

170 
bwTÙ®
.
	`subÇme
(
i
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(i));

172 
bwR—d
 = 
by‹sR—d
 / 
simSecÚds
;

173 
bwIn¡R—d
 = 
by‹sIn¡R—d
 / 
simSecÚds
;

174 
bwWr™e
 = 
by‹sWr™‹n
 / 
simSecÚds
;

175 
bwTÙ®
 = (
by‹sR—d
 + 
by‹sWr™‹n
è/ 
simSecÚds
;

176 
	}
}

178 
AddrRªge


179 
	gAb¡¿ùMemÜy
::
	$g‘AddrRªge
() const

181  
¿nge
;

182 
	}
}

187 
	gAb¡¿ùMemÜy
::
	$ŒackLßdLocked
(
Pack‘PŒ
 
pkt
)

189 
Reque¡
 *
»q
 = 
pkt
->req;

190 
Addr
 
·ddr
 = 
LockedAddr
::
	`mask
(
»q
->
	`g‘Paddr
());

195 
li¡
<
LockedAddr
>::
™”©Ü
 
i
;

197 
i
 = 
lockedAddrLi¡
.
	`begš
(); i !ğlockedAddrLi¡.
	`’d
(); ++i) {

198 ià(
i
->
	`m©chesCÚ‹xt
(
»q
)) {

199 
	`DPRINTF
(
LLSC
, "Modifying†ock„ecord: context %d‡ddr %#x\n",

200 
»q
->
	`cÚ‹xtId
(), 
·ddr
);

201 
i
->
addr
 = 
·ddr
;

207 
	`DPRINTF
(
LLSC
, "Adding†ock„ecord: context %d‡ddr %#x\n",

208 
»q
->
	`cÚ‹xtId
(), 
·ddr
);

209 
lockedAddrLi¡
.
	`push_äÚt
(
	`LockedAddr
(
»q
));

210 
	}
}

217 
boŞ


218 
	gAb¡¿ùMemÜy
::
	$checkLockedAddrLi¡
(
Pack‘PŒ
 
pkt
)

220 
Reque¡
 *
»q
 = 
pkt
->req;

221 
Addr
 
·ddr
 = 
LockedAddr
::
	`mask
(
»q
->
	`g‘Paddr
());

222 
boŞ
 
isLLSC
 = 
pkt
->
	`isLLSC
();

227 
boŞ
 
®lowStÜe
 = !
isLLSC
;

234 
li¡
<
LockedAddr
>::
™”©Ü
 
i
 = 
lockedAddrLi¡
.
	`begš
();

236 ià(
isLLSC
) {

237 
i
 !ğ
lockedAddrLi¡
.
	`’d
()) {

238 ià(
i
->
addr
 =ğ
·ddr
 && i->
	`m©chesCÚ‹xt
(
»q
)) {

241 
	`DPRINTF
(
LLSC
, "StCond success: context %d‡ddr %#x\n",

242 
»q
->
	`cÚ‹xtId
(), 
·ddr
);

243 
®lowStÜe
 = 
Œue
;

249 
i
++;

251 
»q
->
	`£tExŒaD©a
(
®lowStÜe
 ? 1 : 0);

254 ià(
®lowStÜe
) {

258 
i
 = 
lockedAddrLi¡
.
	`begš
();

259 
i
 !ğ
lockedAddrLi¡
.
	`’d
()) {

260 ià(
i
->
addr
 =ğ
·ddr
) {

261 
	`DPRINTF
(
LLSC
, "Erasing†ock„ecord: context %d‡ddr %#x\n",

262 
i
->
cÚ‹xtId
, 
·ddr
);

263 
i
 = 
lockedAddrLi¡
.
	`”a£
(i);

265 
i
++;

270  
®lowStÜe
;

271 
	}
}

274 #ià
TRACING_ON


276 
	#CASE
(
A
, 
T
) \

277 (
T
): \

278 
	`DPRINTF
(
MemÜyAcûss
,"%s from %s of size %i on‡ddress 0x%x data " \

279 "0x%x %c\n", 
A
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(
pkt
->
»q
->
	`ma¡”Id
()),\

280 
pkt
->
	`g‘Size
(),…kt->
	`g‘Addr
(),…kt->
g‘
<
T
>(), \

281 
pkt
->
»q
->
	`isUnÿch—bË
() ? 'U' : 'C'); \

282 

	)

285 
	#TRACE_PACKET
(
A
) \

287 
pkt
->
	`g‘Size
()) { \

288 
	`CASE
(
A
, 
ušt64_t
); \

289 
	`CASE
(
A
, 
ušt32_t
); \

290 
	`CASE
(
A
, 
ušt16_t
); \

291 
	`CASE
(
A
, 
ušt8_t
); \

293 
	`DPRINTF
(
MemÜyAcûss
, "%s from %s of size %i on‡ddress 0x%x %c\n",\

294 
A
, 
	`sy¡em
()->
	`g‘Ma¡”Name
(
pkt
->
»q
->
	`ma¡”Id
()), \

295 
pkt
->
	`g‘Size
(),…kt->
	`g‘Addr
(), \

296 
pkt
->
»q
->
	`isUnÿch—bË
() ? 'U' : 'C'); \

297 
	`DDUMP
(
MemÜyAcûss
, 
pkt
->
g‘PŒ
<
ušt8_t
>(),…kt->
	`g‘Size
()); \

299 } 0)

	)

303 
	#TRACE_PACKET
(
A
)

	)

308 
	gAb¡¿ùMemÜy
::
	$acûss
(
Pack‘PŒ
 
pkt
)

310 
	`as£¹
(
	`AddrRªge
(
pkt
->
	`g‘Addr
(),

311 
pkt
->
	`g‘Addr
(è+…kt->
	`g‘Size
(è- 1).
	`isSub£t
(
¿nge
));

313 ià(
pkt
->
	`memInhib™As£¹ed
()) {

314 
	`DPRINTF
(
MemÜyAcûss
, "mem inhibited on 0x%x:‚ot„esponding\n",

315 
pkt
->
	`g‘Addr
());

319 
ušt8_t
 *
ho¡Addr
 = 
pmemAddr
 + 
pkt
->
	`g‘Addr
(è- 
¿nge
.
	`¡¬t
();

321 ià(
pkt
->
cmd
 =ğ
MemCmd
::
Sw­Req
) {

322 
TheISA
::
IÁReg
 
ov”wr™e_v®
;

323 
boŞ
 
ov”wr™e_mem
;

324 
ušt64_t
 
cÚd™iÚ_v®64
;

325 
ušt32_t
 
cÚd™iÚ_v®32
;

327 ià(!
pmemAddr
)

328 
	`·nic
("Swap only works ifhere is„eal memory (i.e.‚ull=False)");

329 
	`as£¹
((
TheISA
::
IÁReg
è>ğ
pkt
->
	`g‘Size
());

331 
ov”wr™e_mem
 = 
Œue
;

334 
¡d
::
	`memıy
(&
ov”wr™e_v®
, 
pkt
->
g‘PŒ
<
ušt8_t
>(),…kt->
	`g‘Size
());

335 
¡d
::
	`memıy
(
pkt
->
g‘PŒ
<
ušt8_t
>(), 
ho¡Addr
,…kt->
	`g‘Size
());

337 ià(
pkt
->
»q
->
	`isCÚdSw­
()) {

338 ià(
pkt
->
	`g‘Size
(è=ğ(
ušt64_t
)) {

339 
cÚd™iÚ_v®64
 = 
pkt
->
»q
->
	`g‘ExŒaD©a
();

340 
ov”wr™e_mem
 = !
¡d
::
	`memcmp
(&
cÚd™iÚ_v®64
, 
ho¡Addr
,

341 (
ušt64_t
));

342 } ià(
pkt
->
	`g‘Size
(è=ğ(
ušt32_t
)) {

343 
cÚd™iÚ_v®32
 = (
ušt32_t
)
pkt
->
»q
->
	`g‘ExŒaD©a
();

344 
ov”wr™e_mem
 = !
¡d
::
	`memcmp
(&
cÚd™iÚ_v®32
, 
ho¡Addr
,

345 (
ušt32_t
));

347 
	`·nic
("Invalid size for conditional„ead/write\n");

350 ià(
ov”wr™e_mem
)

351 
¡d
::
	`memıy
(
ho¡Addr
, &
ov”wr™e_v®
, 
pkt
->
	`g‘Size
());

353 
	`as£¹
(!
pkt
->
»q
->
	`isIn¡F‘ch
());

354 
	`TRACE_PACKET
("Read/Write");

355 
numOth”
[
pkt
->
»q
->
	`ma¡”Id
()]++;

356 } ià(
pkt
->
	`isR—d
()) {

357 
	`as£¹
(!
pkt
->
	`isWr™e
());

358 ià(
pkt
->
	`isLLSC
()) {

359 
	`ŒackLßdLocked
(
pkt
);

361 ià(
pmemAddr
)

362 
	`memıy
(
pkt
->
g‘PŒ
<
ušt8_t
>(), 
ho¡Addr
,…kt->
	`g‘Size
());

363 
	`TRACE_PACKET
(
pkt
->
»q
->
	`isIn¡F‘ch
() ? "IFetch" : "Read");

364 
numR—ds
[
pkt
->
»q
->
	`ma¡”Id
()]++;

365 
by‹sR—d
[
pkt
->
»q
->
	`ma¡”Id
()] +ğpkt->
	`g‘Size
();

366 ià(
pkt
->
»q
->
	`isIn¡F‘ch
())

367 
by‹sIn¡R—d
[
pkt
->
»q
->
	`ma¡”Id
()] +ğpkt->
	`g‘Size
();

368 } ià(
pkt
->
	`isWr™e
()) {

369 ià(
	`wr™eOK
(
pkt
)) {

370 ià(
pmemAddr
) {

371 
	`memıy
(
ho¡Addr
, 
pkt
->
g‘PŒ
<
ušt8_t
>(),…kt->
	`g‘Size
());

372 
	`DPRINTF
(
MemÜyAcûss
, "%s wrote %x byteso‡ddress %x\n",

373 
__func__
, 
pkt
->
	`g‘Size
(),…kt->
	`g‘Addr
());

375 
	`as£¹
(!
pkt
->
»q
->
	`isIn¡F‘ch
());

376 
	`TRACE_PACKET
("Write");

377 
numWr™es
[
pkt
->
»q
->
	`ma¡”Id
()]++;

378 
by‹sWr™‹n
[
pkt
->
»q
->
	`ma¡”Id
()] +ğpkt->
	`g‘Size
();

380 } ià(
pkt
->
	`isInv®id©e
()) {

383 
	`·nic
("unimplemented");

386 ià(
pkt
->
	`ÃedsRe¥Ú£
()) {

387 
pkt
->
	`makeRe¥Ú£
();

389 
	}
}

392 
	gAb¡¿ùMemÜy
::
	$funùiÚ®Acûss
(
Pack‘PŒ
 
pkt
)

394 
	`as£¹
(
	`AddrRªge
(
pkt
->
	`g‘Addr
(),

395 
pkt
->
	`g‘Addr
(è+…kt->
	`g‘Size
(è- 1).
	`isSub£t
(
¿nge
));

397 
ušt8_t
 *
ho¡Addr
 = 
pmemAddr
 + 
pkt
->
	`g‘Addr
(è- 
¿nge
.
	`¡¬t
();

399 ià(
pkt
->
	`isR—d
()) {

400 ià(
pmemAddr
)

401 
	`memıy
(
pkt
->
g‘PŒ
<
ušt8_t
>(), 
ho¡Addr
,…kt->
	`g‘Size
());

402 
	`TRACE_PACKET
("Read");

403 
pkt
->
	`makeRe¥Ú£
();

404 } ià(
pkt
->
	`isWr™e
()) {

405 ià(
pmemAddr
)

406 
	`memıy
(
ho¡Addr
, 
pkt
->
g‘PŒ
<
ušt8_t
>(),…kt->
	`g‘Size
());

407 
	`TRACE_PACKET
("Write");

408 
pkt
->
	`makeRe¥Ú£
();

409 } ià(
pkt
->
	`isPršt
()) {

410 
Pack‘
::
PrštReqS‹
 *
´s
 =

411 
dyÇmic_ÿ¡
<
Pack‘
::
PrštReqS‹
*>(
pkt
->
£nd”S‹
);

412 
	`as£¹
(
´s
);

415 
´s
->
	`´štLab–s
();

417 
	`cırštf
(
´s
->
os
, "%s%#x\n",…rs->
	`curP»fix
(), *
ho¡Addr
);

419 
	`·nic
("AbstractMemory: unimplemented functional command %s",

420 
pkt
->
	`cmdSŒšg
());

422 
	}
}

	@abstract_mem.hh

49 #iâdeà
__ABSTRACT_MEMORY_HH__


50 
	#__ABSTRACT_MEMORY_HH__


	)

52 
	~"mem/mem_objeù.hh
"

53 
	~"·¿ms/Ab¡¿ùMemÜy.hh
"

54 
	~"sim/¡©s.hh
"

57 
şass
 
	gSy¡em
;

63 şas 
	cLockedAddr
 {

65 
	m´iv©e
:

69 cÚ¡ 
Addr
 
Addr_Mask
 = 0xf;

71 
	mpublic
:

74 
Addr
 
addr
;

77 cÚ¡ 
	mcÚ‹xtId
;

79 
Addr
 
	$mask
(
Addr
 
·ddr
è{  (·dd¸& ~
Addr_Mask
); }

82 
boŞ
 
	$m©chesCÚ‹xt
(
Reque¡
 *
»q
) const

84  (
cÚ‹xtId
 =ğ
»q
->
	`cÚ‹xtId
());

85 
	}
}

87 
	$LockedAddr
(
Reque¡
 *
»q
è: 
	`addr
(
	`mask
Ôeq->
	`g‘Paddr
())),

88 
	`cÚ‹xtId
(
»q
->
	$cÚ‹xtId
())

89 {
	}
}

92 
	$LockedAddr
(
Addr
 
_addr
, 
_cid
è: 
	`addr
(_addr), 
	$cÚ‹xtId
(
_cid
)

93 {
	}
}

103 şas 
	cAb¡¿ùMemÜy
 : 
public
 
MemObjeù


105 
´Ùeùed
:

108 
AddrRªge
 
¿nge
;

111 
ušt8_t
* 
	mpmemAddr
;

114 
boŞ
 
	mcÚfTabËR•Ü‹d
;

117 
boŞ
 
	mšAddrM­
;

119 
	m¡d
::
li¡
<
LockedAddr
> 
lockedAddrLi¡
;

125 
boŞ
 
checkLockedAddrLi¡
(
Pack‘PŒ
 
pkt
);

130 
ŒackLßdLocked
(
Pack‘PŒ
 
pkt
);

139 
boŞ
 
	$wr™eOK
(
Pack‘PŒ
 
pkt
) {

140 
Reque¡
 *
»q
 = 
pkt
->req;

141 ià(
lockedAddrLi¡
.
	`em±y
()) {

143 
boŞ
 
isLLSC
 = 
pkt
->
	`isLLSC
();

144 ià(
isLLSC
) {

145 
»q
->
	`£tExŒaD©a
(0);

147  !
isLLSC
;

150  
	`checkLockedAddrLi¡
(
pkt
);

155 
Sts
::
VeùÜ
 
by‹sR—d
;

157 
Sts
::
VeùÜ
 
by‹sIn¡R—d
;

159 
Sts
::
VeùÜ
 
by‹sWr™‹n
;

161 
Sts
::
VeùÜ
 
numR—ds
;

163 
Sts
::
VeùÜ
 
numWr™es
;

165 
Sts
::
VeùÜ
 
numOth”
;

167 
Sts
::
FÜmuÏ
 
bwR—d
;

169 
Sts
::
FÜmuÏ
 
bwIn¡R—d
;

171 
Sts
::
FÜmuÏ
 
bwWr™e
;

173 
Sts
::
FÜmuÏ
 
bwTÙ®
;

179 
Sy¡em
 *
_sy¡em
;

182 
´iv©e
:

185 
	`Ab¡¿ùMemÜy
(cÚ¡ 
Ab¡¿ùMemÜy
&);

188 
Ab¡¿ùMemÜy
& 
İ”©Ü
=(const AbstractMemory&);

190 
public
:

192 
Ab¡¿ùMemÜyP¬ams
 
	tP¬ams
;

194 
	`Ab¡¿ùMemÜy
(cÚ¡ 
P¬ams
* 
p
);

195 
vœtu®
 ~
	$Ab¡¿ùMemÜy
(è{
	}
}

203 
boŞ
 
	$isNuÎ
(ècÚ¡ {  
	`·¿ms
()->
nuÎ
; 
	}
}

211 
£tBackšgStÜe
(
ušt8_t
* 
pmem_addr
);

216 cÚ¡ 
	g¡d
::
li¡
<
LockedAddr
>& 
	$g‘LockedAddrLi¡
() const

217 {  
lockedAddrLi¡
; 
	}
}

222 
	$addLockedAddr
(
LockedAddr
 
addr
è{ 
lockedAddrLi¡
.
	`push_back
×ddr); 
	}
}

227 
Sy¡em
* 
	$sy¡em
(ècÚ¡ {  
_sy¡em
; 
	}
}

235 
	$sy¡em
(
Sy¡em
 *
sys
è{ 
_sy¡em
 = sys; 
	}
}

237 cÚ¡ 
P¬ams
 *

238 
	$·¿ms
() const

240  
dyÇmic_ÿ¡
<cÚ¡ 
P¬ams
 *>(
_·¿ms
);

241 
	}
}

248 
AddrRªge
 
	$g‘AddrRªge
() const;

255 
ušt64_t
 
	$size
(ècÚ¡ {  
¿nge
.
	`size
(); 
	}
}

262 
Addr
 
	$¡¬t
(ècÚ¡ {  
¿nge
.
	`¡¬t
(); 
	}
}

270 
boŞ
 
	$isCÚfR•Ü‹d
(ècÚ¡ {  
cÚfTabËR•Ü‹d
; 
	}
}

278 
boŞ
 
	$isInAddrM­
(ècÚ¡ {  
šAddrM­
; 
	}
}

287 
acûss
(
Pack‘PŒ
 
pkt
);

297 
funùiÚ®Acûss
(
Pack‘PŒ
 
pkt
);

302 
vœtu®
 
»gSts
();

	@addr_mapper.cc

40 
	~"mem/addr_m­³r.hh
"

42 
	gAddrM­³r
::
	$AddrM­³r
(cÚ¡ 
AddrM­³rP¬ams
* 
p
)

43 : 
	`MemObjeù
(
p
),

44 
	`ma¡”PÜt
(
	`Çme
(è+ "-ma¡”", *
this
),

45 
	`¦avePÜt
(
	`Çme
(è+ "-¦ave", *
this
)

47 
	}
}

50 
	gAddrM­³r
::
	$š™
()

52 ià(!
¦avePÜt
.
	`isCÚÃùed
(è|| !
ma¡”PÜt
.isConnected())

53 
	`çl
("Address mapper is‚ot connected on both sides.\n");

54 
	}
}

56 
	gBa£Ma¡”PÜt
&

57 
	gAddrM­³r
::
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
, 
PÜtID
 
idx
)

59 ià(
	gif_Çme
 == "master") {

60  
ma¡”PÜt
;

62  
	gMemObjeù
::
g‘Ma¡”PÜt
(
if_Çme
, 
idx
);

66 
	gBa£SÏvePÜt
&

67 
	gAddrM­³r
::
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
, 
PÜtID
 
idx
)

69 ià(
	gif_Çme
 == "slave") {

70  
¦avePÜt
;

72  
	gMemObjeù
::
g‘SÏvePÜt
(
if_Çme
, 
idx
);

77 
	gAddrM­³r
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

79 
Addr
 
Üig_addr
 = 
pkt
->
	`g‘Addr
();

80 
pkt
->
	`£tAddr
(
	`»m­Addr
(
Üig_addr
));

81 
ma¡”PÜt
.
	`£ndFunùiÚ®
(
pkt
);

82 
pkt
->
	`£tAddr
(
Üig_addr
);

83 
	}
}

86 
	gAddrM­³r
::
	$»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
)

88 
Addr
 
Üig_addr
 = 
pkt
->
	`g‘Addr
();

89 
pkt
->
	`£tAddr
(
	`»m­Addr
(
Üig_addr
));

90 
¦avePÜt
.
	`£ndFunùiÚ®Snoİ
(
pkt
);

91 
pkt
->
	`£tAddr
(
Üig_addr
);

92 
	}
}

94 
Tick


95 
	gAddrM­³r
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

97 
Addr
 
Üig_addr
 = 
pkt
->
	`g‘Addr
();

98 
pkt
->
	`£tAddr
(
	`»m­Addr
(
Üig_addr
));

99 
Tick
 
»t_tick
 = 
ma¡”PÜt
.
	`£ndAtomic
(
pkt
);

100 
pkt
->
	`£tAddr
(
Üig_addr
);

101  
»t_tick
;

102 
	}
}

104 
Tick


105 
	gAddrM­³r
::
	$»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

107 
Addr
 
Üig_addr
 = 
pkt
->
	`g‘Addr
();

108 
pkt
->
	`£tAddr
(
	`»m­Addr
(
Üig_addr
));

109 
Tick
 
»t_tick
 = 
¦avePÜt
.
	`£ndAtomicSnoİ
(
pkt
);

110 
pkt
->
	`£tAddr
(
Üig_addr
);

111  
»t_tick
;

112 
	}
}

114 
boŞ


115 
	gAddrM­³r
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

117 
Addr
 
Üig_addr
 = 
pkt
->
	`g‘Addr
();

118 
boŞ
 
ÃedsRe¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
();

119 
boŞ
 
memInhib™As£¹ed
 = 
pkt
->
	`memInhib™As£¹ed
();

121 ià(
ÃedsRe¥Ú£
 && !
memInhib™As£¹ed
) {

122 
pkt
->
	`pushS’d”S‹
(
Ãw
 
	`AddrM­³rS’d”S‹
(
Üig_addr
));

125 
pkt
->
	`£tAddr
(
	`»m­Addr
(
Üig_addr
));

129 
boŞ
 
sucûssful
 = 
ma¡”PÜt
.
	`£ndTimšgReq
(
pkt
);

132 ià(!
sucûssful
 && 
ÃedsRe¥Ú£
) {

133 
d–‘e
 
pkt
->
	`pİS’d”S‹
();

136  
sucûssful
;

137 
	}
}

139 
boŞ


140 
	gAddrM­³r
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

142 
AddrM­³rS’d”S‹
* 
»ûivedS‹
 =

143 
dyÇmic_ÿ¡
<
AddrM­³rS’d”S‹
*>(
pkt
->
£nd”S‹
);

146 ià(
»ûivedS‹
 =ğ
NULL
)

147 
	`·nic
("AddrMapper %s got‡„esponse without sender state\n",

148 
	`Çme
());

150 
Addr
 
»m­³d_addr
 = 
pkt
->
	`g‘Addr
();

153 
pkt
->
£nd”S‹
 = 
»ûivedS‹
->
´edeûssÜ
;

154 
pkt
->
	`£tAddr
(
»ûivedS‹
->
ÜigAddr
);

157 
boŞ
 
sucûssful
 = 
¦avePÜt
.
	`£ndTimšgRe¥
(
pkt
);

161 ià(
sucûssful
) {

162 
d–‘e
 
»ûivedS‹
;

166 
pkt
->
£nd”S‹
 = 
»ûivedS‹
;

167 
pkt
->
	`£tAddr
(
»m­³d_addr
);

169  
sucûssful
;

170 
	}
}

173 
	gAddrM­³r
::
	$»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

175 
¦avePÜt
.
	`£ndTimšgSnoİReq
(
pkt
);

176 
	}
}

178 
boŞ


179 
	gAddrM­³r
::
	$»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

181  
ma¡”PÜt
.
	`£ndTimšgSnoİRe¥
(
pkt
);

182 
	}
}

184 
boŞ


185 
	gAddrM­³r
::
	$isSnoİšg
() const

187 ià(
¦avePÜt
.
	`isSnoİšg
())

188 
	`çl
("AddrMapper doesn't support„emapping of snooping„equests\n");

189  
çl£
;

190 
	}
}

193 
	gAddrM­³r
::
	$»cvR‘ryMa¡”
()

195 
¦avePÜt
.
	`£ndR‘ry
();

196 
	}
}

199 
	gAddrM­³r
::
	$»cvR‘rySÏve
()

201 
ma¡”PÜt
.
	`£ndR‘ry
();

202 
	}
}

205 
	gAddrM­³r
::
	$»cvRªgeChªge
()

207 
¦avePÜt
.
	`£ndRªgeChªge
();

208 
	}
}

210 
	gRªgeAddrM­³r
::
	$RªgeAddrM­³r
(cÚ¡ 
RªgeAddrM­³rP¬ams
* 
p
) :

211 
	`AddrM­³r
(
p
),

212 
	`Üigš®Rªges
(
p
->
Üigš®_¿nges
),

213 
	`»m­³dRªges
(
p
->
»m­³d_¿nges
)

215 ià(
Üigš®Rªges
.
	`size
(è!ğ
»m­³dRªges
.size())

216 
	`çl
("AddrMapper: original‡nd shadowed„ange†ist must "

219 
size_t
 
x
 = 0; x < 
Üigš®Rªges
.
	`size
(); x++) {

220 ià(
Üigš®Rªges
[
x
].
	`size
(è!ğ
»m­³dRªges
[x].size())

221 
	`çl
("AddrMapper: original‡nd shadowed„ange†istƒlements"

224 
	}
}

226 
RªgeAddrM­³r
*

227 
	gRªgeAddrM­³rP¬ams
::
	$ü—‹
()

229  
Ãw
 
	`RªgeAddrM­³r
(
this
);

230 
	}
}

232 
Addr


233 
	gRªgeAddrM­³r
::
	$»m­Addr
(
Addr
 
addr
) const

235 
i
 = 0; i < 
Üigš®Rªges
.
	`size
(); ++i) {

236 ià(
Üigš®Rªges
[
i
].
	`cÚšs
(
addr
)) {

237 
Addr
 
off£t
 = 
addr
 - 
Üigš®Rªges
[
i
].
	`¡¬t
();

238  
off£t
 + 
»m­³dRªges
[
i
].
	`¡¬t
();

242  
addr
;

243 
	}
}

245 
AddrRªgeLi¡


246 
	gRªgeAddrM­³r
::
	$g‘AddrRªges
() const

249 
AddrRªgeLi¡
 
	`¿nges
(
Üigš®Rªges
.
	`begš
(), origš®Rªges.
	`’d
());

250  
¿nges
;

251 
	}
}

	@addr_mapper.hh

40 #iâdeà
__MEM_ADDR_MAPPER_HH__


41 
	#__MEM_ADDR_MAPPER_HH__


	)

43 
	~"mem/mem_objeù.hh
"

44 
	~"·¿ms/AddrM­³r.hh
"

45 
	~"·¿ms/RªgeAddrM­³r.hh
"

56 şas 
	cAddrM­³r
 : 
public
 
MemObjeù


59 
public
:

61 
AddrM­³r
(cÚ¡ 
AddrM­³rP¬ams
* 
·¿ms
);

63 
	mvœtu®
 ~
	$AddrM­³r
() { }

65 
vœtu®
 
Ba£Ma¡”PÜt
& 
	`g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

66 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

68 
vœtu®
 
Ba£SÏvePÜt
& 
	`g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

69 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

71 
vœtu®
 
	`š™
();

73 
´Ùeùed
:

82 
vœtu®
 
Addr
 
	$»m­Addr
(
Addr
 
addr
) const = 0;

84 şas 
	cAddrM­³rS’d”S‹
 : 
public
 
Pack‘
::
S’d”S‹


87 
public
:

94 
	`AddrM­³rS’d”S‹
(
Addr
 
_ÜigAddr
è: 
	`ÜigAddr
(_origAddr)

98 ~
	`AddrM­³rS’d”S‹
() { }

101 
Addr
 
ÜigAddr
;

103 
	}
};

105 şas 
	cM­³rMa¡”PÜt
 : 
public
 
Ma¡”PÜt


108 
public
:

110 
M­³rMa¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
AddrM­³r
& 
_m­³r
)

111 : 
Ma¡”PÜt
(
_Çme
, &
_m­³r
), 
m­³r
(_mapper)

114 
	g´Ùeùed
:

116 
»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
)

118 
m­³r
.
»cvFunùiÚ®Snoİ
(
pkt
);

121 
Tick
 
»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

123  
	gm­³r
.
»cvAtomicSnoİ
(
pkt
);

126 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

128  
	gm­³r
.
»cvTimšgRe¥
(
pkt
);

131 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

133 
	gm­³r
.
»cvTimšgSnoİReq
(
pkt
);

136 
»cvRªgeChªge
()

138 
	gm­³r
.
»cvRªgeChªge
();

141 
boŞ
 
isSnoİšg
() const

143  
	gm­³r
.
isSnoİšg
();

146 
»cvR‘ry
()

148 
	gm­³r
.
»cvR‘ryMa¡”
();

151 
	g´iv©e
:

153 
AddrM­³r
& 
m­³r
;

158 
M­³rMa¡”PÜt
 
	gma¡”PÜt
;

160 şas 
	cM­³rSÏvePÜt
 : 
public
 
SÏvePÜt


163 
public
:

165 
M­³rSÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
AddrM­³r
& 
_m­³r
)

166 : 
SÏvePÜt
(
_Çme
, &
_m­³r
), 
m­³r
(_mapper)

169 
	g´Ùeùed
:

171 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

173 
m­³r
.
»cvFunùiÚ®
(
pkt
);

176 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
)

178  
	gm­³r
.
»cvAtomic
(
pkt
);

181 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

183  
	gm­³r
.
»cvTimšgReq
(
pkt
);

186 
boŞ
 
»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

188  
	gm­³r
.
»cvTimšgSnoİRe¥
(
pkt
);

191 
AddrRªgeLi¡
 
g‘AddrRªges
() const

193  
	gm­³r
.
g‘AddrRªges
();

196 
»cvR‘ry
()

198 
	gm­³r
.
»cvR‘rySÏve
();

201 
	g´iv©e
:

203 
AddrM­³r
& 
m­³r
;

208 
M­³rSÏvePÜt
 
	g¦avePÜt
;

210 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

212 
»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
);

214 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

216 
Tick
 
»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
);

218 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

220 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

222 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
);

224 
boŞ
 
»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
);

226 
vœtu®
 
AddrRªgeLi¡
 
	$g‘AddrRªges
() const = 0;

228 
boŞ
 
	$isSnoİšg
() const;

230 
	`»cvR‘ryMa¡”
();

232 
	`»cvR‘rySÏve
();

234 
	`»cvRªgeChªge
();

235 
	}
};

243 şas 
	cRªgeAddrM­³r
 : 
public
 
AddrM­³r


246 
public
:

248 
RªgeAddrM­³r
(cÚ¡ 
RªgeAddrM­³rP¬ams
* 
p
);

250 ~
	$RªgeAddrM­³r
() { }

252 
AddrRªgeLi¡
 
	$g‘AddrRªges
() const;

254 
´Ùeùed
:

261 
¡d
::
veùÜ
<
AddrRªge
> 
Üigš®Rªges
;

267 
¡d
::
veùÜ
<
AddrRªge
> 
»m­³dRªges
;

269 
Addr
 
	$»m­Addr
(
Addr
 
addr
) const;

271 
	}
};

	@bridge.cc

51 
	~"ba£/Œaû.hh
"

52 
	~"debug/Bridge.hh
"

53 
	~"mem/bridge.hh
"

54 
	~"·¿ms/Bridge.hh
"

56 
	gBridge
::
BridgeSÏvePÜt
::BridgeSÏvePÜt(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
,

57 
Bridge
& 
_bridge
,

58 
BridgeMa¡”PÜt
& 
_ma¡”PÜt
,

59 
Cyşes
 
_d–ay
, 
_»¥_lim™
,

60 
¡d
::
veùÜ
<
AddrRªge
> 
_¿nges
)

61 : 
SÏvePÜt
(
_Çme
, &
_bridge
), 
bridge
(_bridge), 
ma¡”PÜt
(
_ma¡”PÜt
),

62 
d–ay
(
_d–ay
), 
¿nges
(
_¿nges
.
begš
(), _¿nges.
’d
()),

63 
out¡ªdšgRe¥Ú£s
(0), 
»ŒyReq
(
çl£
),

64 
»¥QueueLim™
(
_»¥_lim™
), 
	$£ndEv’t
(*
this
)

66 
	}
}

68 
	gBridge
::
BridgeMa¡”PÜt
::BridgeMa¡”PÜt(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
,

69 
Bridge
& 
_bridge
,

70 
BridgeSÏvePÜt
& 
_¦avePÜt
,

71 
Cyşes
 
_d–ay
, 
_»q_lim™
)

72 : 
Ma¡”PÜt
(
_Çme
, &
_bridge
), 
bridge
(_bridge), 
¦avePÜt
(
_¦avePÜt
),

73 
d–ay
(
_d–ay
), 
»qQueueLim™
(
_»q_lim™
), 
	$£ndEv’t
(*
this
)

75 
	}
}

77 
	gBridge
::
	$Bridge
(
P¬ams
 *
p
)

78 : 
	`MemObjeù
(
p
),

79 
	`¦avePÜt
(
p
->
Çme
 + ".¦ave", *
this
, 
ma¡”PÜt
,

80 
	`ticksToCyşes
(
p
->
d–ay
),…->
»¥_size
,…->
¿nges
),

81 
	`ma¡”PÜt
(
p
->
Çme
 + ".ma¡”", *
this
, 
¦avePÜt
,

82 
	`ticksToCyşes
(
p
->
d–ay
),…->
»q_size
)

84 
	}
}

86 
	gBa£Ma¡”PÜt
&

87 
	gBridge
::
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

89 ià(
	gif_Çme
 == "master")

90  
ma¡”PÜt
;

93  
	gMemObjeù
::
g‘Ma¡”PÜt
(
if_Çme
, 
idx
);

96 
	gBa£SÏvePÜt
&

97 
	gBridge
::
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

99 ià(
	gif_Çme
 == "slave")

100  
¦avePÜt
;

103  
	gMemObjeù
::
g‘SÏvePÜt
(
if_Çme
, 
idx
);

107 
	gBridge
::
	$š™
()

110 ià(!
¦avePÜt
.
	`isCÚÃùed
(è|| !
ma¡”PÜt
.isConnected())

111 
	`çl
("Both…orts of bus bridge‡re‚ot connectedo‡ bus.\n");

114 
¦avePÜt
.
	`£ndRªgeChªge
();

115 
	}
}

117 
boŞ


118 
	gBridge
::
BridgeSÏvePÜt
::
	$»¥QueueFuÎ
() const

120  
out¡ªdšgRe¥Ú£s
 =ğ
»¥QueueLim™
;

121 
	}
}

123 
boŞ


124 
	gBridge
::
BridgeMa¡”PÜt
::
	$»qQueueFuÎ
() const

126  
Œªsm™Li¡
.
	`size
(è=ğ
»qQueueLim™
;

127 
	}
}

129 
boŞ


130 
	gBridge
::
BridgeMa¡”PÜt
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

134 
	`DPRINTF
(
Bridge
, "recvTimingResp: %s‡ddr 0x%x\n",

135 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

137 
	`DPRINTF
(
Bridge
, "Reque¡ queusize: %d\n", 
Œªsm™Li¡
.
	`size
());

140 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

142 
¦avePÜt
.
	`schedTimšgRe¥
(
pkt
, 
bridge
.
	`şockEdge
(
d–ay
));

144  
Œue
;

145 
	}
}

147 
boŞ


148 
	gBridge
::
BridgeSÏvePÜt
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

150 
	`DPRINTF
(
Bridge
, "recvTimingReq: %s‡ddr 0x%x\n",

151 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

154 
	`as£¹
(!
»ŒyReq
);

156 
	`DPRINTF
(
Bridge
, "Response queue size: %d outresp: %d\n",

157 
Œªsm™Li¡
.
	`size
(), 
out¡ªdšgRe¥Ú£s
);

160 ià(
ma¡”PÜt
.
	`»qQueueFuÎ
()) {

161 
	`DPRINTF
(
Bridge
, "Request queue full\n");

162 
»ŒyReq
 = 
Œue
;

165 
boŞ
 
ex³ùs_»¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
() &&

166 !
pkt
->
	`memInhib™As£¹ed
();

167 ià(
ex³ùs_»¥Ú£
) {

168 ià(
	`»¥QueueFuÎ
()) {

169 
	`DPRINTF
(
Bridge
, "Response queue full\n");

170 
»ŒyReq
 = 
Œue
;

173 
	`DPRINTF
(
Bridge
, "Reserving space for„esponse\n");

174 
	`as£¹
(
out¡ªdšgRe¥Ú£s
 !ğ
»¥QueueLim™
);

175 ++
out¡ªdšgRe¥Ú£s
;

182 ià(!
»ŒyReq
) {

184 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

186 
ma¡”PÜt
.
	`schedTimšgReq
(
pkt
, 
bridge
.
	`şockEdge
(
d–ay
));

194  !
»ŒyReq
;

195 
	}
}

198 
	gBridge
::
BridgeSÏvePÜt
::
	$»ŒySÎedReq
()

200 ià(
»ŒyReq
) {

201 
	`DPRINTF
(
Bridge
, "Request waiting for„etry,‚ow„etrying\n");

202 
»ŒyReq
 = 
çl£
;

203 
	`£ndR‘ry
();

205 
	}
}

208 
	gBridge
::
BridgeMa¡”PÜt
::
	$schedTimšgReq
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
)

213 ià(!
pkt
->
	`memInhib™As£¹ed
(è&&…kt->
	`ÃedsRe¥Ú£
()) {

216 
pkt
->
	`pushS’d”S‹
(
Ãw
 
	`Reque¡S‹
Õkt->
	`g‘Src
()));

223 ià(
Œªsm™Li¡
.
	`em±y
()) {

224 
bridge
.
	`scheduË
(
£ndEv’t
, 
wh’
);

227 
	`as£¹
(
Œªsm™Li¡
.
	`size
(è!ğ
»qQueueLim™
);

229 
Œªsm™Li¡
.
	`push_back
(
	`Deã¼edPack‘
(
pkt
, 
wh’
));

230 
	}
}

234 
	gBridge
::
BridgeSÏvePÜt
::
	$schedTimšgRe¥
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
)

239 
Reque¡S‹
 *
»q_¡©e
 =

240 
dyÇmic_ÿ¡
<
Reque¡S‹
*>(
pkt
->
	`pİS’d”S‹
());

241 
	`as£¹
(
»q_¡©e
 !ğ
NULL
);

242 
pkt
->
	`£tDe¡
(
»q_¡©e
->
ÜigSrc
);

243 
d–‘e
 
»q_¡©e
;

247 
	`as£¹
(
pkt
->
	`isDe¡V®id
());

248 
	`DPRINTF
(
Bridge
, "»¥Ú£,‚ew de¡ %d\n", 
pkt
->
	`g‘De¡
());

254 ià(
Œªsm™Li¡
.
	`em±y
()) {

255 
bridge
.
	`scheduË
(
£ndEv’t
, 
wh’
);

258 
Œªsm™Li¡
.
	`push_back
(
	`Deã¼edPack‘
(
pkt
, 
wh’
));

259 
	}
}

262 
	gBridge
::
BridgeMa¡”PÜt
::
	$ŒyS’dTimšg
()

264 
	`as£¹
(!
Œªsm™Li¡
.
	`em±y
());

266 
Deã¼edPack‘
 
»q
 = 
Œªsm™Li¡
.
	`äÚt
();

268 
	`as£¹
(
»q
.
tick
 <ğ
	`curTick
());

270 
Pack‘PŒ
 
pkt
 = 
»q
.pkt;

272 
	`DPRINTF
(
Bridge
, "trySend„equest‡ddr 0x%x, queue size %d\n",

273 
pkt
->
	`g‘Addr
(), 
Œªsm™Li¡
.
	`size
());

275 ià(
	`£ndTimšgReq
(
pkt
)) {

277 
Œªsm™Li¡
.
	`pİ_äÚt
();

278 
	`DPRINTF
(
Bridge
, "trySend„equest successful\n");

281 ià(!
Œªsm™Li¡
.
	`em±y
()) {

282 
Deã¼edPack‘
 
Ãxt_»q
 = 
Œªsm™Li¡
.
	`äÚt
();

283 
	`DPRINTF
(
Bridge
, "Scheduling‚ext send\n");

284 
bridge
.
	`scheduË
(
£ndEv’t
, 
¡d
::
	`max
(
Ãxt_»q
.
tick
,

285 
bridge
.
	`şockEdge
()));

292 
¦avePÜt
.
	`»ŒySÎedReq
();

297 
	}
}

300 
	gBridge
::
BridgeSÏvePÜt
::
	$ŒyS’dTimšg
()

302 
	`as£¹
(!
Œªsm™Li¡
.
	`em±y
());

304 
Deã¼edPack‘
 
»¥
 = 
Œªsm™Li¡
.
	`äÚt
();

306 
	`as£¹
(
»¥
.
tick
 <ğ
	`curTick
());

308 
Pack‘PŒ
 
pkt
 = 
»¥
.pkt;

310 
	`DPRINTF
(
Bridge
, "trySend„esponse‡ddr 0x%x, outstanding %d\n",

311 
pkt
->
	`g‘Addr
(), 
out¡ªdšgRe¥Ú£s
);

313 ià(
	`£ndTimšgRe¥
(
pkt
)) {

315 
Œªsm™Li¡
.
	`pİ_äÚt
();

316 
	`DPRINTF
(
Bridge
, "trySend„esponse successful\n");

318 
	`as£¹
(
out¡ªdšgRe¥Ú£s
 != 0);

319 --
out¡ªdšgRe¥Ú£s
;

322 ià(!
Œªsm™Li¡
.
	`em±y
()) {

323 
Deã¼edPack‘
 
Ãxt_»¥
 = 
Œªsm™Li¡
.
	`äÚt
();

324 
	`DPRINTF
(
Bridge
, "Scheduling‚ext send\n");

325 
bridge
.
	`scheduË
(
£ndEv’t
, 
¡d
::
	`max
(
Ãxt_»¥
.
tick
,

326 
bridge
.
	`şockEdge
()));

332 ià(!
ma¡”PÜt
.
	`»qQueueFuÎ
(è&& 
»ŒyReq
) {

333 
	`DPRINTF
(
Bridge
, "Request waiting for„etry,‚ow„etrying\n");

334 
»ŒyReq
 = 
çl£
;

335 
	`£ndR‘ry
();

341 
	}
}

344 
	gBridge
::
BridgeMa¡”PÜt
::
	$»cvR‘ry
()

346 
	`ŒyS’dTimšg
();

347 
	}
}

350 
	gBridge
::
BridgeSÏvePÜt
::
	$»cvR‘ry
()

352 
	`ŒyS’dTimšg
();

353 
	}
}

355 
Tick


356 
	gBridge
::
BridgeSÏvePÜt
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

358  
d–ay
 * 
bridge
.
	`şockP”iod
(è+ 
ma¡”PÜt
.
	`£ndAtomic
(
pkt
);

359 
	}
}

362 
	gBridge
::
BridgeSÏvePÜt
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

364 
pkt
->
	`pushLab–
(
	`Çme
());

367 autØ
i
 = 
Œªsm™Li¡
.
	`begš
(); i !ğŒªsm™Li¡.
	`’d
(); ++i) {

368 ià(
pkt
->
	`checkFunùiÚ®
((*
i
).pkt)) {

369 
pkt
->
	`makeRe¥Ú£
();

375 ià(
ma¡”PÜt
.
	`checkFunùiÚ®
(
pkt
)) {

379 
pkt
->
	`pİLab–
();

382 
ma¡”PÜt
.
	`£ndFunùiÚ®
(
pkt
);

383 
	}
}

385 
boŞ


386 
	gBridge
::
BridgeMa¡”PÜt
::
	$checkFunùiÚ®
(
Pack‘PŒ
 
pkt
)

388 
boŞ
 
found
 = 
çl£
;

389 autØ
i
 = 
Œªsm™Li¡
.
	`begš
();

391 
i
 !ğ
Œªsm™Li¡
.
	`’d
(è&& !
found
) {

392 ià(
pkt
->
	`checkFunùiÚ®
((*
i
).pkt)) {

393 
pkt
->
	`makeRe¥Ú£
();

394 
found
 = 
Œue
;

396 ++
i
;

399  
found
;

400 
	}
}

402 
AddrRªgeLi¡


403 
	gBridge
::
BridgeSÏvePÜt
::
	$g‘AddrRªges
() const

405  
¿nges
;

406 
	}
}

408 
Bridge
 *

409 
	gBridgeP¬ams
::
	$ü—‹
()

411  
Ãw
 
	`Bridge
(
this
);

412 
	}
}

	@bridge.hh

51 #iâdeà
__MEM_BRIDGE_HH__


52 
	#__MEM_BRIDGE_HH__


	)

54 
	~<deque
>

56 
	~"ba£/ty³s.hh
"

57 
	~"mem/mem_objeù.hh
"

58 
	~"·¿ms/Bridge.hh
"

73 şas 
	cBridge
 : 
public
 
MemObjeù


75 
´Ùeùed
:

82 şas 
	cReque¡S‹
 : 
public
 
Pack‘
::
S’d”S‹


85 
public
:

87 cÚ¡ 
PÜtID
 
ÜigSrc
;

89 
Reque¡S‹
(
PÜtID
 
Üig_¤c
è: 
ÜigSrc
(orig_src)

98 şas 
	cDeã¼edPack‘


101 
	gpublic
:

103 cÚ¡ 
Tick
 
tick
;

104 cÚ¡ 
Pack‘PŒ
 
	gpkt
;

106 
Deã¼edPack‘
(
Pack‘PŒ
 
_pkt
, 
Tick
 
_tick
è: 
tick
(_tick), 
pkt
(_pkt)

111 
şass
 
	gBridgeMa¡”PÜt
;

119 şas 
	cBridgeSÏvePÜt
 : 
public
 
SÏvePÜt


122 
´iv©e
:

125 
Bridge
& 
bridge
;

131 
	gBridgeMa¡”PÜt
& 
	gma¡”PÜt
;

134 cÚ¡ 
Cyşes
 
	gd–ay
;

137 cÚ¡ 
AddrRªgeLi¡
 
	g¿nges
;

145 
	g¡d
::
deque
<
Deã¼edPack‘
> 
Œªsm™Li¡
;

148 
	gout¡ªdšgRe¥Ú£s
;

151 
boŞ
 
	g»ŒyReq
;

154 
	g»¥QueueLim™
;

161 
boŞ
 
»¥QueueFuÎ
() const;

168 
ŒyS’dTimšg
();

171 
	gEv’tW¿µ”
<
	gBridgeSÏvePÜt
,

172 &
	gBridgeSÏvePÜt
::
ŒyS’dTimšg
> 
£ndEv’t
;

174 
	gpublic
:

186 
BridgeSÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
Bridge
& 
_bridge
,

187 
BridgeMa¡”PÜt
& 
_ma¡”PÜt
, 
Cyşes
 
_d–ay
,

188 
_»¥_lim™
, 
¡d
::
veùÜ
<
AddrRªge
> 
_¿nges
);

197 
schedTimšgRe¥
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
);

204 
»ŒySÎedReq
();

206 
	g´Ùeùed
:

210 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

214 
»cvR‘ry
();

218 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

222 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

226 
AddrRªgeLi¡
 
g‘AddrRªges
() const;

235 şas 
	cBridgeMa¡”PÜt
 : 
public
 
Ma¡”PÜt


238 
´iv©e
:

241 
Bridge
& 
bridge
;

247 
	gBridgeSÏvePÜt
& 
	g¦avePÜt
;

250 cÚ¡ 
Cyşes
 
	gd–ay
;

258 
	g¡d
::
deque
<
Deã¼edPack‘
> 
Œªsm™Li¡
;

261 cÚ¡ 
	g»qQueueLim™
;

268 
ŒyS’dTimšg
();

271 
	gEv’tW¿µ”
<
	gBridgeMa¡”PÜt
,

272 &
	gBridgeMa¡”PÜt
::
ŒyS’dTimšg
> 
£ndEv’t
;

274 
	gpublic
:

285 
BridgeMa¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
Bridge
& 
_bridge
,

286 
BridgeSÏvePÜt
& 
_¦avePÜt
, 
Cyşes
 
_d–ay
,

287 
_»q_lim™
);

294 
boŞ
 
»qQueueFuÎ
() const;

303 
schedTimšgReq
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
);

313 
boŞ
 
checkFunùiÚ®
(
Pack‘PŒ
 
pkt
);

315 
	g´Ùeùed
:

319 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

323 
»cvR‘ry
();

327 
BridgeSÏvePÜt
 
	g¦avePÜt
;

330 
BridgeMa¡”PÜt
 
	gma¡”PÜt
;

332 
	gpublic
:

334 
vœtu®
 
Ba£Ma¡”PÜt
& 
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

335 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

336 
vœtu®
 
	gBa£SÏvePÜt
& 
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

337 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

339 
vœtu®
 
š™
();

341 
BridgeP¬ams
 
	tP¬ams
;

343 
Bridge
(
P¬ams
 *
p
);

	@bus.cc

50 
	~"ba£/misc.hh
"

51 
	~"ba£/Œaû.hh
"

52 
	~"debug/Bus.hh
"

53 
	~"debug/BusAddrRªges.hh
"

54 
	~"debug/D¿š.hh
"

55 
	~"mem/bus.hh
"

57 
	gBa£Bus
::
	$Ba£Bus
(cÚ¡ 
Ba£BusP¬ams
 *
p
)

58 : 
	`MemObjeù
(
p
),

59 
	`h—d”Cyşes
(
p
->
h—d”_cyşes
), 
	`width
Õ->
width
),

60 
	`gÙAddrRªges
(
p
->
pÜt_deçuÉ_cÚÃùiÚ_couÁ
 +

61 
p
->
pÜt_ma¡”_cÚÃùiÚ_couÁ
, 
çl£
),

62 
	`gÙAÎAddrRªges
(
çl£
), 
	`deçuÉPÜtID
(
Inv®idPÜtID
),

63 
	`u£DeçuÉRªge
(
p
->
u£_deçuÉ_¿nge
)

64 {
	}
}

66 
	gBa£Bus
::~
	$Ba£Bus
()

68 
Ma¡”PÜtI‹r
 
m
 = 
ma¡”PÜts
.
	`begš
(); m !ğma¡”PÜts.
	`’d
();

69 ++
m
) {

70 
d–‘e
 *
m
;

73 
SÏvePÜtI‹r
 
s
 = 
¦avePÜts
.
	`begš
(); s !ğ¦avePÜts.
	`’d
();

74 ++
s
) {

75 
d–‘e
 *
s
;

77 
	}
}

80 
	gBa£Bus
::
	$š™
()

82 
	}
}

84 
Ba£Ma¡”PÜt
 &

85 
Ba£Bus
::
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

87 ià(
	gif_Çme
 =ğ"ma¡”" && 
idx
 < 
ma¡”PÜts
.
size
()) {

89  *
ma¡”PÜts
[
idx
];

90 } ià(
	gif_Çme
 == "default") {

91  *
ma¡”PÜts
[
deçuÉPÜtID
];

93  
	gMemObjeù
::
g‘Ma¡”PÜt
(
if_Çme
, 
idx
);

97 
	gBa£SÏvePÜt
 &

98 
	gBa£Bus
::
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

100 ià(
	gif_Çme
 =ğ"¦ave" && 
idx
 < 
¦avePÜts
.
size
()) {

102  *
¦avePÜts
[
idx
];

104  
	gMemObjeù
::
g‘SÏvePÜt
(
if_Çme
, 
idx
);

109 
	gBa£Bus
::
	$ÿlcPack‘Timšg
(
Pack‘PŒ
 
pkt
)

114 
Tick
 
off£t
 = 
	`şockEdge
(è- 
	`curTick
();

117 
d©aCyşes
 = 
pkt
->
	`hasD©a
(è? 
	`divCe
Õkt->
	`g‘Size
(), 
width
) : 0;

121 ià(
pkt
->
busFœ¡WÜdD–ay
 !ğ0 ||…kt->
busLa¡WÜdD–ay
 != 0)

122 
	`·nic
("Packet %s‡lready has bus delay (%d, %d)hat should be "

123 "accouÁed fÜ.\n", 
pkt
->
	`cmdSŒšg
(),…kt->
busFœ¡WÜdD–ay
,

124 
pkt
->
busLa¡WÜdD–ay
);

127 
pkt
->
busFœ¡WÜdD–ay
 = (
h—d”Cyşes
 + 1è* 
	`şockP”iod
(è+ 
off£t
;

131 
pkt
->
busLa¡WÜdD–ay
 = (
h—d”Cyşes
 + 
d©aCyşes
è* 
	`şockP”iod
() +

132 
off£t
;

133 
	}
}

135 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

136 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::Lay”(
D¡Ty³
& 
_pÜt
, 
Ba£Bus
& 
_bus
,

137 cÚ¡ 
¡d
::
¡ršg
& 
_Çme
) :

138 
pÜt
(
_pÜt
), 
bus
(
_bus
), 
_Çme
(_Çme), 
¡©e
(
IDLE
), 
d¿šMªag”
(
NULL
),

139 
»ŒyšgPÜt
(
NULL
), 
wa™šgFÜP“r
(NULL),

140 
	$»Ëa£Ev’t
(
this
)

142 
	}
}

144 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

145 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$occupyLay”
(
Tick
 
uÁ
)

151 
	`as£¹
(
¡©e
 =ğ
BUSY
);

154 
	`as£¹
(
uÁ
 != 0);

155 
bus
.
	`scheduË
(
»Ëa£Ev’t
, 
uÁ
);

158 
occu·ncy
 +ğ
uÁ
 - 
	`curTick
();

160 
	`DPRINTF
(
Ba£Bus
, "The bus is‚ow busy fromick %do %d\n",

161 
	`curTick
(), 
uÁ
);

162 
	}
}

164 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

165 
boŞ


166 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$ŒyTimšg
(
SrcTy³
* 
¤c_pÜt
)

177 ià(
¡©e
 =ğ
BUSY
 || 
wa™šgFÜP“r
 !ğ
NULL
) {

179 if(
¡d
::
	`fšd
(
wa™šgFÜLay”
.
	`begš
(), wa™šgFÜLay”.
	`’d
(),
¤c_pÜt
) != waitingForLayer.end())

181 
	`´štf
("\n*********BUS NAME %s\n",
¤c_pÜt
->
	`Çme
().
	`c_¡r
());

183 
	`as£¹
(
¡d
::
	`fšd
(
wa™šgFÜLay”
.
	`begš
(), wa™šgFÜLay”.
	`’d
(),

184 
¤c_pÜt
è=ğ
wa™šgFÜLay”
.
	`’d
());

192 
wa™šgFÜLay”
.
	`push_back
(
¤c_pÜt
);

193  
çl£
;

197 
¡©e
 = 
BUSY
;

200 
»ŒyšgPÜt
 = 
NULL
;

202  
Œue
;

203 
	}
}

205 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

207 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$sucûededTimšg
(
Tick
 
busy_time
)

211 
	`as£¹
(
¡©e
 =ğ
BUSY
);

214 
	`occupyLay”
(
busy_time
);

215 
	}
}

217 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

219 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$çedTimšg
(
SrcTy³
* 
¤c_pÜt
,

220 
Tick
 
busy_time
)

224 
	`as£¹
(
wa™šgFÜP“r
 =ğ
NULL
);

229 
wa™šgFÜP“r
 = 
¤c_pÜt
;

233 
	`as£¹
(
¡©e
 =ğ
BUSY
);

236 
	`occupyLay”
(
busy_time
);

237 
	}
}

239 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

241 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$»Ëa£Lay”
()

244 
	`as£¹
(
¡©e
 =ğ
BUSY
);

245 
	`as£¹
(!
»Ëa£Ev’t
.
	`scheduËd
());

248 
¡©e
 = 
IDLE
;

251 ià(!
wa™šgFÜLay”
.
	`em±y
()) {

252 
	`»ŒyWa™šg
();

253 } ià(
wa™šgFÜP“r
 =ğ
NULL
 && 
d¿šMªag”
) {

254 
	`DPRINTF
(
D¿š
, "Bus done draining, signaling drain manager\n");

256 
d¿šMªag”
->
	`sigÇlD¿šDÚe
();

258 
d¿šMªag”
 = 
NULL
;

260 
	}
}

262 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

264 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$»ŒyWa™šg
()

267 
	`as£¹
(!
wa™šgFÜLay”
.
	`em±y
());

270 
	`as£¹
(
¡©e
 =ğ
IDLE
);

273 
¡©e
 = 
RETRY
;

277 
	`as£¹
(
»ŒyšgPÜt
 =ğ
NULL
);

278 
»ŒyšgPÜt
 = 
wa™šgFÜLay”
.
	`äÚt
();

279 
wa™šgFÜLay”
.
	`pİ_äÚt
();

283 
»ŒyšgPÜt
->
	`£ndR‘ry
();

287 ià(
¡©e
 =ğ
RETRY
) {

290 
¡©e
 = 
BUSY
;

291 
»ŒyšgPÜt
 = 
NULL
;

294 
	`occupyLay”
(
bus
.
	`şockEdge
(
	`Cyşes
(1)));

296 
	}
}

298 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

300 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$»cvR‘ry
()

304 
	`as£¹
(
wa™šgFÜP“r
 !ğ
NULL
);

309 
wa™šgFÜLay”
.
	`push_äÚt
(
wa™šgFÜP“r
);

312 
wa™šgFÜP“r
 = 
NULL
;

316 ià(
¡©e
 =ğ
IDLE
) {

317 
	`»ŒyWa™šg
();

319 
	`as£¹
(
¡©e
 =ğ
BUSY
);

321 
	}
}

323 
PÜtID


324 
	gBa£Bus
::
	$fšdPÜt
(
Addr
 
addr
)

328 
	`as£¹
(
gÙAÎAddrRªges
);

331 
PÜtID
 
de¡_id
 = 
	`checkPÜtCache
(
addr
);

332 ià(
de¡_id
 !ğ
Inv®idPÜtID
)

333  
de¡_id
;

336 
PÜtM­CÚ¡I‹r
 
i
 = 
pÜtM­
.
	`fšd
(
addr
);

337 ià(
i
 !ğ
pÜtM­
.
	`’d
()) {

338 
de¡_id
 = 
i
->
£cÚd
;

339 
	`upd©ePÜtCache
(
de¡_id
, 
i
->
fœ¡
);

340  
de¡_id
;

344 ià(
u£DeçuÉRªge
) {

345 ià(
deçuÉRªge
.
	`cÚšs
(
addr
)) {

346 
	`DPRINTF
(
BusAddrRªges
, " found‡ddr %#llx on default\n",

347 
addr
);

348  
deçuÉPÜtID
;

350 } ià(
deçuÉPÜtID
 !ğ
Inv®idPÜtID
) {

351 
	`DPRINTF
(
BusAddrRªges
, "Unableo find destination for‡ddr %#llx, "

352 "wÈu£ deçuÉ…Üt\n", 
addr
);

353  
deçuÉPÜtID
;

358 
	`çl
("UÇbËØfšd de¡š©iÚ fÜ‡dd¸%#Îx oÀbu %s\n", 
addr
,

359 
	`Çme
());

360 
	}
}

364 
	gBa£Bus
::
	$»cvRªgeChªge
(
PÜtID
 
ma¡”_pÜt_id
)

366 
	`DPRINTF
(
BusAddrRªges
, "Received„ange change from slave…ort %s\n",

367 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`g‘SÏvePÜt
().
	`Çme
());

371 
gÙAddrRªges
[
ma¡”_pÜt_id
] = 
Œue
;

374 ià(!
gÙAÎAddrRªges
) {

377 
gÙAÎAddrRªges
 = 
Œue
;

378 
¡d
::
veùÜ
<
boŞ
>::
cÚ¡_™”©Ü
 
r
 = 
gÙAddrRªges
.
	`begš
();

379 
gÙAÎAddrRªges
 && 
r
 !ğ
gÙAddrRªges
.
	`’d
()) {

380 
gÙAÎAddrRªges
 &ğ*
r
++;

382 ià(
gÙAÎAddrRªges
)

383 
	`DPRINTF
(
BusAddrRªges
, "Got‡ddress„anges from‡ll slaves\n");

390 ià(
ma¡”_pÜt_id
 =ğ
deçuÉPÜtID
) {

394 ià(
u£DeçuÉRªge
) {

395 
AddrRªgeLi¡
 
¿nges
 = 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`g‘AddrRªges
();

397 ià(
¿nges
.
	`size
() != 1)

398 
	`çl
("Bus %s may only have‡ single default„ange",

399 
	`Çme
());

401 
deçuÉRªge
 = 
¿nges
.
	`äÚt
();

406 ià(
gÙAddrRªges
[
ma¡”_pÜt_id
]) {

407 
PÜtM­I‹r
 
p
 = 
pÜtM­
.
	`begš
();… !ğpÜtM­.
	`’d
(); ) {

408 ià(
p
->
£cÚd
 =ğ
ma¡”_pÜt_id
)

411 
pÜtM­
.
	`”a£
(
p
++);

413 
p
++;

417 
AddrRªgeLi¡
 
¿nges
 = 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`g‘AddrRªges
();

419 
AddrRªgeCÚ¡I‹r
 
r
 = 
¿nges
.
	`begš
();„ !ğ¿nges.
	`’d
(); ++r) {

420 
	`DPRINTF
(
BusAddrRªges
, "Adding„ange %s for id %d\n",

421 
r
->
	`to_¡ršg
(), 
ma¡”_pÜt_id
);

422 ià(
pÜtM­
.
	`š£¹
(*
r
, 
ma¡”_pÜt_id
è=ğpÜtM­.
	`’d
()) {

423 
PÜtID
 
cÚæiù_id
 = 
pÜtM­
.
	`fšd
(*
r
)->
£cÚd
;

424 
	`çl
("%s haswo…orts with same„ange:\n\t%s\n\t%s\n",

425 
	`Çme
(),

426 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`g‘SÏvePÜt
().
	`Çme
(),

427 
ma¡”PÜts
[
cÚæiù_id
]->
	`g‘SÏvePÜt
().
	`Çme
());

435 ià(
gÙAÎAddrRªges
) {

436 
	`DPRINTF
(
BusAddrRªges
, "Aggregating bus„anges\n");

437 
busRªges
.
	`ş—r
();

440 ià(
u£DeçuÉRªge
) {

441 ià(!
gÙAddrRªges
[
deçuÉPÜtID
])

442 
	`çl
("Bus %s uses default„ange, but‚one…rovided",

443 
	`Çme
());

445 
busRªges
.
	`push_back
(
deçuÉRªge
);

446 
	`DPRINTF
(
BusAddrRªges
, "-- Adding default %s\n",

447 
deçuÉRªge
.
	`to_¡ršg
());

452 
¡d
::
veùÜ
<
AddrRªge
> 
šv_¿nges
;

453 
AddrRªgeM­
<
PÜtID
>::
cÚ¡_™”©Ü
 
r
 = 
pÜtM­
.
	`begš
();

454 
r
 !ğ
pÜtM­
.
	`’d
(); ++r) {

456 ià(
r
->
fœ¡
.
	`š‹¾—ved
()) {

460 ià(!
šv_¿nges
.
	`em±y
() &&

461 !
šv_¿nges
.
	`back
().
	`m”gesW™h
(
r
->
fœ¡
)) {

462 
	`DPRINTF
(
BusAddrRªges
, "-- Merging„ange from %d„anges\n",

463 
šv_¿nges
.
	`size
());

464 
AddrRªge
 
	`m”ged_¿nge
(
šv_¿nges
);

466 ià(!(
u£DeçuÉRªge
 &&

467 
m”ged_¿nge
.
	`isSub£t
(
deçuÉRªge
))) {

468 
busRªges
.
	`push_back
(
m”ged_¿nge
);

469 
	`DPRINTF
(
BusAddrRªges
, "-- Adding merged„ange %s\n",

470 
m”ged_¿nge
.
	`to_¡ršg
());

472 
šv_¿nges
.
	`ş—r
();

474 
šv_¿nges
.
	`push_back
(
r
->
fœ¡
);

477 ià(!(
u£DeçuÉRªge
 &&

478 
r
->
fœ¡
.
	`isSub£t
(
deçuÉRªge
))) {

479 
busRªges
.
	`push_back
(
r
->
fœ¡
);

480 
	`DPRINTF
(
BusAddrRªges
, "-- Adding„ange %s\n",

481 
r
->
fœ¡
.
	`to_¡ršg
());

488 ià(!
šv_¿nges
.
	`em±y
()) {

489 
	`DPRINTF
(
BusAddrRªges
, "-- Merging„ange from %d„anges\n",

490 
šv_¿nges
.
	`size
());

491 
AddrRªge
 
	`m”ged_¿nge
(
šv_¿nges
);

492 ià(!(
u£DeçuÉRªge
 && 
m”ged_¿nge
.
	`isSub£t
(
deçuÉRªge
))) {

493 
busRªges
.
	`push_back
(
m”ged_¿nge
);

494 
	`DPRINTF
(
BusAddrRªges
, "-- Adding merged„ange %s\n",

495 
m”ged_¿nge
.
	`to_¡ršg
());

503 ià(
u£DeçuÉRªge
) {

504 
AddrRªgeCÚ¡I‹r
 
r
 = 
busRªges
.
	`begš
();

505 
r
 !ğ
busRªges
.
	`’d
(); ++r) {

508 ià(
r
->
	`š‹r£ùs
(
deçuÉRªge
) &&

509 !
r
->
	`isSub£t
(
deçuÉRªge
))

510 
	`çl
("Range %s intersectshe " \

512 "sub£t\n", 
r
->
	`to_¡ršg
(), 
	`Çme
());

518 
SÏvePÜtCÚ¡I‹r
 
s
 = 
¦avePÜts
.
	`begš
(); s !ğ¦avePÜts.
	`’d
();

519 ++
s
)

520 (*
s
)->
	`£ndRªgeChªge
();

523 
	`ş—rPÜtCache
();

524 
	}
}

526 
AddrRªgeLi¡


527 
	gBa£Bus
::
	$g‘AddrRªges
() const

532 
	`as£¹
(
gÙAÎAddrRªges
);

539 
	`DPRINTF
(
BusAddrRªges
, "Received‡ddress„ange„equest\n");

541  
busRªges
;

542 
	}
}

545 
	gBa£Bus
::
	$»gSts
()

547 
usšg
 
Çme¥aû
 
Sts
;

549 
ŒªsDi¡


550 .
	`š™
(
MemCmd
::
NUM_MEM_CMDS
)

551 .
	`Çme
(name() + ".trans_dist")

552 .
	`desc
("Transaction distribution")

553 .
	`æags
(
noz”o
);

556 
i
 = 0; i < 
MemCmd
::
NUM_MEM_CMDS
; i++) {

557 
MemCmd
 
	`cmd
(
i
);

558 cÚ¡ 
¡d
::
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

559 
ŒªsDi¡
.
	`subÇme
(
i
, 
c¡r
);

562 
pktCouÁ


563 .
	`š™
(
¦avePÜts
.
	`size
(), 
ma¡”PÜts
.size())

564 .
	`Çme
(name() + ".pkt_count")

565 .
	`desc
("Packet count…er connected master‡nd slave (bytes)")

566 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
);

568 
tÙPktSize


569 .
	`š™
(
¦avePÜts
.
	`size
(), 
ma¡”PÜts
.size())

570 .
	`Çme
(name() + ".tot_pkt_size")

571 .
	`desc
("Cumulative…acket size…er connected master‡nd slave (bytes)")

572 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
);

580 
i
 = 0; i < 
¦avePÜts
.
	`size
(); i++) {

581 
pktCouÁ
.
	`subÇme
(
i
, 
¦avePÜts
[i]->
	`g‘Ma¡”PÜt
().
	`Çme
());

582 
tÙPktSize
.
	`subÇme
(
i
, 
¦avePÜts
[i]->
	`g‘Ma¡”PÜt
().
	`Çme
());

583 
j
 = 0; j < 
ma¡”PÜts
.
	`size
(); j++) {

584 
pktCouÁ
.
	`ysubÇme
(
j
, 
ma¡”PÜts
[j]->
	`g‘SÏvePÜt
().
	`Çme
());

585 
tÙPktSize
.
	`ysubÇme
(
j
, 
ma¡”PÜts
[j]->
	`g‘SÏvePÜt
().
	`Çme
());

588 
	}
}

590 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

592 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$d¿š
(
D¿šMªag”
 *
dm
)

597 ià(
¡©e
 !ğ
IDLE
) {

598 
	`DPRINTF
(
D¿š
, "Bus‚ot drained\n");

599 
d¿šMªag”
 = 
dm
;

603 
	}
}

605 
	g‹m¶©e
 <
ty³Çme
 
	gSrcTy³
,y³Çm
	gD¡Ty³
>

607 
	gBa£Bus
::
Lay”
<
SrcTy³
,
	gD¡Ty³
>::
	$»gSts
()

609 
usšg
 
Çme¥aû
 
Sts
;

611 
occu·ncy


612 .
	`Çme
(name() + ".occupancy")

613 .
	`desc
("Layer occupancy (ticks)")

614 .
	`æags
(
noz”o
);

616 
utiz©iÚ


617 .
	`Çme
(name() + ".utilization")

618 .
	`desc
("Layer utilization (%)")

619 .
	`´ecisiÚ
(1)

620 .
	`æags
(
noz”o
);

622 
utiz©iÚ
 = 100 * 
occu·ncy
 / 
simTicks
;

623 
	}
}

630 
‹m¶©e
 
şass
 
	gBa£Bus
::
Lay”
<
SÏvePÜt
,
	gMa¡”PÜt
>;

631 
‹m¶©e
 
şass
 
	gBa£Bus
::
Lay”
<
Ma¡”PÜt
,
	gSÏvePÜt
>;

	@bus.hh

51 #iâdeà
__MEM_BUS_HH__


52 
	#__MEM_BUS_HH__


	)

54 
	~<deque
>

56 
	~"ba£/addr_¿nge_m­.hh
"

57 
	~"ba£/ty³s.hh
"

58 
	~"mem/mem_objeù.hh
"

59 
	~"·¿ms/Ba£Bus.hh
"

60 
	~"sim/¡©s.hh
"

71 şas 
	cBa£Bus
 : 
public
 
MemObjeù


74 
´Ùeùed
:

96 
‹m¶©e
 <
ty³Çme
 
SrcTy³
,y³Çm
	mD¡Ty³
>

97 şas 
	cLay”
 : 
public
 
D¿šabË


100 
public
:

110 
Lay”
(
D¡Ty³
& 
_pÜt
, 
Ba£Bus
& 
_bus
, cÚ¡ 
¡d
::
¡ršg
& 
_Çme
);

121 
d¿š
(
D¿šMªag”
 *
dm
);

126 cÚ¡ 
	m¡d
::
¡ršg
 
Çme
(ècÚ¡ {  
bus
.Çme(è+ 
_Çme
; }

139 
boŞ
 
ŒyTimšg
(
SrcTy³
* 
¤c_pÜt
);

148 
sucûededTimšg
(
Tick
 
busy_time
);

159 
çedTimšg
(
SrcTy³
* 
¤c_pÜt
, 
Tick
 
busy_time
);

162 
occupyLay”
(
Tick
 
uÁ
);

168 
»ŒyWa™šg
();

175 
»cvR‘ry
();

180 
»gSts
();

182 
	m´iv©e
:

185 
D¡Ty³
& 
pÜt
;

188 
	mBa£Bus
& 
	mbus
;

191 
	m¡d
::
¡ršg
 
_Çme
;

209 
	eS‹
 { 
	mIDLE
, 
	mBUSY
, 
	mRETRY
 };

212 
S‹
 
	m¡©e
;

215 
D¿šMªag”
 *
	md¿šMªag”
;

221 
	m¡d
::
deque
<
SrcTy³
*> 
wa™šgFÜLay”
;

229 
SrcTy³
* 
	m»ŒyšgPÜt
;

235 
SrcTy³
* 
	mwa™šgFÜP“r
;

242 
»Ëa£Lay”
();

245 
	mEv’tW¿µ”
<
	mLay”
, &Lay”::
»Ëa£Lay”
> 
»Ëa£Ev’t
;

252 
	mSts
::
SÿÏr
 
occu·ncy
;

253 
	mSts
::
FÜmuÏ
 
utiz©iÚ
;

258 cÚ¡ 
Cyşes
 
	gh—d”Cyşes
;

260 cÚ¡ 
ušt32_t
 
	gwidth
;

262 
	gAddrRªgeM­
<
	tPÜtID
>::
	t™”©Ü
 
	tPÜtM­I‹r
;

263 
	gAddrRªgeM­
<
	tPÜtID
>::
	tcÚ¡_™”©Ü
 
	tPÜtM­CÚ¡I‹r
;

264 
	gAddrRªgeM­
<
	gPÜtID
> 
	gpÜtM­
;

267 
AddrRªgeLi¡
 
	gbusRªges
;

269 
AddrRªge
 
	gdeçuÉRªge
;

276 
»cvRªgeChªge
(
PÜtID
 
ma¡”_pÜt_id
);

283 
PÜtID
 
fšdPÜt
(
Addr
 
addr
);

286 
	sPÜtCache
 {

287 
boŞ
 
	gv®id
;

288 
PÜtID
 
	gid
;

289 
AddrRªge
 
	g¿nge
;

292 
PÜtCache
 
	gpÜtCache
[3];

296 
šlše
 
PÜtID
 
	$checkPÜtCache
(
Addr
 
addr
) const {

297 ià(
pÜtCache
[0].
v®id
 &&…ÜtCache[0].
¿nge
.
	`cÚšs
(
addr
)) {

298  
pÜtCache
[0].
id
;

300 ià(
pÜtCache
[1].
v®id
 &&…ÜtCache[1].
¿nge
.
	`cÚšs
(
addr
)) {

301  
pÜtCache
[1].
id
;

303 ià(
pÜtCache
[2].
v®id
 &&…ÜtCache[2].
¿nge
.
	`cÚšs
(
addr
)) {

304  
pÜtCache
[2].
id
;

307  
Inv®idPÜtID
;

308 
	}
}

311 
šlše
 
	$upd©ePÜtCache
(
id
, cÚ¡ 
AddrRªge
& 
¿nge
) {

312 
pÜtCache
[2].
v®id
 =…ortCache[1].valid;

313 
pÜtCache
[2].
id
 =…ortCache[1].id;

314 
pÜtCache
[2].
¿nge
 =…ortCache[1].range;

316 
pÜtCache
[1].
v®id
 =…ortCache[0].valid;

317 
pÜtCache
[1].
id
 =…ortCache[0].id;

318 
pÜtCache
[1].
¿nge
 =…ortCache[0].range;

320 
pÜtCache
[0].
v®id
 = 
Œue
;

321 
pÜtCache
[0].
id
 = id;

322 
pÜtCache
[0].
¿nge
 =„ange;

323 
	}
}

326 
šlše
 
	$ş—rPÜtCache
() {

327 
pÜtCache
[2].
v®id
 = 
çl£
;

328 
pÜtCache
[1].
v®id
 = 
çl£
;

329 
pÜtCache
[0].
v®id
 = 
çl£
;

330 
	}
}

337 
AddrRªgeLi¡
 
	$g‘AddrRªges
() const;

345 
	`ÿlcPack‘Timšg
(
Pack‘PŒ
 
pkt
);

353 
¡d
::
veùÜ
<
boŞ
> 
gÙAddrRªges
;

354 
boŞ
 
gÙAÎAddrRªges
;

357 
¡d
::
veùÜ
<
SÏvePÜt
*> 
¦avePÜts
;

358 
¡d
::
veùÜ
<
Ma¡”PÜt
*> 
ma¡”PÜts
;

361 
¡d
::
	tveùÜ
<
	tSÏvePÜt
*>::
	t™”©Ü
 
	tSÏvePÜtI‹r
;

362 
¡d
::
	tveùÜ
<
	tMa¡”PÜt
*>::
	t™”©Ü
 
	tMa¡”PÜtI‹r
;

363 
¡d
::
	tveùÜ
<
	tSÏvePÜt
*>::
	tcÚ¡_™”©Ü
 
	tSÏvePÜtCÚ¡I‹r
;

364 
¡d
::
	tveùÜ
<
	tMa¡”PÜt
*>::
	tcÚ¡_™”©Ü
 
	tMa¡”PÜtCÚ¡I‹r
;

367 
PÜtID
 
deçuÉPÜtID
;

373 cÚ¡ 
boŞ
 
u£DeçuÉRªge
;

375 
	`Ba£Bus
(cÚ¡ 
Ba£BusP¬ams
 *
p
);

377 
vœtu®
 ~
	`Ba£Bus
();

388 
Sts
::
FÜmuÏ
 
throughput
;

389 
Sts
::
VeùÜ
 
ŒªsDi¡
;

390 
Sts
::
VeùÜ2d
 
pktCouÁ
;

391 
Sts
::
VeùÜ2d
 
tÙPktSize
;

393 
public
:

395 
vœtu®
 
	`š™
();

398 
Ba£Ma¡”PÜt
& 
	`g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

399 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

400 
Ba£SÏvePÜt
& 
	`g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

401 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

403 
vœtu®
 
	`d¿š
(
D¿šMªag”
 *
dm
) = 0;

405 
vœtu®
 
	`»gSts
();

407 
	}
};

	@cache/base.cc

48 
	~"debug/Cache.hh
"

49 
	~"debug/D¿š.hh
"

50 
	~"mem/ÿche/gs/ç_Ìu.hh
"

51 
	~"mem/ÿche/gs/Ìu.hh
"

52 
	~"mem/ÿche/ba£.hh
"

53 
	~"mem/ÿche/ÿche.hh
"

54 
	~"mem/ÿche/mshr.hh
"

55 
	~"sim/fuÎ_sy¡em.hh
"

57 
usšg
 
Çme¥aû
 
	g¡d
;

59 
	gBa£Cache
::
CacheSÏvePÜt
::CacheSÏvePÜt(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
,

60 
Ba£Cache
 *
_ÿche
,

61 cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
)

62 : 
QueuedSÏvePÜt
(
_Çme
, 
_ÿche
, 
queue
), queue(*_ÿche, *
this
, 
_Ïb–
),

63 
blocked
(
çl£
), 
mu¡S’dR‘ry
(çl£), 
	$£ndR‘ryEv’t
(
this
)

65 
	}
}

67 
	gBa£Cache
::
	$Ba£Cache
(cÚ¡ 
P¬ams
 *
p
)

68 : 
	`MemObjeù
(
p
),

69 
	`mshrQueue
("MSHRs", 
p
->
mshrs
, 4, 
MSHRQueue_MSHRs
),

70 
	`wr™eBufãr
("wr™bufãr", 
p
->
wr™e_bufãrs
,…->
mshrs
+1000,

71 
MSHRQueue_Wr™eBufãr
),

72 
	`blkSize
(
p
->
sy¡em
->
	`ÿcheLšeSize
()),

73 
	`h™L©’cy
(
p
->
h™_Ï‹ncy
),

74 
	`»¥Ú£L©’cy
(
p
->
»¥Ú£_Ï‹ncy
),

75 
	`numT¬g‘
(
p
->
tgts_³r_mshr
),

76 
	`fÜw¬dSnoİs
(
p
->
fÜw¬d_¢oİs
),

77 
	`isTİLev–
(
p
->
is_tİ_Ëv–
),

78 
	`blocked
(0),

79 
	`noT¬g‘MSHR
(
NULL
),

80 
	`missCouÁ
(
p
->
max_miss_couÁ
),

81 
	`addrRªges
(
p
->
addr_¿nges
.
	`begš
(),…->addr_¿nges.
	`’d
()),

82 
	`sy¡em
(
p
->
sy¡em
)

84 
	}
}

87 
	gBa£Cache
::
CacheSÏvePÜt
::
	$£tBlocked
()

89 
	`as£¹
(!
blocked
);

90 
	`DPRINTF
(
CachePÜt
, "CachpÜˆ% blockšg‚ew„eque¡s\n", 
	`Çme
());

91 
blocked
 = 
Œue
;

94 ià(
£ndR‘ryEv’t
.
	`scheduËd
()) {

95 
owÃr
.
	`descheduË
(
£ndR‘ryEv’t
);

96 
	`DPRINTF
(
CachePÜt
, "CachpÜˆ% descheduË„‘ry\n", 
	`Çme
());

97 
mu¡S’dR‘ry
 = 
Œue
;

99 
	}
}

102 
	gBa£Cache
::
CacheSÏvePÜt
::
	$ş—rBlocked
()

104 
	`as£¹
(
blocked
);

105 
	`DPRINTF
(
CachePÜt
, "CachpÜˆ% acû±šg‚ew„eque¡s\n", 
	`Çme
());

106 
blocked
 = 
çl£
;

107 ià(
mu¡S’dR‘ry
) {

108 
	`DPRINTF
(
CachePÜt
, "CachpÜˆ% £ndšg„‘ry\n", 
	`Çme
());

109 
mu¡S’dR‘ry
 = 
çl£
;

111 
owÃr
.
	`scheduË
(
£ndR‘ryEv’t
, 
	`curTick
() + 1);

113 
	}
}

117 
	gBa£Cache
::
	$š™
()

119 ià(!
ıuSidePÜt
->
	`isCÚÃùed
(è|| !
memSidePÜt
->isConnected())

120 
	`çl
("CachpÜt Ú % ¬nÙ cÚÃùed\n", 
	`Çme
());

121 
ıuSidePÜt
->
	`£ndRªgeChªge
();

122 
	}
}

124 
	gBa£Ma¡”PÜt
 &

125 
	gBa£Cache
::
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

127 ià(
	gif_Çme
 == "mem_side") {

128  *
memSidePÜt
;

130  
	gMemObjeù
::
g‘Ma¡”PÜt
(
if_Çme
, 
idx
);

134 
	gBa£SÏvePÜt
 &

135 
	gBa£Cache
::
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

137 ià(
	gif_Çme
 == "cpu_side") {

138  *
ıuSidePÜt
;

140  
	gMemObjeù
::
g‘SÏvePÜt
(
if_Çme
, 
idx
);

145 
	gBa£Cache
::
	$»gSts
()

147 
usšg
 
Çme¥aû
 
Sts
;

150 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

151 
MemCmd
 
	`cmd
(
acûss_idx
);

152 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

154 
h™s
[
acûss_idx
]

155 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

156 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_hits")

157 .
	`desc
("numb” oà" + 
c¡r
 + " hits")

158 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

160 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

161 
h™s
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

168 
	#SUM_DEMAND
(
s
) \

169 (
s
[
MemCmd
::
R—dReq
] + s[MemCmd::
Wr™eReq
] + s[MemCmd::
R—dExReq
])

	)

172 
	#SUM_NON_DEMAND
(
s
) \

173 (
s
[
MemCmd
::
SoáPFReq
] + s[MemCmd::
H¬dPFReq
])

	)

175 
demªdH™s


176 .
	`Çme
(name() + ".demand_hits")

177 .
	`desc
("number of demand (read+write) hits")

178 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

180 
demªdH™s
 = 
	`SUM_DEMAND
(
h™s
);

181 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

182 
demªdH™s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

185 
ov”®lH™s


186 .
	`Çme
(name() + ".overall_hits")

187 .
	`desc
("number of overall hits")

188 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

190 
ov”®lH™s
 = 
demªdH™s
 + 
	`SUM_NON_DEMAND
(
h™s
);

191 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

192 
ov”®lH™s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

196 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

197 
MemCmd
 
	`cmd
(
acûss_idx
);

198 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

200 
mis£s
[
acûss_idx
]

201 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

202 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_misses")

203 .
	`desc
("numb” oà" + 
c¡r
 + " misses")

204 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

206 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

207 
mis£s
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

211 
demªdMis£s


212 .
	`Çme
(name() + ".demand_misses")

213 .
	`desc
("number of demand (read+write) misses")

214 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

216 
demªdMis£s
 = 
	`SUM_DEMAND
(
mis£s
);

217 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

218 
demªdMis£s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

221 
ov”®lMis£s


222 .
	`Çme
(name() + ".overall_misses")

223 .
	`desc
("number of overall misses")

224 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

226 
ov”®lMis£s
 = 
demªdMis£s
 + 
	`SUM_NON_DEMAND
(
mis£s
);

227 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

228 
ov”®lMis£s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

232 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

233 
MemCmd
 
	`cmd
(
acûss_idx
);

234 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

236 
missL©’cy
[
acûss_idx
]

237 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

238 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_miss_latency")

239 .
	`desc
("numb” oà" + 
c¡r
 + " miss cycles")

240 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

242 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

243 
missL©’cy
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

247 
demªdMissL©’cy


248 .
	`Çme
(name() + ".demand_miss_latency")

249 .
	`desc
("number of demand (read+write) miss cycles")

250 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

252 
demªdMissL©’cy
 = 
	`SUM_DEMAND
(
missL©’cy
);

253 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

254 
demªdMissL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

257 
ov”®lMissL©’cy


258 .
	`Çme
(name() + ".overall_miss_latency")

259 .
	`desc
("number of overall miss cycles")

260 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

262 
ov”®lMissL©’cy
 = 
demªdMissL©’cy
 + 
	`SUM_NON_DEMAND
(
missL©’cy
);

263 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

264 
ov”®lMissL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

268 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

269 
MemCmd
 
	`cmd
(
acûss_idx
);

270 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

272 
acûs£s
[
acûss_idx
]

273 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_accesses")

274 .
	`desc
("numb” oà" + 
c¡r
 + "‡ccesses(hits+misses)")

275 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

277 
acûs£s
[
acûss_idx
] = 
h™s
[acûss_idx] + 
mis£s
[access_idx];

279 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

280 
acûs£s
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

284 
demªdAcûs£s


285 .
	`Çme
(name() + ".demand_accesses")

286 .
	`desc
("number of demand (read+write)‡ccesses")

287 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

289 
demªdAcûs£s
 = 
demªdH™s
 + 
demªdMis£s
;

290 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

291 
demªdAcûs£s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

294 
ov”®lAcûs£s


295 .
	`Çme
(name() + ".overall_accesses")

296 .
	`desc
("number of overall (read+write)‡ccesses")

297 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

299 
ov”®lAcûs£s
 = 
ov”®lH™s
 + 
ov”®lMis£s
;

300 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

301 
ov”®lAcûs£s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

305 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

306 
MemCmd
 
	`cmd
(
acûss_idx
);

307 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

309 
missR©e
[
acûss_idx
]

310 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_miss_rate")

311 .
	`desc
("mis ¿‹ fÜ " + 
c¡r
 + "‡ccesses")

312 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

314 
missR©e
[
acûss_idx
] = 
mis£s
[acûss_idx] / 
acûs£s
[access_idx];

316 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

317 
missR©e
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

321 
demªdMissR©e


322 .
	`Çme
(name() + ".demand_miss_rate")

323 .
	`desc
("miss„ate for demand‡ccesses")

324 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

326 
demªdMissR©e
 = 
demªdMis£s
 / 
demªdAcûs£s
;

327 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

328 
demªdMissR©e
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

331 
ov”®lMissR©e


332 .
	`Çme
(name() + ".overall_miss_rate")

333 .
	`desc
("miss„ate for overall‡ccesses")

334 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

336 
ov”®lMissR©e
 = 
ov”®lMis£s
 / 
ov”®lAcûs£s
;

337 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

338 
ov”®lMissR©e
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

342 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

343 
MemCmd
 
	`cmd
(
acûss_idx
);

344 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

346 
avgMissL©’cy
[
acûss_idx
]

347 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_avg_miss_latency")

348 .
	`desc
("av”ag" + 
c¡r
 + " miss†atency")

349 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

351 
avgMissL©’cy
[
acûss_idx
] =

352 
missL©’cy
[
acûss_idx
] / 
mis£s
[access_idx];

354 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

355 
avgMissL©’cy
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

359 
demªdAvgMissL©’cy


360 .
	`Çme
(name() + ".demand_avg_miss_latency")

361 .
	`desc
("average overall miss†atency")

362 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

364 
demªdAvgMissL©’cy
 = 
demªdMissL©’cy
 / 
demªdMis£s
;

365 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

366 
demªdAvgMissL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

369 
ov”®lAvgMissL©’cy


370 .
	`Çme
(name() + ".overall_avg_miss_latency")

371 .
	`desc
("average overall miss†atency")

372 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

374 
ov”®lAvgMissL©’cy
 = 
ov”®lMissL©’cy
 / 
ov”®lMis£s
;

375 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

376 
ov”®lAvgMissL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

379 
blocked_cyşes
.
	`š™
(
NUM_BLOCKED_CAUSES
);

380 
blocked_cyşes


381 .
	`Çme
(name() + ".blocked_cycles")

382 .
	`desc
("number of cycles‡ccess was blocked")

383 .
	`subÇme
(
Blocked_NoMSHRs
, "no_mshrs")

384 .
	`subÇme
(
Blocked_NoT¬g‘s
, "no_targets")

388 
blocked_ÿu£s
.
	`š™
(
NUM_BLOCKED_CAUSES
);

389 
blocked_ÿu£s


390 .
	`Çme
(name() + ".blocked")

391 .
	`desc
("number of cycles‡ccess was blocked")

392 .
	`subÇme
(
Blocked_NoMSHRs
, "no_mshrs")

393 .
	`subÇme
(
Blocked_NoT¬g‘s
, "no_targets")

396 
avg_blocked


397 .
	`Çme
(name() + ".avg_blocked_cycles")

398 .
	`desc
("average‚umber of cyclesƒach‡ccess was blocked")

399 .
	`subÇme
(
Blocked_NoMSHRs
, "no_mshrs")

400 .
	`subÇme
(
Blocked_NoT¬g‘s
, "no_targets")

403 
avg_blocked
 = 
blocked_cyşes
 / 
blocked_ÿu£s
;

405 
ç¡Wr™es


406 .
	`Çme
(name() + ".fast_writes")

407 .
	`desc
("number of fast writes…erformed")

410 
ÿcheCİ›s


411 .
	`Çme
(name() + ".cache_copies")

412 .
	`desc
("number of cache copies…erformed")

415 
wr™ebacks


416 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

417 .
	`Çme
(name() + ".writebacks")

418 .
	`desc
("number of writebacks")

419 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

421 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

422 
wr™ebacks
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

427 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

428 
MemCmd
 
	`cmd
(
acûss_idx
);

429 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

431 
mshr_h™s
[
acûss_idx
]

432 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

433 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_mshr_hits")

434 .
	`desc
("numb” oà" + 
c¡r
 + " MSHR hits")

435 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

437 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

438 
mshr_h™s
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

442 
demªdMshrH™s


443 .
	`Çme
(name() + ".demand_mshr_hits")

444 .
	`desc
("number of demand (read+write) MSHR hits")

445 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

447 
demªdMshrH™s
 = 
	`SUM_DEMAND
(
mshr_h™s
);

448 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

449 
demªdMshrH™s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

452 
ov”®lMshrH™s


453 .
	`Çme
(name() + ".overall_mshr_hits")

454 .
	`desc
("number of overall MSHR hits")

455 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

457 
ov”®lMshrH™s
 = 
demªdMshrH™s
 + 
	`SUM_NON_DEMAND
(
mshr_h™s
);

458 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

459 
ov”®lMshrH™s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

463 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

464 
MemCmd
 
	`cmd
(
acûss_idx
);

465 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

467 
mshr_mis£s
[
acûss_idx
]

468 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

469 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_mshr_misses")

470 .
	`desc
("numb” oà" + 
c¡r
 + " MSHR misses")

471 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

473 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

474 
mshr_mis£s
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

478 
demªdMshrMis£s


479 .
	`Çme
(name() + ".demand_mshr_misses")

480 .
	`desc
("number of demand (read+write) MSHR misses")

481 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

483 
demªdMshrMis£s
 = 
	`SUM_DEMAND
(
mshr_mis£s
);

484 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

485 
demªdMshrMis£s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

488 
ov”®lMshrMis£s


489 .
	`Çme
(name() + ".overall_mshr_misses")

490 .
	`desc
("number of overall MSHR misses")

491 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

493 
ov”®lMshrMis£s
 = 
demªdMshrMis£s
 + 
	`SUM_NON_DEMAND
(
mshr_mis£s
);

494 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

495 
ov”®lMshrMis£s
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

499 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

500 
MemCmd
 
	`cmd
(
acûss_idx
);

501 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

503 
mshr_miss_Ï‹ncy
[
acûss_idx
]

504 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

505 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_mshr_miss_latency")

506 .
	`desc
("numb” oà" + 
c¡r
 + " MSHR miss cycles")

507 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

509 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

510 
mshr_miss_Ï‹ncy
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

514 
demªdMshrMissL©’cy


515 .
	`Çme
(name() + ".demand_mshr_miss_latency")

516 .
	`desc
("number of demand (read+write) MSHR miss cycles")

517 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

519 
demªdMshrMissL©’cy
 = 
	`SUM_DEMAND
(
mshr_miss_Ï‹ncy
);

520 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

521 
demªdMshrMissL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

524 
ov”®lMshrMissL©’cy


525 .
	`Çme
(name() + ".overall_mshr_miss_latency")

526 .
	`desc
("number of overall MSHR miss cycles")

527 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

529 
ov”®lMshrMissL©’cy
 =

530 
demªdMshrMissL©’cy
 + 
	`SUM_NON_DEMAND
(
mshr_miss_Ï‹ncy
);

531 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

532 
ov”®lMshrMissL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

536 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

537 
MemCmd
 
	`cmd
(
acûss_idx
);

538 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

540 
mshr_unÿch—bË
[
acûss_idx
]

541 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

542 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_mshr_uncacheable")

543 .
	`desc
("numb” oà" + 
c¡r
 + " MSHR uncacheable")

544 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

546 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

547 
mshr_unÿch—bË
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

551 
ov”®lMshrUnÿch—bË


552 .
	`Çme
(name() + ".overall_mshr_uncacheable_misses")

553 .
	`desc
("number of overall MSHR uncacheable misses")

554 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

556 
ov”®lMshrUnÿch—bË
 =

557 
	`SUM_DEMAND
(
mshr_unÿch—bË
è+ 
	`SUM_NON_DEMAND
(mshr_uncacheable);

558 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

559 
ov”®lMshrUnÿch—bË
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

563 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

564 
MemCmd
 
	`cmd
(
acûss_idx
);

565 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

567 
mshr_unÿch—bË_Ït
[
acûss_idx
]

568 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

569 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_mshr_uncacheable_latency")

570 .
	`desc
("numb” oà" + 
c¡r
 + " MSHR uncacheable cycles")

571 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

573 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

574 
mshr_unÿch—bË_Ït
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

578 
ov”®lMshrUnÿch—bËL©’cy


579 .
	`Çme
(name() + ".overall_mshr_uncacheable_latency")

580 .
	`desc
("number of overall MSHR uncacheable cycles")

581 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

583 
ov”®lMshrUnÿch—bËL©’cy
 =

584 
	`SUM_DEMAND
(
mshr_unÿch—bË_Ït
) +

585 
	`SUM_NON_DEMAND
(
mshr_unÿch—bË_Ït
);

586 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

587 
ov”®lMshrUnÿch—bËL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

592 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

593 
MemCmd
 
	`cmd
(
acûss_idx
);

594 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

596 
mshrAcûs£s
[
acûss_idx
]

597 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_mshr_accesses")

598 .
	`desc
("numb” oà" + 
c¡r
 + " mshr‡ccesses(hits+misses)")

599 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

601 
mshrAcûs£s
[
acûss_idx
] =

602 
mshr_h™s
[
acûss_idx
] + 
mshr_mis£s
[access_idx]

603 + 
mshr_unÿch—bË
[
acûss_idx
];

606 
demªdMshrAcûs£s


607 .
	`Çme
(name() + ".demand_mshr_accesses")

608 .
	`desc
("number of demand (read+write) mshr‡ccesses")

609 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

611 
demªdMshrAcûs£s
 = 
demªdMshrH™s
 + 
demªdMshrMis£s
;

613 
ov”®lMshrAcûs£s


614 .
	`Çme
(name() + ".overall_mshr_accesses")

615 .
	`desc
("number of overall (read+write) mshr‡ccesses")

616 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

618 
ov”®lMshrAcûs£s
 = 
ov”®lMshrH™s
 + 
ov”®lMshrMis£s


619 + 
ov”®lMshrUnÿch—bË
;

623 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

624 
MemCmd
 
	`cmd
(
acûss_idx
);

625 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

627 
mshrMissR©e
[
acûss_idx
]

628 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_mshr_miss_rate")

629 .
	`desc
("msh¸mis ¿‹ fÜ " + 
c¡r
 + "‡ccesses")

630 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

632 
mshrMissR©e
[
acûss_idx
] =

633 
mshr_mis£s
[
acûss_idx
] / 
acûs£s
[access_idx];

635 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

636 
mshrMissR©e
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

640 
demªdMshrMissR©e


641 .
	`Çme
(name() + ".demand_mshr_miss_rate")

642 .
	`desc
("mshr miss„ate for demand‡ccesses")

643 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

645 
demªdMshrMissR©e
 = 
demªdMshrMis£s
 / 
demªdAcûs£s
;

646 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

647 
demªdMshrMissR©e
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

650 
ov”®lMshrMissR©e


651 .
	`Çme
(name() + ".overall_mshr_miss_rate")

652 .
	`desc
("mshr miss„ate for overall‡ccesses")

653 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

655 
ov”®lMshrMissR©e
 = 
ov”®lMshrMis£s
 / 
ov”®lAcûs£s
;

656 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

657 
ov”®lMshrMissR©e
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

661 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

662 
MemCmd
 
	`cmd
(
acûss_idx
);

663 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

665 
avgMshrMissL©’cy
[
acûss_idx
]

666 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_avg_mshr_miss_latency")

667 .
	`desc
("av”ag" + 
c¡r
 + " mshr miss†atency")

668 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

670 
avgMshrMissL©’cy
[
acûss_idx
] =

671 
mshr_miss_Ï‹ncy
[
acûss_idx
] / 
mshr_mis£s
[access_idx];

673 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

674 
avgMshrMissL©’cy
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

678 
demªdAvgMshrMissL©’cy


679 .
	`Çme
(name() + ".demand_avg_mshr_miss_latency")

680 .
	`desc
("average overall mshr miss†atency")

681 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

683 
demªdAvgMshrMissL©’cy
 = 
demªdMshrMissL©’cy
 / 
demªdMshrMis£s
;

684 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

685 
demªdAvgMshrMissL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

688 
ov”®lAvgMshrMissL©’cy


689 .
	`Çme
(name() + ".overall_avg_mshr_miss_latency")

690 .
	`desc
("average overall mshr miss†atency")

691 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

693 
ov”®lAvgMshrMissL©’cy
 = 
ov”®lMshrMissL©’cy
 / 
ov”®lMshrMis£s
;

694 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

695 
ov”®lAvgMshrMissL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

699 
acûss_idx
 = 0;‡cûss_idx < 
MemCmd
::
NUM_MEM_CMDS
; ++access_idx) {

700 
MemCmd
 
	`cmd
(
acûss_idx
);

701 cÚ¡ 
¡ršg
 &
c¡r
 = 
cmd
.
	`toSŒšg
();

703 
avgMshrUnÿch—bËL©’cy
[
acûss_idx
]

704 .
	`Çme
Òame(è+ "." + 
c¡r
 + "_avg_mshr_uncacheable_latency")

705 .
	`desc
("av”ag" + 
c¡r
 + " mshr uncacheable†atency")

706 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

708 
avgMshrUnÿch—bËL©’cy
[
acûss_idx
] =

709 
mshr_unÿch—bË_Ït
[
acûss_idx
] / 
mshr_unÿch—bË
[access_idx];

711 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

712 
avgMshrUnÿch—bËL©’cy
[
acûss_idx
].
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

716 
ov”®lAvgMshrUnÿch—bËL©’cy


717 .
	`Çme
(name() + ".overall_avg_mshr_uncacheable_latency")

718 .
	`desc
("average overall mshr uncacheable†atency")

719 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

721 
ov”®lAvgMshrUnÿch—bËL©’cy
 = 
ov”®lMshrUnÿch—bËL©’cy
 / 
ov”®lMshrUnÿch—bË
;

722 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

723 
ov”®lAvgMshrUnÿch—bËL©’cy
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

726 
mshr_ÿp_ev’ts


727 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

728 .
	`Çme
(name() + ".mshr_cap_events")

729 .
	`desc
("number ofimes MSHR cap was‡ctivated")

730 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

732 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

733 
mshr_ÿp_ev’ts
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

737 
soá_´eãtch_mshr_fuÎ


738 .
	`š™
(
sy¡em
->
	`maxMa¡”s
())

739 .
	`Çme
(name() + ".soft_prefetch_mshr_full")

740 .
	`desc
("number of mshr fullƒvents for SW…refetching instrutions")

741 .
	`æags
(
tÙ®
 | 
noz”o
 | 
nÚª
)

743 
i
 = 0; i < 
sy¡em
->
	`maxMa¡”s
(); i++) {

744 
soá_´eãtch_mshr_fuÎ
.
	`subÇme
(
i
, 
sy¡em
->
	`g‘Ma¡”Name
(i));

747 
mshr_no_®loÿ‹_mis£s


748 .
	`Çme
(name() +".no_allocate_misses")

749 .
	`desc
("Number of misseshat were‚o-allocate")

752 
	}
}

755 
	gBa£Cache
::
	$d¿š
(
D¿šMªag”
 *
dm
)

757 
couÁ
 = 
memSidePÜt
->
	`d¿š
(
dm
è+ 
ıuSidePÜt
->drain(dm) +

758 
mshrQueue
.
	`d¿š
(
dm
è+ 
wr™eBufãr
.drain(dm);

761 ià(
couÁ
 != 0) {

762 
	`£tD¿šS‹
(
D¿šabË
::
D¿ššg
);

763 
	`DPRINTF
(
D¿š
, "Cache‚ot drained\n");

764  
couÁ
;

767 
	`£tD¿šS‹
(
D¿šabË
::
D¿šed
);

769 
	}
}

771 
Ba£Cache
 *

772 
	gBa£CacheP¬ams
::
	$ü—‹
()

774 
numS‘s
 = 
size
 / (
assoc
 * 
sy¡em
->
	`ÿcheLšeSize
());

776 
	`as£¹
(
gs
);

778 ià(
dyÇmic_ÿ¡
<
FALRU
*>(
gs
)) {

779 ià(
numS‘s
 != 1)

780 
	`çl
("Got FALRUags with morehan one set\n");

781  
Ãw
 
Cache
<
FALRU
>(
this
);

782 } ià(
dyÇmic_ÿ¡
<
LRU
*>(
gs
)) {

783 ià(
numS‘s
 == 1)

784 
	`w¬n
("Consider using FALRUags for‡ fully‡ssociative cache\n");

785  
Ãw
 
Cache
<
LRU
>(
this
);

787 
	`çl
("No suitableags selected\n");

789 
	}
}

	@cache/base.hh

50 #iâdeà
__BASE_CACHE_HH__


51 
	#__BASE_CACHE_HH__


	)

53 
	~<®gÜ™hm
>

54 
	~<li¡
>

55 
	~<¡ršg
>

56 
	~<veùÜ
>

58 
	~"ba£/misc.hh
"

59 
	~"ba£/¡©i¡ics.hh
"

60 
	~"ba£/Œaû.hh
"

61 
	~"ba£/ty³s.hh
"

62 
	~"debug/Cache.hh
"

63 
	~"debug/CachePÜt.hh
"

64 
	~"mem/ÿche/mshr_queue.hh
"

65 
	~"mem/mem_objeù.hh
"

66 
	~"mem/·ck‘.hh
"

67 
	~"mem/qpÜt.hh
"

68 
	~"mem/»que¡.hh
"

69 
	~"·¿ms/Ba£Cache.hh
"

70 
	~"sim/ev’tq.hh
"

71 
	~"sim/fuÎ_sy¡em.hh
"

72 
	~"sim/sim_ex™.hh
"

73 
	~"sim/sy¡em.hh
"

75 
şass
 
	gMSHR
;

79 şas 
	cBa£Cache
 : 
public
 
MemObjeù


84 
	eMSHRQueueIndex
 {

85 
MSHRQueue_MSHRs
,

86 
	mMSHRQueue_Wr™eBufãr


89 
	gpublic
:

93 
	eBlockedCau£
 {

94 
Blocked_NoMSHRs
 = 
MSHRQueue_MSHRs
,

95 
	gBlocked_NoWBBufãrs
 = 
MSHRQueue_Wr™eBufãr
,

96 
	gBlocked_NoT¬g‘s
,

97 
	gNUM_BLOCKED_CAUSES


103 
	eReque¡Cau£
 {

104 
	gReque¡_MSHR
 = 
MSHRQueue_MSHRs
,

105 
	gReque¡_WB
 = 
MSHRQueue_Wr™eBufãr
,

106 
	gReque¡_PF
,

107 
	gNUM_REQUEST_CAUSES


110 
	g´Ùeùed
:

121 şas 
	cCacheMa¡”PÜt
 : 
public
 
QueuedMa¡”PÜt


124 
public
:

131 
»que¡Bus
(
Reque¡Cau£
 
ÿu£
, 
Tick
 
time
)

133 
DPRINTF
(
CachePÜt
, "As£¹šg bu »que¡ fÜ cau£ %d\n", 
ÿu£
);

134 
	gqueue
.
schedS’dEv’t
(
time
);

137 
	g´Ùeùed
:

139 
CacheMa¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
Ba£Cache
 *
_ÿche
,

140 
Ma¡”Pack‘Queue
 &
_queue
) :

141 
QueuedMa¡”PÜt
(
_Çme
, 
_ÿche
, 
_queue
)

149 
vœtu®
 
boŞ
 
isSnoİšg
(ècÚ¡ {  
	gŒue
; }

160 şas 
	cCacheSÏvePÜt
 : 
public
 
QueuedSÏvePÜt


163 
public
:

166 
£tBlocked
();

169 
ş—rBlocked
();

171 
	g´Ùeùed
:

173 
CacheSÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
Ba£Cache
 *
_ÿche
,

174 cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
);

177 
SÏvePack‘Queue
 
	gqueue
;

179 
boŞ
 
	gblocked
;

181 
boŞ
 
	gmu¡S’dR‘ry
;

183 
	g´iv©e
:

185 
Ev’tW¿µ”
<
SÏvePÜt
, &
	gSÏvePÜt
::
£ndR‘ry
> 
£ndR‘ryEv’t
;

189 
CacheSÏvePÜt
 *
	gıuSidePÜt
;

190 
CacheMa¡”PÜt
 *
	gmemSidePÜt
;

192 
	g´Ùeùed
:

195 
MSHRQueue
 
mshrQueue
;

198 
MSHRQueue
 
	gwr™eBufãr
;

200 
MSHR
 *
	$®loÿ‹BufãrIÁ”Çl
(
MSHRQueue
 *
mq
, 
Addr
 
addr
, 
size
,

201 
Pack‘PŒ
 
pkt
, 
Tick
 
time
, 
boŞ
 
»que¡Bus
)

203 
MSHR
 *
mshr
 = 
mq
->
	`®loÿ‹
(
addr
, 
size
, 
pkt
, 
time
, 
Üd”
++);

205 ià(
mq
->
	`isFuÎ
()) {

206 
	`£tBlocked
((
BlockedCau£
)
mq
->
šdex
);

209 ià(
»que¡Bus
) {

210 
	`»que¡MemSideBus
((
Reque¡Cau£
)
mq
->
šdex
, 
time
);

213  
mshr
;

214 
	}
}

216 
	$m¬kInS”viûIÁ”Çl
(
MSHR
 *
mshr
, 
Pack‘PŒ
 
pkt
)

218 
MSHRQueue
 *
mq
 = 
mshr
->
queue
;

219 
boŞ
 
wasFuÎ
 = 
mq
->
	`isFuÎ
();

220 
mq
->
	`m¬kInS”viû
(
mshr
, 
pkt
);

221 ià(
wasFuÎ
 && !
mq
->
	`isFuÎ
()) {

222 
	`ş—rBlocked
((
BlockedCau£
)
mq
->
šdex
);

224 
	}
}

229 
vœtu®
 
memWr™eback
() = 0;

237 
vœtu®
 
memInv®id©e
() = 0;

243 
vœtu®
 
boŞ
 
	$isDœty
() const = 0;

246 cÚ¡ 
blkSize
;

251 cÚ¡ 
Cyşes
 
h™L©’cy
;

259 cÚ¡ 
Cyşes
 
»¥Ú£L©’cy
;

262 cÚ¡ 
numT¬g‘
;

265 cÚ¡ 
boŞ
 
fÜw¬dSnoİs
;

270 cÚ¡ 
boŞ
 
isTİLev–
;

276 
ušt8_t
 
blocked
;

279 
ušt64_t
 
Üd”
;

282 
Cyşes
 
blockedCyşe
;

285 
MSHR
 *
noT¬g‘MSHR
;

288 
CouÁ”
 
missCouÁ
;

293 cÚ¡ 
AddrRªgeLi¡
 
addrRªges
;

295 
public
:

297 
Sy¡em
 *
sy¡em
;

306 
Sts
::
VeùÜ
 
h™s
[
MemCmd
::
NUM_MEM_CMDS
];

308 
Sts
::
FÜmuÏ
 
demªdH™s
;

310 
Sts
::
FÜmuÏ
 
ov”®lH™s
;

313 
Sts
::
VeùÜ
 
mis£s
[
MemCmd
::
NUM_MEM_CMDS
];

315 
Sts
::
FÜmuÏ
 
demªdMis£s
;

317 
Sts
::
FÜmuÏ
 
ov”®lMis£s
;

323 
Sts
::
VeùÜ
 
missL©’cy
[
MemCmd
::
NUM_MEM_CMDS
];

325 
Sts
::
FÜmuÏ
 
demªdMissL©’cy
;

327 
Sts
::
FÜmuÏ
 
ov”®lMissL©’cy
;

330 
Sts
::
FÜmuÏ
 
acûs£s
[
MemCmd
::
NUM_MEM_CMDS
];

332 
Sts
::
FÜmuÏ
 
demªdAcûs£s
;

334 
Sts
::
FÜmuÏ
 
ov”®lAcûs£s
;

337 
Sts
::
FÜmuÏ
 
missR©e
[
MemCmd
::
NUM_MEM_CMDS
];

339 
Sts
::
FÜmuÏ
 
demªdMissR©e
;

341 
Sts
::
FÜmuÏ
 
ov”®lMissR©e
;

344 
Sts
::
FÜmuÏ
 
avgMissL©’cy
[
MemCmd
::
NUM_MEM_CMDS
];

346 
Sts
::
FÜmuÏ
 
demªdAvgMissL©’cy
;

348 
Sts
::
FÜmuÏ
 
ov”®lAvgMissL©’cy
;

351 
Sts
::
VeùÜ
 
blocked_cyşes
;

353 
Sts
::
VeùÜ
 
blocked_ÿu£s
;

356 
Sts
::
FÜmuÏ
 
avg_blocked
;

359 
Sts
::
SÿÏr
 
ç¡Wr™es
;

362 
Sts
::
SÿÏr
 
ÿcheCİ›s
;

365 
Sts
::
VeùÜ
 
wr™ebacks
;

368 
Sts
::
VeùÜ
 
mshr_h™s
[
MemCmd
::
NUM_MEM_CMDS
];

370 
Sts
::
FÜmuÏ
 
demªdMshrH™s
;

372 
Sts
::
FÜmuÏ
 
ov”®lMshrH™s
;

375 
Sts
::
VeùÜ
 
mshr_mis£s
[
MemCmd
::
NUM_MEM_CMDS
];

377 
Sts
::
FÜmuÏ
 
demªdMshrMis£s
;

379 
Sts
::
FÜmuÏ
 
ov”®lMshrMis£s
;

382 
Sts
::
VeùÜ
 
mshr_unÿch—bË
[
MemCmd
::
NUM_MEM_CMDS
];

384 
Sts
::
FÜmuÏ
 
ov”®lMshrUnÿch—bË
;

387 
Sts
::
VeùÜ
 
mshr_miss_Ï‹ncy
[
MemCmd
::
NUM_MEM_CMDS
];

389 
Sts
::
FÜmuÏ
 
demªdMshrMissL©’cy
;

391 
Sts
::
FÜmuÏ
 
ov”®lMshrMissL©’cy
;

394 
Sts
::
VeùÜ
 
mshr_unÿch—bË_Ït
[
MemCmd
::
NUM_MEM_CMDS
];

396 
Sts
::
FÜmuÏ
 
ov”®lMshrUnÿch—bËL©’cy
;

400 
Sts
::
FÜmuÏ
 
mshrAcûs£s
[
MemCmd
::
NUM_MEM_CMDS
];

402 
Sts
::
FÜmuÏ
 
demªdMshrAcûs£s
;

404 
Sts
::
FÜmuÏ
 
ov”®lMshrAcûs£s
;

408 
Sts
::
FÜmuÏ
 
mshrMissR©e
[
MemCmd
::
NUM_MEM_CMDS
];

410 
Sts
::
FÜmuÏ
 
demªdMshrMissR©e
;

412 
Sts
::
FÜmuÏ
 
ov”®lMshrMissR©e
;

415 
Sts
::
FÜmuÏ
 
avgMshrMissL©’cy
[
MemCmd
::
NUM_MEM_CMDS
];

417 
Sts
::
FÜmuÏ
 
demªdAvgMshrMissL©’cy
;

419 
Sts
::
FÜmuÏ
 
ov”®lAvgMshrMissL©’cy
;

422 
Sts
::
FÜmuÏ
 
avgMshrUnÿch—bËL©’cy
[
MemCmd
::
NUM_MEM_CMDS
];

424 
Sts
::
FÜmuÏ
 
ov”®lAvgMshrUnÿch—bËL©’cy
;

427 
Sts
::
VeùÜ
 
mshr_ÿp_ev’ts
;

429 
Sts
::
VeùÜ
 
soá_´eãtch_mshr_fuÎ
;

431 
Sts
::
SÿÏr
 
mshr_no_®loÿ‹_mis£s
;

440 
vœtu®
 
	`»gSts
();

442 
public
:

443 
Ba£CacheP¬ams
 
	tP¬ams
;

444 
	`Ba£Cache
(cÚ¡ 
P¬ams
 *
p
);

445 ~
	$Ba£Cache
(è{
	}
}

447 
vœtu®
 
š™
();

449 
vœtu®
 
	gBa£Ma¡”PÜt
 &
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
,

450 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

451 
vœtu®
 
	gBa£SÏvePÜt
 &
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
,

452 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

459 
	$g‘BlockSize
() const

461  
blkSize
;

462 
	}
}

465 
Addr
 
	$blockAlign
(
Addr
 
addr
ècÚ¡ {  (add¸& ~(
	`Addr
(
blkSize
 - 1))); 
	}
}

468 cÚ¡ 
	gAddrRªgeLi¡
 &
	$g‘AddrRªges
(ècÚ¡ {  
addrRªges
; 
	}
}

470 
MSHR
 *
	$®loÿ‹MissBufãr
(
Pack‘PŒ
 
pkt
, 
Tick
 
time
, 
boŞ
 
»que¡Bus
)

472 
	`as£¹
(!
pkt
->
»q
->
	`isUnÿch—bË
());

473  
	`®loÿ‹BufãrIÁ”Çl
(&
mshrQueue
,

474 
	`blockAlign
(
pkt
->
	`g‘Addr
()), 
blkSize
,

475 
pkt
, 
time
, 
»que¡Bus
);

476 
	}
}

478 
MSHR
 *
	$®loÿ‹Wr™eBufãr
(
Pack‘PŒ
 
pkt
, 
Tick
 
time
, 
boŞ
 
»que¡Bus
)

480 
	`as£¹
(
pkt
->
	`isWr™e
(è&& !pkt->
	`isR—d
());

481  
	`®loÿ‹BufãrIÁ”Çl
(&
wr™eBufãr
,

482 
pkt
->
	`g‘Addr
(),…kt->
	`g‘Size
(),

483 
pkt
, 
time
, 
»que¡Bus
);

484 
	}
}

486 
MSHR
 *
	$®loÿ‹UnÿchedR—dBufãr
(
Pack‘PŒ
 
pkt
, 
Tick
 
time
, 
boŞ
 
»que¡Bus
)

488 
	`as£¹
(
pkt
->
»q
->
	`isUnÿch—bË
());

489 
	`as£¹
(
pkt
->
	`isR—d
());

490  
	`®loÿ‹BufãrIÁ”Çl
(&
mshrQueue
,

491 
pkt
->
	`g‘Addr
(),…kt->
	`g‘Size
(),

492 
pkt
, 
time
, 
»que¡Bus
);

493 
	}
}

498 
boŞ
 
	$isBlocked
() const

500  
blocked
 != 0;

501 
	}
}

508 
	$£tBlocked
(
BlockedCau£
 
ÿu£
)

510 
ušt8_t
 
æag
 = 1 << 
ÿu£
;

511 ià(
blocked
 == 0) {

512 
blocked_ÿu£s
[
ÿu£
]++;

513 
blockedCyşe
 = 
	`curCyşe
();

514 
ıuSidePÜt
->
	`£tBlocked
();

516 
blocked
 |ğ
æag
;

517 
	`DPRINTF
(
Cache
,"Blockšg fÜ cau£ %d, mask=%d\n", 
ÿu£
, 
blocked
);

518 
	}
}

527 
	$ş—rBlocked
(
BlockedCau£
 
ÿu£
)

529 
ušt8_t
 
æag
 = 1 << 
ÿu£
;

530 
blocked
 &ğ~
æag
;

531 
	`DPRINTF
(
Cache
,"Unblockšg fÜ cau£ %d, mask=%d\n", 
ÿu£
, 
blocked
);

532 ià(
blocked
 == 0) {

533 
blocked_cyşes
[
ÿu£
] +ğ
	`curCyşe
(è- 
blockedCyşe
;

534 
ıuSidePÜt
->
	`ş—rBlocked
();

536 
	}
}

543 
	$»que¡MemSideBus
(
Reque¡Cau£
 
ÿu£
, 
Tick
 
time
)

545 
memSidePÜt
->
	`»que¡Bus
(
ÿu£
, 
time
);

546 
	}
}

552 
	$d—s£¹MemSideBusReque¡
(
Reque¡Cau£
 
ÿu£
)

559 
	}
}

561 
vœtu®
 
d¿š
(
D¿šMªag”
 *
dm
);

563 
vœtu®
 
boŞ
 
	$šCache
(
Addr
 
addr
) const = 0;

565 
vœtu®
 
boŞ
 
	$šMissQueue
(
Addr
 
addr
) const = 0;

567 
	$šcMissCouÁ
(
Pack‘PŒ
 
pkt
)

569 
	`as£¹
(
pkt
->
»q
->
	`ma¡”Id
(è< 
sy¡em
->
	`maxMa¡”s
());

570 
mis£s
[
pkt
->
	`cmdToIndex
()][pkt->
»q
->
	`ma¡”Id
()]++;

572 ià(
missCouÁ
) {

573 --
missCouÁ
;

574 ià(
missCouÁ
 == 0)

575 
	`ex™SimLoİ
("A cache„eachedhe maximum miss count");

577 
	}
}

578 
	$šcH™CouÁ
(
Pack‘PŒ
 
pkt
)

580 
	`as£¹
(
pkt
->
»q
->
	`ma¡”Id
(è< 
sy¡em
->
	`maxMa¡”s
());

581 
h™s
[
pkt
->
	`cmdToIndex
()][pkt->
»q
->
	`ma¡”Id
()]++;

583 
	}
}

	@cache/blk.cc

29 
	~"ba£/ırštf.hh
"

30 
	~"mem/ÿche/blk.hh
"

33 
	gCacheBlkPrštW¿µ”
::
´št
(
¡d
::
o¡»am
 &
os
, 
v”bos™y
,

34 cÚ¡ 
¡d
::
¡ršg
 &
´efix
) const

36 
cırštf
(
os
, "%sblk %c%c%c\n", 
´efix
,

37 
blk
->
isV®id
() ? 'V' : '-',

38 
blk
->
isWr™abË
() ? 'E' : '-',

39 
blk
->
isDœty
() ? 'M' : '-');

	@cache/blk.hh

48 #iâdeà
__CACHE_BLK_HH__


49 
	#__CACHE_BLK_HH__


	)

51 
	~<li¡
>

53 
	~"ba£/´šbË.hh
"

54 
	~"mem/·ck‘.hh
"

55 
	~"mem/»que¡.hh
"

56 
	~"sim/cÜe.hh
"

61 
	eCacheBlkStusB™s
 {

63 
	mBlkV®id
 = 0x01,

65 
	mBlkWr™abË
 = 0x02,

67 
	mBlkR—dabË
 = 0x04,

69 
	mBlkDœty
 = 0x08,

71 
	mBlkReã»nûd
 = 0x10,

73 
	mBlkHWP»ãtched
 = 0x20

80 şas 
	cCacheBlk


82 
	mpublic
:

84 
asid
;

86 
Addr
 
	mg
;

94 
ušt8_t
 *
	md©a
;

96 
	msize
;

99 
	tS‹
;

102 
S‹
 
	m¡©us
;

105 
Tick
 
	mwh’R—dy
;

111 
	m£t
;

114 
boŞ
 
	misTouched
;

117 
	m»fCouÁ
;

120 
	m¤cMa¡”Id
;

122 
	m´Ùeùed
:

127 şas 
	cLock
 {

128 
public
:

129 
cÚ‹xtId
;

130 
Addr
 
	mlowAddr
;

131 
Addr
 
	mhighAddr
;

134 
boŞ
 
m©chesCÚ‹xt
(
Reque¡
 *
»q
)

136 
Addr
 
	m»q_low
 = 
»q
->
g‘Paddr
();

137 
Addr
 
	m»q_high
 = 
»q_low
 + 
»q
->
g‘Size
() -1;

138  (
	mcÚ‹xtId
 =ğ
»q
->
cÚ‹xtId
()) &&

139 (
»q_low
 >ğ
lowAddr
è&& (
»q_high
 <ğ
highAddr
);

142 
boŞ
 
ov”Ïµšg
(
Reque¡
 *
»q
)

144 
Addr
 
	m»q_low
 = 
»q
->
g‘Paddr
();

145 
Addr
 
	m»q_high
 = 
»q_low
 + 
»q
->
g‘Size
() - 1;

147  (
	m»q_low
 <ğ
highAddr
è&& (
»q_high
 >ğ
lowAddr
);

150 
Lock
(
Reque¡
 *
»q
)

151 : 
cÚ‹xtId
(
»q
->contextId()),

152 
lowAddr
(
»q
->
g‘Paddr
()),

153 
highAddr
(
lowAddr
 + 
»q
->
g‘Size
() - 1)

160 
	g¡d
::
li¡
<
Lock
> 
lockLi¡
;

162 
	gpublic
:

164 
	$CacheBlk
()

165 : 
	`asid
(-1), 
	`g
(0), 
	`d©a
(0è,
	`size
(0), 
	`¡©us
(0), 
	`wh’R—dy
(0),

166 
	`£t
(-1), 
	`isTouched
(
çl£
), 
	`»fCouÁ
(0),

167 
	`¤cMa¡”Id
(
Reque¡
::
švldMa¡”Id
)

168 {
	}
}

175 cÚ¡ 
CacheBlk
& 
İ”©Ü
=(cÚ¡ CacheBlk& 
rhs
)

177 
asid
 = 
rhs
.asid;

178 
	gg
 = 
rhs
.
g
;

179 
	gd©a
 = 
rhs
.
d©a
;

180 
	gsize
 = 
rhs
.
size
;

181 
	g¡©us
 = 
rhs
.
¡©us
;

182 
	gwh’R—dy
 = 
rhs
.
wh’R—dy
;

183 
	g£t
 = 
rhs
.
£t
;

184 
	g»fCouÁ
 = 
rhs
.
»fCouÁ
;

185  *
	gthis
;

192 
boŞ
 
	$isWr™abË
() const

194 cÚ¡ 
S‹
 
Ãeded_b™s
 = 
BlkWr™abË
 | 
BlkV®id
;

195  (
¡©us
 & 
Ãeded_b™s
) ==‚eeded_bits;

196 
	}
}

204 
boŞ
 
	$isR—dabË
() const

206 cÚ¡ 
S‹
 
Ãeded_b™s
 = 
BlkR—dabË
 | 
BlkV®id
;

207  (
¡©us
 & 
Ãeded_b™s
) ==‚eeded_bits;

208 
	}
}

214 
boŞ
 
	$isV®id
() const

216  (
¡©us
 & 
BlkV®id
) != 0;

217 
	}
}

222 
	$šv®id©e
()

224 
¡©us
 = 0;

225 
isTouched
 = 
çl£
;

226 
	`ş—rLßdLocks
();

227 
	}
}

233 
boŞ
 
	$isDœty
() const

235  (
¡©us
 & 
BlkDœty
) != 0;

236 
	}
}

242 
boŞ
 
	$isReã»nûd
() const

244  (
¡©us
 & 
BlkReã»nûd
) != 0;

245 
	}
}

252 
boŞ
 
	$wasP»ãtched
() const

254  (
¡©us
 & 
BlkHWP»ãtched
) != 0;

255 
	}
}

263 
	$ŒackLßdLocked
(
Pack‘PŒ
 
pkt
)

265 
	`as£¹
(
pkt
->
	`isLLSC
());

266 
lockLi¡
.
	`push_äÚt
(
	`Lock
(
pkt
->
»q
));

267 
	}
}

273 
	$ş—rLßdLocks
(
Reque¡
 *
»q
 = 
NULL
)

275 ià(!
»q
) {

277 
lockLi¡
.
	`ş—r
();

280 
¡d
::
li¡
<
Lock
>::
™”©Ü
 
lock_™r
 = 
lockLi¡
.
	`begš
();

281 
lock_™r
 !ğ
lockLi¡
.
	`’d
()) {

282 ià(
lock_™r
->
	`ov”Ïµšg
(
»q
)) {

283 
lock_™r
 = 
lockLi¡
.
	`”a£
(lock_itr);

285 ++
lock_™r
;

289 
	}
}

297 
	g¡d
::
¡ršg
 
	$´št
() const

312 
¡©e
 = 
	`isWr™abË
(è<< 2 | 
	`isDœty
(è<< 1 | 
	`isV®id
();

313 
s
 = '?';

314 
¡©e
) {

315 0b111: 
s
 = 'M'; ;

316 0b011: 
s
 = 'O'; ;

317 0b101: 
s
 = 'E'; ;

318 0b001: 
s
 = 'S'; ;

319 0b000: 
s
 = 'I'; ;

320 : 
s
 = 'T'; ;

322  
	`c¥rštf
("state: %x (%c) valid: %d writable: %d„eadable: %d "

323 "dœty: %dag: %x d©a: %x", 
¡©us
, 
s
, 
	`isV®id
(),

324 
	`isWr™abË
(), 
	`isR—dabË
(), 
	`isDœty
(), 
g
, *
d©a
);

325 
	}
}

332 
boŞ
 
	$checkWr™e
(
Pack‘PŒ
 
pkt
)

334 
Reque¡
 *
»q
 = 
pkt
->req;

335 ià(
pkt
->
	`isLLSC
()) {

338 
boŞ
 
sucûss
 = 
çl£
;

340 
¡d
::
li¡
<
Lock
>::
™”©Ü
 
i
 = 
lockLi¡
.
	`begš
();

341 
i
 !ğ
lockLi¡
.
	`’d
(); ++i)

343 ià(
i
->
	`m©chesCÚ‹xt
(
»q
)) {

347 
sucûss
 = 
Œue
;

352 
»q
->
	`£tExŒaD©a
(
sucûss
 ? 1 : 0);

353 
	`ş—rLßdLocks
(
»q
);

354  
sucûss
;

358 
	`ş—rLßdLocks
(
»q
);

359  
Œue
;

361 
	}
}

370 şas 
	cCacheBlkPrštW¿µ”
 : 
public
 
PršbË


372 
CacheBlk
 *
blk
;

373 
	mpublic
:

374 
	$CacheBlkPrštW¿µ”
(
CacheBlk
 *
_blk
è: 
	$blk
(
_blk
) {}

375 
vœtu®
 ~
	$CacheBlkPrštW¿µ”
(è{
	}
}

376 
´št
(
¡d
::
o¡»am
 &
o
, 
v”bos™y
 = 0,

377 cÚ¡ 
¡d
::
¡ršg
 &
´efix
 = "") const;

388 
	g‹m¶©e
 <
ty³Çme
 
	gT
,y³Çm
	gBlkTy³
>

389 şas 
	cCacheBlkVis™ÜW¿µ”


391 
	mpublic
:

392 
boŞ
 (
	tT
::*
	tvis™ÜPŒ
)(
	tBlkTy³
 &
	tblk
);

394 
	$CacheBlkVis™ÜW¿µ”
(
T
 &
_obj
, 
vis™ÜPŒ
 
_vis™Ü
)

395 : 
	`obj
(
_obj
), 
	$vis™Ü
(
_vis™Ü
) {}

397 
boŞ
 
	$İ”©Ü
()(
BlkTy³
 &
blk
) {

398  (
obj
.*
vis™Ü
)(
blk
);

399 
	}
}

401 
	g´iv©e
:

402 
T
 &
obj
;

403 
vis™ÜPŒ
 
	gvis™Ü
;

413 
	g‹m¶©e
 <
ty³Çme
 
	gBlkTy³
>

414 şas 
	cCacheBlkIsDœtyVis™Ü


416 
	mpublic
:

417 
	$CacheBlkIsDœtyVis™Ü
()

418 : 
	$_isDœty
(
çl£
) {}

420 
boŞ
 
	$İ”©Ü
()(
BlkTy³
 &
blk
) {

421 ià(
blk
.
	`isDœty
()) {

422 
_isDœty
 = 
Œue
;

423  
çl£
;

425  
Œue
;

427 
	}
}

434 
boŞ
 
	$isDœty
(ècÚ¡ {  
_isDœty
; 
	}
};

436 
	g´iv©e
:

437 
boŞ
 
_isDœty
;

	@cache/cache.cc

39 
	~"mem/ÿche/gs/ç_Ìu.hh
"

40 
	~"mem/ÿche/gs/Ìu.hh
"

41 
	~"mem/ÿche/ÿche_im¶.hh
"

44 #iâdeà
DOXYGEN_SHOULD_SKIP_THIS


46 
‹m¶©e
 
şass
 
	gCache
<
	gFALRU
>;

47 
‹m¶©e
 
şass
 
	gCache
<
	gLRU
>;

	@cache/cache.hh

52 #iâdeà
__CACHE_HH__


53 
	#__CACHE_HH__


	)

55 
	~"ba£/misc.hh
"

56 
	~"mem/ÿche/ba£.hh
"

57 
	~"mem/ÿche/blk.hh
"

58 
	~"mem/ÿche/mshr.hh
"

59 
	~"sim/ev’tq.hh
"

62 
şass
 
	gBa£P»ãtch”
;

69 
	g‹m¶©e
 <
şass
 
	gTagStÜe
>

70 şas 
	cCache
 : 
public
 
Ba£Cache


72 
public
:

74 
ty³Çme
 
	tTagStÜe
::
	tBlkTy³
 BlkType;

76 
ty³Çme
 
	tTagStÜe
::
	tBlkLi¡
 BlkList;

78 
	m´Ùeùed
:

79 
CacheBlkVis™ÜW¿µ”
<
	tCache
<
	tTagStÜe
>, 
	tBlkTy³
> 
	tW¿µedBlkVis™Ü
;

85 şas 
	cCpuSidePÜt
 : 
public
 
CacheSÏvePÜt


87 
´iv©e
:

90 
Cache
<
TagStÜe
> *
ÿche
;

92 
	m´Ùeùed
:

94 
vœtu®
 
boŞ
 
»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
);

96 
vœtu®
 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

98 
vœtu®
 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

100 
vœtu®
 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

102 
vœtu®
 
AddrRªgeLi¡
 
g‘AddrRªges
() const;

104 
	mpublic
:

106 
CpuSidePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
Cache
<
TagStÜe
> *
_ÿche
,

107 cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
);

117 şas 
	cMemSidePack‘Queue
 : 
public
 
Ma¡”Pack‘Queue


120 
´Ùeùed
:

122 
Cache
<
TagStÜe
> &
ÿche
;

124 
	gpublic
:

126 
MemSidePack‘Queue
(
Cache
<
TagStÜe
> &
ÿche
, 
Ma¡”PÜt
 &
pÜt
,

127 cÚ¡ 
¡d
::
¡ršg
 &
Ïb–
) :

128 
Ma¡”Pack‘Queue
(
ÿche
, 
pÜt
, 
Ïb–
), cache(cache) { }

135 
vœtu®
 
£ndDeã¼edPack‘
();

143 şas 
	cMemSidePÜt
 : 
public
 
CacheMa¡”PÜt


145 
´iv©e
:

148 
MemSidePack‘Queue
 
_queue
;

151 
	gCache
<
	gTagStÜe
> *
	gÿche
;

153 
	g´Ùeùed
:

155 
vœtu®
 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
);

157 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

159 
vœtu®
 
Tick
 
»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
);

161 
vœtu®
 
»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
);

163 
	gpublic
:

165 
MemSidePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
Cache
<
TagStÜe
> *
_ÿche
,

166 cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
);

170 
TagStÜe
 *
	ggs
;

173 
Ba£P»ãtch”
 *
	g´eãtch”
;

176 
BlkTy³
 *
	g‹mpBlock
;

181 cÚ¡ 
boŞ
 
	gdoFa¡Wr™es
;

186 cÚ¡ 
boŞ
 
	g´eãtchOnAcûss
;

193 
	g¡d
::
veùÜ
<
Pack‘PŒ
> 
³ndšgD–‘e
;

203 
boŞ
 
acûss
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *&
blk
,

204 
Cyşes
 &
Ït
, 
Pack‘Li¡
 &
wr™ebacks
);

209 
cmpAndSw­
(
BlkTy³
 *
blk
, 
Pack‘PŒ
 
pkt
);

217 
BlkTy³
 *
®loÿ‹Block
(
Addr
 
addr
, 
Pack‘Li¡
 &
wr™ebacks
);

228 
BlkTy³
 *
hªdËFl
(
Pack‘PŒ
 
pkt
, BlkTy³ *
blk
,

229 
Pack‘Li¡
 &
wr™ebacks
);

237 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

243 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

249 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
);

255 
»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
);

262 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

270 
Tick
 
»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
);

277 
funùiÚ®Acûss
(
Pack‘PŒ
 
pkt
, 
boŞ
 
äomCpuSide
);

279 
§tisfyCpuSideReque¡
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *
blk
,

280 
boŞ
 
deã¼ed_»¥Ú£
 = 
çl£
,

281 
boŞ
 
³ndšg_downg¿de
 = 
çl£
);

282 
boŞ
 
§tisfyMSHR
(
MSHR
 *
mshr
, 
Pack‘PŒ
 
pkt
, 
BlkTy³
 *
blk
);

284 
doTimšgSuµlyRe¥Ú£
(
Pack‘PŒ
 
»q_pkt
, 
ušt8_t
 *
blk_d©a
,

285 
boŞ
 
®»ady_cİ›d
, boŞ 
³ndšg_šv®
);

292 
hªdËSnoİ
(
Pack‘PŒ
 
±k
, 
BlkTy³
 *
blk
,

293 
boŞ
 
is_timšg
, boŞ 
is_deã¼ed
, boŞ 
³ndšg_šv®
);

300 
Pack‘PŒ
 
wr™ebackBlk
(
BlkTy³
 *
blk
);

303 
memWr™eback
();

304 
memInv®id©e
();

305 
boŞ
 
	$isDœty
() const;

313 
boŞ
 
	`wr™ebackVis™Ü
(
BlkTy³
 &
blk
);

321 
boŞ
 
	`šv®id©eVis™Ü
(
BlkTy³
 &
blk
);

333 
	`unÿch—bËFlush
(
Pack‘PŒ
 
pkt
);

340 
	`squash
(
th»adNum
);

353 
Pack‘PŒ
 
	$g‘BusPack‘
(
Pack‘PŒ
 
ıu_pkt
, 
BlkTy³
 *
blk
,

354 
boŞ
 
ÃedsExşusive
) const;

362 
MSHR
 *
	`g‘NextMSHR
();

369 
Pack‘PŒ
 
	`g‘TimšgPack‘
();

377 
	`m¬kInS”viû
(
MSHR
 *
mshr
, 
Pack‘PŒ
 
pkt
 = 0);

382 
boŞ
 
	$out¡ªdšgMis£s
() const

384  
mshrQueue
.
®loÿ‹d
 != 0;

385 
	}
}

387 
CacheBlk
 *
	$fšdBlock
(
Addr
 
addr
) const {

388  
gs
->
	`fšdBlock
(
addr
);

389 
	}
}

391 
boŞ
 
	$šCache
(
Addr
 
addr
) const {

392  (
gs
->
	`fšdBlock
(
addr
) != 0);

393 
	}
}

395 
boŞ
 
	$šMissQueue
(
Addr
 
addr
) const {

396  (
mshrQueue
.
	`fšdM©ch
(
addr
) != 0);

397 
	}
}

402 
Tick
 
	$ÃxtMSHRR—dyTime
() const;

404 
public
:

406 
	`Cache
(cÚ¡ 
P¬ams
 *
p
);

409 
vœtu®
 ~
	`Cache
();

411 
	`»gSts
();

416 
vœtu®
 
	`£rŸlize
(
¡d
::
o¡»am
 &
os
);

417 
	`un£rŸlize
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
);

418 
	}
};

	@cache/cache_impl.hh

49 #iâdeà
__MEM_CACHE_CACHE_IMPL_HH__


50 
	#__MEM_CACHE_CACHE_IMPL_HH__


	)

57 
	~"ba£/misc.hh
"

58 
	~"ba£/ty³s.hh
"

59 
	~"debug/Cache.hh
"

60 
	~"debug/CachePÜt.hh
"

61 
	~"debug/CacheTags.hh
"

62 
	~"mem/ÿche/´eãtch/ba£.hh
"

63 
	~"mem/ÿche/blk.hh
"

64 
	~"mem/ÿche/ÿche.hh
"

65 
	~"mem/ÿche/mshr.hh
"

66 
	~"sim/sim_ex™.hh
"

68 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

69 
	gCache
<
	gTagStÜe
>::
	$Cache
(cÚ¡ 
P¬ams
 *
p
)

70 : 
	`Ba£Cache
(
p
),

71 
	`gs
(
dyÇmic_ÿ¡
<
TagStÜe
*>(
p
->
gs
)),

72 
	`´eãtch”
(
p
->
´eãtch”
),

73 
	`doFa¡Wr™es
(
Œue
),

74 
	`´eãtchOnAcûss
(
p
->
´eãtch_Ú_acûss
)

76 
‹mpBlock
 = 
Ãw
 
	`BlkTy³
();

77 
‹mpBlock
->
d©a
 = 
Ãw
 
ušt8_t
[
blkSize
];

79 
ıuSidePÜt
 = 
Ãw
 
	`CpuSidePÜt
(
p
->
Çme
 + ".ıu_side", 
this
,

81 
memSidePÜt
 = 
Ãw
 
	`MemSidePÜt
(
p
->
Çme
 + ".mem_side", 
this
,

84 
gs
->
	`£tCache
(
this
);

85 ià(
´eãtch”
)

86 
´eãtch”
->
	`£tCache
(
this
);

87 
	}
}

89 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

90 
	gCache
<
	gTagStÜe
>::~
	$Cache
()

92 
d–‘e
 [] 
‹mpBlock
->
d©a
;

93 
d–‘e
 
‹mpBlock
;

95 
d–‘e
 
ıuSidePÜt
;

96 
d–‘e
 
memSidePÜt
;

97 
	}
}

99 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

101 
	gCache
<
	gTagStÜe
>::
	$»gSts
()

103 
Ba£Cache
::
	`»gSts
();

104 
	}
}

106 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

108 
	gCache
<
	gTagStÜe
>::
	$cmpAndSw­
(
BlkTy³
 *
blk
, 
Pack‘PŒ
 
pkt
)

110 
ušt64_t
 
ov”wr™e_v®
;

111 
boŞ
 
ov”wr™e_mem
;

112 
ušt64_t
 
cÚd™iÚ_v®64
;

113 
ušt32_t
 
cÚd™iÚ_v®32
;

115 
off£t
 = 
gs
->
	`exŒaùBlkOff£t
(
pkt
->
	`g‘Addr
());

116 
ušt8_t
 *
blk_d©a
 = 
blk
->
d©a
 + 
off£t
;

118 
	`as£¹
((
ušt64_t
è>ğ
pkt
->
	`g‘Size
());

120 
ov”wr™e_mem
 = 
Œue
;

123 
pkt
->
	`wr™eD©a
((
ušt8_t
 *)&
ov”wr™e_v®
);

124 
pkt
->
	`£tD©a
(
blk_d©a
);

126 ià(
pkt
->
»q
->
	`isCÚdSw­
()) {

127 ià(
pkt
->
	`g‘Size
(è=ğ(
ušt64_t
)) {

128 
cÚd™iÚ_v®64
 = 
pkt
->
»q
->
	`g‘ExŒaD©a
();

129 
ov”wr™e_mem
 = !
¡d
::
	`memcmp
(&
cÚd™iÚ_v®64
, 
blk_d©a
,

130 (
ušt64_t
));

131 } ià(
pkt
->
	`g‘Size
(è=ğ(
ušt32_t
)) {

132 
cÚd™iÚ_v®32
 = (
ušt32_t
)
pkt
->
»q
->
	`g‘ExŒaD©a
();

133 
ov”wr™e_mem
 = !
¡d
::
	`memcmp
(&
cÚd™iÚ_v®32
, 
blk_d©a
,

134 (
ušt32_t
));

136 
	`·nic
("Invalid size for conditional„ead/write\n");

139 ià(
ov”wr™e_mem
) {

140 
¡d
::
	`memıy
(
blk_d©a
, &
ov”wr™e_v®
, 
pkt
->
	`g‘Size
());

141 
blk
->
¡©us
 |ğ
BlkDœty
;

143 
	}
}

146 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

148 
	gCache
<
	gTagStÜe
>::
	$§tisfyCpuSideReque¡
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *
blk
,

149 
boŞ
 
deã¼ed_»¥Ú£
,

150 
boŞ
 
³ndšg_downg¿de
)

152 
	`as£¹
(
blk
 && blk->
	`isV®id
());

160 
	`as£¹
(
pkt
->
	`g‘Off£t
(
blkSize
è+…kt->
	`g‘Size
() <= blkSize);

164 ià(
pkt
->
cmd
 =ğ
MemCmd
::
Sw­Req
) {

165 
	`cmpAndSw­
(
blk
, 
pkt
);

166 } ià(
pkt
->
	`isWr™e
()) {

167 ià(
blk
->
	`checkWr™e
(
pkt
)) {

168 
pkt
->
	`wr™eD©aToBlock
(
blk
->
d©a
, 
blkSize
);

169 
blk
->
¡©us
 |ğ
BlkDœty
;

171 } ià(
pkt
->
	`isR—d
()) {

172 ià(
pkt
->
	`isLLSC
()) {

173 
blk
->
	`ŒackLßdLocked
(
pkt
);

175 
pkt
->
	`£tD©aFromBlock
(
blk
->
d©a
, 
blkSize
);

176 ià(
pkt
->
	`g‘Size
(è=ğ
blkSize
) {

179 ià(
pkt
->
	`ÃedsExşusive
()) {

182 ià(
blk
->
	`isDœty
()) {

183 
pkt
->
	`as£¹MemInhib™
();

186 
	`as£¹
(
blk
 !ğ
‹mpBlock
);

187 
gs
->
	`šv®id©e
(
blk
);

188 
blk
->
	`šv®id©e
();

189 } ià(
blk
->
	`isWr™abË
(è&& !
³ndšg_downg¿de


190 && !
pkt
->
	`sh¬edAs£¹ed
(è&& !pkt->
»q
->
	`isIn¡F‘ch
()) {

201 ià(
blk
->
	`isDœty
()) {

203 ià(!
deã¼ed_»¥Ú£
 && !
isTİLev–
) {

207 
pkt
->
	`as£¹MemInhib™
();

208 
blk
->
¡©us
 &ğ~
BlkDœty
;

215 
pkt
->
	`as£¹Sh¬ed
();

220 
pkt
->
	`as£¹Sh¬ed
();

227 
	`as£¹
(
pkt
->
	`isUpg¿de
());

228 
	`as£¹
(
blk
 !ğ
‹mpBlock
);

229 
gs
->
	`šv®id©e
(
blk
);

230 
blk
->
	`šv®id©e
();

232 
	}
}

242 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

244 
	gCache
<
	gTagStÜe
>::
	$m¬kInS”viû
(
MSHR
 *
mshr
, 
Pack‘PŒ
 
pkt
)

246 
	`m¬kInS”viûIÁ”Çl
(
mshr
, 
pkt
);

248 ià(
mshr
->
Üigš®Cmd
 =ğ
MemCmd
::
H¬dPFReq
) {

249 
	`DPRINTF
(
HWP»ãtch
, "%s:Marking‡ HW_PF in service\n",

250 
	`Çme
());

252 ià(!
´eãtch”
->
	`haveP’dšg
())

254 
	`d—s£¹MemSideBusReque¡
(
Reque¡_PF
);

258 
	}
}

261 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

263 
	gCache
<
	gTagStÜe
>::
	$squash
(
th»adNum
)

265 
boŞ
 
unblock
 = 
çl£
;

266 
BlockedCau£
 
ÿu£
 = 
NUM_BLOCKED_CAUSES
;

268 ià(
noT¬g‘MSHR
 &&‚oT¬g‘MSHR->
th»adNum
 ==hreadNum) {

269 
noT¬g‘MSHR
 = 
NULL
;

270 
unblock
 = 
Œue
;

271 
ÿu£
 = 
Blocked_NoT¬g‘s
;

273 ià(
mshrQueue
.
	`isFuÎ
()) {

274 
unblock
 = 
Œue
;

275 
ÿu£
 = 
Blocked_NoMSHRs
;

277 
mshrQueue
.
	`squash
(
th»adNum
);

278 ià(
unblock
 && !
mshrQueue
.
	`isFuÎ
()) {

279 
	`ş—rBlocked
(
ÿu£
);

281 
	}
}

289 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

290 
boŞ


291 
	gCache
<
	gTagStÜe
>::
	$acûss
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *&
blk
,

292 
Cyşes
 &
Ït
, 
Pack‘Li¡
 &
wr™ebacks
)

294 
	`DPRINTF
(
Cache
, "% fÜ % add»s %x siz%d\n", 
__func__
,

295 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

296 ià(
pkt
->
»q
->
	`isUnÿch—bË
()) {

297 
	`unÿch—bËFlush
(
pkt
);

298 
blk
 = 
NULL
;

299 
Ït
 = 
h™L©’cy
;

300  
çl£
;

303 
id
 = 
pkt
->
»q
->
	`hasCÚ‹xtId
(è?…kt->»q->
	`cÚ‹xtId
() : -1;

304 
blk
 = 
gs
->
	`acûssBlock
(
pkt
->
	`g‘Addr
(), 
Ït
, 
id
);

306 
	`DPRINTF
(
Cache
, "%s% %x % %s\n", 
pkt
->
	`cmdSŒšg
(),

307 
pkt
->
»q
->
	`isIn¡F‘ch
() ? " (ifetch)" : "",

308 
pkt
->
	`g‘Addr
(), 
blk
 ? "h™" : "miss", blk ? blk->
	`´št
() : "");

310 ià(
blk
 !ğ
NULL
) {

312 ià(
pkt
->
	`ÃedsExşusive
(è? 
blk
->
	`isWr™abË
(è: blk->
	`isR—dabË
()) {

314 
	`šcH™CouÁ
(
pkt
);

315 
	`§tisfyCpuSideReque¡
(
pkt
, 
blk
);

316  
Œue
;

326 ià(
pkt
->
cmd
 =ğ
MemCmd
::
Wr™eback
) {

327 
	`as£¹
(
blkSize
 =ğ
pkt
->
	`g‘Size
());

328 ià(
blk
 =ğ
NULL
) {

330 
blk
 = 
	`®loÿ‹Block
(
pkt
->
	`g‘Addr
(), 
wr™ebacks
);

331 ià(
blk
 =ğ
NULL
) {

334 
	`šcMissCouÁ
(
pkt
);

335  
çl£
;

337 
gs
->
	`š£¹Block
(
pkt
, 
blk
);

338 
blk
->
¡©us
 = 
BlkV®id
 | 
BlkR—dabË
;

340 
¡d
::
	`memıy
(
blk
->
d©a
, 
pkt
->
g‘PŒ
<
ušt8_t
>(), 
blkSize
);

341 
blk
->
¡©us
 |ğ
BlkDœty
;

342 ià(
pkt
->
	`isSuµlyExşusive
()) {

343 
blk
->
¡©us
 |ğ
BlkWr™abË
;

346 
	`as£¹
(!
pkt
->
	`ÃedsRe¥Ú£
());

347 
	`DPRINTF
(
Cache
, "% Ãw s‹ i %s\n", 
__func__
, 
blk
->
	`´št
());

348 
	`šcH™CouÁ
(
pkt
);

349  
Œue
;

352 
	`šcMissCouÁ
(
pkt
);

354 ià(
blk
 =ğ
NULL
 && 
pkt
->
	`isLLSC
(è&&…kt->
	`isWr™e
()) {

356 
pkt
->
»q
->
	`£tExŒaD©a
(0);

357  
Œue
;

360  
çl£
;

361 
	}
}

364 şas 
	cFÜw¬dRe¥Ú£RecÜd
 : 
public
 
Pack‘
::
S’d”S‹


366 
public
:

368 
PÜtID
 
´evSrc
;

370 
	$FÜw¬dRe¥Ú£RecÜd
(
PÜtID
 
´ev_¤c
è: 
	$´evSrc
(
´ev_¤c
)

372 
	}
};

374 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

376 
	gCache
<
	gTagStÜe
>::
	$»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

378 
	`DPRINTF
(
Cache
, "% fÜ % add»s %x siz%d\n", 
__func__
,

379 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

380 
Tick
 
time
 = 
	`şockEdge
(
h™L©’cy
);

382 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

385 
FÜw¬dRe¥Ú£RecÜd
 *
»c
 =

386 
dyÇmic_ÿ¡
<
FÜw¬dRe¥Ú£RecÜd
 *>(
pkt
->
£nd”S‹
);

387 
	`as£¹
(!
sy¡em
->
	`by·ssCaches
());

389 ià(
»c
 =ğ
NULL
) {

390 
	`as£¹
(
pkt
->
cmd
 =ğ
MemCmd
::
H¬dPFRe¥
);

393 
	`DPRINTF
(
Cache
, "Got…refetch„esponse from‡bove for‡ddr %#x\n",

394 
pkt
->
	`g‘Addr
());

395 
	`»cvTimšgRe¥
(
pkt
);

399 
pkt
->
	`pİS’d”S‹
();

400 
pkt
->
	`£tDe¡
(
»c
->
´evSrc
);

401 
d–‘e
 
»c
;

403 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

404 
memSidePÜt
->
	`schedTimšgSnoİRe¥
(
pkt
, 
time
);

405 
	}
}

407 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

408 
boŞ


409 
	gCache
<
	gTagStÜe
>::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

411 
	`DPRINTF
(
CacheTags
, "% gs: %s\n", 
__func__
, 
gs
->
	`´št
());

418 
x
 = 0; x < 
³ndšgD–‘e
.
	`size
(); x++)

419 
d–‘e
 
³ndšgD–‘e
[
x
];

420 
³ndšgD–‘e
.
	`ş—r
();

423 
Tick
 
time
 = 
	`şockEdge
(
h™L©’cy
);

425 
	`as£¹
(
pkt
->
	`isReque¡
());

428 ià(
sy¡em
->
	`by·ssCaches
()) {

429 
memSidePÜt
->
	`£ndTimšgReq
(
pkt
);

430  
Œue
;

433 ià(
pkt
->
	`memInhib™As£¹ed
()) {

434 
	`DPRINTF
(
Cache
, "mem inhibited on 0x%x:‚ot„esponding\n",

435 
pkt
->
	`g‘Addr
());

436 
	`as£¹
(!
pkt
->
»q
->
	`isUnÿch—bË
());

441 ià(
pkt
->
	`ÃedsExşusive
(è&& !pkt->
	`isSuµlyExşusive
()) {

442 
Pack‘
 *
¢oİPkt
 = 
Ãw
 
	`Pack‘
(
pkt
, 
Œue
);

445 
¢oİPkt
->
busFœ¡WÜdD–ay
 = snoİPkt->
busLa¡WÜdD–ay
 = 0;

446 
¢oİPkt
->
	`£tEx´essSnoİ
();

447 
¢oİPkt
->
	`as£¹MemInhib™
();

448 
memSidePÜt
->
	`£ndTimšgReq
(
¢oİPkt
);

457 
³ndšgD–‘e
.
	`push_back
(
pkt
);

458  
Œue
;

461 ià(
pkt
->
»q
->
	`isUnÿch—bË
()) {

462 
	`unÿch—bËFlush
(
pkt
);

465 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

468 ià(
pkt
->
	`isWr™e
(è&& !pkt->
	`isR—d
()) {

469 
	`®loÿ‹Wr™eBufãr
(
pkt
, 
time
, 
Œue
);

471 
	`®loÿ‹UnÿchedR—dBufãr
(
pkt
, 
time
, 
Œue
);

473 
	`as£¹
(
pkt
->
	`ÃedsRe¥Ú£
());

474  
Œue
;

477 
Cyşes
 
Ït
 = 
h™L©’cy
;

478 
BlkTy³
 *
blk
 = 
NULL
;

479 
Pack‘Li¡
 
wr™ebacks
;

481 
boŞ
 
§tisf›d
 = 
	`acûss
(
pkt
, 
blk
, 
Ït
, 
wr™ebacks
);

488 ià(!
blk
 && 
pkt
->
	`g‘Size
(è>ğ
blkSize
 && 
coh”’û
->
	`®lowFa¡Wr™es
() &&

489 (
pkt
->
cmd
 =ğ
MemCmd
::
Wr™eReq


490 || 
pkt
->
cmd
 =ğ
MemCmd
::
Wr™eInv®id©eReq
) ) {

492 
MSHR
 *
out¡ªdšg_miss
 = 
mshrQueue
.
	`fšdM©ch
(
pkt
->
	`g‘Addr
());

493 ià(
pkt
->
cmd
 =ğ
MemCmd
::
Wr™eInv®id©eReq
 || !
out¡ªdšg_miss
) {

494 ià(
out¡ªdšg_miss
) {

495 
	`w¬n
("WriteInv doing‡ fastallocate"

498 
blk
 = 
	`hªdËFl
(
NULL
, 
pkt
, 
BlkV®id
 | 
BlkWr™abË
,

499 
wr™ebacks
);

500 ++
ç¡Wr™es
;

506 
Tick
 
Ãxt_pf_time
 = 0;

508 
boŞ
 
ÃedsRe¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
();

510 ià(
§tisf›d
) {

511 ià(
´eãtch”
 && (
´eãtchOnAcûss
 || (
blk
 && blk->
	`wasP»ãtched
()))) {

512 ià(
blk
)

513 
blk
->
¡©us
 &ğ~
BlkHWP»ãtched
;

514 
Ãxt_pf_time
 = 
´eãtch”
->
	`nÙify
(
pkt
, 
time
);

517 ià(
ÃedsRe¥Ú£
) {

518 
pkt
->
	`makeTimšgRe¥Ú£
();

520 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

521 
ıuSidePÜt
->
	`schedTimšgRe¥
(
pkt
, 
	`şockEdge
(
Ït
));

526 
³ndšgD–‘e
.
	`push_back
(
pkt
);

532 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

534 
Addr
 
blk_addr
 = 
	`blockAlign
(
pkt
->
	`g‘Addr
());

535 
MSHR
 *
mshr
 = 
mshrQueue
.
	`fšdM©ch
(
blk_addr
);

537 ià(
mshr
) {

543 
	`as£¹
(
pkt
->
»q
->
	`ma¡”Id
(è< 
sy¡em
->
	`maxMa¡”s
());

544 
mshr_h™s
[
pkt
->
	`cmdToIndex
()][pkt->
»q
->
	`ma¡”Id
()]++;

545 ià(
mshr
->
th»adNum
 != 0 ) {

546 
mshr
->
th»adNum
 = -1;

548 
mshr
->
	`®loÿ‹T¬g‘
(
pkt
, 
time
, 
Üd”
++);

549 ià(
mshr
->
	`g‘NumT¬g‘s
(è=ğ
numT¬g‘
) {

550 
noT¬g‘MSHR
 = 
mshr
;

551 
	`£tBlocked
(
Blocked_NoT¬g‘s
);

559 
	`as£¹
(
pkt
->
»q
->
	`ma¡”Id
(è< 
sy¡em
->
	`maxMa¡”s
());

560 
mshr_mis£s
[
pkt
->
	`cmdToIndex
()][pkt->
»q
->
	`ma¡”Id
()]++;

564 ià(
pkt
->
cmd
 =ğ
MemCmd
::
Wr™eback
) {

565 
	`®loÿ‹Wr™eBufãr
(
pkt
, 
time
, 
Œue
);

567 ià(
blk
 && blk->
	`isV®id
()) {

583 
	`as£¹
(
pkt
->
	`ÃedsExşusive
(è&& !
blk
->
	`isWr™abË
());

584 
blk
->
¡©us
 &ğ~
BlkR—dabË
;

587 
	`®loÿ‹MissBufãr
(
pkt
, 
time
, 
Œue
);

590 ià(
´eãtch”
) {

591 
Ãxt_pf_time
 = 
´eãtch”
->
	`nÙify
(
pkt
, 
time
);

596 ià(
Ãxt_pf_time
 != 0)

597 
	`»que¡MemSideBus
(
Reque¡_PF
, 
¡d
::
	`max
(
time
, 
Ãxt_pf_time
));

600 !
wr™ebacks
.
	`em±y
()) {

601 
Pack‘PŒ
 
wbPkt
 = 
wr™ebacks
.
	`äÚt
();

602 
	`®loÿ‹Wr™eBufãr
(
wbPkt
, 
time
, 
Œue
);

603 
wr™ebacks
.
	`pİ_äÚt
();

606  
Œue
;

607 
	}
}

611 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

612 
Pack‘PŒ


613 
	gCache
<
	gTagStÜe
>::
	$g‘BusPack‘
(
Pack‘PŒ
 
ıu_pkt
, 
BlkTy³
 *
blk
,

614 
boŞ
 
ÃedsExşusive
) const

616 
boŞ
 
blkV®id
 = 
blk
 && blk->
	`isV®id
();

618 ià(
ıu_pkt
->
»q
->
	`isUnÿch—bË
()) {

620  
NULL
;

623 ià(!
blkV®id
 &&

624 (
ıu_pkt
->
cmd
 =ğ
MemCmd
::
Wr™eback
 || cpu_pkt->
	`isUpg¿de
())) {

628  
NULL
;

631 
	`as£¹
(
ıu_pkt
->
	`ÃedsRe¥Ú£
());

633 
MemCmd
 
cmd
;

638 cÚ¡ 
boŞ
 
u£Upg¿des
 = 
Œue
;

639 ià(
blkV®id
 && 
u£Upg¿des
) {

642 
	`as£¹
(
ÃedsExşusive
 && !
blk
->
	`isWr™abË
());

643 
cmd
 = 
ıu_pkt
->
	`isLLSC
(è? 
MemCmd
::
SCUpg¿deReq
 : MemCmd::
Upg¿deReq
;

646 
cmd
 = 
ÃedsExşusive
 ? 
MemCmd
::
R—dExReq
 : MemCmd::
R—dReq
;

648 
Pack‘PŒ
 
pkt
 = 
Ãw
 
	`Pack‘
(
ıu_pkt
->
»q
, 
cmd
, 
blkSize
);

650 
pkt
->
	`®loÿ‹
();

651 
	`DPRINTF
(
Cache
, "%s created %s‡ddress %x size %d\n",

652 
__func__
, 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

653  
pkt
;

654 
	}
}

657 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

658 
Tick


659 
	gCache
<
	gTagStÜe
>::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

661 
Cyşes
 
Ït
 = 
h™L©’cy
;

664 
boŞ
 
Ï¡_Ëv–_ÿche
 = 
çl£
;

667 ià(
sy¡em
->
	`by·ssCaches
())

668  
	`ticksToCyşes
(
memSidePÜt
->
	`£ndAtomic
(
pkt
));

670 ià(
pkt
->
	`memInhib™As£¹ed
()) {

671 
	`as£¹
(!
pkt
->
»q
->
	`isUnÿch—bË
());

674 ià(
pkt
->
	`isInv®id©e
()) {

675 
BlkTy³
 *
blk
 = 
gs
->
	`fšdBlock
(
pkt
->
	`g‘Addr
());

676 ià(
blk
 && blk->
	`isV®id
()) {

677 
gs
->
	`šv®id©e
(
blk
);

678 
blk
->
	`šv®id©e
();

679 
	`DPRINTF
(
Cache
, "rcvd mem-inhibited %s on 0x%x: invalidating\n",

680 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

682 ià(!
Ï¡_Ëv–_ÿche
) {

683 
	`DPRINTF
(
Cache
, "forwarding mem-inhibited %s on 0x%x\n",

684 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

685 
Ït
 +ğ
	`ticksToCyşes
(
memSidePÜt
->
	`£ndAtomic
(
pkt
));

688 
	`DPRINTF
(
Cache
, "rcvd mem-inhibited %s on 0x%x:‚ot„esponding\n",

689 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

692  
Ït
 * 
	`şockP”iod
();

699 
BlkTy³
 *
blk
 = 
NULL
;

700 
Pack‘Li¡
 
wr™ebacks
;

702 ià(!
	`acûss
(
pkt
, 
blk
, 
Ït
, 
wr™ebacks
)) {

704 
Pack‘PŒ
 
bus_pkt
 = 
	`g‘BusPack‘
(
pkt
, 
blk
,…kt->
	`ÃedsExşusive
());

706 
boŞ
 
is_fÜw¬d
 = (
bus_pkt
 =ğ
NULL
);

708 ià(
is_fÜw¬d
) {

711 
bus_pkt
 = 
pkt
;

714 
	`DPRINTF
(
Cache
, "Sending‡n‡tomic %s for %x\n",

715 
bus_pkt
->
	`cmdSŒšg
(), bus_pkt->
	`g‘Addr
());

717 #ià
TRACING_ON


718 
CacheBlk
::
S‹
 
Şd_¡©e
 = 
blk
 ? blk->
¡©us
 : 0;

721 
Ït
 +ğ
	`ticksToCyşes
(
memSidePÜt
->
	`£ndAtomic
(
bus_pkt
));

723 
	`DPRINTF
(
Cache
, "Receive„esponse: %s for‡ddr %x in state %i\n",

724 
bus_pkt
->
	`cmdSŒšg
(), bus_pkt->
	`g‘Addr
(), 
Şd_¡©e
);

730 ià(!
is_fÜw¬d
) {

731 ià(
pkt
->
	`ÃedsRe¥Ú£
()) {

732 
	`as£¹
(
bus_pkt
->
	`isRe¥Ú£
());

733 ià(
bus_pkt
->
	`isE¼Ü
()) {

734 
pkt
->
	`makeAtomicRe¥Ú£
();

735 
pkt
->
	`cİyE¼Ü
(
bus_pkt
);

736 } ià(
bus_pkt
->
	`isR—d
() ||

737 
bus_pkt
->
cmd
 =ğ
MemCmd
::
Upg¿deRe¥
) {

740 
blk
 = 
	`hªdËFl
(
bus_pkt
, blk, 
wr™ebacks
);

741 
	`§tisfyCpuSideReque¡
(
pkt
, 
blk
);

745 
pkt
->
	`makeAtomicRe¥Ú£
();

748 
d–‘e
 
bus_pkt
;

764 !
wr™ebacks
.
	`em±y
()){

765 
Pack‘PŒ
 
wbPkt
 = 
wr™ebacks
.
	`äÚt
();

766 
memSidePÜt
->
	`£ndAtomic
(
wbPkt
);

767 
wr™ebacks
.
	`pİ_äÚt
();

768 
d–‘e
 
wbPkt
;

773 ià(
pkt
->
	`ÃedsRe¥Ú£
()) {

774 
pkt
->
	`makeAtomicRe¥Ú£
();

777  
Ït
 * 
	`şockP”iod
();

778 
	}
}

781 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

783 
	gCache
<
	gTagStÜe
>::
	$funùiÚ®Acûss
(
Pack‘PŒ
 
pkt
, 
boŞ
 
äomCpuSide
)

785 ià(
sy¡em
->
	`by·ssCaches
()) {

788 
	`as£¹
(
äomCpuSide
);

792 
memSidePÜt
->
	`£ndFunùiÚ®
(
pkt
);

796 
Addr
 
blk_addr
 = 
	`blockAlign
(
pkt
->
	`g‘Addr
());

797 
BlkTy³
 *
blk
 = 
gs
->
	`fšdBlock
(
pkt
->
	`g‘Addr
());

798 
MSHR
 *
mshr
 = 
mshrQueue
.
	`fšdM©ch
(
blk_addr
);

800 
pkt
->
	`pushLab–
(
	`Çme
());

802 
CacheBlkPrštW¿µ”
 
	`cbpw
(
blk
);

810 
boŞ
 
have_d©a
 = 
blk
 && blk->
	`isV®id
()

811 && 
pkt
->
	`checkFunùiÚ®
(&
cbpw
, 
blk_addr
, 
blkSize
, 
blk
->
d©a
);

815 
boŞ
 
have_dœty
 =

816 
have_d©a
 && (
blk
->
	`isDœty
() ||

817 (
mshr
 && mshr->
šS”viû
 && mshr->
	`isP’dšgDœty
()));

819 
boŞ
 
dÚe
 = 
have_dœty


820 || 
ıuSidePÜt
->
	`checkFunùiÚ®
(
pkt
)

821 || 
mshrQueue
.
	`checkFunùiÚ®
(
pkt
, 
blk_addr
)

822 || 
wr™eBufãr
.
	`checkFunùiÚ®
(
pkt
, 
blk_addr
)

823 || 
memSidePÜt
->
	`checkFunùiÚ®
(
pkt
);

825 
	`DPRINTF
(
Cache
, "functional %s %x %s%s%s\n",

826 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),

827 (
blk
 && blk->
	`isV®id
()) ? "valid " : "",

828 
have_d©a
 ? "d©¨" : "", 
dÚe
 ? "done " : "");

831 
pkt
->
	`pİLab–
();

833 ià(
dÚe
) {

834 
pkt
->
	`makeRe¥Ú£
();

838 ià(
äomCpuSide
) {

839 
memSidePÜt
->
	`£ndFunùiÚ®
(
pkt
);

840 } ià(
fÜw¬dSnoİs
 && 
ıuSidePÜt
->
	`isSnoİšg
()) {

843 
ıuSidePÜt
->
	`£ndFunùiÚ®Snoİ
(
pkt
);

846 
	}
}

856 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

858 
	gCache
<
	gTagStÜe
>::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

860 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

862 
Tick
 
time
 = 
	`şockEdge
(
h™L©’cy
);

863 
MSHR
 *
mshr
 = 
dyÇmic_ÿ¡
<MSHR*>(
pkt
->
£nd”S‹
);

864 
boŞ
 
is_”rÜ
 = 
pkt
->
	`isE¼Ü
();

866 
	`as£¹
(
mshr
);

868 ià(
is_”rÜ
) {

869 
	`DPRINTF
(
Cache
, "Cache„eceived…acket withƒrror for‡ddress %x, "

870 "cmd: %s\n", 
pkt
->
	`g‘Addr
(),…kt->
	`cmdSŒšg
());

873 
	`DPRINTF
(
Cache
, "Handling„esponseo %s for‡ddress %x\n",

874 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

876 
MSHRQueue
 *
mq
 = 
mshr
->
queue
;

877 
boŞ
 
wasFuÎ
 = 
mq
->
	`isFuÎ
();

879 ià(
mshr
 =ğ
noT¬g‘MSHR
) {

881 
	`ş—rBlocked
(
Blocked_NoT¬g‘s
);

882 
noT¬g‘MSHR
 = 
NULL
;

886 
MSHR
::
T¬g‘
 *
š™Ÿl_tgt
 = 
mshr
->
	`g‘T¬g‘
();

887 
BlkTy³
 *
blk
 = 
gs
->
	`fšdBlock
(
pkt
->
	`g‘Addr
());

888 
¡©s_cmd_idx
 = 
š™Ÿl_tgt
->
pkt
->
	`cmdToIndex
();

889 
Tick
 
miss_Ï‹ncy
 = 
	`curTick
(è- 
š™Ÿl_tgt
->
»cvTime
;

890 
Pack‘Li¡
 
wr™ebacks
;

892 ià(
pkt
->
»q
->
	`isUnÿch—bË
()) {

893 
	`as£¹
(
pkt
->
»q
->
	`ma¡”Id
(è< 
sy¡em
->
	`maxMa¡”s
());

894 
mshr_unÿch—bË_Ït
[
¡©s_cmd_idx
][
pkt
->
»q
->
	`ma¡”Id
()] +=

895 
miss_Ï‹ncy
;

897 
	`as£¹
(
pkt
->
»q
->
	`ma¡”Id
(è< 
sy¡em
->
	`maxMa¡”s
());

898 
mshr_miss_Ï‹ncy
[
¡©s_cmd_idx
][
pkt
->
»q
->
	`ma¡”Id
()] +=

899 
miss_Ï‹ncy
;

902 
boŞ
 
is_fl
 = !
mshr
->
isFÜw¬d
 &&

903 (
pkt
->
	`isR—d
(è||…kt->
cmd
 =ğ
MemCmd
::
Upg¿deRe¥
);

905 ià(
is_fl
 && !
is_”rÜ
) {

906 
	`DPRINTF
(
Cache
, "Block for‡ddr %x being updated in Cache\n",

907 
pkt
->
	`g‘Addr
());

910 
mshr
->
	`hªdËFl
(
pkt
, 
blk
);

912 
blk
 = 
	`hªdËFl
(
pkt
, blk, 
wr™ebacks
);

913 
	`as£¹
(
blk
 !ğ
NULL
);

917 
š™Ÿl_off£t
 = 0;

919 ià(
mshr
->
	`hasT¬g‘s
()) {

920 
š™Ÿl_off£t
 = 
mshr
->
	`g‘T¬g‘
()->
pkt
->
	`g‘Off£t
(
blkSize
);

923 
mshr
->
	`hasT¬g‘s
()) {

924 
MSHR
::
T¬g‘
 *
rg‘
 = 
mshr
->
	`g‘T¬g‘
();

926 
rg‘
->
sourû
) {

927 
MSHR
::
T¬g‘
::
FromCPU
:

928 
Tick
 
com¶‘iÚ_time
;

929 ià(
is_fl
) {

930 
	`§tisfyCpuSideReque¡
(
rg‘
->
pkt
, 
blk
,

931 
Œue
, 
mshr
->
	`hasPo¡Downg¿de
());

933 
Œªsãr_off£t
 =

934 
rg‘
->
pkt
->
	`g‘Off£t
(
blkSize
è- 
š™Ÿl_off£t
;

935 ià(
Œªsãr_off£t
 < 0) {

936 
Œªsãr_off£t
 +ğ
blkSize
;

943 
com¶‘iÚ_time
 = 
	`şockEdge
(
»¥Ú£L©’cy
) +

944 (
Œªsãr_off£t
 ? 
pkt
->
busLa¡WÜdD–ay
 :

945 
pkt
->
busFœ¡WÜdD–ay
);

947 
	`as£¹
(!
rg‘
->
pkt
->
»q
->
	`isUnÿch—bË
());

949 
	`as£¹
(
rg‘
->
pkt
->
»q
->
	`ma¡”Id
(è< 
sy¡em
->
	`maxMa¡”s
());

950 
missL©’cy
[
rg‘
->
pkt
->
	`cmdToIndex
()][rg‘->pkt->
»q
->
	`ma¡”Id
()] +=

951 
com¶‘iÚ_time
 - 
rg‘
->
»cvTime
;

952 } ià(
pkt
->
cmd
 =ğ
MemCmd
::
Upg¿deFaRe¥
) {

954 
	`as£¹
(
rg‘
->
pkt
->
cmd
 =ğ
MemCmd
::
StÜeCÚdReq
 ||

955 
rg‘
->
pkt
->
cmd
 =ğ
MemCmd
::
StÜeCÚdFaReq
 ||

956 
rg‘
->
pkt
->
cmd
 =ğ
MemCmd
::
SCUpg¿deFaReq
);

960 
com¶‘iÚ_time
 = 
	`şockEdge
(
»¥Ú£L©’cy
) +

961 
pkt
->
busLa¡WÜdD–ay
;

962 
rg‘
->
pkt
->
»q
->
	`£tExŒaD©a
(0);

967 
com¶‘iÚ_time
 = 
	`şockEdge
(
»¥Ú£L©’cy
) +

968 
pkt
->
busLa¡WÜdD–ay
;

969 ià(
pkt
->
	`isR—d
(è&& !
is_”rÜ
) {

970 
rg‘
->
pkt
->
	`£tD©a
Õkt->
g‘PŒ
<
ušt8_t
>());

973 
rg‘
->
pkt
->
	`makeTimšgRe¥Ú£
();

975 ià(
is_”rÜ
)

976 
rg‘
->
pkt
->
	`cİyE¼Ü
(pkt);

977 ià(
rg‘
->
pkt
->
cmd
 =ğ
MemCmd
::
R—dRe¥
 &&

978 (
pkt
->
	`isInv®id©e
(è|| 
mshr
->
	`hasPo¡Inv®id©e
())) {

982 
rg‘
->
pkt
->
cmd
 = 
MemCmd
::
R—dRe¥W™hInv®id©e
;

983 
	`DPRINTF
(
Cache
, "%s updated cmdo %s for‡ddress %x\n",

984 
__func__
, 
rg‘
->
pkt
->
	`cmdSŒšg
(),

985 
rg‘
->
pkt
->
	`g‘Addr
());

988 
rg‘
->
pkt
->
busFœ¡WÜdD–ay
 =¬g‘->pkt->
busLa¡WÜdD–ay
 = 0;

989 
ıuSidePÜt
->
	`schedTimšgRe¥
(
rg‘
->
pkt
, 
com¶‘iÚ_time
);

992 
MSHR
::
T¬g‘
::
FromP»ãtch”
:

993 
	`as£¹
(
rg‘
->
pkt
->
cmd
 =ğ
MemCmd
::
H¬dPFReq
);

994 ià(
blk
)

995 
blk
->
¡©us
 |ğ
BlkHWP»ãtched
;

996 
d–‘e
 
rg‘
->
pkt
->
»q
;

997 
d–‘e
 
rg‘
->
pkt
;

1000 
MSHR
::
T¬g‘
::
FromSnoİ
:

1002 
	`as£¹
(!
is_”rÜ
);

1004 
	`DPRINTF
(
Cache
, "processing deferred snoop...\n");

1005 
	`as£¹
(!(
pkt
->
	`isInv®id©e
(è&& !
mshr
->
	`hasPo¡Inv®id©e
()));

1006 
	`hªdËSnoİ
(
rg‘
->
pkt
, 
blk
, 
Œue
,rue,

1007 
mshr
->
	`hasPo¡Inv®id©e
());

1011 
	`·nic
("IÎeg®¬g‘->sourûƒnum %d\n", 
rg‘
->
sourû
);

1014 
mshr
->
	`pİT¬g‘
();

1017 ià(
blk
 && blk->
	`isV®id
()) {

1018 ià(
pkt
->
	`isInv®id©e
(è|| 
mshr
->
	`hasPo¡Inv®id©e
()) {

1019 
	`as£¹
(
blk
 !ğ
‹mpBlock
);

1020 
gs
->
	`šv®id©e
(
blk
);

1021 
blk
->
	`šv®id©e
();

1022 } ià(
mshr
->
	`hasPo¡Downg¿de
()) {

1023 
blk
->
¡©us
 &ğ~
BlkWr™abË
;

1027 ià(
mshr
->
	`´omÙeDeã¼edT¬g‘s
()) {

1030 ià(
blk
) {

1031 
blk
->
¡©us
 &ğ~
BlkR—dabË
;

1033 
mq
 = 
mshr
->
queue
;

1034 
mq
->
	`m¬kP’dšg
(
mshr
);

1035 
	`»que¡MemSideBus
((
Reque¡Cau£
)
mq
->
šdex
, 
	`şockEdge
() +

1036 
pkt
->
busLa¡WÜdD–ay
);

1038 
mq
->
	`d—Îoÿ‹
(
mshr
);

1039 ià(
wasFuÎ
 && !
mq
->
	`isFuÎ
()) {

1040 
	`ş—rBlocked
((
BlockedCau£
)
mq
->
šdex
);

1045 !
wr™ebacks
.
	`em±y
()) {

1046 
Pack‘PŒ
 
wbPkt
 = 
wr™ebacks
.
	`äÚt
();

1047 
	`®loÿ‹Wr™eBufãr
(
wbPkt
, 
time
, 
Œue
);

1048 
wr™ebacks
.
	`pİ_äÚt
();

1051 ià(
blk
 =ğ
‹mpBlock
) {

1052 ià(
blk
->
	`isDœty
()) {

1053 
	`®loÿ‹Wr™eBufãr
(
	`wr™ebackBlk
(
blk
), 
time
, 
Œue
);

1055 
blk
->
	`šv®id©e
();

1058 
	`DPRINTF
(
Cache
, "L—všg % w™h % fÜ‡dd»s %x\n", 
__func__
,

1059 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

1060 
d–‘e
 
pkt
;

1061 
	}
}

1066 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1067 
Pack‘PŒ


1068 
	gCache
<
	gTagStÜe
>::
	$wr™ebackBlk
(
BlkTy³
 *
blk
)

1070 
	`as£¹
(
blk
 && blk->
	`isV®id
(è&& blk->
	`isDœty
());

1072 
wr™ebacks
[
Reque¡
::
wbMa¡”Id
]++;

1074 
Reque¡
 *
wr™ebackReq
 =

1075 
Ãw
 
	`Reque¡
(
gs
->
	`»g’”©eBlkAddr
(
blk
->
g
, blk->
£t
), 
blkSize
, 0,

1076 
Reque¡
::
wbMa¡”Id
);

1077 
Pack‘PŒ
 
wr™eback
 = 
Ãw
 
	`Pack‘
(
wr™ebackReq
, 
MemCmd
::
Wr™eback
);

1078 ià(
blk
->
	`isWr™abË
()) {

1079 
wr™eback
->
	`£tSuµlyExşusive
();

1081 
wr™eback
->
	`®loÿ‹
();

1082 
¡d
::
	`memıy
(
wr™eback
->
g‘PŒ
<
ušt8_t
>(), 
blk
->
d©a
, 
blkSize
);

1084 
blk
->
¡©us
 &ğ~
BlkDœty
;

1085  
wr™eback
;

1086 
	}
}

1088 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1090 
	gCache
<
	gTagStÜe
>::
	$memWr™eback
()

1092 
W¿µedBlkVis™Ü
 
	`vis™Ü
(*
this
, &
Cache
<
TagStÜe
>::
wr™ebackVis™Ü
);

1093 
gs
->
	`fÜEachBlk
(
vis™Ü
);

1094 
	}
}

1096 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1098 
	gCache
<
	gTagStÜe
>::
	$memInv®id©e
()

1100 
W¿µedBlkVis™Ü
 
	`vis™Ü
(*
this
, &
Cache
<
TagStÜe
>::
šv®id©eVis™Ü
);

1101 
gs
->
	`fÜEachBlk
(
vis™Ü
);

1102 
	}
}

1104 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1105 
boŞ


1106 
	gCache
<
	gTagStÜe
>::
	$isDœty
() const

1108 
CacheBlkIsDœtyVis™Ü
<
BlkTy³
> 
vis™Ü
;

1109 
gs
->
	`fÜEachBlk
(
vis™Ü
);

1111  
vis™Ü
.
	`isDœty
();

1112 
	}
}

1114 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1115 
boŞ


1116 
	gCache
<
	gTagStÜe
>::
	$wr™ebackVis™Ü
(
BlkTy³
 &
blk
)

1118 ià(
blk
.
	`isDœty
()) {

1119 
	`as£¹
(
blk
.
	`isV®id
());

1121 
Reque¡
 
	`»que¡
(
gs
->
	`»g’”©eBlkAddr
(
blk
.
g
, blk.
£t
),

1122 
blkSize
, 0, 
Reque¡
::
funcMa¡”Id
);

1124 
Pack‘
 
	`·ck‘
(&
»que¡
, 
MemCmd
::
Wr™eReq
);

1125 
·ck‘
.
	`d©aStic
(
blk
.
d©a
);

1127 
memSidePÜt
->
	`£ndFunùiÚ®
(&
·ck‘
);

1129 
blk
.
¡©us
 &ğ~
BlkDœty
;

1132  
Œue
;

1133 
	}
}

1135 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1136 
boŞ


1137 
	gCache
<
	gTagStÜe
>::
	$šv®id©eVis™Ü
(
BlkTy³
 &
blk
)

1140 ià(
blk
.
	`isDœty
())

1141 
	`w¬n_Úû
("Invalidating dirty cache†ines. Expecthingso break.\n");

1143 ià(
blk
.
	`isV®id
()) {

1144 
	`as£¹
(!
blk
.
	`isDœty
());

1145 
gs
->
	`šv®id©e
(
dyÇmic_ÿ¡
< 
BlkTy³
 *>(&
blk
));

1146 
blk
.
	`šv®id©e
();

1149  
Œue
;

1150 
	}
}

1152 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1154 
	gCache
<
	gTagStÜe
>::
	$unÿch—bËFlush
(
Pack‘PŒ
 
pkt
)

1156 
	`DPRINTF
(
Cache
, "%s% %x unÿch—bË\n", 
pkt
->
	`cmdSŒšg
(),

1157 
pkt
->
»q
->
	`isIn¡F‘ch
() ? " (ifetch)" : "",

1158 
pkt
->
	`g‘Addr
());

1160 ià(
pkt
->
»q
->
	`isCË¬LL
())

1161 
gs
->
	`ş—rLocks
();

1163 
BlkTy³
 *
	`blk
(
gs
->
	`fšdBlock
(
pkt
->
	`g‘Addr
()));

1164 ià(
blk
) {

1165 
	`wr™ebackVis™Ü
(*
blk
);

1166 
	`šv®id©eVis™Ü
(*
blk
);

1168 
	}
}

1171 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1172 
ty³Çme
 
	gCache
<
	gTagStÜe
>::
BlkTy³
*

1173 
Cache
<
TagStÜe
>::
	$®loÿ‹Block
(
Addr
 
addr
, 
Pack‘Li¡
 &
wr™ebacks
)

1175 
BlkTy³
 *
blk
 = 
gs
->
	`fšdViùim
(
addr
, 
wr™ebacks
);

1177 ià(
blk
->
	`isV®id
()) {

1178 
Addr
 
»¶_addr
 = 
gs
->
	`»g’”©eBlkAddr
(
blk
->
g
, blk->
£t
);

1179 
MSHR
 *
»¶_mshr
 = 
mshrQueue
.
	`fšdM©ch
(
»¶_addr
);

1180 ià(
»¶_mshr
) {

1183 
	`as£¹
(!
blk
->
	`isWr™abË
());

1184 
	`as£¹
(
»¶_mshr
->
	`ÃedsExşusive
());

1187  
NULL
;

1189 
	`DPRINTF
(
Cache
, "replacement:„eplacing %x with %x: %s\n",

1190 
»¶_addr
, 
addr
,

1191 
blk
->
	`isDœty
() ? "writeback" : "clean");

1193 ià(
blk
->
	`isDœty
()) {

1195 
wr™ebacks
.
	`push_back
(
	`wr™ebackBlk
(
blk
));

1200  
blk
;

1201 
	}
}

1209 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1210 
ty³Çme
 
	gCache
<
	gTagStÜe
>::
BlkTy³
*

1211 
Cache
<
TagStÜe
>::
	$hªdËFl
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *
blk
,

1212 
Pack‘Li¡
 &
wr™ebacks
)

1214 
Addr
 
addr
 = 
pkt
->
	`g‘Addr
();

1215 #ià
TRACING_ON


1216 
CacheBlk
::
S‹
 
Şd_¡©e
 = 
blk
 ? blk->
¡©us
 : 0;

1219 ià(
blk
 =ğ
NULL
) {

1221 
	`as£¹
(
pkt
->
	`hasD©a
());

1223 
blk
 = 
	`®loÿ‹Block
(
addr
, 
wr™ebacks
);

1224 ià(
blk
 =ğ
NULL
) {

1227 
	`as£¹
(!
‹mpBlock
->
	`isV®id
());

1228 
blk
 = 
‹mpBlock
;

1229 
‹mpBlock
->
£t
 = 
gs
->
	`exŒaùS‘
(
addr
);

1230 
‹mpBlock
->
g
 = 
gs
->
	`exŒaùTag
(
addr
);

1231 
	`DPRINTF
(
Cache
, "usšgem°block fÜ %x\n", 
addr
);

1233 
gs
->
	`š£¹Block
(
pkt
, 
blk
);

1237 
	`as£¹
(!
blk
->
	`isV®id
());

1240 
	`as£¹
(
blk
->
g
 =ğ
gs
->
	`exŒaùTag
(
addr
));

1242 
	`as£¹
(
pkt
->
	`hasD©a
(è|| 
blk
->
	`isV®id
());

1247 
blk
->
¡©us
 |ğ
BlkV®id
 | 
BlkR—dabË
;

1249 ià(!
pkt
->
	`sh¬edAs£¹ed
()) {

1250 
blk
->
¡©us
 |ğ
BlkWr™abË
;

1258 ià(
pkt
->
	`memInhib™As£¹ed
())

1259 
blk
->
¡©us
 |ğ
BlkDœty
;

1262 
	`DPRINTF
(
Cache
, "Block‡ddr %x moving from state %xo %s\n",

1263 
addr
, 
Şd_¡©e
, 
blk
->
	`´št
());

1266 ià(
pkt
->
	`isR—d
()) {

1267 
¡d
::
	`memıy
(
blk
->
d©a
, 
pkt
->
g‘PŒ
<
ušt8_t
>(), 
blkSize
);

1270 
blk
->
wh’R—dy
 = 
	`şockEdge
(è+ 
»¥Ú£L©’cy
 * 
	`şockP”iod
() +

1271 
pkt
->
busLa¡WÜdD–ay
;

1273  
blk
;

1274 
	}
}

1283 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1285 
	gCache
<
	gTagStÜe
>::

1286 
	$doTimšgSuµlyRe¥Ú£
(
Pack‘PŒ
 
»q_pkt
, 
ušt8_t
 *
blk_d©a
,

1287 
boŞ
 
®»ady_cİ›d
, boŞ 
³ndšg_šv®
)

1289 
	`DPRINTF
(
Cache
, "% fÜ % add»s %x siz%d\n", 
__func__
,

1290 
»q_pkt
->
	`cmdSŒšg
(),„eq_pkt->
	`g‘Addr
(),„eq_pkt->
	`g‘Size
());

1293 
Pack‘PŒ
 
pkt
 = 
®»ady_cİ›d
 ? 
»q_pkt
 : 
Ãw
 
	`Pack‘
(req_pkt);

1294 
	`as£¹
(
»q_pkt
->
	`isInv®id©e
(è|| 
pkt
->
	`sh¬edAs£¹ed
());

1295 
pkt
->
	`®loÿ‹
();

1296 
pkt
->
	`makeTimšgRe¥Ú£
();

1298 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

1299 ià(
pkt
->
	`isR—d
()) {

1300 
pkt
->
	`£tD©aFromBlock
(
blk_d©a
, 
blkSize
);

1302 ià(
pkt
->
cmd
 =ğ
MemCmd
::
R—dRe¥
 && 
³ndšg_šv®
) {

1310 
pkt
->
cmd
 = 
MemCmd
::
R—dRe¥W™hInv®id©e
;

1312 
	`DPRINTF
(
Cache
, "%s created„esponse: %s‡ddress %x size %d\n",

1313 
__func__
, 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

1314 
memSidePÜt
->
	`schedTimšgSnoİRe¥
(
pkt
, 
	`şockEdge
(
h™L©’cy
));

1315 
	}
}

1317 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1319 
	gCache
<
	gTagStÜe
>::
	$hªdËSnoİ
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *
blk
,

1320 
boŞ
 
is_timšg
, boŞ 
is_deã¼ed
,

1321 
boŞ
 
³ndšg_šv®
)

1323 
	`DPRINTF
(
Cache
, "% fÜ % add»s %x siz%d\n", 
__func__
,

1324 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

1326 
	`as£¹
(!(
is_deã¼ed
 && !
is_timšg
));

1328 
	`as£¹
(!(
³ndšg_šv®
 && !
is_deã¼ed
));

1329 
	`as£¹
(
pkt
->
	`isReque¡
());

1334 
boŞ
 
šv®id©e
 = 
pkt
->
	`isInv®id©e
();

1335 
boŞ
 
M5_VAR_USED
 
Ãeds_exşusive
 = 
pkt
->
	`ÃedsExşusive
();

1337 ià(
fÜw¬dSnoİs
) {

1341 
boŞ
 
®»adyRe¥Úded
 = 
pkt
->
	`memInhib™As£¹ed
();

1342 ià(
is_timšg
) {

1343 
Pack‘
 
	`¢oİPkt
(
pkt
, 
Œue
);

1344 
¢oİPkt
.
	`£tEx´essSnoİ
();

1345 
¢oİPkt
.
	`pushS’d”S‹
(
Ãw
 
	`FÜw¬dRe¥Ú£RecÜd
(
pkt
->
	`g‘Src
()));

1348 
¢oİPkt
.
busFœ¡WÜdD–ay
 = snoİPkt.
busLa¡WÜdD–ay
 = 0;

1349 
ıuSidePÜt
->
	`£ndTimšgSnoİReq
(&
¢oİPkt
);

1350 ià(
¢oİPkt
.
	`memInhib™As£¹ed
()) {

1352 
	`as£¹
(!
®»adyRe¥Úded
);

1353 
pkt
->
	`as£¹MemInhib™
();

1355 
d–‘e
 
¢oİPkt
.
	`pİS’d”S‹
();

1357 ià(
¢oİPkt
.
	`sh¬edAs£¹ed
()) {

1358 
pkt
->
	`as£¹Sh¬ed
();

1361 
ıuSidePÜt
->
	`£ndAtomicSnoİ
(
pkt
);

1362 ià(!
®»adyRe¥Úded
 && 
pkt
->
	`memInhib™As£¹ed
()) {

1365 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

1370 ià(!
blk
 || !blk->
	`isV®id
()) {

1371 
	`DPRINTF
(
Cache
, "%s snoop miss for %s‡ddress %x size %d\n",

1372 
__func__
, 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

1375 
	`DPRINTF
(
Cache
, "%s snoop hit for %s for‡ddress %x size %d, "

1376 "Şd s‹ i %s\n", 
__func__
, 
pkt
->
	`cmdSŒšg
(),

1377 
pkt
->
	`g‘Addr
(),…kt->
	`g‘Size
(), 
blk
->
	`´št
());

1383 
boŞ
 
»¥Úd
 = 
blk
->
	`isDœty
(è&& 
pkt
->
	`ÃedsRe¥Ú£
();

1384 
boŞ
 
have_exşusive
 = 
blk
->
	`isWr™abË
();

1386 ià(
pkt
->
	`isR—d
(è&& !
šv®id©e
) {

1387 
	`as£¹
(!
Ãeds_exşusive
);

1388 
pkt
->
	`as£¹Sh¬ed
();

1389 
b™s_to_ş—r
 = 
BlkWr™abË
;

1390 cÚ¡ 
boŞ
 
haveOwÃrshS‹
 = 
Œue
;

1391 ià(!
haveOwÃrshS‹
) {

1395 
b™s_to_ş—r
 |ğ
BlkDœty
;

1397 
blk
->
¡©us
 &ğ~
b™s_to_ş—r
;

1400 ià(
»¥Úd
) {

1401 
	`as£¹
(!
pkt
->
	`memInhib™As£¹ed
());

1402 
pkt
->
	`as£¹MemInhib™
();

1403 ià(
have_exşusive
) {

1404 
pkt
->
	`£tSuµlyExşusive
();

1406 ià(
is_timšg
) {

1407 
	`doTimšgSuµlyRe¥Ú£
(
pkt
, 
blk
->
d©a
, 
is_deã¼ed
, 
³ndšg_šv®
);

1409 
pkt
->
	`makeAtomicRe¥Ú£
();

1410 
pkt
->
	`£tD©aFromBlock
(
blk
->
d©a
, 
blkSize
);

1412 } ià(
is_timšg
 && 
is_deã¼ed
) {

1416 
d–‘e
 
pkt
;

1421 ià(
šv®id©e
) {

1422 
	`as£¹
(
blk
 !ğ
‹mpBlock
);

1423 
gs
->
	`šv®id©e
(
blk
);

1424 
blk
->
	`šv®id©e
();

1427 
	`DPRINTF
(
Cache
, "Ãw s‹ i %s\n", 
blk
->
	`´št
());

1428 
	}
}

1431 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1433 
	gCache
<
	gTagStÜe
>::
	$»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

1435 
	`DPRINTF
(
Cache
, "% fÜ % add»s %x siz%d\n", 
__func__
,

1436 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

1439 
	`as£¹
(!
sy¡em
->
	`by·ssCaches
());

1443 ià((
pkt
->
»q
 &&…kt->»q->
	`isUnÿch—bË
()) ||

1444 
pkt
->
cmd
 =ğ
MemCmd
::
Wr™eback
) {

1450 
BlkTy³
 *
blk
 = 
gs
->
	`fšdBlock
(
pkt
->
	`g‘Addr
());

1452 
Addr
 
blk_addr
 = 
	`blockAlign
(
pkt
->
	`g‘Addr
());

1453 
MSHR
 *
mshr
 = 
mshrQueue
.
	`fšdM©ch
(
blk_addr
);

1457 ià(
mshr
 && mshr->
	`hªdËSnoİ
(
pkt
, 
Üd”
++)) {

1458 
	`DPRINTF
(
Cache
, "Deferring snoop on in-service MSHRo blk %x."

1459 "mshrs: %s\n", 
blk_addr
, 
mshr
->
	`´št
());

1461 ià(
mshr
->
	`g‘NumT¬g‘s
(è> 
numT¬g‘
)

1462 
	`w¬n
("allocating bonusarget for snoop");

1467 
¡d
::
veùÜ
<
MSHR
 *> 
wr™ebacks
;

1468 ià(
wr™eBufãr
.
	`fšdM©ches
(
blk_addr
, 
wr™ebacks
)) {

1469 
	`DPRINTF
(
Cache
, "Snoop hit in writebacko‡ddr: %x\n",

1470 
pkt
->
	`g‘Addr
());

1473 ià(
wr™ebacks
.
	`size
()) {

1475 
	`as£¹
(
wr™ebacks
.
	`size
() == 1);

1476 
mshr
 = 
wr™ebacks
[0];

1477 
	`as£¹
(!
mshr
->
	`isUnÿch—bË
());

1478 
	`as£¹
(
mshr
->
	`g‘NumT¬g‘s
() == 1);

1479 
Pack‘PŒ
 
wb_pkt
 = 
mshr
->
	`g‘T¬g‘
()->
pkt
;

1480 
	`as£¹
(
wb_pkt
->
cmd
 =ğ
MemCmd
::
Wr™eback
);

1482 
	`as£¹
(!
pkt
->
	`memInhib™As£¹ed
());

1483 
pkt
->
	`as£¹MemInhib™
();

1484 ià(!
pkt
->
	`ÃedsExşusive
()) {

1485 
pkt
->
	`as£¹Sh¬ed
();

1487 
wb_pkt
->
	`ş—rSuµlyExşusive
();

1492 
	`as£¹
(
pkt
->
	`isInv®id©e
());

1494 
	`doTimšgSuµlyRe¥Ú£
(
pkt
, 
wb_pkt
->
g‘PŒ
<
ušt8_t
>(),

1495 
çl£
, false);

1497 ià(
pkt
->
	`isInv®id©e
()) {

1499 
	`m¬kInS”viû
(
mshr
);

1500 
d–‘e
 
wb_pkt
;

1510 
	`hªdËSnoİ
(
pkt
, 
blk
, 
Œue
, 
çl£
, false);

1511 
	}
}

1513 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1514 
boŞ


1515 
	gCache
<
	gTagStÜe
>::
CpuSidePÜt
::
	$»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

1518 
ÿche
->
	`»cvTimšgSnoİRe¥
(
pkt
);

1519  
Œue
;

1520 
	}
}

1522 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1523 
Tick


1524 
	gCache
<
	gTagStÜe
>::
	$»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

1527 
	`as£¹
(!
sy¡em
->
	`by·ssCaches
());

1529 ià(
pkt
->
»q
->
	`isUnÿch—bË
(è||…kt->
cmd
 =ğ
MemCmd
::
Wr™eback
) {

1535 
BlkTy³
 *
blk
 = 
gs
->
	`fšdBlock
(
pkt
->
	`g‘Addr
());

1536 
	`hªdËSnoİ
(
pkt
, 
blk
, 
çl£
, false, false);

1537  
h™L©’cy
 * 
	`şockP”iod
();

1538 
	}
}

1541 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1542 
MSHR
 *

1543 
	gCache
<
	gTagStÜe
>::
	$g‘NextMSHR
()

1546 
MSHR
 *
miss_mshr
 = 
mshrQueue
.
	`g‘NextMSHR
();

1547 
MSHR
 *
wr™e_mshr
 = 
wr™eBufãr
.
	`g‘NextMSHR
();

1550 ià(
miss_mshr
 && !
wr™e_mshr
) {

1551  
miss_mshr
;

1553 ià(
wr™e_mshr
 && !
miss_mshr
) {

1554  
wr™e_mshr
;

1557 ià(
miss_mshr
 && 
wr™e_mshr
) {

1560 ià(
wr™eBufãr
.
	`isFuÎ
(è&& wr™eBufãr.
šS”viûEÁr›s
 == 0) {

1563 
MSHR
 *
cÚæiù_mshr
 =

1564 
mshrQueue
.
	`fšdP’dšg
(
wr™e_mshr
->
addr
, wr™e_mshr->
size
);

1566 ià(
cÚæiù_mshr
 && cÚæiù_mshr->
Üd”
 < 
wr™e_mshr
->order) {

1568  
cÚæiù_mshr
;

1572  
wr™e_mshr
;

1577 
MSHR
 *
cÚæiù_mshr
 =

1578 
wr™eBufãr
.
	`fšdP’dšg
(
miss_mshr
->
addr
, miss_mshr->
size
);

1579 ià(
cÚæiù_mshr
) {

1592  
cÚæiù_mshr
;

1596  
miss_mshr
;

1600 
	`as£¹
(!
miss_mshr
 && !
wr™e_mshr
);

1601 ià(
´eãtch”
 && !
mshrQueue
.
	`isFuÎ
()) {

1603 
Pack‘PŒ
 
pkt
 = 
´eãtch”
->
	`g‘Pack‘
();

1604 ià(
pkt
) {

1605 
Addr
 
pf_addr
 = 
	`blockAlign
(
pkt
->
	`g‘Addr
());

1606 ià(!
gs
->
	`fšdBlock
(
pf_addr
è&& !
mshrQueue
.
	`fšdM©ch
(pf_addr) &&

1607 !
wr™eBufãr
.
	`fšdM©ch
(
pf_addr
)) {

1610 
	`as£¹
(
pkt
->
»q
->
	`ma¡”Id
(è< 
sy¡em
->
	`maxMa¡”s
());

1611 
mshr_mis£s
[
pkt
->
	`cmdToIndex
()][pkt->
»q
->
	`ma¡”Id
()]++;

1613  
	`®loÿ‹MissBufãr
(
pkt
, 
	`curTick
(), 
çl£
);

1616 
d–‘e
 
pkt
->
»q
;

1617 
d–‘e
 
pkt
;

1622  
NULL
;

1623 
	}
}

1626 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1627 
Pack‘PŒ


1628 
	gCache
<
	gTagStÜe
>::
	$g‘TimšgPack‘
()

1630 
MSHR
 *
mshr
 = 
	`g‘NextMSHR
();

1632 ià(
mshr
 =ğ
NULL
) {

1633  
NULL
;

1637 
Pack‘PŒ
 
tgt_pkt
 = 
mshr
->
	`g‘T¬g‘
()->
pkt
;

1638 
Pack‘PŒ
 
pkt
 = 
NULL
;

1640 
	`DPRINTF
(
CachePÜt
, "% % fÜ‡dd»s %x siz%d\n", 
__func__
,

1641 
tgt_pkt
->
	`cmdSŒšg
(),gt_pkt->
	`g‘Addr
(),gt_pkt->
	`g‘Size
());

1643 ià(
tgt_pkt
->
cmd
 =ğ
MemCmd
::
SCUpg¿deFaReq
 ||

1644 
tgt_pkt
->
cmd
 =ğ
MemCmd
::
StÜeCÚdFaReq
) {

1648 
pkt
 = 
Ãw
 
	`Pack‘
(
tgt_pkt
);

1649 
pkt
->
cmd
 = 
MemCmd
::
Upg¿deFaRe¥
;

1650 
pkt
->
£nd”S‹
 = 
mshr
;

1651 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

1652 
	`»cvTimšgRe¥
(
pkt
);

1653  
NULL
;

1654 } ià(
mshr
->
	`isFÜw¬dNoRe¥Ú£
()) {

1656 
	`as£¹
(
gs
->
	`fšdBlock
(
mshr
->
addr
è=ğ
NULL
);

1657 
pkt
 = 
tgt_pkt
;

1659 
BlkTy³
 *
blk
 = 
gs
->
	`fšdBlock
(
mshr
->
addr
);

1661 ià(
tgt_pkt
->
cmd
 =ğ
MemCmd
::
H¬dPFReq
) {

1666 
	`as£¹
(
blk
 =ğ
NULL
);

1673 
Pack‘
 
	`¢oİ_pkt
(
tgt_pkt
, 
Œue
);

1674 
¢oİ_pkt
.
	`£tEx´essSnoİ
();

1675 
¢oİ_pkt
.
£nd”S‹
 = 
mshr
;

1676 
ıuSidePÜt
->
	`£ndTimšgSnoİReq
(&
¢oİ_pkt
);

1678 ià(
¢oİ_pkt
.
	`memInhib™As£¹ed
()) {

1679 
	`m¬kInS”viû
(
mshr
, &
¢oİ_pkt
);

1680 
	`DPRINTF
(
Cache
, "Upward snoop of…refetch for‡ddr %#x hit\n",

1681 
tgt_pkt
->
	`g‘Addr
());

1682  
NULL
;

1686 
pkt
 = 
	`g‘BusPack‘
(
tgt_pkt
, 
blk
, 
mshr
->
	`ÃedsExşusive
());

1688 
mshr
->
isFÜw¬d
 = (
pkt
 =ğ
NULL
);

1690 ià(
mshr
->
isFÜw¬d
) {

1694 
pkt
 = 
Ãw
 
	`Pack‘
(
tgt_pkt
);

1695 
pkt
->
	`®loÿ‹
();

1696 ià(
pkt
->
	`isWr™e
()) {

1697 
pkt
->
	`£tD©a
(
tgt_pkt
->
g‘PŒ
<
ušt8_t
>());

1702 
	`as£¹
(
pkt
 !ğ
NULL
);

1703 
pkt
->
£nd”S‹
 = 
mshr
;

1704  
pkt
;

1705 
	}
}

1708 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1709 
Tick


1710 
	gCache
<
	gTagStÜe
>::
	$ÃxtMSHRR—dyTime
() const

1712 
Tick
 
ÃxtR—dy
 = 
¡d
::
	`mš
(
mshrQueue
.
	`ÃxtMSHRR—dyTime
(),

1713 
wr™eBufãr
.
	`ÃxtMSHRR—dyTime
());

1715 ià(
´eãtch”
) {

1716 
ÃxtR—dy
 = 
¡d
::
	`mš
(nextReady,

1717 
´eãtch”
->
	`ÃxtP»ãtchR—dyTime
());

1720  
ÃxtR—dy
;

1721 
	}
}

1723 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1725 
	gCache
<
	gTagStÜe
>::
£rŸlize
(
¡d
::
o¡»am
 &
os
)

1727 
boŞ
 
dœty
(
isDœty
());

1729 ià(
	gdœty
) {

1730 
w¬n
("*** The cache still contains dirty data. ***\n");

1731 
w¬n
(" Make sureo drainhe system usinghe correct flags.\n");

1732 
w¬n
(" This checkpoint will‚ot„estore correctly‡nd dirty data in "

1740 
boŞ
 
bad_checkpošt
(
dœty
);

1741 
SERIALIZE_SCALAR
(
bad_checkpošt
);

1744 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1746 
	gCache
<
	gTagStÜe
>::
un£rŸlize
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
)

1748 
boŞ
 
bad_checkpošt
;

1749 
UNSERIALIZE_SCALAR
(
bad_checkpošt
);

1750 ià(
	gbad_checkpošt
) {

1751 
çl
("Restoring from checkpoints with dirty caches is‚ot supported "

1763 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1764 
AddrRªgeLi¡


1765 
	gCache
<
	gTagStÜe
>::
CpuSidePÜt
::
	$g‘AddrRªges
() const

1767  
ÿche
->
	`g‘AddrRªges
();

1768 
	}
}

1770 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1771 
boŞ


1772 
	gCache
<
	gTagStÜe
>::
CpuSidePÜt
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

1775 ià(!
pkt
->
	`memInhib™As£¹ed
(è&& 
blocked
) {

1776 
	`as£¹
(!
ÿche
->
sy¡em
->
	`by·ssCaches
());

1777 
	`DPRINTF
(
Cache
,"Scheduling‡„etry while blocked\n");

1778 
mu¡S’dR‘ry
 = 
Œue
;

1779  
çl£
;

1782 
ÿche
->
	`»cvTimšgReq
(
pkt
);

1783  
Œue
;

1784 
	}
}

1786 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1787 
Tick


1788 
	gCache
<
	gTagStÜe
>::
CpuSidePÜt
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

1790  
ÿche
->
	`»cvAtomic
(
pkt
);

1791 
	}
}

1793 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1795 
	gCache
<
	gTagStÜe
>::
CpuSidePÜt
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

1798 
ÿche
->
	`funùiÚ®Acûss
(
pkt
, 
Œue
);

1799 
	}
}

1801 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1802 
	gCache
<
	gTagStÜe
>::

1803 
CpuSidePÜt
::CpuSidePÜt(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
Cache
<
TagStÜe
> *
_ÿche
,

1804 cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
)

1805 : 
Ba£Cache
::
CacheSÏvePÜt
(
_Çme
, 
_ÿche
, 
_Ïb–
), 
	$ÿche
(
_ÿche
)

1807 
	}
}

1815 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1816 
boŞ


1817 
	gCache
<
	gTagStÜe
>::
MemSidePÜt
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

1819 
ÿche
->
	`»cvTimšgRe¥
(
pkt
);

1820  
Œue
;

1821 
	}
}

1824 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1826 
	gCache
<
	gTagStÜe
>::
MemSidePÜt
::
	$»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

1829 
ÿche
->
	`»cvTimšgSnoİReq
(
pkt
);

1830 
	}
}

1832 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1833 
Tick


1834 
	gCache
<
	gTagStÜe
>::
MemSidePÜt
::
	$»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

1836  
ÿche
->
	`»cvAtomicSnoİ
(
pkt
);

1837 
	}
}

1839 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1841 
	gCache
<
	gTagStÜe
>::
MemSidePÜt
::
	$»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
)

1846 
ÿche
->
	`funùiÚ®Acûss
(
pkt
, 
çl£
);

1847 
	}
}

1849 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1851 
	gCache
<
	gTagStÜe
>::
MemSidePack‘Queue
::
	$£ndDeã¼edPack‘
()

1854 ià(
	`deã¼edPack‘R—dy
()) {

1856 
	`ŒyS’dTimšg
();

1859 
Pack‘PŒ
 
pkt
 = 
ÿche
.
	`g‘TimšgPack‘
();

1860 ià(
pkt
 =ğ
NULL
) {

1864 
wa™šgOnR‘ry
 = 
çl£
;

1866 
MSHR
 *
mshr
 = 
dyÇmic_ÿ¡
<MSHR*>(
pkt
->
£nd”S‹
);

1868 
wa™šgOnR‘ry
 = !
ma¡”PÜt
.
	`£ndTimšgReq
(
pkt
);

1870 ià(
wa™šgOnR‘ry
) {

1871 
	`DPRINTF
(
CachePÜt
, "now waiting on‡„etry\n");

1872 ià(!
mshr
->
	`isFÜw¬dNoRe¥Ú£
()) {

1876 
d–‘e
 
pkt
;

1884 
ÿche
.
	`m¬kInS”viû
(
mshr
, 
pkt
);

1892 ià(!
wa™šgOnR‘ry
) {

1893 
	`scheduËS’d
(
ÿche
.
	`ÃxtMSHRR—dyTime
());

1895 
	}
}

1897 
	g‹m¶©e
<
şass
 
	gTagStÜe
>

1898 
	gCache
<
	gTagStÜe
>::

1899 
MemSidePÜt
::MemSidePÜt(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
Cache
<
TagStÜe
> *
_ÿche
,

1900 cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
)

1901 : 
Ba£Cache
::
CacheMa¡”PÜt
(
_Çme
, 
_ÿche
, 
_queue
),

1902 
_queue
(*
_ÿche
, *
this
, 
_Ïb–
), 
	$ÿche
(
_ÿche
)

1904 
	}
}

	@cache/mshr.cc

50 
	~<®gÜ™hm
>

51 
	~<ÿs£¹
>

52 
	~<¡ršg
>

53 
	~<veùÜ
>

55 
	~"ba£/misc.hh
"

56 
	~"ba£/ty³s.hh
"

57 
	~"debug/Cache.hh
"

58 
	~"mem/ÿche/ÿche.hh
"

59 
	~"mem/ÿche/mshr.hh
"

60 
	~"sim/cÜe.hh
"

62 
usšg
 
Çme¥aû
 
	g¡d
;

64 
	gMSHR
::
	$MSHR
(è: 
	`»adyTime
(0), 
	`_isUnÿch—bË
(
çl£
), 
	`down¡»amP’dšg
(false),

65 
	`³ndšgDœty
(
çl£
), 
	`po¡Inv®id©e
(false),

66 
	`po¡Downg¿de
(
çl£
), 
	`queue
(
NULL
), 
	`Üd”
(0), 
	`addr
(0), 
	`size
(0),

67 
	`šS”viû
(
çl£
), 
	`isFÜw¬d
(çl£), 
	`th»adNum
(
Inv®idTh»adID
),

68 
	$d©a
(
NULL
)

70 
	}
}

73 
	gMSHR
::
T¬g‘Li¡
::
	$T¬g‘Li¡
()

74 : 
	`ÃedsExşusive
(
çl£
), 
	$hasUpg¿de
(
çl£
)

75 {
	}
}

78 
šlše
 

79 
	gMSHR
::
T¬g‘Li¡
::
add
(
Pack‘PŒ
 
pkt
, 
Tick
 
»adyTime
,

80 
CouÁ”
 
Üd”
, 
T¬g‘
::
Sourû
 
sourû
, 
boŞ
 
m¬kP’dšg
)

82 ià(
	gsourû
 !ğ
T¬g‘
::
FromSnoİ
) {

83 ià(
pkt
->
ÃedsExşusive
()) {

84 
ÃedsExşusive
 = 
Œue
;

90 ià(
	gpkt
->
isUpg¿de
(è||…kt->
	gcmd
 =ğ
MemCmd
::
StÜeCÚdReq
) {

91 
hasUpg¿de
 = 
Œue
;

95 ià(
	gm¬kP’dšg
) {

99 
MSHR
 *
	gmshr
 = 
pkt
->
fšdNextS’d”S‹
<MSHR>();

100 ià(
	gmshr
 !ğ
NULL
) {

101 
as£¹
(!
mshr
->
down¡»amP’dšg
);

102 
	gmshr
->
	gdown¡»amP’dšg
 = 
Œue
;

106 
push_back
(
T¬g‘
(
pkt
, 
»adyTime
, 
Üd”
, 
sourû
, 
m¬kP’dšg
));

111 
	$»¶aûUpg¿de
(
Pack‘PŒ
 
pkt
)

113 ià(
pkt
->
cmd
 =ğ
MemCmd
::
Upg¿deReq
) {

114 
pkt
->
cmd
 = 
MemCmd
::
R—dExReq
;

115 
	`DPRINTF
(
Cache
, "Replacing UpgradeReq with ReadExReq\n");

116 } ià(
pkt
->
cmd
 =ğ
MemCmd
::
SCUpg¿deReq
) {

117 
pkt
->
cmd
 = 
MemCmd
::
SCUpg¿deFaReq
;

118 
	`DPRINTF
(
Cache
, "Replacing SCUpgradeReq with SCUpgradeFailReq\n");

119 } ià(
pkt
->
cmd
 =ğ
MemCmd
::
StÜeCÚdReq
) {

120 
pkt
->
cmd
 = 
MemCmd
::
StÜeCÚdFaReq
;

121 
	`DPRINTF
(
Cache
, "Replacing StoreCondReq with StoreCondFailReq\n");

123 
	}
}

127 
	gMSHR
::
T¬g‘Li¡
::
	$»¶aûUpg¿des
()

129 ià(!
hasUpg¿de
)

132 
I‹¿tÜ
 
’d_i
 = 
	`’d
();

133 
I‹¿tÜ
 
i
 = 
	`begš
(); i !ğ
’d_i
; ++i) {

134 
	`»¶aûUpg¿de
(
i
->
pkt
);

137 
hasUpg¿de
 = 
çl£
;

138 
	}
}

142 
	gMSHR
::
T¬g‘Li¡
::
	$ş—rDown¡»amP’dšg
()

144 
I‹¿tÜ
 
’d_i
 = 
	`’d
();

145 
I‹¿tÜ
 
i
 = 
	`begš
(); i !ğ
’d_i
; ++i) {

146 ià(
i
->
m¬kedP’dšg
) {

153 
MSHR
 *
mshr
 = 
i
->
pkt
->
fšdNextS’d”S‹
<MSHR>();

154 ià(
mshr
 !ğ
NULL
) {

155 
mshr
->
	`ş—rDown¡»amP’dšg
();

159 
	}
}

162 
boŞ


163 
	gMSHR
::
T¬g‘Li¡
::
	$checkFunùiÚ®
(
Pack‘PŒ
 
pkt
)

165 
I‹¿tÜ
 
’d_i
 = 
	`’d
();

166 
I‹¿tÜ
 
i
 = 
	`begš
(); i !ğ
’d_i
; ++i) {

167 ià(
pkt
->
	`checkFunùiÚ®
(
i
->pkt)) {

168  
Œue
;

172  
çl£
;

173 
	}
}

177 
	gMSHR
::
T¬g‘Li¡
::

178 
´št
(
¡d
::
o¡»am
 &
os
, 
v”bos™y
, cÚ¡ std::
¡ršg
 &
´efix
) const

180 
CÚ¡I‹¿tÜ
 
’d_i
 = 
’d
();

181 
CÚ¡I‹¿tÜ
 
	gi
 = 
begš
(); i !ğ
’d_i
; ++i) {

182 cÚ¡ *
	gs
;

183 
	gi
->
	gsourû
) {

184 
	gT¬g‘
::
FromCPU
:

185 
s
 = "FromCPU";

187 
	gT¬g‘
::
FromSnoİ
:

188 
s
 = "FromSnoop";

190 
	gT¬g‘
::
FromP»ãtch”
:

191 
s
 = "FromPrefetcher";

194 
s
 = "";

197 
cırštf
(
os
, "%s%s: ", 
´efix
, 
s
);

198 
	gi
->
	gpkt
->
´št
(
os
, 
v”bos™y
, "");

204 
	gMSHR
::
	$®loÿ‹
(
Addr
 
_addr
, 
_size
, 
Pack‘PŒ
 
rg‘
,

205 
Tick
 
wh’R—dy
, 
CouÁ”
 
_Üd”
)

207 
addr
 = 
_addr
;

208 
size
 = 
_size
;

209 
»adyTime
 = 
wh’R—dy
;

210 
Üd”
 = 
_Üd”
;

211 
	`as£¹
(
rg‘
);

212 
isFÜw¬d
 = 
çl£
;

213 
_isUnÿch—bË
 = 
rg‘
->
»q
->
	`isUnÿch—bË
();

214 
šS”viû
 = 
çl£
;

215 
down¡»amP’dšg
 = 
çl£
;

216 
th»adNum
 = 0;

217 
	`as£¹
(
rg‘s
.
	`isRe£t
());

220 
T¬g‘
::
Sourû
 
sourû
 = (
rg‘
->
cmd
 =ğ
MemCmd
::
H¬dPFReq
) ?

221 
T¬g‘
::
FromP»ãtch”
 : T¬g‘::
FromCPU
;

222 
rg‘s
.
	`add
(
rg‘
, 
wh’R—dy
, 
_Üd”
, 
sourû
, 
Œue
);

223 
	`as£¹
(
deã¼edT¬g‘s
.
	`isRe£t
());

224 
d©a
 = 
NULL
;

225 
	}
}

229 
	gMSHR
::
	$ş—rDown¡»amP’dšg
()

231 
	`as£¹
(
down¡»amP’dšg
);

232 
down¡»amP’dšg
 = 
çl£
;

235 
rg‘s
.
	`ş—rDown¡»amP’dšg
();

236 
	}
}

238 
boŞ


239 
	gMSHR
::
	$m¬kInS”viû
(
Pack‘PŒ
 
pkt
)

241 
	`as£¹
(!
šS”viû
);

242 ià(
	`isFÜw¬dNoRe¥Ú£
()) {

245 
	`as£¹
(
	`g‘NumT¬g‘s
() == 1);

246 
	`pİT¬g‘
();

247  
Œue
;

249 
šS”viû
 = 
Œue
;

250 
³ndšgDœty
 = (
rg‘s
.
ÃedsExşusive
 ||

251 (!
pkt
->
	`sh¬edAs£¹ed
(è&&…kt->
	`memInhib™As£¹ed
()));

252 
po¡Inv®id©e
 = 
po¡Downg¿de
 = 
çl£
;

254 ià(!
down¡»amP’dšg
) {

257 
rg‘s
.
	`ş—rDown¡»amP’dšg
();

259  
çl£
;

260 
	}
}

264 
	gMSHR
::
	$d—Îoÿ‹
()

266 
	`as£¹
(
rg‘s
.
	`em±y
());

267 
rg‘s
.
	`»£tFÏgs
();

268 
	`as£¹
(
deã¼edT¬g‘s
.
	`isRe£t
());

269 
šS”viû
 = 
çl£
;

270 
	}
}

276 
	gMSHR
::
	$®loÿ‹T¬g‘
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’R—dy
, 
CouÁ”
 
_Üd”
)

291 
	`as£¹
(
pkt
->
cmd
 !ğ
MemCmd
::
H¬dPFReq
);

293 ià(
šS”viû
 &&

294 (!
deã¼edT¬g‘s
.
	`em±y
(è|| 
	`hasPo¡Inv®id©e
() ||

295 (
pkt
->
	`ÃedsExşusive
() &&

296 (!
	`isP’dšgDœty
(è|| 
	`hasPo¡Downg¿de
(è|| 
isFÜw¬d
)))) {

298 ià(
	`hasPo¡Inv®id©e
())

299 
	`»¶aûUpg¿de
(
pkt
);

300 
deã¼edT¬g‘s
.
	`add
(
pkt
, 
wh’R—dy
, 
_Üd”
, 
T¬g‘
::
FromCPU
, 
Œue
);

306 
rg‘s
.
	`add
(
pkt
, 
wh’R—dy
, 
_Üd”
, 
T¬g‘
::
FromCPU
, !
šS”viû
);

308 
	}
}

310 
boŞ


311 
	gMSHR
::
	$hªdËSnoİ
(
Pack‘PŒ
 
pkt
, 
CouÁ”
 
_Üd”
)

313 
	`DPRINTF
(
Cache
, "% fÜ % add»s %x siz%d\n", 
__func__
,

314 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

315 ià(!
šS”viû
 || (
pkt
->
	`isEx´essSnoİ
(è&& 
down¡»amP’dšg
)) {

329 ià(
pkt
->
	`ÃedsExşusive
()) {

330 
rg‘s
.
	`»¶aûUpg¿des
();

331 
deã¼edT¬g‘s
.
	`»¶aûUpg¿des
();

334  
çl£
;

339 ià(
pkt
->
	`ÃedsExşusive
()) {

342 
deã¼edT¬g‘s
.
	`»¶aûUpg¿des
();

345 ià(
	`hasPo¡Inv®id©e
()) {

349  
Œue
;

352 ià(
	`isP’dšgDœty
(è|| 
pkt
->
	`isInv®id©e
()) {

362 
Pack‘PŒ
 
ı_pkt
 = 
Ãw
 
	`Pack‘
(
pkt
, 
Œue
);

363 
rg‘s
.
	`add
(
ı_pkt
, 
	`curTick
(), 
_Üd”
, 
T¬g‘
::
FromSnoİ
,

364 
down¡»amP’dšg
 && 
rg‘s
.
ÃedsExşusive
);

366 ià(
	`isP’dšgDœty
()) {

367 
pkt
->
	`as£¹MemInhib™
();

368 
pkt
->
	`£tSuµlyExşusive
();

371 ià(
pkt
->
	`ÃedsExşusive
()) {

373 
po¡Inv®id©e
 = 
Œue
;

377 ià(!
pkt
->
	`ÃedsExşusive
()) {

380 
po¡Downg¿de
 = 
Œue
;

381 
pkt
->
	`as£¹Sh¬ed
();

384  
Œue
;

385 
	}
}

388 
boŞ


389 
	gMSHR
::
	$´omÙeDeã¼edT¬g‘s
()

391 
	`as£¹
(
rg‘s
.
	`em±y
());

392 ià(
deã¼edT¬g‘s
.
	`em±y
()) {

393  
çl£
;

397 
¡d
::
	`sw­
(
rg‘s
, 
deã¼edT¬g‘s
);

400 
deã¼edT¬g‘s
.
	`»£tFÏgs
();

402 
Üd”
 = 
rg‘s
.
	`äÚt
().order;

403 
»adyTime
 = 
¡d
::
	`max
(
	`curTick
(), 
rg‘s
.
	`äÚt
().readyTime);

405  
Œue
;

406 
	}
}

410 
	gMSHR
::
	$hªdËFl
(
Pack‘
 *
pkt
, 
CacheBlk
 *
blk
)

412 ià(!
pkt
->
	`sh¬edAs£¹ed
()

413 && !(
	`hasPo¡Inv®id©e
(è|| 
	`hasPo¡Downg¿de
())

414 && 
deã¼edT¬g‘s
.
ÃedsExşusive
) {

423 
	`as£¹
(!
rg‘s
.
ÃedsExşusive
);

424 
rg‘s
.
ÃedsExşusive
 = 
Œue
;

427 
	`as£¹
(!
down¡»amP’dšg
);

428 
deã¼edT¬g‘s
.
	`ş—rDown¡»amP’dšg
();

430 
rg‘s
.
	`¥liû
Ñ¬g‘s.
	`’d
(), 
deã¼edT¬g‘s
);

431 
deã¼edT¬g‘s
.
	`»£tFÏgs
();

433 
	}
}

436 
boŞ


437 
	gMSHR
::
	$checkFunùiÚ®
(
Pack‘PŒ
 
pkt
)

442 ià(
pkt
->
	`isPršt
()) {

443 
pkt
->
	`checkFunùiÚ®
(
this
, 
addr
, 
size
, 
NULL
);

444  
çl£
;

446  (
rg‘s
.
	`checkFunùiÚ®
(
pkt
) ||

447 
deã¼edT¬g‘s
.
	`checkFunùiÚ®
(
pkt
));

449 
	}
}

453 
	gMSHR
::
´št
(
¡d
::
o¡»am
 &
os
, 
v”bos™y
, cÚ¡ std::
¡ršg
 &
´efix
) const

455 
cırštf
(
os
, "%s[%x:%x] %s %s %s state: %s %s %s %s %s\n",

456 
´efix
, 
addr
,‡ddr+
size
-1,

457 
isFÜw¬d
 ? "Forward" : "",

458 
isFÜw¬dNoRe¥Ú£
() ? "ForwNoResp" : "",

459 
ÃedsExşusive
() ? "Excl" : "",

460 
_isUnÿch—bË
 ? "Unc" : "",

461 
šS”viû
 ? "InSvc" : "",

462 
down¡»amP’dšg
 ? "DwnPend" : "",

463 
hasPo¡Inv®id©e
() ? "PostInv" : "",

464 
hasPo¡Downg¿de
() ? "PostDowngr" : "");

466 
cırštf
(
os
, "%  T¬g‘s:\n", 
´efix
);

467 
	grg‘s
.
´št
(
os
, 
v”bos™y
, 
´efix
 + " ");

468 ià(!
	gdeã¼edT¬g‘s
.
em±y
()) {

469 
cırštf
(
os
, "%  Deã¼ed T¬g‘s:\n", 
´efix
);

470 
	gdeã¼edT¬g‘s
.
´št
(
os
, 
v”bos™y
, 
´efix
 + " ");

474 
	g¡d
::
¡ršg


475 
MSHR
::
	$´št
() const

477 
o¡ršg¡»am
 
¡r
;

478 
	`´št
(
¡r
);

479  
¡r
.
	`¡r
();

480 
	}
}

	@cache/mshr.hh

48 #iâdeà
__MSHR_HH__


49 
	#__MSHR_HH__


	)

51 
	~<li¡
>

53 
	~"ba£/´šbË.hh
"

54 
	~"mem/·ck‘.hh
"

56 
şass
 
	gCacheBlk
;

57 
şass
 
	gMSHRQueue
;

64 
şass
 
	gMSHR
 : 
public
 
Pack‘
::
S’d”S‹
,…ubliø
	gPršbË


70 
ä›nd
 
şass
 
	gMSHRQueue
;

72 
	g´iv©e
:

75 
Tick
 
»adyTime
;

78 
boŞ
 
	g_isUnÿch—bË
;

81 
boŞ
 
	gdown¡»amP’dšg
;

84 
boŞ
 
	g³ndšgDœty
;

87 
boŞ
 
	gpo¡Inv®id©e
;

90 
boŞ
 
	gpo¡Downg¿de
;

92 
	gpublic
:

94 şas 
	cT¬g‘
 {

95 
public
:

97 
	eSourû
 {

98 
FromCPU
,

99 
	gFromSnoİ
,

100 
	gFromP»ãtch”


103 
Tick
 
	g»cvTime
;

104 
Tick
 
	g»adyTime
;

105 
CouÁ”
 
	gÜd”
;

106 
Pack‘PŒ
 
	gpkt
;

107 
Sourû
 
	gsourû
;

108 
boŞ
 
	gm¬kedP’dšg
;

111 
T¬g‘
(
Pack‘PŒ
 
_pkt
, 
Tick
 
_»adyTime
, 
CouÁ”
 
_Üd”
,

112 
Sourû
 
_sourû
, 
boŞ
 
_m¬kedP’dšg
)

113 : 
»cvTime
(
curTick
()), 
»adyTime
(
_»adyTime
), 
Üd”
(
_Üd”
),

114 
pkt
(
_pkt
), 
sourû
(
_sourû
), 
m¬kedP’dšg
(
_m¬kedP’dšg
)

118 
şass
 
	gT¬g‘Li¡
 : 
public
 
¡d
::
li¡
<
T¬g‘
> {

120 
¡d
::
	tli¡
<
	tT¬g‘
>::
	t™”©Ü
 
	tI‹¿tÜ
;

121 
	g¡d
::
	tli¡
<
	tT¬g‘
>::
	tcÚ¡_™”©Ü
 
	tCÚ¡I‹¿tÜ
;

123 
	gpublic
:

124 
boŞ
 
ÃedsExşusive
;

125 
boŞ
 
	ghasUpg¿de
;

127 
T¬g‘Li¡
();

128 
»£tFÏgs
(è{ 
	gÃedsExşusive
 = 
hasUpg¿de
 = 
çl£
; }

129 
boŞ
 
isRe£t
(è{  !
	gÃedsExşusive
 && !
	ghasUpg¿de
; }

130 
add
(
Pack‘PŒ
 
pkt
, 
Tick
 
»adyTime
, 
CouÁ”
 
Üd”
,

131 
T¬g‘
::
Sourû
 
sourû
, 
boŞ
 
m¬kP’dšg
);

132 
»¶aûUpg¿des
();

133 
ş—rDown¡»amP’dšg
();

134 
boŞ
 
checkFunùiÚ®
(
Pack‘PŒ
 
pkt
);

135 
´št
(
¡d
::
o¡»am
 &
os
, 
v”bos™y
,

136 cÚ¡ 
¡d
::
¡ršg
 &
´efix
) const;

140 
	g¡d
::
	tli¡
<
	tMSHR
 *> 
	tLi¡
;

142 
	gLi¡
::
	t™”©Ü
 
	tI‹¿tÜ
;

144 
	gLi¡
::
	tcÚ¡_™”©Ü
 
	tCÚ¡I‹¿tÜ
;

147 
MSHRQueue
 *
	gqueue
;

150 
CouÁ”
 
	gÜd”
;

153 
Addr
 
	gaddr
;

156 
	gsize
;

159 
boŞ
 
	gšS”viû
;

162 
boŞ
 
	gisFÜw¬d
;

170 
boŞ
 
	$ÃedsExşusive
(ècÚ¡ {  
rg‘s
.
ÃedsExşusive
; 
	}
}

172 
boŞ
 
	$isP’dšgDœty
() const {

173 
	`as£¹
(
šS”viû
);  
³ndšgDœty
;

174 
	}
}

176 
boŞ
 
	$hasPo¡Inv®id©e
() const {

177 
	`as£¹
(
šS”viû
);  
po¡Inv®id©e
;

178 
	}
}

180 
boŞ
 
	$hasPo¡Downg¿de
() const {

181 
	`as£¹
(
šS”viû
);  
po¡Downg¿de
;

182 
	}
}

185 
Th»adID
 
	gth»adNum
;

187 
	g´iv©e
:

191 
ušt8_t
 *
d©a
;

197 
I‹¿tÜ
 
	g»adyI‹r
;

203 
I‹¿tÜ
 
	g®locI‹r
;

206 
T¬g‘Li¡
 
	grg‘s
;

208 
T¬g‘Li¡
 
	gdeã¼edT¬g‘s
;

210 
	gpublic
:

212 
boŞ
 
	$isUnÿch—bË
(ècÚ¡ {  
_isUnÿch—bË
; 
	}
}

222 
®loÿ‹
(
Addr
 
addr
, 
size
, 
Pack‘PŒ
 
pkt
,

223 
Tick
 
wh’
, 
CouÁ”
 
_Üd”
);

225 
boŞ
 
m¬kInS”viû
(
Pack‘PŒ
 
pkt
);

227 
ş—rDown¡»amP’dšg
();

232 
d—Îoÿ‹
();

238 
®loÿ‹T¬g‘
(
Pack‘PŒ
 
rg‘
, 
Tick
 
wh’
, 
CouÁ”
 
Üd”
);

239 
boŞ
 
hªdËSnoİ
(
Pack‘PŒ
 
rg‘
, 
CouÁ”
 
Üd”
);

242 
MSHR
();

248 
	$g‘NumT¬g‘s
() const

249 {  
rg‘s
.
	`size
(è+ 
deã¼edT¬g‘s
.size(); 
	}
}

255 
boŞ
 
	$hasT¬g‘s
(ècÚ¡ {  !
rg‘s
.
	`em±y
(); 
	}
}

261 
T¬g‘
 *
	$g‘T¬g‘
()

263 
	`as£¹
(
	`hasT¬g‘s
());

264  &
rg‘s
.
	`äÚt
();

265 
	}
}

270 
	$pİT¬g‘
()

272 
rg‘s
.
	`pİ_äÚt
();

273 
	}
}

275 
boŞ
 
	$isFÜw¬dNoRe¥Ú£
() const

277 ià(
	`g‘NumT¬g‘s
() != 1)

278  
çl£
;

279 cÚ¡ 
T¬g‘
 *
tgt
 = &
rg‘s
.
	`äÚt
();

280  
tgt
->
sourû
 =ğ
T¬g‘
::
FromCPU
 && !tgt->
pkt
->
	`ÃedsRe¥Ú£
();

281 
	}
}

283 
boŞ
 
´omÙeDeã¼edT¬g‘s
();

285 
hªdËFl
(
Pack‘
 *
pkt
, 
CacheBlk
 *
blk
);

287 
boŞ
 
checkFunùiÚ®
(
Pack‘PŒ
 
pkt
);

292 
´št
(
¡d
::
o¡»am
 &
os
,

293 
v”bos™y
 = 0,

294 cÚ¡ 
¡d
::
¡ršg
 &
´efix
 = "") const;

301 
	g¡d
::
¡ršg
 
	$´št
() const;

302 
	}
};

	@cache/mshr_queue.cc

48 
	~"mem/ÿche/mshr_queue.hh
"

50 
usšg
 
Çme¥aû
 
	g¡d
;

52 
	gMSHRQueue
::
MSHRQueue
(cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
,

53 
num_’Œ›s
, 
»£rve
, 
_šdex
)

54 : 
Ïb–
(
_Ïb–
), 
numEÁr›s
(
num_’Œ›s
 + 
»£rve
 - 1),

55 
numRe£rve
(
»£rve
), 
»gi¡”s
(
numEÁr›s
),

56 
d¿šMªag”
(
NULL
), 
®loÿ‹d
(0), 
šS”viûEÁr›s
(0), 
	$šdex
(
_šdex
)

58 
i
 = 0; i < 
numEÁr›s
; ++i) {

59 
»gi¡”s
[
i
].
queue
 = 
this
;

60 
ä“Li¡
.
	`push_back
(&
»gi¡”s
[
i
]);

62 
	}
}

64 
MSHR
 *

65 
	gMSHRQueue
::
	$fšdM©ch
(
Addr
 
addr
) const

67 
MSHR
::
CÚ¡I‹¿tÜ
 
i
 = 
®loÿ‹dLi¡
.
	`begš
();

68 
MSHR
::
CÚ¡I‹¿tÜ
 
’d
 = 
®loÿ‹dLi¡
.
	`’d
();

69 ; 
i
 !ğ
’d
; ++i) {

70 
MSHR
 *
mshr
 = *
i
;

71 ià(
mshr
->
addr
 ==‡ddr) {

72  
mshr
;

75  
NULL
;

76 
	}
}

78 
boŞ


79 
	gMSHRQueue
::
fšdM©ches
(
Addr
 
addr
, 
veùÜ
<
MSHR
*>& 
m©ches
) const

82 
as£¹
(
m©ches
.
em±y
());

83 
boŞ
 
	g»tv®
 = 
çl£
;

84 
	gMSHR
::
CÚ¡I‹¿tÜ
 
i
 = 
®loÿ‹dLi¡
.
begš
();

85 
	gMSHR
::
CÚ¡I‹¿tÜ
 
’d
 = 
®loÿ‹dLi¡
.end();

86 ; 
	gi
 !ğ
’d
; ++i) {

87 
MSHR
 *
	gmshr
 = *
i
;

88 ià(
	gmshr
->
	gaddr
 =ğ
addr
) {

89 
»tv®
 = 
Œue
;

90 
	gm©ches
.
push_back
(
mshr
);

93  
	g»tv®
;

97 
boŞ


98 
	gMSHRQueue
::
	$checkFunùiÚ®
(
Pack‘PŒ
 
pkt
, 
Addr
 
blk_addr
)

100 
pkt
->
	`pushLab–
(
Ïb–
);

101 
MSHR
::
CÚ¡I‹¿tÜ
 
i
 = 
®loÿ‹dLi¡
.
	`begš
();

102 
MSHR
::
CÚ¡I‹¿tÜ
 
’d
 = 
®loÿ‹dLi¡
.
	`’d
();

103 ; 
i
 !ğ
’d
; ++i) {

104 
MSHR
 *
mshr
 = *
i
;

105 ià(
mshr
->
addr
 =ğ
blk_addr
 && mshr->
	`checkFunùiÚ®
(
pkt
)) {

106 
pkt
->
	`pİLab–
();

107  
Œue
;

110 
pkt
->
	`pİLab–
();

111  
çl£
;

112 
	}
}

115 
MSHR
 *

116 
	gMSHRQueue
::
	$fšdP’dšg
(
Addr
 
addr
, 
size
) const

118 
MSHR
::
CÚ¡I‹¿tÜ
 
i
 = 
»adyLi¡
.
	`begš
();

119 
MSHR
::
CÚ¡I‹¿tÜ
 
’d
 = 
»adyLi¡
.
	`’d
();

120 ; 
i
 !ğ
’d
; ++i) {

121 
MSHR
 *
mshr
 = *
i
;

122 ià(
mshr
->
addr
 <‡ddr) {

123 ià(
mshr
->
addr
 + mshr->
size
 >‡ddr) {

124  
mshr
;

127 ià(
addr
 + 
size
 > 
mshr
->addr) {

128  
mshr
;

132  
NULL
;

133 
	}
}

136 
	gMSHR
::
I‹¿tÜ


137 
MSHRQueue
::
	$addToR—dyLi¡
(
MSHR
 *
mshr
)

139 ià(
»adyLi¡
.
	`em±y
(è||„—dyLi¡.
	`back
()->
»adyTime
 <ğ
mshr
->readyTime) {

140  
»adyLi¡
.
	`š£¹
Ô—dyLi¡.
	`’d
(), 
mshr
);

143 
MSHR
::
I‹¿tÜ
 
i
 = 
»adyLi¡
.
	`begš
();

144 
MSHR
::
I‹¿tÜ
 
’d
 = 
»adyLi¡
.
	`’d
();

145 ; 
i
 !ğ
’d
; ++i) {

146 ià((*
i
)->
»adyTime
 > 
mshr
->readyTime) {

147  
»adyLi¡
.
	`š£¹
(
i
, 
mshr
);

150 
	`as£¹
(
çl£
);

151  
’d
;

152 
	}
}

155 
MSHR
 *

156 
	gMSHRQueue
::
	$®loÿ‹
(
Addr
 
addr
, 
size
, 
Pack‘PŒ
 &
pkt
,

157 
Tick
 
wh’
, 
CouÁ”
 
Üd”
)

159 
	`as£¹
(!
ä“Li¡
.
	`em±y
());

160 
MSHR
 *
mshr
 = 
ä“Li¡
.
	`äÚt
();

161 
	`as£¹
(
mshr
->
	`g‘NumT¬g‘s
() == 0);

162 
ä“Li¡
.
	`pİ_äÚt
();

164 
mshr
->
	`®loÿ‹
(
addr
, 
size
, 
pkt
, 
wh’
, 
Üd”
);

165 
mshr
->
®locI‹r
 = 
®loÿ‹dLi¡
.
	`š£¹
×Îoÿ‹dLi¡.
	`’d
(), mshr);

166 
mshr
->
»adyI‹r
 = 
	`addToR—dyLi¡
(mshr);

168 
®loÿ‹d
 += 1;

169  
mshr
;

170 
	}
}

174 
	gMSHRQueue
::
	$d—Îoÿ‹
(
MSHR
 *
mshr
)

176 
	`d—Îoÿ‹OÃ
(
mshr
);

177 
	}
}

179 
	gMSHR
::
I‹¿tÜ


180 
MSHRQueue
::
	$d—Îoÿ‹OÃ
(
MSHR
 *
mshr
)

182 
MSHR
::
I‹¿tÜ
 
»tv®
 = 
®loÿ‹dLi¡
.
	`”a£
(
mshr
->
®locI‹r
);

183 
ä“Li¡
.
	`push_äÚt
(
mshr
);

184 
®loÿ‹d
--;

185 ià(
mshr
->
šS”viû
) {

186 
šS”viûEÁr›s
--;

188 
»adyLi¡
.
	`”a£
(
mshr
->
»adyI‹r
);

190 
mshr
->
	`d—Îoÿ‹
();

191 ià(
d¿šMªag”
 && 
®loÿ‹d
 == 0) {

194 
d¿šMªag”
->
	`sigÇlD¿šDÚe
();

195 
d¿šMªag”
 = 
NULL
;

196 
	`£tD¿šS‹
(
D¿šabË
::
D¿šed
);

198  
»tv®
;

199 
	}
}

202 
	gMSHRQueue
::
	$moveToFrÚt
(
MSHR
 *
mshr
)

204 ià(!
mshr
->
šS”viû
) {

205 
	`as£¹
(
mshr
 =ğ*(mshr->
»adyI‹r
));

206 
»adyLi¡
.
	`”a£
(
mshr
->
»adyI‹r
);

207 
mshr
->
»adyI‹r
 = 
»adyLi¡
.
	`š£¹
Ô—dyLi¡.
	`begš
(), mshr);

209 
	}
}

212 
	gMSHRQueue
::
	$m¬kInS”viû
(
MSHR
 *
mshr
, 
Pack‘PŒ
 
pkt
)

214 ià(
mshr
->
	`m¬kInS”viû
(
pkt
)) {

215 
	`d—Îoÿ‹
(
mshr
);

217 
»adyLi¡
.
	`”a£
(
mshr
->
»adyI‹r
);

218 
šS”viûEÁr›s
 += 1;

220 
	}
}

223 
	gMSHRQueue
::
	$m¬kP’dšg
(
MSHR
 *
mshr
)

225 
	`as£¹
(
mshr
->
šS”viû
);

226 
mshr
->
šS”viû
 = 
çl£
;

227 --
šS”viûEÁr›s
;

232 
mshr
->
»adyI‹r
 = 
	`addToR—dyLi¡
(mshr);

233 
	}
}

236 
	gMSHRQueue
::
	$squash
(
th»adNum
)

238 
MSHR
::
I‹¿tÜ
 
i
 = 
®loÿ‹dLi¡
.
	`begš
();

239 
MSHR
::
I‹¿tÜ
 
’d
 = 
®loÿ‹dLi¡
.
	`’d
();

240 ; 
i
 !ğ
’d
;) {

241 
MSHR
 *
mshr
 = *
i
;

242 ià(
mshr
->
th»adNum
 ==hreadNum) {

243 
mshr
->
	`hasT¬g‘s
()) {

244 
mshr
->
	`pİT¬g‘
();

245 
	`as£¹
(0 =ğ
th»adNum
);

247 
	`as£¹
(!
mshr
->
	`hasT¬g‘s
());

248 
	`as£¹
(
mshr
->
	`g‘NumT¬g‘s
()==0);

249 ià(!
mshr
->
šS”viû
) {

250 
i
 = 
	`d—Îoÿ‹OÃ
(
mshr
);

253 ++
i
;

256 ++
i
;

259 
	}
}

262 
	gMSHRQueue
::
	$d¿š
(
D¿šMªag”
 *
dm
)

264 ià(
®loÿ‹d
 == 0) {

265 
	`£tD¿šS‹
(
D¿šabË
::
D¿šed
);

268 
d¿šMªag”
 = 
dm
;

269 
	`£tD¿šS‹
(
D¿šabË
::
D¿ššg
);

272 
	}
}

	@cache/mshr_queue.hh

48 #iâdeà
__MEM__CACHE__MISS__MSHR_QUEUE_HH__


49 
	#__MEM__CACHE__MISS__MSHR_QUEUE_HH__


	)

51 
	~<veùÜ
>

53 
	~"mem/ÿche/mshr.hh
"

54 
	~"mem/·ck‘.hh
"

55 
	~"sim/d¿š.hh
"

60 şas 
	cMSHRQueue
 : 
public
 
D¿šabË


62 
´iv©e
:

64 cÚ¡ 
¡d
::
¡ršg
 
Ïb–
;

72 cÚ¡ 
	mnumEÁr›s
;

78 cÚ¡ 
	mnumRe£rve
;

81 
	m¡d
::
veùÜ
<
MSHR
> 
»gi¡”s
;

83 
	mMSHR
::
Li¡
 
®loÿ‹dLi¡
;

85 
	mMSHR
::
Li¡
 
»adyLi¡
;

87 
	mMSHR
::
Li¡
 
ä“Li¡
;

90 
D¿šMªag”
 *
	md¿šMªag”
;

92 
	mMSHR
::
I‹¿tÜ
 
addToR—dyLi¡
(
MSHR
 *
mshr
);

95 
	mpublic
:

97 
®loÿ‹d
;

99 
	mšS”viûEÁr›s
;

102 cÚ¡ 
	mšdex
;

110 
MSHRQueue
(cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
, 
num_’Œ›s
, 
»£rve
,

111 
šdex
);

118 
MSHR
 *
	$fšdM©ch
(
Addr
 
addr
) const;

127 
boŞ
 
	`fšdM©ches
(
Addr
 
addr
, 
¡d
::
veùÜ
<
MSHR
*>& 
m©ches
) const;

134 
MSHR
 *
	$fšdP’dšg
(
Addr
 
addr
, 
size
) const;

136 
boŞ
 
	`checkFunùiÚ®
(
Pack‘PŒ
 
pkt
, 
Addr
 
blk_addr
);

147 
MSHR
 *
	`®loÿ‹
(
Addr
 
addr
, 
size
, 
Pack‘PŒ
 &
pkt
,

148 
Tick
 
wh’
, 
CouÁ”
 
Üd”
);

155 
	`d—Îoÿ‹
(
MSHR
 *
mshr
);

163 
MSHR
::
I‹¿tÜ
 
	`d—Îoÿ‹OÃ
(MSHR *
mshr
);

170 
	`moveToFrÚt
(
MSHR
 *
mshr
);

177 
	`m¬kInS”viû
(
MSHR
 *
mshr
, 
Pack‘PŒ
 
pkt
);

183 
	`m¬kP’dšg
(
MSHR
 *
mshr
);

190 
	`squash
(
th»adNum
);

196 
boŞ
 
	$haveP’dšg
() const

198  !
»adyLi¡
.
	`em±y
();

205 
boŞ
 
	$isFuÎ
() const

207  (
®loÿ‹d
 > 
numEÁr›s
 - 
numRe£rve
);

208 
	}
}

214 
MSHR
 *
	$g‘NextMSHR
() const

216 ià(
»adyLi¡
.
	`em±y
(è||„—dyLi¡.
	`äÚt
()->
»adyTime
 > 
	`curTick
()) {

217  
NULL
;

219  
»adyLi¡
.
	`äÚt
();

220 
	}
}

222 
Tick
 
	$ÃxtMSHRR—dyTime
() const

224  
»adyLi¡
.
	`em±y
(è? 
MaxTick
 :„—dyLi¡.
	`äÚt
()->
»adyTime
;

225 
	}
}

227 
d¿š
(
D¿šMªag”
 *
dm
);

	@cache/prefetch/base.cc

48 
	~<li¡
>

50 
	~"¬ch/i§_Œa™s.hh
"

51 
	~"ba£/Œaû.hh
"

52 
	~"cÚfig/the_i§.hh
"

53 
	~"debug/HWP»ãtch.hh
"

54 
	~"mem/ÿche/´eãtch/ba£.hh
"

55 
	~"mem/ÿche/ba£.hh
"

56 
	~"mem/»que¡.hh
"

57 
	~"sim/sy¡em.hh
"

59 
	gBa£P»ãtch”
::
	$Ba£P»ãtch”
(cÚ¡ 
P¬ams
 *
p
)

60 : 
	`ClockedObjeù
(
p
), 
	`size
Õ->
size
), 
	`Ï‹ncy
Õ->
Ï‹ncy
), 
	`deg»e
Õ->
deg»e
),

61 
	`u£Ma¡”Id
(
p
->
u£_ma¡”_id
), 
	`·geStİ
(!p->
üoss_·ges
),

62 
	`£rŸlSquash
(
p
->
£rŸl_squash
), 
	`ÚlyD©a
Õ->
d©a_acûs£s_Úly
),

63 
	`sy¡em
(
p
->
sys
), 
	`ma¡”Id
(
sy¡em
->
	`g‘Ma¡”Id
(
	$Çme
()))

65 
	}
}

68 
	gBa£P»ãtch”
::
	$£tCache
(
Ba£Cache
 *
_ÿche
)

70 
ÿche
 = 
_ÿche
;

71 
blkSize
 = 
ÿche
->
	`g‘BlockSize
();

72 
	}
}

75 
	gBa£P»ãtch”
::
	$»gSts
()

77 
pfId’tif›d


78 .
	`Çme
(name() + ".prefetcher.num_hwpf_identified")

79 .
	`desc
("number of hwpf identified")

82 
pfMSHRH™


83 .
	`Çme
(name() + ".prefetcher.num_hwpf_already_in_mshr")

84 .
	`desc
("number of hwpfhat were‡lready in mshr")

87 
pfCacheH™


88 .
	`Çme
(name() + ".prefetcher.num_hwpf_already_in_cache")

89 .
	`desc
("number of hwpfhat were‡lready inhe cache")

92 
pfBufãrH™


93 .
	`Çme
(name() + ".prefetcher.num_hwpf_already_in_prefetcher")

94 .
	`desc
("number of hwpfhat were‡lready inhe…refetch queue")

97 
pfRemovedFuÎ


98 .
	`Çme
(name() + ".prefetcher.num_hwpf_evicted")

99 .
	`desc
("number of hwpf„emoved dueo‚o buffer†eft")

102 
pfRemovedMSHR


103 .
	`Çme
(name() + ".prefetcher.num_hwpf_removed_MSHR_hit")

104 .
	`desc
("number of hwpf„emoved because MSHR‡llocated")

107 
pfIssued


108 .
	`Çme
(name() + ".prefetcher.num_hwpf_issued")

109 .
	`desc
("number of hwpf issued")

112 
pfS·nPage


113 .
	`Çme
(name() + ".prefetcher.num_hwpf_span_page")

114 .
	`desc
("number of hwpf spanning‡ virtual…age")

117 
pfSquashed


118 .
	`Çme
(name() + ".prefetcher.num_hwpf_squashed_from_miss")

119 .
	`desc
("number of hwpfhat got squashed dueo‡ miss "

122 
	}
}

124 
šlše
 
boŞ


125 
	gBa£P»ãtch”
::
	$šCache
(
Addr
 
addr
)

127 ià(
ÿche
->
	`šCache
(
addr
)) {

128 
pfCacheH™
++;

129  
Œue
;

131  
çl£
;

132 
	}
}

134 
šlše
 
boŞ


135 
	gBa£P»ãtch”
::
	$šMissQueue
(
Addr
 
addr
)

137 ià(
ÿche
->
	`šMissQueue
(
addr
)) {

138 
pfMSHRH™
++;

139  
Œue
;

141  
çl£
;

142 
	}
}

144 
Pack‘PŒ


145 
	gBa£P»ãtch”
::
	$g‘Pack‘
()

147 
	`DPRINTF
(
HWP»ãtch
, "Requesting‡ hw_pfo issue\n");

149 ià(
pf
.
	`em±y
()) {

150 
	`DPRINTF
(
HWP»ãtch
, "No HW_PF found\n");

151  
NULL
;

154 
Pack‘PŒ
 
pkt
 = 
pf
.
	`begš
()->pkt;

155 !
pf
.
	`em±y
()) {

156 
pkt
 = 
pf
.
	`begš
()->pkt;

157 
pf
.
	`pİ_äÚt
();

159 
Addr
 
blk_addr
 = 
pkt
->
	`g‘Addr
(è& ~(Addr)(
blkSize
-1);

161 ià(!
	`šCache
(
blk_addr
è&& !
	`šMissQueue
(blk_addr))

165 
	`DPRINTF
(
HWP»ãtch
, "add¸0x%x iÀÿche, skpšg\n", 
pkt
->
	`g‘Addr
());

166 
d–‘e
 
pkt
->
»q
;

167 
d–‘e
 
pkt
;

169 ià(
pf
.
	`em±y
()) {

170 
ÿche
->
	`d—s£¹MemSideBusReque¡
(
Ba£Cache
::
Reque¡_PF
);

171  
NULL
;

175 
pfIssued
++;

176 
	`as£¹
(
pkt
 !ğ
NULL
);

177 
	`DPRINTF
(
HWP»ãtch
, "»tuºšg 0x%x\n", 
pkt
->
	`g‘Addr
());

178  
pkt
;

179 
	}
}

182 
Tick


183 
	gBa£P»ãtch”
::
	$nÙify
(
Pack‘PŒ
 &
pkt
, 
Tick
 
tick
)

185 ià(!
pkt
->
»q
->
	`isUnÿch—bË
(è&& !Õkt->»q->
	`isIn¡F‘ch
(è&& 
ÚlyD©a
)) {

187 
Addr
 
blk_addr
 = 
pkt
->
	`g‘Addr
(è& ~(Addr)(
blkSize
-1);

190 
¡d
::
li¡
<
Deã¼edPack‘
>::
™”©Ü
 
™”
 = 
	`šP»ãtch
(
blk_addr
);

191 ià(
™”
 !ğ
pf
.
	`’d
()) {

192 
	`DPRINTF
(
HWP»ãtch
, "Saw‡ misso‡ queued…refetch‡ddr: "

193 "0x%x,„emovšg it\n", 
blk_addr
);

194 
pfRemovedMSHR
++;

195 
d–‘e
 
™”
->
pkt
->
»q
;

196 
d–‘e
 
™”
->
pkt
;

197 
™”
 = 
pf
.
	`”a£
(iter);

198 ià(
pf
.
	`em±y
())

199 
ÿche
->
	`d—s£¹MemSideBusReque¡
(
Ba£Cache
::
Reque¡_PF
);

207 ià(
£rŸlSquash
) {

208 
™”
 = 
pf
.
	`’d
();

209 ià(
™”
 !ğ
pf
.
	`begš
())

210 
™”
--;

211 !
pf
.
	`em±y
(è&& 
™”
->
tick
 >=ick) {

212 
pfSquashed
++;

213 
	`DPRINTF
(
HWP»ãtch
, "Squashing old…refetch‡ddr: 0x%x\n",

214 
™”
->
pkt
->
	`g‘Addr
());

215 
d–‘e
 
™”
->
pkt
->
»q
;

216 
d–‘e
 
™”
->
pkt
;

217 
™”
 = 
pf
.
	`”a£
(iter);

218 ià(
™”
 !ğ
pf
.
	`begš
())

219 
™”
--;

221 ià(
pf
.
	`em±y
())

222 
ÿche
->
	`d—s£¹MemSideBusReque¡
(
Ba£Cache
::
Reque¡_PF
);

226 
¡d
::
li¡
<
Addr
> 
add»s£s
;

227 
¡d
::
li¡
<
Cyşes
> 
d–ays
;

228 
	`ÿlcuÏ‹P»ãtch
(
pkt
, 
add»s£s
, 
d–ays
);

230 
¡d
::
li¡
<
Addr
>::
™”©Ü
 
addrI‹r
 = 
add»s£s
.
	`begš
();

231 
¡d
::
li¡
<
Cyşes
>::
™”©Ü
 
d–ayI‹r
 = 
d–ays
.
	`begš
();

232 ; 
addrI‹r
 !ğ
add»s£s
.
	`’d
(); ++addrI‹r, ++
d–ayI‹r
) {

233 
Addr
 
addr
 = *
addrI‹r
;

235 
pfId’tif›d
++;

237 
	`DPRINTF
(
HWP»ãtch
, "Found‡…f candidate‡ddr: 0x%x, "

239 
addr
, *
d–ayI‹r
, 
time
);

242 ià(
	`šP»ãtch
(
addr
è!ğ
pf
.
	`’d
()) {

243 
pfBufãrH™
++;

244 
	`DPRINTF
(
HWP»ãtch
, "Prefetch‡ddr‡lready in…f buffer\n");

249 
Reque¡
 *
´eãtchReq
 = 
Ãw
 
	`Reque¡
(*
addrI‹r
, 
blkSize
, 0, 
ma¡”Id
);

250 
Pack‘PŒ
 
´eãtch
 =

251 
Ãw
 
	`Pack‘
(
´eãtchReq
, 
MemCmd
::
H¬dPFReq
);

252 
´eãtch
->
	`®loÿ‹
();

253 
´eãtch
->
»q
->
	`£tTh»adCÚ‹xt
(
pkt
->»q->
	`cÚ‹xtId
(),

254 
pkt
->
»q
->
	`th»adId
());

257 ià(
pf
.
	`size
(è=ğ
size
) {

258 
pfRemovedFuÎ
++;

259 
Pack‘PŒ
 
Şd_pkt
 = 
pf
.
	`begš
()->
pkt
;

260 
	`DPRINTF
(
HWP»ãtch
, "Prefetch queue full, "

261 "»movšg olde¡ 0x%x\n", 
Şd_pkt
->
	`g‘Addr
());

262 
d–‘e
 
Şd_pkt
->
»q
;

263 
d–‘e
 
Şd_pkt
;

264 
pf
.
	`pİ_äÚt
();

267 
pf
.
	`push_back
(
	`Deã¼edPack‘
(
tick
 + 
	`şockP”iod
(è* *
d–ayI‹r
,

268 
´eãtch
));

272  
pf
.
	`em±y
(è? 0 :…f.
	`äÚt
().
tick
;

273 
	}
}

275 
	g¡d
::
li¡
<
Ba£P»ãtch”
::
Deã¼edPack‘
>::
™”©Ü


276 
Ba£P»ãtch”
::
	$šP»ãtch
(
Addr
 
add»ss
)

279 
¡d
::
li¡
<
Deã¼edPack‘
>::
™”©Ü
 
™”
;

280 
™”
 = 
pf
.
	`begš
(); i‹¸!ğpf.
	`’d
(); iter++) {

281 ià((
™”
->
pkt
->
	`g‘Addr
(è& ~(
Addr
)(
blkSize
-1)è=ğ
add»ss
) {

282  
™”
;

285  
pf
.
	`’d
();

286 
	}
}

288 
boŞ


289 
	gBa£P»ãtch”
::
	$§mePage
(
Addr
 
a
, Add¸
b
)

291  
	`roundDown
(
a
, 
TheISA
::
VMPageSize
è=ğroundDown(
b
, TheISA::VMPageSize);

292 
	}
}

	@cache/prefetch/base.hh

48 #iâdeà
__MEM_CACHE_PREFETCH_BASE_PREFETCHER_HH__


49 
	#__MEM_CACHE_PREFETCH_BASE_PREFETCHER_HH__


	)

51 
	~<li¡
>

53 
	~"ba£/¡©i¡ics.hh
"

54 
	~"mem/·ck‘.hh
"

55 
	~"·¿ms/Ba£Cache.hh
"

56 
	~"sim/şocked_objeù.hh
"

58 
şass
 
	gBa£Cache
;

60 şas 
	cBa£P»ãtch”
 : 
public
 
ClockedObjeù


62 
´Ùeùed
:

65 şas 
	cDeã¼edPack‘
 {

66 
public
:

67 
Tick
 
tick
;

68 
Pack‘PŒ
 
	mpkt
;

69 
Deã¼edPack‘
(
Tick
 
t
, 
Pack‘PŒ
 
p
)

70 : 
tick
(
t
), 
pkt
(
p
)

75 
	g¡d
::
li¡
<
Deã¼edPack‘
> 
pf
;

80 cÚ¡ 
	gsize
;

83 
Ba£Cache
* 
	gÿche
;

86 
	gblkSize
;

89 cÚ¡ 
Cyşes
 
	gÏ‹ncy
;

92 
	gdeg»e
;

95 
boŞ
 
	gu£Ma¡”Id
;

97 
boŞ
 
	g·geStİ
;

100 
boŞ
 
	g£rŸlSquash
;

103 
boŞ
 
	gÚlyD©a
;

106 
Sy¡em
* 
	gsy¡em
;

109 
Ma¡”ID
 
	gma¡”Id
;

111 
	gpublic
:

113 
Sts
::
SÿÏr
 
pfId’tif›d
;

114 
	gSts
::
SÿÏr
 
pfMSHRH™
;

115 
	gSts
::
SÿÏr
 
pfCacheH™
;

116 
	gSts
::
SÿÏr
 
pfBufãrH™
;

117 
	gSts
::
SÿÏr
 
pfRemovedFuÎ
;

118 
	gSts
::
SÿÏr
 
pfRemovedMSHR
;

119 
	gSts
::
SÿÏr
 
pfIssued
;

120 
	gSts
::
SÿÏr
 
pfS·nPage
;

121 
	gSts
::
SÿÏr
 
pfSquashed
;

123 
»gSts
();

125 
	gpublic
:

126 
Ba£P»ãtch”P¬ams
 
	tP¬ams
;

127 
Ba£P»ãtch”
(cÚ¡ 
P¬ams
 *
p
);

129 
	gvœtu®
 ~
	$Ba£P»ãtch”
(è{
	}
}

131 
£tCache
(
Ba£Cache
 *
_ÿche
);

138 
Tick
 
nÙify
(
Pack‘PŒ
 &
pkt
, Tick 
tick
);

140 
boŞ
 
šCache
(
Addr
 
addr
);

142 
boŞ
 
šMissQueue
(
Addr
 
addr
);

144 
Pack‘PŒ
 
g‘Pack‘
();

146 
boŞ
 
	$haveP’dšg
()

148  !
pf
.
	`em±y
();

149 
	}
}

151 
Tick
 
	$ÃxtP»ãtchR—dyTime
()

153  
pf
.
	`em±y
(è? 
MaxTick
 :…f.
	`äÚt
().
tick
;

154 
	}
}

156 
vœtu®
 
ÿlcuÏ‹P»ãtch
(
Pack‘PŒ
 &
pkt
,

157 
¡d
::
li¡
<
Addr
> &
add»s£s
,

158 
¡d
::
li¡
<
Cyşes
> &
d–ays
) = 0;

160 
	g¡d
::
li¡
<
Deã¼edPack‘
>::
™”©Ü
 
šP»ãtch
(
Addr
 
add»ss
);

165 
boŞ
 
§mePage
(
Addr
 
a
, Add¸
b
);

166 
	gpublic
:

167 cÚ¡ 
P¬ams
*

168 
	$·¿ms
() const

170  
dyÇmic_ÿ¡
<cÚ¡ 
P¬ams
 *>(
_·¿ms
);

171 
	}
}

	@cache/prefetch/ghb.cc

37 
	~"ba£/Œaû.hh
"

38 
	~"debug/HWP»ãtch.hh
"

39 
	~"mem/ÿche/´eãtch/ghb.hh
"

42 
	gGHBP»ãtch”
::
ÿlcuÏ‹P»ãtch
(
Pack‘PŒ
 &
pkt
, 
¡d
::
li¡
<
Addr
> &
add»s£s
,

43 
¡d
::
li¡
<
Cyşes
> &
d–ays
)

45 
Addr
 
blk_addr
 = 
pkt
->
g‘Addr
(è& ~(Addr)(
blkSize
-1);

46 
	gma¡”_id
 = 
u£Ma¡”Id
 ? 
pkt
->
»q
->
ma¡”Id
() : 0;

47 
as£¹
(
ma¡”_id
 < 
Max_Ma¡”s
);

49 
	gÃw_¡ride
 = 
blk_addr
 - 
Ï¡MissAddr
[
ma¡”_id
];

50 
	gŞd_¡ride
 = 
Ï¡MissAddr
[
ma¡”_id
] - 
£cÚdLa¡MissAddr
[master_id];

52 
	g£cÚdLa¡MissAddr
[
ma¡”_id
] = 
Ï¡MissAddr
[master_id];

53 
	gÏ¡MissAddr
[
ma¡”_id
] = 
blk_addr
;

55 ià(
	gÃw_¡ride
 =ğ
Şd_¡ride
) {

56 
d
 = 1; 
	gd
 <ğ
deg»e
; d++) {

57 
Addr
 
	gÃw_addr
 = 
blk_addr
 + 
d
 * 
Ãw_¡ride
;

58 ià(
	g·geStİ
 && !
§mePage
(
blk_addr
, 
Ãw_addr
)) {

60 
	gpfS·nPage
 +ğ
deg»e
 - 
d
 + 1;

63 
	gadd»s£s
.
push_back
(
Ãw_addr
);

64 
	gd–ays
.
push_back
(
Ï‹ncy
);

71 
GHBP»ãtch”
*

72 
	gGHBP»ãtch”P¬ams
::
	$ü—‹
()

74  
Ãw
 
	`GHBP»ãtch”
(
this
);

75 
	}
}

	@cache/prefetch/ghb.hh

36 #iâdeà
__MEM_CACHE_PREFETCH_GHB_PREFETCHER_HH__


37 
	#__MEM_CACHE_PREFETCH_GHB_PREFETCHER_HH__


	)

39 
	~"mem/ÿche/´eãtch/ba£.hh
"

40 
	~"·¿ms/GHBP»ãtch”.hh
"

42 şas 
	cGHBP»ãtch”
 : 
public
 
Ba£P»ãtch”


44 
´Ùeùed
:

46 cÚ¡ 
Max_Ma¡”s
 = 64;

48 
Addr
 
	m£cÚdLa¡MissAddr
[
Max_Ma¡”s
];

49 
Addr
 
	mÏ¡MissAddr
[
Max_Ma¡”s
];

51 
	mpublic
:

52 
	$GHBP»ãtch”
(cÚ¡ 
P¬ams
 *
p
)

53 : 
	$Ba£P»ãtch”
(
p
)

57 ~
	$GHBP»ãtch”
(è{
	}
}

59 
ÿlcuÏ‹P»ãtch
(
Pack‘PŒ
 &
pkt
, 
¡d
::
li¡
<
Addr
> &
add»s£s
,

60 
¡d
::
li¡
<
Cyşes
> &
d–ays
);

	@cache/prefetch/stride.cc

37 
	~"ba£/Œaû.hh
"

38 
	~"debug/HWP»ãtch.hh
"

39 
	~"mem/ÿche/´eãtch/¡ride.hh
"

42 
	gSŒideP»ãtch”
::
ÿlcuÏ‹P»ãtch
(
Pack‘PŒ
 &
pkt
, 
¡d
::
li¡
<
Addr
> &
add»s£s
,

43 
¡d
::
li¡
<
Cyşes
> &
d–ays
)

45 ià(!
pkt
->
»q
->
hasPC
()) {

46 
DPRINTF
(
HWP»ãtch
, "ignoring„equest with‚o PC");

50 
Addr
 
	gblk_addr
 = 
pkt
->
g‘Addr
(è& ~(Addr)(
blkSize
-1);

51 
Ma¡”ID
 
	gma¡”_id
 = 
u£Ma¡”Id
 ? 
pkt
->
»q
->
ma¡”Id
() : 0;

52 
Addr
 
	gpc
 = 
pkt
->
»q
->
g‘PC
();

53 
as£¹
(
ma¡”_id
 < 
Max_CÚ‹xts
);

54 
	g¡d
::
li¡
<
SŒideEÁry
*> &
b
 = 
bË
[
ma¡”_id
];

57 
	g¡d
::
li¡
<
SŒideEÁry
*>::
™”©Ü
 
™”
;

58 
	g™”
 = 
b
.
begš
(); i‹¸!ğb.
’d
(); iter++) {

59 ià((*
	g™”
)->
	gš¡Addr
 =ğ
pc
)

63 ià(
	g™”
 !ğ
b
.
’d
()) {

66 
Ãw_¡ride
 = 
blk_addr
 - (*
™”
)->
missAddr
;

67 
boŞ
 
	g¡ride_m©ch
 = (
Ãw_¡ride
 =ğ(*
™”
)->
¡ride
);

69 ià(
	g¡ride_m©ch
 && 
	gÃw_¡ride
 != 0) {

70 ià((*
™”
)->
cÚfid’û
 < 
Max_CÚf
)

71 (*
™”
)->
cÚfid’û
++;

73 (*
	g™”
)->
	g¡ride
 = 
Ãw_¡ride
;

74 ià((*
	g™”
)->
	gcÚfid’û
 > 
	gMš_CÚf
)

75 (*
	g™”
)->
	gcÚfid’û
 = 0;

78 
DPRINTF
(
HWP»ãtch
, "hit: PC %x blk_addr %x stride %d (%s), conf %d\n",

79 
pc
, 
blk_addr
, 
Ãw_¡ride
, 
¡ride_m©ch
 ? "match" : "change",

80 (*
™”
)->
cÚfid’û
);

82 (*
	g™”
)->
	gmissAddr
 = 
blk_addr
;

84 ià((*
	g™”
)->
	gcÚfid’û
 <= 0)

87 
	gd
 = 1; d <ğ
deg»e
; d++) {

88 
Addr
 
	gÃw_addr
 = 
blk_addr
 + 
d
 * 
Ãw_¡ride
;

89 ià(
	g·geStİ
 && !
§mePage
(
blk_addr
, 
Ãw_addr
)) {

91 
	gpfS·nPage
 +ğ
deg»e
 - 
d
 + 1;

94 
DPRINTF
(
HWP»ãtch
, " queuing…refetcho %x @ %d\n",

95 
Ãw_addr
, 
Ï‹ncy
);

96 
	gadd»s£s
.
push_back
(
Ãw_addr
);

97 
	gd–ays
.
push_back
(
Ï‹ncy
);

104 
DPRINTF
(
HWP»ãtch
, "miss: PC %x blk_add¸%x\n", 
pc
, 
blk_addr
);

106 ià(
	gb
.
size
() >= 256) {

107 
¡d
::
li¡
<
SŒideEÁry
*>::
™”©Ü
 
mš_pos
 = 
b
.
begš
();

108 
	gmš_cÚf
 = (*
mš_pos
)->
cÚfid’û
;

109 
	g™”
 = 
mš_pos
, ++™”; i‹¸!ğ
b
.
’d
(); ++iter) {

110 ià((*
	g™”
)->
	gcÚfid’û
 < 
	gmš_cÚf
){

111 
	gmš_pos
 = 
™”
;

112 
	gmš_cÚf
 = (*
™”
)->
cÚfid’û
;

115 
DPRINTF
(
HWP»ãtch
, "„•Ïcšg PC %x\n", (*
mš_pos
)->
š¡Addr
);

118 
d–‘e
 *
	gmš_pos
;

119 
	gb
.
”a£
(
mš_pos
);

122 
SŒideEÁry
 *
	gÃw_’Œy
 = 
Ãw
 StrideEntry;

123 
	gÃw_’Œy
->
	gš¡Addr
 = 
pc
;

124 
	gÃw_’Œy
->
	gmissAddr
 = 
blk_addr
;

125 
	gÃw_’Œy
->
	g¡ride
 = 0;

126 
	gÃw_’Œy
->
	gcÚfid’û
 = 0;

127 
	gb
.
push_back
(
Ãw_’Œy
);

132 
SŒideP»ãtch”
*

133 
	gSŒideP»ãtch”P¬ams
::
	$ü—‹
()

135  
Ãw
 
	`SŒideP»ãtch”
(
this
);

136 
	}
}

	@cache/prefetch/stride.hh

36 #iâdeà
__MEM_CACHE_PREFETCH_STRIDE_PREFETCHER_HH__


37 
	#__MEM_CACHE_PREFETCH_STRIDE_PREFETCHER_HH__


	)

39 
	~<şim™s
>

41 
	~"mem/ÿche/´eãtch/ba£.hh
"

42 
	~"·¿ms/SŒideP»ãtch”.hh
"

44 şas 
	cSŒideP»ãtch”
 : 
public
 
Ba£P»ãtch”


46 
´Ùeùed
:

48 cÚ¡ 
Max_CÚ‹xts
 = 64;

52 cÚ¡ 
	mMax_CÚf
 = 
INT_MAX
;

53 cÚ¡ 
	mMš_CÚf
 = 
INT_MIN
;

55 şas 
	cSŒideEÁry


57 
	mpublic
:

58 
Addr
 
š¡Addr
;

59 
Addr
 
	mmissAddr
;

60 
	m¡ride
;

61 
	mcÚfid’û
;

64 
Addr
 *
	gÏ¡MissAddr
[
Max_CÚ‹xts
];

66 
	g¡d
::
li¡
<
SŒideEÁry
*> 
bË
[
Max_CÚ‹xts
];

68 
	gpublic
:

70 
	$SŒideP»ãtch”
(cÚ¡ 
P¬ams
 *
p
)

71 : 
	$Ba£P»ãtch”
(
p
)

73 
	}
}

75 ~
	$SŒideP»ãtch”
(è{
	}
}

77 
ÿlcuÏ‹P»ãtch
(
Pack‘PŒ
 &
pkt
, 
¡d
::
li¡
<
Addr
> &
add»s£s
,

78 
¡d
::
li¡
<
Cyşes
> &
d–ays
);

	@cache/prefetch/tagged.cc

36 
	~"mem/ÿche/´eãtch/gged.hh
"

38 
	gTaggedP»ãtch”
::
	$TaggedP»ãtch”
(cÚ¡ 
P¬ams
 *
p
)

39 : 
	$Ba£P»ãtch”
(
p
)

41 
	}
}

44 
TaggedP»ãtch”
::

45 
ÿlcuÏ‹P»ãtch
(
Pack‘PŒ
 &
pkt
, 
¡d
::
li¡
<
Addr
> &
add»s£s
,

46 
¡d
::
li¡
<
Cyşes
> &
d–ays
)

48 
Addr
 
blkAddr
 = 
pkt
->
g‘Addr
(è& ~(Addr)(
blkSize
-1);

50 
	gd
 = 1; d <ğ
deg»e
; d++) {

51 
Addr
 
	gÃwAddr
 = 
blkAddr
 + 
d
*(
blkSize
);

52 ià(
	g·geStİ
 && !
§mePage
(
blkAddr
, 
ÃwAddr
)) {

54 
	gpfS·nPage
 +ğ
deg»e
 - 
d
 + 1;

57 
	gadd»s£s
.
push_back
(
ÃwAddr
);

58 
	gd–ays
.
push_back
(
Ï‹ncy
);

64 
TaggedP»ãtch”
*

65 
	gTaggedP»ãtch”P¬ams
::
	$ü—‹
()

67  
Ãw
 
	`TaggedP»ãtch”
(
this
);

68 
	}
}

	@cache/prefetch/tagged.hh

36 #iâdeà
__MEM_CACHE_PREFETCH_TAGGED_PREFETCHER_HH__


37 
	#__MEM_CACHE_PREFETCH_TAGGED_PREFETCHER_HH__


	)

39 
	~"mem/ÿche/´eãtch/ba£.hh
"

40 
	~"·¿ms/TaggedP»ãtch”.hh
"

43 şas 
	cTaggedP»ãtch”
 : 
public
 
Ba£P»ãtch”


45 
public
:

47 
TaggedP»ãtch”
(cÚ¡ 
P¬ams
 *
p
);

49 ~
	$TaggedP»ãtch”
() {}

51 
	`ÿlcuÏ‹P»ãtch
(
Pack‘PŒ
 &
pkt
, 
¡d
::
li¡
<
Addr
> &
add»s£s
,

52 
¡d
::
li¡
<
Cyşes
> &
d–ays
);

53 
	}
};

	@cache/tags/base.cc

49 
	~"cÚfig/the_i§.hh
"

50 
	~"ıu/smt.hh
"

51 
	~"mem/ÿche/gs/ba£.hh
"

52 
	~"mem/ÿche/ba£.hh
"

53 
	~"sim/sim_ex™.hh
"

55 
usšg
 
Çme¥aû
 
	g¡d
;

57 
	gBa£Tags
::
	$Ba£Tags
(cÚ¡ 
P¬ams
 *
p
)

58 : 
	`ClockedObjeù
(
p
), 
	`blkSize
Õ->
block_size
), 
	`size
Õ->
size
),

59 
	`h™L©’cy
(
p
->
h™_Ï‹ncy
)

61 
	}
}

64 
	gBa£Tags
::
	$£tCache
(
Ba£Cache
 *
_ÿche
)

66 
ÿche
 = 
_ÿche
;

67 
	}
}

70 
	gBa£Tags
::
	$»gSts
()

72 
usšg
 
Çme¥aû
 
Sts
;

73 
»¶aûm’ts


74 .
	`š™
(
maxTh»adsP”CPU
)

75 .
	`Çme
(name() + ".replacements")

76 .
	`desc
("number of„eplacements")

77 .
	`æags
(
tÙ®
)

80 
gsInU£


81 .
	`Çme
(name() + ".tagsinuse")

82 .
	`desc
("Cycle‡verage ofags in use")

85 
tÙ®Refs


86 .
	`Çme
(name() + ".total_refs")

87 .
	`desc
("Total‚umber of„eferenceso valid blocks.")

90 
§m¶edRefs


91 .
	`Çme
(name() + ".sampled_refs")

92 .
	`desc
("Sample count of„eferenceso valid blocks.")

95 
avgRefs


96 .
	`Çme
(name() + ".avg_refs")

97 .
	`desc
("Average‚umber of„eferenceso valid blocks.")

100 
avgRefs
 = 
tÙ®Refs
/
§m¶edRefs
;

102 
w¬mupCyşe


103 .
	`Çme
(name() + ".warmup_cycle")

104 .
	`desc
("Cycle whenhe warmup…ercentage was hit.")

107 
occu·nc›s


108 .
	`š™
(
ÿche
->
sy¡em
->
	`maxMa¡”s
())

109 .
	`Çme
(name() + ".occ_blocks")

110 .
	`desc
("Average occupied blocks…er„equestor")

111 .
	`æags
(
noz”o
 | 
nÚª
)

113 
i
 = 0; i < 
ÿche
->
sy¡em
->
	`maxMa¡”s
(); i++) {

114 
occu·nc›s
.
	`subÇme
(
i
, 
ÿche
->
sy¡em
->
	`g‘Ma¡”Name
(i));

117 
avgOccs


118 .
	`Çme
(name() + ".occ_percent")

119 .
	`desc
("Average…ercentage of cache occupancy")

120 .
	`æags
(
noz”o
 | 
tÙ®
)

122 
i
 = 0; i < 
ÿche
->
sy¡em
->
	`maxMa¡”s
(); i++) {

123 
avgOccs
.
	`subÇme
(
i
, 
ÿche
->
sy¡em
->
	`g‘Ma¡”Name
(i));

126 
avgOccs
 = 
occu·nc›s
 / 
Sts
::
	`cÚ¡ªt
(
numBlocks
);

128 
	`»gi¡”Ex™C®lback
(
Ãw
 
	`Ba£TagsC®lback
(
this
));

129 
	}
}

	@cache/tags/base.hh

49 #iâdeà
__BASE_TAGS_HH__


50 
	#__BASE_TAGS_HH__


	)

52 
	~<¡ršg
>

54 
	~"ba£/ÿÎback.hh
"

55 
	~"ba£/¡©i¡ics.hh
"

56 
	~"·¿ms/Ba£Tags.hh
"

57 
	~"sim/şocked_objeù.hh
"

59 
şass
 
	gBa£Cache
;

64 şas 
	cBa£Tags
 : 
public
 
ClockedObjeù


66 
´Ùeùed
:

68 cÚ¡ 
blkSize
;

70 cÚ¡ 
	msize
;

72 cÚ¡ 
Cyşes
 
	mh™L©’cy
;

75 
Ba£Cache
 *
	mÿche
;

81 
	mw¬mupBound
;

83 
boŞ
 
	mw¬medUp
;

86 
	mnumBlocks
;

95 
	mSts
::
VeùÜ
 
»¶aûm’ts
;

97 
	mSts
::
Av”age
 
gsInU£
;

100 
	mSts
::
SÿÏr
 
tÙ®Refs
;

107 
	mSts
::
SÿÏr
 
§m¶edRefs
;

113 
	mSts
::
FÜmuÏ
 
avgRefs
;

116 
	mSts
::
SÿÏr
 
w¬mupCyşe
;

119 
	mSts
::
Av”ageVeùÜ
 
occu·nc›s
;

122 
	mSts
::
FÜmuÏ
 
avgOccs
;

128 
	mpublic
:

129 
Ba£TagsP¬ams
 
	tP¬ams
;

130 
Ba£Tags
(cÚ¡ 
P¬ams
 *
p
);

135 
	mvœtu®
 ~
	$Ba£Tags
() {}

141 
	`£tCache
(
Ba£Cache
 *
_ÿche
);

146 
	`»gSts
();

152 
vœtu®
 
	$ş—nupRefs
(è{
	}
}

158 
vœtu®
 
	$ş—rLocks
(è{
	}
}

163 
vœtu®
 
	g¡d
::
¡ršg
 
	$´št
() const = 0;

164 
	}
};

166 şas 
	cBa£TagsC®lback
 : 
public
 
C®lback


168 
Ba£Tags
 *
gs
;

169 
	mpublic
:

170 
	$Ba£TagsC®lback
(
Ba£Tags
 *
t
è: 
	$gs
(
t
) {}

171 
vœtu®
 
	$´oûss
(è{ 
gs
->
	`ş—nupRefs
(); 
	}
};

	@cache/tags/cacheset.hh

48 #iâdeà
__CACHESET_HH__


49 
	#__CACHESET_HH__


	)

51 
	~<ÿs£¹
>

53 
	~"mem/ÿche/blk.hh
"

58 
	g‹m¶©e
 <
şass
 
	gBlkty³
>

59 şas 
	cCacheS‘


61 
	mpublic
:

63 
assoc
;

66 
Blkty³
 **
	mblks
;

74 
Blkty³
* 
	$fšdBlk
(
Addr
 
g
, & 
way_id
) const ;

75 
Blkty³
* 
	$fšdBlk
(
Addr
 
g
) const ;

81 
	`moveToH—d
(
Blkty³
 *
blk
);

87 
	`moveToTa
(
Blkty³
 *
blk
);

91 
‹m¶©e
 <
şass
 
Blkty³
>

92 
Blkty³
*

93 
CacheS‘
<
Blkty³
>::
	$fšdBlk
(
Addr
 
g
, & 
way_id
) const

99 
way_id
 = 
assoc
;

100 
i
 = 0; i < 
assoc
; ++i) {

101 ià(
blks
[
i
]->
g
 =ğg && blks[i]->
	`isV®id
()) {

102 
way_id
 = 
i
;

103  
blks
[
i
];

106  
NULL
;

107 
	}
}

109 
	g‹m¶©e
 <
şass
 
	gBlkty³
>

110 
Blkty³
*

111 
	gCacheS‘
<
	gBlkty³
>::
	$fšdBlk
(
Addr
 
g
) const

113 
ignÜed_way_id
;

114  
	`fšdBlk
(
g
, 
ignÜed_way_id
);

115 
	}
}

117 
	g‹m¶©e
 <
şass
 
	gBlkty³
>

119 
	gCacheS‘
<
	gBlkty³
>::
	$moveToH—d
(
Blkty³
 *
blk
)

122 ià(
blks
[0] =ğ
blk
)

129 
i
 = 0;

130 
Blkty³
 *
Ãxt
 = 
blk
;

133 
	`as£¹
(
i
 < 
assoc
);

135 
Blkty³
 *
tmp
 = 
blks
[
i
];

136 
blks
[
i
] = 
Ãxt
;

137 
Ãxt
 = 
tmp
;

138 ++
i
;

139 } 
Ãxt
 !ğ
blk
);

140 
	}
}

142 
	g‹m¶©e
 <
şass
 
	gBlkty³
>

144 
	gCacheS‘
<
	gBlkty³
>::
	$moveToTa
(
Blkty³
 *
blk
)

147 ià(
blks
[
assoc
 - 1] =ğ
blk
)

154 
i
 = 
assoc
 - 1;

155 
Blkty³
 *
Ãxt
 = 
blk
;

158 
	`as£¹
(
i
 >= 0);

160 
Blkty³
 *
tmp
 = 
blks
[
i
];

161 
blks
[
i
] = 
Ãxt
;

162 
Ãxt
 = 
tmp
;

163 --
i
;

164 } 
Ãxt
 !ğ
blk
);

165 
	}
}

	@cache/tags/fa_lru.cc

48 
	~<ÿs£¹
>

49 
	~<s¡»am
>

51 
	~"ba£/štm©h.hh
"

52 
	~"ba£/misc.hh
"

53 
	~"mem/ÿche/gs/ç_Ìu.hh
"

55 
usšg
 
Çme¥aû
 
	g¡d
;

57 
	gFALRU
::
	$FALRU
(cÚ¡ 
P¬ams
 *
p
)

58 : 
	$Ba£Tags
(
p
)

60 ià(!
	`isPow”Of2
(
blkSize
))

61 
	`çl
("cache block size (in bytes) `%d' must be‡…ower ofwo",

62 
blkSize
);

63 ià(!(
h™L©’cy
 > 0))

64 
	`çl
("Access†atency in cycles must be‡t†east one cycle");

65 ià(!
	`isPow”Of2
(
size
))

66 
	`çl
("Cache Size must be…ower of 2 for‚ow");

69 
numCaches
 = 
	`æoÜLog2
(
size
) - 17;

70 ià(
numCaches
 >0){

71 
ÿcheBound¬›s
 = 
Ãw
 
FALRUBlk
 *[
numCaches
];

72 
ÿcheMask
 = (1 << 
numCaches
) - 1;

74 
ÿcheMask
 = 0;

77 
w¬medUp
 = 
çl£
;

78 
w¬mupBound
 = 
size
/
blkSize
;

79 
numBlocks
 = 
size
/
blkSize
;

81 
blks
 = 
Ãw
 
FALRUBlk
[
numBlocks
];

82 
h—d
 = &(
blks
[0]);

83 

 = &(
blks
[
numBlocks
-1]);

85 
h—d
->
´ev
 = 
NULL
;

86 
h—d
->
Ãxt
 = &(
blks
[1]);

87 
h—d
->
šCache
 = 
ÿcheMask
;

89 

->
´ev
 = &(
blks
[
numBlocks
-2]);

90 

->
Ãxt
 = 
NULL
;

91 

->
šCache
 = 0;

93 
šdex
 = (1 << 17è/ 
blkSize
;

94 
j
 = 0;

95 
æags
 = 
ÿcheMask
;

96 
i
 = 1; i < 
numBlocks
 - 1; i++) {

97 
blks
[
i
].
šCache
 = 
æags
;

98 ià(
i
 =ğ
šdex
 - 1){

99 
ÿcheBound¬›s
[
j
] = &(
blks
[
i
]);

100 
æags
 &ğ~ (1<<
j
);

101 ++
j
;

102 
šdex
 = index << 1;

104 
blks
[
i
].
´ev
 = &(blks[i-1]);

105 
blks
[
i
].
Ãxt
 = &(blks[i+1]);

106 
blks
[
i
].
isTouched
 = 
çl£
;

108 
	`as£¹
(
j
 =ğ
numCaches
);

109 
	`as£¹
(
šdex
 =ğ
numBlocks
);

111 
	}
}

113 
	gFALRU
::~
	$FALRU
()

115 ià(
numCaches
)

116 
d–‘e
[] 
ÿcheBound¬›s
;

118 
d–‘e
[] 
blks
;

119 
	}
}

122 
	gFALRU
::
	$»gSts
()

124 
usšg
 
Çme¥aû
 
Sts
;

125 
Ba£Tags
::
	`»gSts
();

126 
h™s


127 .
	`š™
(
numCaches
+1)

128 .
	`Çme
(name() + ".falru_hits")

129 .
	`desc
("The‚umber of hits inƒach cache size.")

131 
mis£s


132 .
	`š™
(
numCaches
+1)

133 .
	`Çme
(name() + ".falru_misses")

134 .
	`desc
("The‚umber of misses inƒach cache size.")

136 
acûs£s


137 .
	`Çme
(name() + ".falru_accesses")

138 .
	`desc
("The‚umber of‡ccessesohe FA LRU cache.")

141 
i
 = 0; i <ğ
numCaches
; ++i) {

142 
¡ršg¡»am
 
size_¡r
;

143 ià(
i
 < 3){

144 
size_¡r
 << (1<<(
i
+7)) <<"K";

146 
size_¡r
 << (1<<(
i
-3)) <<"M";

149 
h™s
.
	`subÇme
(
i
, 
size_¡r
.
	`¡r
());

150 
h™s
.
	`subdesc
(
i
, "H™ š‡ " + 
size_¡r
.
	`¡r
() +" cache");

151 
mis£s
.
	`subÇme
(
i
, 
size_¡r
.
	`¡r
());

152 
mis£s
.
	`subdesc
(
i
, "Mis£ š‡ " + 
size_¡r
.
	`¡r
() +" cache");

154 
	}
}

156 
FALRUBlk
 *

157 
	gFALRU
::
	$hashLookup
(
Addr
 
addr
) const

159 
gI‹¿tÜ
 
™”
 = 
gHash
.
	`fšd
(
addr
);

160 ià(
™”
 !ğ
gHash
.
	`’d
()) {

161  (*
™”
).
£cÚd
;

163  
NULL
;

164 
	}
}

167 
	gFALRU
::
šv®id©e
(
FALRU
::
BlkTy³
 *
blk
)

169 
as£¹
(
blk
);

170 
	ggsInU£
--;

173 
FALRUBlk
*

174 
	gFALRU
::
	$acûssBlock
(
Addr
 
addr
, 
Cyşes
 &
Ït
, 
cÚ‹xt_¤c
, *
šCache
)

176 
acûs£s
++;

177 
tmp_š_ÿche
 = 0;

178 
Addr
 
blkAddr
 = 
	`blkAlign
(
addr
);

179 
FALRUBlk
* 
blk
 = 
	`hashLookup
(
blkAddr
);

181 ià(
blk
 && blk->
	`isV®id
()) {

182 
	`as£¹
(
blk
->
g
 =ğ
blkAddr
);

183 
tmp_š_ÿche
 = 
blk
->
šCache
;

184 
i
 = 0; i < 
numCaches
; i++) {

185 ià(1<<
i
 & 
blk
->
šCache
) {

186 
h™s
[
i
]++;

188 
mis£s
[
i
]++;

191 
h™s
[
numCaches
]++;

192 ià(
blk
 !ğ
h—d
){

193 
	`moveToH—d
(
blk
);

196 
blk
 = 
NULL
;

197 
i
 = 0; i <ğ
numCaches
; ++i) {

198 
mis£s
[
i
]++;

201 ià(
šCache
) {

202 *
šCache
 = 
tmp_š_ÿche
;

205 
Ït
 = 
h™L©’cy
;

207  
blk
;

208 
	}
}

211 
FALRUBlk
*

212 
	gFALRU
::
	$fšdBlock
(
Addr
 
addr
) const

214 
Addr
 
blkAddr
 = 
	`blkAlign
(
addr
);

215 
FALRUBlk
* 
blk
 = 
	`hashLookup
(
blkAddr
);

217 ià(
blk
 && blk->
	`isV®id
()) {

218 
	`as£¹
(
blk
->
g
 =ğ
blkAddr
);

220 
blk
 = 
NULL
;

222  
blk
;

223 
	}
}

225 
FALRUBlk
*

226 
	gFALRU
::
	$fšdViùim
(
Addr
 
addr
, 
Pack‘Li¡
 &
wr™ebacks
)

228 
FALRUBlk
 * 
blk
 = 

;

229 
	`as£¹
(
blk
->
šCache
 == 0);

230 
	`moveToH—d
(
blk
);

231 
gHash
.
	`”a£
(
blk
->
g
);

232 
gHash
[
	`blkAlign
(
addr
)] = 
blk
;

233 ià(
blk
->
	`isV®id
()) {

234 
»¶aûm’ts
[0]++;

236 
gsInU£
++;

237 
blk
->
isTouched
 = 
Œue
;

238 ià(!
w¬medUp
 && 
gsInU£
.
	`v®ue
(è>ğ
w¬mupBound
) {

239 
w¬medUp
 = 
Œue
;

240 
w¬mupCyşe
 = 
	`curTick
();

244  
blk
;

245 
	}
}

248 
	gFALRU
::
š£¹Block
(
Pack‘PŒ
 
pkt
, 
FALRU
::
BlkTy³
 *
blk
)

253 
FALRU
::
	$moveToH—d
(
FALRUBlk
 *
blk
)

255 
upd©eMask
 = 
blk
->
šCache
 ^ 
ÿcheMask
;

256 
i
 = 0; i < 
numCaches
; i++){

257 ià((1<<
i
è& 
upd©eMask
) {

258 
ÿcheBound¬›s
[
i
]->
šCache
 &= ~(1<<i);

259 
ÿcheBound¬›s
[
i
] = cacheBound¬›s[i]->
´ev
;

260 } ià(
ÿcheBound¬›s
[
i
] =ğ
blk
) {

261 
ÿcheBound¬›s
[
i
] = 
blk
->
´ev
;

264 
blk
->
šCache
 = 
ÿcheMask
;

265 ià(
blk
 !ğ
h—d
) {

266 ià(
blk
 =ğ

){

267 
	`as£¹
(
blk
->
Ãxt
 =ğ
NULL
);

268 

 = 
blk
->
´ev
;

269 

->
Ãxt
 = 
NULL
;

271 
blk
->
´ev
->
Ãxt
 = blk->next;

272 
blk
->
Ãxt
->
´ev
 = blk->prev;

274 
blk
->
Ãxt
 = 
h—d
;

275 
blk
->
´ev
 = 
NULL
;

276 
h—d
->
´ev
 = 
blk
;

277 
h—d
 = 
blk
;

279 
	}
}

281 
boŞ


282 
	gFALRU
::
	$check
()

284 
FALRUBlk
* 
blk
 = 
h—d
;

285 
tÙ_size
 = 0;

286 
bound¬y
 = 1<<17;

287 
j
 = 0;

288 
æags
 = 
ÿcheMask
;

289 
blk
) {

290 
tÙ_size
 +ğ
blkSize
;

291 ià(
blk
->
šCache
 !ğ
æags
) {

292  
çl£
;

294 ià(
tÙ_size
 =ğ
bound¬y
 && 
blk
 !ğ

) {

295 ià(
ÿcheBound¬›s
[
j
] !ğ
blk
) {

296  
çl£
;

298 
æags
 &=~(1 << 
j
);

299 
bound¬y
 = boundary<<1;

300 ++
j
;

302 
blk
 = blk->
Ãxt
;

304  
Œue
;

305 
	}
}

308 
	gFALRU
::
	$ş—rLocks
()

310 
i
 = 0; i < 
numBlocks
; i++){

311 
blks
[
i
].
	`ş—rLßdLocks
();

313 
	}
}

315 
FALRU
 *

316 
	gFALRUP¬ams
::
	$ü—‹
()

318  
Ãw
 
	`FALRU
(
this
);

319 
	}
}

	@cache/tags/fa_lru.hh

48 #iâdeà
__MEM_CACHE_TAGS_FA_LRU_HH__


49 
	#__MEM_CACHE_TAGS_FA_LRU_HH__


	)

51 
	~<li¡
>

53 
	~"ba£/hashm­.hh
"

54 
	~"mem/ÿche/gs/ba£.hh
"

55 
	~"mem/ÿche/blk.hh
"

56 
	~"mem/·ck‘.hh
"

57 
	~"·¿ms/FALRU.hh
"

62 şas 
	cFALRUBlk
 : 
public
 
CacheBlk


64 
public
:

66 
FALRUBlk
 *
´ev
;

68 
FALRUBlk
 *
	mÃxt
;

70 
boŞ
 
	misTouched
;

80 
	mšCache
;

87 şas 
	cFALRU
 : 
public
 
Ba£Tags


89 
public
:

91 
FALRUBlk
 
	tBlkTy³
;

93 
	m¡d
::
	tli¡
<
	tFALRUBlk
*> 
	tBlkLi¡
;

95 
	m´Ùeùed
:

97 
FALRUBlk
 **
ÿcheBound¬›s
;

99 
	mÿcheMask
;

101 
	mnumCaches
;

104 
FALRUBlk
 *
	mblks
;

107 
FALRUBlk
 *
	mh—d
;

109 
FALRUBlk
 *
	m
;

112 
	mm5
::
	thash_m­
<
	tAddr
, 
	tFALRUBlk
 *, 
	tm5
::
	thash
<Addr> > 
	thash_t
;

114 
	mhash_t
::
	tcÚ¡_™”©Ü
 
	tgI‹¿tÜ
;

117 
hash_t
 
	mgHash
;

124 
FALRUBlk
 * 
	$hashLookup
(
Addr
 
addr
) const;

130 
	`moveToH—d
(
FALRUBlk
 *
blk
);

137 
boŞ
 
	`check
();

147 
Sts
::
VeùÜ
 
h™s
;

149 
Sts
::
VeùÜ
 
mis£s
;

151 
Sts
::
SÿÏr
 
acûs£s
;

157 
public
:

159 
FALRUP¬ams
 
	tP¬ams
;

164 
	`FALRU
(cÚ¡ 
P¬ams
 *
p
);

165 ~
	`FALRU
();

171 
	`»gSts
();

177 
	`šv®id©e
(
BlkTy³
 *
blk
);

190 
FALRUBlk
* 
	`acûssBlock
(
Addr
 
addr
, 
Cyşes
 &
Ït
, 
cÚ‹xt_¤c
, *
šCache
 = 0);

198 
FALRUBlk
* 
	$fšdBlock
(
Addr
 
addr
) const;

206 
FALRUBlk
* 
	`fšdViùim
(
Addr
 
addr
, 
Pack‘Li¡
 & 
wr™ebacks
);

208 
	`š£¹Block
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *
blk
);

214 
Cyşes
 
	$g‘H™L©’cy
() const

216  
h™L©’cy
;

224 
	$g‘BlockSize
() const

226  
blkSize
;

227 
	}
}

234 
	$g‘SubBlockSize
() const

236  
blkSize
;

237 
	}
}

244 
Addr
 
	$blkAlign
(
Addr
 
addr
) const

246  (
addr
 & ~(
Addr
)(
blkSize
-1));

247 
	}
}

255 
Addr
 
	$exŒaùTag
(
Addr
 
addr
) const

257  
	`blkAlign
(
addr
);

258 
	}
}

265 
	$exŒaùS‘
(
Addr
 
addr
) const

268 
	}
}

275 
	$exŒaùBlkOff£t
(
Addr
 
addr
) const

277  (
addr
 & (
Addr
)(
blkSize
-1));

278 
	}
}

286 
Addr
 
	$»g’”©eBlkAddr
(
Addr
 
g
, 
£t
) const

288  (
g
);

289 
	}
}

295 
vœtu®
 
ş—rLocks
();

300 
vœtu®
 
	g¡d
::
¡ršg
 
	$´št
(ècÚ¡ {  ""; 
	}
}

314 
	g‹m¶©e
 <
ty³Çme
 
	gV
>

315 
	$fÜEachBlk
(
V
 &
vis™Ü
) {

316 
i
 = 0; i < 
numBlocks
; i++) {

317 ià(!
	`vis™Ü
(
blks
[
i
]))

320 
	}
}

	@cache/tags/lru.cc

48 
	~<¡ršg
>

50 
	~"ba£/štm©h.hh
"

51 
	~"debug/Cache.hh
"

52 
	~"debug/CacheR•l.hh
"

53 
	~"mem/ÿche/gs/Ìu.hh
"

54 
	~"mem/ÿche/ba£.hh
"

55 
	~"sim/cÜe.hh
"

57 
usšg
 
Çme¥aû
 
	g¡d
;

59 
	gLRU
::
	$LRU
(cÚ¡ 
P¬ams
 *
p
)

60 :
	`Ba£Tags
(
p
), 
	`assoc
Õ->
assoc
),

61 
	`numS‘s
(
p
->
size
 / (p->
block_size
 *…->
assoc
))

64 ià(
blkSize
 < 4 || !
	`isPow”Of2
(blkSize)) {

65 
	`çl
("Block size must be‡t†east 4‡nd‡…ower of 2");

67 ià(
numS‘s
 <ğ0 || !
	`isPow”Of2
(numSets)) {

68 
	`çl
("# of sets must be‚on-zero‡nd‡…ower of 2");

70 ià(
assoc
 <= 0) {

71 
	`çl
("associativity must be greaterhan zero");

73 ià(
h™L©’cy
 <= 0) {

74 
	`çl
("access†atency must be greaterhan zero");

77 
blkMask
 = 
blkSize
 - 1;

78 
£tShiá
 = 
	`æoÜLog2
(
blkSize
);

79 
£tMask
 = 
numS‘s
 - 1;

80 
gShiá
 = 
£tShiá
 + 
	`æoÜLog2
(
numS‘s
);

81 
w¬medUp
 = 
çl£
;

83 
w¬mupBound
 = 
numS‘s
 * 
assoc
;

85 
£ts
 = 
Ãw
 
S‘Ty³
[
numS‘s
];

86 
blks
 = 
Ãw
 
BlkTy³
[
numS‘s
 * 
assoc
];

88 
numBlocks
 = 
numS‘s
 * 
assoc
;

89 
d©aBlks
 = 
Ãw
 
ušt8_t
[
numBlocks
 * 
blkSize
];

91 
blkIndex
 = 0;

92 
i
 = 0; i < 
numS‘s
; ++i) {

93 
£ts
[
i
].
assoc
 =‡ssoc;

95 
£ts
[
i
].
blks
 = 
Ãw
 
BlkTy³
*[
assoc
];

98 
j
 = 0; j < 
assoc
; ++j) {

100 
BlkTy³
 *
blk
 = &
blks
[
blkIndex
];

101 
blk
->
d©a
 = &
d©aBlks
[
blkSize
*
blkIndex
];

102 ++
blkIndex
;

105 
blk
->
	`šv®id©e
();

111 
blk
->
g
 = 
j
;

112 
blk
->
wh’R—dy
 = 0;

113 
blk
->
isTouched
 = 
çl£
;

114 
blk
->
size
 = 
blkSize
;

115 
£ts
[
i
].
blks
[
j
]=
blk
;

116 
blk
->
£t
 = 
i
;

119 
	}
}

121 
	gLRU
::~
	$LRU
()

123 
d–‘e
 [] 
d©aBlks
;

124 
d–‘e
 [] 
blks
;

125 
d–‘e
 [] 
£ts
;

126 
	}
}

128 
	gLRU
::
BlkTy³
*

129 
LRU
::
	$acûssBlock
(
Addr
 
addr
, 
Cyşes
 &
Ït
, 
ma¡”_id
)

131 
Addr
 
g
 = 
	`exŒaùTag
(
addr
);

132 
£t
 = 
	`exŒaùS‘
(
addr
);

133 
BlkTy³
 *
blk
 = 
£ts
[
£t
].
	`fšdBlk
(
g
);

134 
Ït
 = 
h™L©’cy
;

135 ià(
blk
 !ğ
NULL
) {

137 
£ts
[
£t
].
	`moveToH—d
(
blk
);

138 
	`DPRINTF
(
CacheR•l
, "set %x: moving blk %xo MRU\n",

139 
£t
, 
	`»g’”©eBlkAddr
(
g
, set));

140 ià(
blk
->
wh’R—dy
 > 
	`curTick
()

141 && 
ÿche
->
	`ticksToCyşes
(
blk
->
wh’R—dy
 - 
	`curTick
()è> 
h™L©’cy
) {

142 
Ït
 = 
ÿche
->
	`ticksToCyşes
(
blk
->
wh’R—dy
 - 
	`curTick
());

144 
blk
->
»fCouÁ
 += 1;

147  
blk
;

148 
	}
}

151 
	gLRU
::
BlkTy³
*

152 
LRU
::
	$fšdBlock
(
Addr
 
addr
) const

154 
Addr
 
g
 = 
	`exŒaùTag
(
addr
);

155 
£t
 = 
	`exŒaùS‘
(
addr
);

156 
BlkTy³
 *
blk
 = 
£ts
[
£t
].
	`fšdBlk
(
g
);

157  
blk
;

158 
	}
}

160 
	gLRU
::
BlkTy³
*

161 
LRU
::
	$fšdViùim
(
Addr
 
addr
, 
Pack‘Li¡
 &
wr™ebacks
)

163 
£t
 = 
	`exŒaùS‘
(
addr
);

165 
BlkTy³
 *
blk
 = 
£ts
[
£t
].
blks
[
assoc
-1];

167 ià(
blk
->
	`isV®id
()) {

168 
	`DPRINTF
(
CacheR•l
, "set %x: selecting blk %x for„eplacement\n",

169 
£t
, 
	`»g’”©eBlkAddr
(
blk
->
g
, set));

171  
blk
;

172 
	}
}

175 
	gLRU
::
	$š£¹Block
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *
blk
)

177 
Addr
 
addr
 = 
pkt
->
	`g‘Addr
();

178 
Ma¡”ID
 
ma¡”_id
 = 
pkt
->
»q
->
	`ma¡”Id
();

179 ià(!
blk
->
isTouched
) {

180 
gsInU£
++;

181 
blk
->
isTouched
 = 
Œue
;

182 ià(!
w¬medUp
 && 
gsInU£
.
	`v®ue
(è>ğ
w¬mupBound
) {

183 
w¬medUp
 = 
Œue
;

184 
w¬mupCyşe
 = 
	`curTick
();

192 ià(
blk
->
	`isV®id
()) {

193 
»¶aûm’ts
[0]++;

194 
tÙ®Refs
 +ğ
blk
->
»fCouÁ
;

195 ++
§m¶edRefs
;

196 
blk
->
»fCouÁ
 = 0;

199 
	`as£¹
(
blk
->
¤cMa¡”Id
 < 
ÿche
->
sy¡em
->
	`maxMa¡”s
());

200 
occu·nc›s
[
blk
->
¤cMa¡”Id
]--;

202 
blk
->
	`šv®id©e
();

205 
blk
->
isTouched
 = 
Œue
;

207 
blk
->
g
 = 
	`exŒaùTag
(
addr
);

210 
	`as£¹
(
ma¡”_id
 < 
ÿche
->
sy¡em
->
	`maxMa¡”s
());

211 
occu·nc›s
[
ma¡”_id
]++;

212 
blk
->
¤cMa¡”Id
 = 
ma¡”_id
;

214 
£t
 = 
	`exŒaùS‘
(
addr
);

215 
£ts
[
£t
].
	`moveToH—d
(
blk
);

216 
	}
}

219 
	gLRU
::
	$šv®id©e
(
BlkTy³
 *
blk
)

221 
	`as£¹
(
blk
);

222 
	`as£¹
(
blk
->
	`isV®id
());

223 
gsInU£
--;

224 
	`as£¹
(
blk
->
¤cMa¡”Id
 < 
ÿche
->
sy¡em
->
	`maxMa¡”s
());

225 
occu·nc›s
[
blk
->
¤cMa¡”Id
]--;

226 
blk
->
¤cMa¡”Id
 = 
Reque¡
::
švldMa¡”Id
;

229 
£t
 = 
blk
->set;

230 
£ts
[
£t
].
	`moveToTa
(
blk
);

231 
	}
}

234 
	gLRU
::
	$ş—rLocks
()

236 
i
 = 0; i < 
numBlocks
; i++){

237 
blks
[
i
].
	`ş—rLßdLocks
();

239 
	}
}

241 
LRU
 *

242 
	gLRUP¬ams
::
	$ü—‹
()

244  
Ãw
 
	`LRU
(
this
);

245 
	}
}

246 
	g¡d
::
¡ršg


247 
LRU
::
	$´št
() const {

248 
¡d
::
¡ršg
 
ÿche_¡©e
;

249 
i
 = 0; i < 
numS‘s
; ++i) {

251 
j
 = 0; j < 
assoc
; ++j) {

252 
BlkTy³
 *
blk
 = 
£ts
[
i
].
blks
[
j
];

253 ià(
blk
->
	`isV®id
())

254 
ÿche_¡©e
 +ğ
	`c¥rštf
("\t£t: %d block: %d %s\n", 
i
, 
j
,

255 
blk
->
	`´št
());

258 ià(
ÿche_¡©e
.
	`em±y
())

259 
ÿche_¡©e
 = "no validags\n";

260  
ÿche_¡©e
;

261 
	}
}

264 
	gLRU
::
	$ş—nupRefs
()

266 
i
 = 0; i < 
numS‘s
*
assoc
; ++i) {

267 ià(
blks
[
i
].
	`isV®id
()) {

268 
tÙ®Refs
 +ğ
blks
[
i
].
»fCouÁ
;

269 ++
§m¶edRefs
;

272 
	}
}

	@cache/tags/lru.hh

48 #iâdeà
__MEM_CACHE_TAGS_LRU_HH__


49 
	#__MEM_CACHE_TAGS_LRU_HH__


	)

51 
	~<ÿs£¹
>

52 
	~<c¡ršg
>

53 
	~<li¡
>

55 
	~"mem/ÿche/gs/ba£.hh
"

56 
	~"mem/ÿche/gs/ÿche£t.hh
"

57 
	~"mem/ÿche/blk.hh
"

58 
	~"mem/·ck‘.hh
"

59 
	~"·¿ms/LRU.hh
"

61 
şass
 
	gBa£Cache
;

68 şas 
	cLRU
 : 
public
 
Ba£Tags


70 
public
:

72 
CacheBlk
 
	tBlkTy³
;

74 
	m¡d
::
	tli¡
<
	tBlkTy³
*> 
	tBlkLi¡
;

76 
	mCacheS‘
<
	tCacheBlk
> 
	tS‘Ty³
;

79 
	m´Ùeùed
:

81 cÚ¡ 
assoc
;

83 cÚ¡ 
	mnumS‘s
;

86 
S‘Ty³
 *
	m£ts
;

89 
BlkTy³
 *
	mblks
;

91 
ušt8_t
 *
	md©aBlks
;

94 
	m£tShiá
;

96 
	mgShiá
;

98 
	m£tMask
;

100 
	mblkMask
;

102 
	mpublic
:

105 
LRUP¬ams
 
	tP¬ams
;

110 
LRU
(cÚ¡ 
P¬ams
 *
p
);

115 
	mvœtu®
 ~
LRU
();

122 
	$g‘BlockSize
() const

124  
blkSize
;

133 
	$g‘SubBlockSize
() const

135  
blkSize
;

136 
	}
}

142 
šv®id©e
(
BlkTy³
 *
blk
);

153 
BlkTy³
* 
acûssBlock
(
Addr
 
addr
, 
Cyşes
 &
Ït
, 
cÚ‹xt_¤c
);

162 
BlkTy³
* 
	$fšdBlock
(
Addr
 
addr
) const;

170 
BlkTy³
* 
	`fšdViùim
(
Addr
 
addr
, 
Pack‘Li¡
 &
wr™ebacks
);

178 
	`š£¹Block
(
Pack‘PŒ
 
pkt
, 
BlkTy³
 *
blk
);

185 
Addr
 
	$exŒaùTag
(
Addr
 
addr
) const

187  (
addr
 >> 
gShiá
);

188 
	}
}

195 
	$exŒaùS‘
(
Addr
 
addr
) const

197  ((
addr
 >> 
£tShiá
è& 
£tMask
);

198 
	}
}

205 
	$exŒaùBlkOff£t
(
Addr
 
addr
) const

207  (
addr
 & 
blkMask
);

208 
	}
}

215 
Addr
 
	$blkAlign
(
Addr
 
addr
) const

217  (
addr
 & ~(
Addr
)
blkMask
);

218 
	}
}

226 
Addr
 
	$»g’”©eBlkAddr
(
Addr
 
g
, 
£t
) const

228  ((
g
 << 
gShiá
è| ((
Addr
)
£t
 << 
£tShiá
));

229 
	}
}

235 
Cyşes
 
	$g‘H™L©’cy
() const

237  
h™L©’cy
;

238 
	}
}

243 
vœtu®
 
ş—rLocks
();

248 
vœtu®
 
ş—nupRefs
();

253 
vœtu®
 
	g¡d
::
¡ršg
 
	$´št
() const;

267 
‹m¶©e
 <
ty³Çme
 
V
>

268 
	$fÜEachBlk
(
V
 &
vis™Ü
) {

269 
i
 = 0; i < 
numS‘s
 * 
assoc
; ++i) {

270 ià(!
	`vis™Ü
(
blks
[
i
]))

273 
	}
}

	@coherent_bus.cc

50 
	~"ba£/misc.hh
"

51 
	~"ba£/Œaû.hh
"

52 
	~"debug/BusAddrRªges.hh
"

53 
	~"debug/Coh”’tBus.hh
"

54 
	~"mem/coh”’t_bus.hh
"

55 
	~"sim/sy¡em.hh
"

57 
	gCoh”’tBus
::
	$Coh”’tBus
(cÚ¡ 
Coh”’tBusP¬ams
 *
p
)

58 : 
	`Ba£Bus
(
p
), 
	`sy¡em
Õ->
sy¡em
)

60 
	`´štf
("\nBUS CONSTRUCTOR CALLED ma¡”pÜts=%d, sÏv•Üts=%d\n",
p
->
pÜt_ma¡”_cÚÃùiÚ_couÁ
,…->
pÜt_¦ave_cÚÃùiÚ_couÁ
);

64 
i
 = 0; i < 
p
->
pÜt_ma¡”_cÚÃùiÚ_couÁ
; ++i) {

65 
¡d
::
¡ršg
 
pÜtName
 = 
	`c¥rštf
("%s.ma¡”[%d]", 
	`Çme
(), 
i
);

66 
Ma¡”PÜt
* 
bp
 = 
Ãw
 
	`Coh”’tBusMa¡”PÜt
(
pÜtName
, *
this
, 
i
);

67 
ma¡”PÜts
.
	`push_back
(
bp
);

68 
»qLay”s
.
	`push_back
(
Ãw
 
	`ReqLay”
(*
bp
, *
this
,

69 
	`c¥rštf
(".»qLay”%d", 
i
)));

70 
¢oİLay”s
.
	`push_back
(
Ãw
 
	`SnoİLay”
(*
bp
, *
this
,

71 
	`c¥rštf
(".¢oİLay”%d", 
i
)));

76 ià(
p
->
pÜt_deçuÉ_cÚÃùiÚ_couÁ
) {

77 
deçuÉPÜtID
 = 
ma¡”PÜts
.
	`size
();

78 
¡d
::
¡ršg
 
pÜtName
 = 
	`Çme
() + ".default";

79 
Ma¡”PÜt
* 
bp
 = 
Ãw
 
	`Coh”’tBusMa¡”PÜt
(
pÜtName
, *
this
,

80 
deçuÉPÜtID
);

81 
ma¡”PÜts
.
	`push_back
(
bp
);

82 
»qLay”s
.
	`push_back
(
Ãw
 
	`ReqLay”
(*
bp
, *
this
, 
	`c¥rštf
(".reqLayer%d",

83 
deçuÉPÜtID
)));

84 
¢oİLay”s
.
	`push_back
(
Ãw
 
	`SnoİLay”
(*
bp
, *
this
,

85 
	`c¥rštf
(".snoopLayer%d",

86 
deçuÉPÜtID
)));

90 
i
 = 0; i < 
p
->
pÜt_¦ave_cÚÃùiÚ_couÁ
; ++i) {

91 
¡d
::
¡ršg
 
pÜtName
 = 
	`c¥rštf
("%s.¦ave[%d]", 
	`Çme
(), 
i
);

92 
	`´štf
("\ÅÜŠam%s\n",
pÜtName
.
	`c_¡r
());

93 
SÏvePÜt
* 
bp
 = 
Ãw
 
	`Coh”’tBusSÏvePÜt
(
pÜtName
, *
this
, 
i
);

94 
¦avePÜts
.
	`push_back
(
bp
);

95 
»¥Lay”s
.
	`push_back
(
Ãw
 
	`Re¥Lay”
(*
bp
, *
this
,

96 
	`c¥rštf
(".»¥Lay”%d", 
i
)));

97 
¢oİRe¥PÜts
.
	`push_back
(
Ãw
 
	`SnoİRe¥PÜt
(*
bp
, *
this
));

100 
	`ş—rPÜtCache
();

101 
	}
}

103 
	gCoh”’tBus
::~
	$Coh”’tBus
()

105 autØ
l
 = 
»qLay”s
.
	`begš
();† !ğ»qLay”s.
	`’d
(); ++l)

106 
d–‘e
 *
l
;

107 autØ
l
 = 
»¥Lay”s
.
	`begš
();† !ğ»¥Lay”s.
	`’d
(); ++l)

108 
d–‘e
 *
l
;

109 autØ
l
 = 
¢oİLay”s
.
	`begš
();† !ğ¢oİLay”s.
	`’d
(); ++l)

110 
d–‘e
 *
l
;

111 autØ
p
 = 
¢oİRe¥PÜts
.
	`begš
();… !ğ¢oİRe¥PÜts.
	`’d
(); ++p)

112 
d–‘e
 *
p
;

113 
	}
}

116 
	gCoh”’tBus
::
	$š™
()

119 
Ba£Bus
::
	`š™
();

123 
SÏvePÜtCÚ¡I‹r
 
p
 = 
¦avePÜts
.
	`begš
();… !ğ¦avePÜts.
	`’d
();

124 ++
p
) {

126 ià((*
p
)->
	`isSnoİšg
()) {

127 
	`DPRINTF
(
BusAddrRªges
, "Adding snooping master %s\n",

128 (*
p
)->
	`g‘Ma¡”PÜt
().
	`Çme
());

129 
¢oİPÜts
.
	`push_back
(*
p
);

133 ià(
¢oİPÜts
.
	`em±y
())

134 
	`w¬n
("Coh”’tBu % ha nØ¢oİšg…Üt ©ched!\n", 
	`Çme
());

135 
	}
}

137 
boŞ


138 
	gCoh”’tBus
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
)

141 
SÏvePÜt
 *
¤c_pÜt
 = 
¦avePÜts
[
¦ave_pÜt_id
];

144 
boŞ
 
is_ex´ess_¢oİ
 = 
pkt
->
	`isEx´essSnoİ
();

147 
PÜtID
 
ma¡”_pÜt_id
 = 
	`fšdPÜt
(
pkt
->
	`g‘Addr
());

151 ià(!
is_ex´ess_¢oİ
 && !
»qLay”s
[
ma¡”_pÜt_id
]->
	`ŒyTimšg
(
¤c_pÜt
)) {

152 
	`DPRINTF
(
Coh”’tBus
, "recvTimingReq: src %s %s 0x%x BUS BUSY\n",

153 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

154  
çl£
;

157 
	`DPRINTF
(
Coh”’tBus
, "recvTimingReq: src %s %sƒxpr %d 0x%x\n",

158 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(), 
is_ex´ess_¢oİ
,

159 
pkt
->
	`g‘Addr
());

163 
pkt_size
 = 
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

164 
pkt_cmd
 = 
pkt
->
	`cmdToIndex
();

167 
pkt
->
	`£tSrc
(
¦ave_pÜt_id
);

169 
	`ÿlcPack‘Timšg
(
pkt
);

170 
Tick
 
·ck‘FšishTime
 = 
pkt
->
busLa¡WÜdD–ay
 + 
	`curTick
();

173 ià(!
pkt
->
»q
->
	`isUnÿch—bË
(è&& !
sy¡em
->
	`by·ssCaches
()) {

176 
	`fÜw¬dTimšg
(
pkt
, 
¦ave_pÜt_id
);

183 
boŞ
 
add_out¡ªdšg
 = !
is_ex´ess_¢oİ
 && 
pkt
->
	`ÃedsRe¥Ú£
();

189 ià(
add_out¡ªdšg
) {

191 
	`as£¹
(
out¡ªdšgReq
.
	`fšd
(
pkt
->
»q
è=ğout¡ªdšgReq.
	`’d
());

192 
out¡ªdšgReq
.
	`š£¹
(
pkt
->
»q
);

196 
boŞ
 
sucûss
 = 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`£ndTimšgReq
(
pkt
);

199 ià(
is_ex´ess_¢oİ
) {

200 
	`as£¹
(
sucûss
);

201 
¢oİD©aThroughBus
 +ğ
pkt_size
;

204 ià(!
sucûss
) {

206 
	`as£¹
(!
pkt
->
	`memInhib™As£¹ed
());

210 ià(
add_out¡ªdšg
)

211 
out¡ªdšgReq
.
	`”a£
(
pkt
->
»q
);

214 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

216 
	`DPRINTF
(
Coh”’tBus
, "recvTimingReq: src %s %s 0x%x RETRY\n",

217 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

220 
»qLay”s
[
ma¡”_pÜt_id
]->
	`çedTimšg
(
¤c_pÜt
,

221 
	`şockEdge
(
h—d”Cyşes
));

224 
»qLay”s
[
ma¡”_pÜt_id
]->
	`sucûededTimšg
(
·ck‘FšishTime
);

225 
d©aThroughBus
 +ğ
pkt_size
;

230 ià(
sucûss
) {

231 
pktCouÁ
[
¦ave_pÜt_id
][
ma¡”_pÜt_id
]++;

232 
tÙPktSize
[
¦ave_pÜt_id
][
ma¡”_pÜt_id
] +ğ
pkt_size
;

233 
ŒªsDi¡
[
pkt_cmd
]++;

236  
sucûss
;

237 
	}
}

239 
boŞ


240 
	gCoh”’tBus
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
)

243 
Ma¡”PÜt
 *
¤c_pÜt
 = 
ma¡”PÜts
[
ma¡”_pÜt_id
];

246 
PÜtID
 
¦ave_pÜt_id
 = 
pkt
->
	`g‘De¡
();

250 ià(!
»¥Lay”s
[
¦ave_pÜt_id
]->
	`ŒyTimšg
(
¤c_pÜt
)) {

251 
	`DPRINTF
(
Coh”’tBus
, "recvTimingResp: src %s %s 0x%x BUSY\n",

252 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

253  
çl£
;

256 
	`DPRINTF
(
Coh”’tBus
, "recvTimingResp: src %s %s 0x%x\n",

257 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

261 
pkt_size
 = 
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

262 
pkt_cmd
 = 
pkt
->
	`cmdToIndex
();

264 
	`ÿlcPack‘Timšg
(
pkt
);

265 
Tick
 
·ck‘FšishTime
 = 
pkt
->
busLa¡WÜdD–ay
 + 
	`curTick
();

269 
	`as£¹
(
out¡ªdšgReq
.
	`fšd
(
pkt
->
»q
è!ğout¡ªdšgReq.
	`’d
());

272 
out¡ªdšgReq
.
	`”a£
(
pkt
->
»q
);

275 
boŞ
 
sucûss
 
M5_VAR_USED
 = 
¦avePÜts
[
¦ave_pÜt_id
]->
	`£ndTimšgRe¥
(
pkt
);

279 
	`as£¹
(
sucûss
);

281 
»¥Lay”s
[
¦ave_pÜt_id
]->
	`sucûededTimšg
(
·ck‘FšishTime
);

284 
d©aThroughBus
 +ğ
pkt_size
;

285 
pktCouÁ
[
¦ave_pÜt_id
][
ma¡”_pÜt_id
]++;

286 
tÙPktSize
[
¦ave_pÜt_id
][
ma¡”_pÜt_id
] +ğ
pkt_size
;

287 
ŒªsDi¡
[
pkt_cmd
]++;

289  
Œue
;

290 
	}
}

293 
	gCoh”’tBus
::
	$»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
)

295 
	`DPRINTF
(
Coh”’tBus
, "recvTimingSnoopReq: src %s %s 0x%x\n",

296 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),

297 
pkt
->
	`g‘Addr
());

300 
ŒªsDi¡
[
pkt
->
	`cmdToIndex
()]++;

301 
¢oİD©aThroughBus
 +ğ
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

304 
	`as£¹
(
pkt
->
	`isEx´essSnoİ
());

307 
pkt
->
	`£tSrc
(
ma¡”_pÜt_id
);

310 
	`fÜw¬dTimšg
(
pkt
, 
Inv®idPÜtID
);

317 
	`as£¹
(
ma¡”_pÜt_id
 =ğ
	`fšdPÜt
(
pkt
->
	`g‘Addr
()));

318 
	}
}

320 
boŞ


321 
	gCoh”’tBus
::
	$»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
)

324 
SÏvePÜt
* 
¤c_pÜt
 = 
¦avePÜts
[
¦ave_pÜt_id
];

327 
PÜtID
 
de¡_pÜt_id
 = 
pkt
->
	`g‘De¡
();

333 
boŞ
 
fÜw¬dAsSnoİ
 = 
out¡ªdšgReq
.
	`fšd
(
pkt
->
»q
) ==

334 
out¡ªdšgReq
.
	`’d
();

340 ià(
fÜw¬dAsSnoİ
) {

341 ià(!
¢oİLay”s
[
de¡_pÜt_id
]->
	`ŒyTimšg
(
¤c_pÜt
)) {

342 
	`DPRINTF
(
Coh”’tBus
, "recvTimingSnoopResp: src %s %s 0x%x BUSY\n",

343 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

344  
çl£
;

348 
Ma¡”PÜt
* 
¢oİ_pÜt
 = 
¢oİRe¥PÜts
[
¦ave_pÜt_id
];

349 ià(!
»¥Lay”s
[
de¡_pÜt_id
]->
	`ŒyTimšg
(
¢oİ_pÜt
)) {

350 
	`DPRINTF
(
Coh”’tBus
, "recvTimingSnoopResp: src %s %s 0x%x BUSY\n",

351 
¢oİ_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

352  
çl£
;

356 
	`DPRINTF
(
Coh”’tBus
, "recvTimingSnoopResp: src %s %s 0x%x\n",

357 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

361 
pkt_size
 = 
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

362 
pkt_cmd
 = 
pkt
->
	`cmdToIndex
();

365 
	`as£¹
(!
pkt
->
	`isEx´essSnoİ
());

367 
	`ÿlcPack‘Timšg
(
pkt
);

368 
Tick
 
·ck‘FšishTime
 = 
pkt
->
busLa¡WÜdD–ay
 + 
	`curTick
();

371 ià(
fÜw¬dAsSnoİ
) {

375 
boŞ
 
sucûss
 
M5_VAR_USED
 =

376 
ma¡”PÜts
[
de¡_pÜt_id
]->
	`£ndTimšgSnoİRe¥
(
pkt
);

377 
pktCouÁ
[
¦ave_pÜt_id
][
de¡_pÜt_id
]++;

378 
tÙPktSize
[
¦ave_pÜt_id
][
de¡_pÜt_id
] +ğ
pkt_size
;

379 
	`as£¹
(
sucûss
);

381 
¢oİLay”s
[
de¡_pÜt_id
]->
	`sucûededTimšg
(
·ck‘FšishTime
);

387 
out¡ªdšgReq
.
	`”a£
(
pkt
->
»q
);

394 
	`as£¹
(
¦ave_pÜt_id
 !ğ
de¡_pÜt_id
);

400 
boŞ
 
sucûss
 
M5_VAR_USED
 =

401 
¦avePÜts
[
de¡_pÜt_id
]->
	`£ndTimšgRe¥
(
pkt
);

408 
	`as£¹
(
sucûss
);

410 
»¥Lay”s
[
de¡_pÜt_id
]->
	`sucûededTimšg
(
·ck‘FšishTime
);

414 
ŒªsDi¡
[
pkt_cmd
]++;

415 
¢oİD©aThroughBus
 +ğ
pkt_size
;

417  
Œue
;

418 
	}
}

422 
	gCoh”’tBus
::
	$fÜw¬dTimšg
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
exşude_¦ave_pÜt_id
)

424 
	`DPRINTF
(
Coh”’tBus
, "% fÜ % add»s %x siz%d\n", 
__func__
,

425 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

428 
	`as£¹
(!
sy¡em
->
	`by·ssCaches
());

430 
SÏvePÜtI‹r
 
s
 = 
¢oİPÜts
.
	`begš
(); s !ğ¢oİPÜts.
	`’d
(); ++s) {

431 
SÏvePÜt
 *
p
 = *
s
;

436 ià(
exşude_¦ave_pÜt_id
 =ğ
Inv®idPÜtID
 ||

437 
p
->
	`g‘Id
(è!ğ
exşude_¦ave_pÜt_id
) {

439 
p
->
	`£ndTimšgSnoİReq
(
pkt
);

442 
	}
}

445 
	gCoh”’tBus
::
	$»cvR‘ry
(
PÜtID
 
ma¡”_pÜt_id
)

450 
»qLay”s
[
ma¡”_pÜt_id
]->
	`»cvR‘ry
();

451 
	}
}

453 
Tick


454 
	gCoh”’tBus
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
)

456 
	`DPRINTF
(
Coh”’tBus
, "recvAtomic:…acket src %s‡ddr 0x%x cmd %s\n",

457 
¦avePÜts
[
¦ave_pÜt_id
]->
	`Çme
(), 
pkt
->
	`g‘Addr
(),

458 
pkt
->
	`cmdSŒšg
());

461 
d©aThroughBus
 +ğ
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

463 
MemCmd
 
¢oİ_»¥Ú£_cmd
 = MemCmd::
Inv®idCmd
;

464 
Tick
 
¢oİ_»¥Ú£_Ï‹ncy
 = 0;

467 ià(!
pkt
->
»q
->
	`isUnÿch—bË
(è&& !
sy¡em
->
	`by·ssCaches
()) {

469 
¡d
::
·œ
<
MemCmd
, 
Tick
> 
¢oİ_»suÉ
 =

470 
	`fÜw¬dAtomic
(
pkt
, 
¦ave_pÜt_id
);

471 
¢oİ_»¥Ú£_cmd
 = 
¢oİ_»suÉ
.
fœ¡
;

472 
¢oİ_»¥Ú£_Ï‹ncy
 = 
¢oİ_»suÉ
.
£cÚd
;

477 
PÜtID
 
de¡_id
 = 
	`fšdPÜt
(
pkt
->
	`g‘Addr
());

480 
Tick
 
»¥Ú£_Ï‹ncy
 = 
ma¡”PÜts
[
de¡_id
]->
	`£ndAtomic
(
pkt
);

483 ià(
¢oİ_»¥Ú£_cmd
 !ğ
MemCmd
::
Inv®idCmd
) {

485 
	`as£¹
(!
pkt
->
	`isRe¥Ú£
());

486 
pkt
->
cmd
 = 
¢oİ_»¥Ú£_cmd
;

487 
»¥Ú£_Ï‹ncy
 = 
¢oİ_»¥Ú£_Ï‹ncy
;

491 ià(
pkt
->
	`isRe¥Ú£
())

492 
d©aThroughBus
 +ğ
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

495 
pkt
->
busLa¡WÜdD–ay
 = 
»¥Ú£_Ï‹ncy
;

496  
»¥Ú£_Ï‹ncy
;

497 
	}
}

499 
Tick


500 
	gCoh”’tBus
::
	$»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
)

502 
	`DPRINTF
(
Coh”’tBus
, "recvAtomicSnoop:…acket src %s‡ddr 0x%x cmd %s\n",

503 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`Çme
(), 
pkt
->
	`g‘Addr
(),

504 
pkt
->
	`cmdSŒšg
());

507 
¢oİD©aThroughBus
 +ğ
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

510 
¡d
::
·œ
<
MemCmd
, 
Tick
> 
¢oİ_»suÉ
 =

511 
	`fÜw¬dAtomic
(
pkt
, 
Inv®idPÜtID
);

512 
MemCmd
 
¢oİ_»¥Ú£_cmd
 = 
¢oİ_»suÉ
.
fœ¡
;

513 
Tick
 
¢oİ_»¥Ú£_Ï‹ncy
 = 
¢oİ_»suÉ
.
£cÚd
;

515 ià(
¢oİ_»¥Ú£_cmd
 !ğ
MemCmd
::
Inv®idCmd
)

516 
pkt
->
cmd
 = 
¢oİ_»¥Ú£_cmd
;

519 ià(
pkt
->
	`isRe¥Ú£
())

520 
¢oİD©aThroughBus
 +ğ
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

523 
pkt
->
busLa¡WÜdD–ay
 = 
¢oİ_»¥Ú£_Ï‹ncy
;

524  
¢oİ_»¥Ú£_Ï‹ncy
;

525 
	}
}

527 
	g¡d
::
·œ
<
MemCmd
, 
	gTick
>

528 
	gCoh”’tBus
::
	$fÜw¬dAtomic
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
exşude_¦ave_pÜt_id
)

533 
MemCmd
 
Üig_cmd
 = 
pkt
->
cmd
;

534 
MemCmd
 
¢oİ_»¥Ú£_cmd
 = MemCmd::
Inv®idCmd
;

535 
Tick
 
¢oİ_»¥Ú£_Ï‹ncy
 = 0;

538 
	`as£¹
(!
sy¡em
->
	`by·ssCaches
());

540 
SÏvePÜtI‹r
 
s
 = 
¢oİPÜts
.
	`begš
(); s !ğ¢oİPÜts.
	`’d
(); ++s) {

541 
SÏvePÜt
 *
p
 = *
s
;

546 ià(
exşude_¦ave_pÜt_id
 =ğ
Inv®idPÜtID
 ||

547 
p
->
	`g‘Id
(è!ğ
exşude_¦ave_pÜt_id
) {

548 
Tick
 
Ï‹ncy
 = 
p
->
	`£ndAtomicSnoİ
(
pkt
);

552 ià(
pkt
->
	`isRe¥Ú£
()) {

554 
	`as£¹
(
pkt
->
cmd
 !ğ
Üig_cmd
);

555 
	`as£¹
(
pkt
->
	`memInhib™As£¹ed
());

557 
	`as£¹
(
¢oİ_»¥Ú£_cmd
 =ğ
MemCmd
::
Inv®idCmd
);

559 
¢oİ_»¥Ú£_cmd
 = 
pkt
->
cmd
;

560 
¢oİ_»¥Ú£_Ï‹ncy
 = 
Ï‹ncy
;

562 
pkt
->
cmd
 = 
Üig_cmd
;

569  
¡d
::
	`make_·œ
(
¢oİ_»¥Ú£_cmd
, 
¢oİ_»¥Ú£_Ï‹ncy
);

570 
	}
}

573 
	gCoh”’tBus
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
)

575 ià(!
pkt
->
	`isPršt
()) {

577 
	`DPRINTF
(
Coh”’tBus
,

579 
¦avePÜts
[
¦ave_pÜt_id
]->
	`Çme
(), 
pkt
->
	`g‘Addr
(),

580 
pkt
->
	`cmdSŒšg
());

584 ià(!
pkt
->
»q
->
	`isUnÿch—bË
(è&& !
sy¡em
->
	`by·ssCaches
()) {

586 
	`fÜw¬dFunùiÚ®
(
pkt
, 
¦ave_pÜt_id
);

591 ià(!
pkt
->
	`isRe¥Ú£
()) {

592 
PÜtID
 
de¡_id
 = 
	`fšdPÜt
(
pkt
->
	`g‘Addr
());

594 
ma¡”PÜts
[
de¡_id
]->
	`£ndFunùiÚ®
(
pkt
);

596 
	}
}

599 
	gCoh”’tBus
::
	$»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
)

601 ià(!
pkt
->
	`isPršt
()) {

603 
	`DPRINTF
(
Coh”’tBus
,

605 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`Çme
(), 
pkt
->
	`g‘Addr
(),

606 
pkt
->
	`cmdSŒšg
());

610 
	`fÜw¬dFunùiÚ®
(
pkt
, 
Inv®idPÜtID
);

611 
	}
}

614 
	gCoh”’tBus
::
	$fÜw¬dFunùiÚ®
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
exşude_¦ave_pÜt_id
)

617 
	`as£¹
(!
sy¡em
->
	`by·ssCaches
());

619 
SÏvePÜtI‹r
 
s
 = 
¢oİPÜts
.
	`begš
(); s !ğ¢oİPÜts.
	`’d
(); ++s) {

620 
SÏvePÜt
 *
p
 = *
s
;

625 ià(
exşude_¦ave_pÜt_id
 =ğ
Inv®idPÜtID
 ||

626 
p
->
	`g‘Id
(è!ğ
exşude_¦ave_pÜt_id
)

627 
p
->
	`£ndFunùiÚ®Snoİ
(
pkt
);

630 ià(
pkt
->
	`isRe¥Ú£
()) {

634 
	}
}

637 
	gCoh”’tBus
::
	$d¿š
(
D¿šMªag”
 *
dm
)

640 
tÙ®
 = 0;

641 autØ
l
 = 
»qLay”s
.
	`begš
();† !ğ»qLay”s.
	`’d
(); ++l)

642 
tÙ®
 +ğ(*
l
)->
	`d¿š
(
dm
);

643 autØ
l
 = 
»¥Lay”s
.
	`begš
();† !ğ»¥Lay”s.
	`’d
(); ++l)

644 
tÙ®
 +ğ(*
l
)->
	`d¿š
(
dm
);

645 autØ
l
 = 
¢oİLay”s
.
	`begš
();† !ğ¢oİLay”s.
	`’d
(); ++l)

646 
tÙ®
 +ğ(*
l
)->
	`d¿š
(
dm
);

647  
tÙ®
;

648 
	}
}

651 
	gCoh”’tBus
::
	$»gSts
()

654 
Ba£Bus
::
	`»gSts
();

655 autØ
l
 = 
»qLay”s
.
	`begš
();† !ğ»qLay”s.
	`’d
(); ++l)

656 (*
l
)->
	`»gSts
();

657 autØ
l
 = 
»¥Lay”s
.
	`begš
();† !ğ»¥Lay”s.
	`’d
(); ++l)

658 (*
l
)->
	`»gSts
();

659 autØ
l
 = 
¢oİLay”s
.
	`begš
();† !ğ¢oİLay”s.
	`’d
(); ++l)

660 (*
l
)->
	`»gSts
();

662 
d©aThroughBus


663 .
	`Çme
(name() + ".data_through_bus")

664 .
	`desc
("Total data (bytes)")

667 
¢oİD©aThroughBus


668 .
	`Çme
(name() + ".snoop_data_through_bus")

669 .
	`desc
("Total snoop data (bytes)")

672 
throughput


673 .
	`Çme
(name() + ".throughput")

674 .
	`desc
("Throughput (bytes/s)")

675 .
	`´ecisiÚ
(0)

678 
throughput
 = (
d©aThroughBus
 + 
¢oİD©aThroughBus
è/ 
simSecÚds
;

679 
	}
}

681 
Coh”’tBus
 *

682 
	gCoh”’tBusP¬ams
::
	$ü—‹
()

684  
Ãw
 
	`Coh”’tBus
(
this
);

685 
	}
}

	@coherent_bus.hh

51 #iâdeà
__MEM_COHERENT_BUS_HH__


52 
	#__MEM_COHERENT_BUS_HH__


	)

54 
	~"ba£/hashm­.hh
"

55 
	~"mem/bus.hh
"

56 
	~"·¿ms/Coh”’tBus.hh
"

69 şas 
	cCoh”’tBus
 : 
public
 
Ba£Bus


72 
´Ùeùed
:

78 
Lay”
<
	tSÏvePÜt
,
	tMa¡”PÜt
> 
	tReqLay”
;

79 
	mLay”
<
	tMa¡”PÜt
,
	tSÏvePÜt
> 
	tRe¥Lay”
;

80 
	mLay”
<
	tSÏvePÜt
,
	tMa¡”PÜt
> 
	tSnoİLay”
;

81 
	m¡d
::
veùÜ
<
ReqLay”
*> 
»qLay”s
;

82 
	m¡d
::
veùÜ
<
Re¥Lay”
*> 
»¥Lay”s
;

83 
	m¡d
::
veùÜ
<
SnoİLay”
*> 
¢oİLay”s
;

90 şas 
	cCoh”’tBusSÏvePÜt
 : 
public
 
SÏvePÜt


93 
´iv©e
:

96 
Coh”’tBus
 &
bus
;

98 
	mpublic
:

100 
Coh”’tBusSÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
,

101 
Coh”’tBus
 &
_bus
, 
PÜtID
 
_id
)

102 : 
SÏvePÜt
(
_Çme
, &
_bus
, 
_id
), 
bus
(_bus)

105 
	m´Ùeùed
:

110 
vœtu®
 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

111 {  
bus
.
»cvTimšgReq
(
pkt
, 
id
); }

116 
vœtu®
 
boŞ
 
»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

117 {  
	mbus
.
»cvTimšgSnoİRe¥
(
pkt
, 
id
); }

122 
vœtu®
 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
)

123 {  
	mbus
.
»cvAtomic
(
pkt
, 
id
); }

128 
vœtu®
 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

129 { 
	mbus
.
»cvFunùiÚ®
(
pkt
, 
id
); }

134 
vœtu®
 
»cvR‘ry
()

135 { 
·nic
("Bus slave…orts‡lways succeed‡nd should‚ever„etry.\n"); }

140 
vœtu®
 
AddrRªgeLi¡
 
g‘AddrRªges
() const

141 {  
	mbus
.
g‘AddrRªges
(); }

150 şas 
	cCoh”’tBusMa¡”PÜt
 : 
public
 
Ma¡”PÜt


152 
´iv©e
:

154 
Coh”’tBus
 &
bus
;

156 
	gpublic
:

158 
Coh”’tBusMa¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
,

159 
Coh”’tBus
 &
_bus
, 
PÜtID
 
_id
)

160 : 
Ma¡”PÜt
(
_Çme
, &
_bus
, 
_id
), 
bus
(_bus)

163 
	g´Ùeùed
:

171 
vœtu®
 
boŞ
 
isSnoİšg
() const

172 {  
Œue
; }

177 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

178 {  
	gbus
.
»cvTimšgRe¥
(
pkt
, 
id
); }

183 
vœtu®
 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

184 {  
	gbus
.
»cvTimšgSnoİReq
(
pkt
, 
id
); }

189 
vœtu®
 
Tick
 
»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

190 {  
	gbus
.
»cvAtomicSnoİ
(
pkt
, 
id
); }

195 
vœtu®
 
»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
)

196 { 
	gbus
.
»cvFunùiÚ®Snoİ
(
pkt
, 
id
); }

200 
vœtu®
 
»cvRªgeChªge
()

201 { 
	gbus
.
»cvRªgeChªge
(
id
); }

205 
vœtu®
 
»cvR‘ry
()

206 { 
	gbus
.
»cvR‘ry
(
id
); }

215 şas 
	cSnoİRe¥PÜt
 : 
public
 
Ma¡”PÜt


218 
´iv©e
:

221 
SÏvePÜt
& 
¦avePÜt
;

223 
	gpublic
:

228 
SnoİRe¥PÜt
(
SÏvePÜt
& 
¦ave_pÜt
, 
Coh”’tBus
& 
_bus
) :

229 
Ma¡”PÜt
(
¦ave_pÜt
.
Çme
(è+ ".¢oİRe¥PÜt", &
_bus
),

230 
¦avePÜt
(
¦ave_pÜt
) { }

236 
£ndR‘ry
() {

237 
	g¦avePÜt
.
£ndR‘ry
();

243 
»cvR‘ry
(è{ 
·nic
("SnoopRespPort should‚ever see„etry\n"); }

248 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

250 
·nic
("SnoopRespPort should‚ever seeiming„esponse\n");

251  
	gçl£
;

256 
	g¡d
::
veùÜ
<
SnoİRe¥PÜt
*> 
¢oİRe¥PÜts
;

258 
	g¡d
::
veùÜ
<
SÏvePÜt
*> 
¢oİPÜts
;

265 
	gm5
::
hash_£t
<
Reque¡PŒ
> 
out¡ªdšgReq
;

271 
Sy¡em
 *
	gsy¡em
;

275 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
);

279 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
);

283 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
);

287 
boŞ
 
»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
);

291 
»cvR‘ry
(
PÜtID
 
ma¡”_pÜt_id
);

301 
fÜw¬dTimšg
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
exşude_¦ave_pÜt_id
);

305 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
);

309 
Tick
 
»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
);

321 
	g¡d
::
·œ
<
MemCmd
, 
	gTick
> 
fÜw¬dAtomic
(
Pack‘PŒ
 
pkt
,

322 
PÜtID
 
exşude_¦ave_pÜt_id
);

326 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
);

330 
»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
);

340 
fÜw¬dFunùiÚ®
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
exşude_¦ave_pÜt_id
);

342 
	gSts
::
SÿÏr
 
d©aThroughBus
;

343 
	gSts
::
SÿÏr
 
¢oİD©aThroughBus
;

345 
	gpublic
:

347 
vœtu®
 
š™
();

349 
Coh”’tBus
(cÚ¡ 
Coh”’tBusP¬ams
 *
p
);

351 
	gvœtu®
 ~
Coh”’tBus
();

353 
d¿š
(
D¿šMªag”
 *
dm
);

355 
vœtu®
 
»gSts
();

	@comm_monitor.cc

41 
	~"ba£/ÿÎback.hh
"

42 
	~"ba£/ouut.hh
"

43 
	~"ba£/Œaû.hh
"

44 
	~"debug/CommMÚ™Ü.hh
"

45 
	~"mem/comm_mÚ™Ü.hh
"

46 
	~"´Ùo/·ck‘.pb.h
"

47 
	~"sim/¡©s.hh
"

49 
	gCommMÚ™Ü
::
	$CommMÚ™Ü
(
P¬ams
* 
·¿ms
)

50 : 
	`MemObjeù
(
·¿ms
),

51 
	`ma¡”PÜt
(
	`Çme
(è+ "-ma¡”", *
this
),

52 
	`¦avePÜt
(
	`Çme
(è+ "-¦ave", *
this
),

53 
	`§m¶eP”iodicEv’t
(
this
),

54 
	`§m¶eP”iodTicks
(
·¿ms
->
§m¶e_³riod
),

55 
	`»adAddrMask
(
·¿ms
->
»ad_addr_mask
),

56 
	`wr™eAddrMask
(
·¿ms
->
wr™e_addr_mask
),

57 
	`¡©s
(
·¿ms
),

58 
	$ŒaûSŒ—m
(
NULL
)

61 ià(
·¿ms
->
Œaû_fe
 != "") {

64 
¡d
::
¡ršg
 
f’ame
 = 
simout
.
	`»sŞve
(
·¿ms
->
Œaû_fe
);

65 
ŒaûSŒ—m
 = 
Ãw
 
	`PrÙoOuutSŒ—m
(
f’ame
);

69 
Mes§ge
::
Pack‘H—d”
 
h—d”_msg
;

70 
h—d”_msg
.
	`£t_obj_id
(
	`Çme
());

71 
h—d”_msg
.
	`£t_tick_äeq
(
SimClock
::
F»qu’cy
);

72 
ŒaûSŒ—m
->
	`wr™e
(
h—d”_msg
);

77 
C®lback
* 
cb
 = 
Ãw
 
MakeC®lback
<
CommMÚ™Ü
,

78 &
CommMÚ™Ü
::
şo£SŒ—ms
>(
this
);

79 
	`»gi¡”Ex™C®lback
(
cb
);

83 
§m¶eP”iod
.
	`£tTick
(
·¿ms
->
§m¶e_³riod
);

85 
	`DPRINTF
(
CommMÚ™Ü
,

87 
	`Çme
(), 
§m¶eP”iodTicks
, 
§m¶eP”iod
);

88 
	}
}

91 
	gCommMÚ™Ü
::
	$şo£SŒ—ms
()

93 ià(
ŒaûSŒ—m
 !ğ
NULL
)

94 
d–‘e
 
ŒaûSŒ—m
;

95 
	}
}

97 
CommMÚ™Ü
*

98 
	gCommMÚ™ÜP¬ams
::
	$ü—‹
()

100  
Ãw
 
	`CommMÚ™Ü
(
this
);

101 
	}
}

104 
	gCommMÚ™Ü
::
	$š™
()

107 ià(!
¦avePÜt
.
	`isCÚÃùed
(è|| !
ma¡”PÜt
.isConnected())

108 
	`çl
("Communication monitor is‚ot connected on both sides.\n");

109 
	}
}

111 
	gBa£Ma¡”PÜt
&

112 
	gCommMÚ™Ü
::
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
, 
PÜtID
 
idx
)

114 ià(
	gif_Çme
 == "master") {

115  
ma¡”PÜt
;

117  
	gMemObjeù
::
g‘Ma¡”PÜt
(
if_Çme
, 
idx
);

121 
	gBa£SÏvePÜt
&

122 
	gCommMÚ™Ü
::
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
, 
PÜtID
 
idx
)

124 ià(
	gif_Çme
 == "slave") {

125  
¦avePÜt
;

127  
	gMemObjeù
::
g‘SÏvePÜt
(
if_Çme
, 
idx
);

132 
	gCommMÚ™Ü
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

134 
ma¡”PÜt
.
	`£ndFunùiÚ®
(
pkt
);

135 
	}
}

138 
	gCommMÚ™Ü
::
	$»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
)

140 
¦avePÜt
.
	`£ndFunùiÚ®Snoİ
(
pkt
);

141 
	}
}

143 
Tick


144 
	gCommMÚ™Ü
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

146  
ma¡”PÜt
.
	`£ndAtomic
(
pkt
);

147 
	}
}

149 
Tick


150 
	gCommMÚ™Ü
::
	$»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

152  
¦avePÜt
.
	`£ndAtomicSnoİ
(
pkt
);

153 
	}
}

155 
boŞ


156 
	gCommMÚ™Ü
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

159 
	`as£¹
(
pkt
->
	`isReque¡
());

163 
boŞ
 
is_»ad
 = 
pkt
->
	`isR—d
();

164 
boŞ
 
is_wr™e
 = 
pkt
->
	`isWr™e
();

165 
cmd
 = 
pkt
->
	`cmdToIndex
();

166 
Reque¡
::
FÏgsTy³
 
»q_æags
 = 
pkt
->
»q
->
	`g‘FÏgs
();

167 
size
 = 
pkt
->
	`g‘Size
();

168 
Addr
 
addr
 = 
pkt
->
	`g‘Addr
();

169 
boŞ
 
ex³ùs_»¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
(è&& !pkt->
	`memInhib™As£¹ed
();

175 ià(
ex³ùs_»¥Ú£
 && !
¡©s
.
di§bËL©’cyHi¡s
) {

176 
pkt
->
	`pushS’d”S‹
(
Ãw
 
	`CommMÚ™ÜS’d”S‹
(
	`curTick
()));

181 
boŞ
 
sucûssful
 = 
ma¡”PÜt
.
	`£ndTimšgReq
(
pkt
);

184 ià(!
sucûssful
 && 
ex³ùs_»¥Ú£
 && !
¡©s
.
di§bËL©’cyHi¡s
) {

185 
d–‘e
 
pkt
->
	`pİS’d”S‹
();

188 ià(
sucûssful
 && 
ŒaûSŒ—m
 !ğ
NULL
) {

192 
Mes§ge
::
Pack‘
 
pkt_msg
;

193 
pkt_msg
.
	`£t_tick
(
	`curTick
());

194 
pkt_msg
.
	`£t_cmd
(
cmd
);

195 
pkt_msg
.
	`£t_æags
(
»q_æags
);

196 
pkt_msg
.
	`£t_addr
(
addr
);

197 
pkt_msg
.
	`£t_size
(
size
);

199 
ŒaûSŒ—m
->
	`wr™e
(
pkt_msg
);

202 ià(
sucûssful
 && 
is_»ad
) {

203 
	`DPRINTF
(
CommMÚ™Ü
, "Forwarded„ead„equest\n");

206 ià(!
¡©s
.
di§bËT¿n§ùiÚHi¡s
) {

207 ++
¡©s
.
»adT¿ns
;

211 ià(!
¡©s
.
di§bËBur¡L’gthHi¡s
) {

212 
¡©s
.
»adBur¡L’gthHi¡
.
	`§m¶e
(
size
);

216 ià(!
¡©s
.
di§bËAddrDi¡s
) {

217 
¡©s
.
»adAddrDi¡
.
	`§m¶e
(
addr
 & 
»adAddrMask
);

222 ià(!
¡©s
.
di§bËOut¡ªdšgHi¡s
 && 
ex³ùs_»¥Ú£
) {

223 ++
¡©s
.
out¡ªdšgR—dReqs
;

226 ià(!
¡©s
.
di§bËITTDi¡s
) {

228 ià(
¡©s
.
timeOfLa¡R—d
 != 0) {

229 
¡©s
.
™tR—dR—d
.
	`§m¶e
(
	`curTick
(è- sts.
timeOfLa¡R—d
);

231 
¡©s
.
timeOfLa¡R—d
 = 
	`curTick
();

234 ià(
¡©s
.
timeOfLa¡Req
 != 0) {

235 
¡©s
.
™tReqReq
.
	`§m¶e
(
	`curTick
(è- sts.
timeOfLa¡Req
);

237 
¡©s
.
timeOfLa¡Req
 = 
	`curTick
();

239 } ià(
sucûssful
 && 
is_wr™e
) {

240 
	`DPRINTF
(
CommMÚ™Ü
, "Forwarded write„equest\n");

243 ià(!
¡©s
.
di§bËT¿n§ùiÚHi¡s
) {

244 ++
¡©s
.
wr™eT¿ns
;

247 ià(!
¡©s
.
di§bËBur¡L’gthHi¡s
) {

248 
¡©s
.
wr™eBur¡L’gthHi¡
.
	`§m¶e
(
size
);

252 ià(!
¡©s
.
di§bËBªdwidthHi¡s
) {

253 
¡©s
.
wr™‹nBy‹s
 +ğ
size
;

254 
¡©s
.
tÙ®Wr™‹nBy‹s
 +ğ
size
;

258 ià(!
¡©s
.
di§bËAddrDi¡s
) {

259 
¡©s
.
wr™eAddrDi¡
.
	`§m¶e
(
addr
 & 
wr™eAddrMask
);

262 ià(!
¡©s
.
di§bËOut¡ªdšgHi¡s
 && 
ex³ùs_»¥Ú£
) {

263 ++
¡©s
.
out¡ªdšgWr™eReqs
;

266 ià(!
¡©s
.
di§bËITTDi¡s
) {

268 ià(
¡©s
.
timeOfLa¡Wr™e
 != 0) {

269 
¡©s
.
™tWr™eWr™e
.
	`§m¶e
(
	`curTick
(è- sts.
timeOfLa¡Wr™e
);

271 
¡©s
.
timeOfLa¡Wr™e
 = 
	`curTick
();

274 ià(
¡©s
.
timeOfLa¡Req
 != 0) {

275 
¡©s
.
™tReqReq
.
	`§m¶e
(
	`curTick
(è- sts.
timeOfLa¡Req
);

277 
¡©s
.
timeOfLa¡Req
 = 
	`curTick
();

279 } ià(
sucûssful
) {

280 
	`DPRINTF
(
CommMÚ™Ü
, "Forwarded‚on„ead/write„equest\n");

283  
sucûssful
;

284 
	}
}

286 
boŞ


287 
	gCommMÚ™Ü
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

290 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

294 
boŞ
 
is_»ad
 = 
pkt
->
	`isR—d
();

295 
boŞ
 
is_wr™e
 = 
pkt
->
	`isWr™e
();

296 
size
 = 
pkt
->
	`g‘Size
();

297 
Tick
 
Ï‹ncy
 = 0;

298 
CommMÚ™ÜS’d”S‹
* 
»ûived_¡©e
 =

299 
dyÇmic_ÿ¡
<
CommMÚ™ÜS’d”S‹
*>(
pkt
->
£nd”S‹
);

301 ià(!
¡©s
.
di§bËL©’cyHi¡s
) {

303 ià(
»ûived_¡©e
 =ğ
NULL
)

304 
	`·nic
("Monitor got‡„esponse without monitor sender state\n");

307 
pkt
->
£nd”S‹
 = 
»ûived_¡©e
->
´edeûssÜ
;

311 
boŞ
 
sucûssful
 = 
¦avePÜt
.
	`£ndTimšgRe¥
(
pkt
);

313 ià(!
¡©s
.
di§bËL©’cyHi¡s
) {

316 ià(
sucûssful
) {

317 
Ï‹ncy
 = 
	`curTick
(è- 
»ûived_¡©e
->
Œªsm™Time
;

318 
	`DPRINTF
(
CommMÚ™Ü
, "L©’cy: %d\n", 
Ï‹ncy
);

319 
d–‘e
 
»ûived_¡©e
;

323 
pkt
->
£nd”S‹
 = 
»ûived_¡©e
;

327 ià(
sucûssful
 && 
is_»ad
) {

329 
	`DPRINTF
(
CommMÚ™Ü
, "Received„ead„esponse\n");

330 ià(!
¡©s
.
di§bËOut¡ªdšgHi¡s
) {

331 
	`as£¹
(
¡©s
.
out¡ªdšgR—dReqs
 != 0);

332 --
¡©s
.
out¡ªdšgR—dReqs
;

335 ià(!
¡©s
.
di§bËL©’cyHi¡s
) {

336 
¡©s
.
»adL©’cyHi¡
.
	`§m¶e
(
Ï‹ncy
);

340 ià(!
¡©s
.
di§bËBªdwidthHi¡s
) {

341 
¡©s
.
»adBy‹s
 +ğ
size
;

342 
¡©s
.
tÙ®R—dBy‹s
 +ğ
size
;

345 } ià(
sucûssful
 && 
is_wr™e
) {

347 
	`DPRINTF
(
CommMÚ™Ü
, "Received write„esponse\n");

348 ià(!
¡©s
.
di§bËOut¡ªdšgHi¡s
) {

349 
	`as£¹
(
¡©s
.
out¡ªdšgWr™eReqs
 != 0);

350 --
¡©s
.
out¡ªdšgWr™eReqs
;

353 ià(!
¡©s
.
di§bËL©’cyHi¡s
) {

354 
¡©s
.
wr™eL©’cyHi¡
.
	`§m¶e
(
Ï‹ncy
);

356 } ià(
sucûssful
) {

357 
	`DPRINTF
(
CommMÚ™Ü
, "Received‚on„ead/write„esponse\n");

359  
sucûssful
;

360 
	}
}

363 
	gCommMÚ™Ü
::
	$»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

365 
¦avePÜt
.
	`£ndTimšgSnoİReq
(
pkt
);

366 
	}
}

368 
boŞ


369 
	gCommMÚ™Ü
::
	$»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

371  
ma¡”PÜt
.
	`£ndTimšgSnoİRe¥
(
pkt
);

372 
	}
}

374 
boŞ


375 
	gCommMÚ™Ü
::
	$isSnoİšg
() const

378  
¦avePÜt
.
	`isSnoİšg
();

379 
	}
}

381 
AddrRªgeLi¡


382 
	gCommMÚ™Ü
::
	$g‘AddrRªges
() const

385  
ma¡”PÜt
.
	`g‘AddrRªges
();

386 
	}
}

389 
	gCommMÚ™Ü
::
	$»cvR‘ryMa¡”
()

391 
¦avePÜt
.
	`£ndR‘ry
();

392 
	}
}

395 
	gCommMÚ™Ü
::
	$»cvR‘rySÏve
()

397 
ma¡”PÜt
.
	`£ndR‘ry
();

398 
	}
}

401 
	gCommMÚ™Ü
::
	$»cvRªgeChªge
()

403 
¦avePÜt
.
	`£ndRªgeChªge
();

404 
	}
}

407 
	gCommMÚ™Ü
::
	$»gSts
()

410 
usšg
 
Çme¥aû
 
Sts
;

412 
¡©s
.
»adBur¡L’gthHi¡


413 .
	`š™
(
	`·¿ms
()->
bur¡_Ëngth_bšs
)

414 .
	`Çme
(name() + ".readBurstLengthHist")

415 .
	`desc
("Histogram of burst†engths ofransmitted…ackets")

416 .
	`æags
(
¡©s
.
di§bËBur¡L’gthHi¡s
 ? 
noz”o
 : 
pdf
);

418 
¡©s
.
wr™eBur¡L’gthHi¡


419 .
	`š™
(
	`·¿ms
()->
bur¡_Ëngth_bšs
)

420 .
	`Çme
(name() + ".writeBurstLengthHist")

421 .
	`desc
("Histogram of burst†engths ofransmitted…ackets")

422 .
	`æags
(
¡©s
.
di§bËBur¡L’gthHi¡s
 ? 
noz”o
 : 
pdf
);

425 
¡©s
.
»adBªdwidthHi¡


426 .
	`š™
(
	`·¿ms
()->
bªdwidth_bšs
)

427 .
	`Çme
(name() + ".readBandwidthHist")

428 .
	`desc
("Histogram of„ead bandwidth…er sample…eriod (bytes/s)")

429 .
	`æags
(
¡©s
.
di§bËBªdwidthHi¡s
 ? 
noz”o
 : 
pdf
);

431 
¡©s
.
av”ageR—dBW


432 .
	`Çme
(name() + ".averageReadBandwidth")

433 .
	`desc
("Average„ead bandwidth (bytes/s)")

434 .
	`æags
(
¡©s
.
di§bËBªdwidthHi¡s
 ? 
noz”o
 : 
pdf
);

436 
¡©s
.
tÙ®R—dBy‹s


437 .
	`Çme
(name() + ".totalReadBytes")

438 .
	`desc
("Number of bytes„ead")

439 .
	`æags
(
¡©s
.
di§bËBªdwidthHi¡s
 ? 
noz”o
 : 
pdf
);

441 
¡©s
.
av”ageR—dBW
 = sts.
tÙ®R—dBy‹s
 / 
simSecÚds
;

444 
¡©s
.
wr™eBªdwidthHi¡


445 .
	`š™
(
	`·¿ms
()->
bªdwidth_bšs
)

446 .
	`Çme
(name() + ".writeBandwidthHist")

447 .
	`desc
("Histogram of write bandwidth (bytes/s)")

448 .
	`æags
(
¡©s
.
di§bËBªdwidthHi¡s
 ? (
pdf
 | 
noz”o
) :…df);

450 
¡©s
.
av”ageWr™eBW


451 .
	`Çme
(name() + ".averageWriteBandwidth")

452 .
	`desc
("Average write bandwidth (bytes/s)")

453 .
	`æags
(
¡©s
.
di§bËBªdwidthHi¡s
 ? 
noz”o
 : 
pdf
);

455 
¡©s
.
tÙ®Wr™‹nBy‹s


456 .
	`Çme
(name() + ".totalWrittenBytes")

457 .
	`desc
("Number of bytes written")

458 .
	`æags
(
¡©s
.
di§bËBªdwidthHi¡s
 ? 
noz”o
 : 
pdf
);

460 
¡©s
.
av”ageWr™eBW
 = sts.
tÙ®Wr™‹nBy‹s
 / 
simSecÚds
;

462 
¡©s
.
»adL©’cyHi¡


463 .
	`š™
(
	`·¿ms
()->
Ï‹ncy_bšs
)

464 .
	`Çme
(name() + ".readLatencyHist")

465 .
	`desc
("Read„equest-response†atency")

466 .
	`æags
(
¡©s
.
di§bËL©’cyHi¡s
 ? 
noz”o
 : 
pdf
);

468 
¡©s
.
wr™eL©’cyHi¡


469 .
	`š™
(
	`·¿ms
()->
Ï‹ncy_bšs
)

470 .
	`Çme
(name() + ".writeLatencyHist")

471 .
	`desc
("Write„equest-response†atency")

472 .
	`æags
(
¡©s
.
di§bËL©’cyHi¡s
 ? 
noz”o
 : 
pdf
);

474 
¡©s
.
™tR—dR—d


475 .
	`š™
(1, 
	`·¿ms
()->
™t_max_bš
,…arams()->itt_max_bin /

476 
	`·¿ms
()->
™t_bšs
)

477 .
	`Çme
(name() + ".ittReadRead")

478 .
	`desc
("Read-to-read interransactionime")

479 .
	`æags
(
¡©s
.
di§bËITTDi¡s
 ? 
noz”o
 : 
pdf
);

481 
¡©s
.
™tWr™eWr™e


482 .
	`š™
(1, 
	`·¿ms
()->
™t_max_bš
,…arams()->itt_max_bin /

483 
	`·¿ms
()->
™t_bšs
)

484 .
	`Çme
(name() + ".ittWriteWrite")

485 .
	`desc
("Write-to-write interransactionime")

486 .
	`æags
(
¡©s
.
di§bËITTDi¡s
 ? 
noz”o
 : 
pdf
);

488 
¡©s
.
™tReqReq


489 .
	`š™
(1, 
	`·¿ms
()->
™t_max_bš
,…arams()->itt_max_bin /

490 
	`·¿ms
()->
™t_bšs
)

491 .
	`Çme
(name() + ".ittReqReq")

492 .
	`desc
("Request-to-request interransactionime")

493 .
	`æags
(
¡©s
.
di§bËITTDi¡s
 ? 
noz”o
 : 
pdf
);

495 
¡©s
.
out¡ªdšgR—dsHi¡


496 .
	`š™
(
	`·¿ms
()->
out¡ªdšg_bšs
)

497 .
	`Çme
(name() + ".outstandingReadsHist")

498 .
	`desc
("Outstanding„eadransactions")

499 .
	`æags
(
¡©s
.
di§bËOut¡ªdšgHi¡s
 ? 
noz”o
 : 
pdf
);

501 
¡©s
.
out¡ªdšgWr™esHi¡


502 .
	`š™
(
	`·¿ms
()->
out¡ªdšg_bšs
)

503 .
	`Çme
(name() + ".outstandingWritesHist")

504 .
	`desc
("Outstanding writeransactions")

505 .
	`æags
(
¡©s
.
di§bËOut¡ªdšgHi¡s
 ? 
noz”o
 : 
pdf
);

507 
¡©s
.
»adT¿nsHi¡


508 .
	`š™
(
	`·¿ms
()->
Œª§ùiÚ_bšs
)

509 .
	`Çme
(name() + ".readTransHist")

510 .
	`desc
("Histogram of„eadransactions…er sample…eriod")

511 .
	`æags
(
¡©s
.
di§bËT¿n§ùiÚHi¡s
 ? 
noz”o
 : 
pdf
);

513 
¡©s
.
wr™eT¿nsHi¡


514 .
	`š™
(
	`·¿ms
()->
Œª§ùiÚ_bšs
)

515 .
	`Çme
(name() + ".writeTransHist")

516 .
	`desc
("Histogram of„eadransactions…er sample…eriod")

517 .
	`æags
(
¡©s
.
di§bËT¿n§ùiÚHi¡s
 ? 
noz”o
 : 
pdf
);

519 
¡©s
.
»adAddrDi¡


520 .
	`š™
(0)

521 .
	`Çme
(name() + ".readAddrDist")

522 .
	`desc
("Read‡ddress distribution")

523 .
	`æags
(
¡©s
.
di§bËAddrDi¡s
 ? 
noz”o
 : 
pdf
);

525 
¡©s
.
wr™eAddrDi¡


526 .
	`š™
(0)

527 .
	`Çme
(name() + ".writeAddrDist")

528 .
	`desc
("Write‡ddress distribution")

529 .
	`æags
(
¡©s
.
di§bËAddrDi¡s
 ? 
noz”o
 : 
pdf
);

530 
	}
}

533 
	gCommMÚ™Ü
::
	$§m¶eP”iodic
()

543 ià(
simTicks
.
	`v®ue
(è>ğ
§m¶eP”iodTicks
) {

544 ià(!
¡©s
.
di§bËT¿n§ùiÚHi¡s
) {

545 
¡©s
.
»adT¿nsHi¡
.
	`§m¶e
(¡©s.
»adT¿ns
);

546 
¡©s
.
wr™eT¿nsHi¡
.
	`§m¶e
(¡©s.
wr™eT¿ns
);

549 ià(!
¡©s
.
di§bËBªdwidthHi¡s
) {

550 
¡©s
.
»adBªdwidthHi¡
.
	`§m¶e
(¡©s.
»adBy‹s
 / 
§m¶eP”iod
);

551 
¡©s
.
wr™eBªdwidthHi¡
.
	`§m¶e
(¡©s.
wr™‹nBy‹s
 / 
§m¶eP”iod
);

554 ià(!
¡©s
.
di§bËOut¡ªdšgHi¡s
) {

555 
¡©s
.
out¡ªdšgR—dsHi¡
.
	`§m¶e
(¡©s.
out¡ªdšgR—dReqs
);

556 
¡©s
.
out¡ªdšgWr™esHi¡
.
	`§m¶e
(¡©s.
out¡ªdšgWr™eReqs
);

561 
¡©s
.
»adT¿ns
 = 0;

562 
¡©s
.
wr™eT¿ns
 = 0;

564 
¡©s
.
»adBy‹s
 = 0;

565 
¡©s
.
wr™‹nBy‹s
 = 0;

567 
	`scheduË
(
§m¶eP”iodicEv’t
, 
	`curTick
(è+ 
§m¶eP”iodTicks
);

568 
	}
}

571 
	gCommMÚ™Ü
::
	$¡¬tup
()

573 
	`scheduË
(
§m¶eP”iodicEv’t
, 
	`curTick
(è+ 
§m¶eP”iodTicks
);

574 
	}
}

	@comm_monitor.hh

41 #iâdeà
__MEM_COMM_MONITOR_HH__


42 
	#__MEM_COMM_MONITOR_HH__


	)

44 
	~"ba£/¡©i¡ics.hh
"

45 
	~"ba£/time.hh
"

46 
	~"mem/mem_objeù.hh
"

47 
	~"·¿ms/CommMÚ™Ü.hh
"

48 
	~"´Ùo/´Ùoio.hh
"

61 şas 
	cCommMÚ™Ü
 : 
public
 
MemObjeù


64 
public
:

67 
CommMÚ™ÜP¬ams
 
	tP¬ams
;

68 cÚ¡ 
P¬ams
* 
	$·¿ms
() const

69 {  
»š‹½»t_ÿ¡
<cÚ¡ 
P¬ams
*>(
_·¿ms
); }

76 
	`CommMÚ™Ü
(
P¬ams
* 
·¿ms
);

79 ~
	$CommMÚ™Ü
(è{
	}
}

85 
şo£SŒ—ms
();

87 
vœtu®
 
	gBa£Ma¡”PÜt
& 
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

88 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

90 
vœtu®
 
	gBa£SÏvePÜt
& 
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

91 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

93 
vœtu®
 
š™
();

96 
»gSts
();

98 
	g´iv©e
:

104 şas 
	cCommMÚ™ÜS’d”S‹
 : 
public
 
Pack‘
::
S’d”S‹


107 
public
:

115 
CommMÚ™ÜS’d”S‹
(
Tick
 
_Œªsm™Time
)

116 : 
Œªsm™Time
(
_Œªsm™Time
)

120 ~
CommMÚ™ÜS’d”S‹
() { }

123 
Tick
 
Œªsm™Time
;

133 şas 
	cMÚ™ÜMa¡”PÜt
 : 
public
 
Ma¡”PÜt


136 
public
:

138 
MÚ™ÜMa¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
CommMÚ™Ü
& 
_mÚ
)

139 : 
Ma¡”PÜt
(
_Çme
, &
_mÚ
), 
mÚ
(_mon)

142 
	g´Ùeùed
:

144 
»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
)

146 
mÚ
.
»cvFunùiÚ®Snoİ
(
pkt
);

149 
Tick
 
»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

151  
	gmÚ
.
»cvAtomicSnoİ
(
pkt
);

154 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

156  
	gmÚ
.
»cvTimšgRe¥
(
pkt
);

159 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

161 
	gmÚ
.
»cvTimšgSnoİReq
(
pkt
);

164 
»cvRªgeChªge
()

166 
	gmÚ
.
»cvRªgeChªge
();

169 
boŞ
 
isSnoİšg
() const

171  
	gmÚ
.
isSnoİšg
();

174 
»cvR‘ry
()

176 
	gmÚ
.
»cvR‘ryMa¡”
();

179 
	g´iv©e
:

181 
CommMÚ™Ü
& 
mÚ
;

186 
MÚ™ÜMa¡”PÜt
 
	gma¡”PÜt
;

194 şas 
	cMÚ™ÜSÏvePÜt
 : 
public
 
SÏvePÜt


197 
public
:

199 
MÚ™ÜSÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
CommMÚ™Ü
& 
_mÚ
)

200 : 
SÏvePÜt
(
_Çme
, &
_mÚ
), 
mÚ
(_mon)

203 
	g´Ùeùed
:

205 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

207 
mÚ
.
»cvFunùiÚ®
(
pkt
);

210 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
)

212  
	gmÚ
.
»cvAtomic
(
pkt
);

215 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

217  
	gmÚ
.
»cvTimšgReq
(
pkt
);

220 
boŞ
 
»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

222  
	gmÚ
.
»cvTimšgSnoİRe¥
(
pkt
);

225 
AddrRªgeLi¡
 
g‘AddrRªges
() const

227  
	gmÚ
.
g‘AddrRªges
();

230 
»cvR‘ry
()

232 
	gmÚ
.
»cvR‘rySÏve
();

235 
	g´iv©e
:

237 
CommMÚ™Ü
& 
mÚ
;

242 
MÚ™ÜSÏvePÜt
 
	g¦avePÜt
;

244 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

246 
»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
);

248 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

250 
Tick
 
»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
);

252 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

254 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

256 
»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
);

258 
boŞ
 
»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
);

260 
AddrRªgeLi¡
 
	$g‘AddrRªges
() const;

262 
boŞ
 
	$isSnoİšg
() const;

264 
	`»cvR‘ryMa¡”
();

266 
	`»cvR‘rySÏve
();

268 
	`»cvRªgeChªge
();

270 
	`³riodicT¿ûDump
();

273 
	sMÚ™ÜSts


277 
boŞ
 
di§bËBur¡L’gthHi¡s
;

280 
Sts
::
Hi¡og¿m
 
»adBur¡L’gthHi¡
;

283 
Sts
::
Hi¡og¿m
 
wr™eBur¡L’gthHi¡
;

286 
boŞ
 
di§bËBªdwidthHi¡s
;

292 
»adBy‹s
;

293 
Sts
::
Hi¡og¿m
 
»adBªdwidthHi¡
;

294 
Sts
::
FÜmuÏ
 
av”ageR—dBW
;

295 
Sts
::
SÿÏr
 
tÙ®R—dBy‹s
;

301 
wr™‹nBy‹s
;

302 
Sts
::
Hi¡og¿m
 
wr™eBªdwidthHi¡
;

303 
Sts
::
FÜmuÏ
 
av”ageWr™eBW
;

304 
Sts
::
SÿÏr
 
tÙ®Wr™‹nBy‹s
;

307 
boŞ
 
di§bËL©’cyHi¡s
;

310 
Sts
::
Hi¡og¿m
 
»adL©’cyHi¡
;

313 
Sts
::
Hi¡og¿m
 
wr™eL©’cyHi¡
;

316 
boŞ
 
di§bËITTDi¡s
;

324 
Sts
::
Di¡ributiÚ
 
™tR—dR—d
;

325 
Sts
::
Di¡ributiÚ
 
™tWr™eWr™e
;

326 
Sts
::
Di¡ributiÚ
 
™tReqReq
;

327 
Tick
 
timeOfLa¡R—d
;

328 
Tick
 
timeOfLa¡Wr™e
;

329 
Tick
 
timeOfLa¡Req
;

332 
boŞ
 
di§bËOut¡ªdšgHi¡s
;

339 
Sts
::
Hi¡og¿m
 
out¡ªdšgR—dsHi¡
;

340 
out¡ªdšgR—dReqs
;

347 
Sts
::
Hi¡og¿m
 
out¡ªdšgWr™esHi¡
;

348 
out¡ªdšgWr™eReqs
;

351 
boŞ
 
di§bËT¿n§ùiÚHi¡s
;

354 
Sts
::
Hi¡og¿m
 
»adT¿nsHi¡
;

355 
»adT¿ns
;

358 
Sts
::
Hi¡og¿m
 
wr™eT¿nsHi¡
;

359 
wr™eT¿ns
;

362 
boŞ
 
di§bËAddrDi¡s
;

368 
Sts
::
S·r£Hi¡og¿m
 
»adAddrDi¡
;

374 
Sts
::
S·r£Hi¡og¿m
 
wr™eAddrDi¡
;

381 
	`MÚ™ÜSts
(cÚ¡ 
CommMÚ™ÜP¬ams
* 
·¿ms
) :

382 
	`di§bËBur¡L’gthHi¡s
(
·¿ms
->
di§bË_bur¡_Ëngth_hi¡s
),

383 
	`di§bËBªdwidthHi¡s
(
·¿ms
->
di§bË_bªdwidth_hi¡s
),

384 
	`»adBy‹s
(0), 
	`wr™‹nBy‹s
(0),

385 
	`di§bËL©’cyHi¡s
(
·¿ms
->
di§bË_Ï‹ncy_hi¡s
),

386 
	`di§bËITTDi¡s
(
·¿ms
->
di§bË_™t_di¡s
),

387 
	`timeOfLa¡R—d
(0), 
	`timeOfLa¡Wr™e
(0), 
	`timeOfLa¡Req
(0),

388 
	`di§bËOut¡ªdšgHi¡s
(
·¿ms
->
di§bË_out¡ªdšg_hi¡s
),

389 
	`out¡ªdšgR—dReqs
(0), 
	`out¡ªdšgWr™eReqs
(0),

390 
	`di§bËT¿n§ùiÚHi¡s
(
·¿ms
->
di§bË_Œª§ùiÚ_hi¡s
),

391 
	`»adT¿ns
(0), 
	`wr™eT¿ns
(0),

392 
	`di§bËAddrDi¡s
(
·¿ms
->
di§bË_addr_di¡s
)

395 
	}
};

398 
§m¶eP”iodic
();

401 
¡¬tup
();

404 
	gEv’tW¿µ”
<
	gCommMÚ™Ü
, &CommMÚ™Ü::
§m¶eP”iodic
> 
§m¶eP”iodicEv’t
;

407 
Tick
 
	g§m¶eP”iodTicks
;

408 
Time
 
	g§m¶eP”iod
;

411 
Addr
 
	g»adAddrMask
;

414 
Addr
 
	gwr™eAddrMask
;

417 
MÚ™ÜSts
 
	g¡©s
;

420 
PrÙoOuutSŒ—m
* 
	gŒaûSŒ—m
;

	@fs_translating_port_proxy.cc

49 
	~"¬ch/vtİhys.hh
"

50 
	~"ba£/chunk_g’”©Ü.hh
"

51 
	~"ıu/ba£.hh
"

52 
	~"ıu/th»ad_cÚ‹xt.hh
"

53 
	~"mem/fs_Œª¦©šg_pÜt_´oxy.hh
"

54 
	~"sim/sy¡em.hh
"

56 
usšg
 
Çme¥aû
 
	gTheISA
;

58 
	gFST¿n¦©šgPÜtProxy
::
	$FST¿n¦©šgPÜtProxy
(
Th»adCÚ‹xt
 *
tc
)

59 : 
	`PÜtProxy
(
tc
->
	`g‘CpuPŒ
()->
	`g‘D©aPÜt
(),

60 
tc
->
	`g‘Sy¡emPŒ
()->
	`ÿcheLšeSize
()), 
	$_tc
(
tc
)

62 
	}
}

64 
	gFST¿n¦©šgPÜtProxy
::
	$FST¿n¦©šgPÜtProxy
(
Ma¡”PÜt
 &
pÜt
,

65 
ÿcheLšeSize
)

66 : 
	`PÜtProxy
(
pÜt
, 
ÿcheLšeSize
), 
	$_tc
(
NULL
)

68 
	}
}

70 
	gFST¿n¦©šgPÜtProxy
::~
	$FST¿n¦©šgPÜtProxy
()

72 
	}
}

75 
FST¿n¦©šgPÜtProxy
::
	$»adBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const

77 
Addr
 
·ddr
;

78 
ChunkG’”©Ü
 
	`g’
(
addr
, 
size
, 
TheISA
::
PageBy‹s
); !
g’
.
	`dÚe
();

79 
g’
.
	`Ãxt
())

81 ià(
_tc
)

82 
·ddr
 = 
TheISA
::
	`vtİhys
(
_tc
,
g’
.
	`addr
());

84 
·ddr
 = 
TheISA
::
	`vtİhys
(
g’
.
	`addr
());

86 
PÜtProxy
::
	`»adBlob
(
·ddr
, 
p
, 
g’
.
	`size
());

87 
p
 +ğ
g’
.
	`size
();

89 
	}
}

92 
	gFST¿n¦©šgPÜtProxy
::
	$wr™eBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const

94 
Addr
 
·ddr
;

95 
ChunkG’”©Ü
 
	`g’
(
addr
, 
size
, 
TheISA
::
PageBy‹s
); !
g’
.
	`dÚe
();

96 
g’
.
	`Ãxt
())

98 ià(
_tc
)

99 
·ddr
 = 
TheISA
::
	`vtİhys
(
_tc
,
g’
.
	`addr
());

101 
·ddr
 = 
TheISA
::
	`vtİhys
(
g’
.
	`addr
());

103 
PÜtProxy
::
	`wr™eBlob
(
·ddr
, 
p
, 
g’
.
	`size
());

104 
p
 +ğ
g’
.
	`size
();

106 
	}
}

109 
	gFST¿n¦©šgPÜtProxy
::
	$mem£tBlob
(
Addr
 
add»ss
, 
ušt8_t
 
v
, 
size
) const

111 
Addr
 
·ddr
;

112 
ChunkG’”©Ü
 
	`g’
(
add»ss
, 
size
, 
TheISA
::
PageBy‹s
); !
g’
.
	`dÚe
();

113 
g’
.
	`Ãxt
())

115 ià(
_tc
)

116 
·ddr
 = 
TheISA
::
	`vtİhys
(
_tc
,
g’
.
	`addr
());

118 
·ddr
 = 
TheISA
::
	`vtİhys
(
g’
.
	`addr
());

120 
PÜtProxy
::
	`mem£tBlob
(
·ddr
, 
v
, 
g’
.
	`size
());

122 
	}
}

125 
	$CİyOut
(
Th»adCÚ‹xt
 *
tc
, *
de¡
, 
Addr
 
¤c
, 
size_t
 
ıËn
)

127 
ušt8_t
 *
d¡
 = (ušt8_ˆ*)
de¡
;

128 
tc
->
	`g‘VœtProxy
().
	`»adBlob
(
¤c
, 
d¡
, 
ıËn
);

129 
	}
}

132 
	$CİyIn
(
Th»adCÚ‹xt
 *
tc
, 
Addr
 
de¡
, *
sourû
, 
size_t
 
ıËn
)

134 
ušt8_t
 *
¤c
 = (ušt8_ˆ*)
sourû
;

135 
tc
->
	`g‘VœtProxy
().
	`wr™eBlob
(
de¡
, 
¤c
, 
ıËn
);

136 
	}
}

139 
	$CİySŒšgOut
(
Th»adCÚ‹xt
 *
tc
, *
d¡
, 
Addr
 
vaddr
, 
size_t
 
maxËn
)

141 *
¡¬t
 = 
d¡
;

142 
FST¿n¦©šgPÜtProxy
 &
vp
 = 
tc
->
	`g‘VœtProxy
();

144 
boŞ
 
foundNuÎ
 = 
çl£
;

145 (
d¡
 - 
¡¬t
 + 1è< 
maxËn
 && !
foundNuÎ
) {

146 
vp
.
	`»adBlob
(
vaddr
++, (
ušt8_t
*)
d¡
, 1);

147 ià(*
d¡
 == '\0')

148 
foundNuÎ
 = 
Œue
;

149 
d¡
++;

152 ià(!
foundNuÎ
)

153 *
d¡
 = '\0';

154 
	}
}

157 
	$CİySŒšgIn
(
Th»adCÚ‹xt
 *
tc
, *
¤c
, 
Addr
 
vaddr
)

159 
FST¿n¦©šgPÜtProxy
 &
vp
 = 
tc
->
	`g‘VœtProxy
();

160 
ChunkG’”©Ü
 
	`g’
(
vaddr
, 
	`¡¾’
(
¤c
), 
TheISA
::
PageBy‹s
); !
g’
.
	`dÚe
();

161 
g’
.
	`Ãxt
())

163 
vp
.
	`wr™eBlob
(
g’
.
	`addr
(), (
ušt8_t
*)
¤c
, g’.
	`size
());

164 
¤c
 +ğ
g’
.
	`size
();

166 
	}
}

	@fs_translating_port_proxy.hh

59 #iâdeà
__MEM_FS_PORT_PROXY_HH__


60 
	#__MEM_FS_PORT_PROXY_HH__


	)

62 
	~"mem/pÜt_´oxy.hh
"

64 
şass
 
	gTh»adCÚ‹xt
;

73 şas 
	cFST¿n¦©šgPÜtProxy
 : 
public
 
PÜtProxy


75 
´iv©e
:

76 
Th»adCÚ‹xt
* 
_tc
;

78 
	mpublic
:

80 
FST¿n¦©šgPÜtProxy
(
Th»adCÚ‹xt
* 
tc
);

82 
FST¿n¦©šgPÜtProxy
(
Ma¡”PÜt
 &
pÜt
, 
ÿcheLšeSize
);

84 
	mvœtu®
 ~
FST¿n¦©šgPÜtProxy
();

88 
vœtu®
 
	$»adBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const;

92 
vœtu®
 
	$wr™eBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const;

97 
vœtu®
 
	$mem£tBlob
(
Addr
 
add»ss
, 
ušt8_t
 
v
, 
size
) const;

100 
	`CİyOut
(
Th»adCÚ‹xt
 *
tc
, *
de¡
, 
Addr
 
¤c
, 
size_t
 
ıËn
);

101 
	`CİyIn
(
Th»adCÚ‹xt
 *
tc
, 
Addr
 
de¡
, *
sourû
, 
size_t
 
ıËn
);

102 
	`CİySŒšgOut
(
Th»adCÚ‹xt
 *
tc
, *
d¡
, 
Addr
 
vaddr
, 
size_t
 
maxËn
);

103 
	`CİySŒšgIn
(
Th»adCÚ‹xt
 *
tc
, *
¤c
, 
Addr
 
vaddr
);

	@mem_object.cc

44 
	~"mem/mem_objeù.hh
"

46 
	gMemObjeù
::
	$MemObjeù
(cÚ¡ 
P¬ams
 *
·¿ms
)

47 : 
	$ClockedObjeù
(
·¿ms
)

49 
	}
}

51 
Ba£Ma¡”PÜt
&

52 
MemObjeù
::
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
, 
PÜtID
 
idx
)

54 
çl
("% dÛ nÙ havªy ma¡”…ÜˆÇmed %s\n", 
Çme
(), 
if_Çme
);

57 
	gBa£SÏvePÜt
&

58 
	gMemObjeù
::
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
, 
PÜtID
 
idx
)

60 
çl
("% dÛ nÙ havªy sÏvpÜˆÇmed %s\n", 
Çme
(), 
if_Çme
);

	@mem_object.hh

49 #iâdeà
__MEM_MEM_OBJECT_HH__


50 
	#__MEM_MEM_OBJECT_HH__


	)

52 
	~"mem/pÜt.hh
"

53 
	~"·¿ms/MemObjeù.hh
"

54 
	~"sim/şocked_objeù.hh
"

60 şas 
	cMemObjeù
 : 
public
 
ClockedObjeù


62 
public
:

63 
MemObjeùP¬ams
 
	tP¬ams
;

64 cÚ¡ 
P¬ams
 *
	$·¿ms
() const

65 {  
dyÇmic_ÿ¡
<cÚ¡ 
P¬ams
 *>(
_·¿ms
); }

67 
	`MemObjeù
(cÚ¡ 
P¬ams
 *
·¿ms
);

79 
vœtu®
 
Ba£Ma¡”PÜt
& 
	`g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

80 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

92 
vœtu®
 
Ba£SÏvePÜt
& 
	`g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

93 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

94 
	}
};

	@mport.cc

43 
	~"mem/mpÜt.hh
"

45 
Tick


46 
	gMes§geSÏvePÜt
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

48 ià(
pkt
->
cmd
 =ğ
MemCmd
::
Mes§geReq
) {

49  
	`»cvMes§ge
(
pkt
);

51 
	`·nic
("%s„eceived unexpected‡tomic command %s from %s.\n",

52 
	`Çme
(), 
pkt
->
cmd
.
	`toSŒšg
(), 
	`g‘Ma¡”PÜt
().name());

54 
	}
}

	@mport.hh

43 #iâdeà
__MEM_MPORT_HH__


44 
	#__MEM_MPORT_HH__


	)

46 
	~"mem/mem_objeù.hh
"

47 
	~"mem/Üt.hh
"

56 şas 
	cMes§geSÏvePÜt
 : 
public
 
Sim¶eTimšgPÜt


59 
public
:

60 
Mes§geSÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, 
MemObjeù
 *
owÃr
) :

61 
	$Sim¶eTimšgPÜt
(
Çme
, 
owÃr
)

64 
vœtu®
 ~
	$Mes§geSÏvePÜt
()

65 {
	}
}

67 
	g´Ùeùed
:

69 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

71 
vœtu®
 
Tick
 
»cvMes§ge
(
Pack‘PŒ
 
pkt
) = 0;

74 şas 
	cMes§geMa¡”PÜt
 : 
public
 
QueuedMa¡”PÜt


76 
public
:

78 
Mes§geMa¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
, 
MemObjeù
 *
owÃr
) :

79 
QueuedMa¡”PÜt
(
Çme
, 
owÃr
, 
queue
), 
	$queue
(*
owÃr
, *
this
)

82 
vœtu®
 ~
	$Mes§geMa¡”PÜt
()

83 {
	}
}

85 
boŞ
 
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
è{ 
	`»cvRe¥Ú£
Õkt);  
Œue
; 
	}
}

87 
	g´Ùeùed
:

90 
Ma¡”Pack‘Queue
 
queue
;

93 
vœtu®
 
Tick
 
	$»cvRe¥Ú£
(
Pack‘PŒ
 
pkt
)

96 
	}
}

	@noncoherent_bus.cc

50 
	~"ba£/misc.hh
"

51 
	~"ba£/Œaû.hh
"

52 
	~"debug/Bus.hh
"

53 
	~"debug/BusAddrRªges.hh
"

54 
	~"debug/NÚcoh”’tBus.hh
"

55 
	~"mem/nÚcoh”’t_bus.hh
"

57 
	gNÚcoh”’tBus
::
	$NÚcoh”’tBus
(cÚ¡ 
NÚcoh”’tBusP¬ams
 *
p
)

58 : 
	$Ba£Bus
(
p
)

63 
i
 = 0; i < 
p
->
pÜt_ma¡”_cÚÃùiÚ_couÁ
; ++i) {

64 
¡d
::
¡ršg
 
pÜtName
 = 
	`c¥rštf
("%s.ma¡”[%d]", 
	`Çme
(), 
i
);

65 
Ma¡”PÜt
* 
bp
 = 
Ãw
 
	`NÚcoh”’tBusMa¡”PÜt
(
pÜtName
, *
this
, 
i
);

66 
ma¡”PÜts
.
	`push_back
(
bp
);

67 
»qLay”s
.
	`push_back
(
Ãw
 
	`ReqLay”
(*
bp
, *
this
,

68 
	`c¥rštf
(".»qLay”%d", 
i
)));

73 ià(
p
->
pÜt_deçuÉ_cÚÃùiÚ_couÁ
) {

74 
deçuÉPÜtID
 = 
ma¡”PÜts
.
	`size
();

75 
¡d
::
¡ršg
 
pÜtName
 = 
	`Çme
() + ".default";

76 
Ma¡”PÜt
* 
bp
 = 
Ãw
 
	`NÚcoh”’tBusMa¡”PÜt
(
pÜtName
, *
this
,

77 
deçuÉPÜtID
);

78 
ma¡”PÜts
.
	`push_back
(
bp
);

79 
»qLay”s
.
	`push_back
(
Ãw
 
	`ReqLay”
(*
bp
, *
this
, 
	`c¥rštf
(".reqLayer%d",

80 
deçuÉPÜtID
)));

84 
i
 = 0; i < 
p
->
pÜt_¦ave_cÚÃùiÚ_couÁ
; ++i) {

85 
¡d
::
¡ršg
 
pÜtName
 = 
	`c¥rštf
("%s.¦ave[%d]", 
	`Çme
(), 
i
);

86 
SÏvePÜt
* 
bp
 = 
Ãw
 
	`NÚcoh”’tBusSÏvePÜt
(
pÜtName
, *
this
, 
i
);

87 
¦avePÜts
.
	`push_back
(
bp
);

88 
»¥Lay”s
.
	`push_back
(
Ãw
 
	`Re¥Lay”
(*
bp
, *
this
,

89 
	`c¥rštf
(".»¥Lay”%d", 
i
)));

92 
	`ş—rPÜtCache
();

93 
	}
}

95 
	gNÚcoh”’tBus
::~
	$NÚcoh”’tBus
()

97 autØ
l
 = 
»qLay”s
.
	`begš
();† !ğ»qLay”s.
	`’d
(); ++l)

98 
d–‘e
 *
l
;

99 autØ
l
 = 
»¥Lay”s
.
	`begš
();† !ğ»¥Lay”s.
	`’d
(); ++l)

100 
d–‘e
 *
l
;

101 
	}
}

103 
boŞ


104 
	gNÚcoh”’tBus
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
)

107 
SÏvePÜt
 *
¤c_pÜt
 = 
¦avePÜts
[
¦ave_pÜt_id
];

110 
	`as£¹
(!
pkt
->
	`isEx´essSnoİ
());

113 
PÜtID
 
ma¡”_pÜt_id
 = 
	`fšdPÜt
(
pkt
->
	`g‘Addr
());

117 ià(!
»qLay”s
[
ma¡”_pÜt_id
]->
	`ŒyTimšg
(
¤c_pÜt
)) {

118 
	`DPRINTF
(
NÚcoh”’tBus
, "recvTimingReq: src %s %s 0x%x BUSY\n",

119 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

120  
çl£
;

123 
	`DPRINTF
(
NÚcoh”’tBus
, "recvTimingReq: src %s %s 0x%x\n",

124 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

128 
pkt_size
 = 
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

129 
pkt_cmd
 = 
pkt
->
	`cmdToIndex
();

132 
pkt
->
	`£tSrc
(
¦ave_pÜt_id
);

134 
	`ÿlcPack‘Timšg
(
pkt
);

135 
Tick
 
·ck‘FšishTime
 = 
pkt
->
busLa¡WÜdD–ay
 + 
	`curTick
();

138 
boŞ
 
sucûss
 = 
ma¡”PÜts
[
ma¡”_pÜt_id
]->
	`£ndTimšgReq
(
pkt
);

140 ià(!
sucûss
) {

142 
	`as£¹
(!
pkt
->
	`memInhib™As£¹ed
());

144 
	`DPRINTF
(
NÚcoh”’tBus
, "recvTimingReq: src %s %s 0x%x RETRY\n",

145 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

148 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

151 
»qLay”s
[
ma¡”_pÜt_id
]->
	`çedTimšg
(
¤c_pÜt
,

152 
	`şockEdge
(
h—d”Cyşes
));

154  
çl£
;

157 
»qLay”s
[
ma¡”_pÜt_id
]->
	`sucûededTimšg
(
·ck‘FšishTime
);

160 
d©aThroughBus
 +ğ
pkt_size
;

161 
pktCouÁ
[
¦ave_pÜt_id
][
ma¡”_pÜt_id
]++;

162 
tÙPktSize
[
¦ave_pÜt_id
][
ma¡”_pÜt_id
] +ğ
pkt_size
;

163 
ŒªsDi¡
[
pkt_cmd
]++;

165  
Œue
;

166 
	}
}

168 
boŞ


169 
	gNÚcoh”’tBus
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
)

172 
Ma¡”PÜt
 *
¤c_pÜt
 = 
ma¡”PÜts
[
ma¡”_pÜt_id
];

175 
PÜtID
 
¦ave_pÜt_id
 = 
pkt
->
	`g‘De¡
();

179 ià(!
»¥Lay”s
[
¦ave_pÜt_id
]->
	`ŒyTimšg
(
¤c_pÜt
)) {

180 
	`DPRINTF
(
NÚcoh”’tBus
, "recvTimingResp: src %s %s 0x%x BUSY\n",

181 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

182  
çl£
;

185 
	`DPRINTF
(
NÚcoh”’tBus
, "recvTimingResp: src %s %s 0x%x\n",

186 
¤c_pÜt
->
	`Çme
(), 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

190 
pkt_size
 = 
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

191 
pkt_cmd
 = 
pkt
->
	`cmdToIndex
();

193 
	`ÿlcPack‘Timšg
(
pkt
);

194 
Tick
 
·ck‘FšishTime
 = 
pkt
->
busLa¡WÜdD–ay
 + 
	`curTick
();

197 
boŞ
 
sucûss
 
M5_VAR_USED
 = 
¦avePÜts
[
¦ave_pÜt_id
]->
	`£ndTimšgRe¥
(
pkt
);

201 
	`as£¹
(
sucûss
);

203 
»¥Lay”s
[
¦ave_pÜt_id
]->
	`sucûededTimšg
(
·ck‘FšishTime
);

206 
d©aThroughBus
 +ğ
pkt_size
;

207 
pktCouÁ
[
¦ave_pÜt_id
][
ma¡”_pÜt_id
]++;

208 
tÙPktSize
[
¦ave_pÜt_id
][
ma¡”_pÜt_id
] +ğ
pkt_size
;

209 
ŒªsDi¡
[
pkt_cmd
]++;

211  
Œue
;

212 
	}
}

215 
	gNÚcoh”’tBus
::
	$»cvR‘ry
(
PÜtID
 
ma¡”_pÜt_id
)

220 
»qLay”s
[
ma¡”_pÜt_id
]->
	`»cvR‘ry
();

221 
	}
}

223 
Tick


224 
	gNÚcoh”’tBus
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
)

226 
	`DPRINTF
(
NÚcoh”’tBus
, "recvAtomic:…acket src %s‡ddr 0x%x cmd %s\n",

227 
¦avePÜts
[
¦ave_pÜt_id
]->
	`Çme
(), 
pkt
->
	`g‘Addr
(),

228 
pkt
->
	`cmdSŒšg
());

231 
d©aThroughBus
 +ğ
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

234 
PÜtID
 
de¡_id
 = 
	`fšdPÜt
(
pkt
->
	`g‘Addr
());

237 
Tick
 
»¥Ú£_Ï‹ncy
 = 
ma¡”PÜts
[
de¡_id
]->
	`£ndAtomic
(
pkt
);

240 ià(
pkt
->
	`isRe¥Ú£
())

241 
d©aThroughBus
 +ğ
pkt
->
	`hasD©a
(è?…kt->
	`g‘Size
() : 0;

244 
pkt
->
busLa¡WÜdD–ay
 = 
»¥Ú£_Ï‹ncy
;

245  
»¥Ú£_Ï‹ncy
;

246 
	}
}

249 
	gNÚcoh”’tBus
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
)

251 ià(!
pkt
->
	`isPršt
()) {

253 
	`DPRINTF
(
NÚcoh”’tBus
,

255 
¦avePÜts
[
¦ave_pÜt_id
]->
	`Çme
(), 
pkt
->
	`g‘Addr
(),

256 
pkt
->
	`cmdSŒšg
());

260 
PÜtID
 
de¡_id
 = 
	`fšdPÜt
(
pkt
->
	`g‘Addr
());

263 
ma¡”PÜts
[
de¡_id
]->
	`£ndFunùiÚ®
(
pkt
);

264 
	}
}

267 
	gNÚcoh”’tBus
::
	$d¿š
(
D¿šMªag”
 *
dm
)

270 
tÙ®
 = 0;

271 autØ
l
 = 
»qLay”s
.
	`begš
();† !ğ»qLay”s.
	`’d
(); ++l)

272 
tÙ®
 +ğ(*
l
)->
	`d¿š
(
dm
);

273 autØ
l
 = 
»¥Lay”s
.
	`begš
();† !ğ»¥Lay”s.
	`’d
(); ++l)

274 
tÙ®
 +ğ(*
l
)->
	`d¿š
(
dm
);

275  
tÙ®
;

276 
	}
}

278 
NÚcoh”’tBus
*

279 
	gNÚcoh”’tBusP¬ams
::
	$ü—‹
()

281  
Ãw
 
	`NÚcoh”’tBus
(
this
);

282 
	}
}

285 
	gNÚcoh”’tBus
::
	$»gSts
()

288 
Ba£Bus
::
	`»gSts
();

289 autØ
l
 = 
»qLay”s
.
	`begš
();† !ğ»qLay”s.
	`’d
(); ++l)

290 (*
l
)->
	`»gSts
();

291 autØ
l
 = 
»¥Lay”s
.
	`begš
();† !ğ»¥Lay”s.
	`’d
(); ++l)

292 (*
l
)->
	`»gSts
();

294 
d©aThroughBus


295 .
	`Çme
(name() + ".data_through_bus")

296 .
	`desc
("Total data (bytes)")

299 
throughput


300 .
	`Çme
(name() + ".throughput")

301 .
	`desc
("Throughput (bytes/s)")

302 .
	`´ecisiÚ
(0)

305 
throughput
 = 
d©aThroughBus
 / 
simSecÚds
;

306 
	}
}

	@noncoherent_bus.hh

51 #iâdeà
__MEM_NONCOHERENT_BUS_HH__


52 
	#__MEM_NONCOHERENT_BUS_HH__


	)

54 
	~"mem/bus.hh
"

55 
	~"·¿ms/NÚcoh”’tBus.hh
"

70 şas 
	cNÚcoh”’tBus
 : 
public
 
Ba£Bus


73 
´Ùeùed
:

79 
Lay”
<
	tSÏvePÜt
,
	tMa¡”PÜt
> 
	tReqLay”
;

80 
	mLay”
<
	tMa¡”PÜt
,
	tSÏvePÜt
> 
	tRe¥Lay”
;

81 
	m¡d
::
veùÜ
<
ReqLay”
*> 
»qLay”s
;

82 
	m¡d
::
veùÜ
<
Re¥Lay”
*> 
»¥Lay”s
;

89 şas 
	cNÚcoh”’tBusSÏvePÜt
 : 
public
 
SÏvePÜt


91 
´iv©e
:

94 
NÚcoh”’tBus
 &
bus
;

96 
	mpublic
:

98 
NÚcoh”’tBusSÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
,

99 
NÚcoh”’tBus
 &
_bus
, 
PÜtID
 
_id
)

100 : 
SÏvePÜt
(
_Çme
, &
_bus
, 
_id
), 
bus
(_bus)

103 
	m´Ùeùed
:

108 
vœtu®
 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

109 {  
bus
.
»cvTimšgReq
(
pkt
, 
id
); }

114 
vœtu®
 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
)

115 {  
	mbus
.
»cvAtomic
(
pkt
, 
id
); }

120 
vœtu®
 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

121 { 
	mbus
.
»cvFunùiÚ®
(
pkt
, 
id
); }

126 
vœtu®
 
»cvR‘ry
()

127 { 
·nic
("Bus slave…orts‡lways succeed‡nd should‚ever„etry.\n"); }

132 
vœtu®
 
AddrRªgeLi¡
 
g‘AddrRªges
() const

133 {  
	mbus
.
g‘AddrRªges
(); }

142 şas 
	cNÚcoh”’tBusMa¡”PÜt
 : 
public
 
Ma¡”PÜt


144 
´iv©e
:

147 
NÚcoh”’tBus
 &
bus
;

149 
	gpublic
:

151 
NÚcoh”’tBusMa¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
,

152 
NÚcoh”’tBus
 &
_bus
, 
PÜtID
 
_id
)

153 : 
Ma¡”PÜt
(
_Çme
, &
_bus
, 
_id
), 
bus
(_bus)

156 
	g´Ùeùed
:

161 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

162 {  
bus
.
»cvTimšgRe¥
(
pkt
, 
id
); }

166 
vœtu®
 
»cvRªgeChªge
()

167 { 
	gbus
.
»cvRªgeChªge
(
id
); }

171 
vœtu®
 
»cvR‘ry
()

172 { 
	gbus
.
»cvR‘ry
(
id
); }

178 
vœtu®
 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
);

182 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
ma¡”_pÜt_id
);

186 
»cvR‘ry
(
PÜtID
 
ma¡”_pÜt_id
);

190 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
);

194 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
, 
PÜtID
 
¦ave_pÜt_id
);

196 
	gpublic
:

198 
NÚcoh”’tBus
(cÚ¡ 
NÚcoh”’tBusP¬ams
 *
p
);

200 
	gvœtu®
 ~
NÚcoh”’tBus
();

202 
d¿š
(
D¿šMªag”
 *
dm
);

207 
vœtu®
 
»gSts
();

208 
	gSts
::
SÿÏr
 
d©aThroughBus
;

	@packet.cc

51 
	~<c¡ršg
>

52 
	~<io¡»am
>

54 
	~"ba£/ırštf.hh
"

55 
	~"ba£/misc.hh
"

56 
	~"ba£/Œaû.hh
"

57 
	~"mem/·ck‘.hh
"

59 
usšg
 
Çme¥aû
 
	g¡d
;

62 
	#SET1
(
a1
è(1 << (a1))

	)

63 
	#SET2
(
a1
, 
a2
è(
	`SET1
×1è| SET1×2))

	)

64 
	#SET3
(
a1
, 
a2
, 
a3
è(
	`SET2
×1,‡2è| 
	`SET1
×3))

	)

65 
	#SET4
(
a1
, 
a2
, 
a3
, 
a4
è(
	`SET3
×1,‡2,‡3è| 
	`SET1
×4))

	)

66 
	#SET5
(
a1
, 
a2
, 
a3
, 
a4
, 
a5
è(
	`SET4
×1,‡2,‡3,‡4è| 
	`SET1
×5))

	)

67 
	#SET6
(
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
è(
	`SET5
×1,‡2,‡3,‡4,‡5è| 
	`SET1
×6))

	)

69 cÚ¡ 
	gMemCmd
::
CommªdInfo


70 
MemCmd
::
commªdInfo
[] =

73 { 0, 
Inv®idCmd
, "InvalidCmd" },

75 { 
SET3
(
IsR—d
, 
IsReque¡
, 
N“dsRe¥Ú£
), 
R—dRe¥
, "ReadReq" },

77 { 
SET3
(
IsR—d
, 
IsRe¥Ú£
, 
HasD©a
), 
Inv®idCmd
, "ReadResp" },

79 { 
SET4
(
IsR—d
, 
IsRe¥Ú£
, 
HasD©a
, 
IsInv®id©e
),

80 
Inv®idCmd
, "ReadRespWithInvalidate" },

82 { 
SET5
(
IsWr™e
, 
N“dsExşusive
, 
IsReque¡
, 
N“dsRe¥Ú£
, 
HasD©a
),

83 
Wr™eRe¥
, "WriteReq" },

85 { 
SET3
(
IsWr™e
, 
N“dsExşusive
, 
IsRe¥Ú£
), 
Inv®idCmd
, "WriteResp" },

87 { 
SET4
(
IsWr™e
, 
N“dsExşusive
, 
IsReque¡
, 
HasD©a
),

88 
Inv®idCmd
, "Writeback" },

90 { 
SET4
(
IsR—d
, 
IsReque¡
, 
IsSWP»ãtch
, 
N“dsRe¥Ú£
),

91 
SoáPFRe¥
, "SoftPFReq" },

93 { 
SET4
(
IsR—d
, 
IsReque¡
, 
IsHWP»ãtch
, 
N“dsRe¥Ú£
),

94 
H¬dPFRe¥
, "HardPFReq" },

96 { 
SET4
(
IsR—d
, 
IsRe¥Ú£
, 
IsSWP»ãtch
, 
HasD©a
),

97 
Inv®idCmd
, "SoftPFResp" },

99 { 
SET4
(
IsR—d
, 
IsRe¥Ú£
, 
IsHWP»ãtch
, 
HasD©a
),

100 
Inv®idCmd
, "HardPFResp" },

102 { 
SET6
(
IsWr™e
, 
N“dsExşusive
, 
IsInv®id©e
,

103 
IsReque¡
, 
HasD©a
, 
N“dsRe¥Ú£
),

104 
Wr™eInv®id©eRe¥
, "WriteInvalidateReq" },

106 { 
SET3
(
IsWr™e
, 
N“dsExşusive
, 
IsRe¥Ú£
),

107 
Inv®idCmd
, "WriteInvalidateResp" },

109 { 
SET5
(
IsInv®id©e
, 
N“dsExşusive
, 
IsUpg¿de
, 
IsReque¡
, 
N“dsRe¥Ú£
),

110 
Upg¿deRe¥
, "UpgradeReq" },

112 { 
SET6
(
IsInv®id©e
, 
N“dsExşusive
, 
IsUpg¿de
, 
IsLlsc
,

113 
IsReque¡
, 
N“dsRe¥Ú£
),

114 
Upg¿deRe¥
, "SCUpgradeReq" },

116 { 
SET3
(
N“dsExşusive
, 
IsUpg¿de
, 
IsRe¥Ú£
),

117 
Inv®idCmd
, "UpgradeResp" },

119 { 
SET5
(
IsInv®id©e
, 
N“dsExşusive
, 
IsLlsc
,

120 
IsReque¡
, 
N“dsRe¥Ú£
),

121 
Upg¿deFaRe¥
, "SCUpgradeFailReq" },

123 { 
SET2
(
N“dsExşusive
, 
IsRe¥Ú£
),

124 
Inv®idCmd
, "UpgradeFailResp" },

126 { 
SET5
(
IsR—d
, 
N“dsExşusive
, 
IsInv®id©e
, 
IsReque¡
, 
N“dsRe¥Ú£
),

127 
R—dExRe¥
, "ReadExReq" },

129 { 
SET4
(
IsR—d
, 
N“dsExşusive
, 
IsRe¥Ú£
, 
HasD©a
),

130 
Inv®idCmd
, "ReadExResp" },

133 { 
SET4
(
IsR—d
, 
IsLlsc
, 
IsReque¡
, 
N“dsRe¥Ú£
),

134 
R—dRe¥
, "LoadLockedReq" },

136 { 
SET6
(
IsWr™e
, 
N“dsExşusive
, 
IsLlsc
,

137 
IsReque¡
, 
N“dsRe¥Ú£
, 
HasD©a
),

138 
StÜeCÚdRe¥
, "StoreCondReq" },

140 { 
SET6
(
IsWr™e
, 
N“dsExşusive
, 
IsLlsc
,

141 
IsReque¡
, 
N“dsRe¥Ú£
, 
HasD©a
),

142 
StÜeCÚdRe¥
, "StoreCondFailReq" },

144 { 
SET4
(
IsWr™e
, 
N“dsExşusive
, 
IsLlsc
, 
IsRe¥Ú£
),

145 
Inv®idCmd
, "StoreCondResp" },

147 { 
SET6
(
IsR—d
, 
IsWr™e
, 
N“dsExşusive
, 
IsReque¡
, 
HasD©a
, 
N“dsRe¥Ú£
),

148 
Sw­Re¥
, "SwapReq" },

150 { 
SET5
(
IsR—d
, 
IsWr™e
, 
N“dsExşusive
, 
IsRe¥Ú£
, 
HasD©a
),

151 
Inv®idCmd
, "SwapResp" },

153 { 
SET4
(
IsWr™e
, 
IsReque¡
, 
N“dsRe¥Ú£
, 
HasD©a
),

154 
Mes§geRe¥
, "MessageReq" },

156 { 
SET2
(
IsWr™e
, 
IsRe¥Ú£
), 
Inv®idCmd
, "MessageResp" },

158 { 
SET2
(
IsRe¥Ú£
, 
IsE¼Ü
), 
Inv®idCmd
, "InvalidDestError" },

160 { 
SET2
(
IsRe¥Ú£
, 
IsE¼Ü
), 
Inv®idCmd
, "BadAddressError" },

162 { 
SET3
(
IsR—d
, 
IsRe¥Ú£
, 
IsE¼Ü
), 
Inv®idCmd
, "FunctionalReadError" },

164 { 
SET3
(
IsWr™e
, 
IsRe¥Ú£
, 
IsE¼Ü
), 
Inv®idCmd
, "FunctionalWriteError" },

166 { 
SET2
(
IsReque¡
, 
IsPršt
), 
Inv®idCmd
, "PrintReq" },

168 { 
SET3
(
IsReque¡
, 
IsFlush
, 
N“dsExşusive
), 
Inv®idCmd
, "FlushReq" },

170 { 
SET3
(
N“dsExşusive
, 
IsInv®id©e
, 
IsReque¡
),

171 
Inv®idCmd
, "InvalidationReq" },

174 
boŞ


175 
	gPack‘
::
	$checkFunùiÚ®
(
PršbË
 *
obj
, 
Addr
 
addr
, 
size
, 
ušt8_t
 *
d©a
)

177 
Addr
 
func_¡¬t
 = 
	`g‘Addr
();

178 
Addr
 
func_’d
 = 
	`g‘Addr
(è+ 
	`g‘Size
() - 1;

179 
Addr
 
v®_¡¬t
 = 
addr
;

180 
Addr
 
v®_’d
 = 
v®_¡¬t
 + 
size
 - 1;

182 ià(
func_¡¬t
 > 
v®_’d
 || 
v®_¡¬t
 > 
func_’d
) {

184  
çl£
;

188 ià(
	`isPršt
()) {

189 
dyÇmic_ÿ¡
<
PrštReqS‹
*>(
£nd”S‹
)->
	`´štObj
(
obj
);

190  
çl£
;

194 ià(!
d©a
) {

195  
çl£
;

200 
off£t
 = 
func_¡¬t
 - 
v®_¡¬t
;

202 ià(
	`isR—d
()) {

203 ià(
func_¡¬t
 >ğ
v®_¡¬t
 && 
func_’d
 <ğ
v®_’d
) {

204 
	`®loÿ‹
();

205 
	`memıy
(
g‘PŒ
<
ušt8_t
>(), 
d©a
 + 
off£t
, 
	`g‘Size
());

206  
Œue
;

209 
func_off£t
;

210 
v®_off£t
;

211 
ov”Ïp_size
;

214 ià(
v®_¡¬t
 < 
func_¡¬t
 && 
v®_’d
 <ğ
func_’d
) {

215 
v®_off£t
 = 
func_¡¬t
 - 
v®_¡¬t
;

216 
func_off£t
 = 0;

217 
ov”Ïp_size
 = 
v®_’d
 - 
func_¡¬t
;

218 } ià(
v®_¡¬t
 >ğ
func_¡¬t
 && 
v®_’d
 > 
func_’d
) {

219 
v®_off£t
 = 0;

220 
func_off£t
 = 
v®_¡¬t
 - 
func_¡¬t
;

221 
ov”Ïp_size
 = 
func_’d
 - 
v®_¡¬t
;

222 } ià(
v®_¡¬t
 >ğ
func_¡¬t
 && 
v®_’d
 <ğ
func_’d
) {

223 
v®_off£t
 = 0;

224 
func_off£t
 = 
v®_¡¬t
 - 
func_¡¬t
;

225 
ov”Ïp_size
 = 
size
;

227 
	`·nic
("BUG: Missed‡ case for‡…artial functional„equest");

232 ià(
by‹sV®idS¹
 =ğ0 && 
by‹sV®idEnd
 == 0) {

235 
by‹sV®idS¹
 = 
func_off£t
;

236 
by‹sV®idEnd
 = 
func_off£t
 + 
ov”Ïp_size
;

243 
a
 = 
func_off£t
 - 
by‹sV®idS¹
;

244 
b
 = (
func_off£t
 + 
ov”Ïp_size
è- 
by‹sV®idEnd
;

245 
c
 = 
func_off£t
 - 
by‹sV®idEnd
;

246 
d
 = (
func_off£t
 + 
ov”Ïp_size
è- 
by‹sV®idS¹
;

248 ià(
a
 >ğ0 && 
b
 <= 0) {

251 
ov”Ïp_size
 = 0;

252 } ià(
a
 < 0 && 
d
 >ğ0 && 
b
 <= 0) {

254 
ov”Ïp_size
 = 
by‹sV®idS¹
 - 
func_off£t
;

255 
by‹sV®idS¹
 = 
func_off£t
;

256 } ià(
b
 > 0 && 
c
 <ğ0 && 
a
 >= 0) {

259 
ov”Ïp_size
 =

260 (
func_off£t
 + 
ov”Ïp_size
è- 
by‹sV®idEnd
;

261 
v®_off£t
 +ğ
by‹sV®idEnd
 - 
func_off£t
;

262 
func_off£t
 = 
by‹sV®idEnd
;

263 
by‹sV®idEnd
 +ğ
ov”Ïp_size
;

264 } ià(
a
 < 0 && 
b
 > 0) {

271 
ušt8_t
 *
de¡
 = 
g‘PŒ
<ušt8_t>(è+ 
func_off£t
;

272 
ušt8_t
 *
¤c
 = 
d©a
 + 
v®_off£t
;

273 
	`memıy
(
de¡
, 
¤c
, (
by‹sV®idS¹
 - 
func_off£t
));

277 
v®_off£t
 +ğ(
by‹sV®idEnd
 - 
func_off£t
);

278 
by‹sV®idS¹
 = 
func_off£t
;

279 
ov”Ïp_size
 =

280 (
func_off£t
 + 
ov”Ïp_size
è- 
by‹sV®idEnd
;

281 
func_off£t
 = 
by‹sV®idEnd
;

282 
by‹sV®idEnd
 +ğ
ov”Ïp_size
;

283 } ià((
c
 > 0 && 
b
 > 0)

284 || (
a
 < 0 && 
d
 < 0)) {

286 
	`·nic
("BUG: Discontiguous bytes found"

290 
	`as£¹
(
by‹sV®idEnd
 <ğ
	`g‘Size
());

293 
ušt8_t
 *
de¡
 = 
g‘PŒ
<ušt8_t>(è+ 
func_off£t
;

294 
ušt8_t
 *
¤c
 = 
d©a
 + 
v®_off£t
;

295 
	`memıy
(
de¡
, 
¤c
, 
ov”Ïp_size
);

298 
boŞ
 
dÚe
 = (
by‹sV®idS¹
 =ğ0è&& (
by‹sV®idEnd
 =ğ
	`g‘Size
());

299  
dÚe
;

301 } ià(
	`isWr™e
()) {

302 ià(
off£t
 >= 0) {

303 
	`memıy
(
d©a
 + 
off£t
, 
g‘PŒ
<
ušt8_t
>(),

304 (
	`mš
(
func_’d
, 
v®_’d
è- 
func_¡¬t
) + 1);

307 
	`memıy
(
d©a
, 
g‘PŒ
<
ušt8_t
>(è- 
off£t
,

308 (
	`mš
(
func_’d
, 
v®_’d
è- 
v®_¡¬t
) + 1);

311 
	`·nic
("DÚ'ˆknow howØhªdË commªd %s\n", 
	`cmdSŒšg
());

315  
çl£
;

316 
	}
}

319 
	gPack‘
::
pushS’d”S‹
(
Pack‘
::
S’d”S‹
 *
£nd”_¡©e
)

321 
as£¹
(
£nd”_¡©e
 !ğ
NULL
);

322 
	g£nd”_¡©e
->
	g´edeûssÜ
 = 
£nd”S‹
;

323 
	g£nd”S‹
 = 
£nd”_¡©e
;

326 
	gPack‘
::
S’d”S‹
 *

327 
Pack‘
::
	$pİS’d”S‹
()

329 
	`as£¹
(
£nd”S‹
 !ğ
NULL
);

330 
S’d”S‹
 *
£nd”_¡©e
 = 
£nd”S‹
;

331 
£nd”S‹
 = 
£nd”_¡©e
->
´edeûssÜ
;

332 
£nd”_¡©e
->
´edeûssÜ
 = 
NULL
;

333  
£nd”_¡©e
;

334 
	}
}

337 
	gPack‘
::
	$´št
(
o¡»am
 &
o
, cÚ¡ 
v”bos™y
, cÚ¡ 
¡ršg
 &
´efix
) const

339 
	`cırštf
(
o
, "%s[%x:%x] %s\n", 
´efix
,

340 
	`g‘Addr
(), g‘Addr(è+ 
	`g‘Size
(è- 1, 
	`cmdSŒšg
());

341 
	}
}

343 
	g¡d
::
¡ršg


344 
Pack‘
::
	$´št
() const {

345 
o¡ršg¡»am
 
¡r
;

346 
	`´št
(
¡r
);

347  
¡r
.
	`¡r
();

348 
	}
}

350 
	gPack‘
::
PrštReqS‹
::
	$PrštReqS‹
(
o¡»am
 &
_os
, 
_v”bos™y
)

351 : 
	`curP»fixPŒ
(
Ãw
 
	`¡ršg
("")), 
	`os
(
_os
), 
	$v”bos™y
(
_v”bos™y
)

353 
Ïb–Sck
.
	`push_back
(
	`Lab–SckEÁry
("", 
curP»fixPŒ
));

354 
	}
}

356 
	gPack‘
::
PrštReqS‹
::~
	$PrštReqS‹
()

358 
Ïb–Sck
.
	`pİ_back
();

359 
	`as£¹
(
Ïb–Sck
.
	`em±y
());

360 
d–‘e
 
curP»fixPŒ
;

361 
	}
}

363 
	gPack‘
::
PrštReqS‹
::

364 
Lab–SckEÁry
::
	$Lab–SckEÁry
(cÚ¡ 
¡ršg
 &
_Ïb–
, sŒšg *
_´efix
)

365 : 
	`Ïb–
(
_Ïb–
), 
	`´efix
(
_´efix
), 
	$Ïb–Prš‹d
(
çl£
)

367 
	}
}

370 
	gPack‘
::
PrštReqS‹
::
	$pushLab–
(cÚ¡ 
¡ršg
 &
lbl
, cÚ¡ sŒšg &
´efix
)

372 
Ïb–Sck
.
	`push_back
(
	`Lab–SckEÁry
(
lbl
, 
curP»fixPŒ
));

373 
curP»fixPŒ
 = 
Ãw
 
	`¡ršg
(*curPrefixPtr);

374 *
curP»fixPŒ
 +ğ
´efix
;

375 
	}
}

378 
	gPack‘
::
PrštReqS‹
::
	$pİLab–
()

380 
d–‘e
 
curP»fixPŒ
;

381 
curP»fixPŒ
 = 
Ïb–Sck
.
	`back
().
´efix
;

382 
Ïb–Sck
.
	`pİ_back
();

383 
	`as£¹
(!
Ïb–Sck
.
	`em±y
());

384 
	}
}

387 
	gPack‘
::
PrštReqS‹
::
	$´štLab–s
()

389 ià(!
Ïb–Sck
.
	`back
().
Ïb–Prš‹d
) {

390 
Lab–Sck
::
™”©Ü
 
i
 = 
Ïb–Sck
.
	`begš
();

391 
Lab–Sck
::
™”©Ü
 
’d
 = 
Ïb–Sck
.
	`’d
();

392 
i
 !ğ
’d
) {

393 ià(!
i
->
Ïb–Prš‹d
) {

394 
	`cırštf
(
os
, "%s%s\n", *(
i
->
´efix
), i->
Ïb–
);

395 
i
->
Ïb–Prš‹d
 = 
Œue
;

397 
i
++;

400 
	}
}

404 
	gPack‘
::
PrštReqS‹
::
	$´štObj
(
PršbË
 *
obj
)

406 
	`´štLab–s
();

407 
obj
->
	`´št
(
os
, 
v”bos™y
, 
	`curP»fix
());

408 
	}
}

	@packet.hh

52 #iâdeà
__MEM_PACKET_HH__


53 
	#__MEM_PACKET_HH__


	)

55 
	~<b™£t
>

56 
	~<ÿs£¹
>

57 
	~<li¡
>

59 
	~"ba£/ÿ¡.hh
"

60 
	~"ba£/comp”.hh
"

61 
	~"ba£/æags.hh
"

62 
	~"ba£/misc.hh
"

63 
	~"ba£/´šbË.hh
"

64 
	~"ba£/ty³s.hh
"

65 
	~"mem/»que¡.hh
"

66 
	~"sim/cÜe.hh
"

68 
şass
 
	gPack‘
;

69 
Pack‘
 *
	tPack‘PŒ
;

70 
ušt8_t
* 
	tPack‘D©aPŒ
;

71 
	g¡d
::
	tli¡
<
	tPack‘PŒ
> 
	tPack‘Li¡
;

73 şas 
	cMemCmd


75 
ä›nd
 
şass
 
	mPack‘
;

77 
	mpublic
:

81 
	eCommªd


83 
Inv®idCmd
,

84 
	mR—dReq
,

85 
	mR—dRe¥
,

86 
	mR—dRe¥W™hInv®id©e
,

87 
	mWr™eReq
,

88 
	mWr™eRe¥
,

89 
	mWr™eback
,

90 
	mSoáPFReq
,

91 
	mH¬dPFReq
,

92 
	mSoáPFRe¥
,

93 
	mH¬dPFRe¥
,

102 
	mWr™eInv®id©eReq
,

103 
	mWr™eInv®id©eRe¥
,

104 
	mUpg¿deReq
,

105 
	mSCUpg¿deReq
,

106 
	mUpg¿deRe¥
,

107 
	mSCUpg¿deFaReq
,

108 
	mUpg¿deFaRe¥
,

109 
	mR—dExReq
,

110 
	mR—dExRe¥
,

111 
	mLßdLockedReq
,

112 
	mStÜeCÚdReq
,

113 
	mStÜeCÚdFaReq
,

114 
	mStÜeCÚdRe¥
,

115 
	mSw­Req
,

116 
	mSw­Re¥
,

117 
	mMes§geReq
,

118 
	mMes§geRe¥
,

123 
	mInv®idDe¡E¼Ü
,

124 
	mBadAdd»ssE¼Ü
,

125 
	mFunùiÚ®R—dE¼Ü
,

126 
	mFunùiÚ®Wr™eE¼Ü
,

128 
	mPrštReq
,

129 
	mFlushReq
,

130 
	mInv®id©iÚReq
,

131 
	mNUM_MEM_CMDS


134 
	g´iv©e
:

138 
	eA‰ribu‹


140 
IsR—d
,

141 
	gIsWr™e
,

142 
	gIsUpg¿de
,

143 
	gIsInv®id©e
,

144 
	gN“dsExşusive
,

145 
	gIsReque¡
,

146 
	gIsRe¥Ú£
,

147 
	gN“dsRe¥Ú£
,

148 
	gIsSWP»ãtch
,

149 
	gIsHWP»ãtch
,

150 
	gIsLlsc
,

151 
	gHasD©a
,

152 
	gIsE¼Ü
,

153 
	gIsPršt
,

154 
	gIsFlush
,

155 
	gNUM_COMMAND_ATTRIBUTES


162 
	sCommªdInfo


165 cÚ¡ 
	g¡d
::
b™£t
<
NUM_COMMAND_ATTRIBUTES
> 
©Œibu‹s
;

168 cÚ¡ 
Commªd
 
	g»¥Ú£
;

170 cÚ¡ 
	g¡d
::
¡ršg
 
¡r
;

174 cÚ¡ 
CommªdInfo
 
	gcommªdInfo
[];

176 
	g´iv©e
:

178 
Commªd
 
cmd
;

180 
boŞ


181 
‹¡CmdA‰rib
(
MemCmd
::
A‰ribu‹
 
©Œib
) const

183  
commªdInfo
[
cmd
].
©Œibu‹s
[
©Œib
] != 0;

186 
	gpublic
:

188 
boŞ
 
	$isR—d
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsR—d
); 
	}
}

189 
boŞ
 
	$isWr™e
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsWr™e
); 
	}
}

190 
boŞ
 
	$isUpg¿de
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsUpg¿de
); 
	}
}

191 
boŞ
 
	$isReque¡
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsReque¡
); 
	}
}

192 
boŞ
 
	$isRe¥Ú£
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsRe¥Ú£
); 
	}
}

193 
boŞ
 
	$ÃedsExşusive
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
N“dsExşusive
); 
	}
}

194 
boŞ
 
	$ÃedsRe¥Ú£
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
N“dsRe¥Ú£
); 
	}
}

195 
boŞ
 
	$isInv®id©e
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsInv®id©e
); 
	}
}

196 
boŞ
 
	$hasD©a
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
HasD©a
); 
	}
}

197 
boŞ
 
	$isR—dWr™e
(ècÚ¡ {  
	`isR—d
(è&& 
	`isWr™e
(); 
	}
}

198 
boŞ
 
	$isLLSC
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsLlsc
); 
	}
}

199 
boŞ
 
	$isE¼Ü
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsE¼Ü
); 
	}
}

200 
boŞ
 
	$isPršt
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsPršt
); 
	}
}

201 
boŞ
 
	$isFlush
(ècÚ¡ {  
	`‹¡CmdA‰rib
(
IsFlush
); 
	}
}

203 cÚ¡ 
Commªd


204 
	$»¥Ú£Commªd
() const

206  
commªdInfo
[
cmd
].
»¥Ú£
;

207 
	}
}

210 cÚ¡ 
	g¡d
::
¡ršg
 &
	$toSŒšg
(ècÚ¡ {  
commªdInfo
[
cmd
].
¡r
; 
	}
}

211 
	$toIÁ
(ècÚ¡ {  ()
cmd
; 
	}
}

213 
	$MemCmd
(
Commªd
 
_cmd
è: 
	$cmd
(
_cmd
è{ 
	}
}

214 
	$MemCmd
(
_cmd
è: 
	`cmd
((
Commªd
)_cmdè{ 
	}
}

215 
	$MemCmd
(è: 
	$cmd
(
Inv®idCmd
è{ 
	}
}

217 
boŞ
 
İ”©Ü
==(
MemCmd
 
c2
ècÚ¡ {  (
cmd
 == c2.cmd); }

218 
boŞ
 
	gİ”©Ü
!=(
MemCmd
 
c2
ècÚ¡ {  (
cmd
 != c2.cmd); }

228 şas 
	cPack‘
 : 
public
 
PršbË


230 
public
:

231 
ušt32_t
 
	tFÏgsTy³
;

232 ::
FÏgs
<
	tFÏgsTy³
> 
	tFÏgs
;

234 
	m´iv©e
:

235 cÚ¡ 
FÏgsTy³
 
PUBLIC_FLAGS
 = 0x00000000;

236 cÚ¡ 
FÏgsTy³
 
	mPRIVATE_FLAGS
 = 0x00007F0F;

237 cÚ¡ 
FÏgsTy³
 
	mCOPY_FLAGS
 = 0x0000000F;

239 cÚ¡ 
FÏgsTy³
 
	mSHARED
 = 0x00000001;

242 cÚ¡ 
FÏgsTy³
 
	mEXPRESS_SNOOP
 = 0x00000002;

245 cÚ¡ 
FÏgsTy³
 
	mSUPPLY_EXCLUSIVE
 = 0x00000004;

247 cÚ¡ 
FÏgsTy³
 
	mMEM_INHIBIT
 = 0x00000008;

249 cÚ¡ 
FÏgsTy³
 
	mVALID_ADDR
 = 0x00000100;

250 cÚ¡ 
FÏgsTy³
 
	mVALID_SIZE
 = 0x00000200;

253 cÚ¡ 
FÏgsTy³
 
	mSTATIC_DATA
 = 0x00001000;

256 cÚ¡ 
FÏgsTy³
 
	mDYNAMIC_DATA
 = 0x00002000;

259 cÚ¡ 
FÏgsTy³
 
	mARRAY_DATA
 = 0x00004000;

262 cÚ¡ 
FÏgsTy³
 
	mSUPPRESS_FUNC_ERROR
 = 0x00008000;

264 
FÏgs
 
	mæags
;

266 
	mpublic
:

267 
MemCmd
::
	tCommªd
 Command;

270 
MemCmd
 
	mcmd
;

273 
Reque¡PŒ
 
	m»q
;

281 
Pack‘D©aPŒ
 
	md©a
;

283 
	m´iv©e
:

287 
Addr
 
addr
;

290 
	msize
;

304 
PÜtID
 
	m¤c
;

314 
PÜtID
 
	mde¡
;

322 
MemCmd
 
	mÜigCmd
;

328 
ušt16_t
 
	mby‹sV®idS¹
;

329 
ušt16_t
 
	mby‹sV®idEnd
;

331 
	mpublic
:

340 
ušt32_t
 
busFœ¡WÜdD–ay
;

349 
ušt32_t
 
	mbusLa¡WÜdD–ay
;

368 
	sS’d”S‹


370 
S’d”S‹
* 
	m´edeûssÜ
;

371 
S’d”S‹
(è: 
´edeûssÜ
(
NULL
) {}

372 
vœtu®
 ~
S’d”S‹
() {}

379 şas 
	cPrštReqS‹
 : 
public
 
S’d”S‹


381 
´iv©e
:

385 
	sLab–SckEÁry


387 cÚ¡ 
¡d
::
¡ršg
 
Ïb–
;

388 
	g¡d
::
¡ršg
 *
´efix
;

389 
boŞ
 
	gÏb–Prš‹d
;

390 
Lab–SckEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
_Ïb–
, std::¡ršg *
_´efix
);

393 
	g¡d
::
	tli¡
<
	tLab–SckEÁry
> 
	tLab–Sck
;

394 
Lab–Sck
 
	gÏb–Sck
;

396 
	g¡d
::
¡ršg
 *
curP»fixPŒ
;

398 
	gpublic
:

399 
¡d
::
o¡»am
 &
os
;

400 cÚ¡ 
	gv”bos™y
;

402 
PrštReqS‹
(
¡d
::
o¡»am
 &
os
, 
v”bos™y
 = 0);

403 ~
PrštReqS‹
();

408 cÚ¡ 
	g¡d
::
¡ršg
 &
curP»fix
(è{  *
curP»fixPŒ
; }

415 
pushLab–
(cÚ¡ 
¡d
::
¡ršg
 &
lbl
,

416 cÚ¡ 
¡d
::
¡ršg
 &
´efix
 = " ");

421 
pİLab–
();

428 
´štLab–s
();

434 
´štObj
(
PršbË
 *
obj
);

445 
S’d”S‹
 *
	g£nd”S‹
;

455 
pushS’d”S‹
(
S’d”S‹
 *
£nd”_¡©e
);

465 
S’d”S‹
 *
pİS’d”S‹
();

474 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

475 
T
 * 
	$fšdNextS’d”S‹
() const

477 
T
 *
t
 = 
NULL
;

478 
S’d”S‹
* 
£nd”_¡©e
 = 
£nd”S‹
;

479 
t
 =ğ
NULL
 && 
£nd”_¡©e
 != NULL) {

480 
t
 = 
dyÇmic_ÿ¡
<
T
*>(
£nd”_¡©e
);

481 
£nd”_¡©e
 = s’d”_¡©e->
´edeûssÜ
;

483  
t
;

484 
	}
}

488 cÚ¡ 
	g¡d
::
¡ršg
 &
	$cmdSŒšg
(ècÚ¡ {  
cmd
.
	`toSŒšg
(); 
	}
}

491 
šlše
 
	$cmdToIndex
(ècÚ¡ {  
cmd
.
	`toIÁ
(); 
	}
}

493 
boŞ
 
	$isR—d
(ècÚ¡ {  
cmd
.
	`isR—d
(); 
	}
}

494 
boŞ
 
	$isWr™e
(ècÚ¡ {  
cmd
.
	`isWr™e
(); 
	}
}

495 
boŞ
 
	$isUpg¿de
(ècÚ¡ {  
cmd
.
	`isUpg¿de
(); 
	}
}

496 
boŞ
 
	$isReque¡
(ècÚ¡ {  
cmd
.
	`isReque¡
(); 
	}
}

497 
boŞ
 
	$isRe¥Ú£
(ècÚ¡ {  
cmd
.
	`isRe¥Ú£
(); 
	}
}

498 
boŞ
 
	$ÃedsExşusive
(ècÚ¡ {  
cmd
.
	`ÃedsExşusive
(); 
	}
}

499 
boŞ
 
	$ÃedsRe¥Ú£
(ècÚ¡ {  
cmd
.
	`ÃedsRe¥Ú£
(); 
	}
}

500 
boŞ
 
	$isInv®id©e
(ècÚ¡ {  
cmd
.
	`isInv®id©e
(); 
	}
}

501 
boŞ
 
	$hasD©a
(ècÚ¡ {  
cmd
.
	`hasD©a
(); 
	}
}

502 
boŞ
 
	$isR—dWr™e
(ècÚ¡ {  
cmd
.
	`isR—dWr™e
(); 
	}
}

503 
boŞ
 
	$isLLSC
(ècÚ¡ {  
cmd
.
	`isLLSC
(); 
	}
}

504 
boŞ
 
	$isE¼Ü
(ècÚ¡ {  
cmd
.
	`isE¼Ü
(); 
	}
}

505 
boŞ
 
	$isPršt
(ècÚ¡ {  
cmd
.
	`isPršt
(); 
	}
}

506 
boŞ
 
	$isFlush
(ècÚ¡ {  
cmd
.
	`isFlush
(); 
	}
}

509 
	$as£¹MemInhib™
(è{ 
æags
.
	`£t
(
MEM_INHIBIT
); 
	}
}

510 
boŞ
 
	$memInhib™As£¹ed
(ècÚ¡ {  
æags
.
	`isS‘
(
MEM_INHIBIT
); 
	}
}

511 
	$as£¹Sh¬ed
(è{ 
æags
.
	`£t
(
SHARED
); 
	}
}

512 
boŞ
 
	$sh¬edAs£¹ed
(ècÚ¡ {  
æags
.
	`isS‘
(
SHARED
); 
	}
}

515 
	$£tEx´essSnoİ
(è{ 
æags
.
	`£t
(
EXPRESS_SNOOP
); 
	}
}

516 
boŞ
 
	$isEx´essSnoİ
(ècÚ¡ {  
æags
.
	`isS‘
(
EXPRESS_SNOOP
); 
	}
}

517 
	$£tSuµlyExşusive
(è{ 
æags
.
	`£t
(
SUPPLY_EXCLUSIVE
); 
	}
}

518 
	$ş—rSuµlyExşusive
(è{ 
æags
.
	`ş—r
(
SUPPLY_EXCLUSIVE
); 
	}
}

519 
boŞ
 
	$isSuµlyExşusive
(ècÚ¡ {  
æags
.
	`isS‘
(
SUPPLY_EXCLUSIVE
); 
	}
}

520 
	$£tSuµ»ssFuncE¼Ü
(è{ 
æags
.
	`£t
(
SUPPRESS_FUNC_ERROR
); 
	}
}

521 
boŞ
 
	$suµ»ssFuncE¼Ü
(ècÚ¡ {  
æags
.
	`isS‘
(
SUPPRESS_FUNC_ERROR
); 
	}
}

527 
	$£tBadAdd»ss
()

529 
	`as£¹
(
	`isRe¥Ú£
());

530 
cmd
 = 
MemCmd
::
BadAdd»ssE¼Ü
;

531 
	}
}

533 
boŞ
 
	$hadBadAdd»ss
(ècÚ¡ {  
cmd
 =ğ
MemCmd
::
BadAdd»ssE¼Ü
; 
	}
}

534 
	$cİyE¼Ü
(
Pack‘
 *
pkt
è{ 
	`as£¹
Õkt->
	`isE¼Ü
()); 
cmd
 =…kt->cmd; 
	}
}

536 
boŞ
 
	$isSrcV®id
(ècÚ¡ {  
¤c
 !ğ
Inv®idPÜtID
; 
	}
}

538 
PÜtID
 
	$g‘Src
(ècÚ¡ { 
	`as£¹
(
	`isSrcV®id
());  
¤c
; 
	}
}

540 
	$£tSrc
(
PÜtID
 
_¤c
è{ 
¤c
 = _¤c; 
	}
}

542 
	$ş—rSrc
(è{ 
¤c
 = 
Inv®idPÜtID
; 
	}
}

544 
boŞ
 
	$isDe¡V®id
(ècÚ¡ {  
de¡
 !ğ
Inv®idPÜtID
; 
	}
}

546 
PÜtID
 
	$g‘De¡
(ècÚ¡ { 
	`as£¹
(
	`isDe¡V®id
());  
de¡
; 
	}
}

548 
	$£tDe¡
(
PÜtID
 
_de¡
è{ 
de¡
 = _de¡; 
	}
}

550 
	$ş—rDe¡
(è{ 
de¡
 = 
Inv®idPÜtID
; 
	}
}

552 
Addr
 
	$g‘Addr
(ècÚ¡ { 
	`as£¹
(
æags
.
	`isS‘
(
VALID_ADDR
));  
addr
; 
	}
}

560 
	$£tAddr
(
Addr
 
_addr
è{ 
	`as£¹
(
æags
.
	`isS‘
(
VALID_ADDR
)); 
addr
 = _addr; 
	}
}

562 
	$g‘Size
(ècÚ¡ { 
	`as£¹
(
æags
.
	`isS‘
(
VALID_SIZE
));  
size
; 
	}
}

563 
Addr
 
	$g‘Off£t
(
blkSize
ècÚ¡ {  
	`g‘Addr
(è& (
Addr
)(blkSiz- 1); 
	}
}

570 
	$cÚv”tScToWr™e
()

572 
	`as£¹
(
	`isLLSC
());

573 
	`as£¹
(
	`isWr™e
());

574 
cmd
 = 
MemCmd
::
Wr™eReq
;

575 
	}
}

582 
	$cÚv”tLlToR—d
()

584 
	`as£¹
(
	`isLLSC
());

585 
	`as£¹
(
	`isR—d
());

586 
cmd
 = 
MemCmd
::
R—dReq
;

587 
	}
}

594 
	$Pack‘
(
Reque¡
 *
_»q
, 
MemCmd
 
_cmd
)

595 : 
	`cmd
(
_cmd
), 
	`»q
(
_»q
), 
	`d©a
(
NULL
),

596 
	`¤c
(
Inv®idPÜtID
), 
	`de¡
(InvalidPortID),

597 
	`by‹sV®idS¹
(0), 
	`by‹sV®idEnd
(0),

598 
	`busFœ¡WÜdD–ay
(0), 
	`busLa¡WÜdD–ay
(0),

599 
	$£nd”S‹
(
NULL
)

601 ià(
»q
->
	`hasPaddr
()) {

602 
addr
 = 
»q
->
	`g‘Paddr
();

603 
æags
.
	`£t
(
VALID_ADDR
);

605 ià(
»q
->
	`hasSize
()) {

606 
size
 = 
»q
->
	`g‘Size
();

607 
æags
.
	`£t
(
VALID_SIZE
);

609 
	}
}

616 
	$Pack‘
(
Reque¡
 *
_»q
, 
MemCmd
 
_cmd
, 
_blkSize
)

617 : 
	`cmd
(
_cmd
), 
	`»q
(
_»q
), 
	`d©a
(
NULL
),

618 
	`¤c
(
Inv®idPÜtID
), 
	`de¡
(InvalidPortID),

619 
	`by‹sV®idS¹
(0), 
	`by‹sV®idEnd
(0),

620 
	`busFœ¡WÜdD–ay
(0), 
	`busLa¡WÜdD–ay
(0),

621 
	$£nd”S‹
(
NULL
)

623 ià(
»q
->
	`hasPaddr
()) {

624 
addr
 = 
»q
->
	`g‘Paddr
(è& ~(
_blkSize
 - 1);

625 
æags
.
	`£t
(
VALID_ADDR
);

627 
size
 = 
_blkSize
;

628 
æags
.
	`£t
(
VALID_SIZE
);

629 
	}
}

638 
	$Pack‘
(
Pack‘
 *
pkt
, 
boŞ
 
ş—rFÏgs
 = 
çl£
)

639 : 
	`cmd
(
pkt
->
cmd
), 
	`»q
Õkt->
»q
),

640 
	`d©a
(
pkt
->
æags
.
	`isS‘
(
STATIC_DATA
è?…kt->
d©a
 : 
NULL
),

641 
	`addr
(
pkt
->
addr
), 
	`size
Õkt->
size
), 
	`¤c
Õkt->
¤c
), 
	`de¡
Õkt->
de¡
),

642 
	`by‹sV®idS¹
(
pkt
->
by‹sV®idS¹
),

643 
	`by‹sV®idEnd
(
pkt
->
by‹sV®idEnd
),

644 
	`busFœ¡WÜdD–ay
(
pkt
->
busFœ¡WÜdD–ay
),

645 
	`busLa¡WÜdD–ay
(
pkt
->
busLa¡WÜdD–ay
),

646 
	`£nd”S‹
(
pkt
->
£nd”S‹
)

648 ià(!
ş—rFÏgs
)

649 
æags
.
	`£t
(
pkt
->æag & 
COPY_FLAGS
);

651 
æags
.
	`£t
(
pkt
->æag & (
VALID_ADDR
|
VALID_SIZE
));

652 
æags
.
	`£t
(
pkt
->æag & 
STATIC_DATA
);

654 
	}
}

659 ~
	$Pack‘
()

664 ià(
»q
 && 
	`isReque¡
(è&& !
	`ÃedsRe¥Ú£
())

665 
d–‘e
 
»q
;

666 
	`d–‘eD©a
();

667 
	}
}

677 
	$»š™FromReque¡
()

679 
	`as£¹
(
»q
->
	`hasPaddr
());

680 
æags
 = 0;

681 
addr
 = 
»q
->
	`g‘Paddr
();

682 
size
 = 
»q
->
	`g‘Size
();

684 
¤c
 = 
Inv®idPÜtID
;

685 
de¡
 = 
Inv®idPÜtID
;

686 
by‹sV®idS¹
 = 0;

687 
by‹sV®idEnd
 = 0;

688 
busFœ¡WÜdD–ay
 = 0;

689 
busLa¡WÜdD–ay
 = 0;

691 
æags
.
	`£t
(
VALID_ADDR
|
VALID_SIZE
);

692 
	`d–‘eD©a
();

693 
	}
}

703 
	$makeRe¥Ú£
()

705 
	`as£¹
(
	`ÃedsRe¥Ú£
());

706 
	`as£¹
(
	`isReque¡
());

707 
ÜigCmd
 = 
cmd
;

708 
cmd
 = cmd.
	`»¥Ú£Commªd
();

712 
æags
.
	`ş—r
(
EXPRESS_SNOOP
);

714 
de¡
 = 
¤c
;

715 
	`ş—rSrc
();

716 
	}
}

719 
	$makeAtomicRe¥Ú£
()

721 
	`makeRe¥Ú£
();

722 
	}
}

725 
	$makeTimšgRe¥Ú£
()

727 
	`makeRe¥Ú£
();

728 
	}
}

731 
	$£tFunùiÚ®Re¥Ú£Stus
(
boŞ
 
sucûss
)

733 ià(!
sucûss
) {

734 ià(
	`isWr™e
()) {

735 
cmd
 = 
MemCmd
::
FunùiÚ®Wr™eE¼Ü
;

737 
cmd
 = 
MemCmd
::
FunùiÚ®R—dE¼Ü
;

740 
	}
}

743 
	$£tSize
(
size
)

745 
	`as£¹
(!
æags
.
	`isS‘
(
VALID_SIZE
));

747 
this
->
size
 = size;

748 
æags
.
	`£t
(
VALID_SIZE
);

749 
	}
}

756 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

758 
	$d©aStic
(
T
 *
p
)

760 
	`as£¹
(
æags
.
	`nÚeS‘
(
STATIC_DATA
|
DYNAMIC_DATA
|
ARRAY_DATA
));

761 
d©a
 = (
Pack‘D©aPŒ
)
p
;

762 
æags
.
	`£t
(
STATIC_DATA
);

763 
	}
}

769 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

771 
	$d©aDyÇmicA¼ay
(
T
 *
p
)

773 
	`as£¹
(
æags
.
	`nÚeS‘
(
STATIC_DATA
|
DYNAMIC_DATA
|
ARRAY_DATA
));

774 
d©a
 = (
Pack‘D©aPŒ
)
p
;

775 
æags
.
	`£t
(
DYNAMIC_DATA
|
ARRAY_DATA
);

776 
	}
}

782 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

784 
	$d©aDyÇmic
(
T
 *
p
)

786 
	`as£¹
(
æags
.
	`nÚeS‘
(
STATIC_DATA
|
DYNAMIC_DATA
|
ARRAY_DATA
));

787 
d©a
 = (
Pack‘D©aPŒ
)
p
;

788 
æags
.
	`£t
(
DYNAMIC_DATA
);

789 
	}
}

794 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

795 
T
*

796 
	$g‘PŒ
(
boŞ
 
nuÎ_ok
 = 
çl£
)

798 
	`as£¹
(
nuÎ_ok
 || 
æags
.
	`isS‘
(
STATIC_DATA
|
DYNAMIC_DATA
));

799  (
T
*)
d©a
;

800 
	}
}

805 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

806 
T
 
g‘
();

811 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

812 
£t
(
T
 
v
);

818 
	$£tD©a
(
ušt8_t
 *
p
)

820 ià(
p
 !ğ
g‘PŒ
<
ušt8_t
>())

821 
¡d
::
	`memıy
(
g‘PŒ
<
ušt8_t
>(), 
p
, 
	`g‘Size
());

822 
	}
}

829 
	$£tD©aFromBlock
(
ušt8_t
 *
blk_d©a
, 
blkSize
)

831 
	`£tD©a
(
blk_d©a
 + 
	`g‘Off£t
(
blkSize
));

832 
	}
}

839 
	$wr™eD©a
(
ušt8_t
 *
p
)

841 
¡d
::
	`memıy
(
p
, 
g‘PŒ
<
ušt8_t
>(), 
	`g‘Size
());

842 
	}
}

848 
	$wr™eD©aToBlock
(
ušt8_t
 *
blk_d©a
, 
blkSize
)

850 
	`wr™eD©a
(
blk_d©a
 + 
	`g‘Off£t
(
blkSize
));

851 
	}
}

858 
	$d–‘eD©a
()

860 ià(
æags
.
	`isS‘
(
ARRAY_DATA
))

861 
d–‘e
 [] 
d©a
;

862 ià(
æags
.
	`isS‘
(
DYNAMIC_DATA
))

863 
d–‘e
 
d©a
;

865 
æags
.
	`ş—r
(
STATIC_DATA
|
DYNAMIC_DATA
|
ARRAY_DATA
);

866 
d©a
 = 
NULL
;

867 
	}
}

871 
	$®loÿ‹
()

873 ià(
d©a
) {

874 
	`as£¹
(
æags
.
	`isS‘
(
STATIC_DATA
|
DYNAMIC_DATA
));

878 
	`as£¹
(
æags
.
	`nÚeS‘
(
STATIC_DATA
|
DYNAMIC_DATA
));

879 
æags
.
	`£t
(
DYNAMIC_DATA
|
ARRAY_DATA
);

880 
d©a
 = 
Ãw
 
ušt8_t
[
	`g‘Size
()];

881 
	}
}

890 
boŞ
 
checkFunùiÚ®
(
PršbË
 *
obj
, 
Addr
 
ba£
, 
size
, 
ušt8_t
 *
d©a
);

896 
boŞ


897 
	$checkFunùiÚ®
(
Pack‘PŒ
 
Ùh”
)

899 
ušt8_t
 *
d©a
 = 
Ùh”
->
	`hasD©a
(è? oth”->
g‘PŒ
<ušt8_t>(è: 
NULL
;

900  
	`checkFunùiÚ®
(
Ùh”
, oth”->
	`g‘Addr
(), oth”->
	`g‘Size
(),

901 
d©a
);

902 
	}
}

908 
pushLab–
(cÚ¡ 
¡d
::
¡ršg
 &
lbl
)

910 ià(
isPršt
())

911 
§ã_ÿ¡
<
PrštReqS‹
*>(
£nd”S‹
)->
pushLab–
(
lbl
);

918 
	$pİLab–
()

920 ià(
	`isPršt
())

921 
§ã_ÿ¡
<
PrštReqS‹
*>(
£nd”S‹
)->
	`pİLab–
();

922 
	}
}

924 
´št
(
¡d
::
o¡»am
 &
o
, 
v”bos™y
 = 0,

925 cÚ¡ 
¡d
::
¡ršg
 &
´efix
 = "") const;

933 
	g¡d
::
¡ršg
 
	$´št
() const;

934 
	}
};

	@packet_access.hh

32 
	~"¬ch/i§_Œa™s.hh
"

33 
	~"ba£/bigšt.hh
"

34 
	~"cÚfig/the_i§.hh
"

35 
	~"mem/·ck‘.hh
"

36 
	~"sim/by‹sw­.hh
"

38 #iâdeà
__MEM_PACKET_ACCESS_HH__


39 
	#__MEM_PACKET_ACCESS_HH__


	)

46 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

47 
šlše
 
T


48 
	gPack‘
::
	$g‘
()

50 
	`as£¹
(
æags
.
	`isS‘
(
STATIC_DATA
|
DYNAMIC_DATA
));

51 
	`as£¹
((
T
è<ğ
size
);

52  
TheISA
::
	`gtoh
(*(
T
*)
d©a
);

53 
	}
}

56 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

57 
šlše
 

58 
	gPack‘
::
	$£t
(
T
 
v
)

60 
	`as£¹
(
æags
.
	`isS‘
(
STATIC_DATA
|
DYNAMIC_DATA
));

61 
	`as£¹
((
T
è<ğ
size
);

62 *(
T
*)
d©a
 = 
TheISA
::
	`htog
(
v
);

63 
	}
}

	@packet_queue.cc

44 
	~"ba£/Œaû.hh
"

45 
	~"debug/D¿š.hh
"

46 
	~"debug/Pack‘Queue.hh
"

47 
	~"mem/·ck‘_queue.hh
"

49 
usšg
 
Çme¥aû
 
	g¡d
;

51 
	gPack‘Queue
::
Pack‘Queue
(
Ev’tMªag”
& 
_em
, cÚ¡ 
¡d
::
¡ršg
& 
_Ïb–
)

52 : 
em
(
_em
), 
£ndEv’t
(
this
), 
d¿šMªag”
(
NULL
), 
Ïb–
(
_Ïb–
),

53 
	$wa™šgOnR‘ry
(
çl£
)

55 
	}
}

57 
	gPack‘Queue
::~
	$Pack‘Queue
()

59 
	}
}

62 
Pack‘Queue
::
	$»Œy
()

64 
	`DPRINTF
(
Pack‘Queue
, "Queu% »ûived„‘ry\n", 
	`Çme
());

65 
	`as£¹
(
wa™šgOnR‘ry
);

66 
	`£ndDeã¼edPack‘
();

67 
	}
}

69 
boŞ


70 
	gPack‘Queue
::
	$checkFunùiÚ®
(
Pack‘PŒ
 
pkt
)

72 
pkt
->
	`pushLab–
(
Ïb–
);

74 
Deã¼edPack‘I‹¿tÜ
 
i
 = 
Œªsm™Li¡
.
	`begš
();

75 
Deã¼edPack‘I‹¿tÜ
 
’d
 = 
Œªsm™Li¡
.
	`’d
();

76 
boŞ
 
found
 = 
çl£
;

78 !
found
 && 
i
 !ğ
’d
) {

81 
found
 = 
pkt
->
	`checkFunùiÚ®
(
i
->pkt);

82 ++
i
;

85 
pkt
->
	`pİLab–
();

87  
found
;

88 
	}
}

91 
	gPack‘Queue
::
	$schedS’dEv’t
(
Tick
 
wh’
)

95 ià(
wa™šgOnR‘ry
) {

96 
	`as£¹
(!
£ndEv’t
.
	`scheduËd
());

100 ià(!
£ndEv’t
.
	`scheduËd
()) {

101 
em
.
	`scheduË
(&
£ndEv’t
, 
wh’
);

102 } ià(
£ndEv’t
.
	`wh’
(è> 
wh’
) {

103 
em
.
	`»scheduË
(&
£ndEv’t
, 
wh’
);

105 
	}
}

108 
	gPack‘Queue
::
	$schedS’dTimšg
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
, 
boŞ
 
£nd_as_¢oİ
)

110 
	`DPRINTF
(
Pack‘Queue
, "% fÜ % add»s %x siz%d\n", 
__func__
,

111 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

113 
	`as£¹
(
wh’
 >ğ
	`curTick
());

116 
	`as£¹
(!
pkt
->
	`isEx´essSnoİ
());

120 ià(
Œªsm™Li¡
.
	`size
() > 100) {

121 
	`·nic
("Packet queue %s has grown beyond 100…ackets\n",

122 
	`Çme
());

127 ià(
Œªsm™Li¡
.
	`em±y
(è|| 
wh’
 <¿nsm™Li¡.
	`äÚt
().
tick
) {

131 
Œªsm™Li¡
.
	`push_äÚt
(
	`Deã¼edPack‘
(
wh’
, 
pkt
, 
£nd_as_¢oİ
));

132 
	`schedS’dEv’t
(
wh’
);

137 ià(
wh’
 >ğ
Œªsm™Li¡
.
	`back
().
tick
) {

138 
Œªsm™Li¡
.
	`push_back
(
	`Deã¼edPack‘
(
wh’
, 
pkt
, 
£nd_as_¢oİ
));

143 
Deã¼edPack‘I‹¿tÜ
 
i
 = 
Œªsm™Li¡
.
	`begš
();

144 ++
i
;

145 
i
 !ğ
Œªsm™Li¡
.
	`’d
(è&& 
wh’
 >ği->
tick
)

146 ++
i
;

147 
Œªsm™Li¡
.
	`š£¹
(
i
, 
	`Deã¼edPack‘
(
wh’
, 
pkt
, 
£nd_as_¢oİ
));

148 
	}
}

150 
	gPack‘Queue
::
	$ŒyS’dTimšg
()

152 
	`as£¹
(
	`deã¼edPack‘R—dy
());

156 
Deã¼edPack‘
 
dp
 = 
Œªsm™Li¡
.
	`äÚt
();

157 
Œªsm™Li¡
.
	`pİ_äÚt
();

162 
wa™šgOnR‘ry
 = !
	`£ndTimšg
(
dp
.
pkt
, dp.
£ndAsSnoİ
);

164 ià(
wa™šgOnR‘ry
) {

167 
	`as£¹
(!
£ndEv’t
.
	`scheduËd
());

168 
Œªsm™Li¡
.
	`push_äÚt
(
dp
);

170 
	}
}

173 
	gPack‘Queue
::
	$scheduËS’d
(
Tick
 
time
)

177 
Tick
 
ÃxtR—dy
 = 
¡d
::
	`mš
(
	`deã¼edPack‘R—dyTime
(), 
time
);

179 ià(
ÃxtR—dy
 !ğ
MaxTick
) {

182 ià(!
£ndEv’t
.
	`scheduËd
())

183 
em
.
	`scheduË
(&
£ndEv’t
, 
¡d
::
	`max
(
ÃxtR—dy
, 
	`curTick
() + 1));

186 ià(
d¿šMªag”
 && 
Œªsm™Li¡
.
	`em±y
(è&& !
£ndEv’t
.
	`scheduËd
()) {

187 
	`DPRINTF
(
D¿š
, "PacketQueue done draining,"

189 
d¿šMªag”
->
	`sigÇlD¿šDÚe
();

190 
d¿šMªag”
 = 
NULL
;

193 
	}
}

196 
	gPack‘Queue
::
	$£ndDeã¼edPack‘
()

200 
	`ŒyS’dTimšg
();

204 ià(!
wa™šgOnR‘ry
) {

205 
	`scheduËS’d
();

207 
	}
}

210 
	gPack‘Queue
::
	$´oûssS’dEv’t
()

212 
	`as£¹
(!
wa™šgOnR‘ry
);

213 
	`£ndDeã¼edPack‘
();

214 
	}
}

217 
	gPack‘Queue
::
	$d¿š
(
D¿šMªag”
 *
dm
)

219 ià(
Œªsm™Li¡
.
	`em±y
(è&& !
£ndEv’t
.
	`scheduËd
())

221 
	`DPRINTF
(
D¿š
, "PacketQueue‚ot drained\n");

222 
d¿šMªag”
 = 
dm
;

224 
	}
}

226 
	gMa¡”Pack‘Queue
::
Ma¡”Pack‘Queue
(
Ev’tMªag”
& 
_em
, 
Ma¡”PÜt
& 
_ma¡”PÜt
,

227 cÚ¡ 
¡d
::
¡ršg
 
_Ïb–
)

228 : 
Pack‘Queue
(
_em
, 
_Ïb–
), 
	$ma¡”PÜt
(
_ma¡”PÜt
)

230 
	}
}

232 
boŞ


233 
	gMa¡”Pack‘Queue
::
	$£ndTimšg
(
Pack‘PŒ
 
pkt
, 
boŞ
 
£nd_as_¢oİ
)

236 ià(!
£nd_as_¢oİ
)

237  
ma¡”PÜt
.
	`£ndTimšgReq
(
pkt
);

239  
ma¡”PÜt
.
	`£ndTimšgSnoİRe¥
(
pkt
);

240 
	}
}

242 
	gSÏvePack‘Queue
::
SÏvePack‘Queue
(
Ev’tMªag”
& 
_em
, 
SÏvePÜt
& 
_¦avePÜt
,

243 cÚ¡ 
¡d
::
¡ršg
 
_Ïb–
)

244 : 
Pack‘Queue
(
_em
, 
_Ïb–
), 
	$¦avePÜt
(
_¦avePÜt
)

246 
	}
}

248 
boŞ


249 
	gSÏvePack‘Queue
::
	$£ndTimšg
(
Pack‘PŒ
 
pkt
, 
boŞ
 
£nd_as_¢oİ
)

252 
	`as£¹
(!
£nd_as_¢oİ
);

253  
¦avePÜt
.
	`£ndTimšgRe¥
(
pkt
);

254 
	}
}

	@packet_queue.hh

44 #iâdeà
__MEM_PACKET_QUEUE_HH__


45 
	#__MEM_PACKET_QUEUE_HH__


	)

56 
	~<li¡
>

58 
	~"mem/pÜt.hh
"

59 
	~"sim/d¿š.hh
"

60 
	~"sim/ev’tq_im¶.hh
"

66 şas 
	cPack‘Queue
 : 
public
 
D¿šabË


68 
´iv©e
:

70 şas 
	cDeã¼edPack‘
 {

71 
public
:

72 
Tick
 
tick
;

73 
Pack‘PŒ
 
	mpkt
;

74 
boŞ
 
	m£ndAsSnoİ
;

75 
Deã¼edPack‘
(
Tick
 
t
, 
Pack‘PŒ
 
p
, 
boŞ
 
£nd_as_¢oİ
)

76 : 
tick
(
t
), 
pkt
(
p
), 
£ndAsSnoİ
(
£nd_as_¢oİ
)

80 
	g¡d
::
	tli¡
<
	tDeã¼edPack‘
> 
	tDeã¼edPack‘Li¡
;

81 
	g¡d
::
	tli¡
<
	tDeã¼edPack‘
>::
	t™”©Ü
 
	tDeã¼edPack‘I‹¿tÜ
;

85 
Deã¼edPack‘Li¡
 
	gŒªsm™Li¡
;

88 
	gEv’tMªag”
& 
	gem
;

92 
´oûssS’dEv’t
();

97 
	gEv’tW¿µ”
<
	gPack‘Queue
, &Pack‘Queue::
´oûssS’dEv’t
> 
£ndEv’t
;

101 
D¿šMªag”
 *
	gd¿šMªag”
;

103 
	g´Ùeùed
:

106 cÚ¡ 
¡d
::
¡ršg
 
Ïb–
;

109 
boŞ
 
	gwa™šgOnR‘ry
;

112 
boŞ
 
	$deã¼edPack‘R—dy
()

113 {  !
Œªsm™Li¡
.
	`em±y
(è&&¿nsm™Li¡.
	`äÚt
().
tick
 <ğ
	`curTick
(); 
	}
}

115 
Tick
 
	$deã¼edPack‘R—dyTime
()

116 {  
Œªsm™Li¡
.
	`em±y
(è? 
MaxTick
 :¿nsm™Li¡.
	`äÚt
().
tick
; 
	}
}

125 
vœtu®
 
£ndDeã¼edPack‘
();

133 
ŒyS’dTimšg
();

138 
vœtu®
 
boŞ
 
£ndTimšg
(
Pack‘PŒ
 
pkt
, boŞ 
£nd_as_¢oİ
) = 0;

147 
scheduËS’d
(
Tick
 
time
 = 
MaxTick
);

156 
vœtu®
 
	$»cvRªgeChªge
(è{ 
	}
}

165 
Pack‘Queue
(
Ev’tMªag”
& 
_em
, cÚ¡ 
¡d
::
¡ršg
& 
_Ïb–
);

170 
	gvœtu®
 ~
Pack‘Queue
();

172 
	gpublic
:

179 
vœtu®
 cÚ¡ 
¡d
::
¡ršg
 
	$Çme
() const = 0;

183 
boŞ
 
	`checkFunùiÚ®
(
Pack‘PŒ
 
pkt
);

192 
	`schedS’dEv’t
(
Tick
 
wh’
);

202 
	`schedS’dTimšg
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
, 
boŞ
 
£nd_as_¢oİ
 = 
çl£
);

209 
	`»Œy
();

211 
	`d¿š
(
D¿šMªag”
 *
dm
);

212 
	}
};

214 şas 
	cMa¡”Pack‘Queue
 : 
public
 
Pack‘Queue


217 
´Ùeùed
:

219 
Ma¡”PÜt
& 
ma¡”PÜt
;

221 
	mpublic
:

232 
Ma¡”Pack‘Queue
(
Ev’tMªag”
& 
_em
, 
Ma¡”PÜt
& 
_ma¡”PÜt
,

233 cÚ¡ 
¡d
::
¡ršg
 
_Ïb–
 = "MasterPacketQueue");

235 
	mvœtu®
 ~
	$Ma¡”Pack‘Queue
() { }

237 cÚ¡ 
¡d
::
¡ršg
 
	$Çme
() const

238 {  
ma¡”PÜt
.
	`Çme
(è+ "-" + 
Ïb–
; 
	}
}

240 
boŞ
 
£ndTimšg
(
Pack‘PŒ
 
pkt
, boŞ 
£nd_as_¢oİ
);

243 şas 
	cSÏvePack‘Queue
 : 
public
 
Pack‘Queue


246 
´Ùeùed
:

248 
SÏvePÜt
& 
¦avePÜt
;

250 
	mpublic
:

261 
SÏvePack‘Queue
(
Ev’tMªag”
& 
_em
, 
SÏvePÜt
& 
_¦avePÜt
,

262 cÚ¡ 
¡d
::
¡ršg
 
_Ïb–
 = "SlavePacketQueue");

264 
	mvœtu®
 ~
	$SÏvePack‘Queue
() { }

266 cÚ¡ 
¡d
::
¡ršg
 
	$Çme
() const

267 {  
¦avePÜt
.
	`Çme
(è+ "-" + 
Ïb–
; 
	}
}

269 
boŞ
 
£ndTimšg
(
Pack‘PŒ
 
pkt
, boŞ 
£nd_as_¢oİ
);

	@page_table.cc

37 
	~<f¡»am
>

38 
	~<m­
>

39 
	~<¡ršg
>

41 
	~"ba£/b™f›ld.hh
"

42 
	~"ba£/štm©h.hh
"

43 
	~"ba£/Œaû.hh
"

44 
	~"cÚfig/the_i§.hh
"

45 
	~"debug/MMU.hh
"

46 
	~"mem/·ge_bË.hh
"

47 
	~"sim/çuÉs.hh
"

48 
	~"sim/sim_objeù.hh
"

50 
usšg
 
Çme¥aû
 
	g¡d
;

51 
usšg
 
Çme¥aû
 
	gTheISA
;

53 
	gPageTabË
::
PageTabË
(cÚ¡ 
¡d
::
¡ršg
 &
__Çme
, 
ušt64_t
 
_pid
, 
Addr
 
_·geSize
)

54 : 
·geSize
(
_·geSize
), 
off£tMask
(
mask
(
æoÜLog2
(_pageSize))),

55 
pid
(
_pid
), 
	$_Çme
(
__Çme
)

57 
	`as£¹
(
	`isPow”Of2
(
·geSize
));

58 
pTabËCache
[0].
v®id
 = 
çl£
;

59 
pTabËCache
[1].
v®id
 = 
çl£
;

60 
pTabËCache
[2].
v®id
 = 
çl£
;

61 
	}
}

63 
	gPageTabË
::~
	$PageTabË
()

65 
	}
}

68 
PageTabË
::
	$m­
(
Addr
 
vaddr
, Add¸
·ddr
, 
št64_t
 
size
, 
boŞ
 
şobb”
)

71 
	`as£¹
(
	`·geOff£t
(
vaddr
) == 0);

73 
	`DPRINTF
(
MMU
, "AÎoÿtšg Page: %#x-%#x\n", 
vaddr
, vaddr+ 
size
);

75 ; 
size
 > 0; siz-ğ
·geSize
, 
vaddr
 +ğ·geSize, 
·ddr
 +=…ageSize) {

76 ià(!
şobb”
 && (
pTabË
.
	`fšd
(
vaddr
è!ğpTabË.
	`’d
())) {

78 
	`çl
("PageTabË::®loÿ‹:‡dd»s 0x%x‡Ì—dy m­³d", 
vaddr
);

81 
pTabË
[
vaddr
] = 
TheISA
::
	`TlbEÁry
(
pid
, vaddr, 
·ddr
);

82 
	`”a£CacheEÁry
(
vaddr
);

83 
	`upd©eCache
(
vaddr
, 
pTabË
[vaddr]);

85 
	}
}

88 
	gPageTabË
::
	$»m­
(
Addr
 
vaddr
, 
št64_t
 
size
, Add¸
Ãw_vaddr
)

90 
	`as£¹
(
	`·geOff£t
(
vaddr
) == 0);

91 
	`as£¹
(
	`·geOff£t
(
Ãw_vaddr
) == 0);

93 
	`DPRINTF
(
MMU
, "movšg…age äom vadd¸%08°tØ%08p, sizğ%d\n", 
vaddr
,

94 
Ãw_vaddr
, 
size
);

96 ; 
size
 > 0; siz-ğ
·geSize
, 
vaddr
 +ğ·geSize, 
Ãw_vaddr
 +=…ageSize) {

97 
	`as£¹
(
pTabË
.
	`fšd
(
vaddr
è!ğpTabË.
	`’d
());

99 
pTabË
[
Ãw_vaddr
] =…TabË[
vaddr
];

100 
pTabË
.
	`”a£
(
vaddr
);

101 
	`”a£CacheEÁry
(
vaddr
);

102 
pTabË
[
Ãw_vaddr
].
	`upd©eVaddr
(new_vaddr);

103 
	`upd©eCache
(
Ãw_vaddr
, 
pTabË
[new_vaddr]);

105 
	}
}

108 
	gPageTabË
::
	$unm­
(
Addr
 
vaddr
, 
št64_t
 
size
)

110 
	`as£¹
(
	`·geOff£t
(
vaddr
) == 0);

112 
	`DPRINTF
(
MMU
, "Unm­pšg…age: %#x-%#x\n", 
vaddr
, vaddr+ 
size
);

114 ; 
size
 > 0; siz-ğ
·geSize
, 
vaddr
 +=…ageSize) {

115 
	`as£¹
(
pTabË
.
	`fšd
(
vaddr
è!ğpTabË.
	`’d
());

116 
pTabË
.
	`”a£
(
vaddr
);

117 
	`”a£CacheEÁry
(
vaddr
);

120 
	}
}

122 
boŞ


123 
	gPageTabË
::
	$isUnm­³d
(
Addr
 
vaddr
, 
št64_t
 
size
)

126 
	`as£¹
(
	`·geOff£t
(
vaddr
) == 0);

128 ; 
size
 > 0; siz-ğ
·geSize
, 
vaddr
 +=…ageSize) {

129 ià(
pTabË
.
	`fšd
(
vaddr
è!ğpTabË.
	`’d
()) {

130  
çl£
;

134  
Œue
;

135 
	}
}

137 
boŞ


138 
	gPageTabË
::
lookup
(
Addr
 
vaddr
, 
TheISA
::
TlbEÁry
 &
’Œy
)

140 
Addr
 
·ge_addr
 = 
·geAlign
(
vaddr
);

142 ià(
	gpTabËCache
[0].
	gv®id
 &&…TabËCache[0].
	gvaddr
 =ğ
·ge_addr
) {

143 
’Œy
 = 
pTabËCache
[0].entry;

144  
	gŒue
;

146 ià(
	gpTabËCache
[1].
	gv®id
 &&…TabËCache[1].
	gvaddr
 =ğ
·ge_addr
) {

147 
’Œy
 = 
pTabËCache
[1].entry;

148  
	gŒue
;

150 ià(
	gpTabËCache
[2].
	gv®id
 &&…TabËCache[2].
	gvaddr
 =ğ
·ge_addr
) {

151 
’Œy
 = 
pTabËCache
[2].entry;

152  
	gŒue
;

155 
PTabËIŒ
 
	g™”
 = 
pTabË
.
fšd
(
·ge_addr
);

157 ià(
	g™”
 =ğ
pTabË
.
’d
()) {

158  
çl£
;

161 
upd©eCache
(
·ge_addr
, 
™”
->
£cÚd
);

162 
	g’Œy
 = 
™”
->
£cÚd
;

163  
	gŒue
;

166 
boŞ


167 
	gPageTabË
::
	$Œª¦©e
(
Addr
 
vaddr
, Add¸&
·ddr
)

169 
TheISA
::
TlbEÁry
 
’Œy
;

170 ià(!
	`lookup
(
vaddr
, 
’Œy
)) {

171 
	`DPRINTF
(
MMU
, "Couldn'ˆT¿n¦©e: %#x\n", 
vaddr
);

172  
çl£
;

174 
·ddr
 = 
	`·geOff£t
(
vaddr
è+ 
’Œy
.
	`·geS¹
();

175 
	`DPRINTF
(
MMU
, "T¿n¦©šg: %#x->%#x\n", 
vaddr
, 
·ddr
);

176  
Œue
;

177 
	}
}

179 
FauÉ


180 
	gPageTabË
::
	$Œª¦©e
(
Reque¡PŒ
 
»q
)

182 
Addr
 
·ddr
;

183 
	`as£¹
(
	`·geAlign
(
»q
->
	`g‘Vaddr
(è+„eq->
	`g‘Size
() - 1)

184 =ğ
	`·geAlign
(
»q
->
	`g‘Vaddr
()));

185 ià(!
	`Œª¦©e
(
»q
->
	`g‘Vaddr
(), 
·ddr
)) {

186  
	`FauÉ
(
Ãw
 
	`G’”icPageTabËFauÉ
(
»q
->
	`g‘Vaddr
()));

188 
»q
->
	`£tPaddr
(
·ddr
);

189 ià((
·ddr
 & (
·geSize
 - 1)è+ 
»q
->
	`g‘Size
() >…ageSize) {

190 
	`·nic
("Request spans…age boundaries!\n");

191  
NoFauÉ
;

193  
NoFauÉ
;

194 
	}
}

197 
	gPageTabË
::
£rŸlize
(
¡d
::
o¡»am
 &
os
)

199 
·¿mOut
(
os
, "±abË.size", 
pTabË
.
size
());

201 
	gPTabË
::
size_ty³
 
couÁ
 = 0;

203 
PTabËIŒ
 
	g™”
 = 
pTabË
.
begš
();

204 
PTabËIŒ
 
	g’d
 = 
pTabË
.
’d
();

205 
	g™”
 !ğ
’d
) {

206 
os
 << "\n[" << 
c¥rštf
("%s.EÁry%d", 
Çme
(), 
couÁ
) << "]\n";

208 
·¿mOut
(
os
, "vaddr", 
™”
->
fœ¡
);

209 
	g™”
->
	g£cÚd
.
£rŸlize
(
os
);

211 ++
	g™”
;

212 ++
	gcouÁ
;

214 
as£¹
(
couÁ
 =ğ
pTabË
.
size
());

218 
	gPageTabË
::
un£rŸlize
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
)

220 
i
 = 0, 
	gcouÁ
;

221 
·¿mIn
(
ı
, 
£ùiÚ
, "±abË.size", 
couÁ
);

223 
	gpTabË
.
ş—r
();

225 
	gi
 < 
	gcouÁ
) {

226 
	gTheISA
::
TlbEÁry
 *
’Œy
;

227 
Addr
 
	gvaddr
;

229 
·¿mIn
(
ı
, 
c¥rštf
("%s.EÁry%d", 
Çme
(), 
i
), "vaddr", 
vaddr
);

230 
	g’Œy
 = 
Ãw
 
TheISA
::
TlbEÁry
();

231 
	g’Œy
->
un£rŸlize
(
ı
, 
c¥rštf
("%s.EÁry%d", 
Çme
(), 
i
));

232 
	gpTabË
[
vaddr
] = *
’Œy
;

233 
d–‘e
 
	g’Œy
;

234 ++
	gi
;

	@page_table.hh

36 #iâdeà
__MEM_PAGE_TABLE_HH__


37 
	#__MEM_PAGE_TABLE_HH__


	)

39 
	~<¡ršg
>

41 
	~"¬ch/i§_Œa™s.hh
"

42 
	~"¬ch/b.hh
"

43 
	~"ba£/hashm­.hh
"

44 
	~"ba£/ty³s.hh
"

45 
	~"cÚfig/the_i§.hh
"

46 
	~"mem/»que¡.hh
"

47 
	~"sim/£rŸlize.hh
"

52 şas 
	cPageTabË


54 
	m´Ùeùed
:

55 
m5
::
	thash_m­
<
	tAddr
, 
	tTheISA
::
	tTlbEÁry
> 
	tPTabË
;

56 
	mPTabË
::
	t™”©Ü
 
	tPTabËIŒ
;

57 
PTabË
 
	mpTabË
;

59 
	sÿcheEËm’t
 {

60 
boŞ
 
	mv®id
;

61 
Addr
 
	mvaddr
;

62 
	mTheISA
::
TlbEÁry
 
’Œy
;

65 
ÿcheEËm’t
 
	gpTabËCache
[3];

67 cÚ¡ 
Addr
 
	g·geSize
;

68 cÚ¡ 
Addr
 
	goff£tMask
;

70 cÚ¡ 
ušt64_t
 
	gpid
;

71 cÚ¡ 
	g¡d
::
¡ršg
 
_Çme
;

73 
	gpublic
:

75 
PageTabË
(cÚ¡ 
¡d
::
¡ršg
 &
__Çme
, 
ušt64_t
 
_pid
,

76 
Addr
 
_·geSize
 = 
TheISA
::
VMPageSize
);

78 ~
PageTabË
();

81 cÚ¡ 
	g¡d
::
¡ršg
 
	$Çme
(ècÚ¡ {  
_Çme
; 
	}
}

83 
Addr
 
	$·geAlign
(
Addr
 
a
è{  (¨& ~
off£tMask
); 
	}
}

84 
Addr
 
	$·geOff£t
(
Addr
 
a
è{  (¨& 
off£tMask
); 
	}
}

86 
m­
(
Addr
 
vaddr
, Add¸
·ddr
, 
št64_t
 
size
, 
boŞ
 
şobb”
 = 
çl£
);

87 
»m­
(
Addr
 
vaddr
, 
št64_t
 
size
, Add¸
Ãw_vaddr
);

88 
unm­
(
Addr
 
vaddr
, 
št64_t
 
size
);

96 
boŞ
 
isUnm­³d
(
Addr
 
vaddr
, 
št64_t
 
size
);

103 
boŞ
 
lookup
(
Addr
 
vaddr
, 
TheISA
::
TlbEÁry
 &
’Œy
);

111 
boŞ
 
Œª¦©e
(
Addr
 
vaddr
, Add¸&
·ddr
);

118 
boŞ
 
	$Œª¦©e
(
Addr
 
vaddr
è{ Add¸
dummy
;  
	`Œª¦©e
(vaddr, dummy); 
	}
}

125 
FauÉ
 
Œª¦©e
(
Reque¡PŒ
 
»q
);

132 
šlše
 
upd©eCache
(
Addr
 
vaddr
, 
TheISA
::
TlbEÁry
 
’Œy
)

134 
pTabËCache
[2].
’Œy
 =…TableCache[1].entry;

135 
	gpTabËCache
[2].
	gvaddr
 = 
pTabËCache
[1].
vaddr
;

136 
	gpTabËCache
[2].
	gv®id
 = 
pTabËCache
[1].
v®id
;

138 
	gpTabËCache
[1].
	g’Œy
 = 
pTabËCache
[0].
’Œy
;

139 
	gpTabËCache
[1].
	gvaddr
 = 
pTabËCache
[0].
vaddr
;

140 
	gpTabËCache
[1].
	gv®id
 = 
pTabËCache
[0].
v®id
;

142 
	gpTabËCache
[0].
	g’Œy
 = 
’Œy
;

143 
	gpTabËCache
[0].
	gvaddr
 = 
vaddr
;

144 
	gpTabËCache
[0].
	gv®id
 = 
Œue
;

151 
šlše
 
	$”a£CacheEÁry
(
Addr
 
vaddr
)

154 ià(
pTabËCache
[0].
v®id
 &&…TabËCache[0].
vaddr
 == vaddr) {

155 
pTabËCache
[0].
v®id
 = 
çl£
;

156 } ià(
pTabËCache
[1].
v®id
 &&…TabËCache[1].
vaddr
 == vaddr) {

157 
pTabËCache
[1].
v®id
 = 
çl£
;

158 } ià(
pTabËCache
[2].
v®id
 &&…TabËCache[2].
vaddr
 == vaddr) {

159 
pTabËCache
[2].
v®id
 = 
çl£
;

161 
	}
}

163 
£rŸlize
(
¡d
::
o¡»am
 &
os
);

165 
un£rŸlize
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
);

	@physical.cc

40 
	~<sys/mmª.h
>

41 
	~<sys/ty³s.h
>

42 
	~<sys/u£r.h
>

43 
	~<fú.h
>

44 
	~<uni¡d.h
>

45 
	~<zlib.h
>

47 
	~<û¼no
>

48 
	~<şim™s
>

49 
	~<c¡dio
>

50 
	~<io¡»am
>

51 
	~<¡ršg
>

53 
	~"ba£/Œaû.hh
"

54 
	~"debug/BusAddrRªges.hh
"

55 
	~"debug/Checkpošt.hh
"

56 
	~"mem/ab¡¿ù_mem.hh
"

57 
	~"mem/physiÿl.hh
"

59 
usšg
 
Çme¥aû
 
	g¡d
;

61 
	gPhysiÿlMemÜy
::
PhysiÿlMemÜy
(cÚ¡ 
¡ršg
& 
_Çme
,

62 cÚ¡ 
veùÜ
<
Ab¡¿ùMemÜy
*>& 
_memÜ›s
) :

63 
_Çme
(_Çme), 
	$size
(0)

67 
veùÜ
<
Ab¡¿ùMemÜy
*>::
cÚ¡_™”©Ü
 
m
 = 
_memÜ›s
.
	`begš
();

68 
m
 !ğ
_memÜ›s
.
	`’d
(); ++m) {

70 ià((*
m
)->
	`isInAddrM­
()) {

71 
memÜ›s
.
	`push_back
(*
m
);

74 
size
 +ğ(*
m
)->
	`size
();

78 ià(
addrM­
.
	`š£¹
((*
m
)->
	`g‘AddrRªge
(), *mè=ğaddrM­.
	`’d
())

79 
	`çl
("Memory‡ddress„ange for %s is overlapping\n",

80 (*
m
)->
	`Çme
());

82 
	`DPRINTF
(
BusAddrRªges
,

84 (*
m
)->
	`Çme
());

92 
veùÜ
<
Ab¡¿ùMemÜy
*> 
unm­³d_mems
;

93 
unm­³d_mems
.
	`push_back
(*
m
);

94 
	`ü—‹BackšgStÜe
((*
m
)->
	`g‘AddrRªge
(), 
unm­³d_mems
);

102 
veùÜ
<
AddrRªge
> 
šv_¿nges
;

103 
veùÜ
<
Ab¡¿ùMemÜy
*> 
cu¼_memÜ›s
;

104 
AddrRªgeM­
<
Ab¡¿ùMemÜy
*>::
cÚ¡_™”©Ü
 
r
 = 
addrM­
.
	`begš
();

105 
r
 !ğ
addrM­
.
	`’d
(); ++r) {

108 ià(!
r
->
£cÚd
->
	`isNuÎ
()) {

110 ià(
r
->
fœ¡
.
	`š‹¾—ved
()) {

114 ià(!
šv_¿nges
.
	`em±y
() &&

115 !
šv_¿nges
.
	`back
().
	`m”gesW™h
(
r
->
fœ¡
)) {

116 
AddrRªge
 
	`m”ged_¿nge
(
šv_¿nges
);

117 
	`ü—‹BackšgStÜe
(
m”ged_¿nge
, 
cu¼_memÜ›s
);

118 
šv_¿nges
.
	`ş—r
();

119 
cu¼_memÜ›s
.
	`ş—r
();

121 
šv_¿nges
.
	`push_back
(
r
->
fœ¡
);

122 
cu¼_memÜ›s
.
	`push_back
(
r
->
£cÚd
);

124 
veùÜ
<
Ab¡¿ùMemÜy
*> 
sšgË_memÜy
;

125 
sšgË_memÜy
.
	`push_back
(
r
->
£cÚd
);

126 
	`ü—‹BackšgStÜe
(
r
->
fœ¡
, 
sšgË_memÜy
);

133 ià(!
šv_¿nges
.
	`em±y
()) {

134 
AddrRªge
 
	`m”ged_¿nge
(
šv_¿nges
);

135 
	`ü—‹BackšgStÜe
(
m”ged_¿nge
, 
cu¼_memÜ›s
);

137 
	}
}

140 
	gPhysiÿlMemÜy
::
ü—‹BackšgStÜe
(
AddrRªge
 
¿nge
,

141 cÚ¡ 
veùÜ
<
Ab¡¿ùMemÜy
*>& 
_memÜ›s
)

143 ià(
	g¿nge
.
š‹¾—ved
())

144 
·nic
("Cannot create backing store for interleaved„ange %s\n",

145 
¿nge
.
to_¡ršg
());

148 
DPRINTF
(
BusAddrRªges
, "Creating backing store for„ange %s with size %d\n",

149 
¿nge
.
to_¡ršg
(),„ªge.
size
());

150 
	gm­_æags
 = 
MAP_ANON
 | 
MAP_PRIVATE
;

151 
ušt8_t
* 
	gpmem
 = (ušt8_t*è
mm­
(
NULL
, 
¿nge
.
size
(),

152 
PROT_READ
 | 
PROT_WRITE
,

153 
m­_æags
, -1, 0);

155 ià(
	gpmem
 =ğ(
ušt8_t
*è
MAP_FAILED
) {

156 
³¼Ü
("mmap");

157 
çl
("Could‚Ù mm­ %d by‹ fÜ„ªg%s!\n", 
¿nge
.
size
(),

158 
¿nge
.
to_¡ršg
());

163 
	gbackšgStÜe
.
push_back
(
make_·œ
(
¿nge
, 
pmem
));

167 
	gveùÜ
<
	gAb¡¿ùMemÜy
*>::
cÚ¡_™”©Ü
 
m
 = 
_memÜ›s
.
begš
();

168 
	gm
 !ğ
_memÜ›s
.
’d
(); ++m) {

169 
DPRINTF
(
BusAddrRªges
, "Mapping memory %so backing store\n",

170 (*
m
)->
Çme
());

171 (*
	gm
)->
£tBackšgStÜe
(
pmem
);

175 
	gPhysiÿlMemÜy
::~
	$PhysiÿlMemÜy
()

178 
veùÜ
<
·œ
<
AddrRªge
, 
ušt8_t
*> >::
™”©Ü
 
s
 = 
backšgStÜe
.
	`begš
();

179 
s
 !ğ
backšgStÜe
.
	`’d
(); ++s)

180 
	`munm­
((*)
s
->
£cÚd
, s->
fœ¡
.
	`size
());

181 
	}
}

183 
boŞ


184 
	gPhysiÿlMemÜy
::
	$isMemAddr
(
Addr
 
addr
) const

187 ià(!
¿ngeCache
.
	`cÚšs
(
addr
)) {

189 
AddrRªgeM­
<
Ab¡¿ùMemÜy
*>::
cÚ¡_™”©Ü
 
r
 = 
addrM­
.
	`fšd
(
addr
);

190 ià(
r
 =ğ
addrM­
.
	`’d
()) {

192  
çl£
;

195 
¿ngeCache
 = 
r
->
fœ¡
;

198 
	`as£¹
(
addrM­
.
	`fšd
(
addr
è!ğaddrM­.
	`’d
());

201  
Œue
;

202 
	}
}

204 
AddrRªgeLi¡


205 
	gPhysiÿlMemÜy
::
	$g‘CÚfAddrRªges
() const

209 
AddrRªgeLi¡
 
¿nges
;

210 
veùÜ
<
AddrRªge
> 
šv_¿nges
;

211 
AddrRªgeM­
<
Ab¡¿ùMemÜy
*>::
cÚ¡_™”©Ü
 
r
 = 
addrM­
.
	`begš
();

212 
r
 !ğ
addrM­
.
	`’d
(); ++r) {

213 ià(
r
->
£cÚd
->
	`isCÚfR•Ü‹d
()) {

215 ià(
r
->
fœ¡
.
	`š‹¾—ved
()) {

219 ià(!
šv_¿nges
.
	`em±y
() &&

220 !
šv_¿nges
.
	`back
().
	`m”gesW™h
(
r
->
fœ¡
)) {

221 
¿nges
.
	`push_back
(
	`AddrRªge
(
šv_¿nges
));

222 
šv_¿nges
.
	`ş—r
();

224 
šv_¿nges
.
	`push_back
(
r
->
fœ¡
);

227 
¿nges
.
	`push_back
(
r
->
fœ¡
);

234 ià(!
šv_¿nges
.
	`em±y
()) {

235 
¿nges
.
	`push_back
(
	`AddrRªge
(
šv_¿nges
));

238  
¿nges
;

239 
	}
}

242 
	gPhysiÿlMemÜy
::
	$acûss
(
Pack‘PŒ
 
pkt
)

244 
	`as£¹
(
pkt
->
	`isReque¡
());

245 
Addr
 
addr
 = 
pkt
->
	`g‘Addr
();

246 
AddrRªgeM­
<
Ab¡¿ùMemÜy
*>::
cÚ¡_™”©Ü
 
m
 = 
addrM­
.
	`fšd
(
addr
);

247 
	`as£¹
(
m
 !ğ
addrM­
.
	`’d
());

248 
m
->
£cÚd
->
	`acûss
(
pkt
);

249 
	}
}

252 
	gPhysiÿlMemÜy
::
	$funùiÚ®Acûss
(
Pack‘PŒ
 
pkt
)

254 
	`as£¹
(
pkt
->
	`isReque¡
());

255 
Addr
 
addr
 = 
pkt
->
	`g‘Addr
();

256 
AddrRªgeM­
<
Ab¡¿ùMemÜy
*>::
cÚ¡_™”©Ü
 
m
 = 
addrM­
.
	`fšd
(
addr
);

257 
	`as£¹
(
m
 !ğ
addrM­
.
	`’d
());

258 
m
->
£cÚd
->
	`funùiÚ®Acûss
(
pkt
);

259 
	}
}

262 
	gPhysiÿlMemÜy
::
	$£rŸlize
(
o¡»am
& 
os
)

265 
veùÜ
<
Addr
> 
Ïl_addr
;

266 
veùÜ
<> 
Ïl_cid
;

268 
veùÜ
<
Ab¡¿ùMemÜy
*>::
™”©Ü
 
m
 = 
memÜ›s
.
	`begš
();

269 
m
 !ğ
memÜ›s
.
	`’d
(); ++m) {

270 cÚ¡ 
li¡
<
LockedAddr
>& 
locked_addrs
 = (*
m
)->
	`g‘LockedAddrLi¡
();

271 
li¡
<
LockedAddr
>::
cÚ¡_™”©Ü
 
l
 = 
locked_addrs
.
	`begš
();

272 
l
 !ğ
locked_addrs
.
	`’d
(); ++l) {

273 
Ïl_addr
.
	`push_back
(
l
->
addr
);

274 
Ïl_cid
.
	`push_back
(
l
->
cÚ‹xtId
);

278 
	`¬¿yP¬amOut
(
os
, "Ïl_addr", 
Ïl_addr
);

279 
	`¬¿yP¬amOut
(
os
, "Ïl_cid", 
Ïl_cid
);

282 
nbr_of_¡Ües
 = 
backšgStÜe
.
	`size
();

283 
	`SERIALIZE_SCALAR
(
nbr_of_¡Ües
);

285 
¡Üe_id
 = 0;

287 
veùÜ
<
·œ
<
AddrRªge
, 
ušt8_t
*> >::
™”©Ü
 
s
 = 
backšgStÜe
.
	`begš
();

288 
s
 !ğ
backšgStÜe
.
	`’d
(); ++s) {

289 
	`ÇmeOut
(
os
, 
	`c¥rštf
("%s.¡Üe%d", 
	`Çme
(), 
¡Üe_id
));

290 
	`£rŸlizeStÜe
(
os
, 
¡Üe_id
++, 
s
->
fœ¡
, s->
£cÚd
);

292 
	}
}

295 
	gPhysiÿlMemÜy
::
	$£rŸlizeStÜe
(
o¡»am
& 
os
, 
¡Üe_id
,

296 
AddrRªge
 
¿nge
, 
ušt8_t
* 
pmem
)

300 
¡ršg
 
f’ame
 = 
	`Çme
(è+ ".¡Üe" + 
	`to_¡ršg
(
¡Üe_id
) + ".pmem";

301 
¿nge_size
 = 
¿nge
.
	`size
();

303 
	`DPRINTF
(
Checkpošt
, "Serializing…hysical memory %s with size %d\n",

304 
f’ame
, 
¿nge_size
);

306 
	`SERIALIZE_SCALAR
(
¡Üe_id
);

307 
	`SERIALIZE_SCALAR
(
f’ame
);

308 
	`SERIALIZE_SCALAR
(
¿nge_size
);

311 
¡ršg
 
f•©h
 = 
Checkpošt
::
	`dœ
(è+ "/" + 
f’ame
.
	`c_¡r
();

312 
fd
 = 
	`ü—t
(
f•©h
.
	`c_¡r
(), 0664);

313 ià(
fd
 < 0) {

314 
	`³¼Ü
("creat");

315 
	`çl
("Can't open…hysical memory checkpoint file '%s'\n",

316 
f’ame
);

319 
gzFe
 
com´es£d_mem
 = 
	`gzdİ’
(
fd
, "wb");

320 ià(
com´es£d_mem
 =ğ
NULL
)

321 
	`çl
("Insufficient memoryo‡llocate compression state for %s\n",

322 
f’ame
);

324 
ušt64_t
 
·ss_size
 = 0;

327 
ušt64_t
 
wr™‹n
 = 0; wr™‹À< 
¿nge
.
	`size
();

328 
wr™‹n
 +ğ
·ss_size
) {

329 
·ss_size
 = (
ušt64_t
)
INT_MAX
 < (
¿nge
.
	`size
(è- 
wr™‹n
) ?

330 (
ušt64_t
)
INT_MAX
 : (
¿nge
.
	`size
(è- 
wr™‹n
);

332 ià(
	`gzwr™e
(
com´es£d_mem
, 
pmem
 + 
wr™‹n
,

333 (è
·ss_size
) != ()…ass_size) {

334 
	`çl
("Write failed on…hysical memory checkpoint file '%s'\n",

335 
f’ame
);

341 ià(
	`gzşo£
(
com´es£d_mem
))

342 
	`çl
("Close failed on…hysical memory checkpoint file '%s'\n",

343 
f’ame
);

345 
	}
}

348 
	gPhysiÿlMemÜy
::
	$un£rŸlize
(
Checkpošt
* 
ı
, cÚ¡ 
¡ršg
& 
£ùiÚ
)

352 
veùÜ
<
Addr
> 
Ïl_addr
;

353 
veùÜ
<> 
Ïl_cid
;

354 
	`¬¿yP¬amIn
(
ı
, 
£ùiÚ
, "Ïl_addr", 
Ïl_addr
);

355 
	`¬¿yP¬amIn
(
ı
, 
£ùiÚ
, "Ïl_cid", 
Ïl_cid
);

356 
size_t
 
i
 = 0; i < 
Ïl_addr
.
	`size
(); ++i) {

357 
AddrRªgeM­
<
Ab¡¿ùMemÜy
*>::
cÚ¡_™”©Ü
 
m
 =

358 
addrM­
.
	`fšd
(
Ïl_addr
[
i
]);

359 
m
->
£cÚd
->
	`addLockedAddr
(
	`LockedAddr
(
Ïl_addr
[
i
], 
Ïl_cid
[i]));

363 
nbr_of_¡Ües
;

364 
	`UNSERIALIZE_SCALAR
(
nbr_of_¡Ües
);

366 
i
 = 0; i < 
nbr_of_¡Ües
; ++i) {

367 
	`un£rŸlizeStÜe
(
ı
, 
	`c¥rštf
("%s.¡Üe%d", 
£ùiÚ
, 
i
));

370 
	}
}

373 
	gPhysiÿlMemÜy
::
	$un£rŸlizeStÜe
(
Checkpošt
* 
ı
, cÚ¡ 
¡ršg
& 
£ùiÚ
)

375 cÚ¡ 
ušt32_t
 
chunk_size
 = 16384;

377 
¡Üe_id
;

378 
	`UNSERIALIZE_SCALAR
(
¡Üe_id
);

380 
¡ršg
 
f’ame
;

381 
	`UNSERIALIZE_SCALAR
(
f’ame
);

382 
¡ršg
 
f•©h
 = 
ı
->
ıtDœ
 + "/" + 
f’ame
;

385 
fd
 = 
	`İ’
(
f•©h
.
	`c_¡r
(), 
O_RDONLY
);

386 ià(
fd
 < 0) {

387 
	`³¼Ü
("open");

388 
	`çl
("Cª'ˆİ’…hysiÿÈmemÜy checkpošˆf'%s'", 
f’ame
);

391 
gzFe
 
com´es£d_mem
 = 
	`gzdİ’
(
fd
, "rb");

392 ià(
com´es£d_mem
 =ğ
NULL
)

393 
	`çl
("Insufficient memoryo‡llocate compression state for %s\n",

394 
f’ame
);

396 
ušt8_t
* 
pmem
 = 
backšgStÜe
[
¡Üe_id
].
£cÚd
;

397 
AddrRªge
 
¿nge
 = 
backšgStÜe
[
¡Üe_id
].
fœ¡
;

402 
	`munm­
((*è
pmem
, 
¿nge
.
	`size
());

404 
¿nge_size
;

405 
	`UNSERIALIZE_SCALAR
(
¿nge_size
);

407 
	`DPRINTF
(
Checkpošt
, "Unserializing…hysical memory %s with size %d\n",

408 
f’ame
, 
¿nge_size
);

410 ià(
¿nge_size
 !ğ
¿nge
.
	`size
())

411 
	`çl
("Memory„ange size has changed! Saw %lld,ƒxpected %lld\n",

412 
¿nge_size
, 
¿nge
.
	`size
());

414 
pmem
 = (
ušt8_t
*è
	`mm­
(
NULL
, 
¿nge
.
	`size
(), 
PROT_READ
 | 
PROT_WRITE
,

415 
MAP_ANON
 | 
MAP_PRIVATE
, -1, 0);

417 ià(
pmem
 =ğ(*è
MAP_FAILED
) {

418 
	`³¼Ü
("mmap");

419 
	`çl
("Could‚ot mmap…hysical memory!\n");

422 
ušt64_t
 
cu¼_size
 = 0;

423 * 
‹mp_·ge
 = 
Ãw
 [
chunk_size
];

424 * 
pmem_cu¼’t
;

425 
ušt32_t
 
by‹s_»ad
;

426 
cu¼_size
 < 
¿nge
.
	`size
()) {

427 
by‹s_»ad
 = 
	`gz»ad
(
com´es£d_mem
, 
‹mp_·ge
, 
chunk_size
);

428 ià(
by‹s_»ad
 == 0)

431 
	`as£¹
(
by‹s_»ad
 % () == 0);

433 
ušt32_t
 
x
 = 0; x < 
by‹s_»ad
 / (); x++) {

436 ià(*(
‹mp_·ge
 + 
x
) != 0) {

437 
pmem_cu¼’t
 = (*)(
pmem
 + 
cu¼_size
 + 
x
 * ());

438 *
pmem_cu¼’t
 = *(
‹mp_·ge
 + 
x
);

441 
cu¼_size
 +ğ
by‹s_»ad
;

444 
d–‘e
[] 
‹mp_·ge
;

446 ià(
	`gzşo£
(
com´es£d_mem
))

447 
	`çl
("Close failed on…hysical memory checkpoint file '%s'\n",

448 
f’ame
);

449 
	}
}

	@physical.hh

40 #iâdeà
__PHYSICAL_MEMORY_HH__


41 
	#__PHYSICAL_MEMORY_HH__


	)

43 
	~"ba£/addr_¿nge_m­.hh
"

44 
	~"mem/pÜt.hh
"

49 
şass
 
	gAb¡¿ùMemÜy
;

67 şas 
	cPhysiÿlMemÜy
 : 
public
 
S”ŸlizabË


70 
´iv©e
:

73 
¡d
::
¡ršg
 
_Çme
;

76 
	mAddrRªgeM­
<
	mAb¡¿ùMemÜy
*> 
	maddrM­
;

79 
mubË
 
AddrRªge
 
	m¿ngeCache
;

82 
	m¡d
::
veùÜ
<
Ab¡¿ùMemÜy
*> 
memÜ›s
;

85 
ušt64_t
 
	msize
;

89 
	m¡d
::
veùÜ
<
¡d
::
·œ
<
AddrRªge
, 
	mušt8_t
*> > 
	mbackšgStÜe
;

92 
PhysiÿlMemÜy
(const PhysicalMemory&);

95 
	mPhysiÿlMemÜy
& 
	mİ”©Ü
=(cÚ¡ 
PhysiÿlMemÜy
&);

105 
ü—‹BackšgStÜe
(
AddrRªge
 
¿nge
,

106 cÚ¡ 
¡d
::
veùÜ
<
Ab¡¿ùMemÜy
*>& 
_memÜ›s
);

108 
	mpublic
:

113 
PhysiÿlMemÜy
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
,

114 cÚ¡ 
¡d
::
veùÜ
<
Ab¡¿ùMemÜy
*>& 
_memÜ›s
);

119 ~
PhysiÿlMemÜy
();

125 cÚ¡ 
	m¡d
::
¡ršg
 
	$Çme
(ècÚ¡ {  
_Çme
; }

134 
boŞ
 
	$isMemAddr
(
Addr
 
addr
) const;

144 
AddrRªgeLi¡
 
	$g‘CÚfAddrRªges
() const;

151 
ušt64_t
 
	$tÙ®Size
(ècÚ¡ {  
size
; 
	}
}

165 
	g¡d
::
veùÜ
<
¡d
::
·œ
<
AddrRªge
, 
	gušt8_t
*> > 
	$g‘BackšgStÜe
() const

166 {  
backšgStÜe
; 
	}
}

175 
acûss
(
Pack‘PŒ
 
pkt
);

185 
funùiÚ®Acûss
(
Pack‘PŒ
 
pkt
);

195 
£rŸlize
(
¡d
::
o¡»am
& 
os
);

204 
£rŸlizeStÜe
(
¡d
::
o¡»am
& 
os
, 
¡Üe_id
,

205 
AddrRªge
 
¿nge
, 
ušt8_t
* 
pmem
);

212 
un£rŸlize
(
Checkpošt
* 
ı
, cÚ¡ 
¡d
::
¡ršg
& 
£ùiÚ
);

217 
un£rŸlizeStÜe
(
Checkpošt
* 
ı
, cÚ¡ 
¡d
::
¡ršg
& 
£ùiÚ
);

	@port.cc

49 
	~"ba£/Œaû.hh
"

50 
	~"mem/mem_objeù.hh
"

51 
	~"mem/pÜt.hh
"

53 
	gPÜt
::
PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
MemObjeù
& 
_owÃr
, 
PÜtID
 
_id
)

54 : 
pÜtName
(
_Çme
), 
id
(
_id
), 
	$owÃr
(
_owÃr
)

56 
	}
}

58 
	gPÜt
::~
	$PÜt
()

60 
	}
}

62 
Ba£Ma¡”PÜt
::Ba£Ma¡”PÜt(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
,

63 
PÜtID
 
_id
)

64 : 
PÜt
(
Çme
, *
owÃr
, 
_id
), 
	$_ba£SÏvePÜt
(
NULL
)

66 
	}
}

68 
	gBa£Ma¡”PÜt
::~
	$Ba£Ma¡”PÜt
()

70 
	}
}

72 
Ba£SÏvePÜt
&

73 
Ba£Ma¡”PÜt
::
	$g‘SÏvePÜt
() const

75 if(
_ba£SÏvePÜt
 =ğ
NULL
)

76 
	`·nic
("Cannot getSlavePort on master…ort %shat is‚ot connected\n",

77 
	`Çme
());

79  *
_ba£SÏvePÜt
;

80 
	}
}

82 
boŞ


83 
	gBa£Ma¡”PÜt
::
	$isCÚÃùed
() const

85  
_ba£SÏvePÜt
 !ğ
NULL
;

86 
	}
}

88 
	gBa£SÏvePÜt
::
Ba£SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
,

89 
PÜtID
 
_id
)

90 : 
PÜt
(
Çme
, *
owÃr
, 
_id
), 
	$_ba£Ma¡”PÜt
(
NULL
)

92 
	}
}

94 
	gBa£SÏvePÜt
::~
	$Ba£SÏvePÜt
()

96 
	}
}

98 
Ba£Ma¡”PÜt
&

99 
Ba£SÏvePÜt
::
	$g‘Ma¡”PÜt
() const

101 if(
_ba£Ma¡”PÜt
 =ğ
NULL
)

102 
	`·nic
("Cannot getMasterPort on slave…ort %shat is‚ot connected\n",

103 
	`Çme
());

105  *
_ba£Ma¡”PÜt
;

106 
	}
}

108 
boŞ


109 
	gBa£SÏvePÜt
::
	$isCÚÃùed
() const

111  
_ba£Ma¡”PÜt
 !ğ
NULL
;

112 
	}
}

117 
	gMa¡”PÜt
::
Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
, 
PÜtID
 
_id
)

118 : 
Ba£Ma¡”PÜt
(
Çme
, 
owÃr
, 
_id
), 
	$_¦avePÜt
(
NULL
)

120 
	}
}

122 
	gMa¡”PÜt
::~
	$Ma¡”PÜt
()

124 
	}
}

127 
Ma¡”PÜt
::
	$bšd
(
Ba£SÏvePÜt
& 
¦ave_pÜt
)

130 
	`´štf
("\nMASTER % bšd tØSLAVE %s\n",
this
->
	`Çme
().
	`c_¡r
(),
¦ave_pÜt
.name().c_str());

132 
_ba£SÏvePÜt
 = &
¦ave_pÜt
;

135 
SÏvePÜt
* 
ÿ¡_¦ave_pÜt
 = 
dyÇmic_ÿ¡
<SÏvePÜt*>(&
¦ave_pÜt
);

138 ià(
ÿ¡_¦ave_pÜt
 !ğ
NULL
) {

140 
_¦avePÜt
 = 
ÿ¡_¦ave_pÜt
;

142 
_¦avePÜt
->
	`bšd
(*
this
);

144 
	`çl
("Ma¡”…Üˆ% ÿÂÙ bšdØ%s\n", 
	`Çme
(),

145 
¦ave_pÜt
.
	`Çme
());

147 
	}
}

150 
	gMa¡”PÜt
::
	$unbšd
()

152 ià(
_¦avePÜt
 =ğ
NULL
)

153 
	`·nic
("Attemptingo unbind master…ort %shat is‚ot connected\n",

154 
	`Çme
());

155 
_¦avePÜt
->
	`unbšd
();

156 
_¦avePÜt
 = 
NULL
;

157 
_ba£SÏvePÜt
 = 
NULL
;

158 
	}
}

160 
AddrRªgeLi¡


161 
	gMa¡”PÜt
::
	$g‘AddrRªges
() const

163  
_¦avePÜt
->
	`g‘AddrRªges
();

164 
	}
}

166 
Tick


167 
	gMa¡”PÜt
::
	$£ndAtomic
(
Pack‘PŒ
 
pkt
)

169 
	`as£¹
(
pkt
->
	`isReque¡
());

170  
_¦avePÜt
->
	`»cvAtomic
(
pkt
);

171 
	}
}

174 
	gMa¡”PÜt
::
	$£ndFunùiÚ®
(
Pack‘PŒ
 
pkt
)

176 
	`as£¹
(
pkt
->
	`isReque¡
());

177  
_¦avePÜt
->
	`»cvFunùiÚ®
(
pkt
);

178 
	}
}

180 
boŞ


181 
	gMa¡”PÜt
::
	$£ndTimšgReq
(
Pack‘PŒ
 
pkt
)

183 
	`as£¹
(
pkt
->
	`isReque¡
());

184  
_¦avePÜt
->
	`»cvTimšgReq
(
pkt
);

185 
	}
}

187 
boŞ


188 
	gMa¡”PÜt
::
	$£ndTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

190 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

191  
_¦avePÜt
->
	`»cvTimšgSnoİRe¥
(
pkt
);

192 
	}
}

195 
	gMa¡”PÜt
::
	$£ndR‘ry
()

197 
_¦avePÜt
->
	`»cvR‘ry
();

198 
	}
}

201 
	gMa¡”PÜt
::
	$´štAddr
(
Addr
 
a
)

203 
Reque¡
 
	`»q
(
a
, 1, 0, Reque¡::
funcMa¡”Id
);

204 
Pack‘
 
	`pkt
(&
»q
, 
MemCmd
::
PrštReq
);

205 
Pack‘
::
PrštReqS‹
 
	`´s
(
¡d
::
û¼
);

206 
pkt
.
£nd”S‹
 = &
´s
;

208 
	`£ndFunùiÚ®
(&
pkt
);

209 
	}
}

214 
	gSÏvePÜt
::
SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
, 
PÜtID
 
id
)

215 : 
Ba£SÏvePÜt
(
Çme
, 
owÃr
, 
id
), 
	$_ma¡”PÜt
(
NULL
)

217 
	}
}

219 
	gSÏvePÜt
::~
	$SÏvePÜt
()

221 
	}
}

224 
SÏvePÜt
::
	$unbšd
()

226 
_ba£Ma¡”PÜt
 = 
NULL
;

227 
_ma¡”PÜt
 = 
NULL
;

228 
	}
}

231 
	gSÏvePÜt
::
	$bšd
(
Ma¡”PÜt
& 
ma¡”_pÜt
)

233 
_ba£Ma¡”PÜt
 = &
ma¡”_pÜt
;

234 
_ma¡”PÜt
 = &
ma¡”_pÜt
;

235 
	}
}

237 
Tick


238 
	gSÏvePÜt
::
	$£ndAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

240 
	`as£¹
(
pkt
->
	`isReque¡
());

241  
_ma¡”PÜt
->
	`»cvAtomicSnoİ
(
pkt
);

242 
	}
}

245 
	gSÏvePÜt
::
	$£ndFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
)

247 
	`as£¹
(
pkt
->
	`isReque¡
());

248  
_ma¡”PÜt
->
	`»cvFunùiÚ®Snoİ
(
pkt
);

249 
	}
}

251 
boŞ


252 
	gSÏvePÜt
::
	$£ndTimšgRe¥
(
Pack‘PŒ
 
pkt
)

254 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

255  
_ma¡”PÜt
->
	`»cvTimšgRe¥
(
pkt
);

256 
	}
}

259 
	gSÏvePÜt
::
	$£ndTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

261 
	`as£¹
(
pkt
->
	`isReque¡
());

262 
_ma¡”PÜt
->
	`»cvTimšgSnoİReq
(
pkt
);

263 
	}
}

266 
	gSÏvePÜt
::
	$£ndR‘ry
()

268 
_ma¡”PÜt
->
	`»cvR‘ry
();

269 
	}
}

	@port.hh

50 #iâdeà
__MEM_PORT_HH__


51 
	#__MEM_PORT_HH__


	)

53 
	~<li¡
>

55 
	~"ba£/addr_¿nge.hh
"

56 
	~"mem/·ck‘.hh
"

65 
	g¡d
::
	tli¡
<
	tAddrRªge
> 
	tAddrRªgeLi¡
;

66 
	g¡d
::
	tli¡
<
	tAddrRªge
>::
	t™”©Ü
 
	tAddrRªgeI‹r
;

67 
	g¡d
::
	tli¡
<
	tAddrRªge
>::
	tcÚ¡_™”©Ü
 
	tAddrRªgeCÚ¡I‹r
;

69 
şass
 
	gMemObjeù
;

76 şas 
	cPÜt


79 
	m´iv©e
:

82 
¡d
::
¡ršg
 
pÜtName
;

84 
	m´Ùeùed
:

90 cÚ¡ 
PÜtID
 
id
;

93 
	mMemObjeù
& 
	mowÃr
;

102 
PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
MemObjeù
& 
_owÃr
, 
PÜtID
 
_id
);

107 
	mvœtu®
 ~
PÜt
();

109 
	mpublic
:

112 cÚ¡ 
¡d
::
¡ršg
 
	$Çme
(ècÚ¡ {  
pÜtName
; }

115 
PÜtID
 
	$g‘Id
(ècÚ¡ {  
id
; 
	}
}

120 
şass
 
	gBa£SÏvePÜt
;

128 şas 
	cBa£Ma¡”PÜt
 : 
public
 
PÜt


131 
´Ùeùed
:

133 
Ba£SÏvePÜt
* 
_ba£SÏvePÜt
;

135 
Ba£Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
,

136 
PÜtID
 
id
 = 
Inv®idPÜtID
);

137 
	mvœtu®
 ~
Ba£Ma¡”PÜt
();

139 
	mpublic
:

141 
vœtu®
 
bšd
(
Ba£SÏvePÜt
& 
¦ave_pÜt
) = 0;

142 
vœtu®
 
unbšd
() = 0;

143 
	mBa£SÏvePÜt
& 
	$g‘SÏvePÜt
() const;

144 
boŞ
 
	$isCÚÃùed
() const;

152 şas 
	cBa£SÏvePÜt
 : 
public
 
PÜt


155 
´Ùeùed
:

157 
Ba£Ma¡”PÜt
* 
_ba£Ma¡”PÜt
;

159 
	`Ba£SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
,

160 
PÜtID
 
id
 = 
Inv®idPÜtID
);

161 
vœtu®
 ~
	`Ba£SÏvePÜt
();

163 
public
:

165 
Ba£Ma¡”PÜt
& 
	$g‘Ma¡”PÜt
() const;

166 
boŞ
 
	$isCÚÃùed
() const;

171 
şass
 
SÏvePÜt
;

180 şas 
	cMa¡”PÜt
 : 
public
 
Ba£Ma¡”PÜt


183 
ä›nd
 
şass
 
SÏvePÜt
;

185 
´iv©e
:

187 
SÏvePÜt
* 
_¦avePÜt
;

189 
public
:

191 
	`Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
,

192 
PÜtID
 
id
 = 
Inv®idPÜtID
);

193 
vœtu®
 ~
	`Ma¡”PÜt
();

199 
	`bšd
(
Ba£SÏvePÜt
& 
¦ave_pÜt
);

204 
	`unbšd
();

215 
Tick
 
	`£ndAtomic
(
Pack‘PŒ
 
pkt
);

224 
	`£ndFunùiÚ®
(
Pack‘PŒ
 
pkt
);

237 
boŞ
 
	`£ndTimšgReq
(
Pack‘PŒ
 
pkt
);

248 
boŞ
 
	`£ndTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
);

254 
vœtu®
 
	`£ndR‘ry
();

265 
vœtu®
 
boŞ
 
	$isSnoİšg
(ècÚ¡ {  
çl£
; }

270 
AddrRªgeLi¡
 
	$g‘AddrRªges
() const;

275 
	`´štAddr
(
Addr
 
a
);

277 
´Ùeùed
:

282 
vœtu®
 
Tick
 
	$»cvAtomicSnoİ
(
Pack‘PŒ
 
pkt
)

284 
	`·nic
("% wa nÙƒx³ùšg‡À©omiø¢oİ„eque¡\n", 
	`Çme
());

286 
	}
}

291 
vœtu®
 
	$»cvFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
)

293 
	`·nic
("% wa nÙƒx³ùšg‡ funùiÚ® snoİ„eque¡\n", 
	`Çme
());

294 
	}
}

299 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
) = 0;

304 
vœtu®
 
	$»cvTimšgSnoİReq
(
Pack‘PŒ
 
pkt
)

306 
	`·nic
("% wa nÙƒx³ùšg‡imšg snoİ„eque¡\n", 
	`Çme
());

307 
	}
}

315 
vœtu®
 
»cvR‘ry
() = 0;

324 
vœtu®
 
	$»cvRªgeChªge
(è{ 
	}
}

333 şas 
	cSÏvePÜt
 : 
public
 
Ba£SÏvePÜt


336 
ä›nd
 
şass
 
Ma¡”PÜt
;

338 
	m´iv©e
:

340 
Ma¡”PÜt
* 
_ma¡”PÜt
;

342 
	mpublic
:

344 
SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
,

345 
PÜtID
 
id
 = 
Inv®idPÜtID
);

346 
	mvœtu®
 ~
SÏvePÜt
();

357 
Tick
 
£ndAtomicSnoİ
(
Pack‘PŒ
 
pkt
);

366 
£ndFunùiÚ®Snoİ
(
Pack‘PŒ
 
pkt
);

379 
boŞ
 
£ndTimšgRe¥
(
Pack‘PŒ
 
pkt
);

388 
£ndTimšgSnoİReq
(
Pack‘PŒ
 
pkt
);

395 
£ndR‘ry
();

402 
boŞ
 
	$isSnoİšg
(ècÚ¡ {  
_ma¡”PÜt
->
	`isSnoİšg
(); }

407 
	$£ndRªgeChªge
(ècÚ¡ { 
_ma¡”PÜt
->
	`»cvRªgeChªge
(); 
	}
}

416 
vœtu®
 
AddrRªgeLi¡
 
	$g‘AddrRªges
() const = 0;

418 
´Ùeùed
:

424 
	`unbšd
();

430 
	`bšd
(
Ma¡”PÜt
& 
ma¡”_pÜt
);

435 
vœtu®
 
Tick
 
	`»cvAtomic
(
Pack‘PŒ
 
pkt
) = 0;

440 
vœtu®
 
	`»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
) = 0;

445 
vœtu®
 
boŞ
 
	`»cvTimšgReq
(
Pack‘PŒ
 
pkt
) = 0;

450 
vœtu®
 
boŞ
 
	$»cvTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
)

452 
	`·nic
("% wa nÙƒx³ùšg‡imšg snoİ„e¥Ú£\n", 
	`Çme
());

453 
	}
}

460 
vœtu®
 
»cvR‘ry
() = 0;

	@port_proxy.cc

40 
	~"ba£/chunk_g’”©Ü.hh
"

41 
	~"mem/pÜt_´oxy.hh
"

44 
	gPÜtProxy
::
	$blobH–³r
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
, 
MemCmd
 
cmd
) const

46 
Reque¡
 
»q
;

48 
ChunkG’”©Ü
 
	`g’
(
addr
, 
size
, 
_ÿcheLšeSize
);

49 !
g’
.
	`dÚe
(); g’.
	`Ãxt
()) {

50 
»q
.
	`£tPhys
(
g’
.
	`addr
(), g’.
	`size
(), 0, 
Reque¡
::
funcMa¡”Id
);

51 
Pack‘
 
	`pkt
(&
»q
, 
cmd
);

52 
pkt
.
	`d©aStic
(
p
);

53 
_pÜt
.
	`£ndFunùiÚ®
(&
pkt
);

54 
p
 +ğ
g’
.
	`size
();

56 
	}
}

59 
	gPÜtProxy
::
	$mem£tBlob
(
Addr
 
addr
, 
ušt8_t
 
v
, 
size
) const

62 
ušt8_t
 *
buf
 = 
Ãw
 ušt8_t[
size
];

64 
¡d
::
	`mem£t
(
buf
, 
v
, 
size
);

65 
	`blobH–³r
(
addr
, 
buf
, 
size
, 
MemCmd
::
Wr™eReq
);

67 
d–‘e
 [] 
buf
;

68 
	}
}

	@port_proxy.hh

59 #iâdeà
__MEM_PORT_PROXY_HH__


60 
	#__MEM_PORT_PROXY_HH__


	)

62 
	~"cÚfig/the_i§.hh
"

63 #ià
THE_ISA
 !ğ
NULL_ISA


64 
	~"¬ch/i§_Œa™s.hh
"

67 
	~"mem/pÜt.hh
"

68 
	~"sim/by‹sw­.hh
"

84 şas 
	cPÜtProxy


86 
	m´iv©e
:

89 
Ma¡”PÜt
 &
_pÜt
;

92 cÚ¡ 
	m_ÿcheLšeSize
;

94 
	$blobH–³r
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
, 
MemCmd
 
cmd
) const;

96 
public
:

97 
	$PÜtProxy
(
Ma¡”PÜt
 &
pÜt
, 
ÿcheLšeSize
) :

98 
	`_pÜt
(
pÜt
), 
	$_ÿcheLšeSize
(
ÿcheLšeSize
) { }

99 
vœtu®
 ~
	$PÜtProxy
(è{ 
	}
}

104 
vœtu®
 
	$»adBlob
(
Addr
 
addr
, 
ušt8_t
* 
p
, 
size
) const

105 { 
	`blobH–³r
(
addr
, 
p
, 
size
, 
MemCmd
::
R—dReq
); 
	}
}

110 
vœtu®
 
	$wr™eBlob
(
Addr
 
addr
, 
ušt8_t
* 
p
, 
size
) const

111 { 
	`blobH–³r
(
addr
, 
p
, 
size
, 
MemCmd
::
Wr™eReq
); 
	}
}

116 
vœtu®
 
	$mem£tBlob
(
Addr
 
addr
, 
ušt8_t
 
v
, 
size
) const;

121 
‹m¶©e
 <
ty³Çme
 
T
>

122 
T
 
	$»ad
(
Addr
 
add»ss
) const;

127 
‹m¶©e
 <
ty³Çme
 
T
>

128 
	$wr™e
(
Addr
 
add»ss
, 
T
 
d©a
) const;

130 #ià
THE_ISA
 !ğ
NULL_ISA


135 
‹m¶©e
 <
ty³Çme
 
T
>

136 
T
 
	$»adGtoH
(
Addr
 
add»ss
) const;

142 
‹m¶©e
 <
ty³Çme
 
T
>

143 
	$wr™eHtoG
(
Addr
 
add»ss
, 
T
 
d©a
) const;

145 
	}
};

148 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

149 
T


150 
	gPÜtProxy
::
	$»ad
(
Addr
 
add»ss
) const

152 
T
 
d©a
;

153 
	`»adBlob
(
add»ss
, (
ušt8_t
*)&
d©a
, (
T
));

154  
d©a
;

155 
	}
}

157 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

159 
	gPÜtProxy
::
	$wr™e
(
Addr
 
add»ss
, 
T
 
d©a
) const

161 
	`wr™eBlob
(
add»ss
, (
ušt8_t
*)&
d©a
, (
T
));

162 
	}
}

164 #ià
THE_ISA
 !ğ
NULL_ISA


165 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

166 
T


167 
	gPÜtProxy
::
	$»adGtoH
(
Addr
 
add»ss
) const

169 
T
 
d©a
;

170 
	`»adBlob
(
add»ss
, (
ušt8_t
*)&
d©a
, (
T
));

171  
TheISA
::
	`gtoh
(
d©a
);

172 
	}
}

174 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

176 
	gPÜtProxy
::
	$wr™eHtoG
(
Addr
 
add»ss
, 
T
 
d©a
) const

178 
d©a
 = 
TheISA
::
	`htog
(data);

179 
	`wr™eBlob
(
add»ss
, (
ušt8_t
*)&
d©a
, (
T
));

180 
	}
}

	@qport.hh

40 #iâdeà
__MEM_QPORT_HH__


41 
	#__MEM_QPORT_HH__


	)

48 
	~"mem/·ck‘_queue.hh
"

49 
	~"mem/pÜt.hh
"

59 şas 
	cQueuedSÏvePÜt
 : 
public
 
SÏvePÜt


62 
´Ùeùed
:

65 
SÏvePack‘Queue
 &
queue
;

69 
vœtu®
 
	$»cvR‘ry
(è{ 
queue
.
	`»Œy
(); }

71 
public
:

80 
	`QueuedSÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
,

81 
SÏvePack‘Queue
 &
queue
) :

82 
	`SÏvePÜt
(
Çme
, 
owÃr
), 
	$queue
(
queue
)

83 { 
	}
}

85 
	gvœtu®
 ~
	$QueuedSÏvePÜt
(è{ 
	}
}

93 
	$schedTimšgRe¥
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
)

94 { 
queue
.
	`schedS’dTimšg
(
pkt
, 
wh’
); 
	}
}

98 
boŞ
 
	$checkFunùiÚ®
(
Pack‘PŒ
 
pkt
è{  
queue
.
	`checkFunùiÚ®
Õkt); 
	}
}

100 
	$d¿š
(
D¿šMªag”
 *
dm
è{  
queue
.
	`d¿š
(dm); 
	}
}

103 şas 
	cQueuedMa¡”PÜt
 : 
public
 
Ma¡”PÜt


106 
´Ùeùed
:

109 
Ma¡”Pack‘Queue
 &
queue
;

113 
vœtu®
 
	$»cvR‘ry
(è{ 
queue
.
	`»Œy
(); }

115 
public
:

124 
	`QueuedMa¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
,

125 
Ma¡”Pack‘Queue
 &
queue
, 
PÜtID
 
id
 = 
Inv®idPÜtID
) :

126 
	`Ma¡”PÜt
(
Çme
, 
owÃr
, 
id
), 
	$queue
(
queue
)

127 { 
	}
}

129 
	gvœtu®
 ~
	$QueuedMa¡”PÜt
(è{ 
	}
}

137 
	$schedTimšgReq
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
)

138 { 
queue
.
	`schedS’dTimšg
(
pkt
, 
wh’
); 
	}
}

146 
	$schedTimšgSnoİRe¥
(
Pack‘PŒ
 
pkt
, 
Tick
 
wh’
)

147 { 
queue
.
	`schedS’dTimšg
(
pkt
, 
wh’
, 
Œue
); 
	}
}

151 
boŞ
 
	$checkFunùiÚ®
(
Pack‘PŒ
 
pkt
è{  
queue
.
	`checkFunùiÚ®
Õkt); 
	}
}

153 
	$d¿š
(
D¿šMªag”
 *
dm
è{  
queue
.
	`d¿š
(dm); 
	}
}

	@request.hh

51 #iâdeà
__MEM_REQUEST_HH__


52 
	#__MEM_REQUEST_HH__


	)

54 
	~<ÿs£¹
>

55 
	~<şim™s
>

57 
	~"ba£/æags.hh
"

58 
	~"ba£/misc.hh
"

59 
	~"ba£/ty³s.hh
"

60 
	~"sim/cÜe.hh
"

70 
Çme¥aû
 
	gCÚ‹xtSw™chTaskId
 {

71 
	eTaskId
 {

72 
	gMaxNÜm®TaskId
 = 1021,

73 
	gP»ãtch”
 = 1022,

74 
	gDMA
 = 1023,

75 
	gUnknown
 = 1024,

76 
	gNumTaskId


80 
şass
 
	gReque¡
;

82 
Reque¡
* 
	tReque¡PŒ
;

83 
ušt16_t
 
	tMa¡”ID
;

85 şas 
	cReque¡


87 
	mpublic
:

88 
ušt32_t
 
	tFÏgsTy³
;

89 
ušt8_t
 
	tArchFÏgsTy³
;

90 ::
FÏgs
<
	tFÏgsTy³
> 
	tFÏgs
;

99 cÚ¡ 
FÏgsTy³
 
	mARCH_BITS
 = 0x000000FF;

101 cÚ¡ 
FÏgsTy³
 
	mINST_FETCH
 = 0x00000100;

103 cÚ¡ 
FÏgsTy³
 
	mPHYSICAL
 = 0x00000200;

105 cÚ¡ 
FÏgsTy³
 
	mVPTE
 = 0x00000400;

107 cÚ¡ 
FÏgsTy³
 
	mALTMODE
 = 0x00000800;

109 cÚ¡ 
FÏgsTy³
 
	mUNCACHEABLE
 = 0x00001000;

111 cÚ¡ 
FÏgsTy³
 
	mMMAPPED_IPR
 = 0x00002000;

113 cÚ¡ 
FÏgsTy³
 
	mCLEAR_LL
 = 0x00004000;

115 cÚ¡ 
FÏgsTy³
 
	mPRIVILEGED
 = 0x00008000;

118 cÚ¡ 
FÏgsTy³
 
	mNO_ACCESS
 = 0x00080000;

125 cÚ¡ 
FÏgsTy³
 
	mLOCKED
 = 0x00100000;

127 cÚ¡ 
FÏgsTy³
 
	mLLSC
 = 0x00200000;

129 cÚ¡ 
FÏgsTy³
 
	mMEM_SWAP
 = 0x00400000;

130 cÚ¡ 
FÏgsTy³
 
	mMEM_SWAP_COND
 = 0x00800000;

133 cÚ¡ 
FÏgsTy³
 
	mPREFETCH
 = 0x01000000;

135 cÚ¡ 
FÏgsTy³
 
	mPF_EXCLUSIVE
 = 0x02000000;

137 cÚ¡ 
FÏgsTy³
 
	mEVICT_NEXT
 = 0x04000000;

141 cÚ¡ 
FÏgsTy³
 
	mGENERIC_IPR
 = 0x08000000;

145 cÚ¡ 
FÏgsTy³
 
	mSTICKY_FLAGS
 = 
INST_FETCH
;

150 cÚ¡ 
Ma¡”ID
 
	mwbMa¡”Id
 = 0;

154 cÚ¡ 
Ma¡”ID
 
	mfuncMa¡”Id
 = 1;

156 cÚ¡ 
Ma¡”ID
 
	mštMa¡”Id
 = 2;

160 cÚ¡ 
Ma¡”ID
 
	mšvldMa¡”Id
 = 
USHRT_MAX
;

165 cÚ¡ 
ušt32_t
 
	mšvldPid
 = 
UINT_MAX
;

167 
	m´iv©e
:

168 
ušt8_t
 
	tPriv©eFÏgsTy³
;

169 ::
FÏgs
<
	tPriv©eFÏgsTy³
> 
	tPriv©eFÏgs
;

172 cÚ¡ 
Priv©eFÏgsTy³
 
	mVALID_SIZE
 = 0x00000001;

174 cÚ¡ 
Priv©eFÏgsTy³
 
	mVALID_PADDR
 = 0x00000002;

176 cÚ¡ 
Priv©eFÏgsTy³
 
	mVALID_VADDR
 = 0x00000004;

178 cÚ¡ 
Priv©eFÏgsTy³
 
	mVALID_PC
 = 0x00000010;

180 cÚ¡ 
Priv©eFÏgsTy³
 
	mVALID_CONTEXT_ID
 = 0x00000020;

181 cÚ¡ 
Priv©eFÏgsTy³
 
	mVALID_THREAD_ID
 = 0x00000040;

183 cÚ¡ 
Priv©eFÏgsTy³
 
	mVALID_EXTRA_DATA
 = 0x00000080;

187 cÚ¡ 
Priv©eFÏgsTy³
 
	mSTICKY_PRIVATE_FLAGS
 =

188 
VALID_CONTEXT_ID
 | 
VALID_THREAD_ID
;

190 
	m´iv©e
:

195 
Addr
 
_·ddr
;

202 
	m_size
;

207 
Ma¡”ID
 
	m_ma¡”Id
;

210 
FÏgs
 
	m_æags
;

213 
Priv©eFÏgs
 
	m´iv©eFÏgs
;

220 
Tick
 
	m_time
;

223 
	m_asid
;

226 
Addr
 
	m_vaddr
;

231 
ušt64_t
 
	m_exŒaD©a
;

234 
	m_cÚ‹xtId
;

236 
	m_th»adId
;

239 
Addr
 
	m_pc
;

241 
	mpublic
:

246 
	$Reque¡
()

254 
	$Reque¡
(
Addr
 
·ddr
, 
size
, 
FÏgs
 
æags
, 
Ma¡”ID
 
mid
)

256 
	`£tPhys
(
·ddr
, 
size
, 
æags
, 
mid
);

257 
	}
}

259 
	$Reque¡
(
Addr
 
·ddr
, 
size
, 
FÏgs
 
æags
, 
Ma¡”ID
 
mid
, 
Tick
 
time
)

261 
	`£tPhys
(
·ddr
, 
size
, 
æags
, 
mid
, 
time
);

262 
	}
}

264 
	$Reque¡
(
Addr
 
·ddr
, 
size
, 
FÏgs
 
æags
, 
Ma¡”ID
 
mid
, 
Tick
 
time
, Add¸
pc
)

266 
	`£tPhys
(
·ddr
, 
size
, 
æags
, 
mid
, 
time
);

267 
´iv©eFÏgs
.
	`£t
(
VALID_PC
);

268 
_pc
 = 
pc
;

269 
	}
}

271 
	$Reque¡
(
asid
, 
Addr
 
vaddr
, 
size
, 
FÏgs
 
æags
, 
Ma¡”ID
 
mid
, Add¸
pc
,

272 
cid
, 
Th»adID
 
tid
)

274 
	`£tVœt
(
asid
, 
vaddr
, 
size
, 
æags
, 
mid
, 
pc
);

275 
	`£tTh»adCÚ‹xt
(
cid
, 
tid
);

276 
	}
}

278 ~
	$Reque¡
(è{
	}
}

284 
	$£tTh»adCÚ‹xt
(
cÚ‹xt_id
, 
Th»adID
 
tid
)

286 
_cÚ‹xtId
 = 
cÚ‹xt_id
;

287 
_th»adId
 = 
tid
;

288 
´iv©eFÏgs
.
	`£t
(
VALID_CONTEXT_ID
|
VALID_THREAD_ID
);

289 
	}
}

296 
	$£tPhys
(
Addr
 
·ddr
, 
size
, 
FÏgs
 
æags
, 
Ma¡”ID
 
mid
, 
Tick
 
time
)

298 
	`as£¹
(
size
 >= 0);

299 
_·ddr
 = 
·ddr
;

300 
_size
 = 
size
;

301 
_time
 = 
time
;

302 
_ma¡”Id
 = 
mid
;

303 
_æags
.
	`ş—r
(~
STICKY_FLAGS
);

304 
_æags
.
	`£t
(
æags
);

305 
´iv©eFÏgs
.
	`ş—r
(~
STICKY_PRIVATE_FLAGS
);

306 
´iv©eFÏgs
.
	`£t
(
VALID_PADDR
|
VALID_SIZE
);

307 
	}
}

310 
	$£tPhys
(
Addr
 
·ddr
, 
size
, 
FÏgs
 
æags
, 
Ma¡”ID
 
mid
)

312 
	`£tPhys
(
·ddr
, 
size
, 
æags
, 
mid
, 
	`curTick
());

313 
	}
}

320 
	$£tVœt
(
asid
, 
Addr
 
vaddr
, 
size
, 
FÏgs
 
æags
, 
Ma¡”ID
 
mid
, Add¸
pc
)

322 
	`as£¹
(
size
 >= 0);

323 
_asid
 = 
asid
;

324 
_vaddr
 = 
vaddr
;

325 
_size
 = 
size
;

326 
_ma¡”Id
 = 
mid
;

327 
_pc
 = 
pc
;

328 
_time
 = 
	`curTick
();

330 
_æags
.
	`ş—r
(~
STICKY_FLAGS
);

331 
_æags
.
	`£t
(
æags
);

332 
´iv©eFÏgs
.
	`ş—r
(~
STICKY_PRIVATE_FLAGS
);

333 
´iv©eFÏgs
.
	`£t
(
VALID_VADDR
|
VALID_SIZE
|
VALID_PC
);

334 
	}
}

344 
	$£tPaddr
(
Addr
 
·ddr
)

346 
_·ddr
 = 
·ddr
;

347 
´iv©eFÏgs
.
	`£t
(
VALID_PADDR
);

348 
	}
}

354 
	$¥l™OnVaddr
(
Addr
 
¥l™_addr
, 
Reque¡PŒ
 &
»q1
, Reque¡PŒ &
»q2
)

356 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_VADDR
));

357 
	`as£¹
(
´iv©eFÏgs
.
	`nÚeS‘
(
VALID_PADDR
));

358 
	`as£¹
(
¥l™_addr
 > 
_vaddr
 && s¶™_add¸< _vadd¸+ 
_size
);

359 
»q1
 = 
Ãw
 
Reque¡
;

360 *
»q1
 = *
this
;

361 
»q2
 = 
Ãw
 
Reque¡
;

362 *
»q2
 = *
this
;

363 
»q1
->
_size
 = 
¥l™_addr
 - 
_vaddr
;

364 
»q2
->
_vaddr
 = 
¥l™_addr
;

365 
»q2
->
_size
 = _siz- 
»q1
->_size;

366 
	}
}

371 
boŞ


372 
	$hasPaddr
()

374  
´iv©eFÏgs
.
	`isS‘
(
VALID_PADDR
);

375 
	}
}

377 
Addr


378 
	$g‘Paddr
()

380 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_PADDR
));

381  
_·ddr
;

382 
	}
}

387 
	$£tSize
(
size
)

389 
_size
=
size
;

390 
	}
}

393 
boŞ


394 
	$hasSize
()

396  
´iv©eFÏgs
.
	`isS‘
(
VALID_SIZE
);

397 
	}
}

400 
	$g‘Size
()

402 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_SIZE
));

403  
_size
;

404 
	}
}

407 
Tick


408 
	$time
() const

410 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_PADDR
|
VALID_VADDR
));

411  
_time
;

412 
	}
}

415 
	$time
(
Tick
 
time
)

417 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_PADDR
|
VALID_VADDR
));

418 
_time
 = 
time
;

419 
	}
}

422 
FÏgs


423 
	$g‘FÏgs
()

425 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_PADDR
|
VALID_VADDR
));

426  
_æags
;

427 
	}
}

434 
	$£tFÏgs
(
FÏgs
 
æags
)

436 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_PADDR
|
VALID_VADDR
));

437 
_æags
.
	`£t
(
æags
);

438 
	}
}

441 
	$£tArchFÏgs
(
FÏgs
 
æags
)

443 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_PADDR
|
VALID_VADDR
));

444 
_æags
.
	`£t
(
æags
 & 
ARCH_BITS
);

445 
	}
}

448 
Addr


449 
	$g‘Vaddr
()

451 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_VADDR
));

452  
_vaddr
;

453 
	}
}

456 
Ma¡”ID


457 
	$ma¡”Id
()

459  
_ma¡”Id
;

460 
	}
}

464 
	$g‘Asid
()

466 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_VADDR
));

467  
_asid
;

468 
	}
}

472 
	$£tAsid
(
asid
)

474 
_asid
 = 
asid
;

475 
	}
}

478 
ArchFÏgsTy³


479 
	$g‘ArchFÏgs
()

481 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_PADDR
|
VALID_VADDR
));

482  
_æags
 & 
ARCH_BITS
;

483 
	}
}

486 
boŞ


487 
	$exŒaD©aV®id
()

489  
´iv©eFÏgs
.
	`isS‘
(
VALID_EXTRA_DATA
);

490 
	}
}

493 
ušt64_t


494 
	$g‘ExŒaD©a
() const

496 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_EXTRA_DATA
));

497  
_exŒaD©a
;

498 
	}
}

502 
	$£tExŒaD©a
(
ušt64_t
 
exŒaD©a
)

504 
_exŒaD©a
 = 
exŒaD©a
;

505 
´iv©eFÏgs
.
	`£t
(
VALID_EXTRA_DATA
);

506 
	}
}

508 
boŞ


509 
	$hasCÚ‹xtId
() const

511  
´iv©eFÏgs
.
	`isS‘
(
VALID_CONTEXT_ID
);

512 
	}
}

516 
	$cÚ‹xtId
() const

518 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_CONTEXT_ID
));

519  
_cÚ‹xtId
;

520 
	}
}

524 
	$th»adId
() const

526 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_THREAD_ID
));

527  
_th»adId
;

528 
	}
}

530 
boŞ


531 
	$hasPC
() const

533  
´iv©eFÏgs
.
	`isS‘
(
VALID_PC
);

534 
	}
}

537 
Addr


538 
	$g‘PC
() const

540 
	`as£¹
(
´iv©eFÏgs
.
	`isS‘
(
VALID_PC
));

541  
_pc
;

542 
	}
}

546 
boŞ
 
	$isUnÿch—bË
(ècÚ¡ {  
_æags
.
	`isS‘
(
UNCACHEABLE
); 
	}
}

547 
boŞ
 
	$isIn¡F‘ch
(ècÚ¡ {  
_æags
.
	`isS‘
(
INST_FETCH
); 
	}
}

548 
boŞ
 
	$isP»ãtch
(ècÚ¡ {  
_æags
.
	`isS‘
(
PREFETCH
); 
	}
}

549 
boŞ
 
	$isLLSC
(ècÚ¡ {  
_æags
.
	`isS‘
(
LLSC
); 
	}
}

550 
boŞ
 
	$isPriv
(ècÚ¡ {  
_æags
.
	`isS‘
(
PRIVILEGED
); 
	}
}

551 
boŞ
 
	$isLocked
(ècÚ¡ {  
_æags
.
	`isS‘
(
LOCKED
); 
	}
}

552 
boŞ
 
	$isSw­
(ècÚ¡ {  
_æags
.
	`isS‘
(
MEM_SWAP
|
MEM_SWAP_COND
); 
	}
}

553 
boŞ
 
	$isCÚdSw­
(ècÚ¡ {  
_æags
.
	`isS‘
(
MEM_SWAP_COND
); 
	}
}

554 
boŞ
 
	$isMm­³dI´
(ècÚ¡ {  
_æags
.
	`isS‘
(
MMAPPED_IPR
); 
	}
}

555 
boŞ
 
	$isCË¬LL
(ècÚ¡ {  
_æags
.
	`isS‘
(
CLEAR_LL
); 
	}
}

	@ruby/buffers/MessageBuffer.cc

29 
	~<ÿs£¹
>

31 
	~"ba£/ırštf.hh
"

32 
	~"ba£/misc.hh
"

33 
	~"ba£/¡l_h–³rs.hh
"

34 
	~"debug/RubyQueue.hh
"

35 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

36 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

38 
usšg
 
Çme¥aû
 
	g¡d
;

39 
usšg
 
	gm5
::
¡l_h–³rs
::
İ”©Ü
<<;

41 
	gMes§geBufãr
::
	$Mes§geBufãr
(cÚ¡ 
¡ršg
 &
Çme
)

42 : 
	`m_time_Ï¡_time_size_checked
(0), 
	`m_time_Ï¡_time_’queue
(0),

43 
	`m_time_Ï¡_time_pİ
(0), 
	$m_Ï¡_¬riv®_time
(0)

45 
m_msg_couÁ”
 = 0;

46 
m_cÚsum”
 = 
NULL
;

47 
m_£nd”
 = 
NULL
;

48 
m_»ûiv”
 = 
NULL
;

50 
m_Üd”šg_£t
 = 
çl£
;

51 
m_¡riù_fifo
 = 
Œue
;

52 
m_max_size
 = -1;

53 
m_¿ndomiz©iÚ
 = 
Œue
;

54 
m_size_Ï¡_time_size_checked
 = 0;

55 
m_size_©_cyşe_¡¬t
 = 0;

56 
m_msgs_this_cyşe
 = 0;

57 
m_nÙ_ava_couÁ
 = 0;

58 
m_´iÜ™y_¿nk
 = 0;

59 
m_Çme
 = 
Çme
;

61 
m_¡®l_msg_m­
.
	`ş—r
();

62 
m_šput_lšk_id
 = 0;

63 
m_vÃt_id
 = 0;

64 
	}
}

67 
	gMes§geBufãr
::
	$g‘Size
()

69 ià(
m_time_Ï¡_time_size_checked
 !ğ
m_»ûiv”
->
	`curCyşe
()) {

70 
m_time_Ï¡_time_size_checked
 = 
m_»ûiv”
->
	`curCyşe
();

71 
m_size_Ï¡_time_size_checked
 = 
m_´io_h—p
.
	`size
();

74  
m_size_Ï¡_time_size_checked
;

75 
	}
}

77 
boŞ


78 
	gMes§geBufãr
::
	$¬eNSlÙsAvaabË
(
n
)

82 ià(
m_max_size
 == -1) {

83  
Œue
;

90 
cu¼’t_size
 = 0;

92 ià(
m_time_Ï¡_time_pİ
 < 
m_»ûiv”
->
	`curCyşe
()) {

94 
cu¼’t_size
 = 
m_´io_h—p
.
	`size
();

96 ià(
m_time_Ï¡_time_’queue
 < 
m_»ûiv”
->
	`curCyşe
()) {

98 
cu¼’t_size
 = 
m_size_©_cyşe_¡¬t
;

102 
cu¼’t_size
 = 
m_size_©_cyşe_¡¬t
 + 
m_msgs_this_cyşe
;

107 ià(
cu¼’t_size
 + 
n
 <ğ
m_max_size
) {

108  
Œue
;

110 
	`DPRINTF
(
RubyQueue
, "n: %d, current_size: %d, heap size: %d, "

112 
n
, 
cu¼’t_size
, 
m_´io_h—p
.
	`size
(), 
m_max_size
);

113 
m_nÙ_ava_couÁ
++;

114  
çl£
;

116 
	}
}

118 cÚ¡ 
MsgPŒ


119 
	gMes§geBufãr
::
	$g‘MsgPŒCİy
() const

121 
	`as£¹
(
	`isR—dy
());

123  
m_´io_h—p
.
	`äÚt
().
m_msg±r
->
	`şÚe
();

124 
	}
}

126 cÚ¡ 
Mes§ge
*

127 
	gMes§geBufãr
::
	$³ekAtH—dOfQueue
() const

129 
	`DPRINTF
(
RubyQueue
, "Peeking‡t head of queue.\n");

130 
	`as£¹
(
	`isR—dy
());

132 cÚ¡ 
Mes§ge
* 
msg_±r
 = 
m_´io_h—p
.
	`äÚt
().
m_msg±r
.
	`g‘
();

133 
	`as£¹
(
msg_±r
);

135 
	`DPRINTF
(
RubyQueue
, "Mes§ge: %s\n", (*
msg_±r
));

136  
msg_±r
;

137 
	}
}

140 
Cyşes


141 
	$¿ndom_time
()

143 
Cyşes
 
	`time
(1);

144 
time
 +ğ
	`Cyşes
(
	`¿ndom
() & 0x3);

145 ià((
	`¿ndom
() & 0x7) == 0) {

146 
time
 +ğ
	`Cyşes
(100 + (
	`¿ndom
() % 0xf));

148  
time
;

149 
	}
}

152 
	gMes§geBufãr
::
	$’queue
(
MsgPŒ
 
mes§ge
, 
Cyşes
 
d–
)

154 
m_msg_couÁ”
++;

157 ià(
m_time_Ï¡_time_’queue
 < 
m_£nd”
->
	`curCyşe
()) {

158 
m_msgs_this_cyşe
 = 0;

159 
m_time_Ï¡_time_’queue
 = 
m_£nd”
->
	`curCyşe
();

161 
m_msgs_this_cyşe
++;

163 ià(!
m_Üd”šg_£t
) {

164 
	`·nic
("Ord”šg…rİ”ty oà% ha nÙ b“À£t", 
m_Çme
);

169 
	`as£¹
(
d–
 > 0);

170 
Tick
 
cu¼’t_time
 = 
m_£nd”
->
	`şockEdge
();

171 
Tick
 
¬riv®_time
 = 0;

173 ià(!
RubySy¡em
::
	`g‘Rªdomiz©iÚ
(è|| (
m_¿ndomiz©iÚ
 =ğ
çl£
)) {

175 
¬riv®_time
 = 
cu¼’t_time
 + 
d–
 * 
m_£nd”
->
	`şockP”iod
();

178 ià(
m_¡riù_fifo
) {

179 ià(
m_Ï¡_¬riv®_time
 < 
cu¼’t_time
) {

180 
m_Ï¡_¬riv®_time
 = 
cu¼’t_time
;

182 
¬riv®_time
 = 
m_Ï¡_¬riv®_time
 +

183 
	`¿ndom_time
(è* 
m_£nd”
->
	`şockP”iod
();

185 
¬riv®_time
 = 
cu¼’t_time
 +

186 
	`¿ndom_time
(è* 
m_£nd”
->
	`şockP”iod
();

191 
	`as£¹
(
¬riv®_time
 > 
cu¼’t_time
);

192 ià(
m_¡riù_fifo
) {

193 ià(
¬riv®_time
 < 
m_Ï¡_¬riv®_time
) {

194 
	`·nic
("FIFO ordering violated: %s‚ame: %s currentime: %d "

196 *
this
, 
m_Çme
, 
cu¼’t_time
,

197 
d–
 * 
m_£nd”
->
	`şockP”iod
(),

198 
¬riv®_time
, 
m_Ï¡_¬riv®_time
);

203 ià(!
g_sy¡em_±r
->
m_w¬mup_’abËd
) {

204 
m_Ï¡_¬riv®_time
 = 
¬riv®_time
;

208 
Mes§ge
* 
msg_±r
 = 
mes§ge
.
	`g‘
();

209 
	`as£¹
(
msg_±r
 !ğ
NULL
);

211 
	`as£¹
(
m_£nd”
->
	`şockEdge
(è>ğ
msg_±r
->
	`g‘La¡EnqueueTime
() &&

214 
msg_±r
->
	`£tD–ayedTicks
(
m_£nd”
->
	`şockEdge
() -

215 
msg_±r
->
	`g‘La¡EnqueueTime
() +

216 
msg_±r
->
	`g‘D–ayedTicks
());

217 
msg_±r
->
	`£tLa¡EnqueueTime
(
¬riv®_time
);

220 
Mes§geBufãrNode
 
	`thisNode
(
¬riv®_time
, 
m_msg_couÁ”
, 
mes§ge
);

221 
m_´io_h—p
.
	`push_back
(
thisNode
);

222 
	`push_h—p
(
m_´io_h—p
.
	`begš
(), m_´io_h—p.
	`’d
(),

223 
g»©”
<
Mes§geBufãrNode
>());

225 
	`DPRINTF
(
RubyQueue
, "Enqueue‡rrival_time: %lld, Message: %s\n",

226 
¬riv®_time
, *(
mes§ge
.
	`g‘
()));

229 ià(
m_cÚsum”
 !ğ
NULL
) {

230 
m_cÚsum”
->
	`scheduËEv’tAbsŞu‹
(
¬riv®_time
);

231 
m_cÚsum”
->
	`¡ÜeEv’tInfo
(
m_vÃt_id
);

233 
	`·nic
("NØcÚsum”: % Çme: %s\n", *
this
, 
m_Çme
);

235 
	}
}

237 
Cyşes


238 
	gMes§geBufãr
::
	$dequeue_g‘D–ayCyşes
(
MsgPŒ
& 
mes§ge
)

240 
	`dequeue
(
mes§ge
);

241  
	`£tAndR‘uºD–ayCyşes
(
mes§ge
);

242 
	}
}

245 
	gMes§geBufãr
::
	$dequeue
(
MsgPŒ
& 
mes§ge
)

247 
	`DPRINTF
(
RubyQueue
, "Dequeueing\n");

248 
mes§ge
 = 
m_´io_h—p
.
	`äÚt
().
m_msg±r
;

250 
	`pİ
();

251 
	`DPRINTF
(
RubyQueue
, "Enqueumes§gi %s\n", (*(
mes§ge
.
	`g‘
())));

252 
	}
}

254 
Cyşes


255 
	gMes§geBufãr
::
	$dequeue_g‘D–ayCyşes
()

258 
MsgPŒ
 
mes§ge
 = 
m_´io_h—p
.
	`äÚt
().
m_msg±r
;

261 
Cyşes
 
d–ayCyşes
 = 
	`£tAndR‘uºD–ayCyşes
(
mes§ge
);

262 
	`dequeue
();

264  
d–ayCyşes
;

265 
	}
}

268 
	gMes§geBufãr
::
	$pİ
()

270 
	`DPRINTF
(
RubyQueue
, "Popping\n");

271 
	`as£¹
(
	`isR—dy
());

275 ià(
m_time_Ï¡_time_pİ
 < 
m_»ûiv”
->
	`curCyşe
()) {

276 
m_size_©_cyşe_¡¬t
 = 
m_´io_h—p
.
	`size
();

277 
m_time_Ï¡_time_pİ
 = 
m_»ûiv”
->
	`curCyşe
();

280 
	`pİ_h—p
(
m_´io_h—p
.
	`begš
(), m_´io_h—p.
	`’d
(),

281 
g»©”
<
Mes§geBufãrNode
>());

282 
m_´io_h—p
.
	`pİ_back
();

283 
	}
}

286 
	gMes§geBufãr
::
	$ş—r
()

288 
m_´io_h—p
.
	`ş—r
();

290 
m_msg_couÁ”
 = 0;

291 
m_time_Ï¡_time_’queue
 = 
	`Cyşes
(0);

292 
m_time_Ï¡_time_pİ
 = 
	`Cyşes
(0);

293 
m_size_©_cyşe_¡¬t
 = 0;

294 
m_msgs_this_cyşe
 = 0;

295 
	}
}

298 
	gMes§geBufãr
::
	$»cyşe
()

300 
	`DPRINTF
(
RubyQueue
, "Recycling.\n");

301 
	`as£¹
(
	`isR—dy
());

302 
Mes§geBufãrNode
 
node
 = 
m_´io_h—p
.
	`äÚt
();

303 
	`pİ_h—p
(
m_´io_h—p
.
	`begš
(), m_´io_h—p.
	`’d
(),

304 
g»©”
<
Mes§geBufãrNode
>());

306 
node
.
m_time
 = 
m_»ûiv”
->
	`şockEdge
(
m_»cyşe_Ï‹ncy
);

307 
m_´io_h—p
.
	`back
(èğ
node
;

308 
	`push_h—p
(
m_´io_h—p
.
	`begš
(), m_´io_h—p.
	`’d
(),

309 
g»©”
<
Mes§geBufãrNode
>());

310 
m_cÚsum”
->

311 
	`scheduËEv’tAbsŞu‹
(
m_»ûiv”
->
	`şockEdge
(
m_»cyşe_Ï‹ncy
));

312 
	}
}

315 
	gMes§geBufãr
::
	$»ª®yzeMes§ges
(cÚ¡ 
Add»ss
& 
addr
)

317 
	`DPRINTF
(
RubyQueue
, "ReanalyzeMessages\n");

318 
	`as£¹
(
m_¡®l_msg_m­
.
	`couÁ
(
addr
) > 0);

319 
Tick
 
ÃxtTick
 = 
m_»ûiv”
->
	`şockEdge
(
	`Cyşes
(1));

325 !
m_¡®l_msg_m­
[
addr
].
	`em±y
()) {

326 
m_msg_couÁ”
++;

327 
Mes§geBufãrNode
 
	`msgNode
(
ÃxtTick
, 
m_msg_couÁ”
,

328 
m_¡®l_msg_m­
[
addr
].
	`äÚt
());

330 
m_´io_h—p
.
	`push_back
(
msgNode
);

331 
	`push_h—p
(
m_´io_h—p
.
	`begš
(), m_´io_h—p.
	`’d
(),

332 
g»©”
<
Mes§geBufãrNode
>());

334 
m_cÚsum”
->
	`scheduËEv’tAbsŞu‹
(
ÃxtTick
);

335 
m_¡®l_msg_m­
[
addr
].
	`pİ_äÚt
();

337 
m_¡®l_msg_m­
.
	`”a£
(
addr
);

338 
	}
}

341 
	gMes§geBufãr
::
	$»ª®yzeAÎMes§ges
()

343 
	`DPRINTF
(
RubyQueue
, "ReanalyzeAllMessages\n");

344 
Tick
 
ÃxtTick
 = 
m_»ûiv”
->
	`şockEdge
(
	`Cyşes
(1));

350 
SÎMsgM­Ty³
::
™”©Ü
 
m­_™”
 = 
m_¡®l_msg_m­
.
	`begš
();

351 
m­_™”
 !ğ
m_¡®l_msg_m­
.
	`’d
();

352 ++
m­_™”
) {

354 !(
m­_™”
->
£cÚd
).
	`em±y
()) {

355 
m_msg_couÁ”
++;

356 
Mes§geBufãrNode
 
	`msgNode
(
ÃxtTick
, 
m_msg_couÁ”
,

357 (
m­_™”
->
£cÚd
).
	`äÚt
());

359 
m_´io_h—p
.
	`push_back
(
msgNode
);

360 
	`push_h—p
(
m_´io_h—p
.
	`begš
(), m_´io_h—p.
	`’d
(),

361 
g»©”
<
Mes§geBufãrNode
>());

363 
m_cÚsum”
->
	`scheduËEv’tAbsŞu‹
(
ÃxtTick
);

364 (
m­_™”
->
£cÚd
).
	`pİ_äÚt
();

367 
m_¡®l_msg_m­
.
	`ş—r
();

368 
	}
}

371 
	gMes§geBufãr
::
	$¡®lMes§ge
(cÚ¡ 
Add»ss
& 
addr
)

373 
	`DPRINTF
(
RubyQueue
, "SÎšg dutØ%s\n", 
addr
);

374 
	`as£¹
(
	`isR—dy
());

375 
	`as£¹
(
addr
.
	`g‘Off£t
() == 0);

376 
MsgPŒ
 
mes§ge
 = 
m_´io_h—p
.
	`äÚt
().
m_msg±r
;

378 
	`pİ
();

385 (
m_¡®l_msg_m­
[
addr
]).
	`push_back
(
mes§ge
);

386 
	}
}

388 
Cyşes


389 
	gMes§geBufãr
::
	$£tAndR‘uºD–ayCyşes
(
MsgPŒ
 
msg_±r
)

395 
	`as£¹
(
msg_±r
->
	`g‘La¡EnqueueTime
(è<ğ
m_»ûiv”
->
	`şockEdge
());

397 
msg_±r
->
	`£tD–ayedTicks
(
m_»ûiv”
->
	`şockEdge
() -

398 
msg_±r
->
	`g‘La¡EnqueueTime
() +

399 
msg_±r
->
	`g‘D–ayedTicks
());

401  
m_»ûiv”
->
	`ticksToCyşes
(
msg_±r
->
	`g‘D–ayedTicks
());

402 
	}
}

405 
	gMes§geBufãr
::
	$´št
(
o¡»am
& 
out
) const

407 
	`cırštf
(
out
, "[MessageBuffer: ");

408 ià(
m_cÚsum”
 !ğ
NULL
) {

409 
	`cırštf
(
out
, " consumer-yes ");

412 
veùÜ
<
Mes§geBufãrNode
> 
	`cİy
(
m_´io_h—p
);

413 
	`sÜt_h—p
(
cİy
.
	`begš
(), cİy.
	`’d
(), 
g»©”
<
Mes§geBufãrNode
>());

414 
	`cırštf
(
out
, "%s] %s", 
cİy
, 
m_Çme
);

415 
	}
}

418 
	gMes§geBufãr
::
	$´štSts
(
o¡»am
& 
out
)

420 
out
 << "Mes§geBufãr: " << 
m_Çme
 << " st - msgs:" << 
m_msg_couÁ”


421 << " fuÎ:" << 
m_nÙ_ava_couÁ
 << 
’dl
;

422 
	}
}

424 
boŞ


425 
	gMes§geBufãr
::
	$isR—dy
() const

427  ((
m_´io_h—p
.
	`size
() > 0) &&

428 (
m_´io_h—p
.
	`äÚt
().
m_time
 <ğ
m_»ûiv”
->
	`şockEdge
()));

429 
	}
}

431 
boŞ


432 
	gMes§geBufãr
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

436 
i
 = 0; i < 
m_´io_h—p
.
	`size
(); ++i) {

437 
Mes§ge
 *
msg
 = 
m_´io_h—p
[
i
].
m_msg±r
.
	`g‘
();

438 ià(
msg
->
	`funùiÚ®R—d
(
pkt
)è 
Œue
;

443 
SÎMsgM­Ty³
::
™”©Ü
 
m­_™”
 = 
m_¡®l_msg_m­
.
	`begš
();

444 
m­_™”
 !ğ
m_¡®l_msg_m­
.
	`’d
();

445 ++
m­_™”
) {

447 
¡d
::
li¡
<
MsgPŒ
>::
™”©Ü
 
™
 = (
m­_™”
->
£cÚd
).
	`begš
();

448 
™
 !ğ(
m­_™”
->
£cÚd
).
	`’d
(); ++it) {

450 
Mes§ge
 *
msg
 = (*
™
).
	`g‘
();

451 ià(
msg
->
	`funùiÚ®R—d
(
pkt
)è 
Œue
;

454  
çl£
;

455 
	}
}

457 
ušt32_t


458 
	gMes§geBufãr
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

460 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

464 
i
 = 0; i < 
m_´io_h—p
.
	`size
(); ++i) {

465 
Mes§ge
 *
msg
 = 
m_´io_h—p
[
i
].
m_msg±r
.
	`g‘
();

466 ià(
msg
->
	`funùiÚ®Wr™e
(
pkt
)) {

467 
num_funùiÚ®_wr™es
++;

473 
SÎMsgM­Ty³
::
™”©Ü
 
m­_™”
 = 
m_¡®l_msg_m­
.
	`begš
();

474 
m­_™”
 !ğ
m_¡®l_msg_m­
.
	`’d
();

475 ++
m­_™”
) {

477 
¡d
::
li¡
<
MsgPŒ
>::
™”©Ü
 
™
 = (
m­_™”
->
£cÚd
).
	`begš
();

478 
™
 !ğ(
m­_™”
->
£cÚd
).
	`’d
(); ++it) {

480 
Mes§ge
 *
msg
 = (*
™
).
	`g‘
();

481 ià(
msg
->
	`funùiÚ®Wr™e
(
pkt
)) {

482 
num_funùiÚ®_wr™es
++;

487  
num_funùiÚ®_wr™es
;

488 
	}
}

	@ruby/buffers/MessageBuffer.hh

34 #iâdeà
__MEM_RUBY_BUFFERS_MESSAGEBUFFER_HH__


35 
	#__MEM_RUBY_BUFFERS_MESSAGEBUFFER_HH__


	)

37 
	~<®gÜ™hm
>

38 
	~<ÿs£¹
>

39 
	~<funùiÚ®
>

40 
	~<io¡»am
>

41 
	~<¡ršg
>

42 
	~<veùÜ
>

44 
	~"mem/·ck‘.hh
"

45 
	~"mem/ruby/bufãrs/Mes§geBufãrNode.hh
"

46 
	~"mem/ruby/commÚ/Add»ss.hh
"

47 
	~"mem/ruby/commÚ/CÚsum”.hh
"

48 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

50 şas 
	cMes§geBufãr


52 
	mpublic
:

53 
Mes§geBufãr
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
 = "");

55 
	m¡d
::
¡ršg
 
	$Çme
(ècÚ¡ {  
m_Çme
; }

57 
	$£tRecyşeL©’cy
(
Cyşes
 
»cyşe_Ï‹ncy
)

58 { 
m_»cyşe_Ï‹ncy
 = 
»cyşe_Ï‹ncy
; 
	}
}

60 
»ª®yzeMes§ges
(cÚ¡ 
Add»ss
& 
addr
);

61 
»ª®yzeAÎMes§ges
();

62 
¡®lMes§ge
(cÚ¡ 
Add»ss
& 
addr
);

65 
boŞ
 
	$isR—dy
() const;

68 
	$d–ayH—d
()

70 
Mes§geBufãrNode
 
node
 = 
m_´io_h—p
.
	`äÚt
();

71 
¡d
::
	`pİ_h—p
(
m_´io_h—p
.
	`begš
(), m_´io_h—p.
	`’d
(),

72 
¡d
::
g»©”
<
Mes§geBufãrNode
>());

73 
m_´io_h—p
.
	`pİ_back
();

74 
	`’queue
(
node
.
m_msg±r
, 
	`Cyşes
(1));

75 
	}
}

77 
boŞ
 
¬eNSlÙsAvaabË
(
n
);

78 
	$g‘PriÜ™y
(è{  
m_´iÜ™y_¿nk
; 
	}
}

79 
	$£tPriÜ™y
(
¿nk
è{ 
m_´iÜ™y_¿nk
 =„ªk; 
	}
}

80 
	$£tCÚsum”
(
CÚsum”
* 
cÚsum”
)

82 ià(
m_cÚsum”
 !ğ
NULL
) {

83 
	`çl
("Tryingo connect %so MessageBuffer %s. \
\n%s‡lready connected. Checkhe cntrl_id's.\n",

85 *
cÚsum”
, *
this
, *
m_cÚsum”
);

87 
m_cÚsum”
 = 
cÚsum”
;

88 
	}
}

90 
	$£tS’d”
(
ClockedObjeù
* 
obj
)

92 
	`as£¹
(
m_£nd”
 =ğ
NULL
 || m_£nd” =ğ
obj
);

93 
m_£nd”
 = 
obj
;

94 
	}
}

96 
	$£tReûiv”
(
ClockedObjeù
* 
obj
)

98 
	`as£¹
(
m_»ûiv”
 =ğ
NULL
 || m_»ûiv” =ğ
obj
);

99 
m_»ûiv”
 = 
obj
;

100 
	}
}

102 
£tDesütiÚ
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
è{ 
m_Çme
 =‚ame; }

103 
	g¡d
::
¡ršg
 
	$g‘DesütiÚ
(è{  
m_Çme
;
	}
}

105 
CÚsum”
* 
	$g‘CÚsum”
(è{  
m_cÚsum”
; 
	}
}

107 cÚ¡ 
Mes§ge
* 
	$³ekAtH—dOfQueue
() const;

108 cÚ¡ 
Mes§ge
* 
	$³ek
(ècÚ¡ {  
	`³ekAtH—dOfQueue
(); 
	}
}

109 cÚ¡ 
MsgPŒ
 
	$g‘MsgPŒCİy
() const;

111 cÚ¡ 
MsgPŒ
&

112 
	$³ekMsgPŒ
() const

114 
	`as£¹
(
	`isR—dy
());

115  
m_´io_h—p
.
	`äÚt
().
m_msg±r
;

116 
	}
}

118 cÚ¡ 
	gMsgPŒ
&

119 
	$³ekMsgPŒEv’IfNÙR—dy
() const

121  
m_´io_h—p
.
	`äÚt
().
m_msg±r
;

122 
	}
}

124 
	$’queue
(
MsgPŒ
 
mes§ge
è{ 
	`’queue
(mes§ge, 
	`Cyşes
(1)); 
	}
}

125 
’queue
(
MsgPŒ
 
mes§ge
, 
Cyşes
 
d–
);

128 
Cyşes
 
dequeue_g‘D–ayCyşes
(
MsgPŒ
& 
mes§ge
);

129 
dequeue
(
MsgPŒ
& 
mes§ge
);

132 
Cyşes
 
dequeue_g‘D–ayCyşes
();

133 
	$dequeue
(è{ 
	`pİ
(); 
	}
}

134 
pİ
();

135 
»cyşe
();

136 
boŞ
 
	$isEm±y
(ècÚ¡ {  
m_´io_h—p
.
	`size
(è=ğ0; 
	}
}

139 
	$£tOrd”šg
(
boŞ
 
Üd”
)

141 
m_¡riù_fifo
 = 
Üd”
;

142 
m_Üd”šg_£t
 = 
Œue
;

143 
	}
}

144 
	$»size
(
size
è{ 
m_max_size
 = size; 
	}
}

145 
g‘Size
();

146 
	$£tRªdomiz©iÚ
(
boŞ
 
¿ndom_æag
è{ 
m_¿ndomiz©iÚ
 =„ªdom_æag; 
	}
}

148 
ş—r
();

150 
´št
(
¡d
::
o¡»am
& 
out
) const;

151 
´štSts
(
¡d
::
o¡»am
& 
out
);

152 
	$ş—rSts
(è{ 
m_nÙ_ava_couÁ
 = 0; 
m_msg_couÁ”
 = 0; 
	}
}

154 
	$£tIncomšgLšk
(
lšk_id
è{ 
m_šput_lšk_id
 =†šk_id; 
	}
}

155 
	$£tVÃt
(
Ãt
è{ 
m_vÃt_id
 =‚‘; 
	}
}

160 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *
pkt
);

166 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

168 
	g´iv©e
:

170 
Cyşes
 
m_»cyşe_Ï‹ncy
;

173 
Cyşes
 
£tAndR‘uºD–ayCyşes
(
MsgPŒ
 
mes§ge
);

176 
Mes§geBufãr
(cÚ¡ Mes§geBufãr& 
obj
);

177 
	gMes§geBufãr
& 
	gİ”©Ü
=(cÚ¡ 
Mes§geBufãr
& 
obj
);

181 
ClockedObjeù
* 
	gm_£nd”
;

182 
ClockedObjeù
* 
	gm_»ûiv”
;

185 
CÚsum”
* 
	gm_cÚsum”
;

186 
	g¡d
::
veùÜ
<
Mes§geBufãrNode
> 
m_´io_h—p
;

190 
	g¡d
::
	tm­
< 
	tAdd»ss
, 
	t¡d
::
	tli¡
<
	tMsgPŒ
> > 
	tSÎMsgM­Ty³
;

191 
	g¡d
::
	tveùÜ
<
	tMsgPŒ
>::
	t™”©Ü
 
	tMsgLi¡I‹r
;

193 
SÎMsgM­Ty³
 
	gm_¡®l_msg_m­
;

194 
	g¡d
::
¡ršg
 
m_Çme
;

196 
	gm_max_size
;

197 
Cyşes
 
	gm_time_Ï¡_time_size_checked
;

198 
	gm_size_Ï¡_time_size_checked
;

202 
Cyşes
 
	gm_time_Ï¡_time_’queue
;

203 
Cyşes
 
	gm_time_Ï¡_time_pİ
;

204 
	gm_size_©_cyşe_¡¬t
;

205 
	gm_msgs_this_cyşe
;

207 
	gm_nÙ_ava_couÁ
;

209 
ušt64
 
	gm_msg_couÁ”
;

210 
	gm_´iÜ™y_¿nk
;

211 
boŞ
 
	gm_¡riù_fifo
;

212 
boŞ
 
	gm_Üd”šg_£t
;

213 
boŞ
 
	gm_¿ndomiz©iÚ
;

215 
Tick
 
	gm_Ï¡_¬riv®_time
;

217 
	gm_šput_lšk_id
;

218 
	gm_vÃt_id
;

221 
Cyşes
 
¿ndom_time
();

223 
šlše
 
	g¡d
::
o¡»am
&

224 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gMes§geBufãr
& 
	gobj
)

226 
	gobj
.
´št
(
out
);

227 
	gout
 << 
	g¡d
::
æush
;

228  
	gout
;

	@ruby/buffers/MessageBufferNode.cc

29 
	~"mem/ruby/bufãrs/Mes§geBufãrNode.hh
"

32 
	gMes§geBufãrNode
::
´št
(
¡d
::
o¡»am
& 
out
) const

34 
out
 << "[";

35 
	gout
 << 
	gm_time
 << ", ";

36 
	gout
 << 
	gm_msg_couÁ”
 << ", ";

37 
	gout
 << *
	gm_msg±r
 << "; ";

38 
	gout
 << "]";

	@ruby/buffers/MessageBufferNode.hh

29 #iâdeà
__MEM_RUBY_BUFFERS_MESSAGEBUFFERNODE_HH__


30 
	#__MEM_RUBY_BUFFERS_MESSAGEBUFFERNODE_HH__


	)

32 
	~<io¡»am
>

34 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

36 şas 
	cMes§geBufãrNode


38 
	mpublic
:

39 
	$Mes§geBufãrNode
()

40 : 
	`m_time
(0), 
	$m_msg_couÁ”
(0)

43 
	$Mes§geBufãrNode
(cÚ¡ 
Tick
 
time
, 
ušt64_t
 
couÁ”
,

44 cÚ¡ 
MsgPŒ
& 
msg±r
)

45 : 
	`m_time
(
time
), 
	`m_msg_couÁ”
(
couÁ”
), 
	$m_msg±r
(
msg±r
)

46 {
	}
}

48 
´št
(
¡d
::
o¡»am
& 
out
) const;

50 
	gpublic
:

51 
Tick
 
m_time
;

52 
ušt64_t
 
	gm_msg_couÁ”
;

53 
MsgPŒ
 
	gm_msg±r
;

56 
šlše
 
boŞ


57 
	gİ”©Ü
>(cÚ¡ 
	gMes§geBufãrNode
& 
	gn1
, cÚ¡ Mes§geBufãrNode& 
	gn2
)

59 ià(
	gn1
.
	gm_time
 =ğ
n2
.
m_time
) {

60 
as£¹
(
n1
.
m_msg_couÁ”
 !ğ
n2
.m_msg_counter);

61  
	gn1
.
	gm_msg_couÁ”
 > 
	gn2
.m_msg_counter;

63  
	gn1
.
	gm_time
 > 
	gn2
.m_time;

67 
šlše
 
	g¡d
::
o¡»am
&

68 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gMes§geBufãrNode
& 
	gobj
)

70 
	gobj
.
´št
(
out
);

71 
	gout
 << 
	g¡d
::
æush
;

72  
	gout
;

	@ruby/common/Address.cc

29 
	~"¬ch/i§_Œa™s.hh
"

30 
	~"cÚfig/the_i§.hh
"

31 
	~"mem/ruby/commÚ/Add»ss.hh
"

32 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

34 
physiÿl_add»ss_t


35 
	gAdd»ss
::
	$g‘LšeAdd»ss
() const

37  
	`b™S–eù
(
RubySy¡em
::
	`g‘BlockSizeB™s
(), 
ADDRESS_WIDTH
);

38 
	}
}

40 
physiÿl_add»ss_t


41 
	gAdd»ss
::
	$g‘Off£t
() const

43  
	`b™S–eù
(0, 
RubySy¡em
::
	`g‘BlockSizeB™s
() - 1);

44 
	}
}

47 
	gAdd»ss
::
	$makeLšeAdd»ss
()

49 
m_add»ss
 = 
	`maskLowOrd”B™s
(
RubySy¡em
::
	`g‘BlockSizeB™s
());

50 
	}
}

54 
	gAdd»ss
::
	$makeNextSŒideAdd»ss
(
¡ride
)

56 
m_add»ss
 = 
	`maskLowOrd”B™s
(
RubySy¡em
::
	`g‘BlockSizeB™s
())

57 + 
RubySy¡em
::
	`g‘BlockSizeBy‹s
()*
¡ride
;

58 
	}
}

60 
Index


61 
	gAdd»ss
::
	$memÜyModuËIndex
() const

63 
Index
 
šdex
 =

64 
	`b™S–eù
(
RubySy¡em
::
	`g‘BlockSizeB™s
() +

65 
RubySy¡em
::
	`g‘MemÜySizeB™s
(), 
ADDRESS_WIDTH
);

66 
	`as£¹
 (
šdex
 >= 0);

67  
šdex
;

92 
	}
}

95 
	gAdd»ss
::
´št
(
¡d
::
o¡»am
& 
out
) const

97 
usšg
 
Çme¥aû
 
¡d
;

98 
	gout
 << "[" << 
	ghex
 << "0x" << 
	gm_add»ss
 << "," << "†ine 0x"

99 << 
maskLowOrd”B™s
(
RubySy¡em
::
g‘BlockSizeB™s
()è<< 
dec
 << "]"

100 << 
æush
;

104 
	gAdd»ss
::
ouut
(
¡d
::
o¡»am
& 
out
) const

110 
out
 << 
¡d
::
hex
 << 
m_add»ss
 << std::
dec
;

114 
	gAdd»ss
::
šput
(
¡d
::
i¡»am
& 
š
)

120 
š
 >> 
¡d
::
hex
 >> 
m_add»ss
 >> std::
dec
;

123 
	gAdd»ss
::
	$Add»ss
(cÚ¡ 
Add»ss
& 
obj
)

125 
m_add»ss
 = 
obj
.m_address;

126 
	}
}

128 
	gAdd»ss
&

129 
	gAdd»ss
::
İ”©Ü
=(cÚ¡ 
Add»ss
& 
obj
)

131 ià(
this
 =ğ&
obj
) {

134 
m_add»ss
 = 
obj
.m_address;

136  *
	gthis
;

140 
	gAdd»ss
::
	$makePageAdd»ss
()

142 
m_add»ss
 = 
	`maskLowOrd”B™s
(
TheISA
::
LogVMPageSize
);

143 
	}
}

145 
Add»ss


146 
	$·ge_add»ss
(cÚ¡ 
Add»ss
& 
addr
)

148 
Add»ss
 
‹mp
 = 
addr
;

149 
‹mp
.
	`makePageAdd»ss
();

150  
‹mp
;

151 
	}
}

153 
Add»ss


154 
	$Ãxt_¡ride_add»ss
(cÚ¡ 
Add»ss
& 
addr
, 
¡ride
)

156 
Add»ss
 
‹mp
 = 
addr
;

157 
‹mp
.
	`makeNextSŒideAdd»ss
(
¡ride
);

158  
‹mp
;

159 
	}
}

	@ruby/common/Address.hh

29 #iâdeà
__MEM_RUBY_COMMON_ADDRESS_HH__


30 
	#__MEM_RUBY_COMMON_ADDRESS_HH__


	)

32 
	~<ÿs£¹
>

33 
	~<iomª
>

34 
	~<io¡»am
>

36 
	~"ba£/hashm­.hh
"

37 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

39 cÚ¡ 
ušt32_t
 
	gADDRESS_WIDTH
 = 64;

41 
şass
 
	gAdd»ss
;

42 
Add»ss
 
	tPhysAdd»ss
;

43 
Add»ss
 
	tVœtAdd»ss
;

45 şas 
	cAdd»ss


47 
	mpublic
:

48 
	$Add»ss
()

49 : 
	$m_add»ss
(0)

52 
ex¶ic™


53 
	$Add»ss
(
physiÿl_add»ss_t
 
add»ss
)

54 : 
	$m_add»ss
(
add»ss
)

55 { 
	}
}

57 
Add»ss
(cÚ¡ Add»ss& 
obj
);

58 
	gAdd»ss
& 
	gİ”©Ü
=(cÚ¡ 
Add»ss
& 
obj
);

60 
	$£tAdd»ss
(
physiÿl_add»ss_t
 
add»ss
è{ 
m_add»ss
 =‡dd»ss; 
	}
}

61 
physiÿl_add»ss_t
 
	$g‘Add»ss
(ècÚ¡ { 
m_add»ss
;
	}
}

63 
physiÿl_add»ss_t
 
	$b™S–eù
(
sm®l
, 
big
) const;

64 
physiÿl_add»ss_t
 
	$b™Remove
(
sm®l
, 
big
) const;

65 
physiÿl_add»ss_t
 
	$maskLowOrd”B™s
(
numb”
) const;

66 
physiÿl_add»ss_t
 
	$maskHighOrd”B™s
(
numb”
) const;

67 
physiÿl_add»ss_t
 
	$shiáLowOrd”B™s
(
numb”
) const;

69 
physiÿl_add»ss_t
 
	$g‘LšeAdd»ss
() const;

70 
physiÿl_add»ss_t
 
	$g‘Off£t
() const;

71 
	`makeLšeAdd»ss
();

72 
	`makePageAdd»ss
();

73 
	`makeNextSŒideAdd»ss
(
¡ride
);

75 
Index
 
	$memÜyModuËIndex
() const;

77 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

78 
	`ouut
(
¡d
::
o¡»am
& 
out
) const;

79 
	`šput
(
¡d
::
i¡»am
& 
š
);

82 
	$£tOff£t
(
off£t
)

85 
	`makeLšeAdd»ss
();

86 
m_add»ss
 |ğ(
physiÿl_add»ss_t
è
off£t
;

87 
	}
}

89 
	g´iv©e
:

90 
physiÿl_add»ss_t
 
m_add»ss
;

93 
šlše
 
Add»ss


94 
	$lše_add»ss
(cÚ¡ 
Add»ss
& 
addr
)

96 
Add»ss
 
	`‹mp
(
addr
);

97 
‹mp
.
	`makeLšeAdd»ss
();

98  
‹mp
;

99 
	}
}

101 
šlše
 
boŞ


102 
	gİ”©Ü
<(cÚ¡ 
	gAdd»ss
& 
	gobj1
, cÚ¡ Add»ss& 
	gobj2
)

104  
	gobj1
.
g‘Add»ss
(è< 
	gobj2
.getAddress();

107 
šlše
 
	g¡d
::
o¡»am
&

108 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gAdd»ss
& 
	gobj
)

110 
	gobj
.
´št
(
out
);

111 
	gout
 << 
	g¡d
::
æush
;

112  
	gout
;

115 
šlše
 
boŞ


116 
	gİ”©Ü
==(cÚ¡ 
Add»ss
& 
obj1
, cÚ¡ 
	gAdd»ss
& 
	gobj2
)

118  (
	gobj1
.
g‘Add»ss
(è=ğ
obj2
.getAddress());

121 
šlše
 
boŞ


122 
	gİ”©Ü
!=(cÚ¡ 
Add»ss
& 
obj1
, cÚ¡ 
	gAdd»ss
& 
	gobj2
)

124  (
	gobj1
.
g‘Add»ss
(è!ğ
obj2
.getAddress());

128 
šlše
 
physiÿl_add»ss_t


129 
	gAdd»ss
::
	$b™S–eù
(
sm®l
, 
big
) const

131 
physiÿl_add»ss_t
 
mask
;

132 
	`as£¹
(
big
 >ğ
sm®l
);

134 ià(
big
 >ğ
ADDRESS_WIDTH
 - 1) {

135  (
m_add»ss
 >> 
sm®l
);

137 
mask
 = ~((
physiÿl_add»ss_t
)~0 << (
big
 + 1));

139 
physiÿl_add»ss_t
 
·¹Ÿl
 = (
m_add»ss
 & 
mask
);

140  (
·¹Ÿl
 >> 
sm®l
);

142 
	}
}

145 
šlše
 
physiÿl_add»ss_t


146 
	gAdd»ss
::
	$b™Remove
(
sm®l
, 
big
) const

148 
physiÿl_add»ss_t
 
mask
;

149 
	`as£¹
(
big
 >ğ
sm®l
);

151 ià(
sm®l
 >ğ
ADDRESS_WIDTH
 - 1) {

152  
m_add»ss
;

153 } ià(
big
 >ğ
ADDRESS_WIDTH
 - 1) {

154 
mask
 = (
physiÿl_add»ss_t
)~0 >> 
sm®l
;

155  (
m_add»ss
 & 
mask
);

156 } ià(
sm®l
 == 0) {

157 
mask
 = (
physiÿl_add»ss_t
)~0 << 
big
;

158  (
m_add»ss
 & 
mask
);

160 
mask
 = ~((
physiÿl_add»ss_t
)~0 << 
sm®l
);

161 
physiÿl_add»ss_t
 
low”_b™s
 = 
m_add»ss
 & 
mask
;

162 
mask
 = (
physiÿl_add»ss_t
)~0 << (
big
 + 1);

163 
physiÿl_add»ss_t
 
high”_b™s
 = 
m_add»ss
 & 
mask
;

166 
high”_b™s
 = high”_b™ >> (
big
 - 
sm®l
 + 1);

167  (
high”_b™s
 | 
low”_b™s
);

169 
	}
}

171 
šlše
 
physiÿl_add»ss_t


172 
	gAdd»ss
::
	$maskLowOrd”B™s
(
numb”
) const

174 
physiÿl_add»ss_t
 
mask
;

176 ià(
numb”
 >ğ
ADDRESS_WIDTH
 - 1) {

177 
mask
 = ~0;

179 
mask
 = (
physiÿl_add»ss_t
)~0 << 
numb”
;

181  (
m_add»ss
 & 
mask
);

182 
	}
}

184 
šlše
 
physiÿl_add»ss_t


185 
	gAdd»ss
::
	$maskHighOrd”B™s
(
numb”
) const

187 
physiÿl_add»ss_t
 
mask
;

189 ià(
numb”
 >ğ
ADDRESS_WIDTH
 - 1) {

190 
mask
 = ~0;

192 
mask
 = (
physiÿl_add»ss_t
)~0 >> 
numb”
;

194  (
m_add»ss
 & 
mask
);

195 
	}
}

197 
šlše
 
physiÿl_add»ss_t


198 
	gAdd»ss
::
	$shiáLowOrd”B™s
(
numb”
) const

200  (
m_add»ss
 >> 
numb”
);

201 
	}
}

203 
Add»ss
 
Ãxt_¡ride_add»ss
(cÚ¡ Add»ss& 
addr
, 
¡ride
);

204 
Add»ss
 
·ge_add»ss
(cÚ¡ Add»ss& 
addr
);

206 
__hash_Çme¥aû_begš


207 
	g‹m¶©e
 <> 
	ghash
<
	gAdd»ss
>

209 
size_t


210 
İ”©Ü
()(cÚ¡ 
	gAdd»ss
 &
	gs
) const

212  (
	gsize_t
)
	gs
.
g‘Add»ss
();

215 
__hash_Çme¥aû_’d


217 
Çme¥aû
 
	g¡d
 {

218 
	g‹m¶©e
 <> 
	gequ®_to
<
	gAdd»ss
>

220 
boŞ


221 
İ”©Ü
()(cÚ¡ 
	gAdd»ss
& 
	gs1
, cÚ¡ Add»ss& 
	gs2
) const

223  
	gs1
 =ğ
s2
;

	@ruby/common/Consumer.cc

29 
	~"mem/ruby/commÚ/CÚsum”.hh
"

32 
	gCÚsum”
::
	$scheduËEv’t
(
Cyşes
 
timeD–
)

34 
	`scheduËEv’tAbsŞu‹
(
em
->
	`şockEdge
(
timeD–
));

35 
	}
}

38 
	gCÚsum”
::
	$scheduËEv’tAbsŞu‹
(
Tick
 
evt_time
)

40 ià(!
	`®»adyScheduËd
(
evt_time
)) {

42 
CÚsum”Ev’t
 *
evt
 = 
Ãw
 
	`CÚsum”Ev’t
(
this
);

43 
em
->
	`scheduË
(
evt
, 
evt_time
);

44 
	`š£¹ScheduËdWakeupTime
(
evt_time
);

46 
	}
}

	@ruby/common/Consumer.hh

35 #iâdeà
__MEM_RUBY_COMMON_CONSUMER_HH__


36 
	#__MEM_RUBY_COMMON_CONSUMER_HH__


	)

38 
	~<io¡»am
>

39 
	~<£t
>

41 
	~"sim/şocked_objeù.hh
"

43 şas 
	cCÚsum”


45 
	mpublic
:

46 
	$CÚsum”
(
ClockedObjeù
 *
_em
)

47 : 
	`m_Ï¡_scheduËd_wakeup
(0), 
	$em
(
_em
)

51 
vœtu®


52 ~
	$CÚsum”
()

53 { 
	}
}

55 
vœtu®
 
wakeup
() = 0;

56 
vœtu®
 
´št
(
¡d
::
o¡»am
& 
out
) const = 0;

57 
vœtu®
 
	$¡ÜeEv’tInfo
(
šfo
è{
	}
}

59 cÚ¡ 
	gTick
&

60 
	$g‘La¡ScheduËdWakeup
() const

62  
m_Ï¡_scheduËd_wakeup
;

63 
	}
}

66 
	$£tLa¡ScheduËdWakeup
(cÚ¡ 
Tick
& 
time
)

68 
m_Ï¡_scheduËd_wakeup
 = 
time
;

69 
	}
}

71 
boŞ


72 
	$®»adyScheduËd
(
Tick
 
time
)

74  
m_scheduËd_wakeups
.
	`fšd
(
time
è!ğm_scheduËd_wakeups.
	`’d
();

75 
	}
}

78 
	$š£¹ScheduËdWakeupTime
(
Tick
 
time
)

80 
m_scheduËd_wakeups
.
	`š£¹
(
time
);

81 
	}
}

84 
	$»moveScheduËdWakeupTime
(
Tick
 
time
)

86 
	`as£¹
(
	`®»adyScheduËd
(
time
));

87 
m_scheduËd_wakeups
.
	`”a£
(
time
);

88 
	}
}

90 
scheduËEv’tAbsŞu‹
(
Tick
 
timeAbs
);

92 
	g´Ùeùed
:

93 
scheduËEv’t
(
Cyşes
 
timeD–
);

95 
	g´iv©e
:

96 
Tick
 
m_Ï¡_scheduËd_wakeup
;

97 
	g¡d
::
£t
<
Tick
> 
m_scheduËd_wakeups
;

98 
ClockedObjeù
 *
	gem
;

100 şas 
	cCÚsum”Ev’t
 : 
public
 
Ev’t


102 
public
:

103 
CÚsum”Ev’t
(
CÚsum”
* 
_cÚsum”
)

104 : 
Ev’t
(
DeçuÉ_Pri
, 
AutoD–‘e
), 
m_cÚsum”_±r
(
_cÚsum”
)

108 
´oûss
()

110 
	gm_cÚsum”_±r
->
wakeup
();

111 
	gm_cÚsum”_±r
->
»moveScheduËdWakeupTime
(
wh’
());

114 
	g´iv©e
:

115 
CÚsum”
* 
m_cÚsum”_±r
;

119 
šlše
 
	g¡d
::
o¡»am
&

120 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gCÚsum”
& 
	gobj
)

122 
	gobj
.
´št
(
out
);

123 
	gout
 << 
	g¡d
::
æush
;

124  
	gout
;

	@ruby/common/DataBlock.cc

29 
	~"mem/ruby/commÚ/D©aBlock.hh
"

30 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

32 
	gD©aBlock
::
	$D©aBlock
(cÚ¡ 
D©aBlock
 &
ı
)

34 
m_d©a
 = 
Ãw
 
ušt8_t
[
RubySy¡em
::
	`g‘BlockSizeBy‹s
()];

35 
	`memıy
(
m_d©a
, 
ı
.m_d©a, 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

36 
m_®loc
 = 
Œue
;

37 
	}
}

40 
	gD©aBlock
::
	$®loc
()

42 
m_d©a
 = 
Ãw
 
ušt8_t
[
RubySy¡em
::
	`g‘BlockSizeBy‹s
()];

43 
m_®loc
 = 
Œue
;

44 
	`ş—r
();

45 
	}
}

48 
	gD©aBlock
::
	$ş—r
()

50 
	`mem£t
(
m_d©a
, 0, 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

51 
	}
}

53 
boŞ


54 
	gD©aBlock
::
	$equ®
(cÚ¡ 
D©aBlock
& 
obj
) const

56  !
	`memcmp
(
m_d©a
, 
obj
.m_d©a, 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

57 
	}
}

60 
	gD©aBlock
::
´št
(
¡d
::
o¡»am
& 
out
) const

62 
usšg
 
Çme¥aû
 
¡d
;

64 
	gsize
 = 
RubySy¡em
::
g‘BlockSizeBy‹s
();

65 
	gout
 << "[ ";

66 
	gi
 = 0; i < 
	gsize
; i++) {

67 
	gout
 << 
£tw
(2è<< 
£tfl
('0'è<< 
	ghex
 << "0x" << ()
	gm_d©a
[
i
] << " ";

68 
	gout
 << 
£tfl
(' ');

70 
	gout
 << 
	gdec
 << "]" << 
	gæush
;

73 cÚ¡ 
ušt8_t
*

74 
	gD©aBlock
::
	$g‘D©a
(
off£t
, 
Ën
) const

76 
	`as£¹
(
off£t
 + 
Ën
 <ğ
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

77  &
m_d©a
[
off£t
];

78 
	}
}

81 
	gD©aBlock
::
	$£tD©a
(
ušt8_t
 *
d©a
, 
off£t
, 
Ën
)

83 
	`as£¹
(
off£t
 + 
Ën
 <ğ
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

84 
	`memıy
(&
m_d©a
[
off£t
], 
d©a
, 
Ën
);

85 
	}
}

87 
	gD©aBlock
 &

88 
	gD©aBlock
::
İ”©Ü
=(cÚ¡ 
D©aBlock
 & 
obj
)

90 
memıy
(
m_d©a
, 
obj
.m_d©a, 
RubySy¡em
::
g‘BlockSizeBy‹s
());

91  *
	gthis
;

	@ruby/common/DataBlock.hh

29 #iâdeà
__MEM_RUBY_COMMON_DATABLOCK_HH__


30 
	#__MEM_RUBY_COMMON_DATABLOCK_HH__


	)

32 
	~<š‰y³s.h
>

34 
	~<ÿs£¹
>

35 
	~<iomª
>

36 
	~<io¡»am
>

38 şas 
	cD©aBlock


40 
	mpublic
:

41 
	$D©aBlock
()

43 
	`®loc
();

46 
	`D©aBlock
(cÚ¡ 
D©aBlock
 &
ı
);

48 ~
	$D©aBlock
()

50 ià(
m_®loc
)

51 
d–‘e
 [] 
m_d©a
;

52 
	}
}

54 
	gD©aBlock
& 
	gİ”©Ü
=(cÚ¡ 
D©aBlock
& 
obj
);

56 
assign
(
ušt8_t
 *
d©a
);

58 
ş—r
();

59 
ušt8_t
 
	$g‘By‹
(
whichBy‹
) const;

60 cÚ¡ 
ušt8_t
 *
	$g‘D©a
(
off£t
, 
Ën
) const;

61 
	`£tBy‹
(
whichBy‹
, 
ušt8_t
 
d©a
);

62 
	`£tD©a
(
ušt8_t
 *
d©a
, 
off£t
, 
Ën
);

63 
	`cİyP¬tŸl
(cÚ¡ 
D©aBlock
 & 
dblk
, 
off£t
, 
Ën
);

64 
boŞ
 
	$equ®
(cÚ¡ 
D©aBlock
& 
obj
) const;

65 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

67 
´iv©e
:

68 
	`®loc
();

69 
ušt8_t
 *
m_d©a
;

70 
boŞ
 
m_®loc
;

71 
	}
};

73 
šlše
 

74 
	gD©aBlock
::
	$assign
(
ušt8_t
 *
d©a
)

76 
	`as£¹
(
d©a
 !ğ
NULL
);

77 ià(
m_®loc
) {

78 
d–‘e
 [] 
m_d©a
;

80 
m_d©a
 = 
d©a
;

81 
m_®loc
 = 
çl£
;

82 
	}
}

84 
šlše
 
ušt8_t


85 
	gD©aBlock
::
	$g‘By‹
(
whichBy‹
) const

87  
m_d©a
[
whichBy‹
];

88 
	}
}

90 
šlše
 

91 
	gD©aBlock
::
	$£tBy‹
(
whichBy‹
, 
ušt8_t
 
d©a
)

93 
m_d©a
[
whichBy‹
] = 
d©a
;

94 
	}
}

96 
šlše
 

97 
	gD©aBlock
::
	$cİyP¬tŸl
(cÚ¡ 
D©aBlock
 & 
dblk
, 
off£t
, 
Ën
)

99 
	`£tD©a
(&
dblk
.
m_d©a
[
off£t
], off£t, 
Ën
);

100 
	}
}

102 
šlše
 
	g¡d
::
o¡»am
&

103 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gD©aBlock
& 
	gobj
)

105 
	gobj
.
´št
(
out
);

106 
	gout
 << 
	g¡d
::
æush
;

107  
	gout
;

110 
šlše
 
boŞ


111 
	gİ”©Ü
==(cÚ¡ 
D©aBlock
& 
obj1
,cÚ¡ 
	gD©aBlock
& 
	gobj2
)

113  
	gobj1
.
equ®
(
obj2
);

	@ruby/common/Global.cc

29 
	~"mem/ruby/commÚ/Glob®.hh
"

31 
usšg
 
Çme¥aû
 
	g¡d
;

33 
RubySy¡em
* 
	gg_sy¡em_±r
 = 0;

34 
	gveùÜ
<
	gm­
<
	gušt32_t
, 
	gAb¡¿ùCÚŒŞËr
 *> > 
	gg_abs_cÚŒŞs
;

35 
Cyşes
 
	gg_ruby_¡¬t
;

	@ruby/common/Global.hh

29 #iâdeà
__MEM_RUBY_COMMON_GLOBAL_HH__


30 
	#__MEM_RUBY_COMMON_GLOBAL_HH__


	)

32 
	~<m­
>

33 
	~<veùÜ
>

35 
	~"ba£/¡r.hh
"

36 
	~"ba£/ty³s.hh
"

38 
şass
 
	gRubySy¡em
;

39 
RubySy¡em
* 
g_sy¡em_±r
;

41 
şass
 
	gAb¡¿ùCÚŒŞËr
;

42 
¡d
::
veùÜ
<¡d::
m­
<
ušt32_t
, 
Ab¡¿ùCÚŒŞËr
 *> > 
g_abs_cÚŒŞs
;

46 
Cyşes
 
g_ruby_¡¬t
;

	@ruby/common/Histogram.cc

29 
	~<cm©h
>

30 
	~<iomª
>

32 
	~"ba£/štm©h.hh
"

33 
	~"mem/ruby/commÚ/Hi¡og¿m.hh
"

35 
usšg
 
Çme¥aû
 
	g¡d
;

37 
	gHi¡og¿m
::
	$Hi¡og¿m
(
bšsize
, 
ušt32_t
 
bšs
)

39 
m_bšsize
 = 
bšsize
;

40 
	`ş—r
(
bšs
);

41 
	}
}

43 
	gHi¡og¿m
::~
	$Hi¡og¿m
()

45 
	}
}

48 
Hi¡og¿m
::
	$ş—r
(
bšsize
, 
ušt32_t
 
bšs
)

50 
m_bšsize
 = 
bšsize
;

51 
	`ş—r
(
bšs
);

52 
	}
}

55 
	gHi¡og¿m
::
	$ş—r
(
ušt32_t
 
bšs
)

57 
m_Ïrge¡_bš
 = 0;

58 
m_max
 = 0;

59 
m_d©a
.
	`»size
(
bšs
);

60 
ušt32_t
 
i
 = 0; i < 
bšs
; i++) {

61 
m_d©a
[
i
] = 0;

64 
m_couÁ
 = 0;

65 
m_max
 = 0;

66 
m_sumSam¶es
 = 0;

67 
m_sumSqu¬edSam¶es
 = 0;

68 
	}
}

71 
	gHi¡og¿m
::
	$doubËBšSize
()

73 
	`as£¹
(
m_bšsize
 != -1);

74 
ušt32_t
 
t_bšs
 = 
m_d©a
.
	`size
();

76 
ušt32_t
 
i
 = 0; i < 
t_bšs
/2; i++) {

77 
m_d©a
[
i
] = m_data[i*2] + m_data[i*2 + 1];

79 
ušt32_t
 
i
 = 
t_bšs
/2; i <_bins; i++) {

80 
m_d©a
[
i
] = 0;

83 
m_bšsize
 *= 2;

84 
	}
}

87 
	gHi¡og¿m
::
	$add
(
št64
 
v®ue
)

89 
	`as£¹
(
v®ue
 >= 0);

90 
m_max
 = 
	`max
(m_max, 
v®ue
);

91 
m_couÁ
++;

93 
m_sumSam¶es
 +ğ
v®ue
;

94 
m_sumSqu¬edSam¶es
 +ğ(
v®ue
*value);

96 
ušt32_t
 
šdex
;

98 ià(
m_bšsize
 == -1) {

100 ià(
v®ue
 == 0) {

101 
šdex
 = 0;

103 
šdex
 = 
	`æoÜLog2
(
v®ue
) + 1;

104 ià(
šdex
 >ğ
m_d©a
.
	`size
()) {

105 
šdex
 = 
m_d©a
.
	`size
() - 1;

110 
ušt32_t
 
t_bšs
 = 
m_d©a
.
	`size
();

112 
m_max
 >ğ(
t_bšs
 * 
m_bšsize
)è
	`doubËBšSize
();

113 
šdex
 = 
v®ue
/
m_bšsize
;

116 
	`as£¹
(
šdex
 < 
m_d©a
.
	`size
());

117 
m_d©a
[
šdex
]++;

118 
m_Ïrge¡_bš
 = 
	`max
(m_Ïrge¡_bš, 
šdex
);

119 
	}
}

122 
	gHi¡og¿m
::
	$add
(
Hi¡og¿m
& 
hi¡
)

124 
ušt32_t
 
t_bšs
 = 
m_d©a
.
	`size
();

126 ià(
hi¡
.
	`g‘Bšs
(è!ğ
t_bšs
) {

127 ià(
m_couÁ
 == 0) {

128 
m_d©a
.
	`»size
(
hi¡
.
	`g‘Bšs
());

130 
	`çl
("Histograms with different‚umber of bins "

135 
m_max
 = 
	`max
(m_max, 
hi¡
.
	`g‘Max
());

136 
m_couÁ
 +ğ
hi¡
.
	`size
();

137 
m_sumSam¶es
 +ğ
hi¡
.
	`g‘TÙ®
();

138 
m_sumSqu¬edSam¶es
 +ğ
hi¡
.
	`g‘Squ¬edTÙ®
();

141 ià(
hi¡
.
	`g‘BšSize
(è=ğ-1 && 
m_bšsize
 == -1) {

142 
j
 = 0; j < 
hi¡
.
	`g‘D©a
(0); j++) {

143 
	`add
(0);

146 
ušt32_t
 
i
 = 1; i < 
t_bšs
; i++) {

147 
j
 = 0; j < 
hi¡
.
	`g‘D©a
(
i
); j++) {

148 
	`add
(1<<(
i
-1));

151 } ià(
hi¡
.
	`g‘BšSize
(è>ğ1 && 
m_bšsize
 >= 1) {

156 
m_bšsize
 > 
hi¡
.
	`g‘BšSize
()èhi¡.
	`doubËBšSize
();

157 
hi¡
.
	`g‘BšSize
(è> 
m_bšsize
è
	`doubËBšSize
();

159 
	`as£¹
(
m_bšsize
 =ğ
hi¡
.
	`g‘BšSize
());

161 
ušt32_t
 
i
 = 0; i < 
t_bšs
; i++) {

162 
m_d©a
[
i
] +ğ
hi¡
.
	`g‘D©a
(i);

164 ià(
m_d©a
[
i
] > 0è
m_Ïrge¡_bš
 = i;

167 
	`çl
("Don't know howo combine†og‡nd†inear histograms!");

169 
	}
}

175 
	gHi¡og¿m
::
	$g‘Snd¬dDevŸtiÚ
() const

177 ià(
m_couÁ
 <= 1)

180 
v¬Ÿnû
 =

181 ()(
m_sumSqu¬edSam¶es
 - 
m_sumSam¶es
 * m_sumSam¶e / 
m_couÁ
)

182 / (
m_couÁ
 - 1);

183  
	`sq¹
(
v¬Ÿnû
);

184 
	}
}

187 
	gHi¡og¿m
::
	$´št
(
o¡»am
& 
out
) const

189 
	`´štW™hMuÉl›r
(
out
, 1.0);

190 
	}
}

193 
	gHi¡og¿m
::
	$´štP”ûÁ
(
o¡»am
& 
out
) const

195 ià(
m_couÁ
 == 0) {

196 
	`´štW™hMuÉl›r
(
out
, 0.0);

198 
	`´štW™hMuÉl›r
(
out
, 100.0 / (
m_couÁ
));

200 
	}
}

203 
	gHi¡og¿m
::
	$´štW™hMuÉl›r
(
o¡»am
& 
out
, 
muÉl›r
) const

205 ià(
m_bšsize
 == -1) {

206 
out
 << "[binsize:†og2 ";

208 
out
 << "[bšsize: " << 
m_bšsize
 << " ";

210 
out
 << "max: " << 
m_max
 << " ";

211 
out
 << "couÁ: " << 
m_couÁ
 << " ";

213 ià(
m_couÁ
 == 0) {

214 
out
 << "average: NaN |";

215 
out
 << "standard deviation: NaN |";

217 
out
 << "av”age: " << 
	`£tw
(5è<< ((è
m_sumSam¶es
)/
m_couÁ


219 
out
 << "¡ªd¬d devŸtiÚ: " << 
	`g‘Snd¬dDevŸtiÚ
() << " |";

222 
ušt32_t
 
i
 = 0; i <ğ
m_Ïrge¡_bš
; i++) {

223 ià(
muÉl›r
 == 1.0) {

224 
out
 << " " << 
m_d©a
[
i
];

226 
out
 << " " << (
m_d©a
[
i
]è* 
muÉl›r
;

229 
out
 << " ]";

230 
	}
}

232 
boŞ


233 
	$node_Ëss_th’_eq
(cÚ¡ 
Hi¡og¿m
* 
n1
, cÚ¡ Hi¡og¿m* 
n2
)

235  (
n1
->
	`size
(è> 
n2
->size());

236 
	}
}

	@ruby/common/Histogram.hh

29 #iâdeà
__MEM_RUBY_COMMON_HISTOGRAM_HH__


30 
	#__MEM_RUBY_COMMON_HISTOGRAM_HH__


	)

32 
	~<io¡»am
>

33 
	~<veùÜ
>

35 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

37 şas 
	cHi¡og¿m


39 
	mpublic
:

40 
Hi¡og¿m
(
bšsize
 = 1, 
ušt32_t
 
bšs
 = 50);

41 ~
Hi¡og¿m
();

43 
add
(
št64
 
v®ue
);

44 
add
(
Hi¡og¿m
& 
hi¡
);

45 
doubËBšSize
();

47 
	$ş—r
(è{ 
	`ş—r
(
m_d©a
.
	`size
()); }

48 
	`ş—r
(
ušt32_t
 
bšs
);

49 
	`ş—r
(
bšsize
, 
ušt32_t
 
bšs
);

51 
ušt64_t
 
	$size
(ècÚ¡ {  
m_couÁ
; 
	}
}

52 
ušt32_t
 
	$g‘Bšs
(ècÚ¡ {  
m_d©a
.
	`size
(); 
	}
}

53 
	$g‘BšSize
(ècÚ¡ {  
m_bšsize
; 
	}
}

54 
št64
 
	$g‘TÙ®
(ècÚ¡ {  
m_sumSam¶es
; 
	}
}

55 
ušt64_t
 
	$g‘Squ¬edTÙ®
(ècÚ¡ {  
m_sumSqu¬edSam¶es
; 
	}
}

56 
ušt64_t
 
	$g‘D©a
(
šdex
ècÚ¡ {  
m_d©a
[šdex]; 
	}
}

57 
št64
 
	$g‘Max
(ècÚ¡ {  
m_max
; 
	}
}

59 
´štW™hMuÉl›r
(
¡d
::
o¡»am
& 
out
, 
muÉl›r
) const;

60 
´štP”ûÁ
(
¡d
::
o¡»am
& 
out
) const;

61 
´št
(
¡d
::
o¡»am
& 
out
) const;

63 
	g´iv©e
:

64 
¡d
::
veùÜ
<
ušt64_t
> 
m_d©a
;

65 
št64
 
	gm_max
;

66 
ušt64_t
 
	gm_couÁ
;

67 
	gm_bšsize
;

68 
ušt32_t
 
	gm_Ïrge¡_bš
;

70 
št64
 
	gm_sumSam¶es
;

71 
ušt64_t
 
	gm_sumSqu¬edSam¶es
;

73 
	$g‘Snd¬dDevŸtiÚ
() const;

74 
	}
};

76 
boŞ
 
node_Ëss_th’_eq
(cÚ¡ 
Hi¡og¿m
* 
n1
, cÚ¡ Hi¡og¿m* 
n2
);

78 
šlše
 
	g¡d
::
o¡»am
&

79 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gHi¡og¿m
& 
	gobj
)

81 
	gobj
.
´št
(
out
);

82 
	gout
 << 
	g¡d
::
æush
;

83  
	gout
;

	@ruby/common/NetDest.cc

29 
	~<®gÜ™hm
>

31 
	~"mem/ruby/commÚ/N‘De¡.hh
"

33 
	gN‘De¡
::
	$N‘De¡
()

35 
	`»size
();

36 
	}
}

39 
	gN‘De¡
::
	$add
(
MachšeID
 
ÃwEËm’t
)

41 
	`as£¹
(
	`b™Index
(
ÃwEËm’t
.
num
è< 
m_b™s
[
	`vecIndex
ÒewEËm’t)].
	`g‘Size
());

42 
m_b™s
[
	`vecIndex
(
ÃwEËm’t
)].
	`add
(
	`b™Index
ÒewEËm’t.
num
));

43 
	}
}

46 
	gN‘De¡
::
	$addN‘De¡
(cÚ¡ 
N‘De¡
& 
ÃtDe¡
)

48 
	`as£¹
(
m_b™s
.
	`size
(è=ğ
ÃtDe¡
.
	`g‘Size
());

49 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

50 
m_b™s
[
i
].
	`addS‘
(
ÃtDe¡
.m_bits[i]);

52 
	}
}

55 
	gN‘De¡
::
	$addRªdom
()

57 
i
 = 
	`¿ndom
()%
m_b™s
.
	`size
();

58 
m_b™s
[
i
].
	`addRªdom
();

59 
	}
}

62 
	gN‘De¡
::
	$£tN‘De¡
(
MachšeTy³
 
machše
, cÚ¡ 
S‘
& 
£t
)

65 
	`as£¹
(
	`MachšeTy³_ba£_Ëv–
((
MachšeTy³
)(
machše
 + 1)) -

66 
	`MachšeTy³_ba£_Ëv–
(
machše
) == 1);

67 
m_b™s
[
	`MachšeTy³_ba£_Ëv–
(
machše
)] = 
£t
;

68 
	}
}

71 
	gN‘De¡
::
	$»move
(
MachšeID
 
ŞdEËm’t
)

73 
m_b™s
[
	`vecIndex
(
ŞdEËm’t
)].
	`»move
(
	`b™Index
(ŞdEËm’t.
num
));

74 
	}
}

77 
	gN‘De¡
::
	$»moveN‘De¡
(cÚ¡ 
N‘De¡
& 
ÃtDe¡
)

79 
	`as£¹
(
m_b™s
.
	`size
(è=ğ
ÃtDe¡
.
	`g‘Size
());

80 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

81 
m_b™s
[
i
].
	`»moveS‘
(
ÃtDe¡
.m_bits[i]);

83 
	}
}

86 
	gN‘De¡
::
	$ş—r
()

88 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

89 
m_b™s
[
i
].
	`ş—r
();

91 
	}
}

94 
	gN‘De¡
::
	$brßdÿ¡
()

96 
MachšeTy³
 
machše
 = 
MachšeTy³_FIRST
;

97 
machše
 < 
MachšeTy³_NUM
; ++machine) {

98 
	`brßdÿ¡
(
machše
);

100 
	}
}

103 
	gN‘De¡
::
	$brßdÿ¡
(
MachšeTy³
 
machšeTy³
)

105 
NodeID
 
i
 = 0; i < 
	`MachšeTy³_ba£_couÁ
(
machšeTy³
); i++) {

106 
MachšeID
 
mach
 = {
machšeTy³
, 
i
};

107 
	`add
(
mach
);

109 
	}
}

112 
	g¡d
::
veùÜ
<
NodeID
>

113 
N‘De¡
::
	$g‘AÎDe¡
()

115 
¡d
::
veùÜ
<
NodeID
> 
de¡
;

116 
de¡
.
	`ş—r
();

117 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

118 
j
 = 0; j < 
m_b™s
[
i
].
	`g‘Size
(); j++) {

119 ià(
m_b™s
[
i
].
	`isEËm’t
(
j
)) {

120 
id
 = 
	`MachšeTy³_ba£_numb”
((
MachšeTy³
)
i
è+ 
j
;

121 
de¡
.
	`push_back
((
NodeID
)
id
);

125  
de¡
;

126 
	}
}

129 
	gN‘De¡
::
	$couÁ
() const

131 
couÁ”
 = 0;

132 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

133 
couÁ”
 +ğ
m_b™s
[
i
].
	`couÁ
();

135  
couÁ”
;

136 
	}
}

138 
NodeID


139 
	gN‘De¡
::
	$–em’tAt
(
MachšeID
 
šdex
)

141  
m_b™s
[
	`vecIndex
(
šdex
)].
	`–em’tAt
(
	`b™Index
(šdex.
num
));

142 
	}
}

144 
MachšeID


145 
	gN‘De¡
::
	$sm®Ë¡EËm’t
() const

147 
	`as£¹
(
	`couÁ
() > 0);

148 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

149 
NodeID
 
j
 = 0; j < 
m_b™s
[
i
].
	`g‘Size
(); j++) {

150 ià(
m_b™s
[
i
].
	`isEËm’t
(
j
)) {

151 
MachšeID
 
mach
 = {
	`MachšeTy³_äom_ba£_Ëv–
(
i
), 
j
};

152  
mach
;

156 
	`·nic
("No smallestƒlement of‡nƒmpty set.");

157 
	}
}

159 
MachšeID


160 
	gN‘De¡
::
	$sm®Ë¡EËm’t
(
MachšeTy³
 
machše
) const

162 
size
 = 
m_b™s
[
	`MachšeTy³_ba£_Ëv–
(
machše
)].
	`g‘Size
();

163 
NodeID
 
j
 = 0; j < 
size
; j++) {

164 ià(
m_b™s
[
	`MachšeTy³_ba£_Ëv–
(
machše
)].
	`isEËm’t
(
j
)) {

165 
MachšeID
 
mach
 = {
machše
, 
j
};

166  
mach
;

170 
	`·nic
("No smallestƒlement of given MachineType.");

171 
	}
}

174 
boŞ


175 
	gN‘De¡
::
	$isBrßdÿ¡
() const

177 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

178 ià(!
m_b™s
[
i
].
	`isBrßdÿ¡
()) {

179  
çl£
;

182  
Œue
;

183 
	}
}

186 
boŞ


187 
	gN‘De¡
::
	$isEm±y
() const

189 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

190 ià(!
m_b™s
[
i
].
	`isEm±y
()) {

191  
çl£
;

194  
Œue
;

195 
	}
}

198 
N‘De¡


199 
	gN‘De¡
::
	$OR
(cÚ¡ 
N‘De¡
& 
ÜN‘De¡
) const

201 
	`as£¹
(
m_b™s
.
	`size
(è=ğ
ÜN‘De¡
.
	`g‘Size
());

202 
N‘De¡
 
»suÉ
;

203 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

204 
»suÉ
.
m_b™s
[
i
] = m_b™s[i].
	`OR
(
ÜN‘De¡
.m_bits[i]);

206  
»suÉ
;

207 
	}
}

210 
N‘De¡


211 
	gN‘De¡
::
	$AND
(cÚ¡ 
N‘De¡
& 
ªdN‘De¡
) const

213 
	`as£¹
(
m_b™s
.
	`size
(è=ğ
ªdN‘De¡
.
	`g‘Size
());

214 
N‘De¡
 
»suÉ
;

215 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

216 
»suÉ
.
m_b™s
[
i
] = m_b™s[i].
	`AND
(
ªdN‘De¡
.m_bits[i]);

218  
»suÉ
;

219 
	}
}

222 
boŞ


223 
	gN‘De¡
::
	$š‹r£ùiÚIsNÙEm±y
(cÚ¡ 
N‘De¡
& 
Ùh”_ÃtDe¡
) const

225 
	`as£¹
(
m_b™s
.
	`size
(è=ğ
Ùh”_ÃtDe¡
.
	`g‘Size
());

226 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

227 ià(!
m_b™s
[
i
].
	`š‹r£ùiÚIsEm±y
(
Ùh”_ÃtDe¡
.m_bits[i])) {

228  
Œue
;

231  
çl£
;

232 
	}
}

234 
boŞ


235 
	gN‘De¡
::
	$isSu³r£t
(cÚ¡ 
N‘De¡
& 
‹¡
) const

237 
	`as£¹
(
m_b™s
.
	`size
(è=ğ
‹¡
.
	`g‘Size
());

239 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

240 ià(!
m_b™s
[
i
].
	`isSu³r£t
(
‹¡
.m_bits[i])) {

241  
çl£
;

244  
Œue
;

245 
	}
}

247 
boŞ


248 
	gN‘De¡
::
	$isEËm’t
(
MachšeID
 
–em’t
) const

250  ((
m_b™s
[
	`vecIndex
(
–em’t
)])).
	`isEËm’t
(
	`b™Index
ÓËm’t.
num
));

251 
	}
}

254 
	gN‘De¡
::
	$»size
()

256 
m_b™s
.
	`»size
(
	`MachšeTy³_ba£_Ëv–
(
MachšeTy³_NUM
));

257 
	`as£¹
(
m_b™s
.
	`size
(è=ğ
MachšeTy³_NUM
);

259 
i
 = 0; i < 
m_b™s
.
	`size
(); i++) {

260 
m_b™s
[
i
].
	`£tSize
(
	`MachšeTy³_ba£_couÁ
((
MachšeTy³
)i));

262 
	}
}

265 
	gN‘De¡
::
´št
(
¡d
::
o¡»am
& 
out
) const

267 
out
 << "[N‘De¡ (" << 
m_b™s
.
size
() << ") ";

269 
	gi
 = 0; i < 
	gm_b™s
.
size
(); i++) {

270 
	gj
 = 0; j < 
	gm_b™s
[
i
].
g‘Size
(); j++) {

271 
	gout
 << (
	gboŞ
è
	gm_b™s
[
i
].
isEËm’t
(
j
) << " ";

273 
	gout
 << " - ";

275 
	gout
 << "]";

278 
boŞ


279 
	gN‘De¡
::
	$isEqu®
(cÚ¡ 
N‘De¡
& 
n
) const

281 
	`as£¹
(
m_b™s
.
	`size
(è=ğ
n
.m_bits.size());

282 
i
 = 0; i < 
m_b™s
.
	`size
(); ++i) {

283 ià(!
m_b™s
[
i
].
	`isEqu®
(
n
.m_bits[i]))

284  
çl£
;

286  
Œue
;

287 
	}
}

	@ruby/common/NetDest.hh

34 #iâdeà
__MEM_RUBY_COMMON_NETDEST_HH__


35 
	#__MEM_RUBY_COMMON_NETDEST_HH__


	)

37 
	~<io¡»am
>

38 
	~<veùÜ
>

40 
	~"debug/RubyMemÜy.hh
"

41 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

42 
	~"mem/ruby/commÚ/Glob®.hh
"

43 
	~"mem/ruby/commÚ/S‘.hh
"

44 
	~"mem/ruby/sy¡em/MachšeID.hh
"

46 şas 
	cN‘De¡


48 
	mpublic
:

51 
N‘De¡
();

52 
ex¶ic™
 
N‘De¡
(
b™_size
);

54 
	mN‘De¡
& 
	mİ”©Ü
=(cÚ¡ 
S‘
& 
obj
);

56 ~
	$N‘De¡
()

59 
	`add
(
MachšeID
 
ÃwEËm’t
);

60 
	`addN‘De¡
(cÚ¡ 
N‘De¡
& 
ÃtDe¡
);

61 
	`addRªdom
();

62 
	`£tN‘De¡
(
MachšeTy³
 
machše
, cÚ¡ 
S‘
& 
£t
);

63 
	`»move
(
MachšeID
 
ŞdEËm’t
);

64 
	`»moveN‘De¡
(cÚ¡ 
N‘De¡
& 
ÃtDe¡
);

65 
	`ş—r
();

66 
	`brßdÿ¡
();

67 
	`brßdÿ¡
(
MachšeTy³
 
machše
);

68 
	$couÁ
() const;

69 
boŞ
 
	$isEqu®
(cÚ¡ 
N‘De¡
& 
ÃtDe¡
) const;

72 
N‘De¡
 
	$OR
(cÚ¡ 
N‘De¡
& 
ÜN‘De¡
) const;

75 
N‘De¡
 
	$AND
(cÚ¡ 
N‘De¡
& 
ªdN‘De¡
) const;

78 
boŞ
 
	$š‹r£ùiÚIsNÙEm±y
(cÚ¡ 
N‘De¡
& 
Ùh”_ÃtDe¡
) const;

81 
boŞ
 
	$š‹r£ùiÚIsEm±y
(cÚ¡ 
N‘De¡
& 
Ùh”_ÃtDe¡
) const;

83 
boŞ
 
	$isSu³r£t
(cÚ¡ 
N‘De¡
& 
‹¡
) const;

84 
boŞ
 
	$isSub£t
(cÚ¡ 
N‘De¡
& 
‹¡
ècÚ¡ { e¡.
	`isSu³r£t
(*
this
); 
	}
}

85 
boŞ
 
	$isEËm’t
(
MachšeID
 
–em’t
) const;

86 
boŞ
 
	$isBrßdÿ¡
() const;

87 
boŞ
 
	$isEm±y
() const;

90 
¡d
::
veùÜ
<
NodeID
> 
	`g‘AÎDe¡
();

92 
MachšeID
 
	$sm®Ë¡EËm’t
() const;

93 
MachšeID
 
	$sm®Ë¡EËm’t
(
MachšeTy³
 
machše
) const;

95 
	`»size
();

96 
	$g‘Size
(ècÚ¡ {  
m_b™s
.
	`size
(); 
	}
}

99 
NodeID
 
–em’tAt
(
MachšeID
 
šdex
);

101 
´št
(
¡d
::
o¡»am
& 
out
) const;

103 
	g´iv©e
:

107 
	$vecIndex
(
MachšeID
 
m
) const

109 
vec_šdex
 = 
	`MachšeTy³_ba£_Ëv–
(
m
.
ty³
);

110 
	`as£¹
(
vec_šdex
 < 
m_b™s
.
	`size
());

111  
vec_šdex
;

112 
	}
}

114 
NodeID


115 
	$b™Index
(
NodeID
 
šdex
) const

117  
šdex
;

118 
	}
}

120 
	g¡d
::
veùÜ
<
S‘
> 
m_b™s
;

123 
šlše
 
	g¡d
::
o¡»am
&

124 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gN‘De¡
& 
	gobj
)

126 
	gobj
.
´št
(
out
);

127 
	gout
 << 
	g¡d
::
æush
;

128  
	gout
;

	@ruby/common/Set.cc

32 
	~<c¡dio
>

34 
	~"ba£/misc.hh
"

35 
	~"mem/ruby/commÚ/S‘.hh
"

36 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

38 
	gS‘
::
	$S‘
()

40 
m_p_nA¼ay
 = 
NULL
;

41 
m_nA¼ayL’
 = 0;

42 
m_nSize
 = 0;

43 
	}
}

45 
	gS‘
::
	$S‘
(cÚ¡ 
S‘
& 
obj
)

47 
m_p_nA¼ay
 = 
NULL
;

48 
	`£tSize
(
obj
.
m_nSize
);

51 
i
 = 0; i < 
m_nA¼ayL’
; i++)

52 
m_p_nA¼ay
[
i
] = 
obj
.m_p_nArray[i];

53 
	}
}

55 
	gS‘
::
	$S‘
(
size
)

57 
m_p_nA¼ay
 = 
NULL
;

58 
m_nA¼ayL’
 = 0;

59 
m_nSize
 = 0;

60 ià(
size
 > 0)

61 
	`£tSize
(
size
);

62 
	}
}

64 
	gS‘
::~
	$S‘
()

66 ià(
m_p_nA¼ay
 && m_p_nA¼ay !ğ&
m_p_nA¼ay_Stic
[0])

67 
d–‘e
 [] 
m_p_nA¼ay
;

68 
m_p_nA¼ay
 = 
NULL
;

69 
	}
}

72 
	gS‘
::
	$ş—rExûss
()

75 #ifdeà
_LP64


76 
mask
 = 0x7FFFFFFFFFFFFFFF;

78 
mask
 = 0x7FFFFFFF;

84 ià((
m_nSize
 % 
LONG_BITS
) != 0) {

85 
j
 = 0; j < 64 - (
m_nSize
 & 
INDEX_MASK
); j++) {

86 
m_p_nA¼ay
[
m_nA¼ayL’
 - 1] &ğ
mask
;

87 
mask
 = mask >> 1;

90 
	}
}

98 
	gS‘
::
	$addS‘
(cÚ¡ 
S‘
& 
£t
)

100 
	`as£¹
(
	`g‘Size
()==
£t
.getSize());

101 
i
 = 0; i < 
m_nA¼ayL’
; i++)

102 
m_p_nA¼ay
[
i
] |ğ
£t
.m_p_nArray[i];

103 
	}
}

110 
	gS‘
::
	$addRªdom
()

113 
i
 = 0; i < 
m_nA¼ayL’
; i++) {

116 
m_p_nA¼ay
[
i
] |ğ
	`¿ndom
() ^ (random() << 4);

118 
	`ş—rExûss
();

119 
	}
}

125 
	gS‘
::
	$»moveS‘
(cÚ¡ 
S‘
& 
£t
)

127 
	`as£¹
(
m_nSize
 =ğ
£t
.m_nSize);

128 
i
 = 0; i < 
m_nA¼ayL’
; i++)

129 
m_p_nA¼ay
[
i
] &ğ~
£t
.m_p_nArray[i];

130 
	}
}

136 
	gS‘
::
	$brßdÿ¡
()

138 
i
 = 0; i < 
m_nA¼ayL’
; i++)

139 
m_p_nA¼ay
[
i
] = -1;

141 
	`ş—rExûss
();

142 
	}
}

148 
	gS‘
::
	$couÁ
() const

150 
couÁ”
 = 0;

151 
mask
;

153 
i
 = 0; i < 
m_nA¼ayL’
; i++) {

154 
mask
 = ()0x01;

156 
j
 = 0; j < 
LONG_BITS
; j++) {

159 ià((
m_p_nA¼ay
[
i
] & 
mask
) != 0) {

160 
couÁ”
++;

162 
mask
 = mask << 1;

166  
couÁ”
;

167 
	}
}

172 
boŞ


173 
	gS‘
::
	$isEqu®
(cÚ¡ 
S‘
& 
£t
) const

175 
	`as£¹
(
m_nSize
 =ğ
£t
.m_nSize);

177 
i
 = 0; i < 
m_nA¼ayL’
; i++)

178 ià(
m_p_nA¼ay
[
i
] !ğ
£t
.m_p_nArray[i])

179  
çl£
;

181  
Œue
;

182 
	}
}

187 
NodeID


188 
	gS‘
::
	$sm®Ë¡EËm’t
() const

190 
	`as£¹
(
	`couÁ
() > 0);

191 
x
;

192 
i
 = 0; i < 
m_nA¼ayL’
; i++) {

193 ià(
m_p_nA¼ay
[
i
] != 0) {

195 
x
 = 
m_p_nA¼ay
[
i
];

197 
j
 = 0; j < 
LONG_BITS
; j++) {

198 ià(
x
 & ()1) {

199  
LONG_BITS
 * 
i
 + 
j
;

202 
x
 = x >> 1;

205 
	`·nic
("No smallestƒlement of‡nƒmpty set.");

209 
	`·nic
("No smallestƒlement of‡nƒmpty set.");

210 
	}
}

215 
boŞ


216 
	gS‘
::
	$isBrßdÿ¡
() const

223 
max
 = (
m_nSize
 % 
LONG_BITS
è=ğ0 ? 
m_nA¼ayL’
 : m_nArrayLen - 1;

224 
i
 = 0; i < 
max
; i++) {

225 ià(
m_p_nA¼ay
[
i
] != -1) {

226  
çl£
;

231 
mask
 = 1;

232 
j
 = 0; j < (
m_nSize
 % 
LONG_BITS
); j++) {

233 ià((
mask
 & 
m_p_nA¼ay
[
m_nA¼ayL’
-1]) == 0) {

234  
çl£
;

236 
mask
 = mask << 1;

239  
Œue
;

240 
	}
}

245 
boŞ


246 
	gS‘
::
	$isEm±y
() const

250 
i
 = 0; i < 
m_nA¼ayL’
 ; i++)

251 ià(
m_p_nA¼ay
[
i
])

252  
çl£
;

254  
Œue
;

255 
	}
}

258 
S‘


259 
	gS‘
::
	$OR
(cÚ¡ 
S‘
& 
ÜS‘
) const

261 
S‘
 
	`»suÉ
(
m_nSize
);

262 
	`as£¹
(
m_nSize
 =ğ
ÜS‘
.m_nSize);

263 
i
 = 0; i < 
m_nA¼ayL’
; i++)

264 
»suÉ
.
m_p_nA¼ay
[
i
] = m_p_nA¼ay[i] | 
ÜS‘
.m_p_nArray[i];

266  
»suÉ
;

267 
	}
}

270 
S‘


271 
	gS‘
::
	$AND
(cÚ¡ 
S‘
& 
ªdS‘
) const

273 
S‘
 
	`»suÉ
(
m_nSize
);

274 
	`as£¹
(
m_nSize
 =ğ
ªdS‘
.m_nSize);

276 
i
 = 0; i < 
m_nA¼ayL’
; i++) {

277 
»suÉ
.
m_p_nA¼ay
[
i
] = m_p_nA¼ay[i] & 
ªdS‘
.m_p_nArray[i];

280  
»suÉ
;

281 
	}
}

287 
boŞ


288 
	gS‘
::
	$isSu³r£t
(cÚ¡ 
S‘
& 
‹¡
) const

290 
	`as£¹
(
m_nSize
 =ğ
‹¡
.m_nSize);

292 
i
 = 0; i < 
m_nA¼ayL’
; i++)

293 ià(((
‹¡
.
m_p_nA¼ay
[
i
] & m_p_nArray[i]) | ~test.m_p_nArray[i]) != -1)

294  
çl£
;

296  
Œue
;

297 
	}
}

300 
	gS‘
::
	$£tSize
(
size
)

302 
m_nSize
 = 
size
;

303 
m_nA¼ayL’
 = (
m_nSize
 + 
LONG_BITS
 - 1) / LONG_BITS;

306 ià(
m_nA¼ayL’
 <ğ
NUMBER_WORDS_PER_SET
) {

315 ià(
m_p_nA¼ay
 && m_p_nA¼ay !ğ&
m_p_nA¼ay_Stic
[0])

316 
d–‘e
 [] 
m_p_nA¼ay
;

318 
m_p_nA¼ay
 = &
m_p_nA¼ay_Stic
[0];

322 ià(
m_p_nA¼ay
 && m_p_nA¼ay !ğ&
m_p_nA¼ay_Stic
[0])

323 
d–‘e
 [] 
m_p_nA¼ay
;

325 
m_p_nA¼ay
 = 
Ãw
 [
m_nA¼ayL’
];

328 
	`ş—r
();

329 
	}
}

331 
	gS‘
&

332 
	gS‘
::
İ”©Ü
=(cÚ¡ 
S‘
& 
obj
)

334 ià(
this
 !ğ&
obj
) {

336 
£tSize
(
obj
.
g‘Size
());

339 
	gi
 = 0; i < 
	gm_nA¼ayL’
; i++)

340 
	gm_p_nA¼ay
[
i
] = 
obj
.
m_p_nA¼ay
[i];

343  *
	gthis
;

347 
	gS‘
::
´št
(
¡d
::
o¡»am
& 
out
) const

349 ià(!
m_p_nA¼ay
) {

350 
out
 << "[Set {Empty}]";

354 
	gout
 << "[S‘ (" << 
	gm_nSize
 << ")";

355 
	gi
 = 
m_nA¼ayL’
 - 1; i >= 0; i--) {

356 
	gout
 << 
c¥rštf
(" 0x%08X", 
m_p_nA¼ay
[
i
]);

358 
	gout
 << " ]";

	@ruby/common/Set.hh

32 #iâdeà
__MEM_RUBY_COMMON_SET_HH__


33 
	#__MEM_RUBY_COMMON_SET_HH__


	)

35 
	~<io¡»am
>

36 
	~<lim™s
>

38 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

51 cÚ¡ 
	gNUMBER_WORDS_PER_SET
 = 1;

53 şas 
	cS‘


55 
	m´iv©e
:

56 
m_nSize
;

57 
	mm_nA¼ayL’
;

65 *
	mm_p_nA¼ay
;

66 
	mm_p_nA¼ay_Stic
[
NUMBER_WORDS_PER_SET
];

68 cÚ¡ 
	mLONG_BITS
 = 
¡d
::
num”ic_lim™s
<>::
dig™s
 + 1;

69 cÚ¡ 
	mINDEX_SHIFT
 = 
LONG_BITS
 == 64 ? 6 : 5;

70 cÚ¡ 
	mINDEX_MASK
 = (1 << 
INDEX_SHIFT
) - 1;

72 
ş—rExûss
();

74 
	mpublic
:

75 
S‘
();

76 
S‘
(
size
);

77 
S‘
(cÚ¡ S‘& 
obj
);

78 ~
S‘
();

80 
	mS‘
& 
	mİ”©Ü
=(cÚ¡ 
S‘
& 
obj
);

83 
	$add
(
NodeID
 
šdex
)

85 
m_p_nA¼ay
[
šdex
 >> 
INDEX_SHIFT
] |=

86 (((è1è<< (
šdex
 & 
INDEX_MASK
));

89 
	`addS‘
(cÚ¡ 
S‘
& 
£t
);

90 
	`addRªdom
();

93 
	$»move
(
NodeID
 
šdex
)

95 
m_p_nA¼ay
[
šdex
 >> 
INDEX_SHIFT
] &=

96 ~((()1è<< (
šdex
 & 
INDEX_MASK
));

97 
	}
}

99 
»moveS‘
(cÚ¡ 
S‘
& 
£t
);

102 
	$ş—r
()

104 
i
 = 0; i < 
m_nA¼ayL’
; i++)

105 
m_p_nA¼ay
[
i
] = 0;

106 
	}
}

108 
brßdÿ¡
();

109 
	$couÁ
() const;

110 
boŞ
 
	$isEqu®
(cÚ¡ 
S‘
& 
£t
) const;

113 
S‘
 
	$OR
(cÚ¡ 
S‘
& 
ÜS‘
) const;

116 
S‘
 
	$AND
(cÚ¡ 
S‘
& 
ªdS‘
) const;

119 
boŞ


120 
	$š‹r£ùiÚIsEm±y
(cÚ¡ 
S‘
& 
Ùh”_£t
) const

122 
i
 = 0; i < 
m_nA¼ayL’
; i++)

123 ià(
m_p_nA¼ay
[
i
] & 
Ùh”_£t
.m_p_nArray[i])

124  
çl£
;

125  
Œue
;

126 
	}
}

128 
boŞ
 
	$isSu³r£t
(cÚ¡ 
S‘
& 
‹¡
) const;

129 
boŞ
 
	$isSub£t
(cÚ¡ 
S‘
& 
‹¡
ècÚ¡ { e¡.
	`isSu³r£t
(*
this
); 
	}
}

131 
boŞ


132 
	$isEËm’t
(
NodeID
 
–em’t
) const

134  (
m_p_nA¼ay
[
–em’t
>>
INDEX_SHIFT
] &

135 ((()1è<< (
–em’t
 & 
INDEX_MASK
))) != 0;

136 
	}
}

138 
boŞ
 
	$isBrßdÿ¡
() const;

139 
boŞ
 
	$isEm±y
() const;

141 
NodeID
 
	$sm®Ë¡EËm’t
() const;

143 
	`£tSize
(
size
);

145 
NodeID


146 
	$–em’tAt
(
šdex
) const

148 ià(
	`isEËm’t
(
šdex
))

149  (
NodeID
)
Œue
;

152 
	}
}

154 
	$g‘Size
(ècÚ¡ {  
m_nSize
; 
	}
}

156 
´št
(
¡d
::
o¡»am
& 
out
) const;

159 
šlše
 
	g¡d
::
o¡»am
&

160 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gS‘
& 
	gobj
)

162 
	gobj
.
´št
(
out
);

163 
	gout
 << 
	g¡d
::
æush
;

164  
	gout
;

	@ruby/common/SubBlock.cc

29 
	~"ba£/¡l_h–³rs.hh
"

30 
	~"mem/ruby/commÚ/SubBlock.hh
"

32 
usšg
 
	gm5
::
¡l_h–³rs
::
İ”©Ü
<<;

34 
	gSubBlock
::
	$SubBlock
(cÚ¡ 
Add»ss
& 
addr
, 
size
)

36 
m_add»ss
 = 
addr
;

37 
	`»size
(
size
);

38 
i
 = 0; i < 
size
; i++) {

39 
	`£tBy‹
(
i
, 0);

41 
	}
}

44 
	gSubBlock
::
	$š‹º®M”geFrom
(cÚ¡ 
D©aBlock
& 
d©a
)

46 
size
 = 
	`g‘Size
();

47 
	`as£¹
(
size
 > 0);

48 
off£t
 = 
m_add»ss
.
	`g‘Off£t
();

49 
i
 = 0; i < 
size
; i++) {

50 
this
->
	`£tBy‹
(
i
, 
d©a
.
	`g‘By‹
(
off£t
 + i));

52 
	}
}

55 
	gSubBlock
::
	$š‹º®M”geTo
(
D©aBlock
& 
d©a
) const

57 
size
 = 
	`g‘Size
();

58 
	`as£¹
(
size
 > 0);

59 
off£t
 = 
m_add»ss
.
	`g‘Off£t
();

60 
i
 = 0; i < 
size
; i++) {

62 
d©a
.
	`£tBy‹
(
off£t
 + 
i
, 
this
->
	`g‘By‹
(i));

64 
	}
}

67 
	gSubBlock
::
´št
(
¡d
::
o¡»am
& 
out
) const

69 
out
 << "[" << 
m_add»ss
 << ", " << 
g‘Size
(è<< ", " << 
m_d©a
 << "]";

	@ruby/common/SubBlock.hh

29 #iâdeà
__MEM_RUBY_COMMON_SUBBLOCK_HH__


30 
	#__MEM_RUBY_COMMON_SUBBLOCK_HH__


	)

32 
	~<io¡»am
>

33 
	~<veùÜ
>

35 
	~"mem/ruby/commÚ/Add»ss.hh
"

36 
	~"mem/ruby/commÚ/D©aBlock.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

39 şas 
	cSubBlock


41 
	mpublic
:

42 
	$SubBlock
() { }

43 
	`SubBlock
(cÚ¡ 
Add»ss
& 
addr
, 
size
);

44 ~
	$SubBlock
(è{ 
	}
}

46 cÚ¡ 
	gAdd»ss
& 
	$g‘Add»ss
(ècÚ¡ {  
m_add»ss
; 
	}
}

47 
	$£tAdd»ss
(cÚ¡ 
Add»ss
& 
addr
è{ 
m_add»ss
 =‡ddr; 
	}
}

49 
	$g‘Size
(ècÚ¡ {  
m_d©a
.
	`size
(); 
	}
}

50 
	$»size
(
size
è{ 
m_d©a
.
	`»size
(size); 
	}
}

51 
ušt8_t
 
	$g‘By‹
(
off£t
ècÚ¡ {  
m_d©a
[off£t]; 
	}
}

52 
	$£tBy‹
(
off£t
, 
ušt8_t
 
d©a
è{ 
m_d©a
[off£t] = d©a; 
	}
}

55 
ušt8_t
 
	$»adBy‹
(ècÚ¡ {  
	`g‘By‹
(0); 
	}
}

56 
	$wr™eBy‹
(
ušt8_t
 
d©a
è{ 
	`£tBy‹
(0, d©a); 
	}
}

60 
	$m”geTo
(
D©aBlock
& 
d©a
ècÚ¡ { 
	`š‹º®M”geTo
(d©a); 
	}
}

61 
	$m”geFrom
(cÚ¡ 
D©aBlock
& 
d©a
è{ 
	`š‹º®M”geFrom
(d©a); 
	}
}

63 
´št
(
¡d
::
o¡»am
& 
out
) const;

65 
	g´iv©e
:

66 
	$š‹º®M”geTo
(
D©aBlock
& 
d©a
) const;

67 
	`š‹º®M”geFrom
(cÚ¡ 
D©aBlock
& 
d©a
);

70 
Add»ss
 
m_add»ss
;

71 
¡d
::
veùÜ
<
ušt8_t
> 
m_d©a
;

72 
	}
};

74 
šlše
 
	g¡d
::
o¡»am
&

75 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gSubBlock
& 
	gobj
)

77 
	gobj
.
´št
(
out
);

78 
	gout
 << 
	g¡d
::
æush
;

79  
	gout
;

	@ruby/common/TypeDefines.hh

30 #iâdeà
TYPEDEFINES_H


31 
	#TYPEDEFINES_H


	)

33 
	tušt64
;

34 
	tšt64
;

36 
št64
 
	tTime
;

37 
ušt64
 
	tphysiÿl_add»ss_t
;

39 
št64
 
	tIndex
;

40 
	tLškID
;

41 
	tNodeID
;

42 
	tSw™chID
;

	@ruby/filters/AbstractBloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_ABSTRACTBLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_ABSTRACTBLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

34 
	~"mem/ruby/commÚ/Add»ss.hh
"

35 
	~"mem/ruby/commÚ/Glob®.hh
"

37 şas 
	cAb¡¿ùBloomF‹r


39 
	mpublic
:

40 
vœtu®
 ~
	$Ab¡¿ùBloomF‹r
() {};

41 
vœtu®
 
	`ş—r
() = 0;

42 
vœtu®
 
	`šüem’t
(cÚ¡ 
Add»ss
& 
addr
) = 0;

43 
vœtu®
 
	`deüem’t
(cÚ¡ 
Add»ss
& 
addr
) = 0;

44 
vœtu®
 
	`m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
) = 0;

45 
vœtu®
 
	`£t
(cÚ¡ 
Add»ss
& 
addr
) = 0;

46 
vœtu®
 
	`un£t
(cÚ¡ 
Add»ss
& 
addr
) = 0;

48 
vœtu®
 
boŞ
 
	`isS‘
(cÚ¡ 
Add»ss
& 
addr
) = 0;

49 
vœtu®
 
	`g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
) = 0;

50 
vœtu®
 
	`g‘TÙ®CouÁ
() = 0;

52 
vœtu®
 
	`´št
(
¡d
::
o¡»am
& 
out
) const = 0;

54 
vœtu®
 
	`g‘Index
(cÚ¡ 
Add»ss
& 
addr
) = 0;

55 
vœtu®
 
	`»adB™
(cÚ¡ 
šdex
) = 0;

56 
vœtu®
 
	`wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
) = 0;

57 
	}
};

	@ruby/filters/BlockBloomFilter.cc

29 
	~"ba£/štm©h.hh
"

30 
	~"ba£/¡r.hh
"

31 
	~"mem/ruby/f‹rs/BlockBloomF‹r.hh
"

32 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

34 
usšg
 
Çme¥aû
 
	g¡d
;

36 
	gBlockBloomF‹r
::
	$BlockBloomF‹r
(
¡ršg
 
¡r
)

38 
¡ršg
 
h—d
, 

;

40 #iâdeà
NDEBUG


41 
boŞ
 
sucûss
 =

43 
	`¥l™_fœ¡
(
¡r
, 
h—d
, 

, '_');

45 
	`as£¹
(
sucûss
);

47 
m_f‹r_size
 = 
	`©oi
(
h—d
.
	`c_¡r
());

48 
m_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_f‹r_size
);

50 
m_f‹r
.
	`»size
(
m_f‹r_size
);

52 
	`ş—r
();

53 
	}
}

55 
	gBlockBloomF‹r
::~
	$BlockBloomF‹r
()

57 
	}
}

60 
BlockBloomF‹r
::
	$ş—r
()

62 
i
 = 0; i < 
m_f‹r_size
; i++) {

63 
m_f‹r
[
i
] = 0;

65 
	}
}

68 
	gBlockBloomF‹r
::
	$šüem’t
(cÚ¡ 
Add»ss
& 
addr
)

71 
	}
}

74 
BlockBloomF‹r
::
	$deüem’t
(cÚ¡ 
Add»ss
& 
addr
)

77 
	}
}

80 
BlockBloomF‹r
::
	$m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
)

83 
	}
}

86 
BlockBloomF‹r
::
	$£t
(cÚ¡ 
Add»ss
& 
addr
)

88 
i
 = 
	`g‘_šdex
(
addr
);

89 
m_f‹r
[
i
] = 1;

90 
	}
}

93 
	gBlockBloomF‹r
::
	$un£t
(cÚ¡ 
Add»ss
& 
addr
)

95 
i
 = 
	`g‘_šdex
(
addr
);

96 
m_f‹r
[
i
] = 0;

97 
	}
}

99 
boŞ


100 
	gBlockBloomF‹r
::
	$isS‘
(cÚ¡ 
Add»ss
& 
addr
)

102 
i
 = 
	`g‘_šdex
(
addr
);

103  (
m_f‹r
[
i
]);

104 
	}
}

107 
	gBlockBloomF‹r
::
	$g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
)

109  
m_f‹r
[
	`g‘_šdex
(
addr
)];

110 
	}
}

113 
	gBlockBloomF‹r
::
	$g‘TÙ®CouÁ
()

115 
couÁ
 = 0;

117 
i
 = 0; i < 
m_f‹r_size
; i++) {

118 ià(
m_f‹r
[
i
]) {

119 
couÁ
++;

122  
couÁ
;

123 
	}
}

126 
	gBlockBloomF‹r
::
	$g‘Index
(cÚ¡ 
Add»ss
& 
addr
)

128  
	`g‘_šdex
(
addr
);

129 
	}
}

132 
	gBlockBloomF‹r
::
	$´št
(
o¡»am
& 
out
) const

134 
	}
}

137 
BlockBloomF‹r
::
	$»adB™
(cÚ¡ 
šdex
)

139  
m_f‹r
[
šdex
];

140 
	}
}

143 
	gBlockBloomF‹r
::
	$wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
)

145 
m_f‹r
[
šdex
] = 
v®ue
;

146 
	}
}

149 
	gBlockBloomF‹r
::
	$g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
)

154 
physiÿl_add»ss_t
 
block_b™s
 =

155 
addr
.
	`b™S–eù
(
RubySy¡em
::
	`g‘BlockSizeB™s
(),

156 2 * 
RubySy¡em
::
	`g‘BlockSizeB™s
() - 1);

157 
off£t
 = 5;

158 
physiÿl_add»ss_t
 
Ùh”_b™s
 =

159 
addr
.
	`b™S–eù
(2 * 
RubySy¡em
::
	`g‘BlockSizeB™s
(è+ 
off£t
,

160 2 * 
RubySy¡em
::
	`g‘BlockSizeB™s
(è+ 
off£t
 +

161 
m_f‹r_size_b™s
 - 1);

162 
šdex
 = 
block_b™s
 ^ 
Ùh”_b™s
;

163 
	`as£¹
(
šdex
 < 
m_f‹r_size
);

164  
šdex
;

165 
	}
}

	@ruby/filters/BlockBloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_BLOCKBLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_BLOCKBLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/f‹rs/Ab¡¿ùBloomF‹r.hh
"

40 şas 
	cBlockBloomF‹r
 : 
public
 
Ab¡¿ùBloomF‹r


42 
public
:

43 
BlockBloomF‹r
(
¡d
::
¡ršg
 
cÚfig
);

44 ~
BlockBloomF‹r
();

46 
ş—r
();

47 
šüem’t
(cÚ¡ 
Add»ss
& 
addr
);

48 
deüem’t
(cÚ¡ 
Add»ss
& 
addr
);

49 
m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
);

50 
£t
(cÚ¡ 
Add»ss
& 
addr
);

51 
un£t
(cÚ¡ 
Add»ss
& 
addr
);

53 
boŞ
 
isS‘
(cÚ¡ 
Add»ss
& 
addr
);

54 
g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
);

55 
g‘TÙ®CouÁ
();

56 
g‘Index
(cÚ¡ 
Add»ss
& 
addr
);

57 
»adB™
(cÚ¡ 
šdex
);

58 
wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
);

60 
´št
(
¡d
::
o¡»am
& 
out
) const;

62 
	m´iv©e
:

63 
g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
);

65 
	m¡d
::
veùÜ
<> 
m_f‹r
;

66 
	mm_f‹r_size
;

67 
	mm_f‹r_size_b™s
;

	@ruby/filters/BulkBloomFilter.cc

29 
	~<ÿs£¹
>

31 
	~"ba£/štm©h.hh
"

32 
	~"ba£/¡r.hh
"

33 
	~"mem/ruby/f‹rs/BulkBloomF‹r.hh
"

34 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

36 
usšg
 
Çme¥aû
 
	g¡d
;

38 
	gBulkBloomF‹r
::
	$BulkBloomF‹r
(
¡ršg
 
¡r
)

40 
¡ršg
 
h—d
, 

;

42 #iâdeà
NDEBUG


43 
boŞ
 
sucûss
 =

45 
	`¥l™_fœ¡
(
¡r
, 
h—d
, 

, '_');

46 
	`as£¹
(
sucûss
);

48 
m_f‹r_size
 = 
	`©oi
(
h—d
.
	`c_¡r
());

49 
m_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_f‹r_size
);

51 
m_£ùÜ_b™s
 = 
m_f‹r_size_b™s
 - 1;

53 
m_‹mp_f‹r
.
	`»size
(
m_f‹r_size
);

54 
m_f‹r
.
	`»size
(
m_f‹r_size
);

55 
	`ş—r
();

58 
i
 = 0; i < 
m_f‹r_size
; ++i) {

59 
m_‹mp_f‹r
[
i
] = 0;

61 
	}
}

63 
	gBulkBloomF‹r
::~
	$BulkBloomF‹r
()

65 
	}
}

68 
BulkBloomF‹r
::
	$ş—r
()

70 
i
 = 0; i < 
m_f‹r_size
; i++) {

71 
m_f‹r
[
i
] = 0;

73 
	}
}

76 
	gBulkBloomF‹r
::
	$šüem’t
(cÚ¡ 
Add»ss
& 
addr
)

79 
	}
}

82 
BulkBloomF‹r
::
	$deüem’t
(cÚ¡ 
Add»ss
& 
addr
)

85 
	}
}

88 
BulkBloomF‹r
::
	$m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
)

91 
	}
}

94 
BulkBloomF‹r
::
	$£t
(cÚ¡ 
Add»ss
& 
addr
)

97 
£t_b™s
 = 
m_£ùÜ_b™s
;

98 
block_b™s
 = 
RubySy¡em
::
	`g‘BlockSizeB™s
();

99 
c0
 = 
addr
.
	`b™S–eù
Ğ
block_b™s
, block_b™ + 
£t_b™s
 - 1);

103 
c1
 = 
addr
.
	`b™S–eù
Ğ
block_b™s
+
£t_b™s
, (block_bits+2*set_bits) - 1);

108 
m_f‹r
[
c0
 + (
m_f‹r_size
/2)] = 1;

110 
m_f‹r
[
c1
] = 1;

111 
	}
}

114 
	gBulkBloomF‹r
::
	$un£t
(cÚ¡ 
Add»ss
& 
addr
)

117 
	}
}

119 
boŞ


120 
BulkBloomF‹r
::
	$isS‘
(cÚ¡ 
Add»ss
& 
addr
)

123 
£t_b™s
 = 
m_£ùÜ_b™s
;

124 
block_b™s
 = 
RubySy¡em
::
	`g‘BlockSizeB™s
();

125 
c0
 = 
addr
.
	`b™S–eù
Ğ
block_b™s
, block_b™ + 
£t_b™s
 - 1);

129 
c1
 = 
addr
.
	`b™S–eù
Ğ
block_b™s
+
£t_b™s
, (block_bits+2*set_bits) - 1);

134 
m_‹mp_f‹r
[
c0
 + (
m_f‹r_size
/2)] = 1;

136 
m_‹mp_f‹r
[
c1
] = 1;

140 
boŞ
 
z”o
 = 
çl£
;

141 
i
 = 0; i < 
m_f‹r_size
/2; ++i){

143 
m_‹mp_f‹r
[
i
] = m_‹mp_f‹r[i] && 
m_f‹r
[i];

144 
z”o
 = z”Ø|| 
m_‹mp_f‹r
[
i
];

146 
z”o
 = !zero;

147 ià(
z”o
) {

150 
m_‹mp_f‹r
[
c0
 + (
m_f‹r_size
 / 2)] = 0;

151 
m_‹mp_f‹r
[
c1
] = 0;

152  
çl£
;

156 
z”o
 = 
çl£
;

157 
i
 = 
m_f‹r_size
 / 2; i < m_filter_size; ++i) {

159 
m_‹mp_f‹r
[
i
] = m_‹mp_f‹r[i] && 
m_f‹r
[i];

160 
z”o
 = z”Ø|| 
m_‹mp_f‹r
[
i
];

162 
z”o
 = !zero;

163 ià(
z”o
) {

165 
m_‹mp_f‹r
[
c0
 + (
m_f‹r_size
 / 2)] = 0;

166 
m_‹mp_f‹r
[
c1
] = 0;

167  
çl£
;

170 
m_‹mp_f‹r
[
c0
 + (
m_f‹r_size
 / 2)] = 0;

171 
m_‹mp_f‹r
[
c1
] = 0;

172  
Œue
;

173 
	}
}

176 
	gBulkBloomF‹r
::
	$g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
)

180 
	}
}

183 
	gBulkBloomF‹r
::
	$g‘TÙ®CouÁ
()

185 
couÁ
 = 0;

186 
i
 = 0; i < 
m_f‹r_size
; i++) {

187 ià(
m_f‹r
[
i
]) {

188 
couÁ
++;

191  
couÁ
;

192 
	}
}

195 
	gBulkBloomF‹r
::
	$g‘Index
(cÚ¡ 
Add»ss
& 
addr
)

197  
	`g‘_šdex
(
addr
);

198 
	}
}

201 
	gBulkBloomF‹r
::
	$»adB™
(cÚ¡ 
šdex
)

205 
	}
}

208 
	gBulkBloomF‹r
::
	$wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
)

211 
	}
}

214 
	gBulkBloomF‹r
::
	$´št
(
o¡»am
& 
out
) const

216 
	}
}

219 
BulkBloomF‹r
::
	$g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
)

221  
addr
.
	`b™S–eù
(
RubySy¡em
::
	`g‘BlockSizeB™s
(),

222 
RubySy¡em
::
	`g‘BlockSizeB™s
() +

223 
m_f‹r_size_b™s
 - 1);

224 
	}
}

226 
Add»ss


227 
	gBulkBloomF‹r
::
	$³rmu‹
(cÚ¡ 
Add»ss
 & 
addr
)

230 
block_off£t
 = 
RubySy¡em
::
	`g‘BlockSizeB™s
();

231 
physiÿl_add»ss_t
 
·¹1
 = 
addr
.
	`b™S–eù
(
block_off£t
, block_offset + 6),

232 
·¹2
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 9, block_offset + 9),

233 
·¹3
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 11, block_offset + 11),

234 
·¹4
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 17, block_offset + 17),

235 
·¹5
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 7, block_offset + 8),

236 
·¹6
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 10, block_offset + 10),

237 
·¹7
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 12, block_offset + 12),

238 
·¹8
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 13, block_offset + 13),

239 
·¹9
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 15, block_offset + 16),

240 
·¹10
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 18, block_offset + 20),

241 
·¹11
 = 
addr
.
	`b™S–eù
(
block_off£t
 + 14, block_offset + 14);

243 
physiÿl_add»ss_t
 
»suÉ
 =

244 (
·¹1
 << 14è| (
·¹2
 << 13è| (
·¹3
 << 12è| (
·¹4
 << 11) |

245 (
·¹5
 << 9è| (
·¹6
 << 8è| (
·¹7
 << 7è| (
·¹8
 << 6) |

246 (
·¹9
 << 4è| (
·¹10
 << 1è| (
·¹11
);

250 
physiÿl_add»ss_t
 
»maššg_b™s
 =

251 
addr
.
	`b™S–eù
(
block_off£t
 + 21, 31) << 21;

252 
»suÉ
 =„esuÉ | 
»maššg_b™s
;

254  
	`Add»ss
(
»suÉ
);

255 
	}
}

	@ruby/filters/BulkBloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_BULKBLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_BULKBLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/f‹rs/Ab¡¿ùBloomF‹r.hh
"

40 şas 
	cBulkBloomF‹r
 : 
public
 
Ab¡¿ùBloomF‹r


42 
public
:

43 
BulkBloomF‹r
(
¡d
::
¡ršg
 
cÚfig
);

44 ~
BulkBloomF‹r
();

46 
ş—r
();

47 
šüem’t
(cÚ¡ 
Add»ss
& 
addr
);

48 
deüem’t
(cÚ¡ 
Add»ss
& 
addr
);

49 
m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
);

50 
£t
(cÚ¡ 
Add»ss
& 
addr
);

51 
un£t
(cÚ¡ 
Add»ss
& 
addr
);

53 
boŞ
 
isS‘
(cÚ¡ 
Add»ss
& 
addr
);

54 
g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
);

55 
g‘TÙ®CouÁ
();

56 
g‘Index
(cÚ¡ 
Add»ss
& 
addr
);

57 
»adB™
(cÚ¡ 
šdex
);

58 
wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
);

60 
´št
(
¡d
::
o¡»am
& 
out
) const;

62 
	m´iv©e
:

63 
g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
);

64 
Add»ss
 
³rmu‹
(cÚ¡ Add»s & 
addr
);

66 
	m¡d
::
veùÜ
<> 
m_f‹r
;

67 
	m¡d
::
veùÜ
<> 
m_‹mp_f‹r
;

69 
	mm_f‹r_size
;

70 
	mm_f‹r_size_b™s
;

72 
	mm_£ùÜ_b™s
;

	@ruby/filters/GenericBloomFilter.cc

29 
	~"ba£/¡r.hh
"

30 
	~"mem/ruby/commÚ/Add»ss.hh
"

31 
	~"mem/ruby/commÚ/Glob®.hh
"

32 
	~"mem/ruby/f‹rs/BlockBloomF‹r.hh
"

33 
	~"mem/ruby/f‹rs/BulkBloomF‹r.hh
"

34 
	~"mem/ruby/f‹rs/G’”icBloomF‹r.hh
"

35 
	~"mem/ruby/f‹rs/H3BloomF‹r.hh
"

36 
	~"mem/ruby/f‹rs/LSB_CouÁšgBloomF‹r.hh
"

37 
	~"mem/ruby/f‹rs/MuÉiB™S–BloomF‹r.hh
"

38 
	~"mem/ruby/f‹rs/MuÉiG¿šBloomF‹r.hh
"

39 
	~"mem/ruby/f‹rs/NÚCouÁšgBloomF‹r.hh
"

41 
usšg
 
Çme¥aû
 
	g¡d
;

43 
	gG’”icBloomF‹r
::
	$G’”icBloomF‹r
(
¡ršg
 
cÚfig
)

45 
¡ršg
 
h—d
, 

;

46 #iâdeà
NDEBUG


47 
boŞ
 
sucûss
 =

49 
	`¥l™_fœ¡
(
cÚfig
, 
h—d
, 

, '_');

50 
	`as£¹
(
sucûss
);

52 ià(
h—d
 == "LSB_Counting" ) {

53 
m_f‹r
 = 
Ãw
 
	`LSB_CouÁšgBloomF‹r
(

);

54 } if(
h—d
 == "NonCounting" ) {

55 
m_f‹r
 = 
Ãw
 
	`NÚCouÁšgBloomF‹r
(

);

56 } if(
h—d
 == "Bulk" ) {

57 
m_f‹r
 = 
Ãw
 
	`BulkBloomF‹r
(

);

58 } if(
h—d
 == "Block") {

59 
m_f‹r
 = 
Ãw
 
	`BlockBloomF‹r
(

);

60 } if(
h—d
 == "Multigrain"){

61 
m_f‹r
 = 
Ãw
 
	`MuÉiG¿šBloomF‹r
(

);

62 } if(
h—d
 == "MultiBitSel"){

63 
m_f‹r
 = 
Ãw
 
	`MuÉiB™S–BloomF‹r
(

);

64 } if(
h—d
 == "H3"){

65 
m_f‹r
 = 
Ãw
 
	`H3BloomF‹r
(

);

67 
	`as£¹
(0);

69 
	}
}

71 
	gG’”icBloomF‹r
::~
	$G’”icBloomF‹r
()

73 
d–‘e
 
m_f‹r
;

74 
	}
}

77 
	gG’”icBloomF‹r
::
	$ş—r
()

79 
m_f‹r
->
	`ş—r
();

80 
	}
}

83 
	gG’”icBloomF‹r
::
	$šüem’t
(cÚ¡ 
Add»ss
& 
addr
)

85 
m_f‹r
->
	`šüem’t
(
addr
);

86 
	}
}

89 
	gG’”icBloomF‹r
::
	$deüem’t
(cÚ¡ 
Add»ss
& 
addr
)

91 
m_f‹r
->
	`deüem’t
(
addr
);

92 
	}
}

95 
	gG’”icBloomF‹r
::
	$m”ge
(
G’”icBloomF‹r
 * 
Ùh”_f‹r
)

97 
m_f‹r
->
	`m”ge
(
Ùh”_f‹r
->
	`g‘F‹r
());

98 
	}
}

101 
	gG’”icBloomF‹r
::
	$£t
(cÚ¡ 
Add»ss
& 
addr
)

103 
m_f‹r
->
	`£t
(
addr
);

104 
	}
}

107 
	gG’”icBloomF‹r
::
	$un£t
(cÚ¡ 
Add»ss
& 
addr
)

109 
m_f‹r
->
	`un£t
(
addr
);

110 
	}
}

112 
boŞ


113 
	gG’”icBloomF‹r
::
	$isS‘
(cÚ¡ 
Add»ss
& 
addr
)

115  
m_f‹r
->
	`isS‘
(
addr
);

116 
	}
}

119 
	gG’”icBloomF‹r
::
	$g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
)

121  
m_f‹r
->
	`g‘CouÁ
(
addr
);

122 
	}
}

125 
	gG’”icBloomF‹r
::
	$g‘TÙ®CouÁ
()

127  
m_f‹r
->
	`g‘TÙ®CouÁ
();

128 
	}
}

131 
	gG’”icBloomF‹r
::
	$g‘Index
(cÚ¡ 
Add»ss
& 
addr
)

133  
m_f‹r
->
	`g‘Index
(
addr
);

134 
	}
}

137 
	gG’”icBloomF‹r
::
	$»adB™
(cÚ¡ 
šdex
)

139  
m_f‹r
->
	`»adB™
(
šdex
);

140 
	}
}

143 
	gG’”icBloomF‹r
::
	$wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
)

145 
m_f‹r
->
	`wr™eB™
(
šdex
, 
v®ue
);

146 
	}
}

149 
	gG’”icBloomF‹r
::
	$´št
(
o¡»am
& 
out
) const

151  
m_f‹r
->
	`´št
(
out
);

152 
	}
}

	@ruby/filters/GenericBloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_GENERICBLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_GENERICBLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

35 
	~"mem/ruby/commÚ/Add»ss.hh
"

36 
	~"mem/ruby/commÚ/Glob®.hh
"

37 
	~"mem/ruby/f‹rs/Ab¡¿ùBloomF‹r.hh
"

39 şas 
	cG’”icBloomF‹r


41 
	mpublic
:

42 
G’”icBloomF‹r
(
¡d
::
¡ršg
 
cÚfig
);

43 ~
G’”icBloomF‹r
();

45 
ş—r
();

46 
šüem’t
(cÚ¡ 
Add»ss
& 
addr
);

47 
deüem’t
(cÚ¡ 
Add»ss
& 
addr
);

48 
m”ge
(
G’”icBloomF‹r
 * 
Ùh”_f‹r
);

49 
£t
(cÚ¡ 
Add»ss
& 
addr
);

50 
un£t
(cÚ¡ 
Add»ss
& 
addr
);

51 
Ab¡¿ùBloomF‹r
 *

52 
	$g‘F‹r
()

54  
m_f‹r
;

57 
boŞ
 
	`isS‘
(cÚ¡ 
Add»ss
& 
addr
);

59 
	`g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
);

61 
	`g‘TÙ®CouÁ
();

63 
	`g‘Index
(cÚ¡ 
Add»ss
& 
addr
);

64 
	`»adB™
(cÚ¡ 
šdex
);

65 
	`wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
);

67 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

69 
´iv©e
:

70 
Ab¡¿ùBloomF‹r
* 
m_f‹r
;

71 
	}
};

73 
šlše
 
	g¡d
::
o¡»am
&

74 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gG’”icBloomF‹r
& 
	gobj
)

76 
	gobj
.
´št
(
out
);

77 
	gout
 << 
	g¡d
::
æush
;

78  
	gout
;

	@ruby/filters/H3BloomFilter.cc

29 
	~"ba£/štm©h.hh
"

30 
	~"ba£/¡r.hh
"

31 
	~"mem/ruby/f‹rs/H3BloomF‹r.hh
"

33 
usšg
 
Çme¥aû
 
	g¡d
;

35 
	gH3
[64][16] = {

357 
	gH3BloomF‹r
::
	$H3BloomF‹r
(
¡ršg
 
¡r
)

360 
´imes_li¡
[0] = 9323;

361 
´imes_li¡
[1] = 11279;

362 
´imes_li¡
[2] = 10247;

363 
´imes_li¡
[3] = 30637;

364 
´imes_li¡
[4] = 25717;

365 
´imes_li¡
[5] = 43711;

367 
muÉs_li¡
[0] = 255;

368 
muÉs_li¡
[1] = 29;

369 
muÉs_li¡
[2] = 51;

370 
muÉs_li¡
[3] = 3;

371 
muÉs_li¡
[4] = 77;

372 
muÉs_li¡
[5] = 43;

374 
adds_li¡
[0] = 841;

375 
adds_li¡
[1] = 627;

376 
adds_li¡
[2] = 1555;

377 
adds_li¡
[3] = 241;

378 
adds_li¡
[4] = 7777;

379 
adds_li¡
[5] = 65931;

381 
veùÜ
<
¡ršg
> 
™ems
;

382 
	`tok’ize
(
™ems
, 
¡r
, '_');

383 
	`as£¹
(
™ems
.
	`size
() == 3);

386 
m_f‹r_size
 = 
	`©oi
(
™ems
[0].
	`c_¡r
());

387 
m_num_hashes
 = 
	`©oi
(
™ems
[1].
	`c_¡r
());

389 ià(
™ems
[2] == "Regular") {

390 
isP¬®Ël
 = 
çl£
;

391 } ià(
™ems
[2] == "Parallel") {

392 
isP¬®Ël
 = 
Œue
;

394 
	`·nic
("ERROR: IncÜ»ù cÚfig sŒšg fÜ MuÉiHash Bloom! :%s", 
¡r
);

397 
m_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_f‹r_size
);

399 
m_·r_f‹r_size
 = 
m_f‹r_size
 / 
m_num_hashes
;

400 
m_·r_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_·r_f‹r_size
);

402 
m_f‹r
.
	`»size
(
m_f‹r_size
);

403 
	`ş—r
();

404 
	}
}

406 
	gH3BloomF‹r
::~
	$H3BloomF‹r
()

408 
	}
}

411 
H3BloomF‹r
::
	$ş—r
()

413 
i
 = 0; i < 
m_f‹r_size
; i++) {

414 
m_f‹r
[
i
] = 0;

416 
	}
}

419 
	gH3BloomF‹r
::
	$šüem’t
(cÚ¡ 
Add»ss
& 
addr
)

422 
	}
}

425 
H3BloomF‹r
::
	$deüem’t
(cÚ¡ 
Add»ss
& 
addr
)

428 
	}
}

431 
H3BloomF‹r
::
	$m”ge
(
Ab¡¿ùBloomF‹r
 *
Ùh”_f‹r
)

434 
H3BloomF‹r
 * 
‹mp
 = (H3BloomF‹r*è
Ùh”_f‹r
;

435 
i
 = 0; i < 
m_f‹r_size
; ++i){

436 
m_f‹r
[
i
] |ğ(*
‹mp
)[i];

438 
	}
}

441 
	gH3BloomF‹r
::
	$£t
(cÚ¡ 
Add»ss
& 
addr
)

443 
i
 = 0; i < 
m_num_hashes
; i++) {

444 
idx
 = 
	`g‘_šdex
(
addr
, 
i
);

445 
m_f‹r
[
idx
] = 1;

447 
	}
}

450 
	gH3BloomF‹r
::
	$un£t
(cÚ¡ 
Add»ss
& 
addr
)

452 
cout
 << "ERROR: Unset should‚ever be called in‡ Bloom filter";

453 
	`as£¹
(0);

454 
	}
}

456 
boŞ


457 
	gH3BloomF‹r
::
	$isS‘
(cÚ¡ 
Add»ss
& 
addr
)

459 
boŞ
 
»s
 = 
Œue
;

461 
i
 = 0; i < 
m_num_hashes
; i++) {

462 
idx
 = 
	`g‘_šdex
(
addr
, 
i
);

463 
»s
 =„e && 
m_f‹r
[
idx
];

465  
»s
;

466 
	}
}

469 
	gH3BloomF‹r
::
	$g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
)

471  
	`isS‘
(
addr
)? 1: 0;

472 
	}
}

475 
	gH3BloomF‹r
::
	$g‘Index
(cÚ¡ 
Add»ss
& 
addr
)

478 
	}
}

481 
	gH3BloomF‹r
::
	$»adB™
(cÚ¡ 
šdex
)

484 
	}
}

487 
	gH3BloomF‹r
::
	$wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
)

489 
	}
}

492 
	gH3BloomF‹r
::
	$g‘TÙ®CouÁ
()

494 
couÁ
 = 0;

496 
i
 = 0; i < 
m_f‹r_size
; i++) {

497 
couÁ
 +ğ
m_f‹r
[
i
];

499  
couÁ
;

500 
	}
}

503 
	gH3BloomF‹r
::
	$´št
(
o¡»am
& 
out
) const

505 
	}
}

508 
H3BloomF‹r
::
	$g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
, 
i
)

510 
ušt64
 
x
 = 
addr
.
	`g‘LšeAdd»ss
();

512 
y
 = 
	`hash_H3
(
x
,
i
);

514 ià(
isP¬®Ël
) {

515  (
y
 % 
m_·r_f‹r_size
è+ 
i
*m_par_filter_size;

517  
y
 % 
m_f‹r_size
;

519 
	}
}

522 
	gH3BloomF‹r
::
	$hash_H3
(
ušt64
 
v®ue
, 
šdex
)

524 
ušt64
 
mask
 = 1;

525 
ušt64
 
v®
 = 
v®ue
;

526 
»suÉ
 = 0;

528 
i
 = 0; i < 64; i++) {

529 if(
v®
&
mask
è
»suÉ
 ^ğ
H3
[
i
][
šdex
];

530 
v®
 = val >> 1;

532  
»suÉ
;

533 
	}
}

	@ruby/filters/H3BloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_H3BLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_H3BLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/f‹rs/Ab¡¿ùBloomF‹r.hh
"

39 
	~"mem/ruby/´of”/Prof”.hh
"

40 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

42 şas 
	cH3BloomF‹r
 : 
public
 
Ab¡¿ùBloomF‹r


44 
public
:

45 
H3BloomF‹r
(
¡d
::
¡ršg
 
cÚfig
);

46 ~
H3BloomF‹r
();

48 
ş—r
();

49 
šüem’t
(cÚ¡ 
Add»ss
& 
addr
);

50 
deüem’t
(cÚ¡ 
Add»ss
& 
addr
);

51 
m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
);

52 
£t
(cÚ¡ 
Add»ss
& 
addr
);

53 
un£t
(cÚ¡ 
Add»ss
& 
addr
);

55 
boŞ
 
isS‘
(cÚ¡ 
Add»ss
& 
addr
);

56 
g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
);

57 
g‘TÙ®CouÁ
();

58 
´št
(
¡d
::
o¡»am
& 
out
) const;

60 
g‘Index
(cÚ¡ 
Add»ss
& 
addr
);

61 
»adB™
(cÚ¡ 
šdex
);

62 
wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
);

65 
	mİ”©Ü
[](cÚ¡ 
	mšdex
) const

67  
	mthis
->
	mm_f‹r
[
šdex
];

70 
	g´iv©e
:

71 
g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
, 
hashNumb”
);

73 
hash_H3
(
ušt64
 
v®ue
, 
šdex
);

75 
	g¡d
::
veùÜ
<> 
m_f‹r
;

76 
	gm_f‹r_size
;

77 
	gm_num_hashes
;

78 
	gm_f‹r_size_b™s
;

80 
	gm_·r_f‹r_size
;

81 
	gm_·r_f‹r_size_b™s
;

83 
	g´imes_li¡
[6];

84 
	gmuÉs_li¡
[6];

85 
	gadds_li¡
[6];

87 
boŞ
 
	gisP¬®Ël
;

	@ruby/filters/LSB_CountingBloomFilter.cc

29 
	~"ba£/štm©h.hh
"

30 
	~"ba£/¡r.hh
"

31 
	~"mem/ruby/f‹rs/LSB_CouÁšgBloomF‹r.hh
"

32 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

34 
usšg
 
Çme¥aû
 
	g¡d
;

36 
	gLSB_CouÁšgBloomF‹r
::
	$LSB_CouÁšgBloomF‹r
(
¡ršg
 
¡r
)

38 
¡ršg
 
h—d
, 

;

39 #iâdeà
NDEBUG


40 
boŞ
 
sucûss
 =

42 
	`¥l™_fœ¡
(
¡r
, 
h—d
, 

, '_');

43 
	`as£¹
(
sucûss
);

45 
m_f‹r_size
 = 
	`©oi
(
h—d
.
	`c_¡r
());

46 
m_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_f‹r_size
);

48 
m_couÁ
 = 
	`©oi
(

.
	`c_¡r
());

49 
m_couÁ_b™s
 = 
	`æoÜLog2
(
m_couÁ
);

51 
m_f‹r
.
	`»size
(
m_f‹r_size
);

52 
	`ş—r
();

53 
	}
}

55 
	gLSB_CouÁšgBloomF‹r
::~
	$LSB_CouÁšgBloomF‹r
()

57 
	}
}

60 
LSB_CouÁšgBloomF‹r
::
	$ş—r
()

62 
i
 = 0; i < 
m_f‹r_size
; i++) {

63 
m_f‹r
[
i
] = 0;

65 
	}
}

68 
	gLSB_CouÁšgBloomF‹r
::
	$šüem’t
(cÚ¡ 
Add»ss
& 
addr
)

70 
i
 = 
	`g‘_šdex
(
addr
);

71 ià(
m_f‹r
[
i
] < 
m_couÁ
)

72 
m_f‹r
[
i
] += 1;

73 
	}
}

77 
	gLSB_CouÁšgBloomF‹r
::
	$deüem’t
(cÚ¡ 
Add»ss
& 
addr
)

79 
i
 = 
	`g‘_šdex
(
addr
);

80 ià(
m_f‹r
[
i
] > 0)

81 
m_f‹r
[
i
] -= 1;

82 
	}
}

85 
	gLSB_CouÁšgBloomF‹r
::
	$m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
)

88 
	}
}

91 
LSB_CouÁšgBloomF‹r
::
	$£t
(cÚ¡ 
Add»ss
& 
addr
)

94 
	}
}

97 
LSB_CouÁšgBloomF‹r
::
	$un£t
(cÚ¡ 
Add»ss
& 
addr
)

100 
	}
}

102 
boŞ


103 
LSB_CouÁšgBloomF‹r
::
	$isS‘
(cÚ¡ 
Add»ss
& 
addr
)

106  
çl£
;

107 
	}
}

110 
	gLSB_CouÁšgBloomF‹r
::
	$g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
)

112  
m_f‹r
[
	`g‘_šdex
(
addr
)];

113 
	}
}

116 
	gLSB_CouÁšgBloomF‹r
::
	$g‘TÙ®CouÁ
()

118 
couÁ
 = 0;

120 
i
 = 0; i < 
m_f‹r_size
; i++) {

121 
couÁ
 +ğ
m_f‹r
[
i
];

123  
couÁ
;

124 
	}
}

127 
	gLSB_CouÁšgBloomF‹r
::
	$g‘Index
(cÚ¡ 
Add»ss
& 
addr
)

129  
	`g‘_šdex
(
addr
);

130 
	}
}

133 
	gLSB_CouÁšgBloomF‹r
::
	$´št
(
o¡»am
& 
out
) const

135 
	}
}

138 
LSB_CouÁšgBloomF‹r
::
	$»adB™
(cÚ¡ 
šdex
)

142 
	}
}

145 
	gLSB_CouÁšgBloomF‹r
::
	$wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
)

148 
	}
}

151 
	gLSB_CouÁšgBloomF‹r
::
	$g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
)

153  
addr
.
	`b™S–eù
(
RubySy¡em
::
	`g‘BlockSizeB™s
(),

154 
RubySy¡em
::
	`g‘BlockSizeB™s
() +

155 
m_f‹r_size_b™s
 - 1);

156 
	}
}

	@ruby/filters/LSB_CountingBloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_LSBCOUNTINGBLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_LSBCOUNTINGBLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/f‹rs/Ab¡¿ùBloomF‹r.hh
"

40 şas 
	cLSB_CouÁšgBloomF‹r
 : 
public
 
Ab¡¿ùBloomF‹r


42 
public
:

43 
LSB_CouÁšgBloomF‹r
(
¡d
::
¡ršg
 
cÚfig
);

44 ~
LSB_CouÁšgBloomF‹r
();

46 
ş—r
();

47 
šüem’t
(cÚ¡ 
Add»ss
& 
addr
);

48 
deüem’t
(cÚ¡ 
Add»ss
& 
addr
);

49 
m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
);

50 
£t
(cÚ¡ 
Add»ss
& 
addr
);

51 
un£t
(cÚ¡ 
Add»ss
& 
addr
);

53 
boŞ
 
isS‘
(cÚ¡ 
Add»ss
& 
addr
);

54 
g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
);

55 
g‘TÙ®CouÁ
();

56 
g‘Index
(cÚ¡ 
Add»ss
& 
addr
);

57 
»adB™
(cÚ¡ 
šdex
);

58 
wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
);

60 
´št
(
¡d
::
o¡»am
& 
out
) const;

62 
	m´iv©e
:

63 
g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
);

65 
	m¡d
::
veùÜ
<> 
m_f‹r
;

66 
	mm_f‹r_size
;

67 
	mm_f‹r_size_b™s
;

69 
	mm_couÁ_b™s
;

70 
	mm_couÁ
;

	@ruby/filters/MultiBitSelBloomFilter.cc

29 
	~<veùÜ
>

31 
	~"ba£/štm©h.hh
"

32 
	~"ba£/¡r.hh
"

33 
	~"mem/ruby/f‹rs/MuÉiB™S–BloomF‹r.hh
"

35 
usšg
 
Çme¥aû
 
	g¡d
;

37 
	gMuÉiB™S–BloomF‹r
::
	$MuÉiB™S–BloomF‹r
(
¡ršg
 
¡r
)

39 
veùÜ
<
¡ršg
> 
™ems
;

40 
	`tok’ize
(
™ems
, 
¡r
, '_');

41 
	`as£¹
(
™ems
.
	`size
() == 4);

44 
m_f‹r_size
 = 
	`©oi
(
™ems
[0].
	`c_¡r
());

45 
m_num_hashes
 = 
	`©oi
(
™ems
[1].
	`c_¡r
());

46 
m_sk_b™s
 = 
	`©oi
(
™ems
[2].
	`c_¡r
());

48 ià(
™ems
[3] == "Regular") {

49 
isP¬®Ël
 = 
çl£
;

50 } ià(
™ems
[3] == "Parallel") {

51 
isP¬®Ël
 = 
Œue
;

53 
	`·nic
("ERROR: Incorrect config string for MultiBitSel Bloom! :%s",

54 
¡r
);

57 
m_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_f‹r_size
);

59 
m_·r_f‹r_size
 = 
m_f‹r_size
 / 
m_num_hashes
;

60 
m_·r_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_·r_f‹r_size
);

62 
m_f‹r
.
	`»size
(
m_f‹r_size
);

63 
	`ş—r
();

64 
	}
}

66 
	gMuÉiB™S–BloomF‹r
::~
	$MuÉiB™S–BloomF‹r
()

68 
	}
}

71 
MuÉiB™S–BloomF‹r
::
	$ş—r
()

73 
i
 = 0; i < 
m_f‹r_size
; i++) {

74 
m_f‹r
[
i
] = 0;

76 
	}
}

79 
	gMuÉiB™S–BloomF‹r
::
	$šüem’t
(cÚ¡ 
Add»ss
& 
addr
)

82 
	}
}

86 
MuÉiB™S–BloomF‹r
::
	$deüem’t
(cÚ¡ 
Add»ss
& 
addr
)

89 
	}
}

92 
MuÉiB™S–BloomF‹r
::
	$m”ge
(
Ab¡¿ùBloomF‹r
 *
Ùh”_f‹r
)

95 
MuÉiB™S–BloomF‹r
 * 
‹mp
 = (MuÉiB™S–BloomF‹r*è
Ùh”_f‹r
;

96 
i
 = 0; i < 
m_f‹r_size
; ++i){

97 
m_f‹r
[
i
] |ğ(*
‹mp
)[i];

99 
	}
}

102 
	gMuÉiB™S–BloomF‹r
::
	$£t
(cÚ¡ 
Add»ss
& 
addr
)

104 
i
 = 0; i < 
m_num_hashes
; i++) {

105 
idx
 = 
	`g‘_šdex
(
addr
, 
i
);

106 
m_f‹r
[
idx
] = 1;

108 
	}
}

111 
	gMuÉiB™S–BloomF‹r
::
	$un£t
(cÚ¡ 
Add»ss
& 
addr
)

113 
cout
 << "ERROR: Unset should‚ever be called in‡ Bloom filter";

114 
	`as£¹
(0);

115 
	}
}

117 
boŞ


118 
	gMuÉiB™S–BloomF‹r
::
	$isS‘
(cÚ¡ 
Add»ss
& 
addr
)

120 
boŞ
 
»s
 = 
Œue
;

122 
i
=0; i < 
m_num_hashes
; i++) {

123 
idx
 = 
	`g‘_šdex
(
addr
, 
i
);

124 
»s
 =„e && 
m_f‹r
[
idx
];

126  
»s
;

127 
	}
}

130 
	gMuÉiB™S–BloomF‹r
::
	$g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
)

132  
	`isS‘
(
addr
)? 1: 0;

133 
	}
}

136 
	gMuÉiB™S–BloomF‹r
::
	$g‘Index
(cÚ¡ 
Add»ss
& 
addr
)

139 
	}
}

142 
	gMuÉiB™S–BloomF‹r
::
	$»adB™
(cÚ¡ 
šdex
)

145 
	}
}

148 
	gMuÉiB™S–BloomF‹r
::
	$wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
)

150 
	}
}

153 
	gMuÉiB™S–BloomF‹r
::
	$g‘TÙ®CouÁ
()

155 
couÁ
 = 0;

157 
i
 = 0; i < 
m_f‹r_size
; i++) {

158 
couÁ
 +ğ
m_f‹r
[
i
];

160  
couÁ
;

161 
	}
}

164 
	gMuÉiB™S–BloomF‹r
::
	$´št
(
o¡»am
& 
out
) const

166 
	}
}

169 
MuÉiB™S–BloomF‹r
::
	$g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
, 
i
)

174 
ušt64
 
x
 = (
addr
.
	`g‘LšeAdd»ss
()è>> 
m_sk_b™s
;

175 
y
 = 
	`hash_b™£l
(
x
, 
i
, 
m_num_hashes
, 30, 
m_f‹r_size_b™s
);

178 ià(
isP¬®Ël
) {

179  (
y
 % 
m_·r_f‹r_size
è+ 
i
*m_par_filter_size;

181  
y
 % 
m_f‹r_size
;

183 
	}
}

186 
	gMuÉiB™S–BloomF‹r
::
	$hash_b™£l
(
ušt64
 
v®ue
, 
šdex
, 
jump
,

187 
maxB™s
, 
numB™s
)

189 
ušt64
 
mask
 = 1;

190 
»suÉ
 = 0;

191 
b™
, 
i
;

193 
i
 = 0; i < 
numB™s
; i++) {

194 
b™
 = (
šdex
 + 
jump
*
i
è% 
maxB™s
;

195 ià(
v®ue
 & (
mask
 << 
b™
)è
»suÉ
 +ğmask << 
i
;

197  
»suÉ
;

198 
	}
}

	@ruby/filters/MultiBitSelBloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_MULTIBITSELBLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_MULTIBITSELBLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/f‹rs/Ab¡¿ùBloomF‹r.hh
"

39 
	~"mem/ruby/´of”/Prof”.hh
"

40 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

42 şas 
	cMuÉiB™S–BloomF‹r
 : 
public
 
Ab¡¿ùBloomF‹r


44 
public
:

45 
MuÉiB™S–BloomF‹r
(
¡d
::
¡ršg
 
cÚfig
);

46 ~
MuÉiB™S–BloomF‹r
();

48 
ş—r
();

49 
šüem’t
(cÚ¡ 
Add»ss
& 
addr
);

50 
deüem’t
(cÚ¡ 
Add»ss
& 
addr
);

51 
m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
);

52 
£t
(cÚ¡ 
Add»ss
& 
addr
);

53 
un£t
(cÚ¡ 
Add»ss
& 
addr
);

55 
boŞ
 
isS‘
(cÚ¡ 
Add»ss
& 
addr
);

56 
g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
);

57 
g‘TÙ®CouÁ
();

58 
´št
(
¡d
::
o¡»am
& 
out
) const;

60 
g‘Index
(cÚ¡ 
Add»ss
& 
addr
);

61 
»adB™
(cÚ¡ 
šdex
);

62 
wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
);

65 
	mİ”©Ü
[](cÚ¡ 
	mšdex
) const

67  
	mthis
->
	mm_f‹r
[
šdex
];

70 
	g´iv©e
:

71 
g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
, 
hashNumb”
);

73 
hash_b™£l
(
ušt64
 
v®ue
, 
šdex
, 
jump
, 
maxB™s
,

74 
numB™s
);

76 
	g¡d
::
veùÜ
<> 
m_f‹r
;

77 
	gm_f‹r_size
;

78 
	gm_num_hashes
;

79 
	gm_f‹r_size_b™s
;

80 
	gm_sk_b™s
;

82 
	gm_·r_f‹r_size
;

83 
	gm_·r_f‹r_size_b™s
;

85 
boŞ
 
	gisP¬®Ël
;

	@ruby/filters/MultiGrainBloomFilter.cc

29 
	~"ba£/štm©h.hh
"

30 
	~"ba£/¡r.hh
"

31 
	~"mem/ruby/f‹rs/MuÉiG¿šBloomF‹r.hh
"

32 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

34 
usšg
 
Çme¥aû
 
	g¡d
;

36 
	gMuÉiG¿šBloomF‹r
::
	$MuÉiG¿šBloomF‹r
(
¡ršg
 
¡r
)

38 
¡ršg
 
h—d
, 

;

39 #iâdeà
NDEBUG


40 
boŞ
 
sucûss
 =

42 
	`¥l™_fœ¡
(
¡r
, 
h—d
, 

, '_');

43 
	`as£¹
(
sucûss
);

48 
m_f‹r_size
 = 
	`©oi
(
h—d
.
	`c_¡r
());

49 
m_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_f‹r_size
);

51 
m_·ge_f‹r_size
 = 
	`©oi
(

.
	`c_¡r
());

52 
m_·ge_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_·ge_f‹r_size
);

54 
m_f‹r
.
	`»size
(
m_f‹r_size
);

55 
m_·ge_f‹r
.
	`»size
(
m_·ge_f‹r_size
);

56 
	`ş—r
();

57 
	}
}

59 
	gMuÉiG¿šBloomF‹r
::~
	$MuÉiG¿šBloomF‹r
()

61 
	}
}

64 
MuÉiG¿šBloomF‹r
::
	$ş—r
()

66 
i
 = 0; i < 
m_f‹r_size
; i++) {

67 
m_f‹r
[
i
] = 0;

69 
i
=0; i < 
m_·ge_f‹r_size
; ++i){

70 
m_·ge_f‹r
[
i
] = 0;

72 
	}
}

75 
	gMuÉiG¿šBloomF‹r
::
	$šüem’t
(cÚ¡ 
Add»ss
& 
addr
)

78 
	}
}

82 
MuÉiG¿šBloomF‹r
::
	$deüem’t
(cÚ¡ 
Add»ss
& 
addr
)

85 
	}
}

88 
MuÉiG¿šBloomF‹r
::
	$m”ge
(
Ab¡¿ùBloomF‹r
 *
Ùh”_f‹r
)

91 
	}
}

94 
MuÉiG¿šBloomF‹r
::
	$£t
(cÚ¡ 
Add»ss
& 
addr
)

96 
i
 = 
	`g‘_block_šdex
(
addr
);

97 
	`as£¹
(
i
 < 
m_f‹r_size
);

98 
	`as£¹
(
	`g‘_·ge_šdex
(
addr
è< 
m_·ge_f‹r_size
);

99 
m_f‹r
[
i
] = 1;

100 
m_·ge_f‹r
[
i
] = 1;

102 
	}
}

105 
	gMuÉiG¿šBloomF‹r
::
	$un£t
(cÚ¡ 
Add»ss
& 
addr
)

108 
	}
}

110 
boŞ


111 
MuÉiG¿šBloomF‹r
::
	$isS‘
(cÚ¡ 
Add»ss
& 
addr
)

113 
i
 = 
	`g‘_block_šdex
(
addr
);

114 
	`as£¹
(
i
 < 
m_f‹r_size
);

115 
	`as£¹
(
	`g‘_·ge_šdex
(
addr
è< 
m_·ge_f‹r_size
);

117  (
m_f‹r
[
i
] && 
m_·ge_f‹r
[i]);

118 
	}
}

121 
	gMuÉiG¿šBloomF‹r
::
	$g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
)

125 
	}
}

128 
	gMuÉiG¿šBloomF‹r
::
	$g‘TÙ®CouÁ
()

130 
couÁ
 = 0;

132 
i
 = 0; i < 
m_f‹r_size
; i++) {

133 
couÁ
 +ğ
m_f‹r
[
i
];

136 
i
=0; i < 
m_·ge_f‹r_size
; ++i) {

137 
couÁ
 +ğ
m_·ge_f‹r
[
i
] = 0;

140  
couÁ
;

141 
	}
}

144 
	gMuÉiG¿šBloomF‹r
::
	$g‘Index
(cÚ¡ 
Add»ss
& 
addr
)

148 
	}
}

151 
	gMuÉiG¿šBloomF‹r
::
	$»adB™
(cÚ¡ 
šdex
)

155 
	}
}

158 
	gMuÉiG¿šBloomF‹r
::
	$wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
)

161 
	}
}

164 
	gMuÉiG¿šBloomF‹r
::
	$´št
(
o¡»am
& 
out
) const

166 
	}
}

169 
MuÉiG¿šBloomF‹r
::
	$g‘_block_šdex
(cÚ¡ 
Add»ss
& 
addr
)

172  
addr
.
	`b™S–eù
(
RubySy¡em
::
	`g‘BlockSizeB™s
(),

173 
RubySy¡em
::
	`g‘BlockSizeB™s
() +

174 
m_f‹r_size_b™s
 - 1);

175 
	}
}

178 
	gMuÉiG¿šBloomF‹r
::
	$g‘_·ge_šdex
(cÚ¡ 
Add»ss
 & 
addr
)

180 
b™s
 = 
RubySy¡em
::
	`g‘BlockSizeB™s
(è+ 
m_f‹r_size_b™s
 - 1;

183  
addr
.
	`b™S–eù
(
b™s
, b™ + 
m_·ge_f‹r_size_b™s
 - 1);

184 
	}
}

	@ruby/filters/MultiGrainBloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_MULTIGRAINBLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_MULTIGRAINBLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/f‹rs/Ab¡¿ùBloomF‹r.hh
"

40 şas 
	cMuÉiG¿šBloomF‹r
 : 
public
 
Ab¡¿ùBloomF‹r


42 
public
:

43 
MuÉiG¿šBloomF‹r
(
¡d
::
¡ršg
 
¡r
);

44 ~
MuÉiG¿šBloomF‹r
();

46 
ş—r
();

47 
šüem’t
(cÚ¡ 
Add»ss
& 
addr
);

48 
deüem’t
(cÚ¡ 
Add»ss
& 
addr
);

49 
m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
);

50 
£t
(cÚ¡ 
Add»ss
& 
addr
);

51 
un£t
(cÚ¡ 
Add»ss
& 
addr
);

53 
boŞ
 
isS‘
(cÚ¡ 
Add»ss
& 
addr
);

54 
g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
);

55 
g‘TÙ®CouÁ
();

56 
g‘Index
(cÚ¡ 
Add»ss
& 
addr
);

57 
»adB™
(cÚ¡ 
šdex
);

58 
wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
);

60 
´št
(
¡d
::
o¡»am
& 
out
) const;

62 
	m´iv©e
:

63 
g‘_block_šdex
(cÚ¡ 
Add»ss
& 
addr
);

64 
g‘_·ge_šdex
(cÚ¡ 
Add»ss
 & 
addr
);

67 
	m¡d
::
veùÜ
<> 
m_f‹r
;

68 
	mm_f‹r_size
;

69 
	mm_f‹r_size_b™s
;

71 
	m¡d
::
veùÜ
<> 
m_·ge_f‹r
;

72 
	mm_·ge_f‹r_size
;

73 
	mm_·ge_f‹r_size_b™s
;

	@ruby/filters/NonCountingBloomFilter.cc

29 
	~"ba£/štm©h.hh
"

30 
	~"ba£/¡r.hh
"

31 
	~"mem/ruby/f‹rs/NÚCouÁšgBloomF‹r.hh
"

32 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

34 
usšg
 
Çme¥aû
 
	g¡d
;

36 
	gNÚCouÁšgBloomF‹r
::
	$NÚCouÁšgBloomF‹r
(
¡ršg
 
¡r
)

38 
¡ršg
 
h—d
, 

;

39 #iâdeà
NDEBUG


40 
boŞ
 
sucûss
 =

42 
	`¥l™_fœ¡
(
¡r
, 
h—d
, 

, '_');

43 
	`as£¹
(
sucûss
);

46 
m_f‹r_size
 = 
	`©oi
(
h—d
.
	`c_¡r
());

47 
m_off£t
 = 
	`©oi
(

.
	`c_¡r
());

48 
m_f‹r_size_b™s
 = 
	`æoÜLog2
(
m_f‹r_size
);

50 
m_f‹r
.
	`»size
(
m_f‹r_size
);

51 
	`ş—r
();

52 
	}
}

54 
	gNÚCouÁšgBloomF‹r
::~
	$NÚCouÁšgBloomF‹r
()

56 
	}
}

59 
NÚCouÁšgBloomF‹r
::
	$ş—r
()

61 
i
 = 0; i < 
m_f‹r_size
; i++) {

62 
m_f‹r
[
i
] = 0;

64 
	}
}

67 
	gNÚCouÁšgBloomF‹r
::
	$šüem’t
(cÚ¡ 
Add»ss
& 
addr
)

70 
	}
}

73 
NÚCouÁšgBloomF‹r
::
	$deüem’t
(cÚ¡ 
Add»ss
& 
addr
)

76 
	}
}

79 
NÚCouÁšgBloomF‹r
::
	$m”ge
(
Ab¡¿ùBloomF‹r
 *
Ùh”_f‹r
)

82 
NÚCouÁšgBloomF‹r
 * 
‹mp
 = (NÚCouÁšgBloomF‹r*è
Ùh”_f‹r
;

83 
i
 = 0; i < 
m_f‹r_size
; ++i){

84 
m_f‹r
[
i
] |ğ(*
‹mp
)[i];

86 
	}
}

89 
	gNÚCouÁšgBloomF‹r
::
	$£t
(cÚ¡ 
Add»ss
& 
addr
)

91 
i
 = 
	`g‘_šdex
(
addr
);

92 
m_f‹r
[
i
] = 1;

93 
	}
}

96 
	gNÚCouÁšgBloomF‹r
::
	$un£t
(cÚ¡ 
Add»ss
& 
addr
)

98 
i
 = 
	`g‘_šdex
(
addr
);

99 
m_f‹r
[
i
] = 0;

100 
	}
}

102 
boŞ


103 
	gNÚCouÁšgBloomF‹r
::
	$isS‘
(cÚ¡ 
Add»ss
& 
addr
)

105 
i
 = 
	`g‘_šdex
(
addr
);

106  (
m_f‹r
[
i
]);

107 
	}
}

111 
	gNÚCouÁšgBloomF‹r
::
	$g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
)

113  
m_f‹r
[
	`g‘_šdex
(
addr
)];

114 
	}
}

117 
	gNÚCouÁšgBloomF‹r
::
	$g‘TÙ®CouÁ
()

119 
couÁ
 = 0;

121 
i
 = 0; i < 
m_f‹r_size
; i++) {

122 
couÁ
 +ğ
m_f‹r
[
i
];

124  
couÁ
;

125 
	}
}

128 
	gNÚCouÁšgBloomF‹r
::
	$´št
(
o¡»am
& 
out
) const

130 
	}
}

133 
NÚCouÁšgBloomF‹r
::
	$g‘Index
(cÚ¡ 
Add»ss
& 
addr
)

135  
	`g‘_šdex
(
addr
);

136 
	}
}

139 
	gNÚCouÁšgBloomF‹r
::
	$»adB™
(cÚ¡ 
šdex
)

141  
m_f‹r
[
šdex
];

142 
	}
}

145 
	gNÚCouÁšgBloomF‹r
::
	$wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
)

147 
m_f‹r
[
šdex
] = 
v®ue
;

148 
	}
}

151 
	gNÚCouÁšgBloomF‹r
::
	$g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
)

153  
addr
.
	`b™S–eù
(
RubySy¡em
::
	`g‘BlockSizeB™s
(è+ 
m_off£t
,

154 
RubySy¡em
::
	`g‘BlockSizeB™s
(è+ 
m_off£t
 +

155 
m_f‹r_size_b™s
 - 1);

156 
	}
}

	@ruby/filters/NonCountingBloomFilter.hh

29 #iâdeà
__MEM_RUBY_FILTERS_NONCOUNTINGBLOOMFILTER_HH__


30 
	#__MEM_RUBY_FILTERS_NONCOUNTINGBLOOMFILTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/f‹rs/Ab¡¿ùBloomF‹r.hh
"

40 şas 
	cNÚCouÁšgBloomF‹r
 : 
public
 
Ab¡¿ùBloomF‹r


42 
public
:

43 
NÚCouÁšgBloomF‹r
(
¡d
::
¡ršg
 
cÚfig
);

44 ~
NÚCouÁšgBloomF‹r
();

46 
ş—r
();

47 
šüem’t
(cÚ¡ 
Add»ss
& 
addr
);

48 
deüem’t
(cÚ¡ 
Add»ss
& 
addr
);

49 
m”ge
(
Ab¡¿ùBloomF‹r
 * 
Ùh”_f‹r
);

50 
£t
(cÚ¡ 
Add»ss
& 
addr
);

51 
un£t
(cÚ¡ 
Add»ss
& 
addr
);

53 
boŞ
 
isS‘
(cÚ¡ 
Add»ss
& 
addr
);

54 
g‘CouÁ
(cÚ¡ 
Add»ss
& 
addr
);

55 
g‘TÙ®CouÁ
();

57 
g‘Index
(cÚ¡ 
Add»ss
& 
addr
);

58 
»adB™
(cÚ¡ 
šdex
);

59 
wr™eB™
(cÚ¡ 
šdex
, cÚ¡ 
v®ue
);

61 
´št
(
¡d
::
o¡»am
& 
out
) const;

64 
	mİ”©Ü
[](cÚ¡ 
	mšdex
) const

66  
	mthis
->
	mm_f‹r
[
šdex
];

69 
	g´iv©e
:

70 
g‘_šdex
(cÚ¡ 
Add»ss
& 
addr
);

72 
	g¡d
::
veùÜ
<> 
m_f‹r
;

73 
	gm_f‹r_size
;

74 
	gm_off£t
;

75 
	gm_f‹r_size_b™s
;

	@ruby/network/BasicLink.cc

29 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

31 
	gBasicLšk
::
	$BasicLšk
(cÚ¡ 
P¬ams
 *
p
)

32 : 
	$SimObjeù
(
p
)

34 
m_Ï‹ncy
 = 
p
->
Ï‹ncy
;

35 
m_bªdwidth_çùÜ
 = 
p
->
bªdwidth_çùÜ
;

36 
m_weight
 = 
p
->
weight
;

37 
	}
}

40 
	gBasicLšk
::
	$š™
()

42 
	}
}

45 
BasicLšk
::
´št
(
¡d
::
o¡»am
& 
out
) const

47 
out
 << 
Çme
();

50 
BasicLšk
 *

51 
	gBasicLškP¬ams
::
	$ü—‹
()

53  
Ãw
 
	`BasicLšk
(
this
);

54 
	}
}

56 
	gBasicExtLšk
::
	$BasicExtLšk
(cÚ¡ 
P¬ams
 *
p
)

57 : 
	$BasicLšk
(
p
)

59 
m_št_node
 = 
p
->
št_node
;

60 
m_ext_node
 = 
p
->
ext_node
;

61 
	}
}

63 
BasicExtLšk
 *

64 
	gBasicExtLškP¬ams
::
	$ü—‹
()

66  
Ãw
 
	`BasicExtLšk
(
this
);

67 
	}
}

69 
	gBasicIÁLšk
::
	$BasicIÁLšk
(cÚ¡ 
P¬ams
 *
p
)

70 : 
	$BasicLšk
(
p
)

72 
m_node_a
 = 
p
->
node_a
;

73 
m_node_b
 = 
p
->
node_b
;

74 
	}
}

76 
BasicIÁLšk
 *

77 
	gBasicIÁLškP¬ams
::
	$ü—‹
()

79  
Ãw
 
	`BasicIÁLšk
(
this
);

80 
	}
}

	@ruby/network/BasicLink.hh

29 #iâdeà
__MEM_RUBY_NETWORK_BASIC_LINK_HH__


30 
	#__MEM_RUBY_NETWORK_BASIC_LINK_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"·¿ms/BasicExtLšk.hh
"

37 
	~"·¿ms/BasicIÁLšk.hh
"

38 
	~"·¿ms/BasicLšk.hh
"

39 
	~"mem/ruby/ÃtwÜk/BasicRou‹r.hh
"

40 
	~"mem/ruby/ÃtwÜk/TİŞogy.hh
"

41 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùCÚŒŞËr.hh
"

42 
	~"sim/sim_objeù.hh
"

44 şas 
	cBasicLšk
 : 
public
 
SimObjeù


46 
public
:

47 
BasicLškP¬ams
 
	tP¬ams
;

48 
BasicLšk
(cÚ¡ 
P¬ams
 *
p
);

49 cÚ¡ 
P¬ams
 *
	$·¿ms
(ècÚ¡ {  (cÚ¡ 
P¬ams
 *)
_·¿ms
; }

51 
	`š™
();

53 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

55 
Cyşes
 
m_Ï‹ncy
;

56 
m_bªdwidth_çùÜ
;

57 
m_weight
;

58 
	}
};

60 
šlše
 
	g¡d
::
o¡»am
&

61 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gBasicLšk
& 
	gobj
)

63 
	gobj
.
´št
(
out
);

64 
	gout
 << 
	g¡d
::
æush
;

65  
	gout
;

68 şas 
	cBasicExtLšk
 : 
public
 
BasicLšk


70 
public
:

71 
BasicExtLškP¬ams
 
	tP¬ams
;

72 
BasicExtLšk
(cÚ¡ 
P¬ams
 *
p
);

73 cÚ¡ 
P¬ams
 *
	$·¿ms
(ècÚ¡ {  (cÚ¡ 
P¬ams
 *)
_·¿ms
; }

75 
ä›nd
 
şass
 
TİŞogy
;

77 
´Ùeùed
:

78 
BasicRou‹r
* 
m_št_node
;

79 
Ab¡¿ùCÚŒŞËr
* 
m_ext_node
;

80 
	}
};

82 şas 
	cBasicIÁLšk
 : 
public
 
BasicLšk


84 
public
:

85 
BasicIÁLškP¬ams
 
	tP¬ams
;

86 
BasicIÁLšk
(cÚ¡ 
P¬ams
 *
p
);

87 cÚ¡ 
P¬ams
 *
	$·¿ms
(ècÚ¡ {  (cÚ¡ 
P¬ams
 *)
_·¿ms
; }

89 
ä›nd
 
şass
 
TİŞogy
;

91 
´Ùeùed
:

92 
BasicRou‹r
* 
m_node_a
;

93 
BasicRou‹r
* 
m_node_b
;

94 
	}
};

	@ruby/network/BasicRouter.cc

29 
	~"mem/ruby/ÃtwÜk/BasicRou‹r.hh
"

31 
	gBasicRou‹r
::
	$BasicRou‹r
(cÚ¡ 
P¬ams
 *
p
)

32 : 
	$ClockedObjeù
(
p
)

34 
m_id
 = 
p
->
rou‹r_id
;

35 
	}
}

38 
	gBasicRou‹r
::
	$š™
()

40 
	}
}

43 
BasicRou‹r
::
´št
(
¡d
::
o¡»am
& 
out
) const

45 
out
 << 
Çme
();

48 
BasicRou‹r
 *

49 
	gBasicRou‹rP¬ams
::
	$ü—‹
()

51  
Ãw
 
	`BasicRou‹r
(
this
);

52 
	}
}

	@ruby/network/BasicRouter.hh

29 #iâdeà
__MEM_RUBY_NETWORK_BASIC_ROUTER_HH__


30 
	#__MEM_RUBY_NETWORK_BASIC_ROUTER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"·¿ms/BasicRou‹r.hh
"

37 
	~"sim/şocked_objeù.hh
"

39 şas 
	cBasicRou‹r
 : 
public
 
ClockedObjeù


41 
public
:

42 
BasicRou‹rP¬ams
 
	tP¬ams
;

43 
BasicRou‹r
(cÚ¡ 
P¬ams
 *
p
);

44 cÚ¡ 
P¬ams
 *
	$·¿ms
(ècÚ¡ {  (cÚ¡ 
P¬ams
 *)
_·¿ms
; }

46 
	`š™
();

48 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

50 
ä›nd
 
şass
 
TİŞogy
;

52 
´Ùeùed
:

56 
ušt32_t
 
m_id
;

57 
	}
};

59 
šlše
 
	g¡d
::
o¡»am
&

60 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gBasicRou‹r
& 
	gobj
)

62 
	gobj
.
´št
(
out
);

63 
	gout
 << 
	g¡d
::
æush
;

64  
	gout
;

	@ruby/network/Network.cc

29 
	~"ba£/misc.hh
"

30 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

31 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

32 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

33 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

35 
ušt32_t
 
	gN‘wÜk
::
m_vœtu®_ÃtwÜks
;

36 
ušt32_t
 
	gN‘wÜk
::
m_cÚŒŞ_msg_size
;

37 
ušt32_t
 
	gN‘wÜk
::
m_d©a_msg_size
;

39 
	gN‘wÜk
::
	$N‘wÜk
(cÚ¡ 
P¬ams
 *
p
)

40 : 
	$ClockedObjeù
(
p
)

42 
m_vœtu®_ÃtwÜks
 = 
p
->
numb”_of_vœtu®_ÃtwÜks
;

43 
m_cÚŒŞ_msg_size
 = 
p
->
cÚŒŞ_msg_size
;

47 
m_nodes
 = 
	`MachšeTy³_ba£_numb”
(
MachšeTy³_NUM
);

48 
	`as£¹
(
m_nodes
 != 0);

49 
	`as£¹
(
m_vœtu®_ÃtwÜks
 != 0);

51 
m_tİŞogy_±r
 = 
Ãw
 
	`TİŞogy
(
p
->
rou‹rs
.
	`size
(),…->
ext_lšks
,

52 
p
->
št_lšks
);

53 
p
->
ruby_sy¡em
->
	`»gi¡”N‘wÜk
(
this
);

56 
¡d
::
veùÜ
<
BasicExtLšk
*>::
cÚ¡_™”©Ü
 
i
 = 
p
->
ext_lšks
.
	`begš
();

57 
i
 !ğ
p
->
ext_lšks
.
	`’d
(); ++i) {

58 
BasicExtLšk
 *
ext_lšk
 = (*
i
);

59 
Ab¡¿ùCÚŒŞËr
 *
abs_úŒl
 = 
ext_lšk
->
	`·¿ms
()->
ext_node
;

60 
abs_úŒl
->
	`š™N‘wÜkPŒ
(
this
);

64 
Sts
::
	`»gi¡”DumpC®lback
(
Ãw
 
	`StsC®lback
(
this
));

65 
	}
}

68 
	gN‘wÜk
::
	$š™
()

70 
m_d©a_msg_size
 = 
RubySy¡em
::
	`g‘BlockSizeBy‹s
(è+ 
m_cÚŒŞ_msg_size
;

71 
	}
}

73 
ušt32_t


74 
	gN‘wÜk
::
	$Mes§geSizeTy³_to_št
(
Mes§geSizeTy³
 
size_ty³
)

76 
size_ty³
) {

77 
Mes§geSizeTy³_CÚŒŞ
:

78 
Mes§geSizeTy³_Reque¡_CÚŒŞ
:

79 
Mes§geSizeTy³_Reissue_CÚŒŞ
:

80 
Mes§geSizeTy³_Re¥Ú£_CÚŒŞ
:

81 
Mes§geSizeTy³_Wr™eback_CÚŒŞ
:

82 
Mes§geSizeTy³_Brßdÿ¡_CÚŒŞ
:

83 
Mes§geSizeTy³_MuÉiÿ¡_CÚŒŞ
:

84 
Mes§geSizeTy³_FÜw¬ded_CÚŒŞ
:

85 
Mes§geSizeTy³_Inv®id©e_CÚŒŞ
:

86 
Mes§geSizeTy³_Unblock_CÚŒŞ
:

87 
Mes§geSizeTy³_P”si¡’t_CÚŒŞ
:

88 
Mes§geSizeTy³_Com¶‘iÚ_CÚŒŞ
:

89  
m_cÚŒŞ_msg_size
;

90 
Mes§geSizeTy³_D©a
:

91 
Mes§geSizeTy³_Re¥Ú£_D©a
:

92 
Mes§geSizeTy³_Re¥Ú£Loÿl_D©a
:

93 
Mes§geSizeTy³_Re¥Ú£L2h™_D©a
:

94 
Mes§geSizeTy³_Wr™eback_D©a
:

95  
m_d©a_msg_size
;

97 
	`·nic
("Invalid„ange forype MessageSizeType");

100 
	}
}

102 cÚ¡ 
	g¡d
::
veùÜ
<
ThrÙe
*>*

103 
N‘wÜk
::
	$g‘ThrÙes
(
NodeID
 
id
) const

105  
NULL
;

106 
	}
}

	@ruby/network/Network.hh

40 #iâdeà
__MEM_RUBY_NETWORK_NETWORK_HH__


41 
	#__MEM_RUBY_NETWORK_NETWORK_HH__


	)

43 
	~<io¡»am
>

44 
	~<¡ršg
>

45 
	~<veùÜ
>

47 
	~"mem/´ÙocŞ/LškDœeùiÚ.hh
"

48 
	~"mem/´ÙocŞ/Mes§geSizeTy³.hh
"

49 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

50 
	~"mem/ruby/ÃtwÜk/TİŞogy.hh
"

51 
	~"mem/·ck‘.hh
"

52 
	~"·¿ms/RubyN‘wÜk.hh
"

53 
	~"sim/şocked_objeù.hh
"

55 
şass
 
	gN‘De¡
;

56 
şass
 
	gMes§geBufãr
;

57 
şass
 
	gThrÙe
;

59 şas 
	cN‘wÜk
 : 
public
 
ClockedObjeù


61 
public
:

62 
RubyN‘wÜkP¬ams
 
	tP¬ams
;

63 
N‘wÜk
(cÚ¡ 
P¬ams
 *
p
);

64 
	mvœtu®
 ~
	$N‘wÜk
() {}

65 cÚ¡ 
P¬ams
 * 
	$·¿ms
() const

66 {  
dyÇmic_ÿ¡
<cÚ¡ 
P¬ams
 *>(
_·¿ms
);
	}
}

68 
vœtu®
 
š™
();

70 
ušt32_t
 
	$g‘Numb”OfVœtu®N‘wÜks
(è{  
m_vœtu®_ÃtwÜks
; 
	}
}

71 
ušt32_t
 
Mes§geSizeTy³_to_št
(
Mes§geSizeTy³
 
size_ty³
);

74 
vœtu®
 
Mes§geBufãr
* 
g‘ToN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
,

75 
ÃtNumb”
, 
¡d
::
¡ršg
 
vÃt_ty³
) = 0;

76 
vœtu®
 
Mes§geBufãr
* 
g‘FromN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
,

77 
ÃtNumb”
, 
¡d
::
¡ršg
 
vÃt_ty³
) = 0;

78 
vœtu®
 cÚ¡ 
	g¡d
::
veùÜ
<
ThrÙe
*>* 
	$g‘ThrÙes
(
NodeID
 
id
) const;

79 
vœtu®
 
	$g‘NumNodes
(è{ 1;
	}
}

81 
vœtu®
 
makeOutLšk
(
Sw™chID
 
¤c
, 
NodeID
 
de¡
, 
BasicLšk
* 
lšk
,

82 
LškDœeùiÚ
 
dœeùiÚ
,

83 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
) = 0;

84 
vœtu®
 
makeInLšk
(
NodeID
 
¤c
, 
Sw™chID
 
de¡
, 
BasicLšk
* 
lšk
,

85 
LškDœeùiÚ
 
dœeùiÚ
,

86 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
) = 0;

87 
vœtu®
 
makeIÁ”ÇlLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

88 
LškDœeùiÚ
 
dœeùiÚ
,

89 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
) = 0;

91 
vœtu®
 
cŞÏ‹Sts
() = 0;

92 
vœtu®
 
´št
(
¡d
::
o¡»am
& 
out
) const = 0;

99 
vœtu®
 
boŞ
 
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

100 { 
	`çl
("FunùiÚ®„—d‚Ù im¶em’‹d.\n"); 
	}
}

101 
vœtu®
 
ušt32_t
 
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

102 { 
	`çl
("FunùiÚ® wr™nÙ im¶em’‹d.\n"); 
	}
}

104 
	g´Ùeùed
:

106 
N‘wÜk
(cÚ¡ N‘wÜk& 
obj
);

107 
	gN‘wÜk
& 
	gİ”©Ü
=(cÚ¡ 
N‘wÜk
& 
obj
);

109 
ušt32_t
 
	gm_nodes
;

110 
ušt32_t
 
	gm_vœtu®_ÃtwÜks
;

111 
TİŞogy
* 
	gm_tİŞogy_±r
;

112 
ušt32_t
 
	gm_cÚŒŞ_msg_size
;

113 
ušt32_t
 
	gm_d©a_msg_size
;

115 
	g´iv©e
:

118 şas 
	cStsC®lback
 : 
public
 
C®lback


120 
´iv©e
:

121 
N‘wÜk
 *
ùr
;

123 
	gpublic
:

124 
vœtu®
 ~
StsC®lback
() {}

126 
StsC®lback
(
N‘wÜk
 *
_ùr
)

127 : 
ùr
(
_ùr
)

131 
´oûss
(è{
ùr
->
cŞÏ‹Sts
();}

135 
šlše
 
	g¡d
::
o¡»am
&

136 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gN‘wÜk
& 
	gobj
)

138 
	gobj
.
´št
(
out
);

139 
	gout
 << 
	g¡d
::
æush
;

140  
	gout
;

	@ruby/network/Topology.cc

29 
	~<ÿs£¹
>

31 
	~"ba£/Œaû.hh
"

32 
	~"debug/RubyN‘wÜk.hh
"

33 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

34 
	~"mem/ruby/commÚ/N‘De¡.hh
"

35 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

36 
	~"mem/ruby/ÃtwÜk/TİŞogy.hh
"

37 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùCÚŒŞËr.hh
"

39 
usšg
 
Çme¥aû
 
	g¡d
;

41 cÚ¡ 
	gINFINITE_LATENCY
 = 10000;

51 
ex‹nd_shÜ‹¡_·th
(
M©rix
& 
cu¼’t_di¡
, M©rix& 
Ï‹nc›s
,

52 
M©rix
& 
š‹r_sw™ches
);

53 
M©rix
 
shÜ‹¡_·th
(cÚ¡ M©rix& 
weights
, M©rix& 
Ï‹nc›s
,

54 
M©rix
& 
š‹r_sw™ches
);

55 
boŞ
 
lšk_is_shÜ‹¡_·th_to_node
(
Sw™chID
 
¤c
, Sw™chID 
Ãxt
,

56 
Sw™chID
 
fš®
, cÚ¡ 
M©rix
& 
weights
, cÚ¡ M©rix& 
di¡
);

57 
N‘De¡
 
shÜ‹¡_·th_to_node
(
Sw™chID
 
¤c
, Sw™chID 
Ãxt
,

58 cÚ¡ 
M©rix
& 
weights
, cÚ¡ M©rix& 
di¡
);

60 
	gTİŞogy
::
TİŞogy
(
ušt32_t
 
num_rou‹rs
, 
veùÜ
<
BasicExtLšk
 *> 
ext_lšks
,

61 
veùÜ
<
BasicIÁLšk
 *> 
št_lšks
)

62 : 
	$m_numb”_of_sw™ches
(
num_rou‹rs
)

66 
m_compÚ’t_Ï‹nc›s
.
	`»size
(0);

67 
m_compÚ’t_š‹r_sw™ches
.
	`»size
(0);

71 
m_nodes
 = 
	`MachšeTy³_ba£_numb”
(
MachšeTy³_NUM
);

72 
	`as£¹
(
m_nodes
 > 1);

74 ià(
m_nodes
 !ğ
ext_lšks
.
	`size
()) {

75 
	`çl
("m_nodes (%d) !=ƒxt_links vector†ength (%d)\n",

76 
m_nodes
, 
ext_lšks
.
	`size
());

83 
veùÜ
<
BasicExtLšk
*>::
cÚ¡_™”©Ü
 
i
 = 
ext_lšks
.
	`begš
();

84 
i
 !ğ
ext_lšks
.
	`’d
(); ++i) {

85 
BasicExtLšk
 *
ext_lšk
 = (*
i
);

86 
Ab¡¿ùCÚŒŞËr
 *
abs_úŒl
 = 
ext_lšk
->
	`·¿ms
()->
ext_node
;

87 
BasicRou‹r
 *
rou‹r
 = 
ext_lšk
->
	`·¿ms
()->
št_node
;

90 
m_ext_lšk_veùÜ
.
	`push_back
(
ext_lšk
);

92 
machše_ba£_idx
 = 
	`MachšeTy³_ba£_numb”
(

93 
	`¡ršg_to_MachšeTy³
(
abs_úŒl
->
	`g‘Name
()));

94 
ext_idx1
 = 
machše_ba£_idx
 + 
abs_úŒl
->
	`g‘V”siÚ
();

95 
ext_idx2
 = 
ext_idx1
 + 
m_nodes
;

96 
št_idx
 = 
rou‹r
->
	`·¿ms
()->
rou‹r_id
 + 2*
m_nodes
;

100 
	`addLšk
(
ext_idx1
, 
št_idx
, 
ext_lšk
, 
LškDœeùiÚ_In
);

102 
	`addLšk
(
št_idx
, 
ext_idx2
, 
ext_lšk
, 
LškDœeùiÚ_Out
);

105 
veùÜ
<
BasicIÁLšk
*>::
cÚ¡_™”©Ü
 
i
 = 
št_lšks
.
	`begš
();

106 
i
 !ğ
št_lšks
.
	`’d
(); ++i) {

107 
BasicIÁLšk
 *
št_lšk
 = (*
i
);

108 
BasicRou‹r
 *
rou‹r_a
 = 
št_lšk
->
	`·¿ms
()->
node_a
;

109 
BasicRou‹r
 *
rou‹r_b
 = 
št_lšk
->
	`·¿ms
()->
node_b
;

112 
m_št_lšk_veùÜ
.
	`push_back
(
št_lšk
);

114 
a
 = 
rou‹r_a
->
	`·¿ms
()->
rou‹r_id
 + 2*
m_nodes
;

115 
b
 = 
rou‹r_b
->
	`·¿ms
()->
rou‹r_id
 + 2*
m_nodes
;

119 
	`addLšk
(
a
, 
b
, 
št_lšk
, 
LškDœeùiÚ_In
);

121 
	`addLšk
(
b
, 
a
, 
št_lšk
, 
LškDœeùiÚ_Out
);

123 
	}
}

126 
	gTİŞogy
::
	$ü—‹Lšks
(
N‘wÜk
 *
Ãt
)

129 
Sw™chID
 
max_sw™ch_id
 = 0;

130 
LškM­
::
cÚ¡_™”©Ü
 
i
 = 
m_lšk_m­
.
	`begš
();

131 
i
 !ğ
m_lšk_m­
.
	`’d
(); ++i) {

132 
¡d
::
·œ
<
Sw™chID
, Sw™chID> 
¤c_de¡
 = (*
i
).
fœ¡
;

133 
max_sw™ch_id
 = 
	`max
(max_sw™ch_id, 
¤c_de¡
.
fœ¡
);

134 
max_sw™ch_id
 = 
	`max
(max_sw™ch_id, 
¤c_de¡
.
£cÚd
);

138 
M©rix
 
tİŞogy_weights
;

139 
num_sw™ches
 = 
max_sw™ch_id
+1;

140 
tİŞogy_weights
.
	`»size
(
num_sw™ches
);

141 
m_compÚ’t_Ï‹nc›s
.
	`»size
(
num_sw™ches
);

142 
m_compÚ’t_š‹r_sw™ches
.
	`»size
(
num_sw™ches
);

144 
i
 = 0; i < 
tİŞogy_weights
.
	`size
(); i++) {

145 
tİŞogy_weights
[
i
].
	`»size
(
num_sw™ches
);

146 
m_compÚ’t_Ï‹nc›s
[
i
].
	`»size
(
num_sw™ches
);

147 
m_compÚ’t_š‹r_sw™ches
[
i
].
	`»size
(
num_sw™ches
);

149 
j
 = 0; j < 
tİŞogy_weights
[
i
].
	`size
(); j++) {

150 
tİŞogy_weights
[
i
][
j
] = 
INFINITE_LATENCY
;

153 
m_compÚ’t_Ï‹nc›s
[
i
][
j
] = -1;

157 
m_compÚ’t_š‹r_sw™ches
[
i
][
j
] = 0;

162 
i
 = 0; i < 
tİŞogy_weights
.
	`size
(); i++) {

163 
tİŞogy_weights
[
i
][i] = 0;

167 
LškM­
::
cÚ¡_™”©Ü
 
i
 = 
m_lšk_m­
.
	`begš
();

168 
i
 !ğ
m_lšk_m­
.
	`’d
(); ++i) {

169 
¡d
::
·œ
<, > 
¤c_de¡
 = (*
i
).
fœ¡
;

170 
BasicLšk
* 
lšk
 = (*
i
).
£cÚd
.link;

171 
¤c
 = 
¤c_de¡
.
fœ¡
;

172 
d¡
 = 
¤c_de¡
.
£cÚd
;

173 
m_compÚ’t_Ï‹nc›s
[
¤c
][
d¡
] = 
lšk
->
m_Ï‹ncy
;

174 
tİŞogy_weights
[
¤c
][
d¡
] = 
lšk
->
m_weight
;

178 
M©rix
 
di¡
 = 
	`shÜ‹¡_·th
(
tİŞogy_weights
, 
m_compÚ’t_Ï‹nc›s
,

179 
m_compÚ’t_š‹r_sw™ches
);

180 
i
 = 0; i < 
tİŞogy_weights
.
	`size
(); i++) {

181 
j
 = 0; j < 
tİŞogy_weights
[
i
].
	`size
(); j++) {

182 
weight
 = 
tİŞogy_weights
[
i
][
j
];

183 ià(
weight
 > 0 && weighˆ!ğ
INFINITE_LATENCY
) {

184 
N‘De¡
 
de¡š©iÚ_£t
 =

185 
	`shÜ‹¡_·th_to_node
(
i
, 
j
, 
tİŞogy_weights
, 
di¡
);

186 
	`makeLšk
(
Ãt
, 
i
, 
j
, 
de¡š©iÚ_£t
);

190 
	}
}

193 
	gTİŞogy
::
	$addLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

194 
LškDœeùiÚ
 
dœ
)

196 
	`as£¹
(
¤c
 <ğ
m_numb”_of_sw™ches
+
m_nodes
+m_nodes);

197 
	`as£¹
(
de¡
 <ğ
m_numb”_of_sw™ches
+
m_nodes
+m_nodes);

199 
¡d
::
·œ
<, > 
¤c_de¡_·œ
;

200 
LškEÁry
 
lšk_’Œy
;

202 
¤c_de¡_·œ
.
fœ¡
 = 
¤c
;

203 
¤c_de¡_·œ
.
£cÚd
 = 
de¡
;

204 
lšk_’Œy
.
dœeùiÚ
 = 
dœ
;

205 
lšk_’Œy
.
lšk
 =†ink;

206 
m_lšk_m­
[
¤c_de¡_·œ
] = 
lšk_’Œy
;

207 
	}
}

210 
	gTİŞogy
::
	$makeLšk
(
N‘wÜk
 *
Ãt
, 
Sw™chID
 
¤c
, Sw™chID 
de¡
,

211 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

215 
	`as£¹
(
¤c
 >ğ2 * 
m_nodes
 || 
de¡
 >= 2 * m_nodes);

217 
¡d
::
·œ
<, > 
¤c_de¡
;

218 
LškEÁry
 
lšk_’Œy
;

220 ià(
¤c
 < 
m_nodes
) {

221 
¤c_de¡
.
fœ¡
 = 
¤c
;

222 
¤c_de¡
.
£cÚd
 = 
de¡
;

223 
lšk_’Œy
 = 
m_lšk_m­
[
¤c_de¡
];

224 
Ãt
->
	`makeInLšk
(
¤c
, 
de¡
 - (2 * 
m_nodes
), 
lšk_’Œy
.
lšk
,

225 
lšk_’Œy
.
dœeùiÚ
, 
routšg_bË_’Œy
);

226 } ià(
de¡
 < 2*
m_nodes
) {

227 
	`as£¹
(
de¡
 >ğ
m_nodes
);

228 
NodeID
 
node
 = 
de¡
 - 
m_nodes
;

229 
¤c_de¡
.
fœ¡
 = 
¤c
;

230 
¤c_de¡
.
£cÚd
 = 
de¡
;

231 
lšk_’Œy
 = 
m_lšk_m­
[
¤c_de¡
];

232 
Ãt
->
	`makeOutLšk
(
¤c
 - (2 * 
m_nodes
), 
node
, 
lšk_’Œy
.
lšk
,

233 
lšk_’Œy
.
dœeùiÚ
, 
routšg_bË_’Œy
);

235 
	`as£¹
((
¤c
 >ğ2 * 
m_nodes
è&& (
de¡
 >= 2 * m_nodes));

236 
¤c_de¡
.
fœ¡
 = 
¤c
;

237 
¤c_de¡
.
£cÚd
 = 
de¡
;

238 
lšk_’Œy
 = 
m_lšk_m­
[
¤c_de¡
];

239 
Ãt
->
	`makeIÁ”ÇlLšk
(
¤c
 - (2 * 
m_nodes
), 
de¡
 - (2 * m_nodes),

240 
lšk_’Œy
.
lšk
,†šk_’Œy.
dœeùiÚ
,

241 
routšg_bË_’Œy
);

243 
	}
}

248 
	$ex‹nd_shÜ‹¡_·th
(
M©rix
& 
cu¼’t_di¡
, M©rix& 
Ï‹nc›s
,

249 
M©rix
& 
š‹r_sw™ches
)

251 
boŞ
 
chªge
 = 
Œue
;

252 
nodes
 = 
cu¼’t_di¡
.
	`size
();

254 
chªge
) {

255 
chªge
 = 
çl£
;

256 
i
 = 0; i < 
nodes
; i++) {

257 
j
 = 0; j < 
nodes
; j++) {

258 
mšimum
 = 
cu¼’t_di¡
[
i
][
j
];

259 
´evious_mšimum
 = 
mšimum
;

260 
š‹rmedŸ‹_sw™ch
 = -1;

261 
k
 = 0; k < 
nodes
; k++) {

262 
mšimum
 = 
	`mš
(minimum,

263 
cu¼’t_di¡
[
i
][
k
] + cu¼’t_di¡[k][
j
]);

264 ià(
´evious_mšimum
 !ğ
mšimum
) {

265 
š‹rmedŸ‹_sw™ch
 = 
k
;

266 
š‹r_sw™ches
[
i
][
j
] =

267 
š‹r_sw™ches
[
i
][
k
] +

268 
š‹r_sw™ches
[
k
][
j
] + 1;

270 
´evious_mšimum
 = 
mšimum
;

272 ià(
cu¼’t_di¡
[
i
][
j
] !ğ
mšimum
) {

273 
chªge
 = 
Œue
;

274 
cu¼’t_di¡
[
i
][
j
] = 
mšimum
;

275 
	`as£¹
(
š‹rmedŸ‹_sw™ch
 >= 0);

276 
	`as£¹
(
š‹rmedŸ‹_sw™ch
 < 
Ï‹nc›s
[
i
].
	`size
());

277 
Ï‹nc›s
[
i
][
j
] =†©’c›s[i][
š‹rmedŸ‹_sw™ch
] +

278 
Ï‹nc›s
[
š‹rmedŸ‹_sw™ch
][
j
];

283 
	}
}

285 
M©rix


286 
	$shÜ‹¡_·th
(cÚ¡ 
M©rix
& 
weights
, M©rix& 
Ï‹nc›s
, M©rix& 
š‹r_sw™ches
)

288 
M©rix
 
di¡
 = 
weights
;

289 
	`ex‹nd_shÜ‹¡_·th
(
di¡
, 
Ï‹nc›s
, 
š‹r_sw™ches
);

290  
di¡
;

291 
	}
}

293 
boŞ


294 
	$lšk_is_shÜ‹¡_·th_to_node
(
Sw™chID
 
¤c
, Sw™chID 
Ãxt
, Sw™chID 
fš®
,

295 cÚ¡ 
M©rix
& 
weights
, cÚ¡ M©rix& 
di¡
)

297  
weights
[
¤c
][
Ãxt
] + 
di¡
[Ãxt][
fš®
] == dist[src][final];

298 
	}
}

300 
N‘De¡


301 
	$shÜ‹¡_·th_to_node
(
Sw™chID
 
¤c
, Sw™chID 
Ãxt
, cÚ¡ 
M©rix
& 
weights
,

302 cÚ¡ 
M©rix
& 
di¡
)

304 
N‘De¡
 
»suÉ
;

305 
d
 = 0;

306 
machšes
;

307 
max_machšes
;

309 
machšes
 = 
MachšeTy³_NUM
;

310 
max_machšes
 = 
	`MachšeTy³_ba£_numb”
(
MachšeTy³_NUM
);

312 
m
 = 0; m < 
machšes
; m++) {

313 
NodeID
 
i
 = 0; i < 
	`MachšeTy³_ba£_couÁ
((
MachšeTy³
)
m
); i++) {

319 ià(
	`lšk_is_shÜ‹¡_·th_to_node
(
¤c
, 
Ãxt
, 
d
 + 
max_machšes
,

320 
weights
, 
di¡
)) {

321 
MachšeID
 
mach
 = {(
MachšeTy³
)
m
, 
i
};

322 
»suÉ
.
	`add
(
mach
);

324 
d
++;

328 
	`DPRINTF
(
RubyN‘wÜk
, "Returning shortest…ath\n"

331 (
¤c
-(2*
max_machšes
)), (
Ãxt
-(2*max_machines)),

332 
¤c
, 
Ãxt
, 
»suÉ
);

334  
»suÉ
;

335 
	}
}

	@ruby/network/Topology.hh

40 #iâdeà
__MEM_RUBY_NETWORK_TOPOLOGY_HH__


41 
	#__MEM_RUBY_NETWORK_TOPOLOGY_HH__


	)

43 
	~<io¡»am
>

44 
	~<¡ršg
>

45 
	~<veùÜ
>

47 
	~"mem/´ÙocŞ/LškDœeùiÚ.hh
"

48 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

49 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

51 
şass
 
	gN‘De¡
;

52 
şass
 
	gN‘wÜk
;

54 
	g¡d
::
	tveùÜ
<
	t¡d
::veùÜ<> > 
	tM©rix
;

56 
	sLškEÁry


58 
BasicLšk
 *
	mlšk
;

59 
LškDœeùiÚ
 
	mdœeùiÚ
;

62 
	g¡d
::
	tm­
<
	t¡d
::
	t·œ
<
	tSw™chID
, Sw™chID>, 
	tLškEÁry
> 
	tLškM­
;

64 şas 
	cTİŞogy


66 
	mpublic
:

67 
TİŞogy
(
ušt32_t
 
num_rou‹rs
, 
¡d
::
veùÜ
<
BasicExtLšk
 *> 
ext_lšks
,

68 
¡d
::
veùÜ
<
BasicIÁLšk
 *> 
št_lšks
);

70 
ušt32_t
 
	$numSw™ches
(ècÚ¡ {  
m_numb”_of_sw™ches
; }

71 
	`ü—‹Lšks
(
N‘wÜk
 *
Ãt
);

72 
	`´št
(
¡d
::
o¡»am
& 
out
ècÚ¡ { ouˆ<< "[TİŞogy]"; 
	}
}

74 
	g´Ùeùed
:

75 
addLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

76 
LškDœeùiÚ
 
dœ
);

77 
makeLšk
(
N‘wÜk
 *
Ãt
, 
Sw™chID
 
¤c
, Sw™chID 
de¡
,

78 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

80 
NodeID
 
	gm_nodes
;

81 
ušt32_t
 
	gm_numb”_of_sw™ches
;

83 
	g¡d
::
veùÜ
<
BasicExtLšk
*> 
m_ext_lšk_veùÜ
;

84 
	g¡d
::
veùÜ
<
BasicIÁLšk
*> 
m_št_lšk_veùÜ
;

86 
M©rix
 
	gm_compÚ’t_Ï‹nc›s
;

87 
M©rix
 
	gm_compÚ’t_š‹r_sw™ches
;

89 
LškM­
 
	gm_lšk_m­
;

92 
šlše
 
	g¡d
::
o¡»am
&

93 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gTİŞogy
& 
	gobj
)

95 
	gobj
.
´št
(
out
);

96 
	gout
 << 
	g¡d
::
æush
;

97  
	gout
;

	@ruby/network/fault_model/FaultModel.cc

41 
	~<ÿs£¹
>

42 
	~<f¡»am
>

43 
	~<io¡»am
>

44 
	~<veùÜ
>

47 
	~"FauÉMod–.hh
"

48 
	~"ba£/misc.hh
"

50 
usšg
 
Çme¥aû
 
	g¡d
;

52 
	#MAX
(
a
,
b
è(× > bè? (aè: (b))

	)

55 
	gFauÉMod–
::
	$FauÉMod–
(cÚ¡ 
P¬ams
 *
p
è: 
	$SimObjeù
(
p
)

59 
boŞ
 
mÜe_»cÜds
 = 
Œue
;

60 
i
 = 0; 
mÜe_»cÜds
; i +ğ(
f›lds_³r_cÚf_»cÜd
)){

61 
sy¡em_cÚf
 
cÚfigu¿tiÚ
;

62 
cÚfigu¿tiÚ
.
buff_³r_vc
 =

63 
p
->
ba£lše_çuÉ_veùÜ_d©aba£
[
i
 + 
cÚf_»cÜd_buff_³r_vc
];

64 
cÚfigu¿tiÚ
.
vcs
 =

65 
p
->
ba£lše_çuÉ_veùÜ_d©aba£
[
i
 + 
cÚf_»cÜd_vcs
];

66 
çuÉ_šdex
 = 0; fauÉ_šdex < 
numb”_of_çuÉ_ty³s
;

67 
çuÉ_šdex
++){

68 
cÚfigu¿tiÚ
.
çuÉ_ty³
[
çuÉ_šdex
] =

69 
p
->
ba£lše_çuÉ_veùÜ_d©aba£
[
i
 +

70 
cÚf_»cÜd_fœ¡_çuÉ_ty³
 + 
çuÉ_šdex
] / 100;

72 
cÚfigu¿tiÚs
.
	`push_back
(
cÚfigu¿tiÚ
);

73 ià(
p
->
ba£lše_çuÉ_veùÜ_d©aba£
[
i
+
f›lds_³r_cÚf_»cÜd
] < 0){

74 
mÜe_»cÜds
 = 
çl£
;

80 
mÜe_»cÜds
 = 
Œue
;

81 
i
 = 0; 
mÜe_»cÜds
; i +ğ(
f›lds_³r_‹m³¿tu»_»cÜd
)){

82 
»cÜd_‹m³¿tu»
 =

83 
p
->
‹m³¿tu»_weights_d©aba£
[
i
 + 
‹m³¿tu»_»cÜd_‹mp
];

84 
»cÜd_weight
 =

85 
p
->
‹m³¿tu»_weights_d©aba£
[
i
 + 
‹m³¿tu»_»cÜd_weight
];

86 
fœ¡_»cÜd
 = 
Œue
;

87 ià(
fœ¡_»cÜd
){

88 
‹m³¿tu»
 = 0;em³¿tu» < 
»cÜd_‹m³¿tu»
;

89 
‹m³¿tu»
++){

90 
‹m³¿tu»_weights
.
	`push_back
(0);

92 
fœ¡_»cÜd
 = 
çl£
;

94 
	`as£¹
(
»cÜd_‹m³¿tu»
 =ğ
‹m³¿tu»_weights
.
	`size
());

95 
‹m³¿tu»_weights
.
	`push_back
(
»cÜd_weight
);

96 ià(
p
->
‹m³¿tu»_weights_d©aba£
[
i
 +

97 
f›lds_³r_‹m³¿tu»_»cÜd
] < 0){

98 
mÜe_»cÜds
 = 
çl£
;

101 
	}
}

103 
¡ršg


104 
	gFauÉMod–
::
	$çuÉ_ty³_to_¡ršg
(
á
)

106 ià(
á
 =ğ
d©a_cÜru±iÚ__ãw_b™s
){

108 } ià(
á
 =ğ
d©a_cÜru±iÚ__®l_b™s
){

110 } ià(
á
 =ğ
æ™_cÚ£rv©iÚ__æ™_du¶iÿtiÚ
){

112 } ià(
á
 =ğ
æ™_cÚ£rv©iÚ__æ™_loss_Ü_¥l™
){

114 } ià(
á
 =ğ
mi¤outšg
){

116 } ià(
á
 =ğ
üed™_cÚ£rv©iÚ__üed™_g’”©iÚ
){

118 } ià(
á
 =ğ
üed™_cÚ£rv©iÚ__üed™_loss
){

120 } ià(
á
 =ğ
”rÚeous_®loÿtiÚ__VC
){

122 } ià(
á
 =ğ
”rÚeous_®loÿtiÚ__sw™ch
){

124 } ià(
á
 =ğ
unçœ_¬b™¿tiÚ
){

126 } ià(
á
 =ğ
numb”_of_çuÉ_ty³s
){

131 
	}
}

135 
	gFauÉMod–
::
	$deş¬e_rou‹r
(
numb”_of_šputs
,

136 
numb”_of_ouuts
,

137 
numb”_of_vcs_³r_šput
,

138 
numb”_of_buff_³r_d©a_vc
,

139 
numb”_of_buff_³r_ù¾_vc
)

142 ià(
numb”_of_šputs
 <ğ0 || 
numb”_of_ouuts
 <= 0 ||

143 
numb”_of_vcs_³r_šput
 <ğ0 || 
numb”_of_buff_³r_d©a_vc
 <= 0 ||

144 
numb”_of_buff_³r_ù¾_vc
 <= 0){

145 
	`çl
("Fault Model: ERROR in‡rgument of FaultModel_declare_router!");

147 
numb”_of_bufãrs_³r_vc
 = 
	`MAX
(
numb”_of_buff_³r_d©a_vc
,

148 
numb”_of_buff_³r_ù¾_vc
);

149 
tÙ®_vcs
 = 
numb”_of_šputs
 * 
numb”_of_vcs_³r_šput
;

150 ià(
tÙ®_vcs
 > 
MAX_VCs
){

151 
	`çl
("Fault Model: ERROR! Number inputs*VCs (MAX_VCs) unsupported");

153 ià(
numb”_of_bufãrs_³r_vc
 > 
MAX_BUFFERS_³r_VC
){

154 
	`çl
("Fault Model: ERROR! buffers/VC (MAX_BUFFERS_per_VC)oo high");

158 
»cÜd_h™
 = -1;

159 
»cÜd
 = 0;„ecÜd < 
cÚfigu¿tiÚs
.
	`size
();„ecord++){

160 ià((
cÚfigu¿tiÚs
[
»cÜd
].
buff_³r_vc
 =ğ
numb”_of_bufãrs_³r_vc
)&&

161 (
cÚfigu¿tiÚs
[
»cÜd
].
vcs
 =ğ
tÙ®_vcs
)){

162 
»cÜd_h™
 = 
»cÜd
;

165 ià(
»cÜd_h™
 == -1){

166 
	`·nic
("Fault Model: ERROR! configuration‚ot found in DB. BUG?");

170 
rou‹rs
.
	`push_back
(
cÚfigu¿tiÚs
[
»cÜd_h™
]);

171 
rou‹r_šdex
 = 0;

172  
rou‹r_šdex
++;

173 
	}
}

175 
boŞ


176 
	gFauÉMod–
::
	$çuÉ_veùÜ
(
rou‹rID
,

177 
‹m³¿tu»_šput
,

178 
çuÉ_veùÜ
[])

180 
boŞ
 
ok
 = 
Œue
;

183 ià(
rou‹rID
 < 0 ||„ou‹rID >ğ((è
rou‹rs
.
	`size
())){

184 
	`w¬n
("Fault Model: ERROR! unknown„outer ID‡rgument.");

185 
	`çl
("Fault Model: Did youƒnablehe fault model flag)?");

189 
‹m³¿tu»
 = 
‹m³¿tu»_šput
;

190 ià(
‹m³¿tu»_šput
 >ğ((è
‹m³¿tu»_weights
.
	`size
())){

191 
ok
 = 
çl£
;

192 
	`w¬n_Úû
("Fault Model: Temperatureƒxceeded simulated upper bound.");

193 
	`w¬n_Úû
("Fault Model: The fault model is‚ot‡ccurate‡ny more.");

194 
‹m³¿tu»
 = (
‹m³¿tu»_weights
.
	`size
() - 1);

195 } ià(
‹m³¿tu»_šput
 < 0){

196 
ok
 = 
çl£
;

197 
	`w¬n_Úû
("Fault Model: Temperatureƒxceeded simulated†ower bound.");

198 
	`w¬n_Úû
("Fault Model: The fault model is‚ot‡ccurate‡ny more.");

199 
‹m³¿tu»
 = 0;

203 
i
 = 0; i < 
numb”_of_çuÉ_ty³s
; i++){

204 
çuÉ_veùÜ
[
i
] = 
rou‹rs
[
rou‹rID
].
çuÉ_ty³
[i] *

205 (()
‹m³¿tu»_weights
[
‹m³¿tu»
]);

207  
ok
;

208 
	}
}

210 
boŞ


211 
	gFauÉMod–
::
	$çuÉ_´ob
(
rou‹rID
,

212 
‹m³¿tu»_šput
,

213 *
agg»g©e_çuÉ_´ob
)

215 *
agg»g©e_çuÉ_´ob
 = 1.0;

216 
boŞ
 
ok
 = 
Œue
;

219 ià(
rou‹rID
 < 0 ||„ou‹rID >ğ((è
rou‹rs
.
	`size
())){

220 
	`w¬n
("Fault Model: ERROR! unknown„outer ID‡rgument.");

221 
	`çl
("Fault Model: Did youƒnablehe fault model flag)?");

225 
‹m³¿tu»
 = 
‹m³¿tu»_šput
;

226 ià(
‹m³¿tu»_šput
 >ğ((è
‹m³¿tu»_weights
.
	`size
()) ){

227 
ok
 = 
çl£
;

228 
	`w¬n_Úû
("Fault Model: Temperatureƒxceeded simulated upper bound.");

229 
	`w¬n_Úû
("Fault Model: The fault model is‚ot‡ccurate‡ny more.");

230 
‹m³¿tu»
 = (
‹m³¿tu»_weights
.
	`size
()-1);

231 } ià(
‹m³¿tu»_šput
 < 0){

232 
ok
 = 
çl£
;

233 
	`w¬n_Úû
("Fault Model: Temperatureƒxceeded simulated†ower bound.");

234 
	`w¬n_Úû
("Fault Model: The fault model is‚ot‡ccurate‡ny more.");

235 
‹m³¿tu»
 = 0;

239 
i
 = 0; i < 
numb”_of_çuÉ_ty³s
; i++){

240 *
agg»g©e_çuÉ_´ob
= *aggregate_fault_prob *

241 Ğ1.0 - (
rou‹rs
[
rou‹rID
].
çuÉ_ty³
[
i
] *

242 (()
‹m³¿tu»_weights
[
‹m³¿tu»
])) );

244 *
agg»g©e_çuÉ_´ob
 = 1.0 - *aggregate_fault_prob;

245  
ok
;

246 
	}
}

250 
	gFauÉMod–
::
	$´št
()

252 
cout
 << "--- PRINTING configurations ---\n";

253 
»cÜd
 = 0;„ecÜd < 
cÚfigu¿tiÚs
.
	`size
();„ecord++){

254 
cout
 << "(" << 
»cÜd
 << ") ";

255 
cout
 << "VCs=" << 
cÚfigu¿tiÚs
[
»cÜd
].
vcs
 << " ";

256 
cout
 << "Buff/VC=" << 
cÚfigu¿tiÚs
[
»cÜd
].
buff_³r_vc
 << " [";

257 
çuÉ_ty³_num
 = 0;

258 
çuÉ_ty³_num
 < 
numb”_of_çuÉ_ty³s
;

259 
çuÉ_ty³_num
++){

260 
cout
 << (100 * 
cÚfigu¿tiÚs
[
»cÜd
].
çuÉ_ty³
[
çuÉ_ty³_num
]);

261 
cout
 << "% ";

263 
cout
 << "]\n";

265 
cout
 << "--- PRINTINGemperature weights ---\n";

266 
»cÜd
 = 0;„ecÜd < 
‹m³¿tu»_weights
.
	`size
();„ecord++){

267 
cout
 << "‹m³¿tu»=" << 
»cÜd
 << " => ";

268 
cout
 << "weight=" << 
‹m³¿tu»_weights
[
»cÜd
];

269 
cout
 << "\n";

271 
	}
}

273 
FauÉMod–
 *

274 
	gFauÉMod–P¬ams
::
	$ü—‹
()

276  
Ãw
 
	`FauÉMod–
(
this
);

277 
	}
}

	@ruby/network/fault_model/FaultModel.hh

40 #iâdeà
__MEM_RUBY_NETWORK_FAULT_MODEL_HH__


41 
	#__MEM_RUBY_NETWORK_FAULT_MODEL_HH__


	)

44 
	#MAX_VCs
 40

	)

45 
	#MAX_BUFFERS_³r_VC
 5

	)

46 
	#BASELINE_TEMPERATURE_CELCIUS
 71

	)

49 
	~<¡ršg
>

52 
	~"·¿ms/FauÉMod–.hh
"

53 
	~"sim/sim_objeù.hh
"

55 şas 
	cFauÉMod–
 : 
public
 
SimObjeù


57 
public
:

58 
FauÉMod–P¬ams
 
	tP¬ams
;

59 
FauÉMod–
(cÚ¡ 
P¬ams
 *
p
);

60 cÚ¡ 
P¬ams
 *
	$·¿ms
(ècÚ¡ {  (cÚ¡ 
P¬ams
 *)
_·¿ms
; }

66 
	eçuÉ_ty³


68 
d©a_cÜru±iÚ__ãw_b™s
,

69 
d©a_cÜru±iÚ__®l_b™s
,

70 
æ™_cÚ£rv©iÚ__æ™_du¶iÿtiÚ
,

71 
æ™_cÚ£rv©iÚ__æ™_loss_Ü_¥l™
,

72 
mi¤outšg
,

73 
üed™_cÚ£rv©iÚ__üed™_g’”©iÚ
,

74 
üed™_cÚ£rv©iÚ__üed™_loss
,

75 
”rÚeous_®loÿtiÚ__VC
,

76 
”rÚeous_®loÿtiÚ__sw™ch
,

77 
unçœ_¬b™¿tiÚ
,

78 
numb”_of_çuÉ_ty³s


79 
	}
};

85 
	ecÚf_»cÜd_fÜm©


87 
	gcÚf_»cÜd_buff_³r_vc
,

88 
	gcÚf_»cÜd_vcs
,

89 
	gcÚf_»cÜd_fœ¡_çuÉ_ty³
,

90 
	gcÚf_»cÜd_Ï¡_çuÉ_ty³
 = 
cÚf_»cÜd_fœ¡_çuÉ_ty³
 + 
numb”_of_çuÉ_ty³s
 - 1,

91 
	gf›lds_³r_cÚf_»cÜd


94 
	e‹m³¿tu»_»cÜd_fÜm©


96 
	g‹m³¿tu»_»cÜd_‹mp
,

97 
	g‹m³¿tu»_»cÜd_weight
,

98 
	gf›lds_³r_‹m³¿tu»_»cÜd


101 
	ssy¡em_cÚf


103 
	gvcs
;

104 
	gbuff_³r_vc
;

105 
	gçuÉ_ty³
[
numb”_of_çuÉ_ty³s
];

108 
deş¬e_rou‹r
(
numb”_of_šputs
,

109 
numb”_of_ouuts
,

110 
numb”_of_vcs_³r_vÃt
,

111 
numb”_of_buff_³r_d©a_vc
,

112 
numb”_of_buff_³r_ù¾_vc
);

114 
	g¡d
::
¡ršg
 
çuÉ_ty³_to_¡ršg
(
çuÉ_ty³_šdex
);

123 
boŞ
 
çuÉ_veùÜ
(
rou‹rID
,

124 
‹m³¿tu»
,

125 
çuÉ_veùÜ
[]);

127 
boŞ
 
çuÉ_´ob
(
rou‹rID
,

128 
‹m³¿tu»
,

129 *
agg»g©e_çuÉ_´ob
);

133 
´št
();

135 
	g´iv©e
:

136 
¡d
::
veùÜ
 <
sy¡em_cÚf
> 
cÚfigu¿tiÚs
;

137 
	g¡d
::
veùÜ
 <
sy¡em_cÚf
> 
rou‹rs
;

138 
	g¡d
::
veùÜ
 <> 
‹m³¿tu»_weights
;

	@ruby/network/garnet/BaseGarnetNetwork.cc

31 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

32 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

33 
	~"mem/ruby/ÃtwÜk/TİŞogy.hh
"

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/Ba£G¬ÃtN‘wÜk.hh
"

36 
usšg
 
Çme¥aû
 
	g¡d
;

38 
	gBa£G¬ÃtN‘wÜk
::
	$Ba£G¬ÃtN‘wÜk
(cÚ¡ 
P¬ams
 *
p
)

39 : 
	$N‘wÜk
(
p
)

41 
m_ni_æ™_size
 = 
p
->
ni_æ™_size
;

42 
m_vcs_³r_vÃt
 = 
p
->
vcs_³r_vÃt
;

43 
m_’abË_çuÉ_mod–
 = 
p
->
’abË_çuÉ_mod–
;

44 ià(
m_’abË_çuÉ_mod–
)

45 
çuÉ_mod–
 = 
p
->fault_model;

49 
¡d
::
veùÜ
<
BasicExtLšk
*>::
cÚ¡_™”©Ü
 
i
 = 
p
->
ext_lšks
.
	`begš
();

50 
i
 !ğ
p
->
ext_lšks
.
	`’d
(); ++i) {

51 
BasicExtLšk
* 
ext_lšk
 = (*
i
);

52 ià(
ext_lšk
->
	`·¿ms
()->
bªdwidth_çùÜ
 !ğ
m_ni_æ™_size
) {

53 
	`çl
("Garnet only supports uniform bw‡cross‡ll†inks‡nd NIs\n");

56 
¡d
::
veùÜ
<
BasicIÁLšk
*>::
cÚ¡_™”©Ü
 
i
 = 
p
->
št_lšks
.
	`begš
();

57 
i
 !ğ
p
->
št_lšks
.
	`’d
(); ++i) {

58 
BasicIÁLšk
* 
št_lšk
 = (*
i
);

59 ià(
št_lšk
->
	`·¿ms
()->
bªdwidth_çùÜ
 !ğ
m_ni_æ™_size
) {

60 
	`çl
("Garnet only supports uniform bw‡cross‡ll†inks‡nd NIs\n");

67 
m_toN‘Queues
.
	`»size
(
m_nodes
);

70 
m_äomN‘Queues
.
	`»size
(
m_nodes
);

72 
m_š_u£
.
	`»size
(
m_vœtu®_ÃtwÜks
);

73 
m_Üd”ed
.
	`»size
(
m_vœtu®_ÃtwÜks
);

74 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
; i++) {

75 
m_š_u£
[
i
] = 
çl£
;

76 
m_Üd”ed
[
i
] = 
çl£
;

79 
node
 = 0;‚od< 
m_nodes
;‚ode++) {

81 
m_toN‘Queues
[
node
].
	`»size
(
m_vœtu®_ÃtwÜks
);

82 
m_äomN‘Queues
[
node
].
	`»size
(
m_vœtu®_ÃtwÜks
);

86 
j
 = 0; j < 
m_vœtu®_ÃtwÜks
; j++) {

87 
m_toN‘Queues
[
node
][
j
] = 
Ãw
 
	`Mes§geBufãr
();

88 
m_äomN‘Queues
[
node
][
j
] = 
Ãw
 
	`Mes§geBufãr
();

91 
	}
}

94 
	gBa£G¬ÃtN‘wÜk
::
	$š™
()

96 
N‘wÜk
::
	`š™
();

97 
	}
}

99 
Mes§geBufãr
*

100 
	gBa£G¬ÃtN‘wÜk
::
	$g‘ToN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
,

101 
¡ršg
 
vÃt_ty³
)

103 
	`checkN‘wÜkAÎoÿtiÚ
(
id
, 
Üd”ed
, 
ÃtwÜk_num
, 
vÃt_ty³
);

104  
m_toN‘Queues
[
id
][
ÃtwÜk_num
];

105 
	}
}

107 
Mes§geBufãr
*

108 
	gBa£G¬ÃtN‘wÜk
::
	$g‘FromN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
,

109 
¡ršg
 
vÃt_ty³
)

111 
	`checkN‘wÜkAÎoÿtiÚ
(
id
, 
Üd”ed
, 
ÃtwÜk_num
, 
vÃt_ty³
);

112  
m_äomN‘Queues
[
id
][
ÃtwÜk_num
];

113 
	}
}

116 
	gBa£G¬ÃtN‘wÜk
::
	$»gSts
()

118 
m_æ™s_»ûived


119 .
	`š™
(
m_vœtu®_ÃtwÜks
)

120 .
	`Çme
(name() + ".flits_received")

121 .
	`æags
(
Sts
::
pdf
 | Sts::
tÙ®
 | Sts::
noz”o
 | Sts::
Ú–še
)

124 
m_æ™s_šjeùed


125 .
	`š™
(
m_vœtu®_ÃtwÜks
)

126 .
	`Çme
(name() + ".flits_injected")

127 .
	`æags
(
Sts
::
pdf
 | Sts::
tÙ®
 | Sts::
noz”o
 | Sts::
Ú–še
)

130 
m_ÃtwÜk_Ï‹ncy


131 .
	`š™
(
m_vœtu®_ÃtwÜks
)

132 .
	`Çme
(name() + ".network_latency")

133 .
	`æags
(
Sts
::
Ú–še
)

136 
m_queuešg_Ï‹ncy


137 .
	`š™
(
m_vœtu®_ÃtwÜks
)

138 .
	`Çme
(name() + ".queueing_latency")

139 .
	`æags
(
Sts
::
Ú–še
)

142 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
; i++) {

143 
m_æ™s_»ûived
.
	`subÇme
(
i
, 
	`c¥rštf
("vnet-%i", i));

144 
m_æ™s_šjeùed
.
	`subÇme
(
i
, 
	`c¥rštf
("vnet-%i", i));

145 
m_ÃtwÜk_Ï‹ncy
.
	`subÇme
(
i
, 
	`c¥rštf
("vnet-%i", i));

146 
m_queuešg_Ï‹ncy
.
	`subÇme
(
i
, 
	`c¥rštf
("vnet-%i", i));

149 
m_avg_vÃt_Ï‹ncy


150 .
	`Çme
(name() + ".average_vnet_latency")

151 .
	`æags
(
Sts
::
Ú–še
);

152 
m_avg_vÃt_Ï‹ncy
 = 
m_ÃtwÜk_Ï‹ncy
 / 
m_æ™s_»ûived
;

154 
m_avg_vqueue_Ï‹ncy


155 .
	`Çme
(name() + ".average_vqueue_latency")

156 .
	`æags
(
Sts
::
Ú–še
);

157 
m_avg_vqueue_Ï‹ncy
 = 
m_queuešg_Ï‹ncy
 / 
m_æ™s_»ûived
;

159 
m_avg_ÃtwÜk_Ï‹ncy
.
	`Çme
(name() + ".average_network_latency");

160 
m_avg_ÃtwÜk_Ï‹ncy
 = 
	`sum
(
m_ÃtwÜk_Ï‹ncy
è/ sum(
m_æ™s_»ûived
);

162 
m_avg_queuešg_Ï‹ncy
.
	`Çme
(name() + ".average_queueing_latency");

163 
m_avg_queuešg_Ï‹ncy
 = 
	`sum
(
m_queuešg_Ï‹ncy
è/ sum(
m_æ™s_»ûived
);

165 
m_avg_Ï‹ncy
.
	`Çme
(name() + ".average_latency");

166 
m_avg_Ï‹ncy
 = 
m_avg_ÃtwÜk_Ï‹ncy
 + 
m_avg_queuešg_Ï‹ncy
;

167 
	}
}

	@ruby/network/garnet/BaseGarnetNetwork.hh

36 #iâdeà
__MEM_RUBY_NETWORK_GARNET_BASEGARNETNETWORK_HH__


37 
	#__MEM_RUBY_NETWORK_GARNET_BASEGARNETNETWORK_HH__


	)

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

40 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

41 
	~"mem/ruby/ÃtwÜk/çuÉ_mod–/FauÉMod–.hh
"

42 
	~"·¿ms/Ba£G¬ÃtN‘wÜk.hh
"

44 şas 
	cBa£G¬ÃtN‘wÜk
 : 
public
 
N‘wÜk


46 
public
:

47 
Ba£G¬ÃtN‘wÜkP¬ams
 
	tP¬ams
;

48 
Ba£G¬ÃtN‘wÜk
(cÚ¡ 
P¬ams
 *
p
);

50 
š™
();

51 
	$g‘NiFl™Size
(è{ 
m_ni_æ™_size
; }

52 
	$g‘VCsP”VÃt
(è{ 
m_vcs_³r_vÃt
; 
	}
}

53 
boŞ
 
	$isFauÉMod–EÇbËd
(è{ 
m_’abË_çuÉ_mod–
;
	}
}

54 
FauÉMod–
* 
	gçuÉ_mod–
;

56 
	$šüem’t_šjeùed_æ™s
(
vÃt
è{ 
m_æ™s_šjeùed
[vÃt]++; 
	}
}

57 
	$šüem’t_»ûived_æ™s
(
vÃt
è{ 
m_æ™s_»ûived
[vÃt]++; 
	}
}

60 
	$šüem’t_ÃtwÜk_Ï‹ncy
(
Cyşes
 
Ï‹ncy
, 
vÃt
)

62 
m_ÃtwÜk_Ï‹ncy
[
vÃt
] +ğ
Ï‹ncy
;

63 
	}
}

66 
	$šüem’t_queuešg_Ï‹ncy
(
Cyşes
 
Ï‹ncy
, 
vÃt
)

68 
m_queuešg_Ï‹ncy
[
vÃt
] +ğ
Ï‹ncy
;

69 
	}
}

72 
Mes§geBufãr
* 
g‘ToN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
,

73 
¡d
::
¡ršg
 
vÃt_ty³
);

74 
Mes§geBufãr
* 
g‘FromN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
,

75 
¡d
::
¡ršg
 
vÃt_ty³
);

78 
boŞ
 
	$isVN‘Ord”ed
(
vÃt
è{  
m_Üd”ed
[vÃt]; 
	}
}

79 
boŞ
 
	$v®idVœtu®N‘wÜk
(
vÃt
è{  
m_š_u£
[vÃt]; 
	}
}

80 
vœtu®
 
checkN‘wÜkAÎoÿtiÚ
(
NodeID
 
id
, 
boŞ
 
Üd”ed
,

81 
ÃtwÜk_num
, 
¡d
::
¡ršg
 
vÃt_ty³
) = 0;

83 
vœtu®
 
»gSts
();

84 
vœtu®
 
	$cŞÏ‹Sts
(è{
	}
}

86 
	g´Ùeùed
:

87 
m_ni_æ™_size
;

88 
	gm_vcs_³r_vÃt
;

89 
boŞ
 
	gm_’abË_çuÉ_mod–
;

91 
	g¡d
::
veùÜ
<
boŞ
> 
m_š_u£
;

92 
	g¡d
::
veùÜ
<
boŞ
> 
m_Üd”ed
;

94 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
Mes§geBufãr
*> > 
m_toN‘Queues
;

95 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
Mes§geBufãr
*> > 
m_äomN‘Queues
;

98 
	gSts
::
VeùÜ
 
m_æ™s_»ûived
;

99 
	gSts
::
VeùÜ
 
m_æ™s_šjeùed
;

100 
	gSts
::
VeùÜ
 
m_ÃtwÜk_Ï‹ncy
;

101 
	gSts
::
VeùÜ
 
m_queuešg_Ï‹ncy
;

103 
	gSts
::
FÜmuÏ
 
m_avg_vÃt_Ï‹ncy
;

104 
	gSts
::
FÜmuÏ
 
m_avg_vqueue_Ï‹ncy
;

105 
	gSts
::
FÜmuÏ
 
m_avg_ÃtwÜk_Ï‹ncy
;

106 
	gSts
::
FÜmuÏ
 
m_avg_queuešg_Ï‹ncy
;

107 
	gSts
::
FÜmuÏ
 
m_avg_Ï‹ncy
;

	@ruby/network/garnet/NetworkHeader.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_NETWORKHEADER_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_NETWORKHEADER_HH__


	)

34 
	eæ™_ty³
 {
	mHEAD_
, 
	mBODY_
, 
	mTAIL_
, 
	mHEAD_TAIL_
, 
	mNUM_FLIT_TYPE_
};

35 
	eVC_¡©e_ty³
 {
	mIDLE_
, 
	mVC_AB_
, 
	mACTIVE_
, 
	mNUM_VC_STATE_TYPE_
};

36 
	eVNET_ty³
 {
	mCTRL_VNET_
, 
	mDATA_VNET_
, 
	mNULL_VNET_
, 
	mNUM_VNET_TYPE_
};

37 
	eæ™_¡age
 {
	mI_
, 
	mVA_
, 
	mSA_
, 
	mST_
, 
	mLT_
, 
	mNUM_FLIT_STAGE_
};

39 
	#INFINITE_
 10000

	)

	@ruby/network/garnet/fixed-pipeline/CreditLink_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_CREDIT_LINK_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_CREDIT_LINK_D_HH__


	)

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

35 
	~"·¿ms/C»d™Lšk_d.hh
"

37 şas 
	cC»d™Lšk_d
 : 
public
 
N‘wÜkLšk_d


39 
public
:

40 
C»d™Lšk_dP¬ams
 
	tP¬ams
;

41 
	$C»d™Lšk_d
(cÚ¡ 
P¬ams
 *
p
è: 
	$N‘wÜkLšk_d
(
p
) {}

42 
	}
};

	@ruby/network/garnet/fixed-pipeline/GarnetLink_d.cc

29 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/C»d™Lšk_d.hh
"

30 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtLšk_d.hh
"

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

33 
	gG¬ÃtIÁLšk_d
::
	$G¬ÃtIÁLšk_d
(cÚ¡ 
P¬ams
 *
p
)

34 : 
	$BasicLšk
(
p
)

36 
m_ÃtwÜk_lšks
[0] = 
p
->
ÃtwÜk_lšks
[0];

37 
m_üed™_lšks
[0] = 
p
->
üed™_lšks
[0];

38 
m_ÃtwÜk_lšks
[1] = 
p
->
ÃtwÜk_lšks
[1];

39 
m_üed™_lšks
[1] = 
p
->
üed™_lšks
[1];

40 
	}
}

43 
	gG¬ÃtIÁLšk_d
::
	$š™
()

45 
	}
}

48 
G¬ÃtIÁLšk_d
::
´št
(
¡d
::
o¡»am
& 
out
) const

50 
out
 << 
Çme
();

53 
G¬ÃtIÁLšk_d
 *

54 
	gG¬ÃtIÁLšk_dP¬ams
::
	$ü—‹
()

56  
Ãw
 
	`G¬ÃtIÁLšk_d
(
this
);

57 
	}
}

59 
	gG¬ÃtExtLšk_d
::
	$G¬ÃtExtLšk_d
(cÚ¡ 
P¬ams
 *
p
)

60 : 
	$BasicLšk
(
p
)

62 
m_ÃtwÜk_lšks
[0] = 
p
->
ÃtwÜk_lšks
[0];

63 
m_üed™_lšks
[0] = 
p
->
üed™_lšks
[0];

64 
m_ÃtwÜk_lšks
[1] = 
p
->
ÃtwÜk_lšks
[1];

65 
m_üed™_lšks
[1] = 
p
->
üed™_lšks
[1];

66 
	}
}

69 
	gG¬ÃtExtLšk_d
::
	$š™
()

71 
	}
}

74 
G¬ÃtExtLšk_d
::
´št
(
¡d
::
o¡»am
& 
out
) const

76 
out
 << 
Çme
();

79 
G¬ÃtExtLšk_d
 *

80 
	gG¬ÃtExtLšk_dP¬ams
::
	$ü—‹
()

82  
Ãw
 
	`G¬ÃtExtLšk_d
(
this
);

83 
	}
}

	@ruby/network/garnet/fixed-pipeline/GarnetLink_d.hh

29 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_LINK_HH__


30 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_LINK_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/C»d™Lšk_d.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

39 
	~"·¿ms/G¬ÃtIÁLšk_d.hh
"

40 
	~"·¿ms/G¬ÃtExtLšk_d.hh
"

42 şas 
	cG¬ÃtIÁLšk_d
 : 
public
 
BasicLšk


44 
public
:

45 
G¬ÃtIÁLšk_dP¬ams
 
	tP¬ams
;

46 
G¬ÃtIÁLšk_d
(cÚ¡ 
P¬ams
 *
p
);

48 
š™
();

50 
´št
(
¡d
::
o¡»am
& 
out
) const;

52 
ä›nd
 
şass
 
	mG¬ÃtN‘wÜk_d
;

54 
	m´Ùeùed
:

55 
N‘wÜkLšk_d
* 
m_ÃtwÜk_lšks
[2];

56 
C»d™Lšk_d
* 
	mm_üed™_lšks
[2];

59 
šlše
 
	g¡d
::
o¡»am
&

60 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gG¬ÃtIÁLšk_d
& 
	gobj
)

62 
	gobj
.
´št
(
out
);

63 
	gout
 << 
	g¡d
::
æush
;

64  
	gout
;

67 şas 
	cG¬ÃtExtLšk_d
 : 
public
 
BasicLšk


69 
public
:

70 
G¬ÃtExtLšk_dP¬ams
 
	tP¬ams
;

71 
G¬ÃtExtLšk_d
(cÚ¡ 
P¬ams
 *
p
);

73 
š™
();

75 
´št
(
¡d
::
o¡»am
& 
out
) const;

77 
ä›nd
 
şass
 
	mG¬ÃtN‘wÜk_d
;

79 
	m´Ùeùed
:

80 
N‘wÜkLšk_d
* 
m_ÃtwÜk_lšks
[2];

81 
C»d™Lšk_d
* 
	mm_üed™_lšks
[2];

84 
šlše
 
	g¡d
::
o¡»am
&

85 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gG¬ÃtExtLšk_d
& 
	gobj
)

87 
	gobj
.
´št
(
out
);

88 
	gout
 << 
	g¡d
::
æush
;

89  
	gout
;

	@ruby/network/garnet/fixed-pipeline/GarnetNetwork_d.cc

31 
	~<ÿs£¹
>

33 
	~"ba£/ÿ¡.hh
"

34 
	~"ba£/¡l_h–³rs.hh
"

35 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

36 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

37 
	~"mem/ruby/commÚ/N‘De¡.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/Ba£G¬ÃtN‘wÜk.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/C»d™Lšk_d.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtLšk_d.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtN‘wÜk_d.hh
"

42 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkIÁ”çû_d.hh
"

43 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

44 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

45 
	~"mem/ruby/ÃtwÜk/TİŞogy.hh
"

47 
usšg
 
Çme¥aû
 
	g¡d
;

48 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

50 
	gG¬ÃtN‘wÜk_d
::
	$G¬ÃtN‘wÜk_d
(cÚ¡ 
P¬ams
 *
p
)

51 : 
	$Ba£G¬ÃtN‘wÜk
(
p
)

53 
m_bufãrs_³r_d©a_vc
 = 
p
->
bufãrs_³r_d©a_vc
;

54 
m_bufãrs_³r_ù¾_vc
 = 
p
->
bufãrs_³r_ù¾_vc
;

56 
m_vÃt_ty³
.
	`»size
(
m_vœtu®_ÃtwÜks
);

57 
i
 = 0; i < 
m_vÃt_ty³
.
	`size
(); i++) {

58 
m_vÃt_ty³
[
i
] = 
NULL_VNET_
;

62 
veùÜ
<
BasicRou‹r
*>::
cÚ¡_™”©Ü
 
i
 = 
p
->
rou‹rs
.
	`begš
();

63 
i
 !ğ
p
->
rou‹rs
.
	`’d
(); ++i) {

64 
Rou‹r_d
* 
rou‹r
 = 
§ã_ÿ¡
<Rou‹r_d*>(*
i
);

65 
m_rou‹rs
.
	`push_back
(
rou‹r
);

67 
	}
}

70 
	gG¬ÃtN‘wÜk_d
::
	$š™
()

72 
Ba£G¬ÃtN‘wÜk
::
	`š™
();

75 
veùÜ
<
Rou‹r_d
*>::
cÚ¡_™”©Ü
 
i
 = 
m_rou‹rs
.
	`begš
();

76 
i
 !ğ
m_rou‹rs
.
	`’d
(); ++i) {

77 
Rou‹r_d
* 
rou‹r
 = 
§ã_ÿ¡
<Rou‹r_d*>(*
i
);

78 
rou‹r
->
	`š™_Ãt_±r
(
this
);

83 
	`as£¹
(
m_tİŞogy_±r
 !ğ
NULL
);

85 
i
=0; i < 
m_nodes
; i++) {

86 
N‘wÜkIÁ”çû_d
 *
ni
 = 
Ãw
 
	`N‘wÜkIÁ”çû_d
(
i
, 
m_vœtu®_ÃtwÜks
,

87 
this
);

88 
ni
->
	`addNode
(
m_toN‘Queues
[
i
], 
m_äomN‘Queues
[i]);

89 
m_nis
.
	`push_back
(
ni
);

91 
m_tİŞogy_±r
->
	`ü—‹Lšks
(
this
);

94 
veùÜ
<
N‘wÜkLšk_d
*>::
cÚ¡_™”©Ü
 
i
 = 
m_lšks
.
	`begš
();

95 
i
 !ğ
m_lšks
.
	`’d
(); ++i) {

96 
N‘wÜkLšk_d
* 
Ãt_lšk
 = 
§ã_ÿ¡
<N‘wÜkLšk_d*>(*
i
);

97 
Ãt_lšk
->
	`š™_Ãt_±r
(
this
);

101 if(
	`isFauÉMod–EÇbËd
()){

102 
veùÜ
<
Rou‹r_d
*>::
cÚ¡_™”©Ü
 
i
ğ
m_rou‹rs
.
	`begš
();

103 
i
 !ğ
m_rou‹rs
.
	`’d
(); ++i) {

104 
Rou‹r_d
* 
rou‹r
 = 
§ã_ÿ¡
<Rou‹r_d*>(*
i
);

105 
rou‹r_id
 
M5_VAR_USED
 =

106 
çuÉ_mod–
->
	`deş¬e_rou‹r
(
rou‹r
->
	`g‘_num_špÜts
(),

107 
rou‹r
->
	`g‘_num_ouÜts
(),

108 
rou‹r
->
	`g‘_vc_³r_vÃt
(),

109 
	`g‘BufãrsP”D©aVC
(),

110 
	`g‘BufãrsP”CŒlVC
());

111 
	`as£¹
(
rou‹r_id
 =ğ
rou‹r
->
	`g‘_id
());

112 
rou‹r
->
	`´štAgg»g©eFauÉProbab™y
(
cout
);

113 
rou‹r
->
	`´štFauÉVeùÜ
(
cout
);

116 
	}
}

118 
	gG¬ÃtN‘wÜk_d
::~
	$G¬ÃtN‘wÜk_d
()

120 
i
 = 0; i < 
m_nodes
; i++) {

121 
	`d–‘ePoš‹rs
(
m_toN‘Queues
[
i
]);

122 
	`d–‘ePoš‹rs
(
m_äomN‘Queues
[
i
]);

124 
	`d–‘ePoš‹rs
(
m_rou‹rs
);

125 
	`d–‘ePoš‹rs
(
m_nis
);

126 
	`d–‘ePoš‹rs
(
m_lšks
);

127 
	`d–‘ePoš‹rs
(
m_üed™lšks
);

128 
d–‘e
 
m_tİŞogy_±r
;

129 
	}
}

139 
	gG¬ÃtN‘wÜk_d
::
	$makeInLšk
(
NodeID
 
¤c
, 
Sw™chID
 
de¡
, 
BasicLšk
* 
lšk
,

140 
LškDœeùiÚ
 
dœeùiÚ
,

141 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

143 
	`as£¹
(
¤c
 < 
m_nodes
);

145 
G¬ÃtExtLšk_d
* 
g¬Ãt_lšk
 = 
§ã_ÿ¡
<G¬ÃtExtLšk_d*>(
lšk
);

146 
N‘wÜkLšk_d
* 
Ãt_lšk
 = 
g¬Ãt_lšk
->
m_ÃtwÜk_lšks
[
dœeùiÚ
];

147 
C»d™Lšk_d
* 
üed™_lšk
 = 
g¬Ãt_lšk
->
m_üed™_lšks
[
dœeùiÚ
];

149 
m_lšks
.
	`push_back
(
Ãt_lšk
);

150 
m_üed™lšks
.
	`push_back
(
üed™_lšk
);

152 
m_rou‹rs
[
de¡
]->
	`addInPÜt
(
Ãt_lšk
, 
üed™_lšk
);

153 
m_nis
[
¤c
]->
	`addOutPÜt
(
Ãt_lšk
, 
üed™_lšk
);

154 
	}
}

163 
	gG¬ÃtN‘wÜk_d
::
	$makeOutLšk
(
Sw™chID
 
¤c
, 
NodeID
 
de¡
, 
BasicLšk
* 
lšk
,

164 
LškDœeùiÚ
 
dœeùiÚ
,

165 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

167 
	`as£¹
(
de¡
 < 
m_nodes
);

168 
	`as£¹
(
¤c
 < 
m_rou‹rs
.
	`size
());

169 
	`as£¹
(
m_rou‹rs
[
¤c
] !ğ
NULL
);

171 
G¬ÃtExtLšk_d
* 
g¬Ãt_lšk
 = 
§ã_ÿ¡
<G¬ÃtExtLšk_d*>(
lšk
);

172 
N‘wÜkLšk_d
* 
Ãt_lšk
 = 
g¬Ãt_lšk
->
m_ÃtwÜk_lšks
[
dœeùiÚ
];

173 
C»d™Lšk_d
* 
üed™_lšk
 = 
g¬Ãt_lšk
->
m_üed™_lšks
[
dœeùiÚ
];

175 
m_lšks
.
	`push_back
(
Ãt_lšk
);

176 
m_üed™lšks
.
	`push_back
(
üed™_lšk
);

178 
m_rou‹rs
[
¤c
]->
	`addOutPÜt
(
Ãt_lšk
, 
routšg_bË_’Œy
,

179 
lšk
->
m_weight
, 
üed™_lšk
);

180 
m_nis
[
de¡
]->
	`addInPÜt
(
Ãt_lšk
, 
üed™_lšk
);

181 
	}
}

188 
	gG¬ÃtN‘wÜk_d
::
	$makeIÁ”ÇlLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

189 
LškDœeùiÚ
 
dœeùiÚ
,

190 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

192 
G¬ÃtIÁLšk_d
* 
g¬Ãt_lšk
 = 
§ã_ÿ¡
<G¬ÃtIÁLšk_d*>(
lšk
);

193 
N‘wÜkLšk_d
* 
Ãt_lšk
 = 
g¬Ãt_lšk
->
m_ÃtwÜk_lšks
[
dœeùiÚ
];

194 
C»d™Lšk_d
* 
üed™_lšk
 = 
g¬Ãt_lšk
->
m_üed™_lšks
[
dœeùiÚ
];

196 
m_lšks
.
	`push_back
(
Ãt_lšk
);

197 
m_üed™lšks
.
	`push_back
(
üed™_lšk
);

199 
m_rou‹rs
[
de¡
]->
	`addInPÜt
(
Ãt_lšk
, 
üed™_lšk
);

200 
m_rou‹rs
[
¤c
]->
	`addOutPÜt
(
Ãt_lšk
, 
routšg_bË_’Œy
,

201 
lšk
->
m_weight
, 
üed™_lšk
);

202 
	}
}

205 
	gG¬ÃtN‘wÜk_d
::
	$checkN‘wÜkAÎoÿtiÚ
(
NodeID
 
id
, 
boŞ
 
Üd”ed
,

206 
ÃtwÜk_num
,

207 
¡ršg
 
vÃt_ty³
)

209 
	`as£¹
(
id
 < 
m_nodes
);

210 
	`as£¹
(
ÃtwÜk_num
 < 
m_vœtu®_ÃtwÜks
);

212 ià(
Üd”ed
) {

213 
m_Üd”ed
[
ÃtwÜk_num
] = 
Œue
;

215 
m_š_u£
[
ÃtwÜk_num
] = 
Œue
;

217 ià(
vÃt_ty³
 == "response")

218 
m_vÃt_ty³
[
ÃtwÜk_num
] = 
DATA_VNET_
;

220 
m_vÃt_ty³
[
ÃtwÜk_num
] = 
CTRL_VNET_
;

221 
	}
}

224 
	gG¬ÃtN‘wÜk_d
::
	$»gSts
()

226 
Ba£G¬ÃtN‘wÜk
::
	`»gSts
();

227 
	`»gLškSts
();

228 
	`»gPow”Sts
();

229 
	}
}

232 
	gG¬ÃtN‘wÜk_d
::
	$»gLškSts
()

234 
m_av”age_lšk_utiz©iÚ
.
	`Çme
(name() + ".avg_link_utilization");

236 
m_av”age_vc_lßd


237 .
	`š™
(
m_vœtu®_ÃtwÜks
 * 
m_vcs_³r_vÃt
)

238 .
	`Çme
(name() + ".avg_vc_load")

239 .
	`æags
(
Sts
::
pdf
 | Sts::
tÙ®
 | Sts::
noz”o
 | Sts::
Ú–še
)

241 
	}
}

244 
	gG¬ÃtN‘wÜk_d
::
	$»gPow”Sts
()

246 
m_dyÇmic_lšk_pow”
.
	`Çme
(name() + ".link_dynamic_power");

247 
m_¡©ic_lšk_pow”
.
	`Çme
(name() + ".link_static_power");

249 
m_tÙ®_lšk_pow”
.
	`Çme
(name() + ".link_total_power");

250 
m_tÙ®_lšk_pow”
 = 
m_dyÇmic_lšk_pow”
 + 
m_¡©ic_lšk_pow”
;

252 
m_dyÇmic_rou‹r_pow”
.
	`Çme
(name() + ".router_dynamic_power");

253 
m_¡©ic_rou‹r_pow”
.
	`Çme
(name() + ".router_static_power");

254 
m_şk_pow”
.
	`Çme
(name() + ".clk_power");

256 
m_tÙ®_rou‹r_pow”
.
	`Çme
(name() + ".router_total_power");

257 
m_tÙ®_rou‹r_pow”
 = 
m_dyÇmic_rou‹r_pow”
 +

258 
m_¡©ic_rou‹r_pow”
 +

259 
m_şk_pow”
;

260 
	}
}

263 
	gG¬ÃtN‘wÜk_d
::
	$cŞÏ‹Sts
()

265 
	`cŞÏ‹LškSts
();

266 
	`cŞÏ‹Pow”Sts
();

267 
	}
}

270 
	gG¬ÃtN‘wÜk_d
::
	$cŞÏ‹LškSts
()

272 
i
 = 0; i < 
m_lšks
.
	`size
(); i++) {

273 
m_av”age_lšk_utiz©iÚ
 +=

274 ((
m_lšks
[
i
]->
	`g‘LškUtiz©iÚ
())) /

275 ((
	`curCyşe
(è- 
g_ruby_¡¬t
));

277 
veùÜ
<> 
vc_lßd
 = 
m_lšks
[
i
]->
	`g‘VcLßd
();

278 
j
 = 0; j < 
vc_lßd
.
	`size
(); j++) {

279 
m_av”age_vc_lßd
[
j
] +=

280 (()
vc_lßd
[
j
] / ()(
	`curCyşe
(è- 
g_ruby_¡¬t
));

283 
	}
}

286 
	gG¬ÃtN‘wÜk_d
::
	$cŞÏ‹Pow”Sts
()

288 
i
 = 0; i < 
m_lšks
.
	`size
(); i++) {

289 
m_lšks
[
i
]->
	`ÿlcuÏ‹_pow”
();

290 
m_dyÇmic_lšk_pow”
 +ğ
m_lšks
[
i
]->
	`g‘_dyÇmic_pow”
();

291 
m_¡©ic_lšk_pow”
 +ğ
m_lšks
[
i
]->
	`g‘_¡©ic_pow”
();

294 
i
 = 0; i < 
m_rou‹rs
.
	`size
(); i++) {

295 
m_rou‹rs
[
i
]->
	`ÿlcuÏ‹_pow”
();

296 
m_dyÇmic_rou‹r_pow”
 +ğ
m_rou‹rs
[
i
]->
	`g‘_dyÇmic_pow”
();

297 
m_¡©ic_rou‹r_pow”
 +ğ
m_rou‹rs
[
i
]->
	`g‘_¡©ic_pow”
();

298 
m_şk_pow”
 +ğ
m_rou‹rs
[
i
]->
	`g‘_şk_pow”
();

300 
	}
}

303 
	gG¬ÃtN‘wÜk_d
::
	$´št
(
o¡»am
& 
out
) const

305 
out
 << "[GarnetNetwork_d]";

306 
	}
}

308 
G¬ÃtN‘wÜk_d
 *

309 
	gG¬ÃtN‘wÜk_dP¬ams
::
	$ü—‹
()

311  
Ãw
 
	`G¬ÃtN‘wÜk_d
(
this
);

312 
	}
}

314 
ušt32_t


315 
	gG¬ÃtN‘wÜk_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

317 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

319 
i
 = 0; i < 
m_rou‹rs
.
	`size
(); i++) {

320 
num_funùiÚ®_wr™es
 +ğ
m_rou‹rs
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

323 
i
 = 0; i < 
m_nis
.
	`size
(); ++i) {

324 
num_funùiÚ®_wr™es
 +ğ
m_nis
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

327 
i
 = 0; i < 
m_lšks
.
	`size
(); ++i) {

328 
num_funùiÚ®_wr™es
 +ğ
m_lšks
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

331  
num_funùiÚ®_wr™es
;

332 
	}
}

	@ruby/network/garnet/fixed-pipeline/GarnetNetwork_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_GARNETNETWORK_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_GARNETNETWORK_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/Ba£G¬ÃtN‘wÜk.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

39 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

40 
	~"·¿ms/G¬ÃtN‘wÜk_d.hh
"

42 
şass
 
	gFauÉMod–
;

43 
şass
 
	gN‘wÜkIÁ”çû_d
;

44 
şass
 
	gMes§geBufãr
;

45 
şass
 
	gRou‹r_d
;

46 
şass
 
	gTİŞogy
;

47 
şass
 
	gN‘De¡
;

48 
şass
 
	gN‘wÜkLšk_d
;

49 
şass
 
	gC»d™Lšk_d
;

51 şas 
	cG¬ÃtN‘wÜk_d
 : 
public
 
Ba£G¬ÃtN‘wÜk


53 
public
:

54 
G¬ÃtN‘wÜk_dP¬ams
 
	tP¬ams
;

55 
G¬ÃtN‘wÜk_d
(cÚ¡ 
P¬ams
 *
p
);

57 ~
G¬ÃtN‘wÜk_d
();

59 
š™
();

61 
	$g‘NumNodes
(è{  
m_nodes
; }

63 
	$g‘BufãrsP”D©aVC
(è{ 
m_bufãrs_³r_d©a_vc
; 
	}
}

64 
	$g‘BufãrsP”CŒlVC
(è{ 
m_bufãrs_³r_ù¾_vc
; 
	}
}

66 
cŞÏ‹Sts
();

67 
»gSts
();

68 
´št
(
¡d
::
o¡»am
& 
out
) const;

70 
VNET_ty³


71 
	$g‘_vÃt_ty³
(
vc
)

73 
vÃt
 = 
vc
/
	`g‘VCsP”VÃt
();

74  
m_vÃt_ty³
[
vÃt
];

75 
	}
}

78 
makeOutLšk
(
Sw™chID
 
¤c
, 
NodeID
 
de¡
, 
BasicLšk
* 
lšk
,

79 
LškDœeùiÚ
 
dœeùiÚ
,

80 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

81 
makeInLšk
(
NodeID
 
¤c
, 
Sw™chID
 
de¡
, 
BasicLšk
* 
lšk
,

82 
LškDœeùiÚ
 
dœeùiÚ
,

83 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

84 
makeIÁ”ÇlLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

85 
LškDœeùiÚ
 
dœeùiÚ
,

86 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

90 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

92 
	g´iv©e
:

93 
checkN‘wÜkAÎoÿtiÚ
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
,

94 
¡d
::
¡ršg
 
vÃt_ty³
);

96 
G¬ÃtN‘wÜk_d
(cÚ¡ G¬ÃtN‘wÜk_d& 
obj
);

97 
	gG¬ÃtN‘wÜk_d
& 
	gİ”©Ü
=(cÚ¡ 
G¬ÃtN‘wÜk_d
& 
obj
);

99 
cŞÏ‹LškSts
();

100 
cŞÏ‹Pow”Sts
();

101 
»gLškSts
();

102 
»gPow”Sts
();

104 
	g¡d
::
veùÜ
<
VNET_ty³
 > 
m_vÃt_ty³
;

106 
	g¡d
::
veùÜ
<
Rou‹r_d
 *> 
m_rou‹rs
;

107 
	g¡d
::
veùÜ
<
N‘wÜkLšk_d
 *> 
m_lšks
;

108 
	g¡d
::
veùÜ
<
C»d™Lšk_d
 *> 
m_üed™lšks
;

109 
	g¡d
::
veùÜ
<
N‘wÜkIÁ”çû_d
 *> 
m_nis
;

111 
	gm_bufãrs_³r_d©a_vc
;

112 
	gm_bufãrs_³r_ù¾_vc
;

115 
	gSts
::
SÿÏr
 
m_dyÇmic_lšk_pow”
;

116 
	gSts
::
SÿÏr
 
m_¡©ic_lšk_pow”
;

117 
	gSts
::
FÜmuÏ
 
m_tÙ®_lšk_pow”
;

119 
	gSts
::
SÿÏr
 
m_dyÇmic_rou‹r_pow”
;

120 
	gSts
::
SÿÏr
 
m_¡©ic_rou‹r_pow”
;

121 
	gSts
::
SÿÏr
 
m_şk_pow”
;

122 
	gSts
::
FÜmuÏ
 
m_tÙ®_rou‹r_pow”
;

125 
	gSts
::
SÿÏr
 
m_av”age_lšk_utiz©iÚ
;

126 
	gSts
::
VeùÜ
 
m_av”age_vc_lßd
;

129 
šlše
 
	g¡d
::
o¡»am
&

130 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gG¬ÃtN‘wÜk_d
& 
	gobj
)

132 
	gobj
.
´št
(
out
);

133 
	gout
 << 
	g¡d
::
æush
;

134  
	gout
;

	@ruby/network/garnet/fixed-pipeline/InputUnit_d.cc

31 
	~"ba£/¡l_h–³rs.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/IÅutUn™_d.hh
"

33 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

35 
usšg
 
Çme¥aû
 
	g¡d
;

36 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

38 
	gIÅutUn™_d
::
	$IÅutUn™_d
(
id
, 
Rou‹r_d
 *
rou‹r
è: 
	$CÚsum”
(
rou‹r
)

40 
m_id
 = 
id
;

41 
m_rou‹r
 = 
rou‹r
;

42 
m_num_vcs
 = 
m_rou‹r
->
	`g‘_num_vcs
();

43 
m_vc_³r_vÃt
 = 
m_rou‹r
->
	`g‘_vc_³r_vÃt
();

45 
m_num_bufãr_»ads
.
	`»size
(
m_num_vcs
/
m_vc_³r_vÃt
);

46 
m_num_bufãr_wr™es
.
	`»size
(
m_num_vcs
/
m_vc_³r_vÃt
);

47 
i
 = 0; i < 
m_num_bufãr_»ads
.
	`size
(); i++) {

48 
m_num_bufãr_»ads
[
i
] = 0;

49 
m_num_bufãr_wr™es
[
i
] = 0;

52 
üed™Queue
 = 
Ãw
 
	`æ™Bufãr_d
();

54 
m_vcs
.
	`»size
(
m_num_vcs
);

55 
i
=0; i < 
m_num_vcs
; i++) {

56 
m_vcs
[
i
] = 
Ãw
 
	`Vœtu®ChªÃl_d
(i);

58 
	}
}

60 
	gIÅutUn™_d
::~
	$IÅutUn™_d
()

62 
d–‘e
 
üed™Queue
;

63 
	`d–‘ePoš‹rs
(
m_vcs
);

64 
	}
}

67 
	gIÅutUn™_d
::
	$wakeup
()

69 
æ™_d
 *
t_æ™
;

70 ià(
m_š_lšk
->
	`isR—dy
(
m_rou‹r
->
	`curCyşe
())) {

72 
t_æ™
 = 
m_š_lšk
->
	`cÚsumeLšk
();

73 
vc
 = 
t_æ™
->
	`g‘_vc
();

75 ià((
t_æ™
->
	`g‘_ty³
(è=ğ
HEAD_
) ||

76 (
t_æ™
->
	`g‘_ty³
(è=ğ
HEAD_TAIL_
)) {

78 
	`as£¹
(
m_vcs
[
vc
]->
	`g‘_¡©e
(è=ğ
IDLE_
);

80 
m_rou‹r
->
	`rou‹_»q
(
t_æ™
, 
this
, 
vc
);

82 
m_vcs
[
vc
]->
	`£t_’queue_time
(
m_rou‹r
->
	`curCyşe
());

84 
t_æ™
->
	`advªû_¡age
(
SA_
, 
m_rou‹r
->
	`curCyşe
());

85 
m_rou‹r
->
	`sw¬b_»q
();

88 
m_vcs
[
vc
]->
	`š£¹Fl™
(
t_æ™
);

90 
vÃt
 = 
vc
/
m_vc_³r_vÃt
;

93 
m_num_bufãr_wr™es
[
vÃt
]++;

94 
m_num_bufãr_»ads
[
vÃt
]++;

96 
	}
}

98 
ušt32_t


99 
	gIÅutUn™_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

101 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

102 
i
=0; i < 
m_num_vcs
; i++) {

103 
num_funùiÚ®_wr™es
 +ğ
m_vcs
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

106  
num_funùiÚ®_wr™es
;

107 
	}
}

	@ruby/network/garnet/fixed-pipeline/InputUnit_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_INPUT_UNIT_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_INPUT_UNIT_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/CÚsum”.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/C»d™Lšk_d.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Vœtu®ChªÃl_d.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™Bufãr_d.hh
"

42 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

44 
şass
 
	gRou‹r_d
;

46 şas 
	cIÅutUn™_d
 : 
public
 
CÚsum”


48 
public
:

49 
IÅutUn™_d
(
id
, 
Rou‹r_d
 *
rou‹r
);

50 ~
IÅutUn™_d
();

52 
wakeup
();

53 
æ™Bufãr_d
* 
	$g‘C»d™Queue
(è{  
üed™Queue
; }

54 
	`´št
(
¡d
::
o¡»am
& 
out
ècÚ¡ {
	}
};

56 
šlše
 
	$g‘_šlšk_id
(è{  
m_š_lšk
->
	`g‘_id
(); 
	}
}

58 
šlše
 

59 
	$£t_vc_¡©e
(
VC_¡©e_ty³
 
¡©e
, 
vc
, 
Cyşes
 
curTime
)

61 
m_vcs
[
vc
]->
	`£t_¡©e
(
¡©e
, 
curTime
);

62 
	}
}

64 
šlše
 

65 
	$£t_’queue_time
(
švc
, 
Cyşes
 
time
)

67 
m_vcs
[
švc
]->
	`£t_’queue_time
(
time
);

68 
	}
}

70 
šlše
 
Cyşes


71 
	$g‘_’queue_time
(
švc
)

73  
m_vcs
[
švc
]->
	`g‘_’queue_time
();

74 
	}
}

76 
šlše
 

77 
	$upd©e_üed™
(
š_vc
, 
üed™
)

79 
m_vcs
[
š_vc
]->
	`upd©e_üed™
(
üed™
);

80 
	}
}

82 
šlše
 
boŞ


83 
	$has_üed™s
(
vc
)

85  
m_vcs
[
vc
]->
	`has_üed™s
();

86 
	}
}

88 
šlše
 

89 
	$šüem’t_üed™
(
š_vc
, 
boŞ
 
ä“_sigÇl
, 
Cyşes
 
curTime
)

91 
æ™_d
 *
t_æ™
 = 
Ãw
 
	`æ™_d
(
š_vc
, 
ä“_sigÇl
, 
curTime
);

92 
üed™Queue
->
	`š£¹
(
t_æ™
);

93 
m_üed™_lšk
->
	`scheduËEv’tAbsŞu‹
(
m_rou‹r
->
	`şockEdge
(
	`Cyşes
(1)));

94 
	}
}

96 
šlše
 

97 
	$g‘_outvc
(
švc
)

99  
m_vcs
[
švc
]->
	`g‘_outvc
();

100 
	}
}

102 
šlše
 

103 
	$upd©eRou‹
(
vc
, 
ouÜt
, 
Cyşes
 
curTime
)

105 
m_vcs
[
vc
]->
	`£t_ouÜt
(
ouÜt
);

106 
m_vcs
[
vc
]->
	`£t_¡©e
(
VC_AB_
, 
curTime
);

107 
	}
}

109 
šlše
 

110 
	$g¿Á_vc
(
š_vc
, 
out_vc
, 
Cyşes
 
curTime
)

112 
m_vcs
[
š_vc
]->
	`g¿Á_vc
(
out_vc
, 
curTime
);

113 
	}
}

115 
šlše
 
æ™_d
*

116 
	$³ekTİFl™
(
vc
)

118  
m_vcs
[
vc
]->
	`³ekTİFl™
();

119 
	}
}

121 
šlše
 
æ™_d
*

122 
	$g‘TİFl™
(
vc
)

124  
m_vcs
[
vc
]->
	`g‘TİFl™
();

125 
	}
}

127 
šlše
 
boŞ


128 
	$Ãed_¡age
(
vc
, 
VC_¡©e_ty³
 
¡©e
, 
æ™_¡age
 
¡age
, 
Cyşes
 
curTime
)

130  
m_vcs
[
vc
]->
	`Ãed_¡age
(
¡©e
, 
¡age
, 
curTime
);

131 
	}
}

133 
šlše
 
boŞ


134 
	$Ãed_¡age_Ãxtcyşe
(
vc
, 
VC_¡©e_ty³
 
¡©e
, 
æ™_¡age
 
¡age
,

135 
Cyşes
 
curTime
)

137  
m_vcs
[
vc
]->
	`Ãed_¡age_Ãxtcyşe
(
¡©e
, 
¡age
, 
curTime
);

138 
	}
}

140 
šlše
 
boŞ


141 
	$isR—dy
(
švc
, 
Cyşes
 
curTime
)

143  
m_vcs
[
švc
]->
	`isR—dy
(
curTime
);

144 
	}
}

146 
šlše
 

147 
	$g‘_rou‹
(
vc
)

149  
m_vcs
[
vc
]->
	`g‘_rou‹
();

150 
	}
}

152 
šlše
 

153 
	$£t_š_lšk
(
N‘wÜkLšk_d
 *
lšk
)

155 
m_š_lšk
 = 
lšk
;

156 
	}
}

158 
šlše
 

159 
	$£t_üed™_lšk
(
C»d™Lšk_d
 *
üed™_lšk
)

161 
m_üed™_lšk
 = 
üed™_lšk
;

162 
	}
}

164 
	$g‘_buf_»ad_couÁ
(
vÃt
) const

165 {  
m_num_bufãr_»ads
[
vÃt
]; 
	}
}

166 
	$g‘_buf_wr™e_couÁ
(
vÃt
) const

167 {  
m_num_bufãr_wr™es
[
vÃt
]; 
	}
}

169 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

171 
	g´iv©e
:

172 
m_id
;

173 
	gm_num_vcs
;

174 
	gm_vc_³r_vÃt
;

176 
Rou‹r_d
 *
	gm_rou‹r
;

177 
N‘wÜkLšk_d
 *
	gm_š_lšk
;

178 
C»d™Lšk_d
 *
	gm_üed™_lšk
;

179 
æ™Bufãr_d
 *
	güed™Queue
;

182 
	g¡d
::
veùÜ
<
Vœtu®ChªÃl_d
 *> 
m_vcs
;

185 
	g¡d
::
veùÜ
<> 
m_num_bufãr_wr™es
;

186 
	g¡d
::
veùÜ
<> 
m_num_bufãr_»ads
;

	@ruby/network/garnet/fixed-pipeline/NetworkInterface_d.cc

31 
	~<ÿs£¹
>

32 
	~<cm©h
>

34 
	~"ba£/ÿ¡.hh
"

35 
	~"ba£/¡l_h–³rs.hh
"

36 
	~"debug/RubyN‘wÜk.hh
"

37 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkIÁ”çû_d.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™Bufãr_d.hh
"

40 
	~"mem/ruby/¦icc_š‹rçû/N‘wÜkMes§ge.hh
"

42 
usšg
 
Çme¥aû
 
	g¡d
;

43 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

45 
	gN‘wÜkIÁ”çû_d
::
	$N‘wÜkIÁ”çû_d
(
id
, 
vœtu®_ÃtwÜks
,

46 
G¬ÃtN‘wÜk_d
 *
ÃtwÜk_±r
)

47 : 
	$CÚsum”
(
ÃtwÜk_±r
)

49 
m_id
 = 
id
;

50 
m_Ãt_±r
 = 
ÃtwÜk_±r
;

51 
m_vœtu®_ÃtwÜks
 = 
vœtu®_ÃtwÜks
;

52 
m_vc_³r_vÃt
 = 
m_Ãt_±r
->
	`g‘VCsP”VÃt
();

53 
m_num_vcs
 = 
m_vc_³r_vÃt
*
m_vœtu®_ÃtwÜks
;

55 
m_vc_round_robš
 = 0;

56 
m_ni_bufãrs
.
	`»size
(
m_num_vcs
);

57 
m_ni_’queue_time
.
	`»size
(
m_num_vcs
);

58 
šNode_±r
.
	`»size
(
m_vœtu®_ÃtwÜks
);

59 
outNode_±r
.
	`»size
(
m_vœtu®_ÃtwÜks
);

60 
üed™Queue
 = 
Ãw
 
	`æ™Bufãr_d
();

63 
i
 = 0; i < 
m_num_vcs
; i++) {

64 
m_ni_bufãrs
[
i
] = 
Ãw
 
	`æ™Bufãr_d
();

65 
m_ni_’queue_time
[
i
] = 
INFINITE_
;

67 
m_vc_®loÿtÜ
.
	`»size
(
m_vœtu®_ÃtwÜks
);

68 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
; i++) {

69 
m_vc_®loÿtÜ
[
i
] = 0;

72 
i
 = 0; i < 
m_num_vcs
; i++) {

73 
m_out_vc_¡©e
.
	`push_back
(
Ãw
 
	`OutVcS‹_d
(
i
, 
m_Ãt_±r
));

75 
	}
}

77 
	gN‘wÜkIÁ”çû_d
::~
	$N‘wÜkIÁ”çû_d
()

79 
	`d–‘ePoš‹rs
(
m_out_vc_¡©e
);

80 
	`d–‘ePoš‹rs
(
m_ni_bufãrs
);

81 
d–‘e
 
üed™Queue
;

82 
d–‘e
 
outSrcQueue
;

83 
	}
}

86 
	gN‘wÜkIÁ”çû_d
::
	$addInPÜt
(
N‘wÜkLšk_d
 *
š_lšk
,

87 
C»d™Lšk_d
 *
üed™_lšk
)

89 
šN‘Lšk
 = 
š_lšk
;

90 
š_lšk
->
	`£tLškCÚsum”
(
this
);

91 
m_ni_üed™_lšk
 = 
üed™_lšk
;

92 
üed™_lšk
->
	`£tSourûQueue
(
üed™Queue
);

93 
	}
}

96 
	gN‘wÜkIÁ”çû_d
::
	$addOutPÜt
(
N‘wÜkLšk_d
 *
out_lšk
,

97 
C»d™Lšk_d
 *
üed™_lšk
)

99 
m_üed™_lšk
 = 
üed™_lšk
;

100 
üed™_lšk
->
	`£tLškCÚsum”
(
this
);

102 
outN‘Lšk
 = 
out_lšk
;

103 
outSrcQueue
 = 
Ãw
 
	`æ™Bufãr_d
();

104 
out_lšk
->
	`£tSourûQueue
(
outSrcQueue
);

105 
	}
}

108 
	gN‘wÜkIÁ”çû_d
::
addNode
(
veùÜ
<
Mes§geBufãr
 *>& 
š
,

109 
veùÜ
<
Mes§geBufãr
 *>& 
out
)

111 
as£¹
(
š
.
size
(è=ğ
m_vœtu®_ÃtwÜks
);

112 
	gšNode_±r
 = 
š
;

113 
	goutNode_±r
 = 
out
;

114 
	gj
 = 0; j < 
	gm_vœtu®_ÃtwÜks
; j++) {

117 
	gšNode_±r
[
j
]->
£tCÚsum”
(
this
);

118 
	gšNode_±r
[
j
]->
£tReûiv”
(
m_Ãt_±r
);

120 
	goutNode_±r
[
j
]->
£tS’d”
(
m_Ãt_±r
);

124 
boŞ


125 
	gN‘wÜkIÁ”çû_d
::
	$æ™isizeMes§ge
(
MsgPŒ
 
msg_±r
, 
vÃt
)

127 
N‘wÜkMes§ge
 *
Ãt_msg_±r
 = 
§ã_ÿ¡
<N‘wÜkMes§g*>(
msg_±r
.
	`g‘
());

128 
N‘De¡
 
Ãt_msg_de¡
 = 
Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
();

131 
veùÜ
<
NodeID
> 
de¡_nodes
 = 
Ãt_msg_de¡
.
	`g‘AÎDe¡
();

135 
num_æ™s
 = (è
	`û
((è
m_Ãt_±r
->
	`Mes§geSizeTy³_to_št
(

136 
Ãt_msg_±r
->
	`g‘Mes§geSize
())/
m_Ãt_±r
->
	`g‘NiFl™Size
());

139 
ùr
 = 0; cŒ < 
de¡_nodes
.
	`size
(); ctr++) {

142 
vc
 = 
	`ÿlcuÏ‹VC
(
vÃt
);

144 ià(
vc
 == -1) {

145  
çl£
 ;

147 
MsgPŒ
 
Ãw_msg_±r
 = 
msg_±r
->
	`şÚe
();

148 
NodeID
 
de¡ID
 = 
de¡_nodes
[
ùr
];

150 
N‘wÜkMes§ge
 *
Ãw_Ãt_msg_±r
 =

151 
§ã_ÿ¡
<
N‘wÜkMes§ge
 *>(
Ãw_msg_±r
.
	`g‘
());

152 ià(
de¡_nodes
.
	`size
() > 1) {

153 
N‘De¡
 
³rsÚ®_de¡
;

154 
m
 = 0; m < (è
MachšeTy³_NUM
; m++) {

155 ià((
de¡ID
 >ğ
	`MachšeTy³_ba£_numb”
((
MachšeTy³
è
m
)) &&

156 
de¡ID
 < 
	`MachšeTy³_ba£_numb”
((
MachšeTy³
è(
m
+1))) {

158 
³rsÚ®_de¡
.
	`ş—r
();

159 
³rsÚ®_de¡
.
	`add
((
MachšeID
è{(
MachšeTy³
è
m
, (
de¡ID
 -

160 
	`MachšeTy³_ba£_numb”
((
MachšeTy³
è
m
))});

161 
Ãw_Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
(èğ
³rsÚ®_de¡
;

165 
Ãt_msg_de¡
.
	`»moveN‘De¡
(
³rsÚ®_de¡
);

169 
Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
().
	`»moveN‘De¡
(
³rsÚ®_de¡
);

172 
i
 = 0; i < 
num_æ™s
; i++) {

173 
m_Ãt_±r
->
	`šüem’t_šjeùed_æ™s
(
vÃt
);

174 
æ™_d
 *
æ
 = 
Ãw
 
	`æ™_d
(
i
, 
vc
, 
vÃt
, 
num_æ™s
, 
Ãw_msg_±r
,

175 
m_Ãt_±r
->
	`curCyşe
());

177 
æ
->
	`£t_d–ay
(
m_Ãt_±r
->
	`curCyşe
() -

178 
m_Ãt_±r
->
	`ticksToCyşes
(
msg_±r
->
	`g‘Time
()));

179 
m_ni_bufãrs
[
vc
]->
	`š£¹
(
æ
);

182 
m_ni_’queue_time
[
vc
] = 
m_Ãt_±r
->
	`curCyşe
();

183 
m_out_vc_¡©e
[
vc
]->
	`£tS‹
(
ACTIVE_
, 
m_Ãt_±r
->
	`curCyşe
());

185  
Œue
 ;

186 
	}
}

190 
	gN‘wÜkIÁ”çû_d
::
	$ÿlcuÏ‹VC
(
vÃt
)

192 
i
 = 0; i < 
m_vc_³r_vÃt
; i++) {

193 
d–
 = 
m_vc_®loÿtÜ
[
vÃt
];

194 
m_vc_®loÿtÜ
[
vÃt
]++;

195 if(
m_vc_®loÿtÜ
[
vÃt
] =ğ
m_vc_³r_vÃt
)

196 
m_vc_®loÿtÜ
[
vÃt
] = 0;

198 ià(
m_out_vc_¡©e
[(
vÃt
*
m_vc_³r_vÃt
è+ 
d–
]->
	`isInS‹
(

199 
IDLE_
, 
m_Ãt_±r
->
	`curCyşe
())) {

200  ((
vÃt
*
m_vc_³r_vÃt
è+ 
d–
);

204 
	}
}

217 
	gN‘wÜkIÁ”çû_d
::
	$wakeup
()

219 
	`DPRINTF
(
RubyN‘wÜk
, "m_id: %d woke up‡time: %lld",

220 
m_id
, 
m_Ãt_±r
->
	`curCyşe
());

222 
MsgPŒ
 
msg_±r
;

226 
vÃt
 = 0; vÃˆ< 
m_vœtu®_ÃtwÜks
; vnet++) {

227 
šNode_±r
[
vÃt
]->
	`isR—dy
()) {

228 
msg_±r
 = 
šNode_±r
[
vÃt
]->
	`³ekMsgPŒ
();

229 ià(
	`æ™isizeMes§ge
(
msg_±r
, 
vÃt
)) {

230 
šNode_±r
[
vÃt
]->
	`pİ
();

237 
	`scheduËOuutLšk
();

238 
	`checkRescheduË
();

242 ià(
šN‘Lšk
->
	`isR—dy
(
m_Ãt_±r
->
	`curCyşe
())) {

243 
æ™_d
 *
t_æ™
 = 
šN‘Lšk
->
	`cÚsumeLšk
();

244 
boŞ
 
ä“_sigÇl
 = 
çl£
;

245 ià(
t_æ™
->
	`g‘_ty³
(è=ğ
TAIL_
 ||_æ™->g‘_ty³(è=ğ
HEAD_TAIL_
) {

246 
ä“_sigÇl
 = 
Œue
;

248 
outNode_±r
[
t_æ™
->
	`g‘_vÃt
()]->
	`’queue
(

249 
t_æ™
->
	`g‘_msg_±r
(), 
	`Cyşes
(1));

253 
æ™_d
 *
üed™_æ™
 = 
Ãw
 
	`æ™_d
(
t_æ™
->
	`g‘_vc
(), 
ä“_sigÇl
,

254 
m_Ãt_±r
->
	`curCyşe
());

255 
üed™Queue
->
	`š£¹
(
üed™_æ™
);

256 
m_ni_üed™_lšk
->

257 
	`scheduËEv’tAbsŞu‹
(
m_Ãt_±r
->
	`şockEdge
(
	`Cyşes
(1)));

259 
vÃt
 = 
t_æ™
->
	`g‘_vÃt
();

260 
m_Ãt_±r
->
	`šüem’t_»ûived_æ™s
(
vÃt
);

261 
Cyşes
 
ÃtwÜk_d–ay
 = 
m_Ãt_±r
->
	`curCyşe
() -

262 
t_æ™
->
	`g‘_’queue_time
();

263 
Cyşes
 
queuešg_d–ay
 = 
t_æ™
->
	`g‘_d–ay
();

265 
m_Ãt_±r
->
	`šüem’t_ÃtwÜk_Ï‹ncy
(
ÃtwÜk_d–ay
, 
vÃt
);

266 
m_Ãt_±r
->
	`šüem’t_queuešg_Ï‹ncy
(
queuešg_d–ay
, 
vÃt
);

267 
d–‘e
 
t_æ™
;

272 ià(
m_üed™_lšk
->
	`isR—dy
(
m_Ãt_±r
->
	`curCyşe
())) {

273 
æ™_d
 *
t_æ™
 = 
m_üed™_lšk
->
	`cÚsumeLšk
();

274 
m_out_vc_¡©e
[
t_æ™
->
	`g‘_vc
()]->
	`šüem’t_üed™
();

275 ià(
t_æ™
->
	`is_ä“_sigÇl
()) {

276 
m_out_vc_¡©e
[
t_æ™
->
	`g‘_vc
()]->
	`£tS‹
(
IDLE_
,

277 
m_Ãt_±r
->
	`curCyşe
());

279 
d–‘e
 
t_æ™
;

281 
	}
}

290 
	gN‘wÜkIÁ”çû_d
::
	$scheduËOuutLšk
()

292 
vc
 = 
m_vc_round_robš
;

293 
m_vc_round_robš
++;

294 ià(
m_vc_round_robš
 =ğ
m_num_vcs
)

295 
m_vc_round_robš
 = 0;

297 
i
 = 0; i < 
m_num_vcs
; i++) {

298 
vc
++;

299 ià(
vc
 =ğ
m_num_vcs
)

300 
vc
 = 0;

303 ià(
m_ni_bufãrs
[
vc
]->
	`isR—dy
(
m_Ãt_±r
->
	`curCyşe
()) &&

304 
m_out_vc_¡©e
[
vc
]->
	`has_üed™s
()) {

306 
boŞ
 
is_ÿndid©e_vc
 = 
Œue
;

307 
t_vÃt
 = 
	`g‘_vÃt
(
vc
);

308 
vc_ba£
 = 
t_vÃt
 * 
m_vc_³r_vÃt
;

310 ià(
m_Ãt_±r
->
	`isVN‘Ord”ed
(
t_vÃt
)) {

311 
vc_off£t
 = 0; vc_off£ˆ< 
m_vc_³r_vÃt
;

312 
vc_off£t
++) {

313 
t_vc
 = 
vc_ba£
 + 
vc_off£t
;

314 ià(
m_ni_bufãrs
[
t_vc
]->
	`isR—dy
(
m_Ãt_±r
->
	`curCyşe
())) {

315 ià(
m_ni_’queue_time
[
t_vc
] < m_ni_’queue_time[
vc
]) {

316 
is_ÿndid©e_vc
 = 
çl£
;

322 ià(!
is_ÿndid©e_vc
)

325 
m_out_vc_¡©e
[
vc
]->
	`deüem’t_üed™
();

327 
æ™_d
 *
t_æ™
 = 
m_ni_bufãrs
[
vc
]->
	`g‘TİFl™
();

328 
t_æ™
->
	`£t_time
(
m_Ãt_±r
->
	`curCyşe
(è+ 
	`Cyşes
(1));

329 
outSrcQueue
->
	`š£¹
(
t_æ™
);

331 
outN‘Lšk
->

332 
	`scheduËEv’tAbsŞu‹
(
m_Ãt_±r
->
	`şockEdge
(
	`Cyşes
(1)));

334 ià(
t_æ™
->
	`g‘_ty³
(è=ğ
TAIL_
 ||

335 
t_æ™
->
	`g‘_ty³
(è=ğ
HEAD_TAIL_
) {

336 
m_ni_’queue_time
[
vc
] = 
INFINITE_
;

341 
	}
}

344 
	gN‘wÜkIÁ”çû_d
::
	$g‘_vÃt
(
vc
)

346 
i
 = 0; i < 
m_Ãt_±r
->
	`g‘Numb”OfVœtu®N‘wÜks
(); i++) {

347 ià(
vc
 >ğ(
i
*
m_vc_³r_vÃt
) && vc < ((i+1)*m_vc_per_vnet)) {

348  
i
;

351 
	`çl
("Could‚ot determine vc");

352 
	}
}

355 
	gN‘wÜkIÁ”çû_d
::
	$checkRescheduË
()

357 
vÃt
 = 0; vÃˆ< 
m_vœtu®_ÃtwÜks
; vnet++) {

358 ià(
šNode_±r
[
vÃt
]->
	`isR—dy
()) {

359 
	`scheduËEv’t
(
	`Cyşes
(1));

363 
vc
 = 0; vø< 
m_num_vcs
; vc++) {

364 ià(
m_ni_bufãrs
[
vc
]->
	`isR—dyFÜNext
(
m_Ãt_±r
->
	`curCyşe
())) {

365 
	`scheduËEv’t
(
	`Cyşes
(1));

369 
	}
}

372 
	gN‘wÜkIÁ”çû_d
::
´št
(
¡d
::
o¡»am
& 
out
) const

374 
out
 << "[Network Interface]";

377 
ušt32_t


378 
	gN‘wÜkIÁ”çû_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

380 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

381 
i
 = 0; i < 
m_num_vcs
; ++i) {

382 
num_funùiÚ®_wr™es
 +ğ
m_ni_bufãrs
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

385 
num_funùiÚ®_wr™es
 +ğ
outSrcQueue
->
	`funùiÚ®Wr™e
(
pkt
);

386  
num_funùiÚ®_wr™es
;

387 
	}
}

	@ruby/network/garnet/fixed-pipeline/NetworkInterface_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_NETWORK_INTERFACE_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_NETWORK_INTERFACE_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/CÚsum”.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/C»d™Lšk_d.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtN‘wÜk_d.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/OutVcS‹_d.hh
"

42 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

43 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

45 
şass
 
	gN‘wÜkMes§ge
;

46 
şass
 
	gMes§geBufãr
;

47 
şass
 
	gæ™Bufãr_d
;

49 şas 
	cN‘wÜkIÁ”çû_d
 : 
public
 
CÚsum”


51 
public
:

52 
N‘wÜkIÁ”çû_d
(
id
, 
vœtu®_ÃtwÜks
,

53 
G¬ÃtN‘wÜk_d
* 
ÃtwÜk_±r
);

55 ~
N‘wÜkIÁ”çû_d
();

57 
addInPÜt
(
N‘wÜkLšk_d
 *
š_lšk
, 
C»d™Lšk_d
 *
üed™_lšk
);

58 
addOutPÜt
(
N‘wÜkLšk_d
 *
out_lšk
, 
C»d™Lšk_d
 *
üed™_lšk
);

60 
wakeup
();

61 
addNode
(
¡d
::
veùÜ
<
Mes§geBufãr
 *> &
šNode
,

62 
¡d
::
veùÜ
<
Mes§geBufãr
 *> &
outNode
);

63 
´št
(
¡d
::
o¡»am
& 
out
) const;

64 
g‘_vÃt
(
vc
);

66 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *);

68 
	m´iv©e
:

69 
G¬ÃtN‘wÜk_d
 *
m_Ãt_±r
;

70 
	mm_vœtu®_ÃtwÜks
, 
	mm_num_vcs
, 
	mm_vc_³r_vÃt
;

71 
NodeID
 
	mm_id
;

72 
	m¡d
::
veùÜ
<
OutVcS‹_d
 *> 
m_out_vc_¡©e
;

73 
	m¡d
::
veùÜ
<> 
m_vc_®loÿtÜ
;

74 
	mm_vc_round_robš
;

75 
æ™Bufãr_d
 *
	moutSrcQueue
;

76 
æ™Bufãr_d
 *
	müed™Queue
;

78 
N‘wÜkLšk_d
 *
	mšN‘Lšk
;

79 
N‘wÜkLšk_d
 *
	moutN‘Lšk
;

80 
C»d™Lšk_d
 *
	mm_üed™_lšk
;

81 
C»d™Lšk_d
 *
	mm_ni_üed™_lšk
;

85 
	m¡d
::
veùÜ
<
æ™Bufãr_d
 *> 
m_ni_bufãrs
;

86 
	m¡d
::
veùÜ
<
Time
> 
m_ni_’queue_time
;

89 
	m¡d
::
veùÜ
<
Mes§geBufãr
 *> 
šNode_±r
;

91 
	m¡d
::
veùÜ
<
Mes§geBufãr
 *> 
outNode_±r
;

93 
boŞ
 
æ™isizeMes§ge
(
MsgPŒ
 
msg_±r
, 
vÃt
);

94 
ÿlcuÏ‹VC
(
vÃt
);

95 
scheduËOuutLšk
();

96 
checkRescheduË
();

	@ruby/network/garnet/fixed-pipeline/NetworkLink_d.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/C»d™Lšk_d.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

34 
	gN‘wÜkLšk_d
::
	$N‘wÜkLšk_d
(cÚ¡ 
P¬ams
 *
p
)

35 : 
	`ClockedObjeù
(
p
), 
	$CÚsum”
(
this
)

37 
m_Ï‹ncy
 = 
p
->
lšk_Ï‹ncy
;

38 
chªÃl_width
 = 
p
->channel_width;

39 
m_id
 = 
p
->
lšk_id
;

40 
lškBufãr
 = 
Ãw
 
	`æ™Bufãr_d
();

41 
m_lšk_utized
 = 0;

42 
m_vc_lßd
.
	`»size
(
p
->
vcs_³r_vÃt
 *…->
vœt_Ãts
);

44 
i
 = 0; i < (
p
->
vcs_³r_vÃt
 *…->
vœt_Ãts
); i++) {

45 
m_vc_lßd
[
i
] = 0;

47 
	}
}

49 
	gN‘wÜkLšk_d
::~
	$N‘wÜkLšk_d
()

51 
d–‘e
 
lškBufãr
;

52 
	}
}

55 
	gN‘wÜkLšk_d
::
	$£tLškCÚsum”
(
CÚsum”
 *
cÚsum”
)

57 
lšk_cÚsum”
 = 
cÚsum”
;

58 
	}
}

61 
	gN‘wÜkLšk_d
::
	$£tSourûQueue
(
æ™Bufãr_d
 *
¤cQueue
)

63 
lšk_¤cQueue
 = 
¤cQueue
;

64 
	}
}

67 
	gN‘wÜkLšk_d
::
	$wakeup
()

69 ià(
lšk_¤cQueue
->
	`isR—dy
(
	`curCyşe
())) {

70 
æ™_d
 *
t_æ™
 = 
lšk_¤cQueue
->
	`g‘TİFl™
();

71 
t_æ™
->
	`£t_time
(
	`curCyşe
(è+ 
m_Ï‹ncy
);

72 
lškBufãr
->
	`š£¹
(
t_æ™
);

73 
lšk_cÚsum”
->
	`scheduËEv’tAbsŞu‹
(
	`şockEdge
(
m_Ï‹ncy
));

74 
m_lšk_utized
++;

75 
m_vc_lßd
[
t_æ™
->
	`g‘_vc
()]++;

77 
	}
}

79 
N‘wÜkLšk_d
 *

80 
	gN‘wÜkLšk_dP¬ams
::
	$ü—‹
()

82  
Ãw
 
	`N‘wÜkLšk_d
(
this
);

83 
	}
}

85 
C»d™Lšk_d
 *

86 
	gC»d™Lšk_dP¬ams
::
	$ü—‹
()

88  
Ãw
 
	`C»d™Lšk_d
(
this
);

89 
	}
}

91 
ušt32_t


92 
	gN‘wÜkLšk_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

94  
lškBufãr
->
	`funùiÚ®Wr™e
(
pkt
);

95 
	}
}

	@ruby/network/garnet/fixed-pipeline/NetworkLink_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_NETWORK_LINK_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_NETWORK_LINK_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/CÚsum”.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™Bufãr_d.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/N‘wÜkPow”.hh
"

41 
	~"·¿ms/N‘wÜkLšk_d.hh
"

42 
	~"sim/şocked_objeù.hh
"

44 
şass
 
	gG¬ÃtN‘wÜk_d
;

46 
şass
 
	gN‘wÜkLšk_d
 : 
public
 
ClockedObjeù
,…ubliø
	gCÚsum”


48 
	gpublic
:

49 
N‘wÜkLšk_dP¬ams
 
	tP¬ams
;

50 
N‘wÜkLšk_d
(cÚ¡ 
P¬ams
 *
p
);

51 ~
N‘wÜkLšk_d
();

53 
£tLškCÚsum”
(
CÚsum”
 *
cÚsum”
);

54 
£tSourûQueue
(
æ™Bufãr_d
 *
¤cQueue
);

55 
´št
(
¡d
::
o¡»am
& 
out
) const{}

56 
g‘_id
(){ 
m_id
;}

57 
wakeup
();

59 
ÿlcuÏ‹_pow”
();

60 
g‘_dyÇmic_pow”
(ècÚ¡ {  
	gm_pow”_dyn
; }

61 
g‘_¡©ic_pow”
()cÚ¡ {  
	gm_pow”_¡a
; }

63 
g‘LškUtiz©iÚ
(ècÚ¡ {  
	gm_lšk_utized
; }

64 cÚ¡ 
	g¡d
::
veùÜ
<> & 
g‘VcLßd
(ècÚ¡ {  
m_vc_lßd
; }

66 
šlše
 
boŞ
 
isR—dy
(
Cyşes
 
curTime
)

67 {  
	glškBufãr
->
isR—dy
(
curTime
); }

69 
šlše
 
æ™_d
* 
³ekLšk
(è{  
	glškBufãr
->
³ekTİFl™
(); }

70 
šlše
 
æ™_d
* 
cÚsumeLšk
(è{  
	glškBufãr
->
g‘TİFl™
(); }

72 
š™_Ãt_±r
(
G¬ÃtN‘wÜk_d
* 
Ãt_±r
è{ 
	gm_Ãt_±r
 =‚et_ptr; }

73 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *);

75 
	g´iv©e
:

76 
m_id
;

77 
Cyşes
 
	gm_Ï‹ncy
;

78 
	gchªÃl_width
;

80 
G¬ÃtN‘wÜk_d
 *
	gm_Ãt_±r
;

81 
æ™Bufãr_d
 *
	glškBufãr
;

82 
CÚsum”
 *
	glšk_cÚsum”
;

83 
æ™Bufãr_d
 *
	glšk_¤cQueue
;

84 
	gm_æ™_width
;

87 
	gm_lšk_utized
;

88 
	g¡d
::
veùÜ
<> 
m_vc_lßd
;

90 
	gm_pow”_dyn
;

91 
	gm_pow”_¡a
;

	@ruby/network/garnet/fixed-pipeline/OutVcState_d.cc

31 
	~"mem/ruby/commÚ/Glob®.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/OutVcS‹_d.hh
"

33 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

35 
	gOutVcS‹_d
::
	$OutVcS‹_d
(
id
, 
G¬ÃtN‘wÜk_d
 *
ÃtwÜk_±r
)

36 : 
	$m_time
(0)

38 
m_id
 = 
id
;

39 
m_vc_¡©e
 = 
IDLE_
;

41 ià(
ÃtwÜk_±r
->
	`g‘_vÃt_ty³
(
id
è=ğ
DATA_VNET_
)

42 
m_üed™_couÁ
 = 
ÃtwÜk_±r
->
	`g‘BufãrsP”D©aVC
();

44 
m_üed™_couÁ
 = 
ÃtwÜk_±r
->
	`g‘BufãrsP”CŒlVC
();

46 
	`as£¹
(
m_üed™_couÁ
 >= 1);

47 
	}
}

	@ruby/network/garnet/fixed-pipeline/OutVcState_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_OUT_VC_STATE_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_OUT_VC_STATE_D_HH__


	)

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtN‘wÜk_d.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

37 şas 
	cOutVcS‹_d


39 
	mpublic
:

40 
OutVcS‹_d
(
id
, 
G¬ÃtN‘wÜk_d
 *
ÃtwÜk_±r
);

42 
	$g‘_špÜt
(è{  
m_š_pÜt
; }

43 
	$g‘_švc
(è{  
m_š_vc
; 
	}
}

44 
	$g‘_üed™_couÁ
(è{  
m_üed™_couÁ
; 
	}
}

46 
	$£t_špÜt
(
pÜt
è{ 
m_š_pÜt
 =…Üt; 
	}
}

47 
	$£t_švc
(
vc
è{ 
m_š_vc
 = vc; 
	}
}

48 
šlše
 
boŞ


49 
	$isInS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
»que¡_time
)

51  ((
m_vc_¡©e
 =ğ
¡©e
è&& (
»que¡_time
 >ğ
m_time
) );

52 
	}
}

53 
šlše
 

54 
	$£tS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
time
)

56 
m_vc_¡©e
 = 
¡©e
;

57 
m_time
 = 
time
;

58 
	}
}

59 
šlše
 
boŞ
 
	$has_üed™s
(è{  (
m_üed™_couÁ
 > 0); 
	}
}

60 
šlše
 
	$šüem’t_üed™
(è{ 
m_üed™_couÁ
++; 
	}
}

61 
šlše
 
	$deüem’t_üed™
(è{ 
m_üed™_couÁ
--; 
	}
}

63 
	g´iv©e
:

64 
m_id
 ;

65 
Cyşes
 
	gm_time
;

66 
VC_¡©e_ty³
 
	gm_vc_¡©e
;

67 
	gm_š_pÜt
;

68 
	gm_š_vc
;

69 
	gm_üed™_couÁ
;

	@ruby/network/garnet/fixed-pipeline/OutputUnit_d.cc

31 
	~"ba£/¡l_h–³rs.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/OuutUn™_d.hh
"

33 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

35 
usšg
 
Çme¥aû
 
	g¡d
;

36 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

38 
	gOuutUn™_d
::
	$OuutUn™_d
(
id
, 
Rou‹r_d
 *
rou‹r
)

39 : 
	$CÚsum”
(
rou‹r
)

41 
m_id
 = 
id
;

42 
m_rou‹r
 = 
rou‹r
;

43 
m_num_vcs
 = 
m_rou‹r
->
	`g‘_num_vcs
();

44 
m_out_bufãr
 = 
Ãw
 
	`æ™Bufãr_d
();

46 
i
 = 0; i < 
m_num_vcs
; i++) {

47 
m_outvc_¡©e
.
	`push_back
(
Ãw
 
	`OutVcS‹_d
(
i
, 
m_rou‹r
->
	`g‘_Ãt_±r
()));

49 
	}
}

51 
	gOuutUn™_d
::~
	$OuutUn™_d
()

53 
d–‘e
 
m_out_bufãr
;

54 
	`d–‘ePoš‹rs
(
m_outvc_¡©e
);

55 
	}
}

58 
	gOuutUn™_d
::
	$deüem’t_üed™
(
out_vc
)

60 
m_outvc_¡©e
[
out_vc
]->
	`deüem’t_üed™
();

61 
m_rou‹r
->
	`upd©e_šüed™
(
m_outvc_¡©e
[
out_vc
]->
	`g‘_špÜt
(),

62 
m_outvc_¡©e
[
out_vc
]->
	`g‘_švc
(),

63 
m_outvc_¡©e
[
out_vc
]->
	`g‘_üed™_couÁ
());

64 
	}
}

67 
	gOuutUn™_d
::
	$wakeup
()

69 ià(
m_üed™_lšk
->
	`isR—dy
(
m_rou‹r
->
	`curCyşe
())) {

70 
æ™_d
 *
t_æ™
 = 
m_üed™_lšk
->
	`cÚsumeLšk
();

71 
out_vc
 = 
t_æ™
->
	`g‘_vc
();

72 
m_outvc_¡©e
[
out_vc
]->
	`šüem’t_üed™
();

73 
m_rou‹r
->
	`upd©e_šüed™
(
m_outvc_¡©e
[
out_vc
]->
	`g‘_špÜt
(),

74 
m_outvc_¡©e
[
out_vc
]->
	`g‘_švc
(),

75 
m_outvc_¡©e
[
out_vc
]->
	`g‘_üed™_couÁ
());

77 ià(
t_æ™
->
	`is_ä“_sigÇl
())

78 
	`£t_vc_¡©e
(
IDLE_
, 
out_vc
, 
m_rou‹r
->
	`curCyşe
());

80 
d–‘e
 
t_æ™
;

82 
	}
}

84 
æ™Bufãr_d
*

85 
	gOuutUn™_d
::
	$g‘OutQueue
()

87  
m_out_bufãr
;

88 
	}
}

91 
	gOuutUn™_d
::
	$£t_out_lšk
(
N‘wÜkLšk_d
 *
lšk
)

93 
m_out_lšk
 = 
lšk
;

94 
	}
}

97 
	gOuutUn™_d
::
	$£t_üed™_lšk
(
C»d™Lšk_d
 *
üed™_lšk
)

99 
m_üed™_lšk
 = 
üed™_lšk
;

100 
	}
}

103 
	gOuutUn™_d
::
	$upd©e_vc
(
vc
, 
š_pÜt
, 
š_vc
)

105 
m_outvc_¡©e
[
vc
]->
	`£tS‹
(
ACTIVE_
, 
m_rou‹r
->
	`curCyşe
(è+ 
	`Cyşes
(1));

106 
m_outvc_¡©e
[
vc
]->
	`£t_špÜt
(
š_pÜt
);

107 
m_outvc_¡©e
[
vc
]->
	`£t_švc
(
š_vc
);

108 
m_rou‹r
->
	`upd©e_šüed™
(
š_pÜt
, 
š_vc
,

109 
m_outvc_¡©e
[
vc
]->
	`g‘_üed™_couÁ
());

110 
	}
}

112 
ušt32_t


113 
	gOuutUn™_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

115  
m_out_bufãr
->
	`funùiÚ®Wr™e
(
pkt
);

116 
	}
}

	@ruby/network/garnet/fixed-pipeline/OutputUnit_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_OUTPUT_UNIT_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_OUTPUT_UNIT_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/CÚsum”.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/C»d™Lšk_d.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/OutVcS‹_d.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™Bufãr_d.hh
"

42 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

44 
şass
 
	gRou‹r_d
;

46 şas 
	cOuutUn™_d
 : 
public
 
CÚsum”


48 
public
:

49 
OuutUn™_d
(
id
, 
Rou‹r_d
 *
rou‹r
);

50 ~
OuutUn™_d
();

51 
£t_out_lšk
(
N‘wÜkLšk_d
 *
lšk
);

52 
£t_üed™_lšk
(
C»d™Lšk_d
 *
üed™_lšk
);

53 
wakeup
();

54 
æ™Bufãr_d
* 
g‘OutQueue
();

55 
upd©e_vc
(
vc
, 
š_pÜt
, 
š_vc
);

56 
´št
(
¡d
::
o¡»am
& 
out
) const {};

57 
deüem’t_üed™
(
out_vc
);

60 
	$g‘_üed™_út
(
vc
)

62  
m_outvc_¡©e
[
vc
]->
	`g‘_üed™_couÁ
();

63 
	}
}

65 
šlše
 

66 
	$g‘_oušk_id
()

68  
m_out_lšk
->
	`g‘_id
();

69 
	}
}

71 
šlše
 

72 
	$£t_vc_¡©e
(
VC_¡©e_ty³
 
¡©e
, 
vc
, 
Cyşes
 
curTime
)

74 
m_outvc_¡©e
[
vc
]->
	`£tS‹
(
¡©e
, 
curTime
 + 
	`Cyşes
(1));

75 
	}
}

77 
šlše
 
boŞ


78 
	$is_vc_idË
(
vc
, 
Cyşes
 
curTime
)

80  (
m_outvc_¡©e
[
vc
]->
	`isInS‹
(
IDLE_
, 
curTime
));

81 
	}
}

83 
šlše
 

84 
	$š£¹_æ™
(
æ™_d
 *
t_æ™
)

86 
m_out_bufãr
->
	`š£¹
(
t_æ™
);

87 
m_out_lšk
->
	`scheduËEv’tAbsŞu‹
(
m_rou‹r
->
	`şockEdge
(
	`Cyşes
(1)));

88 
	}
}

90 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

92 
	g´iv©e
:

93 
m_id
;

94 
	gm_num_vcs
;

95 
Rou‹r_d
 *
	gm_rou‹r
;

96 
N‘wÜkLšk_d
 *
	gm_out_lšk
;

97 
C»d™Lšk_d
 *
	gm_üed™_lšk
;

99 
æ™Bufãr_d
 *
	gm_out_bufãr
;

100 
	g¡d
::
veùÜ
<
OutVcS‹_d
 *> 
m_outvc_¡©e
;

	@ruby/network/garnet/fixed-pipeline/Router_d.cc

31 
	~"ba£/¡l_h–³rs.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/C»d™Lšk_d.hh
"

33 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtN‘wÜk_d.hh
"

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/IÅutUn™_d.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

36 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/OuutUn™_d.hh
"

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/RoutšgUn™_d.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/SW®loÿtÜ_d.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Sw™ch_d.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/VC®loÿtÜ_d.hh
"

43 
usšg
 
Çme¥aû
 
	g¡d
;

44 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

46 
	gRou‹r_d
::
	$Rou‹r_d
(cÚ¡ 
P¬ams
 *
p
)

47 : 
	$BasicRou‹r
(
p
)

49 
m_vœtu®_ÃtwÜks
 = 
p
->
vœt_Ãts
;

50 
m_vc_³r_vÃt
 = 
p
->
vcs_³r_vÃt
;

51 
m_num_vcs
 = 
m_vœtu®_ÃtwÜks
 * 
m_vc_³r_vÃt
;

53 
m_routšg_un™
 = 
Ãw
 
	`RoutšgUn™_d
(
this
);

54 
m_vc_®loc
 = 
Ãw
 
	`VC®loÿtÜ_d
(
this
);

55 
m_sw_®loc
 = 
Ãw
 
	`SW®loÿtÜ_d
(
this
);

56 
m_sw™ch
 = 
Ãw
 
	`Sw™ch_d
(
this
);

58 
m_šput_un™
.
	`ş—r
();

59 
m_ouut_un™
.
	`ş—r
();

61 
üossb¬_couÁ
 = 0;

62 
sw_loÿl_¬b™_couÁ
 = 0;

63 
sw_glob®_¬b™_couÁ
 = 0;

64 
buf_»ad_couÁ
.
	`»size
(
m_vœtu®_ÃtwÜks
);

65 
buf_wr™e_couÁ
.
	`»size
(
m_vœtu®_ÃtwÜks
);

66 
vc_loÿl_¬b™_couÁ
.
	`»size
(
m_vœtu®_ÃtwÜks
);

67 
vc_glob®_¬b™_couÁ
.
	`»size
(
m_vœtu®_ÃtwÜks
);

68 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
; i++) {

69 
buf_»ad_couÁ
[
i
] = 0;

70 
buf_wr™e_couÁ
[
i
] = 0;

71 
vc_loÿl_¬b™_couÁ
[
i
] = 0;

72 
vc_glob®_¬b™_couÁ
[
i
] = 0;

74 
	}
}

76 
	gRou‹r_d
::~
	$Rou‹r_d
()

78 
	`d–‘ePoš‹rs
(
m_šput_un™
);

79 
	`d–‘ePoš‹rs
(
m_ouut_un™
);

80 
d–‘e
 
m_routšg_un™
;

81 
d–‘e
 
m_vc_®loc
;

82 
d–‘e
 
m_sw_®loc
;

83 
d–‘e
 
m_sw™ch
;

84 
	}
}

87 
	gRou‹r_d
::
	$š™
()

89 
BasicRou‹r
::
	`š™
();

91 
m_vc_®loc
->
	`š™
();

92 
m_sw_®loc
->
	`š™
();

93 
m_sw™ch
->
	`š™
();

94 
	}
}

97 
	gRou‹r_d
::
	$addInPÜt
(
N‘wÜkLšk_d
 *
š_lšk
, 
C»d™Lšk_d
 *
üed™_lšk
)

99 
pÜt_num
 = 
m_šput_un™
.
	`size
();

100 
IÅutUn™_d
 *
šput_un™
 = 
Ãw
 
	`IÅutUn™_d
(
pÜt_num
, 
this
);

102 
šput_un™
->
	`£t_š_lšk
(
š_lšk
);

103 
šput_un™
->
	`£t_üed™_lšk
(
üed™_lšk
);

104 
š_lšk
->
	`£tLškCÚsum”
(
šput_un™
);

105 
üed™_lšk
->
	`£tSourûQueue
(
šput_un™
->
	`g‘C»d™Queue
());

107 
m_šput_un™
.
	`push_back
(
šput_un™
);

108 
	}
}

111 
	gRou‹r_d
::
	$addOutPÜt
(
N‘wÜkLšk_d
 *
out_lšk
,

112 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
, 
lšk_weight
,

113 
C»d™Lšk_d
 *
üed™_lšk
)

115 
pÜt_num
 = 
m_ouut_un™
.
	`size
();

116 
OuutUn™_d
 *
ouut_un™
 = 
Ãw
 
	`OuutUn™_d
(
pÜt_num
, 
this
);

118 
ouut_un™
->
	`£t_out_lšk
(
out_lšk
);

119 
ouut_un™
->
	`£t_üed™_lšk
(
üed™_lšk
);

120 
üed™_lšk
->
	`£tLškCÚsum”
(
ouut_un™
);

121 
out_lšk
->
	`£tSourûQueue
(
ouut_un™
->
	`g‘OutQueue
());

123 
m_ouut_un™
.
	`push_back
(
ouut_un™
);

125 
m_routšg_un™
->
	`addRou‹
(
routšg_bË_’Œy
);

126 
m_routšg_un™
->
	`addWeight
(
lšk_weight
);

127 
	}
}

130 
	gRou‹r_d
::
	$rou‹_»q
(
æ™_d
 *
t_æ™
, 
IÅutUn™_d
 *
š_un™
, 
švc
)

132 
m_routšg_un™
->
	`RC_¡age
(
t_æ™
, 
š_un™
, 
švc
);

133 
	}
}

136 
	gRou‹r_d
::
	$vÿrb_»q
()

138 
m_vc_®loc
->
	`scheduËEv’tAbsŞu‹
(
	`şockEdge
(
	`Cyşes
(1)));

139 
	}
}

142 
	gRou‹r_d
::
	$sw¬b_»q
()

144 
m_sw_®loc
->
	`scheduËEv’tAbsŞu‹
(
	`şockEdge
(
	`Cyşes
(1)));

145 
	}
}

148 
	gRou‹r_d
::
	$upd©e_šüed™
(
š_pÜt
, 
š_vc
, 
üed™
)

150 
m_šput_un™
[
š_pÜt
]->
	`upd©e_üed™
(
š_vc
, 
üed™
);

151 
	}
}

154 
	gRou‹r_d
::
	$upd©e_sw_wšÃr
(
špÜt
, 
æ™_d
 *
t_æ™
)

156 
m_sw™ch
->
	`upd©e_sw_wšÃr
(
špÜt
, 
t_æ™
);

157 
m_sw™ch
->
	`scheduËEv’tAbsŞu‹
(
	`şockEdge
(
	`Cyşes
(1)));

158 
	}
}

161 
	gRou‹r_d
::
	$ÿlcuÏ‹_³rfÜmªû_numb”s
()

163 
j
 = 0; j < 
m_vœtu®_ÃtwÜks
; j++) {

164 
i
 = 0; i < 
m_šput_un™
.
	`size
(); i++) {

165 
buf_»ad_couÁ
[
j
] +ğ
m_šput_un™
[
i
]->
	`g‘_buf_»ad_couÁ
(j);

166 
buf_wr™e_couÁ
[
j
] +ğ
m_šput_un™
[
i
]->
	`g‘_buf_wr™e_couÁ
(j);

169 
vc_loÿl_¬b™_couÁ
[
j
] = 
m_vc_®loc
->
	`g‘_loÿl_¬b™_couÁ
(j);

170 
vc_glob®_¬b™_couÁ
[
j
] = 
m_vc_®loc
->
	`g‘_glob®_¬b™_couÁ
(j);

173 
sw_loÿl_¬b™_couÁ
 = 
m_sw_®loc
->
	`g‘_loÿl_¬b™_couÁ
();

174 
sw_glob®_¬b™_couÁ
 = 
m_sw_®loc
->
	`g‘_glob®_¬b™_couÁ
();

175 
üossb¬_couÁ
 = 
m_sw™ch
->
	`g‘_üossb¬_couÁ
();

176 
	}
}

179 
	gRou‹r_d
::
	$´štFauÉVeùÜ
(
o¡»am
& 
out
)

181 
‹m³¿tu»_ûlcius
 = 
BASELINE_TEMPERATURE_CELCIUS
;

182 
num_çuÉ_ty³s
 = 
m_ÃtwÜk_±r
->
çuÉ_mod–
->
numb”_of_çuÉ_ty³s
;

183 
çuÉ_veùÜ
[
num_çuÉ_ty³s
];

184 
	`g‘_çuÉ_veùÜ
(
‹m³¿tu»_ûlcius
, 
çuÉ_veùÜ
);

185 
out
 << "Rou‹r-" << 
m_id
 << " fauÉ veùÜ: " << 
’dl
;

186 
çuÉ_ty³_šdex
 = 0; fauÉ_ty³_šdex < 
num_çuÉ_ty³s
;

187 
çuÉ_ty³_šdex
++){

188 
out
 << " -…robability of (";

189 
out
 <<

190 
m_ÃtwÜk_±r
->
çuÉ_mod–
->
	`çuÉ_ty³_to_¡ršg
(
çuÉ_ty³_šdex
);

191 
out
 << ") = ";

192 
out
 << 
çuÉ_veùÜ
[
çuÉ_ty³_šdex
] << 
’dl
;

194 
	}
}

197 
	gRou‹r_d
::
´štAgg»g©eFauÉProbab™y
(
¡d
::
o¡»am
& 
out
)

199 
‹m³¿tu»_ûlcius
 = 
BASELINE_TEMPERATURE_CELCIUS
;

200 
	gagg»g©e_çuÉ_´ob
;

201 
g‘_agg»g©e_çuÉ_´obab™y
(
‹m³¿tu»_ûlcius
,

202 &
agg»g©e_çuÉ_´ob
);

203 
	gout
 << "Rou‹r-" << 
	gm_id
 << " fault…robability: ";

204 
	gout
 << 
	gagg»g©e_çuÉ_´ob
 << 
	g’dl
;

207 
ušt32_t


208 
	gRou‹r_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

210 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

211 
num_funùiÚ®_wr™es
 +ğ
m_sw™ch
->
	`funùiÚ®Wr™e
(
pkt
);

213 
ušt32_t
 
i
 = 0; i < 
m_šput_un™
.
	`size
(); i++) {

214 
num_funùiÚ®_wr™es
 +ğ
m_šput_un™
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

217 
ušt32_t
 
i
 = 0; i < 
m_ouut_un™
.
	`size
(); i++) {

218 
num_funùiÚ®_wr™es
 +ğ
m_ouut_un™
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

221  
num_funùiÚ®_wr™es
;

222 
	}
}

224 
Rou‹r_d
 *

225 
	gG¬ÃtRou‹r_dP¬ams
::
	$ü—‹
()

227  
Ãw
 
	`Rou‹r_d
(
this
);

228 
	}
}

	@ruby/network/garnet/fixed-pipeline/Router_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_ROUTER_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_ROUTER_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/N‘De¡.hh
"

38 
	~"mem/ruby/ÃtwÜk/BasicRou‹r.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™_d.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/N‘wÜkPow”.hh
"

42 
	~"·¿ms/G¬ÃtRou‹r_d.hh
"

44 
şass
 
	gG¬ÃtN‘wÜk_d
;

45 
şass
 
	gN‘wÜkLšk_d
;

46 
şass
 
	gC»d™Lšk_d
;

47 
şass
 
	gIÅutUn™_d
;

48 
şass
 
	gOuutUn™_d
;

49 
şass
 
	gRoutšgUn™_d
;

50 
şass
 
	gVC®loÿtÜ_d
;

51 
şass
 
	gSW®loÿtÜ_d
;

52 
şass
 
	gSw™ch_d
;

53 
şass
 
	gFauÉMod–
;

55 şas 
	cRou‹r_d
 : 
public
 
BasicRou‹r


57 
public
:

58 
G¬ÃtRou‹r_dP¬ams
 
	tP¬ams
;

59 
Rou‹r_d
(cÚ¡ 
P¬ams
 *
p
);

61 ~
Rou‹r_d
();

63 
š™
();

64 
addInPÜt
(
N‘wÜkLšk_d
 *
lšk
, 
C»d™Lšk_d
 *
üed™_lšk
);

65 
addOutPÜt
(
N‘wÜkLšk_d
 *
lšk
, cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
,

66 
lšk_weight
, 
C»d™Lšk_d
 *
üed™_lšk
);

68 
	$g‘_num_vcs
(è{  
m_num_vcs
; }

69 
	$g‘_num_vÃts
(è{  
m_vœtu®_ÃtwÜks
; 
	}
}

70 
	$g‘_vc_³r_vÃt
(è{  
m_vc_³r_vÃt
; 
	}
}

71 
	$g‘_num_špÜts
(è{  
m_šput_un™
.
	`size
(); 
	}
}

72 
	$g‘_num_ouÜts
(è{  
m_ouut_un™
.
	`size
(); 
	}
}

73 
	$g‘_id
(è{  
m_id
; 
	}
}

75 
	$š™_Ãt_±r
(
G¬ÃtN‘wÜk_d
* 
Ãt_±r
)

77 
m_ÃtwÜk_±r
 = 
Ãt_±r
;

78 
	}
}

80 
G¬ÃtN‘wÜk_d
* 
	$g‘_Ãt_±r
(è{  
m_ÃtwÜk_±r
; 
	}
}

81 
	g¡d
::
veùÜ
<
IÅutUn™_d
 *>& 
	$g‘_šputUn™_»f
(è{  
m_šput_un™
; 
	}
}

82 
	g¡d
::
veùÜ
<
OuutUn™_d
 *>& 
	$g‘_ouutUn™_»f
(è{  
m_ouut_un™
; 
	}
}

84 
upd©e_sw_wšÃr
(
špÜt
, 
æ™_d
 *
t_æ™
);

85 
upd©e_šüed™
(
š_pÜt
, 
š_vc
, 
üed™
);

86 
rou‹_»q
(
æ™_d
 *
t_æ™
, 
IÅutUn™_d
* 
š_un™
, 
švc
);

87 
vÿrb_»q
();

88 
sw¬b_»q
();

89 
´štFauÉVeùÜ
(
¡d
::
o¡»am
& 
out
);

90 
´štAgg»g©eFauÉProbab™y
(
¡d
::
o¡»am
& 
out
);

92 
ÿlcuÏ‹_pow”
();

93 
ÿlcuÏ‹_³rfÜmªû_numb”s
();

94 
	$g‘_dyÇmic_pow”
(ècÚ¡ {  
m_pow”_dyn
; 
	}
}

95 
	$g‘_¡©ic_pow”
(ècÚ¡ {  
m_pow”_¡a
; 
	}
}

96 
	$g‘_şk_pow”
(ècÚ¡ {  
m_şk_pow”
; 
	}
}

98 
boŞ
 
	$g‘_çuÉ_veùÜ
(
‹m³¿tu»
, 
çuÉ_veùÜ
[]){

99  
m_ÃtwÜk_±r
->
çuÉ_mod–
->
	`çuÉ_veùÜ
(
m_id
, 
‹m³¿tu»
,

100 
çuÉ_veùÜ
);

101 
	}
}

102 
boŞ
 
	$g‘_agg»g©e_çuÉ_´obab™y
(
‹m³¿tu»
,

103 *
agg»g©e_çuÉ_´ob
){

104  
m_ÃtwÜk_±r
->
çuÉ_mod–
->
	`çuÉ_´ob
(
m_id
, 
‹m³¿tu»
,

105 
agg»g©e_çuÉ_´ob
);

106 
	}
}

108 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *);

110 
	g´iv©e
:

111 
m_vœtu®_ÃtwÜks
, 
	gm_num_vcs
, 
	gm_vc_³r_vÃt
;

112 
G¬ÃtN‘wÜk_d
 *
	gm_ÃtwÜk_±r
;

113 
	gsw_loÿl_¬b™_couÁ
, 
	gsw_glob®_¬b™_couÁ
;

114 
	güossb¬_couÁ
;

116 
	g¡d
::
veùÜ
<
IÅutUn™_d
 *> 
m_šput_un™
;

117 
	g¡d
::
veùÜ
<
OuutUn™_d
 *> 
m_ouut_un™
;

118 
RoutšgUn™_d
 *
	gm_routšg_un™
;

119 
VC®loÿtÜ_d
 *
	gm_vc_®loc
;

120 
SW®loÿtÜ_d
 *
	gm_sw_®loc
;

121 
Sw™ch_d
 *
	gm_sw™ch
;

124 
	gm_pow”_dyn
;

125 
	gm_pow”_¡a
;

126 
	gm_şk_pow”
;

129 
	g¡d
::
veùÜ
<> 
buf_»ad_couÁ
;

130 
	g¡d
::
veùÜ
<> 
buf_wr™e_couÁ
;

131 
	g¡d
::
veùÜ
<> 
vc_loÿl_¬b™_couÁ
;

132 
	g¡d
::
veùÜ
<> 
vc_glob®_¬b™_couÁ
;

	@ruby/network/garnet/fixed-pipeline/RoutingUnit_d.cc

31 
	~"ba£/ÿ¡.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/IÅutUn™_d.hh
"

33 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/RoutšgUn™_d.hh
"

35 
	~"mem/ruby/¦icc_š‹rçû/N‘wÜkMes§ge.hh
"

37 
	gRoutšgUn™_d
::
	$RoutšgUn™_d
(
Rou‹r_d
 *
rou‹r
)

39 
m_rou‹r
 = 
rou‹r
;

40 
m_routšg_bË
.
	`ş—r
();

41 
m_weight_bË
.
	`ş—r
();

42 
	}
}

45 
	gRoutšgUn™_d
::
	$addRou‹
(cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

47 
m_routšg_bË
.
	`push_back
(
routšg_bË_’Œy
);

48 
	}
}

51 
	gRoutšgUn™_d
::
	$addWeight
(
lšk_weight
)

53 
m_weight_bË
.
	`push_back
(
lšk_weight
);

54 
	}
}

57 
	gRoutšgUn™_d
::
	$RC_¡age
(
æ™_d
 *
t_æ™
, 
IÅutUn™_d
 *
š_un™
, 
švc
)

59 
ouÜt
 = 
	`rou‹Compu‹
(
t_æ™
);

60 
š_un™
->
	`upd©eRou‹
(
švc
, 
ouÜt
, 
m_rou‹r
->
	`curCyşe
());

61 
t_æ™
->
	`advªû_¡age
(
VA_
, 
m_rou‹r
->
	`curCyşe
());

62 
m_rou‹r
->
	`vÿrb_»q
();

63 
	}
}

66 
	gRoutšgUn™_d
::
	$rou‹Compu‹
(
æ™_d
 *
t_æ™
)

68 
MsgPŒ
 
msg_±r
 = 
t_æ™
->
	`g‘_msg_±r
();

69 
N‘wÜkMes§ge
* 
Ãt_msg_±r
 = 
§ã_ÿ¡
<N‘wÜkMes§g*>(
msg_±r
.
	`g‘
());

70 
N‘De¡
 
msg_de¡š©iÚ
 = 
Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
();

72 
ouut_lšk
 = -1;

73 
mš_weight
 = 
INFINITE_
;

75 
lšk
 = 0;†šk < 
m_routšg_bË
.
	`size
();†ink++) {

76 ià(
msg_de¡š©iÚ
.
	`š‹r£ùiÚIsNÙEm±y
(
m_routšg_bË
[
lšk
])) {

77 ià(
m_weight_bË
[
lšk
] >ğ
mš_weight
)

79 
ouut_lšk
 = 
lšk
;

80 
mš_weight
 = 
m_weight_bË
[
lšk
];

84 ià(
ouut_lšk
 == -1) {

85 
	`çl
("Fatal Error:: No Routeƒxists fromhis Router.");

86 
	`ex™
(0);

89  
ouut_lšk
;

90 
	}
}

	@ruby/network/garnet/fixed-pipeline/RoutingUnit_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_ROUTING_UNIT_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_ROUTING_UNIT_D_HH__


	)

34 
	~"mem/ruby/commÚ/CÚsum”.hh
"

35 
	~"mem/ruby/commÚ/N‘De¡.hh
"

36 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™_d.hh
"

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

39 
şass
 
	gIÅutUn™_d
;

40 
şass
 
	gRou‹r_d
;

42 şas 
	cRoutšgUn™_d


44 
	mpublic
:

45 
RoutšgUn™_d
(
Rou‹r_d
 *
rou‹r
);

46 
addRou‹
(cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

47 
rou‹Compu‹
(
æ™_d
 *
t_æ™
);

48 
addWeight
(
lšk_weight
);

49 
RC_¡age
(
æ™_d
 *
t_æ™
, 
IÅutUn™_d
 *
š_un™
, 
švc
);

51 
	m´iv©e
:

52 
Rou‹r_d
 *
m_rou‹r
;

53 
	m¡d
::
veùÜ
<
N‘De¡
> 
m_routšg_bË
;

54 
	m¡d
::
veùÜ
<> 
m_weight_bË
;

	@ruby/network/garnet/fixed-pipeline/SWallocator_d.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtN‘wÜk_d.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/IÅutUn™_d.hh
"

33 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/OuutUn™_d.hh
"

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/SW®loÿtÜ_d.hh
"

37 
	gSW®loÿtÜ_d
::
	$SW®loÿtÜ_d
(
Rou‹r_d
 *
rou‹r
)

38 : 
	$CÚsum”
(
rou‹r
)

40 
m_rou‹r
 = 
rou‹r
;

41 
m_num_vcs
 = 
m_rou‹r
->
	`g‘_num_vcs
();

42 
m_vc_³r_vÃt
 = 
m_rou‹r
->
	`g‘_vc_³r_vÃt
();

44 
m_loÿl_¬b™”_aùiv™y
 = 0;

45 
m_glob®_¬b™”_aùiv™y
 = 0;

46 
	}
}

49 
	gSW®loÿtÜ_d
::
	$š™
()

51 
m_šput_un™
 = 
m_rou‹r
->
	`g‘_šputUn™_»f
();

52 
m_ouut_un™
 = 
m_rou‹r
->
	`g‘_ouutUn™_»f
();

54 
m_num_špÜts
 = 
m_rou‹r
->
	`g‘_num_špÜts
();

55 
m_num_ouÜts
 = 
m_rou‹r
->
	`g‘_num_ouÜts
();

56 
m_round_robš_ouÜt
.
	`»size
(
m_num_ouÜts
);

57 
m_round_robš_špÜt
.
	`»size
(
m_num_špÜts
);

58 
m_pÜt_»q
.
	`»size
(
m_num_ouÜts
);

59 
m_vc_wšÃrs
.
	`»size
(
m_num_ouÜts
);

61 
i
 = 0; i < 
m_num_špÜts
; i++) {

62 
m_round_robš_špÜt
[
i
] = 0;

65 
i
 = 0; i < 
m_num_ouÜts
; i++) {

66 
m_pÜt_»q
[
i
].
	`»size
(
m_num_špÜts
);

67 
m_vc_wšÃrs
[
i
].
	`»size
(
m_num_špÜts
);

69 
m_round_robš_ouÜt
[
i
] = 0;

71 
j
 = 0; j < 
m_num_špÜts
; j++) {

72 
m_pÜt_»q
[
i
][
j
] = 
çl£
;

75 
	}
}

78 
	gSW®loÿtÜ_d
::
	$wakeup
()

80 
	`¬b™¿‹_špÜts
();

81 
	`¬b™¿‹_ouÜts
();

83 
	`ş—r_»que¡_veùÜ
();

84 
	`check_fÜ_wakeup
();

86 
	}
}

89 
	gSW®loÿtÜ_d
::
	$¬b™¿‹_špÜts
()

92 
špÜt
 = 0; iÅÜˆ< 
m_num_špÜts
; inport++) {

93 
švc
 = 
m_round_robš_špÜt
[
špÜt
];

96 
Ãxt_round_robš_švc
 = 
švc
;

98 
Ãxt_round_robš_švc
++;

100 ià(
Ãxt_round_robš_švc
 >ğ
m_num_vcs
)

101 
Ãxt_round_robš_švc
 = 0;

102 } !((
m_rou‹r
->
	`g‘_Ãt_±r
())->
	`v®idVœtu®N‘wÜk
(

103 
	`g‘_vÃt
(
Ãxt_round_robš_švc
))));

105 
m_round_robš_špÜt
[
špÜt
] = 
Ãxt_round_robš_švc
;

107 
švc_™”
 = 0; invc_™” < 
m_num_vcs
; invc_iter++) {

108 
švc
++;

109 ià(
švc
 >ğ
m_num_vcs
)

110 
švc
 = 0;

112 ià(!((
m_rou‹r
->
	`g‘_Ãt_±r
())->
	`v®idVœtu®N‘wÜk
(

113 
	`g‘_vÃt
(
švc
))))

116 ià(
m_šput_un™
[
špÜt
]->
	`Ãed_¡age
(
švc
, 
ACTIVE_
, 
SA_
,

117 
m_rou‹r
->
	`curCyşe
()) &&

118 
m_šput_un™
[
špÜt
]->
	`has_üed™s
(
švc
)) {

120 ià(
	`is_ÿndid©e_špÜt
(
špÜt
, 
švc
)) {

121 
ouÜt
 = 
m_šput_un™
[
špÜt
]->
	`g‘_rou‹
(
švc
);

122 
m_loÿl_¬b™”_aùiv™y
++;

123 
m_pÜt_»q
[
ouÜt
][
špÜt
] = 
Œue
;

124 
m_vc_wšÃrs
[
ouÜt
][
špÜt
]ğ
švc
;

130 
	}
}

132 
boŞ


133 
	gSW®loÿtÜ_d
::
	$is_ÿndid©e_špÜt
(
špÜt
, 
švc
)

135 
ouÜt
 = 
m_šput_un™
[
špÜt
]->
	`g‘_rou‹
(
švc
);

136 
Cyşes
 
t_’queue_time
 = 
m_šput_un™
[
špÜt
]->
	`g‘_’queue_time
(
švc
);

137 
t_vÃt
 = 
	`g‘_vÃt
(
švc
);

138 
vc_ba£
 = 
t_vÃt
*
m_vc_³r_vÃt
;

139 ià((
m_rou‹r
->
	`g‘_Ãt_±r
())->
	`isVN‘Ord”ed
(
t_vÃt
)) {

140 
vc_off£t
 = 0; vc_off£ˆ< 
m_vc_³r_vÃt
; vc_offset++) {

141 
‹mp_vc
 = 
vc_ba£
 + 
vc_off£t
;

142 ià(
m_šput_un™
[
špÜt
]->
	`Ãed_¡age
(
‹mp_vc
, 
ACTIVE_
, 
SA_
,

143 
m_rou‹r
->
	`curCyşe
()) &&

144 (
m_šput_un™
[
špÜt
]->
	`g‘_rou‹
(
‹mp_vc
è=ğ
ouÜt
) &&

145 (
m_šput_un™
[
špÜt
]->
	`g‘_’queue_time
(
‹mp_vc
) <

146 
t_’queue_time
)) {

147  
çl£
;

152  
Œue
;

153 
	}
}

157 
	gSW®loÿtÜ_d
::
	$¬b™¿‹_ouÜts
()

161 
ouÜt
 = 0; ouÜˆ< 
m_num_ouÜts
; outport++) {

162 
špÜt
 = 
m_round_robš_ouÜt
[
ouÜt
];

163 
m_round_robš_ouÜt
[
ouÜt
]++;

165 ià(
m_round_robš_ouÜt
[
ouÜt
] >ğ
m_num_ouÜts
)

166 
m_round_robš_ouÜt
[
ouÜt
] = 0;

168 
špÜt_™”
 = 0; iÅÜt_™” < 
m_num_špÜts
; inport_iter++) {

169 
špÜt
++;

170 ià(
špÜt
 >ğ
m_num_špÜts
)

171 
špÜt
 = 0;

174 ià(
m_pÜt_»q
[
ouÜt
][
špÜt
]) {

175 
m_pÜt_»q
[
ouÜt
][
špÜt
] = 
çl£
;

176 
švc
 = 
m_vc_wšÃrs
[
ouÜt
][
špÜt
];

177 
outvc
 = 
m_šput_un™
[
špÜt
]->
	`g‘_outvc
(
švc
);

180 
æ™_d
 *
t_æ™
 = 
m_šput_un™
[
špÜt
]->
	`g‘TİFl™
(
švc
);

181 
t_æ™
->
	`advªû_¡age
(
ST_
, 
m_rou‹r
->
	`curCyşe
());

182 
t_æ™
->
	`£t_vc
(
outvc
);

183 
t_æ™
->
	`£t_ouÜt
(
ouÜt
);

184 
t_æ™
->
	`£t_time
(
m_rou‹r
->
	`curCyşe
(è+ 
	`Cyşes
(1));

186 
m_ouut_un™
[
ouÜt
]->
	`deüem’t_üed™
(
outvc
);

187 
m_rou‹r
->
	`upd©e_sw_wšÃr
(
špÜt
, 
t_æ™
);

188 
m_glob®_¬b™”_aùiv™y
++;

190 ià((
t_æ™
->
	`g‘_ty³
(è=ğ
TAIL_
) ||

191 
t_æ™
->
	`g‘_ty³
(è=ğ
HEAD_TAIL_
) {

195 
m_šput_un™
[
špÜt
]->
	`šüem’t_üed™
(
švc
, 
Œue
,

196 
m_rou‹r
->
	`curCyşe
());

199 
	`as£¹
(
m_šput_un™
[
špÜt
]->
	`isR—dy
(
švc
,

200 
m_rou‹r
->
	`curCyşe
()è=ğ
çl£
);

202 
m_šput_un™
[
špÜt
]->
	`£t_vc_¡©e
(
IDLE_
, 
švc
,

203 
m_rou‹r
->
	`curCyşe
());

204 
m_šput_un™
[
špÜt
]->
	`£t_’queue_time
(
švc
,

205 
	`Cyşes
(
INFINITE_
));

209 
m_šput_un™
[
špÜt
]->
	`šüem’t_üed™
(
švc
, 
çl£
,

210 
m_rou‹r
->
	`curCyşe
());

216 
	}
}

219 
	gSW®loÿtÜ_d
::
	$check_fÜ_wakeup
()

221 
i
 = 0; i < 
m_num_špÜts
; i++) {

222 
j
 = 0; j < 
m_num_vcs
; j++) {

223 ià(
m_šput_un™
[
i
]->
	`Ãed_¡age_Ãxtcyşe
(
j
, 
ACTIVE_
, 
SA_
,

224 
m_rou‹r
->
	`curCyşe
())) {

225 
	`scheduËEv’t
(
	`Cyşes
(1));

230 
	}
}

233 
	gSW®loÿtÜ_d
::
	$g‘_vÃt
(
švc
)

235 
vÃt
 = 
švc
/
m_vc_³r_vÃt
;

236 
	`as£¹
(
vÃt
 < 
m_rou‹r
->
	`g‘_num_vÃts
());

237  
vÃt
;

238 
	}
}

241 
	gSW®loÿtÜ_d
::
	$ş—r_»que¡_veùÜ
()

243 
i
 = 0; i < 
m_num_ouÜts
; i++) {

244 
j
 = 0; j < 
m_num_špÜts
; j++) {

245 
m_pÜt_»q
[
i
][
j
] = 
çl£
;

248 
	}
}

	@ruby/network/garnet/fixed-pipeline/SWallocator_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_SW_ALLOCATOR_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_SW_ALLOCATOR_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/CÚsum”.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

40 
şass
 
	gRou‹r_d
;

41 
şass
 
	gIÅutUn™_d
;

42 
şass
 
	gOuutUn™_d
;

44 şas 
	cSW®loÿtÜ_d
 : 
public
 
CÚsum”


46 
public
:

47 
SW®loÿtÜ_d
(
Rou‹r_d
 *
rou‹r
);

48 
wakeup
();

49 
š™
();

50 
ş—r_»que¡_veùÜ
();

51 
check_fÜ_wakeup
();

52 
g‘_vÃt
 (
švc
);

53 
´št
(
¡d
::
o¡»am
& 
out
) const {};

54 
¬b™¿‹_špÜts
();

55 
¬b™¿‹_ouÜts
();

56 
boŞ
 
is_ÿndid©e_špÜt
(
špÜt
, 
švc
);

58 
šlše
 

59 
	$g‘_loÿl_¬b™_couÁ
()

61  
m_loÿl_¬b™”_aùiv™y
;

62 
	}
}

63 
šlše
 

64 
	$g‘_glob®_¬b™_couÁ
()

66  
m_glob®_¬b™”_aùiv™y
;

67 
	}
}

69 
	g´iv©e
:

70 
m_num_špÜts
, 
	gm_num_ouÜts
;

71 
	gm_num_vcs
, 
	gm_vc_³r_vÃt
;

73 
	gm_loÿl_¬b™”_aùiv™y
, 
	gm_glob®_¬b™”_aùiv™y
;

75 
Rou‹r_d
 *
	gm_rou‹r
;

76 
	g¡d
::
veùÜ
<> 
m_round_robš_ouÜt
;

77 
	g¡d
::
veùÜ
<> 
m_round_robš_špÜt
;

78 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
boŞ
> > 
m_pÜt_»q
;

79 
	g¡d
::
veùÜ
<
¡d
::veùÜ<> > 
m_vc_wšÃrs
;

80 
	g¡d
::
veùÜ
<
IÅutUn™_d
 *> 
m_šput_un™
;

81 
	g¡d
::
veùÜ
<
OuutUn™_d
 *> 
m_ouut_un™
;

	@ruby/network/garnet/fixed-pipeline/Switch_d.cc

31 
	~"ba£/¡l_h–³rs.hh
"

32 
	~"debug/RubyN‘wÜk.hh
"

33 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/OuutUn™_d.hh
"

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Sw™ch_d.hh
"

37 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

39 
	gSw™ch_d
::
	$Sw™ch_d
(
Rou‹r_d
 *
rou‹r
)

40 : 
	$CÚsum”
(
rou‹r
)

42 
m_rou‹r
 = 
rou‹r
;

43 
m_num_vcs
 = 
m_rou‹r
->
	`g‘_num_vcs
();

44 
m_üossb¬_aùiv™y
 = 0;

45 
	}
}

47 
	gSw™ch_d
::~
	$Sw™ch_d
()

49 
	`d–‘ePoš‹rs
(
m_sw™ch_bufãr
);

50 
	}
}

53 
	gSw™ch_d
::
	$š™
()

55 
m_ouut_un™
 = 
m_rou‹r
->
	`g‘_ouutUn™_»f
();

57 
m_num_špÜts
 = 
m_rou‹r
->
	`g‘_num_špÜts
();

58 
m_sw™ch_bufãr
.
	`»size
(
m_num_špÜts
);

59 
i
 = 0; i < 
m_num_špÜts
; i++) {

60 
m_sw™ch_bufãr
[
i
] = 
Ãw
 
	`æ™Bufãr_d
();

62 
	}
}

65 
	gSw™ch_d
::
	$wakeup
()

67 
	`DPRINTF
(
RubyN‘wÜk
, "Switch woke up‡time: %lld\n",

68 
m_rou‹r
->
	`curCyşe
());

70 
špÜt
 = 0; iÅÜˆ< 
m_num_špÜts
; inport++) {

71 ià(!
m_sw™ch_bufãr
[
špÜt
]->
	`isR—dy
(
m_rou‹r
->
	`curCyşe
()))

73 
æ™_d
 *
t_æ™
 = 
m_sw™ch_bufãr
[
špÜt
]->
	`³ekTİFl™
();

74 ià(
t_æ™
->
	`is_¡age
(
ST_
, 
m_rou‹r
->
	`curCyşe
())) {

75 
ouÜt
 = 
t_æ™
->
	`g‘_ouÜt
();

76 
t_æ™
->
	`advªû_¡age
(
LT_
, 
m_rou‹r
->
	`curCyşe
());

77 
t_æ™
->
	`£t_time
(
m_rou‹r
->
	`curCyşe
(è+ 
	`Cyşes
(1));

80 
m_ouut_un™
[
ouÜt
]->
	`š£¹_æ™
(
t_æ™
);

81 
m_sw™ch_bufãr
[
špÜt
]->
	`g‘TİFl™
();

82 
m_üossb¬_aùiv™y
++;

85 
	`check_fÜ_wakeup
();

86 
	}
}

89 
	gSw™ch_d
::
	$check_fÜ_wakeup
()

91 
špÜt
 = 0; iÅÜˆ< 
m_num_špÜts
; inport++) {

92 ià(
m_sw™ch_bufãr
[
špÜt
]->
	`isR—dyFÜNext
(
m_rou‹r
->
	`curCyşe
())) {

93 
	`scheduËEv’t
(
	`Cyşes
(1));

97 
	}
}

99 
ušt32_t


100 
	gSw™ch_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

102 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

104 
ušt32_t
 
i
 = 0; i < 
m_sw™ch_bufãr
.
	`size
(); ++i) {

105 
num_funùiÚ®_wr™es
 +ğ
m_sw™ch_bufãr
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

108  
num_funùiÚ®_wr™es
;

109 
	}
}

	@ruby/network/garnet/fixed-pipeline/Switch_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_SWITCH_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_SWITCH_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/CÚsum”.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™Bufãr_d.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

41 
şass
 
	gRou‹r_d
;

42 
şass
 
	gOuutUn™_d
;

44 şas 
	cSw™ch_d
 : 
public
 
CÚsum”


46 
public
:

47 
Sw™ch_d
(
Rou‹r_d
 *
rou‹r
);

48 ~
Sw™ch_d
();

49 
wakeup
();

50 
š™
();

51 
check_fÜ_wakeup
();

52 
´št
(
¡d
::
o¡»am
& 
out
) const {};

54 
šlše
 
	$upd©e_sw_wšÃr
(
špÜt
, 
æ™_d
 *
t_æ™
)

55 { 
m_sw™ch_bufãr
[
špÜt
]->
	`š£¹
(
t_æ™
); 
	}
}

57 
šlše
 
	$g‘_üossb¬_couÁ
(è{  
m_üossb¬_aùiv™y
; 
	}
}

59 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

61 
	g´iv©e
:

62 
m_num_vcs
;

63 
	gm_num_špÜts
;

64 
	gm_üossb¬_aùiv™y
;

65 
Rou‹r_d
 *
	gm_rou‹r
;

66 
	g¡d
::
veùÜ
<
æ™Bufãr_d
 *> 
m_sw™ch_bufãr
;

67 
	g¡d
::
veùÜ
<
OuutUn™_d
 *> 
m_ouut_un™
;

	@ruby/network/garnet/fixed-pipeline/VCallocator_d.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtN‘wÜk_d.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/IÅutUn™_d.hh
"

33 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/OuutUn™_d.hh
"

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/VC®loÿtÜ_d.hh
"

37 
	gVC®loÿtÜ_d
::
	$VC®loÿtÜ_d
(
Rou‹r_d
 *
rou‹r
)

38 : 
	$CÚsum”
(
rou‹r
)

40 
m_rou‹r
 = 
rou‹r
;

41 
m_num_vcs
 = 
m_rou‹r
->
	`g‘_num_vcs
();

42 
m_vc_³r_vÃt
 = 
m_rou‹r
->
	`g‘_vc_³r_vÃt
();

44 
m_loÿl_¬b™”_aùiv™y
.
	`»size
(
m_num_vcs
/
m_vc_³r_vÃt
);

45 
m_glob®_¬b™”_aùiv™y
.
	`»size
(
m_num_vcs
/
m_vc_³r_vÃt
);

46 
i
 = 0; i < 
m_loÿl_¬b™”_aùiv™y
.
	`size
(); i++) {

47 
m_loÿl_¬b™”_aùiv™y
[
i
] = 0;

48 
m_glob®_¬b™”_aùiv™y
[
i
] = 0;

50 
	}
}

53 
	gVC®loÿtÜ_d
::
	$š™
()

55 
m_šput_un™
 = 
m_rou‹r
->
	`g‘_šputUn™_»f
();

56 
m_ouut_un™
 = 
m_rou‹r
->
	`g‘_ouutUn™_»f
();

58 
m_num_špÜts
 = 
m_rou‹r
->
	`g‘_num_špÜts
();

59 
m_num_ouÜts
 = 
m_rou‹r
->
	`g‘_num_ouÜts
();

60 
m_round_robš_švc
.
	`»size
(
m_num_špÜts
);

61 
m_round_robš_outvc
.
	`»size
(
m_num_ouÜts
);

62 
m_outvc_»q
.
	`»size
(
m_num_ouÜts
);

63 
m_outvc_is_»q
.
	`»size
(
m_num_ouÜts
);

65 
i
 = 0; i < 
m_num_špÜts
; i++) {

66 
m_round_robš_švc
[
i
].
	`»size
(
m_num_vcs
);

68 
j
 = 0; j < 
m_num_vcs
; j++) {

69 
m_round_robš_švc
[
i
][
j
] = 0;

73 
i
 = 0; i < 
m_num_ouÜts
; i++) {

74 
m_round_robš_outvc
[
i
].
	`»size
(
m_num_vcs
);

75 
m_outvc_»q
[
i
].
	`»size
(
m_num_vcs
);

76 
m_outvc_is_»q
[
i
].
	`»size
(
m_num_vcs
);

78 
j
 = 0; j < 
m_num_vcs
; j++) {

79 
m_round_robš_outvc
[
i
][
j
].
fœ¡
 = 0;

80 
m_round_robš_outvc
[
i
][
j
].
£cÚd
 = 0;

81 
m_outvc_is_»q
[
i
][
j
] = 
çl£
;

83 
m_outvc_»q
[
i
][
j
].
	`»size
(
m_num_špÜts
);

85 
k
 = 0; k < 
m_num_špÜts
; k++) {

86 
m_outvc_»q
[
i
][
j
][
k
].
	`»size
(
m_num_vcs
);

87 
l
 = 0;† < 
m_num_vcs
;†++) {

88 
m_outvc_»q
[
i
][
j
][
k
][
l
] = 
çl£
;

93 
	}
}

96 
	gVC®loÿtÜ_d
::
	$ş—r_»que¡_veùÜ
()

98 
i
 = 0; i < 
m_num_ouÜts
; i++) {

99 
j
 = 0; j < 
m_num_vcs
; j++) {

100 ià(!
m_outvc_is_»q
[
i
][
j
])

102 
m_outvc_is_»q
[
i
][
j
] = 
çl£
;

103 
k
 = 0; k < 
m_num_špÜts
; k++) {

104 
l
 = 0;† < 
m_num_vcs
;†++) {

105 
m_outvc_»q
[
i
][
j
][
k
][
l
] = 
çl£
;

110 
	}
}

113 
	gVC®loÿtÜ_d
::
	$wakeup
()

115 
	`¬b™¿‹_švcs
();

116 
	`¬b™¿‹_outvcs
();

118 
	`ş—r_»que¡_veùÜ
();

119 
	`check_fÜ_wakeup
();

120 
	}
}

122 
boŞ


123 
	gVC®loÿtÜ_d
::
	$is_švc_ÿndid©e
(
špÜt_™”
, 
švc_™”
)

125 
ouÜt
 = 
m_šput_un™
[
špÜt_™”
]->
	`g‘_rou‹
(
švc_™”
);

126 
vÃt
 = 
	`g‘_vÃt
(
švc_™”
);

127 
Cyşes
 
t_’queue_time
 =

128 
m_šput_un™
[
špÜt_™”
]->
	`g‘_’queue_time
(
švc_™”
);

130 
švc_ba£
 = 
vÃt
*
m_vc_³r_vÃt
;

132 ià((
m_rou‹r
->
	`g‘_Ãt_±r
())->
	`isVN‘Ord”ed
(
vÃt
)) {

133 
vc_off£t
 = 0; vc_off£ˆ< 
m_vc_³r_vÃt
; vc_offset++) {

134 
‹mp_vc
 = 
švc_ba£
 + 
vc_off£t
;

135 ià(
m_šput_un™
[
špÜt_™”
]->
	`Ãed_¡age
(
‹mp_vc
, 
VC_AB_
, 
VA_
,

136 
m_rou‹r
->
	`curCyşe
()) &&

137 (
m_šput_un™
[
špÜt_™”
]->
	`g‘_rou‹
(
‹mp_vc
è=ğ
ouÜt
) &&

138 (
m_šput_un™
[
špÜt_™”
]->
	`g‘_’queue_time
(
‹mp_vc
) <

139 
t_’queue_time
)) {

140  
çl£
;

144  
Œue
;

145 
	}
}

148 
	gVC®loÿtÜ_d
::
	$£Ëù_outvc
(
špÜt_™”
, 
švc_™”
)

150 
ouÜt
 = 
m_šput_un™
[
špÜt_™”
]->
	`g‘_rou‹
(
švc_™”
);

151 
vÃt
 = 
	`g‘_vÃt
(
švc_™”
);

152 
outvc_ba£
 = 
vÃt
*
m_vc_³r_vÃt
;

153 
num_vcs_³r_vÃt
 = 
m_vc_³r_vÃt
;

155 
outvc_off£t
 = 
m_round_robš_švc
[
špÜt_™”
][
švc_™”
];

156 
m_round_robš_švc
[
špÜt_™”
][
švc_™”
]++;

158 ià(
m_round_robš_švc
[
špÜt_™”
][
švc_™”
] >ğ
num_vcs_³r_vÃt
)

159 
m_round_robš_švc
[
špÜt_™”
][
švc_™”
] = 0;

161 
outvc_off£t_™”
 = 0; outvc_off£t_™” < 
num_vcs_³r_vÃt
;

162 
outvc_off£t_™”
++) {

163 
outvc_off£t
++;

164 ià(
outvc_off£t
 >ğ
num_vcs_³r_vÃt
)

165 
outvc_off£t
 = 0;

166 
outvc
 = 
outvc_ba£
 + 
outvc_off£t
;

167 ià(
m_ouut_un™
[
ouÜt
]->
	`is_vc_idË
(
outvc
, 
m_rou‹r
->
	`curCyşe
())) {

168 
m_loÿl_¬b™”_aùiv™y
[
vÃt
]++;

169 
m_outvc_»q
[
ouÜt
][
outvc
][
špÜt_™”
][
švc_™”
] = 
Œue
;

170 ià(!
m_outvc_is_»q
[
ouÜt
][
outvc
])

171 
m_outvc_is_»q
[
ouÜt
][
outvc
] = 
Œue
;

175 
	}
}

178 
	gVC®loÿtÜ_d
::
	$¬b™¿‹_švcs
()

180 
špÜt_™”
 = 0; iÅÜt_™” < 
m_num_špÜts
; inport_iter++) {

181 
švc_™”
 = 0; invc_™” < 
m_num_vcs
; invc_iter++) {

182 ià(!((
m_rou‹r
->
	`g‘_Ãt_±r
())->
	`v®idVœtu®N‘wÜk
(

183 
	`g‘_vÃt
(
švc_™”
))))

186 ià(
m_šput_un™
[
špÜt_™”
]->
	`Ãed_¡age
(
švc_™”
, 
VC_AB_
,

187 
VA_
, 
m_rou‹r
->
	`curCyşe
())) {

188 ià(!
	`is_švc_ÿndid©e
(
špÜt_™”
, 
švc_™”
))

191 
	`£Ëù_outvc
(
špÜt_™”
, 
švc_™”
);

195 
	}
}

198 
	gVC®loÿtÜ_d
::
	$¬b™¿‹_outvcs
()

200 
ouÜt_™”
 = 0; ouÜt_™” < 
m_num_ouÜts
; outport_iter++) {

201 
outvc_™”
 = 0; outvc_™” < 
m_num_vcs
; outvc_iter++) {

202 ià(!
m_outvc_is_»q
[
ouÜt_™”
][
outvc_™”
]) {

207 
špÜt
 = 
m_round_robš_outvc
[
ouÜt_™”
][
outvc_™”
].
fœ¡
;

208 
švc_off£t
 =

209 
m_round_robš_outvc
[
ouÜt_™”
][
outvc_™”
].
£cÚd
;

210 
vÃt
 = 
	`g‘_vÃt
(
outvc_™”
);

211 
švc_ba£
 = 
vÃt
*
m_vc_³r_vÃt
;

212 
num_vcs_³r_vÃt
 = 
m_vc_³r_vÃt
;

214 
m_round_robš_outvc
[
ouÜt_™”
][
outvc_™”
].
£cÚd
++;

215 ià(
m_round_robš_outvc
[
ouÜt_™”
][
outvc_™”
].
£cÚd
 >=

216 
num_vcs_³r_vÃt
) {

217 
m_round_robš_outvc
[
ouÜt_™”
][
outvc_™”
].
£cÚd
 = 0;

218 
m_round_robš_outvc
[
ouÜt_™”
][
outvc_™”
].
fœ¡
++;

219 ià(
m_round_robš_outvc
[
ouÜt_™”
][
outvc_™”
].
fœ¡
 >=

220 
m_num_špÜts
)

221 
m_round_robš_outvc
[
ouÜt_™”
][
outvc_™”
].
fœ¡
 = 0;

223 
š_™”
 = 0; in_™” < 
m_num_špÜts
*
num_vcs_³r_vÃt
;

224 
š_™”
++) {

225 
švc_off£t
++;

226 ià(
švc_off£t
 >ğ
num_vcs_³r_vÃt
) {

227 
švc_off£t
 = 0;

228 
špÜt
++;

229 ià(
špÜt
 >ğ
m_num_špÜts
)

230 
špÜt
 = 0;

232 
švc
 = 
švc_ba£
 + 
švc_off£t
;

233 ià(
m_outvc_»q
[
ouÜt_™”
][
outvc_™”
][
špÜt
][
švc
]) {

234 
m_glob®_¬b™”_aùiv™y
[
vÃt
]++;

235 
m_šput_un™
[
špÜt
]->
	`g¿Á_vc
(
švc
, 
outvc_™”
,

236 
m_rou‹r
->
	`curCyşe
());

237 
m_ouut_un™
[
ouÜt_™”
]->
	`upd©e_vc
(

238 
outvc_™”
, 
špÜt
, 
švc
);

239 
m_rou‹r
->
	`sw¬b_»q
();

245 
	}
}

248 
	gVC®loÿtÜ_d
::
	$g‘_vÃt
(
švc
)

250 
vÃt
 = 
švc
/
m_vc_³r_vÃt
;

251 
	`as£¹
(
vÃt
 < 
m_rou‹r
->
	`g‘_num_vÃts
());

253  
vÃt
;

254 
	}
}

257 
	gVC®loÿtÜ_d
::
	$check_fÜ_wakeup
()

259 
i
 = 0; i < 
m_num_špÜts
; i++) {

260 
j
 = 0; j < 
m_num_vcs
; j++) {

261 ià(
m_šput_un™
[
i
]->
	`Ãed_¡age_Ãxtcyşe
(
j
, 
VC_AB_
, 
VA_
,

262 
m_rou‹r
->
	`curCyşe
())) {

263 
	`scheduËEv’t
(
	`Cyşes
(1));

268 
	}
}

	@ruby/network/garnet/fixed-pipeline/VCallocator_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_VC_ALLOCATOR_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_VC_ALLOCATOR_D_HH__


	)

34 
	~<io¡»am
>

35 
	~<ut™y
>

36 
	~<veùÜ
>

38 
	~"mem/ruby/commÚ/CÚsum”.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

41 
şass
 
	gRou‹r_d
;

42 
şass
 
	gIÅutUn™_d
;

43 
şass
 
	gOuutUn™_d
;

45 şas 
	cVC®loÿtÜ_d
 : 
public
 
CÚsum”


47 
public
:

48 
VC®loÿtÜ_d
(
Rou‹r_d
 *
rou‹r
);

49 
š™
();

50 
wakeup
();

51 
check_fÜ_wakeup
();

52 
ş—r_»que¡_veùÜ
();

53 
g‘_vÃt
(
švc
);

54 
´št
(
¡d
::
o¡»am
& 
out
) const {}

55 
¬b™¿‹_švcs
();

56 
¬b™¿‹_outvcs
();

57 
boŞ
 
is_švc_ÿndid©e
(
špÜt_™”
, 
švc_™”
);

58 
£Ëù_outvc
(
špÜt_™”
, 
švc_™”
);

60 
	$g‘_loÿl_¬b™_couÁ
(
vÃt
) const

61 {  
m_loÿl_¬b™”_aùiv™y
[
vÃt
]; 
	}
}

63 
	$g‘_glob®_¬b™_couÁ
(
vÃt
) const

64 {  
m_glob®_¬b™”_aùiv™y
[
vÃt
]; 
	}
}

66 
	g´iv©e
:

67 
m_num_vcs
, 
	gm_vc_³r_vÃt
;

68 
	gm_num_špÜts
;

69 
	gm_num_ouÜts
;

71 
Rou‹r_d
 *
	gm_rou‹r
;

75 
	g¡d
::
veùÜ
<
¡d
::veùÜ<> > 
m_round_robš_švc
;

78 
	g¡d
::
veùÜ
<
¡d
::veùÜ<¡d::
·œ
<, > > > 
	gm_round_robš_outvc
;

82 
	g¡d
::
veùÜ
<
¡d
::veùÜ<¡d::veùÜ<¡d::veùÜ<
boŞ
> > > > 
m_outvc_»q
;

84 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
boŞ
> > 
m_outvc_is_»q
;

86 
	g¡d
::
veùÜ
<
IÅutUn™_d
 *> 
m_šput_un™
;

87 
	g¡d
::
veùÜ
<
OuutUn™_d
 *> 
m_ouut_un™
;

90 
	g¡d
::
veùÜ
<> 
m_loÿl_¬b™”_aùiv™y
;

91 
	g¡d
::
veùÜ
<> 
m_glob®_¬b™”_aùiv™y
;

	@ruby/network/garnet/fixed-pipeline/VirtualChannel_d.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Vœtu®ChªÃl_d.hh
"

33 
	gVœtu®ChªÃl_d
::
	$Vœtu®ChªÃl_d
(
id
)

34 : 
	$m_’queue_time
(
INFINITE_
)

36 
m_id
 = 
id
;

37 
m_šput_bufãr
 = 
Ãw
 
	`æ™Bufãr_d
();

38 
m_vc_¡©e
.
fœ¡
 = 
IDLE_
;

39 
m_vc_¡©e
.
£cÚd
 = 
	`Cyşes
(0);

40 
	}
}

42 
	gVœtu®ChªÃl_d
::~
	$Vœtu®ChªÃl_d
()

44 
d–‘e
 
m_šput_bufãr
;

45 
	}
}

48 
	gVœtu®ChªÃl_d
::
	$£t_ouÜt
(
ouÜt
)

50 
rou‹
 = 
ouÜt
;

51 
	}
}

54 
	gVœtu®ChªÃl_d
::
	$g¿Á_vc
(
out_vc
, 
Cyşes
 
curTime
)

56 
m_ouut_vc
 = 
out_vc
;

57 
m_vc_¡©e
.
fœ¡
 = 
ACTIVE_
;

58 
m_vc_¡©e
.
£cÚd
 = 
curTime
 + 
	`Cyşes
(1);

59 
æ™_d
 *
t_æ™
 = 
m_šput_bufãr
->
	`³ekTİFl™
();

60 
t_æ™
->
	`advªû_¡age
(
SA_
, 
curTime
);

61 
	}
}

63 
boŞ


64 
	gVœtu®ChªÃl_d
::
	$Ãed_¡age
(
VC_¡©e_ty³
 
¡©e
, 
æ™_¡age
 
¡age
,

65 
Cyşes
 
curTime
)

67 ià((
m_vc_¡©e
.
fœ¡
 =ğ
¡©e
è&& (
curTime
 >ğm_vc_¡©e.
£cÚd
)) {

68 ià(
m_šput_bufãr
->
	`isR—dy
(
curTime
)) {

69 
æ™_d
 *
t_æ™
 = 
m_šput_bufãr
->
	`³ekTİFl™
();

70 (
t_æ™
->
	`is_¡age
(
¡age
, 
curTime
)) ;

73  
çl£
;

74 
	}
}

76 
boŞ


77 
	gVœtu®ChªÃl_d
::
	$Ãed_¡age_Ãxtcyşe
(
VC_¡©e_ty³
 
¡©e
, 
æ™_¡age
 
¡age
,

78 
Cyşes
 
curTime
)

80 ià((
m_vc_¡©e
.
fœ¡
 =ğ
¡©e
è&& ((
curTime
 + 1è>ğm_vc_¡©e.
£cÚd
)) {

81 ià(
m_šput_bufãr
->
	`isR—dyFÜNext
(
curTime
)) {

82 
æ™_d
 *
t_æ™
 = 
m_šput_bufãr
->
	`³ekTİFl™
();

83 (
t_æ™
->
	`is_Ãxt_¡age
(
¡age
, 
curTime
)) ;

86  
çl£
;

87 
	}
}

89 
ušt32_t


90 
	gVœtu®ChªÃl_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

92  
m_šput_bufãr
->
	`funùiÚ®Wr™e
(
pkt
);

93 
	}
}

	@ruby/network/garnet/fixed-pipeline/VirtualChannel_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_VIRTUAL_CHANNEL_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_VIRTUAL_CHANNEL_D_HH__


	)

34 
	~<ut™y
>

36 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™Bufãr_d.hh
"

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

39 şas 
	cVœtu®ChªÃl_d


41 
	mpublic
:

42 
Vœtu®ChªÃl_d
(
id
);

43 ~
Vœtu®ChªÃl_d
();

45 
boŞ
 
Ãed_¡age
(
VC_¡©e_ty³
 
¡©e
, 
æ™_¡age
 
¡age
, 
Cyşes
 
curTime
);

46 
boŞ
 
Ãed_¡age_Ãxtcyşe
(
VC_¡©e_ty³
 
¡©e
, 
æ™_¡age
 
¡age
,

47 
Cyşes
 
curTime
);

48 
£t_ouÜt
(
ouÜt
);

49 
g¿Á_vc
(
out_vc
, 
Cyşes
 
curTime
);

51 
šlše
 
Cyşes
 
	$g‘_’queue_time
(è{  
m_’queue_time
; }

52 
šlše
 
	$£t_’queue_time
(
Cyşes
 
time
è{ 
m_’queue_time
 =ime; 
	}
}

53 
šlše
 
VC_¡©e_ty³
 
	$g‘_¡©e
(è{  
m_vc_¡©e
.
fœ¡
; 
	}
}

54 
šlše
 
	$g‘_outvc
(è{  
m_ouut_vc
; 
	}
}

55 
šlše
 
boŞ
 
	$has_üed™s
(è{  (
m_üed™_couÁ
 > 0); 
	}
}

56 
šlše
 
	$g‘_rou‹
(è{  
rou‹
; 
	}
}

57 
šlše
 
	$upd©e_üed™
(
üed™
è{ 
m_üed™_couÁ
 = c»d™; 
	}
}

58 
šlše
 
	$šüem’t_üed™
(è{ 
m_üed™_couÁ
++; 
	}
}

60 
šlše
 
boŞ
 
	$isR—dy
(
Cyşes
 
curTime
)

62  
m_šput_bufãr
->
	`isR—dy
(
curTime
);

63 
	}
}

65 
šlše
 

66 
	$š£¹Fl™
(
æ™_d
 *
t_æ™
)

68 
m_šput_bufãr
->
	`š£¹
(
t_æ™
);

69 
	}
}

71 
šlše
 

72 
	$£t_¡©e
(
VC_¡©e_ty³
 
m_¡©e
, 
Cyşes
 
curTime
)

74 
m_vc_¡©e
.
fœ¡
 = 
m_¡©e
;

75 
m_vc_¡©e
.
£cÚd
 = 
curTime
 + 
	`Cyşes
(1);

76 
	}
}

78 
šlše
 
æ™_d
*

79 
	$³ekTİFl™
()

81  
m_šput_bufãr
->
	`³ekTİFl™
();

82 
	}
}

84 
šlše
 
æ™_d
*

85 
	$g‘TİFl™
()

87  
m_šput_bufãr
->
	`g‘TİFl™
();

88 
	}
}

90 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

92 
	g´iv©e
:

93 
m_id
;

94 
æ™Bufãr_d
 *
	gm_šput_bufãr
;

95 
	g¡d
::
·œ
<
VC_¡©e_ty³
, 
	gCyşes
> 
	gm_vc_¡©e
;

96 
	grou‹
;

97 
Cyşes
 
	gm_’queue_time
;

98 
	gm_ouut_vc
;

99 
	gm_üed™_couÁ
;

	@ruby/network/garnet/fixed-pipeline/flitBuffer_d.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™Bufãr_d.hh
"

33 
	gæ™Bufãr_d
::
	$æ™Bufãr_d
()

35 
max_size
 = 
INFINITE_
;

36 
	}
}

38 
	gæ™Bufãr_d
::
	$æ™Bufãr_d
(
maximum_size
)

40 
max_size
 = 
maximum_size
;

41 
	}
}

43 
boŞ


44 
	gæ™Bufãr_d
::
	$isEm±y
()

46  (
m_bufãr
.
	`size
() == 0);

47 
	}
}

49 
boŞ


50 
	gæ™Bufãr_d
::
	$isR—dy
(
Cyşes
 
curTime
)

52 ià(
m_bufãr
.
	`size
() != 0 ) {

53 
æ™_d
 *
t_æ™
 = 
	`³ekTİFl™
();

54 ià(
t_æ™
->
	`g‘_time
(è<ğ
curTime
)

55  
Œue
;

57  
çl£
;

58 
	}
}

60 
boŞ


61 
	gæ™Bufãr_d
::
	$isR—dyFÜNext
(
Cyşes
 
curTime
)

63 ià(
m_bufãr
.
	`size
() != 0 ) {

64 
æ™_d
 *
t_æ™
 = 
	`³ekTİFl™
();

65 ià(
t_æ™
->
	`g‘_time
(è<ğ(
curTime
 + 1))

66  
Œue
;

68  
çl£
;

69 
	}
}

72 
	gæ™Bufãr_d
::
´št
(
¡d
::
o¡»am
& 
out
) const

74 
out
 << "[æ™Bufãr: " << 
m_bufãr
.
size
(è<< "] " << 
¡d
::
’dl
;

77 
boŞ


78 
	gæ™Bufãr_d
::
	$isFuÎ
()

80  (
m_bufãr
.
	`size
(è>ğ
max_size
);

81 
	}
}

84 
	gæ™Bufãr_d
::
	$£tMaxSize
(
maximum
)

86 
max_size
 = 
maximum
;

87 
	}
}

89 
ušt32_t


90 
	gæ™Bufãr_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

92 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

94 
i
 = 0; i < 
m_bufãr
.
	`size
(); ++i) {

95 ià(
m_bufãr
[
i
]->
	`funùiÚ®Wr™e
(
pkt
)) {

96 
num_funùiÚ®_wr™es
++;

100  
num_funùiÚ®_wr™es
;

101 
	}
}

	@ruby/network/garnet/fixed-pipeline/flitBuffer_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_FLIT_BUFFER_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_FLIT_BUFFER_D_HH__


	)

34 
	~<®gÜ™hm
>

35 
	~<io¡»am
>

36 
	~<veùÜ
>

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™_d.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

41 şas 
	cæ™Bufãr_d


43 
	mpublic
:

44 
æ™Bufãr_d
();

45 
æ™Bufãr_d
(
maximum_size
);

47 
boŞ
 
isR—dy
(
Cyşes
 
curTime
);

48 
boŞ
 
isR—dyFÜNext
(
Cyşes
 
curTime
);

49 
boŞ
 
isEm±y
();

50 
´št
(
¡d
::
o¡»am
& 
out
) const;

51 
boŞ
 
isFuÎ
();

52 
£tMaxSize
(
maximum
);

54 
æ™_d
 *

55 
	$g‘TİFl™
()

57 
æ™_d
 *
f
 = 
m_bufãr
.
	`äÚt
();

58 
¡d
::
	`pİ_h—p
(
m_bufãr
.
	`begš
(), m_bufãr.
	`’d
(), 
æ™_d
::
g»©”
);

59 
m_bufãr
.
	`pİ_back
();

60  
f
;

63 
æ™_d
 *

64 
	$³ekTİFl™
()

66  
m_bufãr
.
	`äÚt
();

67 
	}
}

70 
	$š£¹
(
æ™_d
 *
æt
)

72 
m_bufãr
.
	`push_back
(
æt
);

73 
¡d
::
	`push_h—p
(
m_bufãr
.
	`begš
(), m_bufãr.
	`’d
(), 
æ™_d
::
g»©”
);

74 
	}
}

76 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

78 
	g´iv©e
:

79 
¡d
::
veùÜ
<
æ™_d
 *> 
m_bufãr
;

80 
	gmax_size
;

83 
šlše
 
	g¡d
::
o¡»am
&

84 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gæ™Bufãr_d
& 
	gobj
)

86 
	gobj
.
´št
(
out
);

87 
	gout
 << 
	g¡d
::
æush
;

88  
	gout
;

	@ruby/network/garnet/fixed-pipeline/flit_d.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/æ™_d.hh
"

33 
	gæ™_d
::
	$æ™_d
(
id
, 
vc
, 
vÃt
, 
size
, 
MsgPŒ
 
msg_±r
,

34 
Cyşes
 
curTime
)

36 
m_size
 = 
size
;

37 
m_msg_±r
 = 
msg_±r
;

38 
m_’queue_time
 = 
curTime
;

39 
m_time
 = 
curTime
;

40 
m_id
 = 
id
;

41 
m_vÃt
 = 
vÃt
;

42 
m_vc
 = 
vc
;

43 
m_¡age
.
fœ¡
 = 
I_
;

44 
m_¡age
.
£cÚd
 = 
m_time
;

46 ià(
size
 == 1) {

47 
m_ty³
 = 
HEAD_TAIL_
;

50 ià(
id
 == 0)

51 
m_ty³
 = 
HEAD_
;

52 ià(
id
 =ğ(
size
 - 1))

53 
m_ty³
 = 
TAIL_
;

55 
m_ty³
 = 
BODY_
;

56 
	}
}

58 
	gæ™_d
::
	$æ™_d
(
vc
, 
boŞ
 
is_ä“_sigÇl
, 
Cyşes
 
curTime
)

60 
m_id
 = 0;

61 
m_vc
 = 
vc
;

62 
m_is_ä“_sigÇl
 = 
is_ä“_sigÇl
;

63 
m_time
 = 
curTime
;

64 
	}
}

67 
	gæ™_d
::
´št
(
¡d
::
o¡»am
& 
out
) const

69 
out
 << "[flit:: ";

70 
	gout
 << "Id=" << 
	gm_id
 << " ";

71 
	gout
 << "Ty³=" << 
	gm_ty³
 << " ";

72 
	gout
 << "VÃt=" << 
	gm_vÃt
 << " ";

73 
	gout
 << "VC=" << 
	gm_vc
 << " ";

74 
	gout
 << "EnqueuTime=" << 
	gm_’queue_time
 << " ";

75 
	gout
 << "]";

78 
boŞ


79 
	gæ™_d
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

81 
Mes§ge
 *
msg
 = 
m_msg_±r
.
	`g‘
();

82  
msg
->
	`funùiÚ®Wr™e
(
pkt
);

83 
	}
}

	@ruby/network/garnet/fixed-pipeline/flit_d.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_FLIT_D_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FIXED_PIPELINE_FLIT_D_HH__


	)

34 
	~<ÿs£¹
>

35 
	~<io¡»am
>

37 
	~"ba£/ty³s.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

39 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

41 şas 
	cæ™_d


43 
	mpublic
:

44 
æ™_d
(
id
, 
vc
, 
vÃt
, 
size
, 
MsgPŒ
 
msg_±r
, 
Cyşes
 
curTime
);

45 
æ™_d
(
vc
, 
boŞ
 
is_ä“_sigÇl
, 
Cyşes
 
curTime
);

46 
	$£t_ouÜt
(
pÜt
è{ 
m_ouÜt
 =…ort; }

47 
	$g‘_ouÜt
(è{ 
m_ouÜt
; 
	}
}

48 
´št
(
¡d
::
o¡»am
& 
out
) const;

49 
boŞ
 
	$is_ä“_sigÇl
(è{  
m_is_ä“_sigÇl
; 
	}
}

50 
	$g‘_size
(è{  
m_size
; 
	}
}

51 
Cyşes
 
	$g‘_’queue_time
(è{  
m_’queue_time
; 
	}
}

52 
	$g‘_id
(è{  
m_id
; 
	}
}

53 
Cyşes
 
	$g‘_time
(è{  
m_time
; 
	}
}

54 
	$£t_time
(
Cyşes
 
time
è{ 
m_time
 =ime; 
	}
}

55 
	$g‘_vÃt
(è{  
m_vÃt
; 
	}
}

56 
	$g‘_vc
(è{  
m_vc
; 
	}
}

57 
	$£t_vc
(
vc
è{ 
m_vc
 = vc; 
	}
}

58 
	gMsgPŒ
& 
	$g‘_msg_±r
(è{  
m_msg_±r
; 
	}
}

59 
æ™_ty³
 
	$g‘_ty³
(è{  
m_ty³
; 
	}
}

61 
boŞ


62 
	$is_¡age
(
æ™_¡age
 
t_¡age
, 
Cyşes
 
curTime
)

64  (
m_¡age
.
fœ¡
 =ğ
t_¡age
 &&

65 
curTime
 >ğ
m_¡age
.
£cÚd
);

66 
	}
}

68 
boŞ


69 
	$is_Ãxt_¡age
(
æ™_¡age
 
t_¡age
, 
Cyşes
 
curTime
)

71  (
m_¡age
.
fœ¡
 =ğ
t_¡age
 &&

72 (
curTime
 + 1è>ğ
m_¡age
.
£cÚd
);

73 
	}
}

76 
	$advªû_¡age
(
æ™_¡age
 
t_¡age
, 
Cyşes
 
curTime
)

78 
m_¡age
.
fœ¡
 = 
t_¡age
;

79 
m_¡age
.
£cÚd
 = 
curTime
 + 
	`Cyşes
(1);

80 
	}
}

82 
	g¡d
::
·œ
<
æ™_¡age
, 
	gCyşes
> 
	$g‘_¡age
(è{  
m_¡age
; 
	}
}

84 
	$£t_d–ay
(
Cyşes
 
d–ay
è{ 
¤c_d–ay
 = d–ay; 
	}
}

85 
Cyşes
 
	$g‘_d–ay
(è{  
¤c_d–ay
; 
	}
}

87 
boŞ


88 
	$g»©”
(
æ™_d
* 
n1
, fl™_d* 
n2
)

90 ià(
n1
->
	`g‘_time
(è=ğ
n2
->get_time()) {

92  (
n1
->
	`g‘_id
(è> 
n2
->get_id());

94  (
n1
->
	`g‘_time
(è> 
n2
->get_time());

96 
	}
}

98 
boŞ
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

100 
	g´iv©e
:

101 
m_id
;

102 
	gm_vÃt
;

103 
	gm_vc
;

104 
	gm_size
;

105 
boŞ
 
	gm_is_ä“_sigÇl
;

106 
Cyşes
 
	gm_’queue_time
, 
	gm_time
;

107 
æ™_ty³
 
	gm_ty³
;

108 
MsgPŒ
 
	gm_msg_±r
;

109 
	gm_ouÜt
;

110 
Cyşes
 
	g¤c_d–ay
;

111 
	g¡d
::
·œ
<
æ™_¡age
, 
	gCyşes
> 
	gm_¡age
;

114 
šlše
 
	g¡d
::
o¡»am
&

115 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gæ™_d
& 
	gobj
)

117 
	gobj
.
´št
(
out
);

118 
	gout
 << 
	g¡d
::
æush
;

119  
	gout
;

	@ruby/network/garnet/flexible-pipeline/FlexibleConsumer.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_FLEXIBLE_CONSUMER_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_FLEXIBLE_CONSUMER_HH__


	)

34 
	~"mem/ruby/commÚ/CÚsum”.hh
"

35 
	~"mem/ruby/commÚ/N‘De¡.hh
"

36 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

38 şas 
	cFËxibËCÚsum”
 : 
public
 
CÚsum”


40 
public
:

41 
	$FËxibËCÚsum”
(
ClockedObjeù
 *
em
è: 
	$CÚsum”
(
em
) {}

42 
vœtu®
 
boŞ
 
	$isBufãrNÙFuÎ
(
vc
, 
špÜt
è{  
Œue
; 
	}
}

43 
vœtu®
 
	$g¿Á_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
g¿Á_time
è{
	}
}

44 
vœtu®
 
	$»Ëa£_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
»Ëa£_time
è{
	}
}

45 
vœtu®
 
	$»que¡_vc
(
vc
, 
š_pÜt
, 
N‘De¡
 
de¡š©iÚ
,

46 
Cyşes
 
»que¡_time
è{
	}
}

	@ruby/network/garnet/flexible-pipeline/GarnetLink.cc

29 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/G¬ÃtLšk.hh
"

30 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/N‘wÜkLšk.hh
"

32 
	gG¬ÃtIÁLšk
::
	$G¬ÃtIÁLšk
(cÚ¡ 
P¬ams
 *
p
)

33 : 
	$BasicLšk
(
p
)

35 
m_ÃtwÜk_lšks
[0] = 
p
->
ÃtwÜk_lšks
[0];

36 
m_ÃtwÜk_lšks
[1] = 
p
->
ÃtwÜk_lšks
[1];

37 
	}
}

40 
	gG¬ÃtIÁLšk
::
	$š™
()

42 
	}
}

45 
G¬ÃtIÁLšk
::
´št
(
¡d
::
o¡»am
& 
out
) const

47 
out
 << 
Çme
();

50 
G¬ÃtIÁLšk
 *

51 
	gG¬ÃtIÁLškP¬ams
::
	$ü—‹
()

53  
Ãw
 
	`G¬ÃtIÁLšk
(
this
);

54 
	}
}

56 
	gG¬ÃtExtLšk
::
	$G¬ÃtExtLšk
(cÚ¡ 
P¬ams
 *
p
)

57 : 
	$BasicLšk
(
p
)

59 
m_ÃtwÜk_lšks
[0] = 
p
->
ÃtwÜk_lšks
[0];

60 
m_ÃtwÜk_lšks
[1] = 
p
->
ÃtwÜk_lšks
[1];

61 
	}
}

64 
	gG¬ÃtExtLšk
::
	$š™
()

66 
	}
}

69 
G¬ÃtExtLšk
::
´št
(
¡d
::
o¡»am
& 
out
) const

71 
out
 << 
Çme
();

74 
G¬ÃtExtLšk
 *

75 
	gG¬ÃtExtLškP¬ams
::
	$ü—‹
()

77  
Ãw
 
	`G¬ÃtExtLšk
(
this
);

78 
	}
}

	@ruby/network/garnet/flexible-pipeline/GarnetLink.hh

29 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_LINK_HH__


30 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_LINK_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/N‘wÜkLšk.hh
"

38 
	~"·¿ms/G¬ÃtIÁLšk.hh
"

39 
	~"·¿ms/G¬ÃtExtLšk.hh
"

41 şas 
	cG¬ÃtIÁLšk
 : 
public
 
BasicLšk


43 
public
:

44 
G¬ÃtIÁLškP¬ams
 
	tP¬ams
;

45 
G¬ÃtIÁLšk
(cÚ¡ 
P¬ams
 *
p
);

47 
š™
();

49 
´št
(
¡d
::
o¡»am
& 
out
) const;

51 
ä›nd
 
şass
 
	mG¬ÃtN‘wÜk
;

53 
	m´Ùeùed
:

54 
N‘wÜkLšk
* 
m_ÃtwÜk_lšks
[2];

57 
šlše
 
	g¡d
::
o¡»am
&

58 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gG¬ÃtIÁLšk
& 
	gobj
)

60 
	gobj
.
´št
(
out
);

61 
	gout
 << 
	g¡d
::
æush
;

62  
	gout
;

65 şas 
	cG¬ÃtExtLšk
 : 
public
 
BasicLšk


67 
public
:

68 
G¬ÃtExtLškP¬ams
 
	tP¬ams
;

69 
G¬ÃtExtLšk
(cÚ¡ 
P¬ams
 *
p
);

71 
š™
();

73 
´št
(
¡d
::
o¡»am
& 
out
) const;

75 
ä›nd
 
şass
 
	mG¬ÃtN‘wÜk
;

77 
	m´Ùeùed
:

78 
N‘wÜkLšk
* 
m_ÃtwÜk_lšks
[2];

81 
šlše
 
	g¡d
::
o¡»am
&

82 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gG¬ÃtExtLšk
& 
	gobj
)

84 
	gobj
.
´št
(
out
);

85 
	gout
 << 
	g¡d
::
æush
;

86  
	gout
;

	@ruby/network/garnet/flexible-pipeline/GarnetNetwork.cc

31 
	~<ÿs£¹
>

33 
	~"ba£/ÿ¡.hh
"

34 
	~"ba£/¡l_h–³rs.hh
"

35 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

36 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

37 
	~"mem/ruby/commÚ/N‘De¡.hh
"

38 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/G¬ÃtLšk.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/G¬ÃtN‘wÜk.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/N‘wÜkIÁ”çû.hh
"

42 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/N‘wÜkLšk.hh
"

43 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/Rou‹r.hh
"

44 
	~"mem/ruby/ÃtwÜk/TİŞogy.hh
"

46 
usšg
 
Çme¥aû
 
	g¡d
;

47 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

49 
	gG¬ÃtN‘wÜk
::
	$G¬ÃtN‘wÜk
(cÚ¡ 
P¬ams
 *
p
)

50 : 
	$Ba£G¬ÃtN‘wÜk
(
p
)

52 
m_bufãr_size
 = 
p
->
bufãr_size
;

53 
m_numb”_of_pe_¡ages
 = 
p
->
numb”_of_pe_¡ages
;

56 
veùÜ
<
BasicRou‹r
*>::
cÚ¡_™”©Ü
 
i
 = 
p
->
rou‹rs
.
	`begš
();

57 
i
 !ğ
p
->
rou‹rs
.
	`’d
(); ++i) {

58 
Rou‹r
* 
rou‹r
 = 
§ã_ÿ¡
<Rou‹r*>(*
i
);

59 
m_rou‹rs
.
	`push_back
(
rou‹r
);

61 
	}
}

64 
	gG¬ÃtN‘wÜk
::
	$š™
()

66 
Ba£G¬ÃtN‘wÜk
::
	`š™
();

69 
	`as£¹
 (
m_tİŞogy_±r
!=
NULL
);

72 
veùÜ
<
Rou‹r
*>::
cÚ¡_™”©Ü
 
i
 = 
m_rou‹rs
.
	`begš
();

73 
i
 !ğ
m_rou‹rs
.
	`’d
(); ++i) {

74 
Rou‹r
* 
rou‹r
 = 
§ã_ÿ¡
<Rou‹r*>(*
i
);

75 
rou‹r
->
	`š™_Ãt_±r
(
this
);

78 
i
=0; i < 
m_nodes
; i++) {

79 
N‘wÜkIÁ”çû
 *
ni
 = 
Ãw
 
	`N‘wÜkIÁ”çû
(
i
, 
m_vœtu®_ÃtwÜks
,

80 
this
);

81 
ni
->
	`addNode
(
m_toN‘Queues
[
i
], 
m_äomN‘Queues
[i]);

82 
m_nis
.
	`push_back
(
ni
);

85 
m_tİŞogy_±r
->
	`ü—‹Lšks
(
this
);

86 
	}
}

88 
	gG¬ÃtN‘wÜk
::~
	$G¬ÃtN‘wÜk
()

90 
i
 = 0; i < 
m_nodes
; i++) {

91 
	`d–‘ePoš‹rs
(
m_toN‘Queues
[
i
]);

92 
	`d–‘ePoš‹rs
(
m_äomN‘Queues
[
i
]);

94 
	`d–‘ePoš‹rs
(
m_rou‹rs
);

95 
	`d–‘ePoš‹rs
(
m_nis
);

96 
	`d–‘ePoš‹rs
(
m_lšks
);

97 
d–‘e
 
m_tİŞogy_±r
;

98 
	}
}

101 
	gG¬ÃtN‘wÜk
::
	$makeInLšk
(
NodeID
 
¤c
, 
Sw™chID
 
de¡
, 
BasicLšk
* 
lšk
,

102 
LškDœeùiÚ
 
dœeùiÚ
,

103 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

105 
	`as£¹
(
¤c
 < 
m_nodes
);

107 
G¬ÃtExtLšk
* 
g¬Ãt_lšk
 = 
§ã_ÿ¡
<G¬ÃtExtLšk*>(
lšk
);

108 
N‘wÜkLšk
 *
Ãt_lšk
 = 
g¬Ãt_lšk
->
m_ÃtwÜk_lšks
[
dœeùiÚ
];

110 
Ãt_lšk
->
	`š™_Ãt_±r
(
this
);

111 
m_lšks
.
	`push_back
(
Ãt_lšk
);

112 
m_rou‹rs
[
de¡
]->
	`addInPÜt
(
Ãt_lšk
);

113 
m_nis
[
¤c
]->
	`addOutPÜt
(
Ãt_lšk
);

114 
	}
}

117 
	gG¬ÃtN‘wÜk
::
	$makeOutLšk
(
Sw™chID
 
¤c
, 
NodeID
 
de¡
, 
BasicLšk
* 
lšk
,

118 
LškDœeùiÚ
 
dœeùiÚ
,

119 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

121 
	`as£¹
(
de¡
 < 
m_nodes
);

122 
	`as£¹
(
¤c
 < 
m_rou‹rs
.
	`size
());

123 
	`as£¹
(
m_rou‹rs
[
¤c
] !ğ
NULL
);

125 
G¬ÃtExtLšk
* 
g¬Ãt_lšk
 = 
§ã_ÿ¡
<G¬ÃtExtLšk*>(
lšk
);

126 
N‘wÜkLšk
 *
Ãt_lšk
 = 
g¬Ãt_lšk
->
m_ÃtwÜk_lšks
[
dœeùiÚ
];

128 
Ãt_lšk
->
	`š™_Ãt_±r
(
this
);

129 
m_lšks
.
	`push_back
(
Ãt_lšk
);

130 
m_rou‹rs
[
¤c
]->
	`addOutPÜt
(
Ãt_lšk
, 
routšg_bË_’Œy
,

131 
lšk
->
m_weight
);

132 
m_nis
[
de¡
]->
	`addInPÜt
(
Ãt_lšk
);

133 
	}
}

136 
	gG¬ÃtN‘wÜk
::
	$makeIÁ”ÇlLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

137 
LškDœeùiÚ
 
dœeùiÚ
,

138 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

140 
G¬ÃtIÁLšk
* 
g¬Ãt_lšk
 = 
§ã_ÿ¡
<G¬ÃtIÁLšk*>(
lšk
);

141 
N‘wÜkLšk
 *
Ãt_lšk
 = 
g¬Ãt_lšk
->
m_ÃtwÜk_lšks
[
dœeùiÚ
];

143 
Ãt_lšk
->
	`š™_Ãt_±r
(
this
);

144 
m_lšks
.
	`push_back
(
Ãt_lšk
);

145 
m_rou‹rs
[
de¡
]->
	`addInPÜt
(
Ãt_lšk
);

146 
m_rou‹rs
[
¤c
]->
	`addOutPÜt
(
Ãt_lšk
, 
routšg_bË_’Œy
,

147 
lšk
->
m_weight
);

149 
	}
}

152 
	gG¬ÃtN‘wÜk
::
checkN‘wÜkAÎoÿtiÚ
(
NodeID
 
id
, 
boŞ
 
Üd”ed
,

153 
ÃtwÜk_num
, 
¡d
::
¡ršg
 
vÃt_ty³
)

155 
as£¹
(
id
 < 
m_nodes
);

156 
as£¹
(
ÃtwÜk_num
 < 
m_vœtu®_ÃtwÜks
);

158 ià(
	gÜd”ed
) {

159 
	gm_Üd”ed
[
ÃtwÜk_num
] = 
Œue
;

161 
	gm_š_u£
[
ÃtwÜk_num
] = 
Œue
;

168 
boŞ


169 
	gG¬ÃtN‘wÜk
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

171 
i
 = 0; i < 
m_rou‹rs
.
	`size
(); i++) {

172 ià(
m_rou‹rs
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

173  
Œue
;

177 
i
 = 0; i < 
m_nis
.
	`size
(); ++i) {

178 ià(
m_nis
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

179  
Œue
;

183 
i
 = 0; i < 
m_lšks
.
	`size
(); ++i) {

184 ià(
m_lšks
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

185  
Œue
;

189  
çl£
;

190 
	}
}

192 
ušt32_t


193 
	gG¬ÃtN‘wÜk
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

195 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

197 
i
 = 0; i < 
m_rou‹rs
.
	`size
(); i++) {

198 
num_funùiÚ®_wr™es
 +ğ
m_rou‹rs
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

201 
i
 = 0; i < 
m_nis
.
	`size
(); ++i) {

202 
num_funùiÚ®_wr™es
 +ğ
m_nis
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

205 
i
 = 0; i < 
m_lšks
.
	`size
(); ++i) {

206 
num_funùiÚ®_wr™es
 +ğ
m_lšks
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

209  
num_funùiÚ®_wr™es
;

210 
	}
}

213 
	gG¬ÃtN‘wÜk
::
	$»gSts
()

215 
Ba£G¬ÃtN‘wÜk
::
	`»gSts
();

217 
m_av”age_lšk_utiz©iÚ
.
	`Çme
(name() + ".avg_link_utilization");

219 
m_av”age_vc_lßd


220 .
	`š™
(
m_vœtu®_ÃtwÜks
 * 
m_vcs_³r_vÃt
)

221 .
	`Çme
(name() + ".avg_vc_load")

222 .
	`æags
(
Sts
::
pdf
 | Sts::
tÙ®
 | Sts::
noz”o
)

224 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
 * 
m_vcs_³r_vÃt
; i++) {

225 
m_av”age_vc_lßd


226 .
	`subÇme
(
i
, 
	`c¥rštf
(".%i", i))

227 .
	`æags
(
Sts
::
noz”o
)

230 
	}
}

233 
	gG¬ÃtN‘wÜk
::
	$cŞÏ‹Sts
()

235 
i
 = 0; i < 
m_lšks
.
	`size
(); i++) {

236 
m_av”age_lšk_utiz©iÚ
 +=

237 ((
m_lšks
[
i
]->
	`g‘LškUtiz©iÚ
())) /

238 ((
	`curCyşe
(è- 
g_ruby_¡¬t
));

240 
veùÜ
<> 
vc_lßd
 = 
m_lšks
[
i
]->
	`g‘VcLßd
();

241 
j
 = 0; j < 
vc_lßd
.
	`size
(); j++) {

242 
m_av”age_vc_lßd
[
j
] +ğ
vc_lßd
[j];

245 
	}
}

248 
	gG¬ÃtN‘wÜk
::
	$´št
(
o¡»am
& 
out
) const

250 
out
 << "[GarnetNetwork]";

251 
	}
}

253 
G¬ÃtN‘wÜk
 *

254 
	gG¬ÃtN‘wÜkP¬ams
::
	$ü—‹
()

256  
Ãw
 
	`G¬ÃtN‘wÜk
(
this
);

257 
	}
}

	@ruby/network/garnet/flexible-pipeline/GarnetNetwork.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_GARNET_NETWORK_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_GARNET_NETWORK_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/Ba£G¬ÃtN‘wÜk.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

39 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

40 
	~"·¿ms/G¬ÃtN‘wÜk.hh
"

42 
şass
 
	gN‘wÜkIÁ”çû
;

43 
şass
 
	gMes§geBufãr
;

44 
şass
 
	gRou‹r
;

45 
şass
 
	gTİŞogy
;

46 
şass
 
	gN‘De¡
;

47 
şass
 
	gN‘wÜkLšk
;

49 şas 
	cG¬ÃtN‘wÜk
 : 
public
 
Ba£G¬ÃtN‘wÜk


51 
public
:

52 
G¬ÃtN‘wÜkP¬ams
 
	tP¬ams
;

53 
G¬ÃtN‘wÜk
(cÚ¡ 
P¬ams
 *
p
);

55 ~
G¬ÃtN‘wÜk
();

57 
š™
();

59 
	$g‘BufãrSize
(è{  
m_bufãr_size
; }

60 
	$g‘NumPeSges
(è{ 
m_numb”_of_pe_¡ages
; 
	}
}

61 
	$g‘NumNodes
(){  
m_nodes
; 
	}
}

63 
cŞÏ‹Sts
();

64 
»gSts
();

65 
´št
(
¡d
::
o¡»am
& 
out
) const;

68 
makeOutLšk
(
Sw™chID
 
¤c
, 
NodeID
 
de¡
, 
BasicLšk
* 
lšk
,

69 
LškDœeùiÚ
 
dœeùiÚ
,

70 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

71 
makeInLšk
(
NodeID
 
¤c
, 
Sw™chID
 
de¡
, 
BasicLšk
* 
lšk
,

72 
LškDœeùiÚ
 
dœeùiÚ
,

73 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

74 
makeIÁ”ÇlLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

75 
LškDœeùiÚ
 
dœeùiÚ
,

76 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

80 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *
pkt
);

84 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

86 
	g´iv©e
:

87 
checkN‘wÜkAÎoÿtiÚ
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
,

88 
¡d
::
¡ršg
 
vÃt_ty³
);

90 
G¬ÃtN‘wÜk
(cÚ¡ G¬ÃtN‘wÜk& 
obj
);

91 
	gG¬ÃtN‘wÜk
& 
	gİ”©Ü
=(cÚ¡ 
G¬ÃtN‘wÜk
& 
obj
);

93 
	g¡d
::
veùÜ
<
Rou‹r
 *> 
m_rou‹rs
;

94 
	g¡d
::
veùÜ
<
N‘wÜkLšk
 *> 
m_lšks
;

95 
	g¡d
::
veùÜ
<
N‘wÜkIÁ”çû
 *> 
m_nis
;

97 
	gm_bufãr_size
;

98 
	gm_numb”_of_pe_¡ages
;

101 
	gSts
::
SÿÏr
 
m_av”age_lšk_utiz©iÚ
;

102 
	gSts
::
VeùÜ
 
m_av”age_vc_lßd
;

105 
šlše
 
	g¡d
::
o¡»am
&

106 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gG¬ÃtN‘wÜk
& 
	gobj
)

108 
	gobj
.
´št
(
out
);

109 
	gout
 << 
	g¡d
::
æush
;

110  
	gout
;

	@ruby/network/garnet/flexible-pipeline/InVcState.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/InVcS‹.hh
"

33 
	gInVcS‹
::
	$InVcS‹
(
id
)

35 
m_id
 = 
id
;

36 
m_vc_¡©e
 = 
IDLE_
;

37 
	}
}

39 
boŞ


40 
	gInVcS‹
::
	$isInS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
»que¡_time
)

42  ((
m_vc_¡©e
 =ğ
¡©e
è&& (
»que¡_time
 >ğ
m_time
) );

43 
	}
}

46 
	gInVcS‹
::
	$£tRou‹
(
rou‹
)

48 
m_rou‹
 = 
rou‹
;

49 
	}
}

52 
	gInVcS‹
::
	$£tS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
time
)

54 
m_vc_¡©e
 = 
¡©e
;

55 
m_time
 = 
time
;

56 
	}
}

59 
	gInVcS‹
::
	$g¿Á_vc
(
out_vc
, 
Cyşes
 
g¿Á_time
)

61 
m_vc_¡©e
 = 
ACTIVE_
;

62 
m_time
 = 
g¿Á_time
;

63 
m_ouut_vc
 = 
out_vc
;

64 
	}
}

67 
	gInVcS‹
::
	$g‘_ouÜt
()

69  
m_rou‹
;

70 
	}
}

73 
	gInVcS‹
::
	$g‘_outvc
()

75  
m_ouut_vc
;

76 
	}
}

	@ruby/network/garnet/flexible-pipeline/InVcState.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_IN_VC_STATE_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_IN_VC_STATE_HH__


	)

34 
	~"ba£/ty³s.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

37 şas 
	cInVcS‹


39 
	mpublic
:

40 
InVcS‹
(
id
);

42 
£tRou‹
(
rou‹
);

43 
£tS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
time
);

44 
g‘_ouÜt
();

45 
g‘_outvc
();

46 
g¿Á_vc
(
out_vc
, 
Cyşes
 
g¿Á_time
);

47 
boŞ
 
isInS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
time
);

49 
	m´iv©e
:

50 
m_id
;

51 
	mm_rou‹
;

52 
	mm_ouut_vc
;

53 
VC_¡©e_ty³
 
	mm_vc_¡©e
;

54 
Cyşes
 
	mm_time
;

	@ruby/network/garnet/flexible-pipeline/NetworkInterface.cc

31 
	~<ÿs£¹
>

32 
	~<cm©h
>

34 
	~"ba£/ÿ¡.hh
"

35 
	~"ba£/¡l_h–³rs.hh
"

36 
	~"debug/RubyN‘wÜk.hh
"

37 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/N‘wÜkIÁ”çû.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/æ™Bufãr.hh
"

40 
	~"mem/ruby/¦icc_š‹rçû/N‘wÜkMes§ge.hh
"

42 
usšg
 
Çme¥aû
 
	g¡d
;

43 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

45 
	gN‘wÜkIÁ”çû
::
	$N‘wÜkIÁ”çû
(
id
, 
vœtu®_ÃtwÜks
,

46 
G¬ÃtN‘wÜk
 *
ÃtwÜk_±r
)

47 : 
	$FËxibËCÚsum”
(
ÃtwÜk_±r
)

49 
m_id
 = 
id
;

50 
m_Ãt_±r
 = 
ÃtwÜk_±r
;

51 
m_vœtu®_ÃtwÜks
 = 
vœtu®_ÃtwÜks
;

52 
m_vc_³r_vÃt
 = 
m_Ãt_±r
->
	`g‘VCsP”VÃt
();

53 
m_num_vcs
 = 
m_vc_³r_vÃt
*
m_vœtu®_ÃtwÜks
;

55 
m_vc_round_robš
 = 0;

56 
m_ni_bufãrs
.
	`»size
(
m_num_vcs
);

57 
šNode_±r
.
	`»size
(
m_vœtu®_ÃtwÜks
);

58 
outNode_±r
.
	`»size
(
m_vœtu®_ÃtwÜks
);

61 
i
 =0; i < 
m_num_vcs
; i++)

62 
m_ni_bufãrs
[
i
] = 
Ãw
 
	`æ™Bufãr
();

64 
m_vc_®loÿtÜ
.
	`»size
(
m_vœtu®_ÃtwÜks
);

65 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
; i++) {

66 
m_vc_®loÿtÜ
[
i
] = 0;

69 
i
 = 0; i < 
m_num_vcs
; i++) {

70 
m_out_vc_¡©e
.
	`push_back
(
Ãw
 
	`OutVcS‹
(
i
));

72 
	}
}

74 
	gN‘wÜkIÁ”çû
::~
	$N‘wÜkIÁ”çû
()

76 
	`d–‘ePoš‹rs
(
m_out_vc_¡©e
);

77 
	`d–‘ePoš‹rs
(
m_ni_bufãrs
);

78 
d–‘e
 
outSrcQueue
;

79 
	}
}

82 
	gN‘wÜkIÁ”çû
::
	$addInPÜt
(
N‘wÜkLšk
 *
š_lšk
)

84 
šN‘Lšk
 = 
š_lšk
;

85 
š_lšk
->
	`£tLškCÚsum”
(
this
);

86 
	}
}

89 
	gN‘wÜkIÁ”çû
::
	$addOutPÜt
(
N‘wÜkLšk
 *
out_lšk
)

91 
outN‘Lšk
 = 
out_lšk
;

92 
outSrcQueue
 = 
Ãw
 
	`æ™Bufãr
();

93 
out_lšk
->
	`£tSourûQueue
(
outSrcQueue
);

94 
out_lšk
->
	`£tSourû
(
this
);

95 
	}
}

98 
	gN‘wÜkIÁ”çû
::
addNode
(
veùÜ
<
Mes§geBufãr
*>& 
š
,

99 
veùÜ
<
Mes§geBufãr
*>& 
out
)

101 
as£¹
(
š
.
size
(è=ğ
m_vœtu®_ÃtwÜks
);

102 
	gšNode_±r
 = 
š
;

103 
	goutNode_±r
 = 
out
;

106 
	gj
 = 0; j < 
	gm_vœtu®_ÃtwÜks
; j++) {

107 
	gšNode_±r
[
j
]->
£tCÚsum”
(
this
);

108 
	gšNode_±r
[
j
]->
£tReûiv”
(
m_Ãt_±r
);

110 
	goutNode_±r
[
j
]->
£tS’d”
(
m_Ãt_±r
);

115 
	gN‘wÜkIÁ”çû
::
	$»que¡_vc
(
š_vc
, 
š_pÜt
, 
N‘De¡
 
de¡š©iÚ
,

116 
Cyşes
 
»que¡_time
)

118 
šN‘Lšk
->
	`g¿Á_vc_lšk
(
š_vc
, 
»que¡_time
);

119 
	}
}

121 
boŞ


122 
	gN‘wÜkIÁ”çû
::
	$æ™isizeMes§ge
(
MsgPŒ
 
msg_±r
, 
vÃt
)

124 
N‘wÜkMes§ge
 *
Ãt_msg_±r
 = 
§ã_ÿ¡
<N‘wÜkMes§g*>(
msg_±r
.
	`g‘
());

125 
N‘De¡
 
Ãt_msg_de¡
 = 
Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
();

128 
veùÜ
<
NodeID
> 
de¡_nodes
 = 
Ãt_msg_de¡
.
	`g‘AÎDe¡
();

133 
num_æ™s
 = (è
	`û
((è
m_Ãt_±r
->
	`Mes§geSizeTy³_to_št
(

134 
Ãt_msg_±r
->
	`g‘Mes§geSize
())/
m_Ãt_±r
->
	`g‘NiFl™Size
());

137 
ùr
 = 0; cŒ < 
de¡_nodes
.
	`size
(); ctr++) {

138 
vc
 = 
	`ÿlcuÏ‹VC
(
vÃt
);

140 ià(
vc
 == -1) {

142  
çl£
 ;

144 
MsgPŒ
 
Ãw_msg_±r
 = 
msg_±r
->
	`şÚe
();

145 
NodeID
 
de¡ID
 = 
de¡_nodes
[
ùr
];

147 
N‘wÜkMes§ge
 *
Ãw_Ãt_msg_±r
 =

148 
§ã_ÿ¡
<
N‘wÜkMes§ge
 *>(
Ãw_msg_±r
.
	`g‘
());

149 ià(
de¡_nodes
.
	`size
() > 1) {

150 
N‘De¡
 
³rsÚ®_de¡
;

151 
m
 = 0; m < (è
MachšeTy³_NUM
; m++) {

152 ià((
de¡ID
 >ğ
	`MachšeTy³_ba£_numb”
((
MachšeTy³
è
m
)) &&

153 
de¡ID
 < 
	`MachšeTy³_ba£_numb”
((
MachšeTy³
è(
m
+1))) {

155 
³rsÚ®_de¡
.
	`ş—r
();

156 
³rsÚ®_de¡
.
	`add
((
MachšeID
è{(
MachšeTy³
è
m
, (
de¡ID
 -

157 
	`MachšeTy³_ba£_numb”
((
MachšeTy³
è
m
))});

158 
Ãw_Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
(èğ
³rsÚ®_de¡
;

162 
Ãt_msg_de¡
.
	`»moveN‘De¡
(
³rsÚ®_de¡
);

167 
Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
().
	`»moveN‘De¡
(
³rsÚ®_de¡
);

169 
i
 = 0; i < 
num_æ™s
; i++) {

170 
m_Ãt_±r
->
	`šüem’t_šjeùed_æ™s
(
vÃt
);

171 
æ™
 *
æ
 = 
Ãw
 
	`æ™
(
i
, 
vc
, 
vÃt
, 
num_æ™s
, 
Ãw_msg_±r
,

172 
m_Ãt_±r
->
	`curCyşe
());

173 
æ
->
	`£t_d–ay
(
m_Ãt_±r
->
	`curCyşe
() -

174 
m_Ãt_±r
->
	`ticksToCyşes
(
msg_±r
->
	`g‘Time
()));

175 
m_ni_bufãrs
[
vc
]->
	`š£¹
(
æ
);

178 
m_out_vc_¡©e
[
vc
]->
	`£tS‹
(
VC_AB_
, 
m_Ãt_±r
->
	`curCyşe
());

183 
outN‘Lšk
->
	`»que¡_vc_lšk
(
vc
,

184 
Ãw_Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
(),

185 
m_Ãt_±r
->
	`curCyşe
());

188  
Œue
 ;

189 
	}
}

194 
	gN‘wÜkIÁ”çû
::
	$g¿Á_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
g¿Á_time
)

196 
	`as£¹
(
m_out_vc_¡©e
[
vc
]->
	`isInS‹
(
VC_AB_
, 
g¿Á_time
));

197 
m_out_vc_¡©e
[
vc
]->
	`g¿Á_vc
(
g¿Á_time
);

198 
	`scheduËEv’t
(
	`Cyşes
(1));

199 
	}
}

204 
	gN‘wÜkIÁ”çû
::
	$»Ëa£_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
»Ëa£_time
)

206 
	`as£¹
(
m_out_vc_¡©e
[
vc
]->
	`isInS‹
(
ACTIVE_
, 
»Ëa£_time
));

207 
m_out_vc_¡©e
[
vc
]->
	`£tS‹
(
IDLE_
, 
»Ëa£_time
);

208 
	`scheduËEv’t
(
	`Cyşes
(1));

209 
	}
}

213 
	gN‘wÜkIÁ”çû
::
	$ÿlcuÏ‹VC
(
vÃt
)

215 
vc_³r_vÃt
;

216 ià(
m_Ãt_±r
->
	`isVN‘Ord”ed
(
vÃt
))

217 
vc_³r_vÃt
 = 1;

219 
vc_³r_vÃt
 = 
m_vc_³r_vÃt
;

221 
i
 = 0; i < 
vc_³r_vÃt
; i++) {

222 
d–
 = 
m_vc_®loÿtÜ
[
vÃt
];

223 
m_vc_®loÿtÜ
[
vÃt
]++;

224 ià(
m_vc_®loÿtÜ
[
vÃt
] =ğ
vc_³r_vÃt
)

225 
m_vc_®loÿtÜ
[
vÃt
] = 0;

227 ià(
m_out_vc_¡©e
[(
vÃt
*
m_vc_³r_vÃt
è+ 
d–
]->
	`isInS‹
(
IDLE_
,

228 
m_Ãt_±r
->
	`curCyşe
())) {

229  ((
vÃt
*
m_vc_³r_vÃt
è+ 
d–
);

233 
	}
}

245 
	gN‘wÜkIÁ”çû
::
	$wakeup
()

247 
MsgPŒ
 
msg_±r
;

251 
vÃt
 = 0; vÃˆ< 
m_vœtu®_ÃtwÜks
; vnet++) {

252 
šNode_±r
[
vÃt
]->
	`isR—dy
())

254 
msg_±r
 = 
šNode_±r
[
vÃt
]->
	`³ekMsgPŒ
();

255 ià(
	`æ™isizeMes§ge
(
msg_±r
, 
vÃt
)) {

256 
šNode_±r
[
vÃt
]->
	`pİ
();

263 
	`scheduËOuutLšk
();

264 
	`checkRescheduË
();

268 ià(
šN‘Lšk
->
	`isR—dy
()) {

269 
æ™
 *
t_æ™
 = 
šN‘Lšk
->
	`cÚsumeLšk
();

270 ià(
t_æ™
->
	`g‘_ty³
(è=ğ
TAIL_
 ||_æ™->g‘_ty³(è=ğ
HEAD_TAIL_
) {

271 
	`DPRINTF
(
RubyN‘wÜk
, "m_id: %d, Message delivered‡time: %lld\n",

272 
m_id
, 
m_Ãt_±r
->
	`curCyşe
());

274 
outNode_±r
[
t_æ™
->
	`g‘_vÃt
()]->
	`’queue
(

275 
t_æ™
->
	`g‘_msg_±r
(), 
	`Cyşes
(1));

278 
šN‘Lšk
->
	`»Ëa£_vc_lšk
(
t_æ™
->
	`g‘_vc
(),

279 
m_Ãt_±r
->
	`curCyşe
(è+ 
	`Cyşes
(1));

282 
vÃt
 = 
t_æ™
->
	`g‘_vÃt
();

283 
m_Ãt_±r
->
	`šüem’t_»ûived_æ™s
(
vÃt
);

284 
Cyşes
 
ÃtwÜk_d–ay
 = 
m_Ãt_±r
->
	`curCyşe
() -

285 
t_æ™
->
	`g‘_’queue_time
();

286 
Cyşes
 
queuešg_d–ay
 = 
t_æ™
->
	`g‘_d–ay
();

288 
m_Ãt_±r
->
	`šüem’t_ÃtwÜk_Ï‹ncy
(
ÃtwÜk_d–ay
, 
vÃt
);

289 
m_Ãt_±r
->
	`šüem’t_queuešg_Ï‹ncy
(
queuešg_d–ay
, 
vÃt
);

290 
d–‘e
 
t_æ™
;

292 
	}
}

301 
	gN‘wÜkIÁ”çû
::
	$scheduËOuutLšk
()

303 
vc
 = 
m_vc_round_robš
;

304 
m_vc_round_robš
++;

305 ià(
m_vc_round_robš
 =ğ
m_num_vcs
)

306 
m_vc_round_robš
 = 0;

308 
i
 = 0; i < 
m_num_vcs
; i++) {

309 
vc
++;

310 ià(
vc
 =ğ
m_num_vcs
)

311 
vc
 = 0;

312 ià(
m_ni_bufãrs
[
vc
]->
	`isR—dy
(
m_Ãt_±r
->
	`curCyşe
())) {

313 ià(
m_out_vc_¡©e
[
vc
]->
	`isInS‹
(
ACTIVE_
,

314 
m_Ãt_±r
->
	`curCyşe
()) &&

315 
outN‘Lšk
->
	`isBufãrNÙFuÎ_lšk
(
vc
)) {

318 
æ™
 *
t_æ™
 = 
m_ni_bufãrs
[
vc
]->
	`g‘TİFl™
();

319 
t_æ™
->
	`£t_time
(
m_Ãt_±r
->
	`curCyşe
(è+ 
	`Cyşes
(1));

320 
outSrcQueue
->
	`š£¹
(
t_æ™
);

323 
outN‘Lšk
->

324 
	`scheduËEv’tAbsŞu‹
(
m_Ãt_±r
->
	`şockEdge
(
	`Cyşes
(1)));

329 
	}
}

332 
	gN‘wÜkIÁ”çû
::
	$checkRescheduË
()

334 
vÃt
 = 0; vÃˆ< 
m_vœtu®_ÃtwÜks
; vnet++) {

335 ià(
šNode_±r
[
vÃt
]->
	`isR—dy
()) {

336 
	`scheduËEv’t
(
	`Cyşes
(1));

340 
vc
 = 0; vø< 
m_num_vcs
; vc++) {

341 ià(
m_ni_bufãrs
[
vc
]->
	`isR—dyFÜNext
(
m_Ãt_±r
->
	`curCyşe
())) {

342 
	`scheduËEv’t
(
	`Cyşes
(1));

346 
	}
}

348 
boŞ


349 
	gN‘wÜkIÁ”çû
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

352 
i
 = 0; i < 
m_ni_bufãrs
.
	`size
(); ++i) {

353 ià(
m_ni_bufãrs
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

354  
Œue
;

359 ià(
outSrcQueue
->
	`funùiÚ®R—d
(
pkt
)) {

360  
Œue
;

363  
çl£
;

364 
	}
}

366 
ušt32_t


367 
	gN‘wÜkIÁ”çû
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

369 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

370 
i
 = 0; i < 
m_ni_bufãrs
.
	`size
(); ++i) {

371 
num_funùiÚ®_wr™es
 +ğ
m_ni_bufãrs
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

374 
num_funùiÚ®_wr™es
 +ğ
outSrcQueue
->
	`funùiÚ®Wr™e
(
pkt
);

375  
num_funùiÚ®_wr™es
;

376 
	}
}

379 
	gN‘wÜkIÁ”çû
::
´št
(
¡d
::
o¡»am
& 
out
) const

381 
out
 << "[Network Interface]";

	@ruby/network/garnet/flexible-pipeline/NetworkInterface.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_NETWORK_INTERFACE_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_NETWORK_INTERFACE_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/FËxibËCÚsum”.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/G¬ÃtN‘wÜk.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/N‘wÜkLšk.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/OutVcS‹.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

42 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

44 
şass
 
	gN‘wÜkMes§ge
;

45 
şass
 
	gMes§geBufãr
;

46 
şass
 
	gæ™Bufãr
;

48 şas 
	cN‘wÜkIÁ”çû
 : 
public
 
FËxibËCÚsum”


50 
public
:

51 
N‘wÜkIÁ”çû
(
id
, 
vœtu®_ÃtwÜks
,

52 
G¬ÃtN‘wÜk
* 
ÃtwÜk_±r
);

54 ~
N‘wÜkIÁ”çû
();

56 
addInPÜt
(
N‘wÜkLšk
 *
š_lšk
);

57 
addOutPÜt
(
N‘wÜkLšk
 *
out_lšk
);

59 
wakeup
();

60 
addNode
(
¡d
::
veùÜ
<
Mes§geBufãr
 *> &
šNode
,

61 
¡d
::
veùÜ
<
Mes§geBufãr
 *> &
outNode
);

62 
g¿Á_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
g¿Á_time
);

63 
»Ëa£_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
»Ëa£_time
);

65 
boŞ


66 
	$isBufãrNÙFuÎ
(
vc
, 
špÜt
)

68  
Œue
;

70 
	`»que¡_vc
(
š_vc
, 
š_pÜt
, 
N‘De¡
 
de¡š©iÚ
,

71 
Cyşes
 
»que¡_time
);

73 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

75 
boŞ
 
	`funùiÚ®R—d
(
Pack‘
 *);

76 
ušt32_t
 
	`funùiÚ®Wr™e
(
Pack‘
 *);

78 
´iv©e
:

79 
G¬ÃtN‘wÜk
 *
m_Ãt_±r
;

80 
m_vœtu®_ÃtwÜks
, 
m_num_vcs
, 
m_vc_³r_vÃt
;

81 
NodeID
 
m_id
;

83 
¡d
::
veùÜ
<
OutVcS‹
 *> 
m_out_vc_¡©e
;

84 
¡d
::
veùÜ
<> 
m_vc_®loÿtÜ
;

85 
m_vc_round_robš
;

86 
æ™Bufãr
 *
outSrcQueue
;

88 
N‘wÜkLšk
 *
šN‘Lšk
;

89 
N‘wÜkLšk
 *
outN‘Lšk
;

94 
¡d
::
veùÜ
<
æ™Bufãr
 *> 
m_ni_bufãrs
;

97 
¡d
::
veùÜ
<
Mes§geBufãr
 *> 
šNode_±r
;

100 
¡d
::
veùÜ
<
Mes§geBufãr
 *> 
outNode_±r
;

102 
boŞ
 
	`æ™isizeMes§ge
(
MsgPŒ
 
msg_±r
, 
vÃt
);

103 
	`ÿlcuÏ‹VC
(
vÃt
);

104 
	`scheduËOuutLšk
();

105 
	`checkRescheduË
();

106 
	}
};

	@ruby/network/garnet/flexible-pipeline/NetworkLink.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/G¬ÃtN‘wÜk.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/N‘wÜkLšk.hh
"

34 
	gN‘wÜkLšk
::
	$N‘wÜkLšk
(cÚ¡ 
P¬ams
 *
p
)

35 : 
	`ClockedObjeù
(
p
), 
	$FËxibËCÚsum”
(
this
)

37 
lškBufãr
 = 
Ãw
 
	`æ™Bufãr
();

38 
m_š_pÜt
 = 0;

39 
m_out_pÜt
 = 0;

40 
m_lšk_utized
 = 0;

41 
m_Ï‹ncy
 = 
p
->
lšk_Ï‹ncy
;

42 
m_id
 = 
p
->
lšk_id
;

44 
num_Ãt
 = 
p
->
vœt_Ãts
;

45 
num_vc
 = 
p
->
vcs_³r_vÃt
;

46 
m_vc_lßd
.
	`»size
(
num_Ãt
 * 
num_vc
);

48 
i
 = 0; i < 
num_Ãt
 * 
num_vc
; i++)

49 
m_vc_lßd
[
i
] = 0;

50 
	}
}

52 
	gN‘wÜkLšk
::~
	$N‘wÜkLšk
()

54 
d–‘e
 
lškBufãr
;

55 
	}
}

58 
	gN‘wÜkLšk
::
	$£tLškCÚsum”
(
FËxibËCÚsum”
 *
cÚsum”
)

60 
lšk_cÚsum”
 = 
cÚsum”
;

61 
	}
}

64 
	gN‘wÜkLšk
::
	$£tSourûQueue
(
æ™Bufãr
 *
¤cQueue
)

66 
lšk_¤cQueue
 = 
¤cQueue
;

67 
	}
}

70 
	gN‘wÜkLšk
::
	$£tSourû
(
FËxibËCÚsum”
 *
sourû
)

72 
lšk_sourû
 = 
sourû
;

73 
	}
}

76 
	gN‘wÜkLšk
::
	$»que¡_vc_lšk
(
vc
, 
N‘De¡
 
de¡š©iÚ
, 
Cyşes
 
»que¡_time
)

78 
lšk_cÚsum”
->
	`»que¡_vc
(
vc
, 
m_š_pÜt
, 
de¡š©iÚ
, 
»que¡_time
);

79 
	}
}

81 
boŞ


82 
	gN‘wÜkLšk
::
	$isBufãrNÙFuÎ_lšk
(
vc
)

84  
lšk_cÚsum”
->
	`isBufãrNÙFuÎ
(
vc
, 
m_š_pÜt
);

85 
	}
}

88 
	gN‘wÜkLšk
::
	$g¿Á_vc_lšk
(
vc
, 
Cyşes
 
g¿Á_time
)

90 
lšk_sourû
->
	`g¿Á_vc
(
m_out_pÜt
, 
vc
, 
g¿Á_time
);

91 
	}
}

94 
	gN‘wÜkLšk
::
	$»Ëa£_vc_lšk
(
vc
, 
Cyşes
 
»Ëa£_time
)

96 
lšk_sourû
->
	`»Ëa£_vc
(
m_out_pÜt
, 
vc
, 
»Ëa£_time
);

97 
	}
}

99 
boŞ


100 
	gN‘wÜkLšk
::
	$isR—dy
()

102  
lškBufãr
->
	`isR—dy
(
	`curCyşe
());

103 
	}
}

106 
	gN‘wÜkLšk
::
	$£tInPÜt
(
pÜt
)

108 
m_š_pÜt
 = 
pÜt
;

109 
	}
}

112 
	gN‘wÜkLšk
::
	$£tOutPÜt
(
pÜt
)

114 
m_out_pÜt
 = 
pÜt
;

115 
	}
}

118 
	gN‘wÜkLšk
::
	$wakeup
()

120 ià(!
lšk_¤cQueue
->
	`isR—dy
(
	`curCyşe
()))

123 
æ™
 *
t_æ™
 = 
lšk_¤cQueue
->
	`g‘TİFl™
();

124 
t_æ™
->
	`£t_time
(
	`curCyşe
(è+ 
m_Ï‹ncy
);

125 
lškBufãr
->
	`š£¹
(
t_æ™
);

126 
lšk_cÚsum”
->
	`scheduËEv’tAbsŞu‹
(
	`şockEdge
(
m_Ï‹ncy
));

128 
m_lšk_utized
++;

129 
m_vc_lßd
[
t_æ™
->
	`g‘_vc
()]++;

130 
	}
}

132 
æ™
*

133 
	gN‘wÜkLšk
::
	$³ekLšk
()

135  
lškBufãr
->
	`³ekTİFl™
();

136 
	}
}

138 
æ™
*

139 
	gN‘wÜkLšk
::
	$cÚsumeLšk
()

141  
lškBufãr
->
	`g‘TİFl™
();

142 
	}
}

144 
boŞ


145 
	gN‘wÜkLšk
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

147  
lškBufãr
->
	`funùiÚ®R—d
(
pkt
);

148 
	}
}

150 
ušt32_t


151 
	gN‘wÜkLšk
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

153  
lškBufãr
->
	`funùiÚ®Wr™e
(
pkt
);

154 
	}
}

156 
N‘wÜkLšk
 *

157 
	gN‘wÜkLškP¬ams
::
	$ü—‹
()

159  
Ãw
 
	`N‘wÜkLšk
(
this
);

160 
	}
}

	@ruby/network/garnet/flexible-pipeline/NetworkLink.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_NETWORK_LINK_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_NETWORK_LINK_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/N‘De¡.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/FËxibËCÚsum”.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/æ™Bufãr.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

41 
	~"·¿ms/N‘wÜkLšk.hh
"

42 
	~"sim/şocked_objeù.hh
"

44 
şass
 
	gG¬ÃtN‘wÜk
;

46 
şass
 
	gN‘wÜkLšk
 : 
public
 
ClockedObjeù
,…ubliø
	gFËxibËCÚsum”


48 
	gpublic
:

49 
N‘wÜkLškP¬ams
 
	tP¬ams
;

50 
N‘wÜkLšk
(cÚ¡ 
P¬ams
 *
p
);

51 ~
N‘wÜkLšk
();

53 
£tLškCÚsum”
(
FËxibËCÚsum”
 *
cÚsum”
);

54 
£tSourûQueue
(
æ™Bufãr
 *
¤cQueue
);

55 
æ™
 *
³ekLšk
();

56 
æ™
 *
cÚsumeLšk
();

58 
´št
(
¡d
::
o¡»am
& 
out
) const {}

60 
boŞ
 
is_vc_»ady
(
æ™
 *
t_æ™
);

62 
g‘_id
(ècÚ¡ {  
	gm_id
; }

63 
£tInPÜt
(
pÜt
);

64 
£tOutPÜt
(
pÜt
);

65 
wakeup
();

66 
boŞ
 
isR—dy
();

67 
g¿Á_vc_lšk
(
vc
, 
Cyşes
 
g¿Á_time
);

68 
»Ëa£_vc_lšk
(
vc
, 
Cyşes
 
»Ëa£_time
);

69 
»que¡_vc_lšk
(
vc
, 
N‘De¡
 
de¡š©iÚ
, 
Cyşes
 
»que¡_time
);

70 
boŞ
 
isBufãrNÙFuÎ_lšk
(
vc
);

71 
£tSourû
(
FËxibËCÚsum”
 *
sourû
);

72 
š™_Ãt_±r
(
G¬ÃtN‘wÜk
* 
Ãt_±r
è{ 
	gm_Ãt_±r
 =‚et_ptr; }

74 
g‘LškUtiz©iÚ
(ècÚ¡ {  
	gm_lšk_utized
; }

75 cÚ¡ 
	g¡d
::
veùÜ
<> & 
g‘VcLßd
(ècÚ¡ {  
m_vc_lßd
; }

77 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *);

78 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *);

80 
	g´iv©e
:

81 
m_id
;

82 
Cyşes
 
	gm_Ï‹ncy
;

83 
	gm_š_pÜt
, 
	gm_out_pÜt
;

84 
G¬ÃtN‘wÜk
 *
	gm_Ãt_±r
;

86 
æ™Bufãr
 *
	glškBufãr
;

87 
FËxibËCÚsum”
 *
	glšk_cÚsum”
;

88 
FËxibËCÚsum”
 *
	glšk_sourû
;

89 
æ™Bufãr
 *
	glšk_¤cQueue
;

92 
	gm_lšk_utized
;

93 
	g¡d
::
veùÜ
<> 
m_vc_lßd
;

	@ruby/network/garnet/flexible-pipeline/OutVcState.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/OutVcS‹.hh
"

33 
	gOutVcS‹
::
	$OutVcS‹
(
id
)

34 : 
	$m_time
(0)

36 
m_id
 = 
id
;

37 
m_vc_¡©e
 = 
IDLE_
;

38 
	}
}

40 
boŞ


41 
	gOutVcS‹
::
	$isInS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
»que¡_time
)

43  ((
m_vc_¡©e
 =ğ
¡©e
è&& (
»que¡_time
 >ğ
m_time
));

44 
	}
}

47 
	gOutVcS‹
::
	$g¿Á_vc
(
Cyşes
 
g¿Á_time
)

49 
m_time
 = 
g¿Á_time
;

50 
m_vc_¡©e
 = 
ACTIVE_
;

51 
	}
}

54 
	gOutVcS‹
::
	$£tS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
time
)

56 
m_vc_¡©e
 = 
¡©e
;

57 
m_time
 = 
time
;

58 
	}
}

	@ruby/network/garnet/flexible-pipeline/OutVcState.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_OUT_VC_STATE_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_OUT_VC_STATE_HH__


	)

34 
	~"ba£/ty³s.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

37 şas 
	cOutVcS‹


39 
	mpublic
:

40 
OutVcS‹
(
id
);

42 
boŞ
 
isInS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
»que¡_time
);

43 
£tS‹
(
VC_¡©e_ty³
 
¡©e
, 
Cyşes
 
time
);

44 
g¿Á_vc
(
Cyşes
 
g¿Á_time
);

46 
	m´iv©e
:

47 
m_id
 ;

48 
Cyşes
 
	mm_time
;

49 
VC_¡©e_ty³
 
	mm_vc_¡©e
;

	@ruby/network/garnet/flexible-pipeline/Router.cc

31 
	~"ba£/ÿ¡.hh
"

32 
	~"ba£/¡l_h–³rs.hh
"

33 
	~"debug/RubyN‘wÜk.hh
"

34 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/InVcS‹.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/OutVcS‹.hh
"

36 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/Rou‹r.hh
"

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/VC¬b™”.hh
"

38 
	~"mem/ruby/¦icc_š‹rçû/N‘wÜkMes§ge.hh
"

40 
usšg
 
Çme¥aû
 
	g¡d
;

41 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

43 
	gRou‹r
::
	$Rou‹r
(cÚ¡ 
P¬ams
 *
p
)

44 : 
	`BasicRou‹r
(
p
), 
	$FËxibËCÚsum”
(
this
)

46 
m_vœtu®_ÃtwÜks
 = 
p
->
vœt_Ãts
;

47 
m_vc_³r_vÃt
 = 
p
->
vcs_³r_vÃt
;

48 
m_round_robš_špÜt
 = 0;

49 
m_round_robš_¡¬t
 = 0;

50 
m_num_vcs
 = 
m_vc_³r_vÃt
 * 
m_vœtu®_ÃtwÜks
;

51 
m_vc_¬b™”
 = 
Ãw
 
	`VC¬b™”
(
this
);

52 
	}
}

54 
	gRou‹r
::~
	$Rou‹r
()

56 
i
 = 0; i < 
m_š_lšk
.
	`size
(); i++) {

57 
	`d–‘ePoš‹rs
(
m_š_vc_¡©e
[
i
]);

59 
i
 = 0; i < 
m_out_lšk
.
	`size
(); i++) {

60 
	`d–‘ePoš‹rs
(
m_out_vc_¡©e
[
i
]);

61 
	`d–‘ePoš‹rs
(
m_rou‹r_bufãrs
[
i
]);

63 
	`d–‘ePoš‹rs
(
m_out_¤c_queue
);

64 
d–‘e
 
m_vc_¬b™”
;

65 
	}
}

68 
	gRou‹r
::
	$addInPÜt
(
N‘wÜkLšk
 *
š_lšk
)

70 
pÜt
 = 
m_š_lšk
.
	`size
();

71 
veùÜ
<
InVcS‹
 *> 
š_vc_veùÜ
;

72 
i
 = 0; i < 
m_num_vcs
; i++) {

73 
š_vc_veùÜ
.
	`push_back
(
Ãw
 
	`InVcS‹
(
i
));

74 
š_vc_veùÜ
[
i
]->
	`£tS‹
(
IDLE_
, 
	`curCyşe
());

76 
m_š_vc_¡©e
.
	`push_back
(
š_vc_veùÜ
);

77 
m_š_lšk
.
	`push_back
(
š_lšk
);

78 
š_lšk
->
	`£tLškCÚsum”
(
this
);

79 
š_lšk
->
	`£tInPÜt
(
pÜt
);

81 
¡¬t
 = 0;

82 
m_round_robš_švc
.
	`push_back
(
¡¬t
);

83 
	}
}

86 
	gRou‹r
::
	$addOutPÜt
(
N‘wÜkLšk
 *
out_lšk
, cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
,

87 
lšk_weight
)

89 
pÜt
 = 
m_out_lšk
.
	`size
();

90 
out_lšk
->
	`£tOutPÜt
(
pÜt
);

91 
¡¬t
 = 0;

92 
m_vc_round_robš
.
	`push_back
(
¡¬t
);

94 
m_out_¤c_queue
.
	`push_back
(
Ãw
 
	`æ™Bufãr
());

96 
m_out_lšk
.
	`push_back
(
out_lšk
);

97 
m_routšg_bË
.
	`push_back
(
routšg_bË_’Œy
);

98 
out_lšk
->
	`£tSourûQueue
(
m_out_¤c_queue
[
pÜt
]);

99 
out_lšk
->
	`£tSourû
(
this
);

101 
veùÜ
<
æ™Bufãr
 *> 
š‹rmedŸ‹Queues
;

102 
i
 = 0; i < 
m_num_vcs
; i++) {

103 
bufãr_size
 = 
m_Ãt_±r
->
	`g‘BufãrSize
();

104 ià(
bufãr_size
 > 0)

105 
š‹rmedŸ‹Queues
.
	`push_back
(
Ãw
 
	`æ™Bufãr
(
bufãr_size
));

107 
š‹rmedŸ‹Queues
.
	`push_back
(
Ãw
 
	`æ™Bufãr
());

109 
m_rou‹r_bufãrs
.
	`push_back
(
š‹rmedŸ‹Queues
);

111 
veùÜ
<
OutVcS‹
 *> 
out_vc_veùÜ
;

112 
i
 = 0; i < 
m_num_vcs
; i++) {

113 
out_vc_veùÜ
.
	`push_back
(
Ãw
 
	`OutVcS‹
(
i
));

114 
out_vc_veùÜ
[
i
]->
	`£tS‹
(
IDLE_
, 
	`curCyşe
());

116 
m_out_vc_¡©e
.
	`push_back
(
out_vc_veùÜ
);

117 
m_lšk_weights
.
	`push_back
(
lšk_weight
);

118 
	}
}

120 
boŞ


121 
	gRou‹r
::
	$isBufãrNÙFuÎ
(
vc
, 
špÜt
)

123 
ouÜt
 = 
m_š_vc_¡©e
[
špÜt
][
vc
]->
	`g‘_ouÜt
();

124 
outvc
 = 
m_š_vc_¡©e
[
špÜt
][
vc
]->
	`g‘_outvc
();

126  (!
m_rou‹r_bufãrs
[
ouÜt
][
outvc
]->
	`isFuÎ
());

127 
	}
}

132 
	gRou‹r
::
	$»que¡_vc
(
š_vc
, 
š_pÜt
, 
N‘De¡
 
de¡š©iÚ
,

133 
Cyşes
 
»que¡_time
)

135 
	`as£¹
(
m_š_vc_¡©e
[
š_pÜt
][
š_vc
]->
	`isInS‹
(
IDLE_
, 
»que¡_time
));

137 
ouÜt
 = 
	`g‘Rou‹
(
de¡š©iÚ
);

138 
m_š_vc_¡©e
[
š_pÜt
][
š_vc
]->
	`£tRou‹
(
ouÜt
);

139 
m_š_vc_¡©e
[
š_pÜt
][
š_vc
]->
	`£tS‹
(
VC_AB_
, 
»que¡_time
);

140 
	`as£¹
(
»que¡_time
 >ğ
	`curCyşe
());

141 ià(
»que¡_time
 > 
	`curCyşe
())

142 
m_vc_¬b™”
->
	`scheduËEv’tAbsŞu‹
(
	`şockP”iod
(è* 
»que¡_time
);

144 
	`vc_¬b™¿‹
();

145 
	}
}

148 
	gRou‹r
::
	$vc_¬b™¿‹
()

150 
špÜt
 = 
m_round_robš_špÜt
;

151 
m_round_robš_špÜt
++;

152 ià(
m_round_robš_špÜt
 =ğ
m_š_lšk
.
	`size
())

153 
m_round_robš_špÜt
 = 0;

155 
pÜt_™”
 = 0;…Üt_™” < 
m_š_lšk
.
	`size
();…ort_iter++) {

156 
špÜt
++;

157 ià(
špÜt
 >ğ
m_š_lšk
.
	`size
())

158 
špÜt
 = 0;

159 
švc
 = 
m_round_robš_švc
[
špÜt
];

161 
Ãxt_round_robš_švc
 = 
švc
;

163 
Ãxt_round_robš_švc
++;

165 ià(
Ãxt_round_robš_švc
 >ğ
m_num_vcs
)

166 
Ãxt_round_robš_švc
 = 0;

168 } !(
m_Ãt_±r
->
	`v®idVœtu®N‘wÜk
(

169 
	`g‘_vÃt
(
Ãxt_round_robš_švc
))));

171 
m_round_robš_švc
[
špÜt
] = 
Ãxt_round_robš_švc
;

173 
vc_™”
 = 0; vc_™” < 
m_num_vcs
; vc_iter++) {

174 
švc
++;

175 ià(
švc
 >ğ
m_num_vcs
)

176 
švc
 = 0;

178 ià(!(
m_Ãt_±r
->
	`v®idVœtu®N‘wÜk
(
	`g‘_vÃt
(
švc
))))

181 
InVcS‹
 *
š_vc_¡©e
 = 
m_š_vc_¡©e
[
špÜt
][
švc
];

183 ià(
š_vc_¡©e
->
	`isInS‹
(
VC_AB_
, 
	`curCyşe
())) {

184 
ouÜt
 = 
š_vc_¡©e
->
	`g‘_ouÜt
();

185 
veùÜ
<> 
v®id_vcs
 = 
	`g‘_v®id_vcs
(
švc
);

186 
v®id_vc_™”
 = 0; v®id_vc_™” < 
v®id_vcs
.
	`size
();

187 
v®id_vc_™”
++) {

188 ià(
m_out_vc_¡©e
[
ouÜt
][
v®id_vcs
[
v®id_vc_™”
]]

189 ->
	`isInS‹
(
IDLE_
, 
	`curCyşe
())) {

191 
š_vc_¡©e
->
	`g¿Á_vc
(
v®id_vcs
[
v®id_vc_™”
],

192 
	`curCyşe
());

194 
m_š_lšk
[
špÜt
]->
	`g¿Á_vc_lšk
(
švc
, 
	`curCyşe
());

196 
m_out_vc_¡©e
[
ouÜt
][
v®id_vcs
[
v®id_vc_™”
]]

197 ->
	`£tS‹
(
VC_AB_
, 
	`curCyşe
());

204 
	}
}

206 
	gveùÜ
<>

207 
	gRou‹r
::
	$g‘_v®id_vcs
(
švc
)

209 
veùÜ
<> 
vc_li¡
;

211 
vÃt
 = 0; vÃˆ< 
m_vœtu®_ÃtwÜks
; vnet++) {

212 ià(
švc
 >ğ(
vÃt
*
m_vc_³r_vÃt
) && invc < ((vnet+1)*m_vc_per_vnet)) {

213 
ba£
 = 
vÃt
*
m_vc_³r_vÃt
;

214 
vc_³r_vÃt
;

215 ià(
m_Ãt_±r
->
	`isVN‘Ord”ed
(
vÃt
))

216 
vc_³r_vÃt
 = 1;

218 
vc_³r_vÃt
 = 
m_vc_³r_vÃt
;

220 
off£t
 = 0; off£ˆ< 
vc_³r_vÃt
; offset++) {

221 
vc_li¡
.
	`push_back
(
ba£
+
off£t
);

226  
vc_li¡
;

227 
	}
}

230 
	gRou‹r
::
	$g¿Á_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
g¿Á_time
)

232 
	`as£¹
(
m_out_vc_¡©e
[
out_pÜt
][
vc
]->
	`isInS‹
(
VC_AB_
, 
g¿Á_time
));

233 
m_out_vc_¡©e
[
out_pÜt
][
vc
]->
	`g¿Á_vc
(
g¿Á_time
);

234 
	`scheduËEv’t
(
	`Cyşes
(1));

235 
	}
}

238 
	gRou‹r
::
	$»Ëa£_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
»Ëa£_time
)

240 
	`as£¹
(
m_out_vc_¡©e
[
out_pÜt
][
vc
]->
	`isInS‹
(
ACTIVE_
, 
»Ëa£_time
));

241 
m_out_vc_¡©e
[
out_pÜt
][
vc
]->
	`£tS‹
(
IDLE_
, 
»Ëa£_time
);

242 
	`scheduËEv’t
(
	`Cyşes
(1));

243 
	}
}

247 
	gRou‹r
::
	$g‘Rou‹
(
N‘De¡
 
de¡š©iÚ
)

249 
ouut_lšk
 = -1;

250 
mš_weight
 = 
INFINITE_
;

251 
lšk
 = 0;†šk < 
m_routšg_bË
.
	`size
();†ink++) {

252 ià(
de¡š©iÚ
.
	`š‹r£ùiÚIsNÙEm±y
(
m_routšg_bË
[
lšk
])) {

253 ià((
m_lšk_weights
[
lšk
] >ğ
mš_weight
))

255 
ouut_lšk
 = 
lšk
;

256 
mš_weight
 = 
m_lšk_weights
[
lšk
];

259  
ouut_lšk
;

260 
	}
}

263 
	gRou‹r
::
	$rou‹Compu‹
(
æ™
 *
m_æ™
, 
špÜt
)

265 
švc
 = 
m_æ™
->
	`g‘_vc
();

266 
ouÜt
 = 
m_š_vc_¡©e
[
špÜt
][
švc
]->
	`g‘_ouÜt
();

267 
outvc
 = 
m_š_vc_¡©e
[
špÜt
][
švc
]->
	`g‘_outvc
();

269 
	`as£¹
(
m_Ãt_±r
->
	`g‘NumPeSges
() >= 1);

272 
m_æ™
->
	`£t_time
(
	`curCyşe
(è+ 
	`Cyşes
((
m_Ãt_±r
->
	`g‘NumPeSges
() - 1)));

273 
m_æ™
->
	`£t_vc
(
outvc
);

274 
m_rou‹r_bufãrs
[
ouÜt
][
outvc
]->
	`š£¹
(
m_æ™
);

276 ià(
m_Ãt_±r
->
	`g‘NumPeSges
() > 1)

277 
	`scheduËEv’t
(
	`Cyşes
(
m_Ãt_±r
->
	`g‘NumPeSges
() - 1));

279 ià((
m_æ™
->
	`g‘_ty³
(è=ğ
HEAD_
è|| (m_æ™->g‘_ty³(è=ğ
HEAD_TAIL_
)) {

280 
N‘wÜkMes§ge
 *
nm
 =

281 
§ã_ÿ¡
<
N‘wÜkMes§ge
*>(
m_æ™
->
	`g‘_msg_±r
().
	`g‘
());

282 
N‘De¡
 
de¡š©iÚ
 = 
nm
->
	`g‘IÁ”ÇlDe¡š©iÚ
();

284 ià(
m_Ãt_±r
->
	`g‘NumPeSges
() > 1) {

285 
m_out_vc_¡©e
[
ouÜt
][
outvc
]->
	`£tS‹
(
VC_AB_
, 
	`curCyşe
() +

286 
	`Cyşes
(1));

287 
m_out_lšk
[
ouÜt
]->
	`»que¡_vc_lšk
(
outvc
, 
de¡š©iÚ
,

288 
	`curCyşe
(è+ 
	`Cyşes
(1));

290 
m_out_vc_¡©e
[
ouÜt
][
outvc
]->
	`£tS‹
(
VC_AB_
, 
	`curCyşe
());

291 
m_out_lšk
[
ouÜt
]->
	`»que¡_vc_lšk
(
outvc
, 
de¡š©iÚ
,

292 
	`curCyşe
());

296 ià((
m_æ™
->
	`g‘_ty³
(è=ğ
TAIL_
è|| (m_æ™->g‘_ty³(è=ğ
HEAD_TAIL_
)) {

297 
m_š_vc_¡©e
[
špÜt
][
švc
]->
	`£tS‹
(
IDLE_
, 
	`curCyşe
(è+ 
	`Cyşes
(1));

298 
m_š_lšk
[
špÜt
]->
	`»Ëa£_vc_lšk
(
švc
, 
	`curCyşe
(è+ 
	`Cyşes
(1));

300 
	}
}

303 
	gRou‹r
::
	$wakeup
()

305 
æ™
 *
t_æ™
;

308 
šcomšg_pÜt
 = 
m_round_robš_¡¬t
;

309 
m_round_robš_¡¬t
++;

310 ià(
m_round_robš_¡¬t
 >ğ
m_š_lšk
.
	`size
()) {

311 
m_round_robš_¡¬t
 = 0;

314 
pÜt
 = 0;…Üˆ< 
m_š_lšk
.
	`size
();…ort++) {

316 
šcomšg_pÜt
++;

317 ià(
šcomšg_pÜt
 >ğ
m_š_lšk
.
	`size
())

318 
šcomšg_pÜt
 = 0;

321 ià(
m_š_lšk
[
šcomšg_pÜt
]->
	`isR—dy
()) {

322 
	`DPRINTF
(
RubyN‘wÜk
, "m_id: %d, Time: %Îd\n", 
m_id
, 
	`curCyşe
());

323 
t_æ™
 = 
m_š_lšk
[
šcomšg_pÜt
]->
	`³ekLšk
();

324 
	`rou‹Compu‹
(
t_æ™
, 
šcomšg_pÜt
);

325 
m_š_lšk
[
šcomšg_pÜt
]->
	`cÚsumeLšk
();

328 
	`scheduËOuutLšks
();

329 
	`checkRescheduË
();

330 
	`vc_¬b™¿‹
();

331 
	`check_¬b™”_»scheduË
();

332 
	}
}

335 
	gRou‹r
::
	$scheduËOuutLšks
()

337 
pÜt
 = 0;…Üˆ< 
m_out_lšk
.
	`size
();…ort++) {

338 
vc_tŞook©
 = 
m_vc_round_robš
[
pÜt
];

340 
Ãxt_round_robš_vc_tŞook©
 = 
vc_tŞook©
;

342 
Ãxt_round_robš_vc_tŞook©
++;

344 ià(
Ãxt_round_robš_vc_tŞook©
 =ğ
m_num_vcs
)

345 
Ãxt_round_robš_vc_tŞook©
 = 0;

346 } !(
m_Ãt_±r
->
	`v®idVœtu®N‘wÜk
(

347 
	`g‘_vÃt
(
Ãxt_round_robš_vc_tŞook©
))));

349 
m_vc_round_robš
[
pÜt
] = 
Ãxt_round_robš_vc_tŞook©
;

351 
i
 = 0; i < 
m_num_vcs
; i++) {

352 
vc_tŞook©
++;

353 ià(
vc_tŞook©
 =ğ
m_num_vcs
)

354 
vc_tŞook©
 = 0;

356 ià(
m_rou‹r_bufãrs
[
pÜt
][
vc_tŞook©
]->
	`isR—dy
(
	`curCyşe
())) {

359 ià(
m_out_vc_¡©e
[
pÜt
][
vc_tŞook©
]->
	`isInS‹
(
ACTIVE_
,

360 
	`curCyşe
()) &&

361 
m_out_lšk
[
pÜt
]->
	`isBufãrNÙFuÎ_lšk
(
vc_tŞook©
)) {

363 
æ™
 *
t_æ™
 =

364 
m_rou‹r_bufãrs
[
pÜt
][
vc_tŞook©
]->
	`g‘TİFl™
();

365 
t_æ™
->
	`£t_time
(
	`curCyşe
(è+ 
	`Cyşes
(1));

366 
m_out_¤c_queue
[
pÜt
]->
	`š£¹
(
t_æ™
);

368 
m_out_lšk
[
pÜt
]->

369 
	`scheduËEv’tAbsŞu‹
(
	`şockEdge
(
	`Cyşes
(1)));

375 
	}
}

378 
	gRou‹r
::
	$g‘_vÃt
(
vc
)

380 
vÃt
 = 
vc
/
m_vc_³r_vÃt
;

381 
	`as£¹
(
vÃt
 < 
m_vœtu®_ÃtwÜks
);

382  
vÃt
;

383 
	}
}

386 
	gRou‹r
::
	$checkRescheduË
()

388 
pÜt
 = 0;…Üˆ< 
m_out_lšk
.
	`size
();…ort++) {

389 
vc
 = 0; vø< 
m_num_vcs
; vc++) {

390 ià(
m_rou‹r_bufãrs
[
pÜt
][
vc
]->
	`isR—dyFÜNext
(
	`curCyşe
())) {

391 
	`scheduËEv’t
(
	`Cyşes
(1));

396 
	}
}

399 
	gRou‹r
::
	$check_¬b™”_»scheduË
()

401 
pÜt
 = 0;…Üˆ< 
m_š_lšk
.
	`size
();…ort++) {

402 
vc
 = 0; vø< 
m_num_vcs
; vc++) {

403 ià(
m_š_vc_¡©e
[
pÜt
][
vc
]->
	`isInS‹
(
VC_AB_
, 
	`curCyşe
() +

404 
	`Cyşes
(1))) {

405 
m_vc_¬b™”
->
	`scheduËEv’tAbsŞu‹
(
	`şockEdge
(
	`Cyşes
(1)));

410 
	}
}

412 
boŞ


413 
	gRou‹r
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

416 
i
 = 0; i < 
m_rou‹r_bufãrs
.
	`size
(); i++) {

417 
j
 = 0; j < 
m_rou‹r_bufãrs
[
i
].
	`size
(); ++j) {

418 ià(
m_rou‹r_bufãrs
[
i
][
j
]->
	`funùiÚ®R—d
(
pkt
)) {

419  
Œue
;

425 
i
 = 0; i < 
m_out_¤c_queue
.
	`size
(); i++) {

426 ià(
m_out_¤c_queue
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

427  
Œue
;

430  
çl£
;

431 
	}
}

433 
ušt32_t


434 
	gRou‹r
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

436 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

439 
i
 = 0; i < 
m_rou‹r_bufãrs
.
	`size
(); i++) {

440 
j
 = 0; j < 
m_rou‹r_bufãrs
[
i
].
	`size
(); ++j) {

441 
num_funùiÚ®_wr™es
 +=

442 
m_rou‹r_bufãrs
[
i
][
j
]->
	`funùiÚ®Wr™e
(
pkt
);

447 
i
 = 0; i < 
m_out_¤c_queue
.
	`size
(); i++) {

448 
num_funùiÚ®_wr™es
 +ğ
m_out_¤c_queue
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

451  
num_funùiÚ®_wr™es
;

452 
	}
}

455 
	gRou‹r
::
	$´št
(
o¡»am
& 
out
) const

457 
out
 << "[Router]";

458 
	}
}

460 
Rou‹r
 *

461 
	gG¬ÃtRou‹rP¬ams
::
	$ü—‹
()

463  
Ãw
 
	`Rou‹r
(
this
);

464 
	}
}

	@ruby/network/garnet/flexible-pipeline/Router.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_ROUTER_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_ROUTER_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/N‘De¡.hh
"

38 
	~"mem/ruby/ÃtwÜk/BasicRou‹r.hh
"

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/FËxibËCÚsum”.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/G¬ÃtN‘wÜk.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/InVcS‹.hh
"

42 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/N‘wÜkLšk.hh
"

43 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/OutVcS‹.hh
"

44 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/æ™Bufãr.hh
"

45 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

46 
	~"·¿ms/G¬ÃtRou‹r.hh
"

48 
şass
 
	gVC¬b™”
;

50 
şass
 
	gRou‹r
 : 
public
 
BasicRou‹r
,…ubliø
	gFËxibËCÚsum”


52 
	gpublic
:

53 
G¬ÃtRou‹rP¬ams
 
	tP¬ams
;

54 
Rou‹r
(cÚ¡ 
P¬ams
 *
p
);

56 ~
Rou‹r
();

58 
addInPÜt
(
N‘wÜkLšk
 *
š_lšk
);

59 
addOutPÜt
(
N‘wÜkLšk
 *
out_lšk
, cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
,

60 
lšk_weight
);

61 
wakeup
();

62 
»que¡_vc
(
š_vc
, 
š_pÜt
, 
N‘De¡
 
de¡š©iÚ
,

63 
Cyşes
 
»que¡_time
);

64 
boŞ
 
isBufãrNÙFuÎ
(
vc
, 
špÜt
);

65 
g¿Á_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
g¿Á_time
);

66 
»Ëa£_vc
(
out_pÜt
, 
vc
, 
Cyşes
 
»Ëa£_time
);

67 
vc_¬b™¿‹
();

68 
g‘_vÃt
(
vc
);

70 
´št
(
¡d
::
o¡»am
& 
out
) const;

72 
š™_Ãt_±r
(
G¬ÃtN‘wÜk
* 
Ãt_±r
)

74 
	gm_Ãt_±r
 = 
Ãt_±r
;

77 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *);

78 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *);

80 
	g´iv©e
:

81 
m_vœtu®_ÃtwÜks
, 
	gm_num_vcs
, 
	gm_vc_³r_vÃt
;

82 
G¬ÃtN‘wÜk
 *
	gm_Ãt_±r
;

83 
	g¡d
::
veùÜ
<> 
m_vc_round_robš
;

84 
	gm_round_robš_špÜt
, 
	gm_round_robš_¡¬t
;

85 
	g¡d
::
veùÜ
<> 
m_round_robš_švc
;

88 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
æ™Bufãr
 *> > 
m_rou‹r_bufãrs
;

91 
	g¡d
::
veùÜ
<
æ™Bufãr
 *> 
m_out_¤c_queue
;

93 
	g¡d
::
veùÜ
<
N‘wÜkLšk
 *> 
m_š_lšk
;

94 
	g¡d
::
veùÜ
<
N‘wÜkLšk
 *> 
m_out_lšk
;

95 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
InVcS‹
 *> > 
m_š_vc_¡©e
;

96 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
OutVcS‹
 *> > 
m_out_vc_¡©e
;

97 
	g¡d
::
veùÜ
<
N‘De¡
> 
m_routšg_bË
;

98 
	g¡d
::
veùÜ
<> 
m_lšk_weights
;

99 
VC¬b™”
 *
	gm_vc_¬b™”
;

101 
g‘Rou‹
(
N‘De¡
 
de¡š©iÚ
);

102 
	g¡d
::
veùÜ
<> 
g‘_v®id_vcs
(
švc
);

103 
rou‹Compu‹
(
æ™
 *
m_æ™
, 
špÜt
);

104 
checkRescheduË
();

105 
check_¬b™”_»scheduË
();

106 
scheduËOuutLšks
();

	@ruby/network/garnet/flexible-pipeline/VCarbiter.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/Rou‹r.hh
"

32 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/VC¬b™”.hh
"

34 
	gVC¬b™”
::
	$VC¬b™”
(
Rou‹r
 *
rou‹r
)

35 : 
	$CÚsum”
(
rou‹r
)

37 
m_rou‹r
 = 
rou‹r
;

38 
	}
}

41 
	gVC¬b™”
::
	$wakeup
()

43 
m_rou‹r
->
	`vc_¬b™¿‹
();

44 
	}
}

	@ruby/network/garnet/flexible-pipeline/VCarbiter.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_VC_ARBITER_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_VC_ARBITER_HH__


	)

34 
	~<io¡»am
>

36 
	~"mem/ruby/commÚ/CÚsum”.hh
"

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

39 
şass
 
	gRou‹r
;

41 şas 
	cVC¬b™”
 : 
public
 
CÚsum”


43 
public
:

44 
VC¬b™”
(
Rou‹r
 *
rou‹r
);

45 ~
	$VC¬b™”
() {}

47 
	`´št
(
¡d
::
o¡»am
& 
out
ècÚ¡ {
	}
}

48 
wakeup
();

50 
	g´iv©e
:

51 
Rou‹r
 *
m_rou‹r
;

	@ruby/network/garnet/flexible-pipeline/flit.cc

31 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/æ™.hh
"

33 
	gæ™
::
	$æ™
(
id
, 
vc
, 
vÃt
, 
size
, 
MsgPŒ
 
msg_±r
, 
Cyşes
 
curTime
)

35 
m_size
 = 
size
;

36 
m_msg_±r
 = 
msg_±r
;

37 
m_’queue_time
 = 
curTime
;

38 
m_time
 = 
curTime
;

39 
m_id
 = 
id
;

40 
m_vÃt
 = 
vÃt
;

41 
m_vc
 = 
vc
;

43 ià(
size
 == 1) {

44 
m_ty³
 = 
HEAD_TAIL_
;

47 ià(
id
 == 0)

48 
m_ty³
 = 
HEAD_
;

49 ià(
id
 =ğ(
size
 - 1))

50 
m_ty³
 = 
TAIL_
;

52 
m_ty³
 = 
BODY_
;

53 
	}
}

56 
	gæ™
::
	$g‘_size
()

58  
m_size
;

59 
	}
}

62 
	gæ™
::
	$g‘_id
()

64  
m_id
;

65 
	}
}

67 
Cyşes


68 
	gæ™
::
	$g‘_time
()

70  
m_time
;

71 
	}
}

73 
Cyşes


74 
	gæ™
::
	$g‘_’queue_time
()

76  
m_’queue_time
;

77 
	}
}

80 
	gæ™
::
	$£t_time
(
Cyşes
 
time
)

82 
m_time
 = 
time
;

83 
	}
}

86 
	gæ™
::
	$g‘_vÃt
()

88  
m_vÃt
;

89 
	}
}

92 
	gæ™
::
	$g‘_vc
()

94  
m_vc
;

95 
	}
}

98 
	gæ™
::
	$£t_vc
(
vc
)

100 
m_vc
 = 
vc
;

101 
	}
}

103 
	gMsgPŒ
&

104 
	gæ™
::
	$g‘_msg_±r
()

106  
m_msg_±r
;

107 
	}
}

109 
æ™_ty³


110 
	gæ™
::
	$g‘_ty³
()

112  
m_ty³
;

113 
	}
}

116 
	gæ™
::
	$£t_d–ay
(
Cyşes
 
d–ay
)

118 
¤c_d–ay
 = 
d–ay
;

119 
	}
}

121 
Cyşes


122 
	gæ™
::
	$g‘_d–ay
()

124  
¤c_d–ay
;

125 
	}
}

128 
	gæ™
::
´št
(
¡d
::
o¡»am
& 
out
) const

130 
out
 << "[flit:: ";

131 
	gout
 << "Id=" << 
	gm_id
 << " ";

132 
	gout
 << "Ty³=" << 
	gm_ty³
 << " ";

133 
	gout
 << "VÃt=" << 
	gm_vÃt
 << " ";

134 
	gout
 << "VC=" << 
	gm_vc
 << " ";

135 
	gout
 << "EnqueuTime=" << 
	gm_’queue_time
 << " ";

136 
	gout
 << "]";

139 
boŞ


140 
	gæ™
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

142 
Mes§ge
 *
msg
 = 
m_msg_±r
.
	`g‘
();

143  
msg
->
	`funùiÚ®R—d
(
pkt
);

144 
	}
}

146 
boŞ


147 
	gæ™
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

149 
Mes§ge
 *
msg
 = 
m_msg_±r
.
	`g‘
();

150  
msg
->
	`funùiÚ®Wr™e
(
pkt
);

151 
	}
}

	@ruby/network/garnet/flexible-pipeline/flit.hh

31 
	~<ÿs£¹
>

32 
	~<io¡»am
>

34 
	~"ba£/ty³s.hh
"

35 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

36 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

38 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_FLIT_HH__


39 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_FLIT_HH__


	)

41 şas 
	cæ™


43 
	mpublic
:

44 
æ™
(
id
, 
vc
, 
vÃt
, 
size
, 
MsgPŒ
 
msg_±r
, 
Cyşes
 
curTime
);

46 
g‘_size
();

47 
g‘_id
();

48 
Cyşes
 
g‘_time
();

49 
Cyşes
 
g‘_’queue_time
();

50 
£t_time
(
Cyşes
 
time
);

51 
g‘_vÃt
();

52 
g‘_vc
();

53 
£t_vc
(
vc
);

54 
	mMsgPŒ
& 
g‘_msg_±r
();

55 
æ™_ty³
 
g‘_ty³
();

56 
£t_d–ay
(
Cyşes
 
d–ay
);

57 
Cyşes
 
g‘_d–ay
();

58 
´št
(
¡d
::
o¡»am
& 
out
) const;

60 
boŞ


61 
	$g»©”
(
æ™
* 
n1
, fl™* 
n2
)

63 ià(
n1
->
	`g‘_time
(è=ğ
n2
->get_time())

65  (
n1
->
	`g‘_id
(è> 
n2
->get_id());

67  (
n1
->
	`g‘_time
(è> 
n2
->get_time());

70 
boŞ
 
	`funùiÚ®R—d
(
Pack‘
 *
pkt
);

71 
boŞ
 
	`funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

73 
´iv©e
:

74 
m_id
;

75 
m_vÃt
;

76 
m_vc
;

77 
m_size
;

78 
Cyşes
 
m_’queue_time
, 
m_time
;

79 
æ™_ty³
 
m_ty³
;

80 
MsgPŒ
 
m_msg_±r
;

81 
Cyşes
 
¤c_d–ay
;

82 
	}
};

84 
šlše
 
	g¡d
::
o¡»am
&

85 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gæ™
& 
	gobj
)

87 
	gobj
.
´št
(
out
);

88 
	gout
 << 
	g¡d
::
æush
;

89  
	gout
;

	@ruby/network/garnet/flexible-pipeline/flitBuffer.cc

31 
	~<®gÜ™hm
>

33 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/æ™Bufãr.hh
"

35 
usšg
 
Çme¥aû
 
	g¡d
;

37 
	gæ™Bufãr
::
	$æ™Bufãr
()

39 
max_size
 = 
INFINITE_
;

40 
	}
}

42 
	gæ™Bufãr
::
	$æ™Bufãr
(
maximum_size
)

44 
max_size
 = 
maximum_size
;

45 
	}
}

47 
boŞ


48 
	gæ™Bufãr
::
	$isEm±y
()

50  (
m_bufãr
.
	`size
() == 0);

51 
	}
}

53 
boŞ


54 
	gæ™Bufãr
::
	$isR—dy
(
Cyşes
 
curTime
)

56 ià(
m_bufãr
.
	`size
() != 0 ) {

57 
æ™
 *
t_æ™
 = 
m_bufãr
.
	`äÚt
();

58 ià(
t_æ™
->
	`g‘_time
(è<ğ
curTime
)

59  
Œue
;

61  
çl£
;

62 
	}
}

64 
boŞ


65 
	gæ™Bufãr
::
	$isR—dyFÜNext
(
Cyşes
 
curTime
)

67 ià(
m_bufãr
.
	`size
() != 0 ) {

68 
æ™
 *
t_æ™
 = 
m_bufãr
.
	`äÚt
();

69 ià(
t_æ™
->
	`g‘_time
(è<ğ(
curTime
 + 1))

70  
Œue
;

72  
çl£
;

73 
	}
}

75 
boŞ


76 
	gæ™Bufãr
::
	$isFuÎ
()

78  (
m_bufãr
.
	`size
(è>ğ
max_size
);

79 
	}
}

82 
	gæ™Bufãr
::
	$£tMaxSize
(
maximum
)

84 
max_size
 = 
maximum
;

85 
	}
}

87 
æ™
*

88 
	gæ™Bufãr
:: 
	$g‘TİFl™
()

90 
æ™
 *
f
 = 
m_bufãr
.
	`äÚt
();

91 
	`pİ_h—p
(
m_bufãr
.
	`begš
(), m_bufãr.
	`’d
(), 
æ™
::
g»©”
);

92 
m_bufãr
.
	`pİ_back
();

93  
f
;

94 
	}
}

96 
æ™
*

97 
	gæ™Bufãr
::
	$³ekTİFl™
()

99  
m_bufãr
.
	`äÚt
();

100 
	}
}

103 
	gæ™Bufãr
::
	$š£¹
(
æ™
 *
æt
)

105 
m_bufãr
.
	`push_back
(
æt
);

106 
	`push_h—p
(
m_bufãr
.
	`begš
(), m_bufãr.
	`’d
(), 
æ™
::
g»©”
);

107 
	}
}

110 
	gæ™Bufãr
::
´št
(
¡d
::
o¡»am
& 
out
) const

112 
out
 << "[flitBuffer: ";

113 
	gout
 << 
	gm_bufãr
.
size
(è<< "] " << 
	g¡d
::
’dl
;

116 
boŞ


117 
	gæ™Bufãr
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

119 
i
 = 0; i < 
m_bufãr
.
	`size
(); ++i) {

120 ià(
m_bufãr
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

121  
Œue
;

124  
çl£
;

125 
	}
}

127 
ušt32_t


128 
	gæ™Bufãr
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

130 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

132 
i
 = 0; i < 
m_bufãr
.
	`size
(); ++i) {

133 ià(
m_bufãr
[
i
]->
	`funùiÚ®Wr™e
(
pkt
)) {

134 
num_funùiÚ®_wr™es
++;

137  
num_funùiÚ®_wr™es
;

138 
	}
}

	@ruby/network/garnet/flexible-pipeline/flitBuffer.hh

31 #iâdeà
__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_FLIT_BUFFER_HH__


32 
	#__MEM_RUBY_NETWORK_GARNET_FLEXIBLE_PIPELINE_FLIT_BUFFER_HH__


	)

34 
	~<io¡»am
>

35 
	~<veùÜ
>

37 
	~"mem/ruby/ÃtwÜk/g¬Ãt/æexibË-p–še/æ™.hh
"

38 
	~"mem/ruby/ÃtwÜk/g¬Ãt/N‘wÜkH—d”.hh
"

40 şas 
	cæ™Bufãr


42 
	mpublic
:

43 
æ™Bufãr
();

44 
æ™Bufãr
(
maximum_size
);

46 
boŞ
 
isR—dy
(
Cyşes
 
curTime
);

47 
boŞ
 
isR—dyFÜNext
(
Cyşes
 
curTime
);

48 
boŞ
 
isFuÎ
();

49 
boŞ
 
isEm±y
();

50 
£tMaxSize
(
maximum
);

51 
æ™
 *
g‘TİFl™
();

52 
æ™
 *
³ekTİFl™
();

53 
š£¹
(
æ™
 *
æt
);

54 
´št
(
¡d
::
o¡»am
& 
out
) const;

56 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *);

57 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *);

59 
	m´iv©e
:

60 
¡d
::
veùÜ
<
æ™
 *> 
m_bufãr
;

61 
	mmax_size
;

64 
šlše
 
	g¡d
::
o¡»am
&

65 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gæ™Bufãr
& 
	gobj
)

67 
	gobj
.
´št
(
out
);

68 
	gout
 << 
	g¡d
::
æush
;

69  
	gout
;

	@ruby/network/orion/Allocator/Arbiter.cc

36 
	~<ÿs£¹
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/Arb™”.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/M©rixArb™”.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/RRArb™”.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

44 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gArb™”
::
	$Arb™”
(cÚ¡ 
Arb™”Mod–
 
¬b_mod–_
,

47 cÚ¡ 
ušt32_t
 
»q_width_
,

48 cÚ¡ 
Ën_š_wœe_
,

49 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_
)

51 
	`as£¹
(
»q_width_
 ==„eq_width_);

52 
	`as£¹
(
Ën_š_wœe_
 ==†en_in_wire_);

54 
m_¬b_mod–
 = 
¬b_mod–_
;

55 
m_»q_width
 = 
»q_width_
;

56 
m_Ën_š_wœe
 = 
Ën_š_wœe_
;

57 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

58 
	}
}

60 
	gArb™”
::~
	$Arb™”
()

61 {
	}
}

64 
Arb™”
::
	$g‘_¡©ic_pow”
() const

66 
vdd
 = 
m_‹ch_·¿m_±r
->
	`g‘_vdd
();

67 
SCALE_S
 = 
m_‹ch_·¿m_±r
->
	`g‘_SCALE_S
();

69  
m_i_¡©ic
*
vdd
*
SCALE_S
;

70 
	}
}

72 
Arb™”
*

73 
	gArb™”
::
	$ü—‹_¬b™”
(cÚ¡ 
¡ršg
& 
¬b_mod–_¡r_
,

74 cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
,

75 
ušt32_t
 
»q_width_
,

76 
Ën_š_wœe_
,

77 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_
)

79 ià(
¬b_mod–_¡r_
 =ğ
	`¡ršg
("RR_ARBITER")) {

81  
Ãw
 
	`RRArb™”
(
ff_mod–_¡r_
, 
»q_width_
,

82 
Ën_š_wœe_
, 
‹ch_·¿m_±r_
);

84 } ià(
¬b_mod–_¡r_
 =ğ
	`¡ršg
("MATRIX_ARBITER")) {

86  
Ãw
 
	`M©rixArb™”
(
ff_mod–_¡r_
, 
»q_width_
,

87 
Ën_š_wœe_
, 
‹ch_·¿m_±r_
);

90 
û¼
 << "WARNING: NØArb™” mod–" << 
’dl
;

91  (
Arb™”
*)
NULL
;

93 
	}
}

	@ruby/network/orion/Allocator/Arbiter.hh

36 #iâdeà
__ARBITER_H__


37 
	#__ARBITER_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

42 
şass
 
	gFlFlİ
;

44 şas 
	cArb™”


46 
	mpublic
:

47 
	eArb™”Mod–


49 
NO_MODEL
 = 0,

50 
	mRR_ARBITER
,

51 
	mMATRIX_ARBITER


54 
	gpublic
:

55 
Arb™”
(cÚ¡ 
Arb™”Mod–
 
¬b_mod–_
,

56 cÚ¡ 
ušt32_t
 
»q_width_
,

57 cÚ¡ 
Ën_š_wœe_
,

58 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_
);

59 
	gvœtu®
 ~
Arb™”
() = 0;

61 
	gpublic
:

62 
vœtu®
 
	$ÿlc_dyÇmic_’”gy
(
num_»q_
, 
boŞ
 
is_max_
) const = 0;

63 
	$g‘_¡©ic_pow”
() const;

65 
´Ùeùed
:

66 
Arb™”Mod–
 
m_¬b_mod–
;

67 
ušt32_t
 
m_»q_width
;

68 
m_Ën_š_wœe
;

69 cÚ¡ 
TechP¬am‘”
* 
m_‹ch_·¿m_±r
;

71 
FlFlİ
* 
m_ff_±r
;

73 
m_e_chg_»q
;

74 
m_e_chg_g¿Á
;

76 
m_i_¡©ic
;

78 
public
:

79 
Arb™”
* 
	`ü—‹_¬b™”
(cÚ¡ 
¡ršg
& 
¬b_mod–_¡r_
,

80 cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
,

81 
ušt32_t
 
»q_width_
,

82 
Ën_š_wœe_
,

83 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_
);

84 
	}
};

	@ruby/network/orion/Allocator/MatrixArbiter.cc

36 
	~<ÿs£¹
>

37 
	~<cm©h
>

38 
	~<io¡»am
>

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/M©rixArb™”.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/FlFlİ.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

44 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gM©rixArb™”
::
	$M©rixArb™”
(cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
,

47 
ušt32_t
 
»q_width_
,

48 
Ën_š_wœe_
,

49 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_
)

50 : 
	$Arb™”
(
RR_ARBITER
, 
»q_width_
, 
Ën_š_wœe_
, 
‹ch_·¿m_±r_
)

52 
	`š™
(
ff_mod–_¡r_
);

53 
	}
}

55 
	gM©rixArb™”
::~
	$M©rixArb™”
()

57 
d–‘e
 
m_ff_±r
;

58 
	}
}

61 
	gM©rixArb™”
::
	$ÿlc_dyÇmic_’”gy
(
num_»q_
, 
boŞ
 
is_max_
) const

63 
	`as£¹
(
num_»q_
 < 
m_»q_width
);

65 
num_g¿Á
;

66 ià(
num_»q_
 >ğ1è
num_g¿Á
 = 1;

67 ià(
num_»q_
è
num_g¿Á
 = 1.0 / 
	`û
(1.0 /‚um_req_);

68 
num_g¿Á
 = 0;

70 
ušt32_t
 
tÙ®_´i
 = 
m_»q_width
 * (m_req_width - 1) / 2;

71 
num_chg_´i
 = (
m_»q_width
 - 1è* (
is_max_
? 1 : 0.5);

73 
e_©omic
;

74 
e_¬b
 = 0;

77 
e_©omic
 = 
m_e_chg_»q
 * 
num_»q_
;

78 
e_¬b
 +ğ
e_©omic
;

80 
e_©omic
 = 
m_e_chg_g¿Á
 * 
num_g¿Á
;

81 
e_¬b
 +ğ
e_©omic
;

84 
e_©omic
 = 
m_ff_±r
->
	`g‘_e_sw™ch
(è* 
num_chg_´i
 * 
num_g¿Á
;

85 
e_¬b
 +ğ
e_©omic
;

88 ià((
m_ff_±r
->
	`g‘_e_k“p_0
(è>ğm_ff_±r->
	`g‘_e_k“p_1
()è|| (!
is_max_
))

90 
e_©omic
 = 
m_ff_±r
->
	`g‘_e_k“p_0
();

91 
e_©omic
 *ğ(
tÙ®_´i
 - 
num_chg_´i
 * 
num_g¿Á
è* (
is_max_
? 1 : 0.5);

92 
e_¬b
 +ğ
e_©omic
;

94 ià((
m_ff_±r
->
	`g‘_e_k“p_0
(è< m_ff_±r->
	`g‘_e_k“p_1
()è|| (!
is_max_
))

96 
e_©omic
 = 
m_ff_±r
->
	`g‘_e_k“p_1
();

97 
e_©omic
 *ğ(
tÙ®_´i
 - 
num_chg_´i
 * 
num_g¿Á
è* (
is_max_
? 1 : 0.5);

98 
e_¬b
 +ğ
e_©omic
;

101 
e_©omic
 = 
m_ff_±r
->
	`g‘_e_şock
()*
tÙ®_´i
;

102 
e_¬b
 +ğ
e_©omic
;

105 ià(
is_max_
)

107 
e_©omic
 = 
m_e_chg_št
;

108 
e_©omic
 *ğ(
	`mš
(
num_»q_
, 
m_»q_width
 * 0.5) + 2) * (m_req_width - 1);

112 
e_©omic
 = 
m_e_chg_št
 * (
num_»q_
 + 1è* (
m_»q_width
 - 1) * 0.5;

114 
e_¬b
 +ğ
e_©omic
;

116  
e_¬b
;

117 
	}
}

119 
	gM©rixArb™”
::
	$š™
(cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
)

121 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

123 
m_e_chg_»q
 = 
	`ÿlc_»q_ÿp
(è/ 2 * 
e_çùÜ
;

125 
m_e_chg_g¿Á
 = 
	`ÿlc_g¿Á_ÿp
(è* 
e_çùÜ
;

126 
m_e_chg_št
 = 
	`ÿlc_št_ÿp
(è/ 2 * 
e_çùÜ
;

128 
ff_lßd
 = 
	`ÿlc_´i_ÿp
();

129 
m_ff_±r
 = 
Ãw
 
	`FlFlİ
(
ff_mod–_¡r_
, 
ff_lßd
, 
m_‹ch_·¿m_±r
);

131 
m_i_¡©ic
 = 
	`ÿlc_i_¡©ic
();

133 
	}
}

137 
	gM©rixArb™”
::
	$ÿlc_»q_ÿp
()

139 
tÙ®_ÿp
 = 0;

143 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

144 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

145 
g©eÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 0);

146 
tÙ®_ÿp
 +ğ(
m_»q_width
 - 1è* 
g©eÿp
;

150 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

151 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

152 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdecšvn
,

153 
TechP¬am‘”
::
NCH
, 1)

154 + 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdecšvp
, 
TechP¬am‘”
::
PCH
, 1)

155 + 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
Wdecšvn
+
Wdecšvp
, 0);

159 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
 + 
WdecNORp
, 0);

162 
Cm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_Cm‘®
();

163 
tÙ®_ÿp
 +ğ
m_Ën_š_wœe
 * 
Cm‘®
;

165  
tÙ®_ÿp
;

166 
	}
}

169 
	gM©rixArb™”
::
	$ÿlc_´i_ÿp
()

171 
tÙ®_ÿp
 = 0;

175 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

176 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

177 
tÙ®_ÿp
 +ğ2 * 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 0);

179  
tÙ®_ÿp
;

180 
	}
}

183 
	gM©rixArb™”
::
	$ÿlc_g¿Á_ÿp
()

185 
tÙ®_ÿp
 = 0;

189 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

190 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

191 
d¿šÿp1
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORn
,

192 
TechP¬am‘”
::
NCH
, 1);

194 
d¿šÿp2
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORp
,

195 
TechP¬am‘”
::
PCH
,

196 
m_»q_width
);

198 
tÙ®_ÿp
 +ğ
m_»q_width
 * (
d¿šÿp1
 + 
d¿šÿp2
);

200  
tÙ®_ÿp
;

201 
	}
}

204 
	gM©rixArb™”
::
	$ÿlc_št_ÿp
()

206 
tÙ®_ÿp
 = 0;

208 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

209 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

212 
tÙ®_ÿp
 +ğ2 * 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORn
,

213 
TechP¬am‘”
::
NCH
, 1)

214 + 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORp
, 
TechP¬am‘”
::
PCH
, 2);

218 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
 + 
WdecNORp
, 0);

220  
tÙ®_ÿp
;

221 
	}
}

223 
	gM©rixArb™”
::
	$ÿlc_i_¡©ic
()

225 
i_¡©ic
 = 0;

227 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

228 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

229 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

230 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

231 
Wdff
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdff
();

232 
NOR2_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(0);

233 
NOR2_TAB_1
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(1);

234 
NOR2_TAB_2
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(2);

235 
NOR2_TAB_3
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(3);

236 
NMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NMOS_TAB
(0);

237 
PMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_PMOS_TAB
(0);

238 
DFF_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_DFF_TAB
(0);

241 
i_¡©ic
 +ğ((2 * 
m_»q_width
 - 1) * m_req_width *

242 ((
WdecNORp
 * 
NOR2_TAB_0
 + 
WdecNORn
 *

243 (
NOR2_TAB_1
 + 
NOR2_TAB_2
 + 
NOR2_TAB_3
)) / 4));

245 
i_¡©ic
 +ğ
m_»q_width
 *

246 ((
Wdecšvn
 * 
NMOS_TAB_0
 + 
Wdecšvp
 * 
PMOS_TAB_0
) / 2);

248 
i_¡©ic
 +ğ(
m_»q_width
 * (m_»q_width - 1è/ 2è* 
Wdff
 * 
DFF_TAB_0
;

250  
i_¡©ic
;

251 
	}
}

	@ruby/network/orion/Allocator/MatrixArbiter.hh

36 #iâdeà
__MATRIXARBITER_H__


37 
	#__MATRIXARBITER_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/Arb™”.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cM©rixArb™”
 : 
public
 
Arb™”


46 
public
:

47 
M©rixArb™”
(

48 cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
,

49 
ušt32_t
 
»q_width_
,

50 
Ën_š_wœe_
,

51 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


53 ~
M©rixArb™”
();

55 
	mpublic
:

56 
	$ÿlc_dyÇmic_’”gy
(
num_»q_
, 
boŞ
 
is_max_
) const;

58 
´iv©e
:

59 
	`š™
(cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
);

60 
	`ÿlc_»q_ÿp
();

61 
	`ÿlc_´i_ÿp
();

62 
	`ÿlc_g¿Á_ÿp
();

63 
	`ÿlc_št_ÿp
();

64 
	`ÿlc_i_¡©ic
();

66 
´iv©e
:

67 
m_e_chg_št
;

	@ruby/network/orion/Allocator/RRArbiter.cc

36 
	~<cm©h
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/RRArb™”.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/FlFlİ.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

43 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	gRRArb™”
::
	$RRArb™”
(

46 cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
,

47 
ušt32_t
 
»q_width_
,

48 
Ën_š_wœe_
,

49 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


50 è: 
	$Arb™”
(
RR_ARBITER
, 
»q_width_
, 
Ën_š_wœe_
, 
‹ch_·¿m_±r_
)

52 
	`š™
(
ff_mod–_¡r_
);

53 
	}
}

55 
	gRRArb™”
::~
	$RRArb™”
()

57 
d–‘e
 
m_ff_±r
;

58 
	}
}

60 
	gRRArb™”
::
	$ÿlc_dyÇmic_’”gy
(
num_»q_
, 
boŞ
 
is_max_
) const

62 ià(
num_»q_
 > 
m_»q_width
)

64 
û¼
 << "WARNING: (num_»q_ > m_»q_width). S‘‚um_»q_ = m_»q_width" << 
’dl
;

65 
num_»q_
 = 
m_»q_width
;

68 
num_g¿Á
;

69 ià(
num_»q_
 >ğ1è
num_g¿Á
 = 1;

70 ià(
num_»q_
è
num_g¿Á
 = 1.0 / 
	`û
(1.0/num_req_);

71 
num_g¿Á
 = 0;

73 
e_©omic
;

74 
e_¬b
 = 0;

76 
e_©omic
 = 
m_e_chg_»q
*
num_»q_
;

77 
e_¬b
 +ğ
e_©omic
;

79 
e_©omic
 = 
m_e_chg_g¿Á
*
num_g¿Á
;

80 
e_¬b
 +ğ
e_©omic
;

84 
e_©omic
 = 
m_e_chg_ÿ¼y
*
m_»q_width
*(
is_max_
? 1:0.5)*
num_g¿Á
;

85 
e_¬b
 +ğ
e_©omic
;

87 
e_©omic
 = 
m_e_chg_ÿ¼y_š
*(
m_»q_width
*(
is_max_
? 1:0.5)-1)*
num_g¿Á
;

88 
e_¬b
 +ğ
e_©omic
;

91 
e_©omic
 = 
m_ff_±r
->
	`g‘_e_sw™ch
()*2*
num_g¿Á
;

92 
e_¬b
 +ğ
e_©omic
;

94 
e_©omic
 = 
m_ff_±r
->
	`g‘_e_k“p_0
()*(
m_»q_width
-2*
num_g¿Á
);

95 
e_¬b
 +ğ
e_©omic
;

97 
e_©omic
 = 
m_ff_±r
->
	`g‘_e_şock
()*
m_»q_width
;

98 
e_¬b
 +ğ
e_©omic
;

100  
e_¬b
;

101 
	}
}

103 
	gRRArb™”
::
	$š™
(cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
)

105 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

107 
m_e_chg_»q
 = 
	`ÿlc_»q_ÿp
()/2*
e_çùÜ
;

109 
m_e_chg_g¿Á
 = 
	`ÿlc_g¿Á_ÿp
()*
e_çùÜ
;

110 
m_e_chg_ÿ¼y
 = 
	`ÿlc_ÿ¼y_ÿp
()/2*
e_çùÜ
;

111 
m_e_chg_ÿ¼y_š
 = 
	`ÿlc_ÿ¼y_š_ÿp
()/2*
e_çùÜ
;

113 
ff_lßd
 = 
	`ÿlc_´i_ÿp
();

114 
m_ff_±r
 = 
Ãw
 
	`FlFlİ
(
ff_mod–_¡r_
, 
ff_lßd
, 
m_‹ch_·¿m_±r
);

116 
m_i_¡©ic
 = 
	`ÿlc_i_¡©ic
();

118 
	}
}

121 
	gRRArb™”
::
	$ÿlc_»q_ÿp
()

123 
tÙ®_ÿp
 = 0;

127 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

128 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

129 
tÙ®_ÿp
 +ğ2*
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 0);

133 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

134 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

135 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdecšvn
, 
TechP¬am‘”
::
NCH
, 1)

136 + 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdecšvp
, 
TechP¬am‘”
::
PCH
, 1)

137 + 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
Wdecšvn
+
Wdecšvp
, 0);

140 
Cm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_Cm‘®
();

141 
tÙ®_ÿp
 +ğ
m_Ën_š_wœe
*
Cm‘®
;

143  
tÙ®_ÿp
;

144 
	}
}

147 
	gRRArb™”
::
	$ÿlc_´i_ÿp
()

149 
tÙ®_ÿp
 = 0;

153 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

154 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

155 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 0);

157  
tÙ®_ÿp
;

158 
	}
}

161 
	gRRArb™”
::
	$ÿlc_g¿Á_ÿp
()

163 
tÙ®_ÿp
 = 0;

167 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

168 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

169 
tÙ®_ÿp
 +ğ2*
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORn
, 
TechP¬am‘”
::
NCH
, 1)

170 + 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORp
, 
TechP¬am‘”
::
PCH
, 2);

172  
tÙ®_ÿp
;

173 
	}
}

176 
	gRRArb™”
::
	$ÿlc_ÿ¼y_ÿp
()

178 
tÙ®_ÿp
 = 0;

180 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

181 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

184 
tÙ®_ÿp
 +ğ2*
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORn
, 
TechP¬am‘”
::
NCH
, 1)

185 + 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORp
, 
TechP¬am‘”
::
PCH
, 2);

189 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 0);

191  
tÙ®_ÿp
;

192 
	}
}

195 
	gRRArb™”
::
	$ÿlc_ÿ¼y_š_ÿp
()

197 
tÙ®_ÿp
 = 0;

199 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

200 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

203 
tÙ®_ÿp
 +ğ2*
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 0);

207 
tÙ®_ÿp
 +ğ2*
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORn
, 
TechP¬am‘”
::
NCH
, 1)

208 + 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORp
, 
TechP¬am‘”
::
PCH
, 2);

210  
tÙ®_ÿp
;

211 
	}
}

213 
	gRRArb™”
::
	$ÿlc_i_¡©ic
()

215 
i_¡©ic
 = 0;

217 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

218 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

219 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

220 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

221 
Wdff
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdff
();

222 
NOR2_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(0);

223 
NOR2_TAB_1
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(1);

224 
NOR2_TAB_2
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(2);

225 
NOR2_TAB_3
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(3);

226 
NMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NMOS_TAB
(0);

227 
PMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_PMOS_TAB
(0);

228 
DFF_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_DFF_TAB
(0);

231 
i_¡©ic
 +ğ(6*
m_»q_width
*((
WdecNORp
*
NOR2_TAB_0
+
WdecNORn
*(
NOR2_TAB_1
+
NOR2_TAB_2
+
NOR2_TAB_3
))/4));

233 
i_¡©ic
 +ğ2*
m_»q_width
*((
Wdecšvn
*
NMOS_TAB_0
+
Wdecšvp
*
PMOS_TAB_0
)/2);

235 
i_¡©ic
 +ğ
m_»q_width
*
Wdff
*
DFF_TAB_0
;

237  
i_¡©ic
;

238 
	}
}

	@ruby/network/orion/Allocator/RRArbiter.hh

36 #iâdeà
__RRARBITER_H__


37 
	#__RRARBITER_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/Arb™”.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cRRArb™”
 : 
public
 
Arb™”


46 
public
:

47 
RRArb™”
(

48 cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
,

49 
ušt32_t
 
»q_width_
,

50 
Ën_š_wœe_
,

51 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


53 ~
RRArb™”
();

55 
	mpublic
:

56 
	$ÿlc_dyÇmic_’”gy
(
num_»q_
, 
boŞ
 
is_max_
) const;

58 
´iv©e
:

59 
	`š™
(cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
);

60 
	`ÿlc_»q_ÿp
();

61 
	`ÿlc_´i_ÿp
();

62 
	`ÿlc_g¿Á_ÿp
();

63 
	`ÿlc_ÿ¼y_ÿp
();

64 
	`ÿlc_ÿ¼y_š_ÿp
();

65 
	`ÿlc_i_¡©ic
();

67 
´iv©e
:

68 
m_e_chg_ÿ¼y
;

69 
m_e_chg_ÿ¼y_š
;

	@ruby/network/orion/Allocator/SWAllocator.cc

36 
	~<ÿs£¹
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/Arb™”.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/SWAÎoÿtÜ.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/Crossb¬.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

44 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gSWAÎoÿtÜ
::
	$SWAÎoÿtÜ
(

47 
ušt32_t
 
num_š_pÜt_
,

48 
ušt32_t
 
num_out_pÜt_
,

49 
ušt32_t
 
num_vşass_
,

50 
ušt32_t
 
num_vchªÃl_
,

51 
Ën_š_wœe_
,

52 cÚ¡ 
¡ršg
& 
loÿl_¬b_mod–_¡r_
,

53 cÚ¡ 
¡ršg
& 
loÿl_¬b_ff_mod–_¡r_
,

54 cÚ¡ 
¡ršg
& 
glob®_¬b_mod–_¡r_
,

55 cÚ¡ 
¡ršg
& 
glob®_¬b_ff_mod–_¡r_
,

56 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


59 
	`as£¹
(
num_š_pÜt_
 ==‚um_in_port_);

60 
	`as£¹
(
num_out_pÜt_
 ==‚um_out_port_);

61 
	`as£¹
(
num_vşass_
 ==‚um_vclass_);

62 
	`as£¹
(
num_vchªÃl_
 ==‚um_vchannel_);

63 
	`as£¹
(
Ën_š_wœe_
 ==†en_in_wire_);

65 
m_num_š_pÜt
 = 
num_š_pÜt_
;

66 
m_num_out_pÜt
 = 
num_out_pÜt_
;

67 
m_num_vşass
 = 
num_vşass_
;

68 
m_num_vchªÃl
 = 
num_vchªÃl_
;

70 ià((
m_num_vşass
*
m_num_vchªÃl
) > 1)

72 
m_loÿl_¬b_±r
 = 
Arb™”
::
	`ü—‹_¬b™”
(

73 
loÿl_¬b_mod–_¡r_
, 
loÿl_¬b_ff_mod–_¡r_
,

74 
m_num_vşass
*
m_num_vchªÃl
, 0, 
‹ch_·¿m_±r_
);

78 
m_loÿl_¬b_±r
 = 
NULL
;

81 ià(
m_num_š_pÜt
 > 2)

83 
m_glob®_¬b_±r
 = 
Arb™”
::
	`ü—‹_¬b™”
(

84 
glob®_¬b_mod–_¡r_
, 
glob®_¬b_ff_mod–_¡r_
,

85 
m_num_š_pÜt
-1, 
Ën_š_wœe_
, 
‹ch_·¿m_±r_
);

89 
m_glob®_¬b_±r
 = 
NULL
;

91 
	}
}

93 
	gSWAÎoÿtÜ
::~
	$SWAÎoÿtÜ
()

94 {
	}
}

96 
SWAÎoÿtÜ
::
	$g‘_dyÇmic_’”gy_loÿl_sw_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const

98 
e_loÿl_¬b
 = 0;

100 ià(
m_loÿl_¬b_±r
)

102 
e_loÿl_¬b
 = 
m_loÿl_¬b_±r
->
	`ÿlc_dyÇmic_’”gy
(
num_»q_
, 
is_max_
);

104  
e_loÿl_¬b
;

105 
	}
}

107 
	gSWAÎoÿtÜ
::
	$g‘_dyÇmic_’”gy_glob®_sw_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const

109 
e_glob®_¬b
 = 0;

111 ià(
m_glob®_¬b_±r
)

113 
e_glob®_¬b
 = 
m_glob®_¬b_±r
->
	`ÿlc_dyÇmic_’”gy
(
num_»q_
, 
is_max_
);

115  
e_glob®_¬b
;

116 
	}
}

118 
	gSWAÎoÿtÜ
::
	$g‘_¡©ic_pow”
() const

120 
p_va
 = 0;

122 ià(
m_loÿl_¬b_±r
)

125 
p_va
 +ğ
m_loÿl_¬b_±r
->
	`g‘_¡©ic_pow”
()*
m_num_š_pÜt
;

127 ià(
m_glob®_¬b_±r
)

129 
p_va
 +ğ
m_glob®_¬b_±r
->
	`g‘_¡©ic_pow”
()*
m_num_out_pÜt
;

131  
p_va
;

132 
	}
}

134 
	gSWAÎoÿtÜ
::
	$´št_®l
() const

136 
cout
 << "SWAÎoÿtÜ:" << 
’dl
;

137 ià(
m_loÿl_¬b_±r
)

139 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
*
m_num_vchªÃl
; i++)

141 
cout
 << "\t" << "LoÿÈ¬b (" << 
i
 << "èğ" << 
	`g‘_dyÇmic_’”gy_loÿl_sw_¬b
(i, 
çl£
è<< 
’dl
;

145 ià(
m_glob®_¬b_±r
)

147 
ušt32_t
 
i
 = 0; i < 
m_num_š_pÜt
-1; i++)

149 
cout
 << "\t" << "Glob®‡rb (" << 
i
 << "èğ" << 
	`g‘_dyÇmic_’”gy_glob®_sw_¬b
(i, 
çl£
è<< 
’dl
;

153 
cout
 << "\t" << "Stiøpow” = " << 
	`g‘_¡©ic_pow”
(è<< 
’dl
;

155 
	}
}

157 
SWAÎoÿtÜ
* 
	gSWAÎoÿtÜ
::
	$ü—‹_sw®loÿtÜ
(

158 
ušt32_t
 
num_š_pÜt_
,

159 
ušt32_t
 
num_out_pÜt_
,

160 
ušt32_t
 
num_vşass_
,

161 
ušt32_t
 
num_vchªÃl_
,

162 cÚ¡ 
Crossb¬
* 
xb¬_±r_
,

163 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


166 
Ën_š_wœe
 = 
xb¬_±r_
->
	`g‘_Ën_»q_wœe
();

167 cÚ¡ 
¡ršg
& 
loÿl_¬b_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("SA_IN_ARB_MODEL");

168 cÚ¡ 
¡ršg
& 
loÿl_¬b_ff_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("SA_IN_ARB_FF_MODEL");

169 cÚ¡ 
¡ršg
& 
glob®_¬b_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("SA_OUT_ARB_MODEL");

170 cÚ¡ 
¡ršg
& 
glob®_¬b_ff_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("SA_OUT_ARB_FF_MODEL");

171 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r
 = 
ÜiÚ_cfg_±r_
->
	`g‘_‹ch_·¿m_±r
();

172  
Ãw
 
	`SWAÎoÿtÜ
(
num_š_pÜt_
, 
num_out_pÜt_
, 
num_vşass_
, 
num_vchªÃl_
,

173 
Ën_š_wœe
, 
loÿl_¬b_mod–_¡r
, 
loÿl_¬b_ff_mod–_¡r
,

174 
glob®_¬b_mod–_¡r
, 
glob®_¬b_ff_mod–_¡r
,
‹ch_·¿m_±r
);

175 
	}
}

	@ruby/network/orion/Allocator/SWAllocator.hh

36 #iâdeà
__SWALLOCATOR_H__


37 
	#__SWALLOCATOR_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

42 
şass
 
	gOriÚCÚfig
;

43 
şass
 
	gArb™”
;

44 
şass
 
	gCrossb¬
;

46 şas 
	cSWAÎoÿtÜ


48 
	m´Ùeùed
:

49 
SWAÎoÿtÜ
(

50 
ušt32_t
 
num_š_pÜt_
,

51 
ušt32_t
 
num_out_pÜt_
,

52 
ušt32_t
 
num_vşass_
,

53 
ušt32_t
 
num_vchªÃl_
,

54 
Ën_š_wœe_
,

55 cÚ¡ 
¡ršg
& 
loÿl_¬b_mod–_¡r_
,

56 cÚ¡ 
¡ršg
& 
loÿl_¬b_ff_mod–_¡r_
,

57 cÚ¡ 
¡ršg
& 
glob®_¬b_mod–_¡r_
,

58 cÚ¡ 
¡ršg
& 
glob®_¬b_ff_mod–_¡r_
,

59 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


62 
	mpublic
:

63 ~
SWAÎoÿtÜ
();

65 
	mpublic
:

66 
	$g‘_dyÇmic_’”gy_loÿl_sw_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const;

67 
	$g‘_dyÇmic_’”gy_glob®_sw_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const;

68 
	$g‘_¡©ic_pow”
() const;

70 
	$´št_®l
() const;

72 
´Ùeùed
:

73 
	`š™
();

75 
´Ùeùed
:

76 
ušt32_t
 
m_num_š_pÜt
;

77 
ušt32_t
 
m_num_out_pÜt
;

78 
ušt32_t
 
m_num_vşass
;

79 
ušt32_t
 
m_num_vchªÃl
;

81 
Arb™”
* 
m_loÿl_¬b_±r
;

82 
Arb™”
* 
m_glob®_¬b_±r
;

84 
public
:

85 
SWAÎoÿtÜ
* 
	`ü—‹_sw®loÿtÜ
(

86 
ušt32_t
 
num_š_pÜt_
,

87 
ušt32_t
 
num_out_pÜt_
,

88 
ušt32_t
 
num_vşass_
,

89 
ušt32_t
 
num_vchªÃl_
,

90 cÚ¡ 
Crossb¬
* 
xb¬_±r_
,

91 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


	@ruby/network/orion/Allocator/VCAllocator.cc

36 
	~<ÿs£¹
>

37 
	~<cm©h
>

38 
	~<c¡dlib
>

39 
	~<io¡»am
>

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/Arb™”.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/VCAÎoÿtÜ.hh
"

43 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/Bufãr.hh
"

44 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

46 
usšg
 
Çme¥aû
 
	g¡d
;

48 
	gVCAÎoÿtÜ
::
	$VCAÎoÿtÜ
(

49 
ušt32_t
 
num_š_pÜt_
,

50 
ušt32_t
 
num_out_pÜt_
,

51 
ušt32_t
 
num_vşass_
,

52 
ušt32_t
 
num_vchªÃl_
,

53 cÚ¡ 
¡ršg
& 
¬b_mod–_¡r_
,

54 cÚ¡ 
¡ršg
& 
¬b_ff_mod–_¡r_
,

55 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


58 
	`as£¹
(
num_š_pÜt_
 ==‚um_in_port_);

59 
	`as£¹
(
num_out_pÜt_
 ==‚um_out_port_);

60 
	`as£¹
(
num_vşass_
 ==‚um_vclass_);

61 
	`as£¹
(
num_vchªÃl_
 ==‚um_vchannel_);

63 
m_va_mod–
 = 
ONE_STAGE_ARB
;

64 
m_num_š_pÜt
 = 
num_š_pÜt_
;

65 
m_num_out_pÜt
 = 
num_out_pÜt_
;

66 
m_num_vşass
 = 
num_vşass_
;

67 
m_num_vchªÃl
 = 
num_vchªÃl_
;

69 
m_loÿl_¬b_±r
 = 
NULL
;

71 
m_glob®_¬b_±r
 = 
Arb™”
::
	`ü—‹_¬b™”
(

72 
¬b_mod–_¡r_
, 
¬b_ff_mod–_¡r_
,

73 (
m_num_š_pÜt
-1)*
m_num_vchªÃl
, 0, 
‹ch_·¿m_±r_
);

75 
m_vc_£Ëù_±r
 = 
NULL
;

76 
	}
}

78 
	gVCAÎoÿtÜ
::
	$VCAÎoÿtÜ
(

79 
ušt32_t
 
num_š_pÜt_
,

80 
ušt32_t
 
num_out_pÜt_
,

81 
ušt32_t
 
num_vşass_
,

82 
ušt32_t
 
num_vchªÃl_
,

83 cÚ¡ 
¡ršg
& 
loÿl_¬b_mod–_¡r_
,

84 cÚ¡ 
¡ršg
& 
loÿl_¬b_ff_mod–_¡r_
,

85 cÚ¡ 
¡ršg
& 
glob®_¬b_mod–_¡r_
,

86 cÚ¡ 
¡ršg
& 
glob®_¬b_ff_mod–_¡r_
,

87 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


90 
	`as£¹
(
num_š_pÜt_
 ==‚um_in_port_);

91 
	`as£¹
(
num_out_pÜt_
 ==‚um_out_port_);

92 
	`as£¹
(
num_vşass_
 ==‚um_vclass_);

93 
	`as£¹
(
num_vchªÃl_
 ==‚um_vchannel_);

95 
m_va_mod–
 = 
TWO_STAGE_ARB
;

96 
m_num_š_pÜt
 = 
num_š_pÜt_
;

97 
m_num_out_pÜt
 = 
num_out_pÜt_
;

98 
m_num_vşass
 = 
num_vşass_
;

99 
m_num_vchªÃl
 = 
num_vchªÃl_
;

102 
m_loÿl_¬b_±r
 = 
Arb™”
::
	`ü—‹_¬b™”
(

103 
loÿl_¬b_mod–_¡r_
, 
loÿl_¬b_ff_mod–_¡r_
,

104 
m_num_vchªÃl
, 0, 
‹ch_·¿m_±r_
);

107 
m_glob®_¬b_±r
 = 
Arb™”
::
	`ü—‹_¬b™”
(

108 
glob®_¬b_mod–_¡r_
, 
glob®_¬b_ff_mod–_¡r_
,

109 (
m_num_š_pÜt
-1)*
m_num_vchªÃl
, 0, 
‹ch_·¿m_±r_
);

111 
m_vc_£Ëù_±r
 = 
NULL
;

112 
	}
}

114 
	gVCAÎoÿtÜ
::
	$VCAÎoÿtÜ
(

115 
ušt32_t
 
num_š_pÜt_
,

116 
ušt32_t
 
num_out_pÜt_
,

117 
ušt32_t
 
num_vşass_
,

118 
ušt32_t
 
num_vchªÃl_
,

119 cÚ¡ 
¡ršg
& 
vc_£Ëù_buf_mod–_¡r_
,

120 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


123 
	`as£¹
(
num_š_pÜt_
 ==‚um_in_port_);

124 
	`as£¹
(
num_out_pÜt_
 ==‚um_out_port_);

125 
	`as£¹
(
num_vşass_
 ==‚um_vclass_);

126 
	`as£¹
(
num_vchªÃl_
 ==‚um_vchannel_);

128 
m_va_mod–
 = 
VC_SELECT
;

129 
m_num_š_pÜt
 = 
num_š_pÜt_
;

130 
m_num_out_pÜt
 = 
num_out_pÜt_
;

131 
m_num_vşass
 = 
num_vşass_
;

132 
m_num_vchªÃl
 = 
num_vchªÃl_
;

134 
m_loÿl_¬b_±r
 = 
NULL
;

135 
m_glob®_¬b_±r
 = 
NULL
;

137 
ušt32_t
 
vc_£Ëù_buf_num_£t
 = 
m_num_vchªÃl
;

138 
ušt32_t
 
vc_£Ëù_buf_lše_width
 = (ušt32_t)
	`û
(
	`log2
(
m_num_vchªÃl
));

139 
m_vc_£Ëù_±r
 = 
Ãw
 
	`Bufãr
(
vc_£Ëù_buf_mod–_¡r_
, 
Œue
, 
çl£
,

140 
vc_£Ëù_buf_num_£t
, 
vc_£Ëù_buf_lše_width
, 1, 1, 
ÜiÚ_cfg_±r_
);

141 
	}
}

143 
	gVCAÎoÿtÜ
::~
	$VCAÎoÿtÜ
()

145 
d–‘e
 
m_loÿl_¬b_±r
;

146 
d–‘e
 
m_glob®_¬b_±r
;

147 
d–‘e
 
m_vc_£Ëù_±r
;

148 
	}
}

150 
	gVCAÎoÿtÜ
::
	$g‘_dyÇmic_’”gy_loÿl_vc_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const

152 
e_loÿl_¬b
 = 0;

153 
m_va_mod–
)

155 
TWO_STAGE_ARB
:

156 
e_loÿl_¬b
 = 
m_loÿl_¬b_±r
->
	`ÿlc_dyÇmic_’”gy
(
num_»q_
, 
is_max_
);

158 
ONE_STAGE_ARB
:

159 
VC_SELECT
:

161 
e_loÿl_¬b
 = 0;

163  
e_loÿl_¬b
;

164 
	}
}

166 
	gVCAÎoÿtÜ
::
	$g‘_dyÇmic_’”gy_glob®_vc_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const

168 
e_glob®_¬b
 = 0;

169 
m_va_mod–
)

171 
ONE_STAGE_ARB
:

172 
TWO_STAGE_ARB
:

173 
e_glob®_¬b
 = 
m_glob®_¬b_±r
->
	`ÿlc_dyÇmic_’”gy
(
num_»q_
, 
is_max_
);

175 
VC_SELECT
:

177 
e_glob®_¬b
 = 0;

179  
e_glob®_¬b
;

180 
	}
}

182 
	gVCAÎoÿtÜ
::
	$g‘_dyÇmic_’”gy_vc_£Ëù
(
boŞ
 
is_»ad_
, boŞ 
is_max_
) const

184 
e_vc_£Ëù
 = 0;

185 
m_va_mod–
)

187 
VC_SELECT
:

188 
e_vc_£Ëù
 = 
m_vc_£Ëù_±r
->
	`g‘_dyÇmic_’”gy
(
is_»ad_
, 
is_max_
);

190 
ONE_STAGE_ARB
:

191 
TWO_STAGE_ARB
:

193 
e_vc_£Ëù
 = 0;

195  
e_vc_£Ëù
;

196 
	}
}

198 
	gVCAÎoÿtÜ
::
	$g‘_¡©ic_pow”
() const

200 
p_va
 = 0;

201 
m_va_mod–
)

203 
ONE_STAGE_ARB
:

204 
p_va
 = 
m_glob®_¬b_±r
->
	`g‘_¡©ic_pow”
()*
m_num_out_pÜt
*
m_num_vşass
*
m_num_vchªÃl
;

206 
TWO_STAGE_ARB
:

207 
p_va
 +ğ
m_loÿl_¬b_±r
->
	`g‘_¡©ic_pow”
()*
m_num_š_pÜt
*
m_num_vşass
*
m_num_vchªÃl
;

208 
p_va
 +ğ
m_glob®_¬b_±r
->
	`g‘_¡©ic_pow”
()*
m_num_out_pÜt
*
m_num_vşass
*
m_num_vchªÃl
;

210 
VC_SELECT
:

211 
p_va
 = 
m_vc_£Ëù_±r
->
	`g‘_¡©ic_pow”
()*
m_num_out_pÜt
*
m_num_vşass
;

214 
û¼
 << "ERROR: Inv®id VA mod–" << 
’dl
;

215 
	`ex™
(1);

217  
p_va
;

218 
	}
}

220 
	gVCAÎoÿtÜ
::
	$´št_®l
() const

222 
m_va_mod–
)

224 
ONE_STAGE_ARB
:

225 
cout
 << "VCAÎoÿtÜ: ONE_STAGE_ARB" << 
’dl
;

226 
ušt32_t
 
i
 = 0; i < (
m_num_š_pÜt
-1)*
m_num_vchªÃl
; i++)

228 
cout
 << "\t" << "Glob®‡rb (" << 
i
 << "èğ" << 
	`g‘_dyÇmic_’”gy_glob®_vc_¬b
(i, 
çl£
è<< 
’dl
;

231 
TWO_STAGE_ARB
:

232 
cout
 << "VCAÎoÿtÜ: TWO_STAGE_ARB" << 
’dl
;

233 
ušt32_t
 
i
 = 0; i < 
m_num_vchªÃl
; i++)

235 
cout
 << "\t" << "LoÿÈ¬b (" << 
i
 << "èğ" << 
	`g‘_dyÇmic_’”gy_loÿl_vc_¬b
(i, 
çl£
è<< 
’dl
;

237 
ušt32_t
 
i
 = 0; i < (
m_num_š_pÜt
-1)*
m_num_vchªÃl
; i++)

239 
cout
 << "\t" << "Glob®‡rb (" << 
i
 << "èğ" << 
	`g‘_dyÇmic_’”gy_glob®_vc_¬b
(i, 
çl£
è<< 
’dl
;

242 
VC_SELECT
:

243 
cout
 << "VCAÎoÿtÜ: VC_SELECT" << 
’dl
;

244 
cout
 << "\t" << "R—d = " << 
	`g‘_dyÇmic_’”gy_vc_£Ëù
(
Œue
, 
çl£
è<< 
’dl
;

245 
cout
 << "\t" << "Wr™ğ" << 
	`g‘_dyÇmic_’”gy_vc_£Ëù
(
çl£
, f®£è<< 
’dl
;

250 
cout
 << "\t" << "Stiøpow” = " << 
	`g‘_¡©ic_pow”
(è<< 
’dl
;

252 
	}
}

254 
VCAÎoÿtÜ
* 
	gVCAÎoÿtÜ
::
	$ü—‹_vÿÎoÿtÜ
(

255 cÚ¡ 
¡ršg
& 
vÿÎoc_mod–_¡r_
,

256 
ušt32_t
 
num_š_pÜt_
,

257 
ušt32_t
 
num_out_pÜt_
,

258 
ušt32_t
 
num_vşass_
,

259 
ušt32_t
 
num_vchªÃl_
,

260 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


263 ià(
num_vchªÃl_
 > 1)

265 ià(
vÿÎoc_mod–_¡r_
 =ğ
	`¡ršg
("ONE_STAGE_ARB"))

267 cÚ¡ 
¡ršg
& 
¬b_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("VA_OUT_ARB_MODEL");

268 cÚ¡ 
¡ršg
& 
¬b_ff_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("VA_OUT_ARB_FF_MODEL");

269 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r
 = 
ÜiÚ_cfg_±r_
->
	`g‘_‹ch_·¿m_±r
();

270  
Ãw
 
	`VCAÎoÿtÜ
(
num_š_pÜt_
, 
num_out_pÜt_
, 
num_vşass_
, 
num_vchªÃl_
,

271 
¬b_mod–_¡r
, 
¬b_ff_mod–_¡r
, 
‹ch_·¿m_±r
);

273 ià(
vÿÎoc_mod–_¡r_
 =ğ
	`¡ršg
("TWO_STAGE_ARB"))

275 cÚ¡ 
¡ršg
& 
loÿl_¬b_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("VA_IN_ARB_MODEL");

276 cÚ¡ 
¡ršg
& 
loÿl_¬b_ff_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("VA_IN_ARB_FF_MODEL");

277 cÚ¡ 
¡ršg
& 
glob®_¬b_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("VA_OUT_ARB_MODEL");

278 cÚ¡ 
¡ršg
& 
glob®_¬b_ff_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("VA_OUT_ARB_FF_MODEL");

279 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r
 = 
ÜiÚ_cfg_±r_
->
	`g‘_‹ch_·¿m_±r
();

280  
Ãw
 
	`VCAÎoÿtÜ
(
num_š_pÜt_
, 
num_out_pÜt_
, 
num_vşass_
, 
num_vchªÃl_
,

281 
loÿl_¬b_mod–_¡r
, 
loÿl_¬b_ff_mod–_¡r
,

282 
glob®_¬b_mod–_¡r
, 
glob®_¬b_ff_mod–_¡r
,
‹ch_·¿m_±r
);

284 ià(
vÿÎoc_mod–_¡r_
 =ğ
	`¡ršg
("VC_SELECT"))

286 cÚ¡ 
¡ršg
& 
vc_£Ëù_buf_mod–_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("VA_BUF_MODEL");

287  
Ãw
 
	`VCAÎoÿtÜ
(
num_š_pÜt_
, 
num_out_pÜt_
, 
num_vşass_
, 
num_vchªÃl_
,

288 
vc_£Ëù_buf_mod–_¡r
, 
ÜiÚ_cfg_±r_
);

292 
û¼
 << "WARNING: NØVC‡ÎoÿtÜ mod–" << 
’dl
;

293  (
VCAÎoÿtÜ
*)
NULL
;

299  
Ãw
 
	`VCAÎoÿtÜ
(
num_š_pÜt_
, 
num_out_pÜt_
, 
num_vşass_
, 1,

300 "REGISTER", 
ÜiÚ_cfg_±r_
);

302 
	}
}

	@ruby/network/orion/Allocator/VCAllocator.hh

36 #iâdeà
__VCALLOCATOR_H__


37 
	#__VCALLOCATOR_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

42 
şass
 
	gOriÚCÚfig
;

43 
şass
 
	gArb™”
;

44 
şass
 
	gBufãr
;

46 şas 
	cVCAÎoÿtÜ


48 
	mpublic
:

49 
	eVAMod–


51 
NO_MODEL
 = 0,

52 
	mONE_STAGE_ARB
,

53 
	mTWO_STAGE_ARB
,

54 
	mVC_SELECT


57 
	gpublic
:

58 ~
VCAÎoÿtÜ
();

60 
	g´Ùeùed
:

62 
VCAÎoÿtÜ
(

63 
ušt32_t
 
num_š_pÜt_
,

64 
ušt32_t
 
num_out_pÜt_
,

65 
ušt32_t
 
num_vşass_
,

66 
ušt32_t
 
num_vchªÃl_
,

67 cÚ¡ 
¡ršg
& 
¬b_mod–_¡r_
,

68 cÚ¡ 
¡ršg
& 
¬b_ff_mod–_¡r_
,

69 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


72 
VCAÎoÿtÜ
(

73 
ušt32_t
 
num_š_pÜt_
,

74 
ušt32_t
 
num_out_pÜt_
,

75 
ušt32_t
 
num_vşass_
,

76 
ušt32_t
 
num_vchªÃl_
,

77 cÚ¡ 
¡ršg
& 
loÿl_¬b_mod–_¡r_
,

78 cÚ¡ 
¡ršg
& 
loÿl_¬b_ff_mod–_¡r_
,

79 cÚ¡ 
¡ršg
& 
glob®_¬b_mod–_¡r_
,

80 cÚ¡ 
¡ršg
& 
glob®_¬b_ff_mod–_¡r_
,

81 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


84 
VCAÎoÿtÜ
(

85 
ušt32_t
 
num_š_pÜt_
,

86 
ušt32_t
 
num_out_pÜt_
,

87 
ušt32_t
 
num_vşass_
,

88 
ušt32_t
 
num_vchªÃl_
,

89 cÚ¡ 
¡ršg
& 
vc_£Ëù_buf_mod–_¡r_
,

90 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


93 
	gpublic
:

94 
	$g‘_dyÇmic_’”gy_loÿl_vc_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const;

95 
	$g‘_dyÇmic_’”gy_glob®_vc_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const;

96 
	$g‘_dyÇmic_’”gy_vc_£Ëù
(
boŞ
 
is_»ad_
, boŞ 
is_max_
) const;

97 
	$g‘_¡©ic_pow”
() const;

99 
	$´št_®l
() const;

101 
´Ùeùed
:

102 
VAMod–
 
m_va_mod–
;

103 
ušt32_t
 
m_num_š_pÜt
;

104 
ušt32_t
 
m_num_out_pÜt
;

105 
ušt32_t
 
m_num_vşass
;

106 
ušt32_t
 
m_num_vchªÃl
;

108 
Arb™”
* 
m_loÿl_¬b_±r
;

109 
Arb™”
* 
m_glob®_¬b_±r
;

110 
Bufãr
* 
m_vc_£Ëù_±r
;

112 
public
:

113 
VCAÎoÿtÜ
* 
	`ü—‹_vÿÎoÿtÜ
(

114 cÚ¡ 
¡ršg
& 
vÿÎoc_mod–_¡r_
,

115 
ušt32_t
 
num_š_pÜt_
,

116 
ušt32_t
 
num_out_pÜt_
,

117 
ušt32_t
 
num_vşass_
,

118 
ušt32_t
 
num_vchªÃl_
,

119 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


121 
	}
};

	@ruby/network/orion/Buffer/AmpUnit.cc

36 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/AmpUn™.hh
"

37 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

39 
	gAmpUn™
::
	$AmpUn™
(

40 cÚ¡ 
¡ršg
& 
amp_mod–_¡r_
,

41 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


44 ià(
amp_mod–_¡r_
.
	`com·»
("GENERIC_AMP") == 0)

46 
m_amp_mod–
 = 
GENERIC_AMP
;

50 
m_amp_mod–
 = 
NO_MODEL
;

53 ià(
m_amp_mod–
 !ğ
NO_MODEL
)

55 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

57 
	`š™
();

59 
	}
}

61 
	gAmpUn™
::~
	$AmpUn™
()

62 {
	}
}

64 
AmpUn™
::
	$š™
()

66 
vdd
 = 
m_‹ch_·¿m_±r
->
	`g‘_vdd
();

67 
³riod
 = 
m_‹ch_·¿m_±r
->
	`g‘_³riod
();

68 
amp_Id§t
 = 
m_‹ch_·¿m_±r
->
	`g‘_amp_id§t
();

70 
m_e_acûss
 = (
vdd
 / 8.0 * 
³riod
 * 
amp_Id§t
);

72 
	}
}

	@ruby/network/orion/Buffer/AmpUnit.hh

36 #iâdeà
__AMPUNIT_H__


37 
	#__AMPUNIT_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

43 şas 
	cAmpUn™


45 
	mpublic
:

46 
	eAmpMod–


48 
NO_MODEL
 = 0,

49 
	mGENERIC_AMP


52 
	gpublic
:

53 
AmpUn™
(

54 cÚ¡ 
¡ršg
& 
amp_mod–_¡r_
,

55 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


57 ~
AmpUn™
();

59 
	gpublic
:

60 
	$g‘_e_acûss
(ècÚ¡ {  
m_e_acûss
; 
	}
}

62 
	g´iv©e
:

63 
š™
();

65 
	g´iv©e
:

66 
AmpMod–
 
m_amp_mod–
;

67 cÚ¡ 
TechP¬am‘”
* 
	gm_‹ch_·¿m_±r
;

69 
	gm_e_acûss
;

	@ruby/network/orion/Buffer/BitlineUnit.cc

36 
	~"ba£/misc.hh
"

37 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/B™lšeUn™.hh
"

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/SRAM.hh
"

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

41 
	gB™lšeUn™
::
	$B™lšeUn™
(

42 cÚ¡ 
¡ršg
 
bl_mod–_¡r_
,

43 cÚ¡ 
SRAM
* 
¤am_±r_
,

44 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


47 ià(
bl_mod–_¡r_
 == "RW_BITLINE")

49 
m_bl_mod–
 = 
RW_BITLINE
;

51 ià(
bl_mod–_¡r_
 == "WO_BITLINE")

53 
m_bl_mod–
 = 
WO_BITLINE
;

57 
m_bl_mod–
 = 
NO_MODEL
;

60 ià(
m_bl_mod–
 !ğ
NO_MODEL
)

62 
m_¤am_±r
 = 
¤am_±r_
;

63 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

65 
	`š™
();

67 
	}
}

69 
	gB™lšeUn™
::~
	$B™lšeUn™
()

70 {
	}
}

72 
B™lšeUn™
::
	$š™
()

74 
ušt32_t
 
num_pÜt
 = 
m_¤am_±r
->
	`g‘_num_pÜt
();

75 
ušt32_t
 
num_d©a_’d
 = 
m_¤am_±r
->
	`g‘_num_d©a_’d
();

76 
bl_cm‘®
;

77 ià((
num_pÜt
 > 1è|| (
num_d©a_’d
 == 2))

79 
bl_cm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_CC3M2m‘®
();

83 
bl_cm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_CM2m‘®
();

85 
ušt32_t
 
num_row
 = 
m_¤am_±r
->
	`g‘_num_row
();

86 
RegC–lHeight
 = 
m_‹ch_·¿m_±r
->
	`g‘_RegC–lHeight
();

87 
WÜdlšeS·cšg
 = 
m_‹ch_·¿m_±r
->
	`g‘_WÜdlšeS·cšg
();

88 
m_bl_Ën
 = 
num_row
*(
RegC–lHeight
 + 
num_pÜt
*
WÜdlšeS·cšg
);

89 
m_bl_wœe_ÿp
 = 
m_bl_Ën
 * 
bl_cm‘®
;

91 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

92 
£n£_e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_S’£EÃrgyFaùÜ
();

93 
m_bl_mod–
)

95 
RW_BITLINE
:

96 ià(
num_d©a_’d
 == 2)

98 
m_e_cŞ_£l
 = 
	`ÿlc_cŞ_£Ëù_ÿp
(è* 
e_çùÜ
;

99 
m_e_cŞ_»ad
 = 
	`ÿlc_cŞ_»ad_ÿp
(è* 
£n£_e_çùÜ
;

103 
m_e_cŞ_£l
 = 0;

104 
m_e_cŞ_»ad
 = 
	`ÿlc_cŞ_»ad_ÿp
(è* 
e_çùÜ
;

106 
m_e_cŞ_wr™e
 = 
	`ÿlc_cŞ_wr™e_ÿp
(è* 
e_çùÜ
;

108 
m_i_¡©ic
 = 
	`ÿlc_i_¡©ic
();

110 
WO_BITLINE
:

111 
m_e_cŞ_£l
 = 
m_e_cŞ_»ad
 = 0;

112 
m_e_cŞ_wr™e
 = 
	`ÿlc_cŞ_wr™e_ÿp
(è* 
e_çùÜ
;

116 
	`çl
("Error in BITLINE model.\n");

119 
	}
}

121 
	gB™lšeUn™
::
	$ÿlc_cŞ_£Ëù_ÿp
()

123 
Wb™muxn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wb™muxn
();

124  
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
Wb™muxn
, 1);

125 
	}
}

127 
	gB™lšeUn™
::
	$ÿlc_cŞ_»ad_ÿp
()

129 
tÙ®_ÿp
 = 0;

135 
WmemûÎr
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎr
();

136 
ušt32_t
 
num_row
 = 
m_¤am_±r
->
	`g‘_num_row
();

137 
tÙ®_ÿp
 = 
num_row
 * 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WmemûÎr
, 
TechP¬am‘”
::
NCH
, 1);

140 
tÙ®_ÿp
 +ğ
m_bl_wœe_ÿp
;

141 
m_´e_un™_lßd
 = 
tÙ®_ÿp
;

144 
ušt32_t
 
num_d©a_’d
 = 
m_¤am_±r
->
	`g‘_num_d©a_’d
();

145 ià(
num_d©a_’d
 == 1)

148 
MSCALE
 = 
m_‹ch_·¿m_±r
->
	`g‘_MSCALE
();

149 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
MSCALE
 * (29.9 + 7.8), 0) + m_tech_param_ptr->calc_gatecap(MSCALE * (47.0 + 12.0), 0);

153 
boŞ
 
is_outdrv
 = 
m_¤am_±r
->
	`g‘_is_outdrv
();

154 ià(
num_d©a_’d
 == 2)

156 
W£n£Q1to4
 = 
m_‹ch_·¿m_±r
->
	`g‘_W£n£Q1to4
();

157 
tÙ®_ÿp
 +ğ2 * 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
W£n£Q1to4
, 10);

159 ià(
is_outdrv
)

161 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

162 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

163 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

164 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

166 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvÇndn
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvÇndp
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜn
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜp
, 1);

169  
tÙ®_ÿp
;

170 
	}
}

172 
	gB™lšeUn™
::
	$ÿlc_cŞ_wr™e_ÿp
()

174 
tÙ®_ÿp
, 
psize
, 
nsize
;

177 
ušt32_t
 
num_row
 = 
m_¤am_±r
->
	`g‘_num_row
();

178 
WmemûÎw
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎw
();

179 
tÙ®_ÿp
 = 
num_row
 * 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WmemûÎw
, 
TechP¬am‘”
::
NCH
, 1è+ 
m_bl_wœe_ÿp
;

182 
³riod
 = 
m_‹ch_·¿m_±r
->
	`g‘_³riod
();

183 
psize
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_driv”_psize
(
tÙ®_ÿp
, 
³riod
 / 8.0);

184 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

185 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

186 
nsize
 = 
psize
 * 
Wdecšvn
 / 
Wdecšvp
;

187 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
psize
, 
TechP¬am‘”
::
PCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
nsize
, TechP¬am‘”::
NCH
, 1è+ m_‹ch_·¿m_±r->
	`ÿlc_g©eÿp
(psize +‚size, 1);

189  
tÙ®_ÿp
;

190 
	}
}

192 
	gB™lšeUn™
::
	$ÿlc_i_¡©ic
()

194 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

195 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

196 
NMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NMOS_TAB
(0);

197 
PMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_PMOS_TAB
(0);

199  (2*(
Wdecšvn
*
NMOS_TAB_0
+
Wdecšvp
*
PMOS_TAB_0
));

200 
	}
}

	@ruby/network/orion/Buffer/BitlineUnit.hh

36 #iâdeà
__BITLINEUNIT_H__


37 
	#__BITLINEUNIT_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gSRAM
;

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cB™lšeUn™


46 
	mpublic
:

47 
	eB™lšeMod–


49 
NO_MODEL
 = 0,

50 
	mRW_BITLINE
,

51 
	mWO_BITLINE


54 
	gpublic
:

55 
B™lšeUn™
(

56 cÚ¡ 
¡ršg
 
bl_mod–_¡r_
,

57 cÚ¡ 
SRAM
* 
¤am_±r_
,

58 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


60 ~
B™lšeUn™
();

62 
	gpublic
:

63 
	$g‘_´e_un™_lßd
(ècÚ¡ {  
m_´e_un™_lßd
; 
	}
}

65 
	$g‘_e_cŞ_»ad
(ècÚ¡ {  
m_e_cŞ_»ad
; 
	}
}

66 
	$g‘_e_cŞ_w¹›
(ècÚ¡ {  
m_e_cŞ_wr™e
; 
	}
}

67 
	$g‘_i_¡©ic
(ècÚ¡ {  
m_i_¡©ic
; 
	}
}

69 
	g´iv©e
:

70 
š™
();

71 
ÿlc_cŞ_£Ëù_ÿp
();

72 
ÿlc_cŞ_»ad_ÿp
();

73 
ÿlc_cŞ_wr™e_ÿp
();

74 
ÿlc_i_¡©ic
();

76 
	g´iv©e
:

77 
B™lšeMod–
 
m_bl_mod–
;

78 cÚ¡ 
SRAM
* 
	gm_¤am_±r
;

79 cÚ¡ 
TechP¬am‘”
* 
	gm_‹ch_·¿m_±r
;

81 
	gm_bl_Ën
;

82 
	gm_bl_wœe_ÿp
;

83 
	gm_´e_un™_lßd
;

85 
	gm_e_cŞ_£l
;

86 
	gm_e_cŞ_»ad
;

87 
	gm_e_cŞ_wr™e
;

89 
	gm_i_¡©ic
;

	@ruby/network/orion/Buffer/Buffer.cc

36 
	~<ÿs£¹
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/Bufãr.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/Regi¡”.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/SRAM.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

43 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

45 
usšg
 
Çme¥aû
 
	g¡d
;

47 
	gBufãr
::
	$Bufãr
(

48 cÚ¡ 
¡ršg
& 
bufãr_mod–_¡r_
,

49 
boŞ
 
is_fifo_
,

50 
boŞ
 
is_outdrv_
,

51 
ušt32_t
 
num_’Œy_
,

52 
ušt32_t
 
lše_width_
,

53 
ušt32_t
 
num_»ad_pÜt_
,

54 
ušt32_t
 
num_wr™e_pÜt_
,

55 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


58 ià(
bufãr_mod–_¡r_
 =ğ
	`¡ršg
("SRAM"))

60 
m_bufãr_mod–
 = 
BUF_SRAM
;

62 if(
bufãr_mod–_¡r_
 =ğ
	`¡ršg
("REGISTER"))

64 
m_bufãr_mod–
 = 
BUF_REG
;

68 
m_bufãr_mod–
 = 
NO_MODEL
;

71 ià(
m_bufãr_mod–
 !ğ
NO_MODEL
)

73 
	`as£¹
(
num_’Œy_
 ==‚um_entry_);

74 
	`as£¹
(
lše_width_
 ==†ine_width_);

75 
	`as£¹
(
num_»ad_pÜt_
 ==‚um_read_port_);

76 
	`as£¹
(
num_wr™e_pÜt_
 ==‚um_write_port_);

78 
m_num_’Œy
 = 
num_’Œy_
;

79 
m_lše_width
 = 
lše_width_
;

80 
m_is_fifo
 = 
is_fifo_
;

81 
m_is_outdrv
 = 
is_outdrv_
;

82 
m_num_»ad_pÜt
 = 
num_»ad_pÜt_
;

83 
m_num_wr™e_pÜt
 = 
num_wr™e_pÜt_
;

85 
m_ÜiÚ_cfg_±r
 = 
ÜiÚ_cfg_±r_
;

86 
m_‹ch_·¿m_±r
 = 
m_ÜiÚ_cfg_±r
->
	`g‘_‹ch_·¿m_±r
();

88 
	`š™
();

90 
	}
}

92 
	gBufãr
::~
	$Bufãr
()

94 
d–‘e
 
m_¤am_±r
;

95 
	}
}

97 
	gBufãr
::
	$g‘_dyÇmic_’”gy
(

98 
boŞ
 
is_»ad_
,

99 
boŞ
 
is_max_


102 ià(
m_bufãr_mod–
 =ğ
BUF_SRAM
)

104 ià(
is_»ad_
)

106  
m_¤am_±r
->
	`ÿlc_e_»ad
(
is_max_
);

110  
m_¤am_±r
->
	`ÿlc_e_wr™e
(
is_max_
);

113 ià(
m_bufãr_mod–
 =ğ
BUF_REG
)

115 ià(
is_»ad_
)

117  
m_»g_±r
->
	`ÿlc_e_»ad
();

121  
m_»g_±r
->
	`ÿlc_e_wr™e
();

128 
	}
}

130 
	gBufãr
::
	$g‘_¡©ic_pow”
() const

132 
vdd
 = 
m_‹ch_·¿m_±r
->
	`g‘_vdd
();

133 
SCALE_S
 = 
m_‹ch_·¿m_±r
->
	`g‘_SCALE_S
();

134 ià(
m_bufãr_mod–
 =ğ
BUF_SRAM
)

136  
m_¤am_±r
->
	`ÿlc_i_¡©ic
()*
vdd
*
SCALE_S
;

138 ià(
m_bufãr_mod–
 =ğ
BUF_REG
)

140  
m_»g_±r
->
	`ÿlc_i_¡©ic
()*
vdd
*
SCALE_S
;

146 
	}
}

148 
	gBufãr
::
	$´št_®l
() const

150 
cout
 << "Bufãr" << 
’dl
;

151 
cout
 << "\t" << "R—d = " << 
	`g‘_dyÇmic_’”gy
(
Œue
, 
çl£
è<< 
’dl
;

152 
cout
 << "\t" << "Wr™ğ" << 
	`g‘_dyÇmic_’”gy
(
çl£
, f®£è<< 
’dl
;

153 
cout
 << "\t" << "Stiøpow” = " << 
	`g‘_¡©ic_pow”
(è<< 
’dl
;

155 
	}
}

157 
	gBufãr
::
	$š™
()

159 if(
m_bufãr_mod–
 =ğ
BUF_SRAM
)

161 
ušt32_t
 
num_d©a_’d
 = 
m_ÜiÚ_cfg_±r
->
g‘
<uint32_t>("SRAM_NUM_DATA_END");

162 cÚ¡ 
¡ršg
& 
rowdec_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("SRAM_ROWDEC_MODEL");

163 cÚ¡ 
¡ršg
& 
wl_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("SRAM_WORDLINE_MODEL");

164 cÚ¡ 
¡ršg
& 
bl_´e_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("SRAM_BITLINE_PRE_MODEL");

165 cÚ¡ 
¡ršg
& 
mem_mod–_¡r
 = "NORMAL_MEM";

166 cÚ¡ 
¡ršg
& 
bl_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("SRAM_BITLINE_MODEL");

167 cÚ¡ 
¡ršg
& 
amp_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("SRAM_AMP_MODEL");

168 cÚ¡ 
¡ršg
& 
outdrv_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("SRAM_OUTDRV_MODEL");

169 
m_¤am_±r
 = 
Ãw
 
	`SRAM
(

170 
m_num_’Œy
, 
m_lše_width
, 
m_is_fifo
, 
m_is_outdrv
,

171 
m_num_»ad_pÜt
, 
m_num_wr™e_pÜt
, 
num_d©a_’d
,

172 
rowdec_mod–_¡r
, 
wl_mod–_¡r
, 
bl_´e_mod–_¡r
, 
mem_mod–_¡r
,

173 
bl_mod–_¡r
, 
amp_mod–_¡r
, 
outdrv_mod–_¡r
, 
m_‹ch_·¿m_±r
);

175 ià(
m_bufãr_mod–
 =ğ
BUF_REG
)

177 
m_¤am_±r
 = 
NULL
;

178 
m_»g_±r
 = 
Ãw
 
	`Regi¡”
(
m_num_’Œy
, 
m_lše_width
, 
m_‹ch_·¿m_±r
);

182 
m_¤am_±r
 = 
NULL
;

183 
m_»g_±r
 = 
NULL
;

186 
	}
}

	@ruby/network/orion/Buffer/Buffer.hh

36 #iâdeà
__BUFFER_H__


37 
	#__BUFFER_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gOriÚCÚfig
;

42 
şass
 
	gTechP¬am‘”
;

44 
şass
 
	gSRAM
;

45 
şass
 
	gRegi¡”
;

47 şas 
	cBufãr


49 
	mpublic
:

50 
	eBufãrMod–


52 
NO_MODEL
 = 0,

53 
	mBUF_SRAM
,

54 
	mBUF_REG


57 
	gpublic
:

58 
Bufãr
(

59 cÚ¡ 
¡ršg
& 
bufãr_mod–_¡r_
,

60 
boŞ
 
is_fifo_
,

61 
boŞ
 
is_outdrv_
,

62 
ušt32_t
 
num_’Œy_
,

63 
ušt32_t
 
lše_width_
,

64 
ušt32_t
 
num_»ad_pÜt_
,

65 
ušt32_t
 
num_wr™e_pÜt_
,

66 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


68 ~
Bufãr
();

70 
	gpublic
:

71 
	$g‘_dyÇmic_’”gy
(
boŞ
 
is_»ad_
, boŞ 
is_max_
) const;

72 
	$g‘_¡©ic_pow”
() const;

74 
	$´št_®l
() const;

76 
´iv©e
:

77 
	`š™
();

79 
´iv©e
:

80 
BufãrMod–
 
m_bufãr_mod–
;

81 
ušt32_t
 
m_num_’Œy
;

82 
ušt32_t
 
m_lše_width
;

84 
boŞ
 
m_is_fifo
;

85 
boŞ
 
m_is_outdrv
;

86 
ušt32_t
 
m_num_»ad_pÜt
;

87 
ušt32_t
 
m_num_wr™e_pÜt
;

88 cÚ¡ 
OriÚCÚfig
* 
m_ÜiÚ_cfg_±r
;

89 cÚ¡ 
TechP¬am‘”
* 
m_‹ch_·¿m_±r
;

91 
SRAM
* 
m_¤am_±r
;

92 
Regi¡”
* 
m_»g_±r
;

93 
	}
};

	@ruby/network/orion/Buffer/DecoderUnit.cc

36 
	~<cm©h
>

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/Decod”Un™.hh
"

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

41 
usšg
 
Çme¥aû
 
	g¡d
;

43 
	gDecod”Un™
::
	$Decod”Un™
(

44 cÚ¡ 
¡ršg
& 
dec_mod–_¡r_
,

45 
ušt32_t
 
dec_width_
,

46 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


49 ià(
dec_mod–_¡r_
.
	`com·»
("GENERIC_DEC") == 0)

51 
m_dec_mod–
 = 
GENERIC_DEC
;

55 
m_dec_mod–
 = 
NO_MODEL
;

58 ià(
m_dec_mod–
 !ğ
NO_MODEL
)

60 
m_dec_width
 = 
dec_width_
;

61 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

63 
	`š™
();

65 
	}
}

67 
	gDecod”Un™
::~
	$Decod”Un™
()

69 
	}
}

71 
Decod”Un™
::
	$š™
()

73 ià(
m_dec_width
 >= 4)

75 
m_num_š_1¡
 = (
m_dec_width
 == 4)? 2:3;

76 
m_num_out_0th
 = 1 << (
m_num_š_1¡
 - 1);

77 
m_num_š_2nd
 = (
ušt32_t
)
	`û
(()
m_dec_width
/()
m_num_š_1¡
);

78 
m_num_out_1¡
 = 1 << (
m_dec_width
 - 
m_num_š_1¡
);

80 ià(
m_dec_width
 >= 2)

82 
m_num_š_1¡
 = 
m_dec_width
;

83 
m_num_out_0th
 = 1 << (
m_num_š_1¡
 - 1);

84 
m_num_š_2nd
 = 
m_num_out_1¡
 = 0;

88 
m_num_š_1¡
 = 
m_num_out_0th
 = 
m_num_š_2nd
 = 
m_num_out_1¡
 = 0;

92 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_vdd
() * m_tech_param_ptr->get_vdd();

93 ià(
m_dec_width
 >= 4)

95 
m_e_chg_l1
 = 
	`ÿlc_chgl1_ÿp
(è* 
e_çùÜ
;

96 
m_e_chg_ouut
 = 
	`ÿlc_£Ëù_ÿp
(è* 
e_çùÜ
;

98 ià(
m_dec_width
 >= 2)

100 
m_e_chg_l1
 = 
	`ÿlc_chgl1_ÿp
(è* 
e_çùÜ
;

101 
m_e_chg_ouut
 = 0;

105 
m_e_chg_l1
 = 
m_e_chg_ouut
 = 0;

107 
m_e_chg_addr
 = 
	`ÿlc_chgaddr_ÿp
(è* 
e_çùÜ
;

110 
	}
}

112 
	gDecod”Un™
::
	$ÿlc_chgl1_ÿp
()

114 
tÙ®_ÿp
;

117 
Wdec3to8p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdec3to8p
();

118 
Wdec3to8n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdec3to8n
();

119 
tÙ®_ÿp
 = 
m_num_š_1¡
 * 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdec3to8p
, 
TechP¬am‘”
::
PCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Wdec3to8n
, TechP¬am‘”::
NCH
, m_num_in_1st);

123 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

124 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

125 
tÙ®_ÿp
 +ğ
m_num_out_0th
*
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
((
WdecNORn
+
WdecNORp
), 
m_num_š_2nd
*40 + 20);

127  
tÙ®_ÿp
;

128 
	}
}

130 
	gDecod”Un™
::
	$ÿlc_£Ëù_ÿp
()

132 
tÙ®_ÿp
;

135 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

136 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

137 
tÙ®_ÿp
 = 
m_num_š_2nd
 * 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORn
, 
TechP¬am‘”
::
NCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
WdecNORp
, TechP¬am‘”::
PCH
, m_num_in_2nd);

141 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

142 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

143 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdecšvn
, 
TechP¬am‘”
::
NCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Wdecšvp
, TechP¬am‘”::
PCH
, 1è+ m_‹ch_·¿m_±r->
	`ÿlc_g©eÿp
(Wdecinvn + Wdecinvp, 20);

145  
tÙ®_ÿp
;

146 
	}
}

148 
	gDecod”Un™
::
	$ÿlc_chgaddr_ÿp
()

150 
tÙ®_ÿp
;

153 
Wdecdriv•
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecdriv•
();

154 
Wdecdriv’
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecdriv’
();

155 
tÙ®_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdecdriv•
, 
TechP¬am‘”
::
PCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Wdecdriv’
, TechP¬am‘”::
NCH
, 1è+ m_‹ch_·¿m_±r->
	`ÿlc_g©eÿp
(Wdecdriven, 1);

159 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

160 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

161 
tÙ®_ÿp
 +ğ(
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdecšvp
, 
TechP¬am‘”
::
PCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Wdecšvn
, TechP¬am‘”::
NCH
, 1è+ m_‹ch_·¿m_±r->
	`ÿlc_g©eÿp
(Wdecinvp, 1) + m_tech_param_ptr->calc_gatecap(Wdecinvn, 1)) / 2;

165 
Wdec3to8p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdec3to8p
();

166 
Wdec3to8n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdec3to8n
();

167 
tÙ®_ÿp
 +ğ
m_num_out_0th
*
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
Ğ
Wdec3to8n
 + 
Wdec3to8p
, 10 );

169  
tÙ®_ÿp
;

170 
	}
}

	@ruby/network/orion/Buffer/DecoderUnit.hh

36 #iâdeà
__DECODERUNIT_H__


37 
	#__DECODERUNIT_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

42 şas 
	cDecod”Un™


44 
	mpublic
:

45 
	eDecMod–


47 
NO_MODEL
 = 0,

48 
	mGENERIC_DEC


51 
	gpublic
:

52 
Decod”Un™
(

53 cÚ¡ 
¡ršg
& 
dec_mod–_¡r_
,

54 
ušt32_t
 
dec_width_
,

55 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


57 ~
Decod”Un™
();

59 
	gpublic
:

60 
ušt32_t
 
	$g‘_dec_width
(ècÚ¡ {  
m_dec_width
; 
	}
}

61 
ušt32_t
 
	$g‘_num_š_2nd
(ècÚ¡ {  
m_num_š_2nd
; 
	}
}

62 
	$g‘_e_chg_addr
(ècÚ¡ {  
m_e_chg_addr
; 
	}
}

63 
	$g‘_e_chg_ouut
(ècÚ¡ {  
m_e_chg_ouut
; 
	}
}

64 
	$g‘_e_chg_l1
(ècÚ¡ {  
m_e_chg_l1
; 
	}
}

66 
	g´iv©e
:

67 
š™
();

68 
ÿlc_chgl1_ÿp
();

69 
ÿlc_£Ëù_ÿp
();

70 
ÿlc_chgaddr_ÿp
();

72 
	g´iv©e
:

73 
DecMod–
 
m_dec_mod–
;

74 
ušt32_t
 
	gm_dec_width
;

75 cÚ¡ 
TechP¬am‘”
* 
	gm_‹ch_·¿m_±r
;

77 
ušt32_t
 
	gm_num_š_1¡
;

78 
ušt32_t
 
	gm_num_š_2nd
;

79 
ušt32_t
 
	gm_num_out_0th
;

80 
ušt32_t
 
	gm_num_out_1¡
;

82 
	gm_e_chg_l1
;

83 
	gm_e_chg_ouut
;

84 
	gm_e_chg_addr
;

	@ruby/network/orion/Buffer/MemUnit.cc

36 
	~<io¡»am
>

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/MemUn™.hh
"

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/SRAM.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

42 
usšg
 
Çme¥aû
 
	g¡d
;

44 
	gMemUn™
::
	$MemUn™
(

45 cÚ¡ 
¡ršg
& 
mem_mod–_¡r_
,

46 cÚ¡ 
SRAM
* 
¤am_±r_
,

47 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


50 ià(
mem_mod–_¡r_
.
	`com·»
("NORMAL_MEM") == 0)

52 
m_mem_mod–
 = 
NORMAL_MEM
;

56 
m_mem_mod–
 = 
NO_MODEL
;

59 ià(
m_mem_mod–
 !ğ
NO_MODEL
)

61 
m_¤am_±r
 = 
¤am_±r_
;

62 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

64 
	`š™
();

66 
	}
}

68 
	gMemUn™
::~
	$MemUn™
()

69 {
	}
}

71 
MemUn™
::
	$š™
()

73 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

75 
m_e_sw™ch
 = 
	`ÿlc_mem_ÿp
(è* 
e_çùÜ
;

77 
m_i_¡©ic
 = 
	`ÿlc_i_¡©ic
();

78 
	}
}

80 
	gMemUn™
::
	$ÿlc_mem_ÿp
()

82 
WmemûÎa
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎa
();

83 
WmemûÎbsÿË
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎbsÿË
();

84 
WmemûÎr
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎr
();

85 
WmemûÎw
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎw
();

86 
ušt32_t
 
num_d©a_’d
 = 
m_¤am_±r
->
	`g‘_num_d©a_’d
();

87 
ušt32_t
 
num_»ad_pÜt
 = 
m_¤am_±r
->
	`g‘_num_»ad_pÜt
();

88 
ušt32_t
 
num_wr™e_pÜt
 = 
m_¤am_±r
->
	`g‘_num_wr™e_pÜt
();

90 cÚ¡ 
TechP¬am‘”
* 

 = 
m_‹ch_·¿m_±r
;

92 
tÙ®_ÿp
 = 0;

94 
tÙ®_ÿp
 +ğ

->
	`ÿlc_d¿šÿp
(
WmemûÎr
, 
TechP¬am‘”
::
NCH
, 1)*
num_»ad_pÜt
*
num_d©a_’d
/2.0;

95 
tÙ®_ÿp
 +ğ

->
	`ÿlc_d¿šÿp
(
WmemûÎw
, 
TechP¬am‘”
::
NCH
, 1)*
num_wr™e_pÜt
;

99 
tÙ®_ÿp
 +ğ

->
	`ÿlc_d¿šÿp
(
WmemûÎa
, 
TechP¬am‘”
::
NCH
, 1è+p->ÿlc_d¿šÿp(WmemûÎa*
WmemûÎbsÿË
, TechP¬am‘”::
PCH
, 1

104 
tÙ®_ÿp
 +ğ

->
	`ÿlc_g©eÿp
(
WmemûÎa
, 1è+p->ÿlc_g©eÿp(WmemûÎa*
WmemûÎbsÿË
, 1);

106  
tÙ®_ÿp
;

107 
	}
}

109 
	gMemUn™
::
	$ÿlc_i_¡©ic
()

111 
WmemûÎa
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎa
();

112 
WmemûÎbsÿË
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎbsÿË
();

113 
WmemûÎr
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎr
();

114 
WmemûÎw
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎw
();

115 
ušt32_t
 
num_d©a_’d
 = 
m_¤am_±r
->
	`g‘_num_d©a_’d
();

116 
ušt32_t
 
num_»ad_pÜt
 = 
m_¤am_±r
->
	`g‘_num_»ad_pÜt
();

117 
ušt32_t
 
num_wr™e_pÜt
 = 
m_¤am_±r
->
	`g‘_num_wr™e_pÜt
();

119 cÚ¡ 
TechP¬am‘”
* 

 = 
m_‹ch_·¿m_±r
;

121 
»t
 = 0;

124 
»t
 +ğ(
WmemûÎa
*

->
	`g‘_NMOS_TAB
(0è+ WmemûÎa*
WmemûÎbsÿË
*->
	`g‘_PMOS_TAB
(0))*2;

126 
»t
 +ğ(
WmemûÎr
*

->
	`g‘_NMOS_TAB
(0)*
num_d©a_’d
*
num_»ad_pÜt
);

128 
»t
 +ğ(
WmemûÎw
*

->
	`g‘_NMOS_TAB
(0)*2*
num_wr™e_pÜt
);

130  
»t
;

131 
	}
}

	@ruby/network/orion/Buffer/MemUnit.hh

36 #iâdeà
__MEMUNIT_H__


37 
	#__MEMUNIT_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gSRAM
;

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cMemUn™


46 
	mpublic
:

47 
	eMemMod–


49 
NO_MODEL
 = 0,

50 
	mNORMAL_MEM


53 
	gpublic
:

54 
MemUn™
(

55 cÚ¡ 
¡ršg
& 
mem_mod–_¡r_
,

56 cÚ¡ 
SRAM
* 
¤am_±r_
,

57 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


59 ~
MemUn™
();

61 
	gpublic
:

62 
	$g‘_e_sw™ch
(ècÚ¡ {  
m_e_sw™ch
; 
	}
}

63 
	$g‘_i_¡©ic
(ècÚ¡ {  
m_i_¡©ic
; 
	}
}

65 
	g´iv©e
:

66 
š™
();

67 
ÿlc_mem_ÿp
();

68 
ÿlc_i_¡©ic
();

70 
	g´iv©e
:

71 
MemMod–
 
m_mem_mod–
;

72 cÚ¡ 
SRAM
* 
	gm_¤am_±r
;

73 cÚ¡ 
TechP¬am‘”
* 
	gm_‹ch_·¿m_±r
;

75 
	gm_e_sw™ch
;

76 
	gm_i_¡©ic
;

	@ruby/network/orion/Buffer/OutdrvUnit.cc

36 
	~"ba£/misc.hh
"

37 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/OutdrvUn™.hh
"

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/SRAM.hh
"

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

41 
	gOutdrvUn™
::
	$OutdrvUn™
(

42 cÚ¡ 
¡ršg
& 
outdrv_mod–_¡r_
,

43 cÚ¡ 
SRAM
* 
¤am_±r_
,

44 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


47 ià(
outdrv_mod–_¡r_
 =ğ
	`¡ršg
("CACHE_OUTDRV"))

49 
m_outdrv_mod–
 = 
CACHE_OUTDRV
;

51 ià(
outdrv_mod–_¡r_
 =ğ
	`¡ršg
("REG_OUTDRV"))

53 
m_outdrv_mod–
 = 
REG_OUTDRV
;

57 
m_outdrv_mod–
 = 
NO_MODEL
;

60 ià(
m_outdrv_mod–
 !ğ
NO_MODEL
)

62 
m_¤am_±r
 = 
¤am_±r_
;

63 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

64 
	`š™
();

68 
m_e_£Ëù
 = 0;

69 
m_e_out_1
 = 0;

70 
m_e_out_0
 = 0;

71 
m_e_chg_d©a
 = 0;

73 
	}
}

75 
	gOutdrvUn™
::~
	$OutdrvUn™
()

76 {
	}
}

78 
OutdrvUn™
::
	$š™
()

80 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

82 
m_e_£Ëù
 = 
	`ÿlc_£Ëù_ÿp
(è* 
e_çùÜ
;

83 
m_e_out_1
 = 
	`ÿlc_outd©a_ÿp
(1è* 
e_çùÜ
;

84 
m_e_out_0
 = 
	`ÿlc_outd©a_ÿp
(0è* 
e_çùÜ
;

86 
m_outdrv_mod–
)

88 
CACHE_OUTDRV
:

89 
m_e_chg_d©a
 = 
	`ÿlc_chgd©a_ÿp
(è* 
e_çùÜ
;

91 
REG_OUTDRV
:

92 
m_e_chg_d©a
 = 0;

95 
	`çl
("Incorrect OUTDRIVE model.\n");

98 
m_i_¡©ic
 = 
	`ÿlc_i_¡©ic
();

100 
	}
}

102 
	gOutdrvUn™
::
	$ÿlc_£Ëù_ÿp
()

104 
tÙ®_ÿp
;

107 
Woutdrv£Ê
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdrv£Ê
();

108 
Woutdrv£Í
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdrv£Í
();

109 
tÙ®_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
Woutdrv£Ê
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
Woutdrv£Í
, 1è+ m_‹ch_·¿m_±r->
	`ÿlc_d¿šÿp
(Woutdrv£Ê, 
TechP¬am‘”
::
NCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(Woutdrv£Í, TechP¬am‘”::
PCH
, 1);

113 
ušt32_t
 
lše_width
 = 
m_¤am_±r
->
	`g‘_lše_width
();

114 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

115 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

116 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

117 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

118 
tÙ®_ÿp
 +ğ
lše_width
 * (
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvÇndn
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvÇndp
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜn
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜp
, 1));

119  
tÙ®_ÿp
;

120 
	}
}

122 
	gOutdrvUn™
::
	$ÿlc_chgd©a_ÿp
()

124 
tÙ®_ÿp
;

125 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

126 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

127 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

128 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

130 
tÙ®_ÿp
 = (
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvÇndn
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvÇndp
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜn
, 1è+ m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜp
, 1)) / 2.0;

131  
tÙ®_ÿp
;

132 
	}
}

134 
	gOutdrvUn™
::
	$ÿlc_outd©a_ÿp
(
boŞ
 
v®ue_
)

136 
tÙ®_ÿp
 = 0;

139 ià(
v®ue_
)

142 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

143 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

144 
tÙ®_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WoutdrvÇndn
, 
TechP¬am‘”
::
NCH
, 2è+ 2 * m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
WoutdrvÇndp
, TechP¬am‘”::
PCH
, 1);

149 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

150 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

151 
tÙ®_ÿp
 = 2 * 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WoutdrvnÜn
, 
TechP¬am‘”
::
NCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
WoutdrvnÜp
, TechP¬am‘”::
PCH
, 2);

155 ià(
v®ue_
)

157 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

158 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
Woutdriv”p
, 1);

162 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

163 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
Woutdriv”n
, 1);

168  
tÙ®_ÿp
;

169 
	}
}

171 
	gOutdrvUn™
::
	$ÿlc_i_¡©ic
()

175 
	}
}

	@ruby/network/orion/Buffer/OutdrvUnit.hh

36 #iâdeà
__OUTDRVUNIT_H__


37 
	#__OUTDRVUNIT_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gSRAM
;

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cOutdrvUn™


46 
	mpublic
:

47 
	eOutdrvMod–


49 
NO_MODEL
 = 0,

50 
	mCACHE_OUTDRV
,

51 
	mREG_OUTDRV


54 
	gpublic
:

55 
OutdrvUn™
(

56 cÚ¡ 
¡ršg
& 
outdrv_mod–_¡r_
,

57 cÚ¡ 
SRAM
* 
¤am_±r_
,

58 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


60 ~
OutdrvUn™
();

62 
	gpublic
:

63 
	$g‘_e_£Ëù
(ècÚ¡ {  
m_e_£Ëù
; 
	}
}

64 
	$g‘_e_chg_d©a
(ècÚ¡ {  
m_e_chg_d©a
; 
	}
}

65 
	$g‘_e_out_0
(ècÚ¡ {  
m_e_out_0
; 
	}
}

66 
	$g‘_e_out_1
(ècÚ¡ {  
m_e_out_1
; 
	}
}

68 
	g´iv©e
:

69 
š™
();

70 
ÿlc_£Ëù_ÿp
();

71 
ÿlc_chgd©a_ÿp
();

72 
ÿlc_outd©a_ÿp
(
boŞ
 
v®ue_
);

73 
ÿlc_i_¡©ic
();

75 
	g´iv©e
:

76 
OutdrvMod–
 
m_outdrv_mod–
;

77 cÚ¡ 
SRAM
* 
	gm_¤am_±r
;

78 cÚ¡ 
TechP¬am‘”
* 
	gm_‹ch_·¿m_±r
;

80 
	gm_e_£Ëù
;

81 
	gm_e_out_1
;

82 
	gm_e_out_0
;

83 
	gm_e_chg_d©a
;

85 
	gm_i_¡©ic
;

	@ruby/network/orion/Buffer/PrechargeUnit.cc

36 
	~"ba£/misc.hh
"

37 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/P»ch¬geUn™.hh
"

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/SRAM.hh
"

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

41 
	gP»ch¬geUn™
::
	$P»ch¬geUn™
(

42 cÚ¡ 
¡ršg
& 
´e_mod–_¡r_
,

43 
´e_lßd_
,

44 cÚ¡ 
SRAM
* 
¤am_±r_
,

45 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


48 ià(
´e_mod–_¡r_
 == "SINGLE_BITLINE")

50 
m_´e_mod–
 = 
SINGLE_BITLINE
;

52 ià(
´e_mod–_¡r_
 == "EQU_BITLINE")

54 
m_´e_mod–
 = 
EQU_BITLINE
;

56 ià(
´e_mod–_¡r_
 == "SINGLE_OTHER")

58 
m_´e_mod–
 = 
SINGLE_OTHER
;

62 
m_´e_mod–
 = 
NO_MODEL
;

65 ià(
m_´e_mod–
 !ğ
NO_MODEL
)

67 
m_´e_lßd
 = 
´e_lßd_
;

68 
m_¤am_±r
 = 
¤am_±r_
;

69 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

71 
	`š™
();

73 
	}
}

75 
	gP»ch¬geUn™
::~
	$P»ch¬geUn™
()

77 
	}
}

79 
P»ch¬geUn™
::
	$š™
()

81 
³riod
 = 
m_‹ch_·¿m_±r
->
	`g‘_³riod
();

82 
m_´e_size
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_driv”_psize
(
m_´e_lßd
, 
³riod
/8.0);

84 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

85 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

86 
m_´e_size
 +ğm_´e_size*
Wdecšvn
/
Wdecšvp
;

88 
ušt32_t
 
num_g©e
 = 
	`ÿlc_num_´e_g©e
();

91 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

92 
m_e_ch¬ge_g©e
 = 
	`ÿlc_´e_ÿp
(
m_´e_size
, 10è* 
num_g©e
 * 
e_çùÜ
;

94 
ušt32_t
 
num_d©a_’d
 = 
m_¤am_±r
->
	`g‘_num_d©a_’d
();

95 ià(
num_d©a_’d
 == 2)

97 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_S’£EÃrgyFaùÜ
();

101 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

103 
ušt32_t
 
num_d¿š
 = 
	`ÿlc_num_´e_d¿š
();

104 
m_e_ch¬ge_d¿š
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
m_´e_size
, 
TechP¬am‘”
::
PCH
, 1)*
num_d¿š
*
e_çùÜ
;

107 
PMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_PMOS_TAB
(0);

108 
m_i_¡©ic
 = 
num_g©e
*
m_´e_size
*
PMOS_TAB_0
;

109 
	}
}

111 
ušt32_t
 
	gP»ch¬geUn™
::
	$ÿlc_num_´e_g©e
()

113 
m_´e_mod–
)

115 
SINGLE_BITLINE
:  2;

116 
EQU_BITLINE
:  3;

117 
SINGLE_OTHER
:  1;

118 : 
	`çl
("Incorrect Precharge Unit model.\n");

120 
	}
}

122 
ušt32_t
 
	gP»ch¬geUn™
::
	$ÿlc_num_´e_d¿š
()

124 
m_´e_mod–
)

126 
SINGLE_BITLINE
:  1;

127 
EQU_BITLINE
:  2;

128 
SINGLE_OTHER
:  1;

129 : 
	`çl
("Incorrect Precharge Unit model.\n");

131 
	}
}

133 
	gP»ch¬geUn™
::
	$ÿlc_´e_ÿp
(
width_
, 
Ëngth_
)

135  
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
width_
, 
Ëngth_
);

136 
	}
}

	@ruby/network/orion/Buffer/PrechargeUnit.hh

36 #iâdeà
__PRECHARGEUNIT_H__


37 
	#__PRECHARGEUNIT_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gSRAM
;

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cP»ch¬geUn™


46 
	mpublic
:

47 
	eP»ch¬geMod–


49 
NO_MODEL
 = 0,

50 
	mSINGLE_BITLINE
,

51 
	mEQU_BITLINE
,

52 
	mSINGLE_OTHER


55 
	gpublic
:

56 
P»ch¬geUn™
(

57 cÚ¡ 
¡ršg
& 
´e_mod–_¡r_
,

58 
´e_lßd_
,

59 cÚ¡ 
SRAM
* 
¤am_±r_
,

60 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


62 ~
P»ch¬geUn™
();

64 
	gpublic
:

65 
	$g‘_e_ch¬ge_g©e
(ècÚ¡ {  
m_e_ch¬ge_g©e
; 
	}
}

66 
	$g‘_e_ch¬ge_d¿š
(ècÚ¡ {  
m_e_ch¬ge_d¿š
; 
	}
}

67 
	$g‘_i_¡©ic
(ècÚ¡ {  
m_i_¡©ic
; 
	}
}

69 
	g´iv©e
:

70 
š™
();

71 
ušt32_t
 
ÿlc_num_´e_g©e
();

72 
ušt32_t
 
ÿlc_num_´e_d¿š
();

73 
ÿlc_´e_ÿp
(
width_
, 
Ëngth_
);

75 
	g´iv©e
:

76 
P»ch¬geMod–
 
m_´e_mod–
;

77 
	gm_´e_lßd
;

78 cÚ¡ 
SRAM
* 
	gm_¤am_±r
;

79 cÚ¡ 
TechP¬am‘”
* 
	gm_‹ch_·¿m_±r
;

81 
	gm_´e_size
;

83 
	gm_e_ch¬ge_g©e
;

84 
	gm_e_ch¬ge_d¿š
;

86 
	gm_i_¡©ic
;

	@ruby/network/orion/Buffer/Register.cc

36 
	~<ÿs£¹
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/Regi¡”.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/FlFlİ.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

43 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	gRegi¡”
::
	$Regi¡”
(

46 
ušt32_t
 
num_’Œy_
,

47 
ušt32_t
 
lše_width_
,

48 cÚ¡ 
TechP¬am‘”
 *
‹ch_·¿m_±r_


51 
	`as£¹
(
num_’Œy_
 ==‚um_entry_);

52 
	`as£¹
(
lše_width_
 ==†ine_width_);

54 
m_num_’Œy
 = 
num_’Œy_
;

55 
m_lše_width
 = 
lše_width_
;

56 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

58 
	`š™
();

59 
	}
}

61 
	gRegi¡”
::~
	$Regi¡”
()

63 
d–‘e
 
m_ff_±r
;

64 
	}
}

66 
	gRegi¡”
::
	$ÿlc_e_»ad
() const

69 
e_»ad
 = 0;

76 ià(
m_num_’Œy
 > 1)

78 
e_»ad
 = (
m_avg_»ad
 + 
m_num_’Œy
*0.25*
m_avg_wr™e
);

82 
e_»ad
 = 
m_avg_»ad
;

84  
e_»ad
;

85 
	}
}

87 
	gRegi¡”
::
	$ÿlc_e_wr™e
() const

90 
e_wr™e
 = 0;

92 
e_wr™e
 = 
m_avg_wr™e
;

93  
e_wr™e
;

94 
	}
}

96 
	gRegi¡”
::
	$ÿlc_i_¡©ic
() const

98 
i_¡©ic
 = 
m_ff_±r
->
	`g‘_i_¡©ic
()*
m_lše_width
*
m_num_’Œy
;

100  
i_¡©ic
;

101 
	}
}

103 
	gRegi¡”
::
	$š™
()

105 
m_ff_±r
 = 
Ãw
 
	`FlFlİ
("NEG_DFF", 0, 
m_‹ch_·¿m_±r
);

107 
ušt32_t
 
num_şock
 = 
m_lše_width
;

108 
m_avg_»ad
 = 
m_ff_±r
->
	`g‘_e_şock
()*(()
num_şock
)/2.0;

110 
num_sw™ch
 = 
m_lše_width
/2.0;

111 
m_avg_wr™e
 = 
m_ff_±r
->
	`g‘_e_sw™ch
()*
num_sw™ch
+m_ff_±r->
	`g‘_e_şock
()*
num_şock
;

113 
	}
}

	@ruby/network/orion/Buffer/Register.hh

36 #iâdeà
__REGISTER_H__


37 
	#__REGISTER_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

42 
şass
 
	gFlFlİ
;

44 şas 
	cRegi¡”


46 
	mpublic
:

47 
Regi¡”
(

48 
ušt32_t
 
num_’Œy_
,

49 
ušt32_t
 
lše_width_
,

50 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


52 ~
Regi¡”
();

54 
	mpublic
:

55 
	$ÿlc_e_»ad
() const;

56 
	$ÿlc_e_wr™e
() const;

57 
	$ÿlc_i_¡©ic
() const;

59 
´iv©e
:

60 
	`š™
();

62 
´iv©e
:

63 
ušt32_t
 
m_num_’Œy
;

64 
ušt32_t
 
m_lše_width
;

65 cÚ¡ 
TechP¬am‘”
* 
m_‹ch_·¿m_±r
;

67 
FlFlİ
* 
m_ff_±r
;

69 
m_avg_»ad
;

70 
m_avg_wr™e
;

	@ruby/network/orion/Buffer/SRAM.cc

36 
	~<ÿs£¹
>

37 
	~<cm©h
>

38 
	~<io¡»am
>

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/AmpUn™.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/B™lšeUn™.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/Decod”Un™.hh
"

43 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/MemUn™.hh
"

44 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/OutdrvUn™.hh
"

45 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/P»ch¬geUn™.hh
"

46 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/SRAM.hh
"

47 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/WÜdlšeUn™.hh
"

49 
usšg
 
Çme¥aû
 
	g¡d
;

51 
	gSRAM
::
	$SRAM
(

52 
ušt32_t
 
num_’Œy_
,

53 
ušt32_t
 
lše_width_
,

54 
boŞ
 
is_fifo_
,

55 
boŞ
 
is_outdrv_
,

56 
ušt32_t
 
num_»ad_pÜt_
,

57 
ušt32_t
 
num_wr™e_pÜt_
,

58 
ušt32_t
 
num_d©a_’d_
,

59 cÚ¡ 
¡ršg
& 
rowdec_mod–_¡r_
,

60 cÚ¡ 
¡ršg
& 
wl_mod–_¡r_
,

61 cÚ¡ 
¡ršg
& 
bl_´e_mod–_¡r_
,

62 cÚ¡ 
¡ršg
& 
mem_mod–_¡r_
,

63 cÚ¡ 
¡ršg
& 
bl_mod–_¡r_
,

64 cÚ¡ 
¡ršg
& 
amp_mod–_¡r_
,

65 cÚ¡ 
¡ršg
& 
outdrv_mod–_¡r_
,

66 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


69 
	`as£¹
(
num_’Œy_
 ==‚um_entry_);

70 
	`as£¹
(
lše_width_
 ==†ine_width_);

71 
	`as£¹
(
num_»ad_pÜt_
 ==‚um_read_port_);

72 
	`as£¹
(
num_wr™e_pÜt_
 ==‚um_write_port_);

73 
	`as£¹
(
num_d©a_’d_
 ==‚um_data_end_);

75 
m_num_’Œy
 = 
num_’Œy_
;

76 
m_lše_width
 = 
lše_width_
;

77 
m_is_fifo
 = 
is_fifo_
;

78 
m_is_outdrv
 = 
is_outdrv_
;

80 
m_num_»ad_pÜt
 = 
num_»ad_pÜt_
;

81 
m_num_wr™e_pÜt
 = 
num_wr™e_pÜt_
;

82 
m_num_d©a_’d
 = 
num_d©a_’d_
;

84 
m_rowdec_mod–_¡r
 = 
rowdec_mod–_¡r_
;

85 
m_wl_mod–_¡r
 = 
wl_mod–_¡r_
;

86 
m_bl_´e_mod–_¡r
 = 
bl_´e_mod–_¡r_
;

87 
m_mem_mod–_¡r
 = 
mem_mod–_¡r_
;

88 
m_bl_mod–_¡r
 = 
bl_mod–_¡r_
;

89 
m_amp_mod–_¡r
 = 
amp_mod–_¡r_
;

90 
m_outdrv_mod–_¡r
 = 
outdrv_mod–_¡r_
;

91 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

93 
	`š™
();

94 
	}
}

96 
	gSRAM
::~
	$SRAM
()

98 
d–‘e
 
m_outdrv_un™_±r
;

99 
d–‘e
 
m_amp_un™_±r
;

100 
d–‘e
 
m_bl_un™_±r
;

101 
d–‘e
 
m_mem_un™_±r
;

102 
d–‘e
 
m_bl_´e_un™_±r
;

103 
d–‘e
 
m_wl_un™_±r
;

104 
d–‘e
 
m_rowdec_un™_±r
;

105 
	}
}

107 
	gSRAM
::
	$ÿlc_e_»ad
(

108 
boŞ
 
is_max_


111 
e_©omic
;

112 
e_»ad
 = 0;

115 ià(
m_rowdec_un™_±r
 !ğ
NULL
)

117 
e_©omic
 = 
m_rowdec_un™_±r
->
	`g‘_e_chg_addr
()*m_rowdec_un™_±r->
	`g‘_dec_width
()*(
is_max_
? 1:0.5);

118 
e_©omic
 +ğ
m_rowdec_un™_±r
->
	`g‘_e_chg_ouut
();

120 
e_©omic
 +ğ
m_rowdec_un™_±r
->
	`g‘_e_chg_l1
()*m_rowdec_un™_±r->
	`g‘_num_š_2nd
();

121 
e_»ad
 +ğ
e_©omic
;

125 
e_©omic
 = 
m_wl_un™_±r
->
	`g‘_e_»ad
();

126 
e_»ad
 +ğ
e_©omic
;

129 
e_©omic
 = 
m_bl_´e_un™_±r
->
	`g‘_e_ch¬ge_g©e
()*
m_lše_width
;

130 ià(
m_num_d©a_’d
 == 2)

132 
e_©omic
 +ğ
m_bl_´e_un™_±r
->
	`g‘_e_ch¬ge_d¿š
()*
m_lše_width
;

136 
e_©omic
 +ğ
m_bl_´e_un™_±r
->
	`g‘_e_ch¬ge_d¿š
()*
m_lše_width
*(
is_max_
? 1:0.5);

138 
e_»ad
 +ğ
e_©omic
;

141 ià(
m_num_d©a_’d
 == 2)

143 
e_©omic
 = 
m_bl_un™_±r
->
	`g‘_e_cŞ_»ad
()*
m_lše_width
;

147 
e_©omic
 = 
m_bl_un™_±r
->
	`g‘_e_cŞ_»ad
()*
m_lše_width
*(
is_max_
? 1:0.5);

149 
e_»ad
 +ğ
e_©omic
;

151 ià(
m_num_d©a_’d
 == 2)

153 
e_©omic
 = 
m_amp_un™_±r
->
	`g‘_e_acûss
()*
m_lše_width
;

154 
e_»ad
 +ğ
e_©omic
;

157 ià(
m_outdrv_un™_±r
 !ğ
NULL
)

159 
e_©omic
 = 
m_outdrv_un™_±r
->
	`g‘_e_£Ëù
();

161 
e_©omic
 +ğ
m_outdrv_un™_±r
->
	`g‘_e_chg_d©a
()*
m_lše_width
*(
is_max_
? 1:0.5);

164 ià((
m_outdrv_un™_±r
->
	`g‘_e_out_1
(è>ğm_outdrv_un™_±r->
	`g‘_e_out_0
()è|| (!
is_max_
))

166 
e_©omic
 +ğ
m_outdrv_un™_±r
->
	`g‘_e_out_1
()*
m_lše_width
*(
is_max_
? 1:0.5);

168 ià((
m_outdrv_un™_±r
->
	`g‘_e_out_1
(è< m_outdrv_un™_±r->
	`g‘_e_out_0
()è|| (!
is_max_
))

170 
e_©omic
 +ğ
m_outdrv_un™_±r
->
	`g‘_e_out_0
()*
m_lše_width
*(
is_max_
? 1:0.5);

173 
e_»ad
 +ğ
e_©omic
;

176  
e_»ad
;

177 
	}
}

179 
	gSRAM
::
	$ÿlc_e_wr™e
(

180 
boŞ
 
is_max_


183 
e_©omic
;

184 
e_wr™e
 = 0;

187 ià(
m_rowdec_un™_±r
 !ğ
NULL
)

189 
e_©omic
 = 
m_rowdec_un™_±r
->
	`g‘_e_chg_addr
()*m_rowdec_un™_±r->
	`g‘_dec_width
()*(
is_max_
? 1:0.5);

190 
e_©omic
 +ğ
m_rowdec_un™_±r
->
	`g‘_e_chg_ouut
();

192 
e_©omic
 +ğ
m_rowdec_un™_±r
->
	`g‘_e_chg_l1
()*m_rowdec_un™_±r->
	`g‘_num_š_2nd
();

193 
e_wr™e
 +ğ
e_©omic
;

197 
e_©omic
 = 
m_wl_un™_±r
->
	`g‘_e_wr™e
();

198 
e_wr™e
 +ğ
e_©omic
;

201 
e_©omic
 = 
m_bl_un™_±r
->
	`g‘_e_cŞ_w¹›
()*
m_lše_width
*(
is_max_
? 1:0.5);

202 
e_wr™e
 +ğ
e_©omic
;

205 
e_©omic
 = 
m_mem_un™_±r
->
	`g‘_e_sw™ch
()*
m_lše_width
*(
is_max_
? 1:0.5);

206 
e_wr™e
 +ğ
e_©omic
;

208  
e_wr™e
;

209 
	}
}

211 
	gSRAM
::
	$ÿlc_i_¡©ic
() const

213 
i_¡©ic
 = 0;

215 
i_¡©ic
 +ğ
m_bl_un™_±r
->
	`g‘_i_¡©ic
()*
m_lše_width
*
m_num_wr™e_pÜt
;

216 
i_¡©ic
 +ğ
m_mem_un™_±r
->
	`g‘_i_¡©ic
()*
m_num_’Œy
*
m_lše_width
;

217 
i_¡©ic
 +ğ
m_bl_´e_un™_±r
->
	`g‘_i_¡©ic
()*
m_lše_width
*
m_num_»ad_pÜt
;

218 
i_¡©ic
 +ğ
m_wl_un™_±r
->
	`g‘_i_¡©ic
()*
m_num_’Œy
*(
m_num_»ad_pÜt
+
m_num_wr™e_pÜt
);

220  
i_¡©ic
;

221 
	}
}

223 
	gSRAM
::
	$š™
()

226 ià(
m_is_outdrv
)

228 
m_outdrv_un™_±r
 = 
Ãw
 
	`OutdrvUn™
(
m_outdrv_mod–_¡r
, 
this
, 
m_‹ch_·¿m_±r
);

232 
m_outdrv_un™_±r
 = 
NULL
;

236 ià(
m_num_d©a_’d
 == 2)

238 
m_amp_un™_±r
 = 
Ãw
 
	`AmpUn™
(
m_amp_mod–_¡r
, 
m_‹ch_·¿m_±r
);

242 
m_amp_un™_±r
 = 
NULL
;

246 
m_bl_un™_±r
 = 
Ãw
 
	`B™lšeUn™
(
m_bl_mod–_¡r
, 
this
, 
m_‹ch_·¿m_±r
);

249 
m_mem_un™_±r
 = 
Ãw
 
	`MemUn™
(
m_mem_mod–_¡r
, 
this
, 
m_‹ch_·¿m_±r
);

252 
bl_´e_un™_lßd
 = 
m_bl_un™_±r
->
	`g‘_´e_un™_lßd
();

253 
m_bl_´e_un™_±r
 = 
Ãw
 
	`P»ch¬geUn™
(
m_bl_´e_mod–_¡r
, 
bl_´e_un™_lßd
, 
this
, 
m_‹ch_·¿m_±r
);

256 
m_wl_un™_±r
 = 
Ãw
 
	`WÜdlšeUn™
(
m_wl_mod–_¡r
, 
this
, 
m_‹ch_·¿m_±r
);

259 ià(!
m_is_fifo
)

261 
m_rowdec_width
 = (
ušt32_t
)
	`log2
(()
m_num_’Œy
);

262 
m_rowdec_un™_±r
 = 
Ãw
 
	`Decod”Un™
(
m_rowdec_mod–_¡r
, 
m_rowdec_width
, 
m_‹ch_·¿m_±r
);

266 
m_rowdec_un™_±r
 = 
NULL
;

269 
	}
}

	@ruby/network/orion/Buffer/SRAM.hh

36 #iâdeà
__SRAM_H__


37 
	#__SRAM_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

43 
şass
 
	gOutdrvUn™
;

44 
şass
 
	gAmpUn™
;

45 
şass
 
	gB™lšeUn™
;

46 
şass
 
	gMemUn™
;

47 
şass
 
	gP»ch¬geUn™
;

48 
şass
 
	gWÜdlšeUn™
;

49 
şass
 
	gDecod”Un™
;

51 şas 
	cSRAM


53 
	mpublic
:

54 
SRAM
(

55 
ušt32_t
 
num_’Œy_
,

56 
ušt32_t
 
lše_width_
,

57 
boŞ
 
is_fifo_
,

58 
boŞ
 
is_outdrv_
,

59 
ušt32_t
 
num_»ad_pÜt_
,

60 
ušt32_t
 
num_wr™e_pÜt_
,

61 
ušt32_t
 
num_d©a_’d_
,

62 cÚ¡ 
¡ršg
& 
rowdec_mod–_¡r_
,

63 cÚ¡ 
¡ršg
& 
wl_mod–_¡r_
,

64 cÚ¡ 
¡ršg
& 
bl_´e_mod–_¡r_
,

65 cÚ¡ 
¡ršg
& 
mem_mod–_¡r_
,

66 cÚ¡ 
¡ršg
& 
bl_mod–_¡r_
,

67 cÚ¡ 
¡ršg
& 
amp_mod–_¡r_
,

68 cÚ¡ 
¡ršg
& 
outdrv_mod–_¡r_
,

69 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


71 ~
SRAM
();

73 
	mpublic
:

74 
ušt32_t
 
	$g‘_lše_width
(ècÚ¡ {  
m_lše_width
; }

75 
ušt32_t
 
	$g‘_num_d©a_’d
(ècÚ¡ {  
m_num_d©a_’d
; 
	}
}

76 
ušt32_t
 
	$g‘_num_»ad_pÜt
(ècÚ¡ {  
m_num_»ad_pÜt
; 
	}
}

77 
ušt32_t
 
	$g‘_num_wr™e_pÜt
(ècÚ¡ {  
m_num_wr™e_pÜt
; 
	}
}

78 
ušt32_t
 
	$g‘_num_pÜt
(ècÚ¡ {  (
m_num_»ad_pÜt
+
m_num_wr™e_pÜt
); 
	}
}

79 
boŞ
 
	$g‘_is_outdrv
(ècÚ¡ {  
m_is_outdrv
; 
	}
}

80 
ušt32_t
 
	$g‘_num_row
(ècÚ¡ {  
m_num_’Œy
; 
	}
}

81 
ušt32_t
 
	$g‘_num_cŞ
(ècÚ¡ {  
m_lše_width
; 
	}
}

83 
	$ÿlc_e_»ad
(
boŞ
 
is_max_
) const;

84 
	$ÿlc_e_wr™e
(
boŞ
 
is_max_
) const;

85 
	$ÿlc_i_¡©ic
() const;

87 
´iv©e
:

88 
	`š™
();

90 
´iv©e
:

91 
ušt32_t
 
m_num_’Œy
;

92 
ušt32_t
 
m_lše_width
;

93 
boŞ
 
m_is_fifo
;

94 
boŞ
 
m_is_outdrv
;

95 
¡ršg
 
m_rowdec_mod–_¡r
;

96 
¡ršg
 
m_wl_mod–_¡r
;

97 
¡ršg
 
m_bl_´e_mod–_¡r
;

98 
¡ršg
 
m_mem_mod–_¡r
;

99 
¡ršg
 
m_bl_mod–_¡r
;

100 
¡ršg
 
m_amp_mod–_¡r
;

101 
¡ršg
 
m_outdrv_mod–_¡r
;

102 cÚ¡ 
TechP¬am‘”
* 
m_‹ch_·¿m_±r
;

104 
OutdrvUn™
* 
m_outdrv_un™_±r
;

105 
AmpUn™
* 
m_amp_un™_±r
;

106 
B™lšeUn™
* 
m_bl_un™_±r
;

107 
MemUn™
* 
m_mem_un™_±r
;

108 
P»ch¬geUn™
* 
m_bl_´e_un™_±r
;

109 
WÜdlšeUn™
* 
m_wl_un™_±r
;

110 
Decod”Un™
* 
m_rowdec_un™_±r
;

112 
ušt32_t
 
m_num_»ad_pÜt
;

113 
ušt32_t
 
m_num_wr™e_pÜt
;

114 
ušt32_t
 
m_num_d©a_’d
;

116 
ušt32_t
 
m_rowdec_width
;

117 
	}
};

	@ruby/network/orion/Buffer/WordlineUnit.cc

36 
	~"ba£/misc.hh
"

37 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/SRAM.hh
"

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/WÜdlšeUn™.hh
"

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

41 
	gWÜdlšeUn™
::
	$WÜdlšeUn™
(

42 cÚ¡ 
¡ršg
& 
wl_mod–_¡r_
,

43 cÚ¡ 
SRAM
* 
¤am_±r_
,

44 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


47 ià(
wl_mod–_¡r_
 =ğ
	`¡ršg
("RW_WORDLINE"))

49 
m_wl_mod–
 = 
RW_WORDLINE
;

51 ià(
wl_mod–_¡r_
 =ğ
	`¡ršg
("WO_WORDLINE"))

53 
m_wl_mod–
 = 
WO_WORDLINE
;

57 
m_wl_mod–
 = 
NO_MODEL
;

60 ià(
m_wl_mod–
 !ğ
NO_MODEL
)

62 
m_¤am_±r
 = 
¤am_±r_
;

63 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

65 
	`š™
();

67 
	}
}

69 
	gWÜdlšeUn™
::~
	$WÜdlšeUn™
()

70 {
	}
}

72 
WÜdlšeUn™
::
	$š™
()

74 
ušt32_t
 
num_pÜt
 = 
m_¤am_±r
->
	`g‘_num_pÜt
();

75 
ušt32_t
 
num_»ad_pÜt
 = 
m_¤am_±r
->
	`g‘_num_»ad_pÜt
();

76 
ušt32_t
 
num_cŞ
 = 
m_¤am_±r
->
	`g‘_num_cŞ
();

77 
ušt32_t
 
num_d©a_’d
 = 
m_¤am_±r
->
	`g‘_num_d©a_’d
();

78 
RegC–lWidth
 = 
m_‹ch_·¿m_±r
->
	`g‘_RegC–lWidth
();

79 
B™lšeS·cšg
 = 
m_‹ch_·¿m_±r
->
	`g‘_B™lšeS·cšg
();

81 ià(
num_d©a_’d
 == 2)

83 
m_wl_Ën
 = 
num_cŞ
*(
RegC–lWidth
 + 2*
num_pÜt
*
B™lšeS·cšg
);

87 
m_wl_Ën
 = 
num_cŞ
*(
RegC–lWidth
 + (2*
num_pÜt
-
num_»ad_pÜt
)*
B™lšeS·cšg
);

90 
wl_cm‘®
;

91 ià(
num_pÜt
 > 1)

93 
wl_cm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_CC3M3m‘®
();

97 
wl_cm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_CM3m‘®
();

100 
m_wl_wœe_ÿp
 = 
m_wl_Ën
*
wl_cm‘®
;

102 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

103 
WmemûÎr
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎr
();

104 
WmemûÎw
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎw
();

105 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

106 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

107 
NMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NMOS_TAB
(0);

108 
PMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_PMOS_TAB
(0);

109 
m_wl_mod–
)

111 
RW_WORDLINE
:

112 
m_e_»ad
 = 
	`ÿlc_wÜdlše_ÿp
(
num_cŞ
*
num_d©a_’d
, 
WmemûÎr
è* 
e_çùÜ
;

113 
m_e_wr™e
 = 
	`ÿlc_wÜdlše_ÿp
(
num_cŞ
*2, 
WmemûÎw
è* 
e_çùÜ
;

114 
m_i_¡©ic
 = (
Woutdriv”n
*
NMOS_TAB_0
 + 
Woutdriv”p
*
PMOS_TAB_0
);

116 
WO_WORDLINE
:

117 
m_e_»ad
 = 0;

118 
m_e_wr™e
 = 
	`ÿlc_wÜdlše_ÿp
(
num_cŞ
*2, 
WmemûÎw
)*
e_çùÜ
;

119 
m_i_¡©ic
 = 0;

122 
	`çl
("Incorrect Wordline model.\n");

125 
	}
}

127 
	gWÜdlšeUn™
::
	$ÿlc_wÜdlše_ÿp
(

128 
ušt32_t
 
num_mos_
,

129 
mos_width_


132 
tÙ®_ÿp
;

135 
B™Width
 = 
m_‹ch_·¿m_±r
->
	`g‘_B™Width
();

136 
tÙ®_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿµass
(
mos_width_
, 
B™Width
/2.0-mos_width_)*
num_mos_
 + 
m_wl_wœe_ÿp
;

139 
³riod
 = 
m_‹ch_·¿m_±r
->
	`g‘_³riod
();

140 
psize
, 
nsize
;

141 
psize
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_driv”_psize
(
tÙ®_ÿp
, 
³riod
/16.0);

142 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

143 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

144 
nsize
 = 
psize
*
Wdecšvn
/
Wdecšvp
;

147 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
nsize
, 
TechP¬am‘”
::
NCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
psize
, TechP¬am‘”::
PCH
, 1è+ m_‹ch_·¿m_±r->
	`ÿlc_g©eÿp
(psize+nsize, 20);

149  
tÙ®_ÿp
;

150 
	}
}

	@ruby/network/orion/Buffer/WordlineUnit.hh

36 #iâdeà
__WORDLINEUNIT_H__


37 
	#__WORDLINEUNIT_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gSRAM
;

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cWÜdlšeUn™


46 
	mpublic
:

47 
	eWÜdlšeMod–


49 
NO_MODEL
 = 0,

50 
	mRW_WORDLINE
,

51 
	mWO_WORDLINE


54 
	gpublic
:

55 
WÜdlšeUn™
(

56 cÚ¡ 
¡ršg
& 
wl_mod–_¡r_
,

57 cÚ¡ 
SRAM
* 
¤am_±r_
,

58 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


60 ~
WÜdlšeUn™
();

62 
	gpublic
:

63 
	$g‘_e_»ad
(ècÚ¡ {  
m_e_»ad
; 
	}
}

64 
	$g‘_e_wr™e
(ècÚ¡ {  
m_e_wr™e
; 
	}
}

65 
	$g‘_i_¡©ic
(ècÚ¡ {  
m_i_¡©ic
; 
	}
}

67 
	g´iv©e
:

68 
š™
();

69 
	$ÿlc_wÜdlše_ÿp
(
ušt32_t
 
num_mos_
, 
mos_width_
) const;

70 
	`ÿlc_i_¡©ic
();

72 
´iv©e
:

73 
WÜdlšeMod–
 
m_wl_mod–
;

74 cÚ¡ 
SRAM
* 
m_¤am_±r
;

75 cÚ¡ 
TechP¬am‘”
* 
m_‹ch_·¿m_±r
;

77 
m_wl_Ën
;

78 
m_wl_wœe_ÿp
;

80 
m_e_»ad
;

81 
m_e_wr™e
;

83 
m_i_¡©ic
;

84 
	}
};

	@ruby/network/orion/Clock.cc

36 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Clock.hh
"

37 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Wœe.hh
"

41 
	gClock
::
	$Clock
(

42 
boŞ
 
is_š_buf_
,

43 
boŞ
 
is_š_sh¬ed_sw™ch_
,

44 
boŞ
 
is_out_buf_
,

45 
boŞ
 
is_out_sh¬ed_sw™ch_
,

46 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


49 
m_is_š_buf
 = 
is_š_buf_
;

50 
m_is_š_sh¬ed_sw™ch
 = 
is_š_sh¬ed_sw™ch_
;

51 
m_is_out_buf
 = 
is_out_buf_
;

52 
m_is_out_sh¬ed_sw™ch
 = 
is_out_sh¬ed_sw™ch_
;

53 
m_ÜiÚ_cfg_±r
 = 
ÜiÚ_cfg_±r_
;

55 
	`š™
();

56 
	}
}

58 
	gClock
::~
	$Clock
()

59 {
	}
}

61 
Clock
::
	$g‘_dyÇmic_’”gy
() const

63  (
m_e_pe_»g
 + 
m_e_hŒ“
);

64 
	}
}

66 
	gClock
::
	$g‘_¡©ic_pow”
() const

68 
vdd
 = 
m_‹ch_·¿m_±r
->
	`g‘_vdd
();

69  (
m_i_¡©ic
*
vdd
);

70 
	}
}

72 
	gClock
::
	$š™
()

74 
m_‹ch_·¿m_±r
 = 
m_ÜiÚ_cfg_±r
->
	`g‘_‹ch_·¿m_±r
();

76 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

79 
ušt32_t
 
num_š_pÜt
 = 
m_ÜiÚ_cfg_±r
->
	`g‘_num_š_pÜt
();

80 
ušt32_t
 
num_out_pÜt
 = 
m_ÜiÚ_cfg_±r
->
	`g‘_num_out_pÜt
();

81 
ušt32_t
 
num_vşass
 = 
m_ÜiÚ_cfg_±r
->
	`g‘_num_vşass
();

82 
ušt32_t
 
num_vchªÃl
 = 
m_ÜiÚ_cfg_±r
->
	`g‘_num_vchªÃl
();

83 
ušt32_t
 
æ™_width
 = 
m_ÜiÚ_cfg_±r
->
	`g‘_æ™_width
();

85 
ušt32_t
 
num_pe_»g
 = 0;

88 
num_pe_»g
 +ğ
num_š_pÜt
*
æ™_width
;

91 ià(
m_is_š_buf
)

93 ià(
m_is_š_sh¬ed_sw™ch
)

95 
num_pe_»g
 +ğ
num_š_pÜt
*
æ™_width
;

99 
num_pe_»g
 +ğ
num_š_pÜt
*
num_vşass
*
num_vchªÃl
*
æ™_width
;

104 ià(
m_is_out_sh¬ed_sw™ch
)

106 
num_pe_»g
 +ğ
num_out_pÜt
*
æ™_width
;

110 
num_pe_»g
 +ğ
num_out_pÜt
*
num_vşass
*
num_vchªÃl
*
æ™_width
;

114 ià(
m_is_out_buf
)

116 
num_pe_»g
 +ğ
num_out_pÜt
*
æ™_width
;

119 
ÿp_şock
 = 
m_‹ch_·¿m_±r
->
	`g‘_ClockC­
();

120 
m_e_pe_»g
 = 
num_pe_»g
*
ÿp_şock
*
e_çùÜ
;

127 
i_¡©ic_nmos
 = 0;

128 
i_¡©ic_pmos
 = 0;

130 
boŞ
 
is_hŒ“
 = 
m_ÜiÚ_cfg_±r
->
g‘
<bool>("IS_HTREE_CLOCK");

131 if(
is_hŒ“
)

133 cÚ¡ 
¡ršg
& 
width_¥acšg_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("WIRE_WIDTH_SPACING");

134 cÚ¡ 
¡ršg
& 
buf_scheme_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("WIRE_BUFFERING_MODEL");

135 
boŞ
 
is_sh›ldšg
 = 
m_ÜiÚ_cfg_±r
->
g‘
<bool>("WIRE_IS_SHIELDING");

136 
Wœe
 
	`wœe
(
width_¥acšg_mod–_¡r
, 
buf_scheme_¡r
, 
is_sh›ldšg
, 
m_‹ch_·¿m_±r
);

138 
rou‹r_dŸgÚ®
 = 
m_ÜiÚ_cfg_±r
->
g‘
<>("ROUTER_DIAGONAL");

139 
Clockwœe
 = 
m_‹ch_·¿m_±r
->
	`g‘_ClockC­
();

141 
hŒ“_şockÿp
;

142 
k
;

143 
h
;

145 
BufãrNMOSOffCu¼’t
 = 
m_‹ch_·¿m_±r
->
	`g‘_BufãrNMOSOffCu¼’t
();

146 
BufãrPMOSOffCu¼’t
 = 
m_‹ch_·¿m_±r
->
	`g‘_BufãrPMOSOffCu¼’t
();

148 ià(
m_‹ch_·¿m_±r
->
	`is_Œªs_ty³_hvt
(è|| m_‹ch_·¿m_±r->
	`is_Œªs_ty³_nvt
())

150 
hŒ“_şockÿp
 = (4+4+2+2)*(
rou‹r_dŸgÚ®
*1e-6)*
Clockwœe
;

152 
wœe
.
	`ÿlc_İt_bufãršg
(&
k
, &
h
, ((4+4+2+2)*
rou‹r_dŸgÚ®
*1e-6));

153 
i_¡©ic_nmos
 = 
BufãrNMOSOffCu¼’t
*
h
*
k
*15;

154 
i_¡©ic_pmos
 = 
BufãrPMOSOffCu¼’t
*
h
*
k
*15;

158 
hŒ“_şockÿp
 = (8+4+4+4+4)*(
rou‹r_dŸgÚ®
*1e-6)*
Clockwœe
;

160 
wœe
.
	`ÿlc_İt_bufãršg
(&
k
, &
h
, ((4+4+2+2)*
rou‹r_dŸgÚ®
*1e-6));

161 
i_¡©ic_nmos
 = 
BufãrNMOSOffCu¼’t
*
h
*
k
*29;

162 
i_¡©ic_pmos
 = 
BufãrPMOSOffCu¼’t
*
h
*
k
*15;

165 
m_e_hŒ“
 = (
hŒ“_şockÿp
+
ÿp_şock
)*
e_çùÜ
;

169 
m_e_hŒ“
 = 0;

172 
SCALE_S
 = 
m_‹ch_·¿m_±r
->
	`g‘_SCALE_S
();

173 
DFF_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_DFF_TAB
(0);

174 
Wdff
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdff
();

175 
m_i_¡©ic
 = (((
i_¡©ic_nmos
+
i_¡©ic_pmos
)/2)/
SCALE_S
 + (
num_pe_»g
*
DFF_TAB_0
*
Wdff
));

176 
	}
}

	@ruby/network/orion/Clock.hh

36 #iâdeà
__CLOCK_H__


37 
	#__CLOCK_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

42 
şass
 
	gOriÚCÚfig
;

44 şas 
	cClock


46 
	mpublic
:

47 
Clock
(

48 
boŞ
 
is_š_buf_
,

49 
boŞ
 
is_š_sh¬ed_sw™ch_
,

50 
boŞ
 
is_out_buf_
,

51 
boŞ
 
is_out_sh¬ed_sw™ch_
,

52 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


54 ~
Clock
();

56 
	mpublic
:

57 
	$g‘_dyÇmic_’”gy
() const;

58 
	$g‘_¡©ic_pow”
() const;

60 
´iv©e
:

61 
	`š™
();

62 
	`ÿlc_ÿp_pe_»g
();

64 
´iv©e
:

65 
boŞ
 
m_is_š_buf
;

66 
boŞ
 
m_is_š_sh¬ed_sw™ch
;

67 
boŞ
 
m_is_out_buf
;

68 
boŞ
 
m_is_out_sh¬ed_sw™ch
;

69 cÚ¡ 
OriÚCÚfig
* 
m_ÜiÚ_cfg_±r
;

70 cÚ¡ 
TechP¬am‘”
* 
m_‹ch_·¿m_±r
;

72 
m_e_pe_»g
;

73 
m_e_hŒ“
;

74 
m_i_¡©ic
;

	@ruby/network/orion/ConfigFile.cc

31 
	~"mem/ruby/ÃtwÜk/ÜiÚ/CÚfigFe.hh
"

33 
usšg
 
	g¡d
::
¡ršg
;

35 
	gCÚfigFe
::
	$CÚfigFe
Ğ
¡ršg
 
f’ame
, sŒšg 
d–im™”
,

36 
¡ršg
 
comm’t
, sŒšg 
£Áry
 )

37 : 
	`myD–im™”
(
d–im™”
), 
	`myComm’t
(
comm’t
), 
	$myS’Œy
(
£Áry
)

41 
¡d
::
if¡»am
 
	`š
Ğ
f’ame
.
	`c_¡r
() );

43 ifĞ!
š
 ) 
throw
 
	`fe_nÙ_found
Ğ
f’ame
 );

45 
š
 >> (*
this
);

46 
	}
}

49 
	gCÚfigFe
::
	$CÚfigFe
()

50 : 
	`myD–im™”
Ğ
	`¡ršg
(1,'='è), 
	`myComm’t
( string(1,'#') )

53 
	}
}

56 
	gCÚfigFe
::
	$»move
ĞcÚ¡ 
¡ršg
& 
key
 )

59 
myCÚ‹Ás
.
	`”a£
ĞmyCÚ‹Ás.
	`fšd
Ğ
key
 ) );

61 
	}
}

64 
boŞ
 
	gCÚfigFe
::
	$keyExi¡s
ĞcÚ¡ 
¡ršg
& 
key
 ) const

67 
m­ci
 
p
 = 
myCÚ‹Ás
.
	`fšd
Ğ
key
 );

68  ( 
p
 !ğ
myCÚ‹Ás
.
	`’d
() );

69 
	}
}

73 
	gCÚfigFe
::
	$Œim
Ğ
¡ršg
& 
s
 )

76 cÚ¡ 
wh™e¥aû
[] = " \n\t\v\r\f";

77 
s
.
	`”a£
Ğ0, s.
	`fšd_fœ¡_nÙ_of
(
wh™e¥aû
) );

78 
s
.
	`”a£
Ğs.
	`fšd_Ï¡_nÙ_of
(
wh™e¥aû
) + 1U );

79 
	}
}

82 
	g¡d
::
o¡»am
& 
İ”©Ü
<<Ğ
¡d
::o¡»am& 
os
, cÚ¡ 
	gCÚfigFe
& 
	gcf
 )

85  
	gCÚfigFe
::
m­ci
 
p
 = 
cf
.
myCÚ‹Ás
.
begš
();

86 
	gp
 !ğ
cf
.
myCÚ‹Ás
.
’d
();

87 ++
	gp
 )

89 
	gos
 << 
	gp
->
	gfœ¡
 << " " << 
	gcf
.
	gmyD–im™”
 << " ";

90 
	gos
 << 
	gp
->
	g£cÚd
 << 
	g¡d
::
’dl
;

92  
	gos
;

96 
	g¡d
::
i¡»am
& 
İ”©Ü
>>Ğ
¡d
::i¡»am& 
is
, 
	gCÚfigFe
& 
	gcf
 )

100 
	g¡ršg
::
	tsize_ty³
 
	tpos
;

101 cÚ¡ 
	g¡ršg
& 
	gd–im
 = 
cf
.
myD–im™”
;

102 cÚ¡ 
	g¡ršg
& 
	gcomm
 = 
cf
.
myComm’t
;

103 cÚ¡ 
	g¡ršg
& 
	g£Áry
 = 
cf
.
myS’Œy
;

104 cÚ¡ 
pos
 
	gsk
 = 
d–im
.
Ëngth
();

106 
¡ršg
 
	gÃxše
 = "";

108  
	gis
 || 
	gÃxše
.
Ëngth
() > 0 )

111 
¡ršg
 
	glše
;

112 ifĞ
	gÃxše
.
Ëngth
() > 0 )

114 
	glše
 = 
Ãxše
;

115 
	gÃxše
 = "";

119 
	g¡d
::
g‘lše
Ğ
is
, 
lše
 );

123 
	glše
 = 
lše
.
sub¡r
Ğ0,†še.
fšd
(
comm
) );

126 ifĞ
	g£Áry
 !ğ"" && 
lše
.
fšd
(
£Áry
è!ğ
¡ršg
::
Åos
 )  
is
;

129 
pos
 
	gd–imPos
 = 
lše
.
fšd
Ğ
d–im
 );

130 ifĞ
	gd–imPos
 < 
	g¡ršg
::
Åos
 )

133 
¡ršg
 
key
 = 
lše
.
sub¡r
Ğ0, 
d–imPos
 );

134 
	glše
.
»¶aû
Ğ0, 
d–imPos
+
sk
, "" );

139 
boŞ
 
	g‹rmš©e
 = 
çl£
;

140  !
	g‹rmš©e
 && 
	gis
 )

142 
	g¡d
::
g‘lše
Ğ
is
, 
Ãxše
 );

143 
	g‹rmš©e
 = 
Œue
;

145 
¡ršg
 
	gÆcİy
 = 
Ãxše
;

146 
	gCÚfigFe
::
Œim
(
Æcİy
);

147 ifĞ
	gÆcİy
 == "" ) ;

149 
	gÃxše
 = 
Ãxše
.
sub¡r
Ğ0,‚exše.
fšd
(
comm
) );

150 ifĞ
	gÃxše
.
fšd
(
d–im
è!ğ
¡ršg
::
Åos
 )

152 ifĞ
	g£Áry
 !ğ"" && 
Ãxše
.
fšd
(
£Áry
è!ğ
¡ršg
::
Åos
 )

155 
	gÆcİy
 = 
Ãxše
;

156 
	gCÚfigFe
::
Œim
(
Æcİy
);

157 ifĞ
	gÆcİy
 !ğ"" ) 
lše
 += "\n";

158 
	glše
 +ğ
Ãxše
;

159 
	g‹rmš©e
 = 
çl£
;

163 
	gCÚfigFe
::
Œim
(
key
);

164 
	gCÚfigFe
::
Œim
(
lše
);

165 
	gcf
.
	gmyCÚ‹Ás
[
key
] = 
lše
;

169  
	gis
;

	@ruby/network/orion/ConfigFile.hh

42 #iâdeà
CONFIGFILE_H


43 
	#CONFIGFILE_H


	)

45 
	~<f¡»am
>

46 
	~<io¡»am
>

47 
	~<m­
>

48 
	~<s¡»am
>

49 
	~<¡ršg
>

51 
usšg
 
	g¡d
::
¡ršg
;

53 şas 
	cCÚfigFe
 {

55 
	m´Ùeùed
:

56 
¡ršg
 
myD–im™”
;

57 
¡ršg
 
	mmyComm’t
;

58 
¡ršg
 
	mmyS’Œy
;

59 
	m¡d
::
m­
<
¡ršg
,
	m¡ršg
> 
	mmyCÚ‹Ás
;

61 
	m¡d
::
	tm­
<
	t¡ršg
,¡ršg>::
	t™”©Ü
 
	tm­i
;

62 
	m¡d
::
	tm­
<
	t¡ršg
,¡ršg>::
	tcÚ¡_™”©Ü
 
	tm­ci
;

65 
	mpublic
:

66 
CÚfigFe
Ğ
¡ršg
 
f’ame
,

67 
¡ršg
 
d–im™”
 = "=",

68 
¡ršg
 
comm’t
 = "#",

69 
¡ršg
 
£Áry
 = "EndConfigFile" );

70 
CÚfigFe
();

73 
	m‹m¶©e
<
şass
 
	mT
> 
T
 
	$»ad
ĞcÚ¡ 
¡ršg
& 
key
 ) const;

74 
‹m¶©e
<
şass
 
T
> T 
	$»ad
ĞcÚ¡ 
¡ršg
& 
key
, cÚ¡ 
T
& 
v®ue
 ) const;

75 
‹m¶©e
<
şass
 
T
> 
boŞ
 
	$»adIÁo
Ğ
T
& 
v¬
, cÚ¡ 
¡ršg
& 
key
 ) const;

76 
‹m¶©e
<
şass
 
T
>

77 
boŞ
 
	$»adIÁo
Ğ
T
& 
v¬
, cÚ¡ 
¡ršg
& 
key
, cÚ¡ T& 
v®ue
 ) const;

80 
‹m¶©e
<
şass
 
T
> 
	`add
Ğ
¡ršg
 
key
, cÚ¡ T& 
v®ue
 );

81 
	`»move
ĞcÚ¡ 
¡ršg
& 
key
 );

84 
boŞ
 
	$keyExi¡s
ĞcÚ¡ 
¡ršg
& 
key
 ) const;

87 
¡ršg
 
	$g‘D–im™”
(ècÚ¡ {  
myD–im™”
; }

88 
¡ršg
 
	$g‘Comm’t
(ècÚ¡ {  
myComm’t
; 
	}
}

89 
¡ršg
 
	$g‘S’Œy
(ècÚ¡ {  
myS’Œy
; 
	}
}

90 
¡ršg
 
	$£tD–im™”
ĞcÚ¡ 
¡ršg
& 
s
 )

91 { 
¡ršg
 
Şd
 = 
myD–im™”
; myD–im™” = 
s
;  old; 
	}
}

92 
¡ršg
 
	$£tComm’t
ĞcÚ¡ 
¡ršg
& 
s
 )

93 { 
¡ršg
 
Şd
 = 
myComm’t
; myComm’ˆğ
s
;  old; 
	}
}

96 
ä›nd
 
	g¡d
::
o¡»am
& 
İ”©Ü
<<Ğ
¡d
::o¡»am& 
os
, cÚ¡ 
	gCÚfigFe
& 
	gcf
 );

97 
ä›nd
 
	g¡d
::
i¡»am
& 
İ”©Ü
>>Ğ
¡d
::i¡»am& 
is
, 
	gCÚfigFe
& 
	gcf
 );

99 
	g´Ùeùed
:

100 
‹m¶©e
<
şass
 
T
> 
¡ršg
 
T_as_¡ršg
ĞcÚ¡ T& 
t
 );

101 
	g‹m¶©e
<
şass
 
	gT
> 
T
 
¡ršg_as_T
ĞcÚ¡ 
¡ršg
& 
s
 );

102 
Œim
Ğ
¡ršg
& 
s
 );

106 
	gpublic
:

107 
	sfe_nÙ_found
 {

108 
¡ršg
 
f’ame
;

109 
fe_nÙ_found
ĞcÚ¡ 
¡ršg
& 
f’ame_
 = string() )

110 : 
f’ame
(
f’ame_
) {} };

111 
	skey_nÙ_found
 {

112 
¡ršg
 
	gkey
;

113 
key_nÙ_found
ĞcÚ¡ 
¡ršg
& 
key_
 = string() )

114 : 
key
(
key_
) {} };

119 
	g‹m¶©e
<
şass
 
	gT
>

120 
¡ršg
 
	gCÚfigFe
::
	$T_as_¡ršg
ĞcÚ¡ 
T
& 
t
 )

124 
¡d
::
o¡ršg¡»am
 
o¡
;

125 
o¡
 << 
t
;

126  
o¡
.
	`¡r
();

127 
	}
}

131 
	g‹m¶©e
<
şass
 
	gT
>

132 
T
 
	gCÚfigFe
::
	$¡ršg_as_T
ĞcÚ¡ 
¡ršg
& 
s
 )

136 
T
 
t
;

137 
¡d
::
i¡ršg¡»am
 
	`i¡
(
s
);

138 
i¡
 >> 
t
;

139  
t
;

140 
	}
}

144 
	g‹m¶©e
<>

145 
šlše
 
¡ršg
 
	gCÚfigFe
::
¡ršg_as_T
<¡ršg>ĞcÚ¡ sŒšg& 
s
 )

149  
s
;

154 
	g‹m¶©e
<>

155 
šlše
 
boŞ
 
	gCÚfigFe
::
¡ršg_as_T
<boŞ>ĞcÚ¡ 
¡ršg
& 
s
 )

160 
boŞ
 
b
 = 
Œue
;

161 
¡ršg
 
	gsup
 = 
s
;

162  
	g¡ršg
::
™”©Ü
 
p
 = 
sup
.
begš
(); 
	gp
 !ğsup.
’d
(); ++p )

163 *
	gp
 = 
touµ”
(*
p
);

164 ifĞ
	gsup
==
¡ršg
("FALSE"è|| 
sup
==string("F") ||

165 
sup
==
¡ršg
("NO") || sup==string("N") ||

166 
sup
==
¡ršg
("0") || sup==string("NONE") )

167 
b
 = 
çl£
;

168  
	gb
;

172 
	g‹m¶©e
<
şass
 
	gT
>

173 
T
 
	gCÚfigFe
::
	$»ad
ĞcÚ¡ 
¡ršg
& 
key
 ) const

176 
m­ci
 
p
 = 
myCÚ‹Ás
.
	`fšd
(
key
);

177 ifĞ
p
 =ğ
myCÚ‹Ás
.
	`’d
(èè
throw
 
	`key_nÙ_found
(
key
);

178  
¡ršg_as_T
<
T
>Ğ
p
->
£cÚd
 );

179 
	}
}

182 
	g‹m¶©e
<
şass
 
	gT
>

183 
T
 
	gCÚfigFe
::
	$»ad
ĞcÚ¡ 
¡ršg
& 
key
, cÚ¡ 
T
& 
v®ue
 ) const

187 
m­ci
 
p
 = 
myCÚ‹Ás
.
	`fšd
(
key
);

188 ifĞ
p
 =ğ
myCÚ‹Ás
.
	`’d
(èè 
v®ue
;

189  
¡ršg_as_T
<
T
>Ğ
p
->
£cÚd
 );

190 
	}
}

193 
	g‹m¶©e
<
şass
 
	gT
>

194 
boŞ
 
	gCÚfigFe
::
	$»adIÁo
Ğ
T
& 
v¬
, cÚ¡ 
¡ršg
& 
key
 ) const

199 
m­ci
 
p
 = 
myCÚ‹Ás
.
	`fšd
(
key
);

200 
boŞ
 
found
 = ( 
p
 !ğ
myCÚ‹Ás
.
	`’d
() );

201 ifĞ
found
 ) 
v¬
 = 
¡ršg_as_T
<
T
>Ğ
p
->
£cÚd
 );

202  
found
;

203 
	}
}

206 
	g‹m¶©e
<
şass
 
	gT
>

207 
boŞ
 
	gCÚfigFe
::
	$»adIÁo
Ğ
T
& 
v¬
, cÚ¡ 
¡ršg
& 
key
, cÚ¡ T& 
v®ue
 ) const

212 
m­ci
 
p
 = 
myCÚ‹Ás
.
	`fšd
(
key
);

213 
boŞ
 
found
 = ( 
p
 !ğ
myCÚ‹Ás
.
	`’d
() );

214 ifĞ
found
 )

215 
v¬
 = 
¡ršg_as_T
<
T
>Ğ
p
->
£cÚd
 );

217 
v¬
 = 
v®ue
;

218  
found
;

219 
	}
}

222 
	g‹m¶©e
<
şass
 
	gT
>

223 
	gCÚfigFe
::
	$add
Ğ
¡ršg
 
key
, cÚ¡ 
T
& 
v®ue
 )

226 
¡ršg
 
v
 = 
	`T_as_¡ršg
Ğ
v®ue
 );

227 
	`Œim
(
key
);

228 
	`Œim
(
v
);

229 
myCÚ‹Ás
[
key
] = 
v
;

231 
	}
}

	@ruby/network/orion/Crossbar/Crossbar.cc

36 
	~<ÿs£¹
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/Crossb¬.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/M©rixCrossb¬.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/MuÉ»eCrossb¬.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

43 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

45 
usšg
 
Çme¥aû
 
	g¡d
;

47 
	gCrossb¬
::
	$Crossb¬
(

48 
Crossb¬Mod–
 
xb¬_mod–_
,

49 cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r_
,

50 cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r_
,

51 
ušt32_t
 
num_š_
,

52 
ušt32_t
 
num_out_
,

53 
ušt32_t
 
d©a_width_
,

54 
ušt32_t
 
num_š_£g_
,

55 
ušt32_t
 
num_out_£g_
,

56 
ušt32_t
 
deg»e_
,

57 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


60 
m_xb¬_mod–
 = 
xb¬_mod–_
;

61 ià(
m_xb¬_mod–
 !ğ
NO_MODEL
)

63 
	`as£¹
((
num_š_
 ==‚um_in_) && (num_in_ != 0));

64 
	`as£¹
((
num_out_
 ==‚um_out_) && (num_out_ != 0));

65 
	`as£¹
((
d©a_width_
 == data_width_) && (data_width_ != 0));

66 
	`as£¹
(
num_š_£g_
 ==‚um_in_seg_);

67 
	`as£¹
(
num_out_£g_
 ==‚um_out_seg_);

69 
	`£t_cÚn_ty³
(
cÚn_ty³_¡r_
);

70 
	`£t_Œªs_ty³
(
Œªs_ty³_¡r_
);

71 
m_num_š
 = 
num_š_
;

72 
m_num_out
 = 
num_out_
;

73 
m_num_š_£g
 = 
num_š_£g_
;

74 
m_num_out_£g
 = 
num_out_£g_
;

75 
m_d©a_width
 = 
d©a_width_
;

76 
m_deg»e
 = 
deg»e_
;

77 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

81 
û¼
 << "ERROR‡ˆ" << 
__FILE__
 << " " << 
__LINE__
 << 
’dl
;

83 
	}
}

85 
	gCrossb¬
::~
	$Crossb¬
()

86 {
	}
}

88 
Crossb¬
::
	$g‘_¡©ic_pow”
() const

90 
vdd
 = 
m_‹ch_·¿m_±r
->
	`g‘_vdd
();

91 
SCALE_S
 = 
m_‹ch_·¿m_±r
->
	`g‘_SCALE_S
();

92  (
m_i_¡©ic
*
vdd
*
SCALE_S
);

93 
	}
}

95 
	gCrossb¬
::
	$´št_®l
() const

97 
cout
 << "Crossb¬" << 
’dl
;

98 
cout
 << "\t" << "T¿v”§Èğ" << 
	`g‘_dyÇmic_’”gy
(
çl£
è<< 
’dl
;

99 
cout
 << "\t" << "Stiøpow” = " << 
	`g‘_¡©ic_pow”
(è<< 
’dl
;

101 
	}
}

103 
	gCrossb¬
::
	$£t_cÚn_ty³
(cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r_
)

105 ià(
cÚn_ty³_¡r_
 =ğ
	`¡ršg
("TRANS_GATE"))

107 
m_cÚn_ty³
 = 
TRANS_GATE
;

109 ià(
cÚn_ty³_¡r_
 =ğ
	`¡ršg
("TRISTATE_GATE"))

111 
m_cÚn_ty³
 = 
TRISTATE_GATE
;

115 
û¼
 << "Inv®id cÚÃùy³: '" << 
cÚn_ty³_¡r_
 << "'. U£ TRANS_GATE‡ deçuÉ." << 
’dl
;

116 
m_cÚn_ty³
 = 
TRANS_GATE
;

119 
	}
}

121 
	gCrossb¬
::
	$£t_Œªs_ty³
(cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r_
)

123 ià(
Œªs_ty³_¡r_
 =ğ
	`¡ršg
("NP_GATE"))

125 
m_Œªs_ty³
 = 
NP_GATE
;

127 ià(
Œªs_ty³_¡r_
 =ğ
	`¡ršg
("N_GATE"))

129 
m_Œªs_ty³
 = 
N_GATE
;

133 
û¼
 << "Inv®id¿n ty³: '" << 
Œªs_ty³_¡r_
 << "'. U£ N_GATE‡ deçuÉ." << 
’dl
;

134 
m_Œªs_ty³
 = 
N_GATE
;

136 
	}
}

138 
	gCrossb¬
::
	$ÿlc_š_ÿp
()

140 
tÙ®_ÿp
 = 0;

143 
tÙ®_ÿp
 +ğ
m_ÿp_š_wœe
;

145 
Œªs_ÿp
 = 0;

147 ià(
m_cÚn_ty³
 =ğ
TRANS_GATE
)

150 
WmemûÎr
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎr
();

151 
nsize
 = 
WmemûÎr
;

152 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

153 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

154 
psize
 = 
nsize
*
Wdecšvp
/
Wdecšvn
;

155 
Œªs_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
nsize
, 
TechP¬am‘”
::
NCH
, 1);

156 ià(
m_Œªs_ty³
 =ğ
NP_GATE
)

158 
Œªs_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
psize
, 
TechP¬am‘”
::
PCH
, 1);

161 ià(
m_cÚn_ty³
 =ğ
TRISTATE_GATE
)

163 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

164 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

165 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

166 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

167 
Œªs_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvÇndn
+
WoutdrvÇndp
, 0)

168 + 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvnÜn
+
WoutdrvnÜp
, 0);

170 
tÙ®_ÿp
 +ğ
Œªs_ÿp
*
m_num_out
;

173 ià(
m_num_š_£g
 > 1)

175 
tÙ®_ÿp
 *ğ(
m_num_š_£g
+1)/(m_num_in_seg*2);

177 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

178 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

179 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

180 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

181 
tÙ®_ÿp
 +ğ(
m_num_š_£g
+2)*(m_num_š_£g-1)/(m_num_š_£g*2)*(
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvÇndn
+
WoutdrvÇndp
, 0)+m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜn
+
WoutdrvnÜp
, 0));

183 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

184 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

185 
tÙ®_ÿp
 +ğ(
m_num_š_£g
-1)/2*(
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Woutdriv”n
, 
TechP¬am‘”
::
NCH
, 1)+m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Woutdriv”p
, TechP¬am‘”::
PCH
, 1));

190 
³riod
 = 
m_‹ch_·¿m_±r
->
	`g‘_³riod
();

191 
psize
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_driv”_psize
(
tÙ®_ÿp
, 
³riod
/3.0);

192 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

193 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

194 
nsize
 = 
psize
*
Wdecšvn
/
Wdecšvp
;

195 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
nsize
, 
TechP¬am‘”
::
NCH
, 1)+m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
psize
, TechP¬am‘”::
PCH
, 1)+m_‹ch_·¿m_±r->
	`ÿlc_g©eÿp
(nsize+psize, 0);

197  
tÙ®_ÿp
/2.0;

198 
	}
}

200 
	gCrossb¬
::
	$ÿlc_out_ÿp
(
ušt32_t
 
num_š_
)

202 
tÙ®_ÿp
 = 0;

205 
tÙ®_ÿp
 +ğ
m_ÿp_out_wœe
;

207 
Œªs_ÿp
 = 0;

209 ià(
m_cÚn_ty³
 =ğ
TRANS_GATE
)

212 
WmemûÎr
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎr
();

213 
nsize
 = 
WmemûÎr
;

214 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

215 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

216 
psize
 = 
nsize
*
Wdecšvp
/
Wdecšvn
;

218 
Œªs_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
nsize
, 
TechP¬am‘”
::
NCH
, 1);

219 ià(
m_Œªs_ty³
 =ğ
NP_GATE
)

221 
Œªs_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
psize
, 
TechP¬am‘”
::
PCH
, 1);

224 ià(
m_cÚn_ty³
 =ğ
TRISTATE_GATE
)

226 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

227 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

228 
Œªs_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Woutdriv”n
, 
TechP¬am‘”
::
NCH
, 1)+m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Woutdriv”p
, TechP¬am‘”::
PCH
, 1);

230 
tÙ®_ÿp
 +ğ
Œªs_ÿp
*
num_š_
;

233 ià(
m_num_out_£g
 > 1)

235 
tÙ®_ÿp
 *ğ(
m_num_out_£g
+1)/(m_num_out_seg*2);

237 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

238 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

239 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

240 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

241 
tÙ®_ÿp
 +ğ(
m_num_out_£g
+2)*(m_num_out_£g-1)/(m_num_out_£g*2)*(
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvÇndn
+
WoutdrvÇndp
, 0)+m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜn
+
WoutdrvnÜp
, 0));

243 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

244 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

245 
tÙ®_ÿp
 +ğ(
m_num_out_£g
-1)/2*(
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Woutdriv”n
, 
TechP¬am‘”
::
NCH
, 1)+m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Woutdriv”p
, TechP¬am‘”::
PCH
, 1));

249 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

250 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

251 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Woutdriv”n
, 
TechP¬am‘”
::
NCH
, 1)+m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Woutdriv”p
, TechP¬am‘”::
PCH
, 1)+m_‹ch_·¿m_±r->
	`ÿlc_g©eÿp
(Woutdrivern+Woutdriverp, 0);

253  
tÙ®_ÿp
/2.0;

254 
	}
}

256 
	gCrossb¬
::
	$ÿlc_št_ÿp
()

258 
tÙ®_ÿp
 = 0;

260 ià(
m_cÚn_ty³
 =ğ
TRANS_GATE
)

264 
WmemûÎr
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎr
();

265 
nsize
 = 
WmemûÎr
;

266 
Œªs_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
nsize
, 
TechP¬am‘”
::
NCH
, 1);

267 ià(
m_Œªs_ty³
 =ğ
NP_GATE
)

269 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

270 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

271 
psize
 = 
nsize
*
Wdecšvp
/
Wdecšvn
;

272 
Œªs_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
psize
, 
TechP¬am‘”
::
PCH
, 1);

274 
tÙ®_ÿp
 +ğ
Œªs_ÿp
*(
m_deg»e
+1);

276 ià(
m_cÚn_ty³
 =ğ
TRISTATE_GATE
)

279 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

280 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

282 
Œªs_ÿp
 = (
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Woutdriv”n
, 
TechP¬am‘”
::
NCH
, 1)+m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Woutdriv”p
, TechP¬am‘”::
PCH
, 1))*
m_deg»e
;

284 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

285 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

286 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

287 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

288 
Œªs_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvÇndn
+
WoutdrvÇndp
, 0)+m_‹ch_·¿m_±r->ÿlc_g©eÿp(
WoutdrvnÜn
+
WoutdrvnÜp
, 0);

289 
tÙ®_ÿp
 +ğ
Œªs_ÿp
;

292  
tÙ®_ÿp
/2.0;

293 
	}
}

295 
	gCrossb¬
::
	$ÿlc_ùr_ÿp
(
ÿp_wœe_
, 
boŞ
 
´ev_ùr_
, boŞ 
Ãxt_ùr_
)

297 
tÙ®_ÿp
 = 0;

300 
tÙ®_ÿp
 +ğ
ÿp_wœe_
;

302 
Œªs_ÿp
 = 0;

304 ià(
m_cÚn_ty³
 =ğ
TRANS_GATE
)

307 
WmemûÎr
 = 
m_‹ch_·¿m_±r
->
	`g‘_WmemûÎr
();

308 
nsize
 = 
WmemûÎr
;

309 
Œªs_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
nsize
, 0);

310 ià(
m_Œªs_ty³
 =ğ
NP_GATE
)

312 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

313 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

314 
psize
 = 
nsize
*
Wdecšvp
/
Wdecšvn
;

315 
Œªs_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
psize
, 0);

318 ià(
m_cÚn_ty³
 =ğ
TRISTATE_GATE
)

320 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

321 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

322 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

323 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

324 
Œªs_ÿp
 = 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvÇndn
+
WoutdrvÇndp
, 0)

325 + 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WoutdrvnÜn
+
WoutdrvnÜp
, 0);

327 
tÙ®_ÿp
 +ğ
Œªs_ÿp
*
m_d©a_width
;

330 ià(!((
m_cÚn_ty³
 =ğ
TRANS_GATE
è&& (
m_Œªs_ty³
 =ğ
N_GATE
è&& (!
´ev_ùr_
)))

332 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

333 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

334 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
Wdecšvn
, 
TechP¬am‘”
::
NCH
, 1)+m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
Wdecšvp
, TechP¬am‘”::
PCH
, 1)

335 + 
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
Wdecšvn
+
Wdecšvp
, 0);

338 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

339 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

341 ià(
´ev_ùr_
)

344 
tÙ®_ÿp
 +ğ
m_deg»e
*
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORn
, 
TechP¬am‘”
::
NCH
, 1)

345 +
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORp
, 
TechP¬am‘”
::
PCH
, 
m_deg»e
);

349 ià(
Ãxt_ùr_
)

352 
tÙ®_ÿp
 +ğ
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 
m_deg»e
*40+20);

355  
tÙ®_ÿp
;

356 
	}
}

358 
Crossb¬
* 
	gCrossb¬
::
	$ü—‹_üossb¬
(

359 cÚ¡ 
¡ršg
& 
xb¬_mod–_¡r_
,

360 
ušt32_t
 
num_š_
,

361 
ušt32_t
 
num_out_
,

362 
ušt32_t
 
d©a_width_
,

363 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


366 ià(
xb¬_mod–_¡r_
 =ğ
	`¡ršg
("MATRIX_CROSSBAR"))

368 cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("CROSSBAR_CONNECT_TYPE");

369 cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("CROSSBAR_TRANS_GATE_TYPE");

370 
ušt32_t
 
num_š_£g
 = 
ÜiÚ_cfg_±r_
->
g‘
<uint32_t>("CROSSBAR_NUM_IN_SEG");

371 
ušt32_t
 
num_out_£g
 = 
ÜiÚ_cfg_±r_
->
g‘
<uint32_t>("CROSSBAR_NUM_OUT_SEG");

372 
Ën_š_wœe
 = 
ÜiÚ_cfg_±r_
->
g‘
<>("CROSSBAR_LEN_IN_WIRE");

373 
Ën_out_wœe
 = 
ÜiÚ_cfg_±r_
->
g‘
<>("CROSSBAR_LEN_OUT_WIRE");

374 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r
 = 
ÜiÚ_cfg_±r_
->
	`g‘_‹ch_·¿m_±r
();

375  
Ãw
 
	`M©rixCrossb¬
(
cÚn_ty³_¡r
, 
Œªs_ty³_¡r
,

376 
num_š_
, 
num_out_
, 
d©a_width_
, 
num_š_£g
, 
num_out_£g
,

377 
Ën_š_wœe
, 
Ën_out_wœe
, 
‹ch_·¿m_±r
);

379 ià(
xb¬_mod–_¡r_
 =ğ
	`¡ršg
("MULTREE_CROSSBAR"))

381 cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("CROSSBAR_CONNECT_TYPE");

382 cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r
 = 
ÜiÚ_cfg_±r_
->
g‘
<string>("CROSSBAR_TRANS_GATE_TYPE");

383 
ušt32_t
 
deg»e
 = 
ÜiÚ_cfg_±r_
->
g‘
<uint32_t>("CROSSBAR_MUX_DEGREE");

384 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r
 = 
ÜiÚ_cfg_±r_
->
	`g‘_‹ch_·¿m_±r
();

385  
Ãw
 
	`MuÉ»eCrossb¬
(
cÚn_ty³_¡r
, 
Œªs_ty³_¡r
,

386 
num_š_
, 
num_out_
, 
d©a_width_
, 
deg»e
, 
‹ch_·¿m_±r
);

390 
û¼
 << "WARNING: NØCrossb¬ mod–" << 
’dl
;

391  (
Crossb¬
*)
NULL
;

393 
	}
}

	@ruby/network/orion/Crossbar/Crossbar.hh

36 #iâdeà
__CROSSBAR_H__


37 
	#__CROSSBAR_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

42 
şass
 
	gOriÚCÚfig
;

44 şas 
	cCrossb¬


46 
	mpublic
:

47 
	eCrossb¬Mod–


49 
NO_MODEL
 = 0,

50 
	mMATRIX_CROSSBAR
,

51 
	mMULTREE_CROSSBAR


53 
	eCÚÃùTy³


55 
	gTRANS_GATE
,

56 
	gTRISTATE_GATE


58 
	eT¿nsTy³


60 
	gN_GATE
,

61 
	gNP_GATE


64 
	gpublic
:

65 
Crossb¬
(

66 
Crossb¬Mod–
 
xb¬_mod–_
,

67 cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r_
,

68 cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r_
,

69 
ušt32_t
 
num_š_
,

70 
ušt32_t
 
num_out_
,

71 
ušt32_t
 
d©a_width_
,

72 
ušt32_t
 
num_š_£g_
,

73 
ušt32_t
 
num_out_£g_
,

74 
ušt32_t
 
deg»e_
,

75 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


77 
	gvœtu®
 ~
Crossb¬
() = 0;

79 
	gpublic
:

80 
	$g‘_Ën_»q_wœe
(ècÚ¡ {  
m_Ën_»q_wœe
; 
	}
}

82 
vœtu®
 
	$g‘_dyÇmic_’”gy
(
boŞ
 
is_max_
) const = 0;

83 
	$g‘_¡©ic_pow”
() const;

85 
	$´št_®l
() const;

87 
´Ùeùed
:

88 
	`£t_cÚn_ty³
(cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r_
);

89 
	`£t_Œªs_ty³
(cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r_
);

90 
	`ÿlc_š_ÿp
();

91 
	`ÿlc_out_ÿp
(
ušt32_t
 
num_š_
);

92 
	`ÿlc_št_ÿp
();

93 
	`ÿlc_ùr_ÿp
(
ÿp_wœe_
, 
boŞ
 
´ev_ùr_
, boŞ 
Ãxt_ùr_
);

94 
vœtu®
 
	`ÿlc_i_¡©ic
() = 0;

96 
´Ùeùed
:

97 
Crossb¬Mod–
 
m_xb¬_mod–
;

98 
CÚÃùTy³
 
m_cÚn_ty³
;

99 
T¿nsTy³
 
m_Œªs_ty³
;

100 
ušt32_t
 
m_num_š
;

101 
ušt32_t
 
m_num_out
;

102 
ušt32_t
 
m_d©a_width
;

103 
ušt32_t
 
m_num_š_£g
;

104 
ušt32_t
 
m_num_out_£g
;

105 
ušt32_t
 
m_deg»e
;

106 cÚ¡ 
TechP¬am‘”
* 
m_‹ch_·¿m_±r
;

108 
m_ÿp_š_wœe
;

109 
m_ÿp_out_wœe
;

110 
m_ÿp_ùr_wœe
;

111 
m_Ën_»q_wœe
;

113 
m_e_chg_š
;

114 
m_e_chg_out
;

115 
m_e_chg_ùr
;

116 
m_e_chg_št
;

118 
m_i_¡©ic
;

120 
public
:

121 
Crossb¬
* 
	`ü—‹_üossb¬
(

122 cÚ¡ 
¡ršg
& 
xb¬_mod–_¡r_
,

123 
ušt32_t
 
num_š_
,

124 
ušt32_t
 
num_out_
,

125 
ušt32_t
 
d©a_width_
,

126 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


128 
	}
};

	@ruby/network/orion/Crossbar/MatrixCrossbar.cc

36 
	~<ÿs£¹
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/M©rixCrossb¬.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

42 
usšg
 
Çme¥aû
 
	g¡d
;

44 
	gM©rixCrossb¬
::
	$M©rixCrossb¬
(

45 cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r_
,

46 cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r_
,

47 
ušt32_t
 
num_š_
,

48 
ušt32_t
 
num_out_
,

49 
ušt32_t
 
d©a_width_
,

50 
ušt32_t
 
num_š_£g_
,

51 
ušt32_t
 
num_out_£g_
,

52 
Ën_š_wœe_
,

53 
Ën_out_wœe_
,

54 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


55 è: 
	$Crossb¬
(

56 
MATRIX_CROSSBAR
, 
cÚn_ty³_¡r_
, 
Œªs_ty³_¡r_
,

57 
num_š_
, 
num_out_
, 
d©a_width_
, 
num_š_£g_
, 
num_out_£g_
,

58 0, 
‹ch_·¿m_±r_
)

60 
	`as£¹
(
Ën_š_wœe_
 ==†en_in_wire_);

61 
	`as£¹
(
Ën_out_wœe_
 ==†en_out_wire_);

63 
m_Ën_š_wœe
 = 
Ën_š_wœe_
;

64 
m_Ën_out_wœe
 = 
Ën_out_wœe_
;

65 
	`š™
();

66 
	}
}

68 
	gM©rixCrossb¬
::~
	$M©rixCrossb¬
()

69 {
	}
}

71 
M©rixCrossb¬
::
	$g‘_dyÇmic_’”gy
(
boŞ
 
is_max_
) const

73 
e_©omic
;

74 
e_acûss
 = 0;

76 
e_©omic
 = 
m_e_chg_š
*
m_d©a_width
*(
is_max_
? 1:0.5);

77 
e_acûss
 +ğ
e_©omic
;

79 
e_©omic
 = 
m_e_chg_out
*
m_d©a_width
*(
is_max_
? 1:0.5);

80 
e_acûss
 +ğ
e_©omic
;

82 
e_©omic
 = 
m_e_chg_ùr
;

83 
e_acûss
 +ğ
e_©omic
;

85  
e_acûss
;

86 
	}
}

88 
	gM©rixCrossb¬
::
	$š™
()

91 
Crsb¬C–lWidth
 = 
m_‹ch_·¿m_±r
->
	`g‘_Crsb¬C–lWidth
();

92 
Crsb¬C–lHeight
 = 
m_‹ch_·¿m_±r
->
	`g‘_Crsb¬C–lHeight
();

93 
Ën_š
 = 
m_num_out
*
m_d©a_width
*
Crsb¬C–lWidth
;

94 
Ën_out
 = 
m_num_š
*
m_d©a_width
*
Crsb¬C–lHeight
;

95 if(
Ën_š
 > 
m_Ën_š_wœe
) m_len_in_wire =†en_in;

96 if(
Ën_out
 > 
m_Ën_out_wœe
) m_len_out_wire =†en_out;

97 
CC3m‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_CC3m‘®
();

98 
m_ÿp_š_wœe
 = 
CC3m‘®
*
m_Ën_š_wœe
;

99 
m_ÿp_out_wœe
 = 
CC3m‘®
*
m_Ën_out_wœe
;

100 
Cm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_Cm‘®
();

101 
m_ÿp_ùr_wœe
 = 
Cm‘®
*
m_Ën_š_wœe
/2.0;

102 
m_Ën_»q_wœe
 = 
m_Ën_š_wœe
;

104 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

105 
m_e_chg_š
 = 
	`ÿlc_š_ÿp
()*
e_çùÜ
;

106 
m_e_chg_out
 = 
	`ÿlc_out_ÿp
(
m_num_out
)*
e_çùÜ
;

109 
m_e_chg_ùr
 = 
	`ÿlc_ùr_ÿp
(
m_ÿp_ùr_wœe
, 0, 0)*
e_çùÜ
;

110 
m_e_chg_št
 = 0;

112 
m_i_¡©ic
 = 
	`ÿlc_i_¡©ic
();

114 
	}
}

116 
	gM©rixCrossb¬
::
	$ÿlc_i_¡©ic
()

118 
WoutdrvÇndn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndn
();

119 
WoutdrvÇndp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvÇndp
();

120 
WoutdrvnÜn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜn
();

121 
WoutdrvnÜp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WoutdrvnÜp
();

122 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

123 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

124 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

125 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

126 
NAND2_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NAND2_TAB
(0);

127 
NAND2_TAB_1
 = 
m_‹ch_·¿m_±r
->
	`g‘_NAND2_TAB
(1);

128 
NAND2_TAB_2
 = 
m_‹ch_·¿m_±r
->
	`g‘_NAND2_TAB
(2);

129 
NAND2_TAB_3
 = 
m_‹ch_·¿m_±r
->
	`g‘_NAND2_TAB
(3);

130 
NOR2_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(0);

131 
NOR2_TAB_1
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(1);

132 
NOR2_TAB_2
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(2);

133 
NOR2_TAB_3
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(3);

134 
NMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NMOS_TAB
(0);

135 
PMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_PMOS_TAB
(0);

137 
i_¡©ic
 = 0;

139 
i_¡©ic
 +ğ((
WoutdrvÇndp
*(
NAND2_TAB_0
+
NAND2_TAB_1
+
NAND2_TAB_2
)+
WoutdrvÇndn
*
NAND2_TAB_3
)/4

140 + (
WoutdrvnÜp
*
NOR2_TAB_0
+
WoutdrvnÜn
*(
NOR2_TAB_1
+
NOR2_TAB_2
+
NOR2_TAB_3
))/4

141 + 
Woutdriv”n
*
NMOS_TAB_0
+
Woutdriv”p
*
PMOS_TAB_0
)*
m_num_š
*
m_num_out
*
m_d©a_width
;

144 
i_¡©ic
 +ğ(
Wdecšvn
*
NMOS_TAB_0
+
Wdecšvp
*
PMOS_TAB_0
)*
m_num_š
*
m_d©a_width
;

147 
i_¡©ic
 +ğ(
Woutdriv”n
*
NMOS_TAB_0
+
Woutdriv”p
*
PMOS_TAB_0
)*
m_num_out
*
m_d©a_width
;

150 
i_¡©ic
 +ğ(
Wdecšvn
*
NMOS_TAB_0
+
Wdecšvp
*
PMOS_TAB_0
)*
m_num_š
*
m_num_out
;

151  
i_¡©ic
;

152 
	}
}

	@ruby/network/orion/Crossbar/MatrixCrossbar.hh

36 #iâdeà
__MATRIXCROSSBAR_H__


37 
	#__MATRIXCROSSBAR_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/Crossb¬.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cM©rixCrossb¬
 : 
public
 
Crossb¬


46 
public
:

47 
M©rixCrossb¬
(

48 cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r_
,

49 cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r_
,

50 
ušt32_t
 
num_š_
,

51 
ušt32_t
 
num_out_
,

52 
ušt32_t
 
d©a_width_
,

53 
ušt32_t
 
num_š_£g_
,

54 
ušt32_t
 
num_out_£g_
,

55 
Ën_š_wœe_
,

56 
Ën_out_wœe_
,

57 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


59 ~
M©rixCrossb¬
();

61 
	mpublic
:

62 
	$g‘_dyÇmic_’”gy
(
boŞ
 
is_max_
) const;

64 
´iv©e
:

65 
	`š™
();

66 
	`ÿlc_i_¡©ic
();

68 
´iv©e
:

69 
m_Ën_š_wœe
;

70 
m_Ën_out_wœe
;

	@ruby/network/orion/Crossbar/MultreeCrossbar.cc

36 
	~<cm©h
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/MuÉ»eCrossb¬.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

42 
usšg
 
Çme¥aû
 
	g¡d
;

44 
	gMuÉ»eCrossb¬
::
	$MuÉ»eCrossb¬
(

45 cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r_
,

46 cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r_
,

47 
ušt32_t
 
num_š_
,

48 
ušt32_t
 
num_out_
,

49 
ušt32_t
 
d©a_width_
,

50 
ušt32_t
 
deg»e_
,

51 cÚ¡ 
TechP¬am‘”
 *
‹ch_·¿m_±r_


52 è: 
	$Crossb¬
(

53 
MULTREE_CROSSBAR
, 
cÚn_ty³_¡r_
, 
Œªs_ty³_¡r_
,

54 
num_š_
, 
num_out_
, 
d©a_width_
, 0, 0, 
deg»e_
, 
‹ch_·¿m_±r_
)

56 
m_Ën_»q_wœe
 = 0;

57 
	`š™
();

58 
	}
}

60 
	gMuÉ»eCrossb¬
::~
	$MuÉ»eCrossb¬
()

61 {
	}
}

63 
MuÉ»eCrossb¬
::
	$g‘_dyÇmic_’”gy
(
boŞ
 
is_max_
) const

65 
e_©omic
;

66 
e_acûss
 = 0;

68 
e_©omic
 = 
m_e_chg_š
*
m_d©a_width
*(
is_max_
? 1:0.5);

69 
e_acûss
 +ğ
e_©omic
;

71 
e_©omic
 = 
m_e_chg_out
*
m_d©a_width
*(
is_max_
? 1:0.5);

72 
e_acûss
 +ğ
e_©omic
;

74 
e_©omic
 = 
m_e_chg_ùr
;

75 
e_acûss
 +ğ
e_©omic
;

77 ià(
m_d•th
 > 1)

79 
e_©omic
 = 
m_e_chg_št
*
m_d©a_width
*(
m_d•th
-1)*(
is_max_
? 1:0.5);

80 
e_acûss
 +ğ
e_©omic
;

83  
e_acûss
;

84 
	}
}

86 
	gMuÉ»eCrossb¬
::
	$š™
()

88 
Crsb¬C–lWidth
 = 
m_‹ch_·¿m_±r
->
	`g‘_Crsb¬C–lWidth
();

89 
CCm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_CCm‘®
();

90 
Lamda
 = 
m_‹ch_·¿m_±r
->
	`g‘_Lamda
();

91 
CC3m‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_CC3m‘®
();

93 
Ën_š_wœe
;

95 
Ën_š_wœe
 = 
m_num_š
*
m_d©a_width
*
Crsb¬C–lWidth
*(
m_num_out
/2);

96 
m_ÿp_š_wœe
 = 
Ën_š_wœe
*
CCm‘®
;

98 
Ën_š_wœe
 = 
m_num_š
*
m_d©a_width
*(5*
Lamda
)*(
m_num_out
/2);

99 
m_ÿp_š_wœe
 +ğ
Ën_š_wœe
*
CC3m‘®
;

100 
m_ÿp_out_wœe
 = 0;

102 
Cm‘®
 = 
m_‹ch_·¿m_±r
->
	`g‘_Cm‘®
();

103 
Ën_ùr_wœe
 = 
m_num_š
*
m_d©a_width
*
Crsb¬C–lWidth
*(
m_num_out
/2)/2;

104 
m_ÿp_ùr_wœe
 = 
Cm‘®
*
Ën_ùr_wœe
;

106 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

107 
m_e_chg_š
 = 
	`ÿlc_š_ÿp
()*
e_çùÜ
;

108 
m_e_chg_out
 = 
	`ÿlc_out_ÿp
(
m_deg»e
)*
e_çùÜ
;

109 
m_e_chg_št
 = 
	`ÿlc_št_ÿp
()*
e_çùÜ
;

111 
m_d•th
 = (
ušt32_t
)
	`û
(
	`log
(()
m_num_š
)/log(()
m_deg»e
));

114 ià(
m_d•th
 == 1)

117 
m_e_chg_ùr
 = 
	`ÿlc_ùr_ÿp
(
m_ÿp_ùr_wœe
, 0, 0)*
e_çùÜ
;

122 
m_e_chg_ùr
 = 
	`ÿlc_ùr_ÿp
(
m_ÿp_ùr_wœe
, 0, 1)*
e_çùÜ
 + calc_ctr_cap(0, 1, 0)*e_factor;

124 ià(
m_d•th
 > 2)

126 
m_e_chg_ùr
 +ğ(
m_d•th
-2)*
	`ÿlc_ùr_ÿp
(0, 1, 1)*
e_çùÜ
;

130 
m_i_¡©ic
 = 
	`ÿlc_i_¡©ic
();

131 
	}
}

133 
	gMuÉ»eCrossb¬
::
	$ÿlc_i_¡©ic
()

135 
Wdecšvn
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvn
();

136 
Wdecšvp
 = 
m_‹ch_·¿m_±r
->
	`g‘_Wdecšvp
();

137 
Woutdriv”n
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”n
();

138 
Woutdriv”p
 = 
m_‹ch_·¿m_±r
->
	`g‘_Woutdriv”p
();

139 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

140 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

141 
NOR2_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(0);

142 
NOR2_TAB_1
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(1);

143 
NOR2_TAB_2
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(2);

144 
NOR2_TAB_3
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(3);

145 
NMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NMOS_TAB
(0);

146 
PMOS_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_PMOS_TAB
(0);

148 
i_¡©ic
 = 0;

151 
i_¡©ic
 +ğ(
Wdecšvn
*
NMOS_TAB_0
+
Wdecšvp
*
PMOS_TAB_0
)*
m_num_š
*
m_d©a_width
;

154 
i_¡©ic
 +ğ(
Woutdriv”n
*
NMOS_TAB_0
+
Woutdriv”p
*
PMOS_TAB_0
)*
m_num_out
*
m_d©a_width
;

157 
i_¡©ic
 +ğ(
WdecNORp
*
NOR2_TAB_0
+
WdecNORn
*(
NOR2_TAB_1
+
NOR2_TAB_2
+
NOR2_TAB_3
))/4*(2*
m_num_š
-1)*
m_num_out
*
m_d©a_width
;

160 
i_¡©ic
 +ğ(
Wdecšvn
*
NMOS_TAB_0
+
Wdecšvp
*
PMOS_TAB_0
)*
m_num_š
*
m_num_out
;

161  
i_¡©ic
;

162 
	}
}

	@ruby/network/orion/Crossbar/MultreeCrossbar.hh

36 #iâdeà
__MULTREECROSSBAR_H__


37 
	#__MULTREECROSSBAR_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/Crossb¬.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

42 
şass
 
	gTechP¬am‘”
;

44 şas 
	cMuÉ»eCrossb¬
 : 
public
 
Crossb¬


46 
public
:

47 
MuÉ»eCrossb¬
(

48 cÚ¡ 
¡ršg
& 
cÚn_ty³_¡r_
,

49 cÚ¡ 
¡ršg
& 
Œªs_ty³_¡r_
,

50 
ušt32_t
 
num_š_
,

51 
ušt32_t
 
num_out_
,

52 
ušt32_t
 
d©a_width_
,

53 
ušt32_t
 
deg»e_
,

54 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


56 ~
MuÉ»eCrossb¬
();

58 
	mpublic
:

59 
	$g‘_dyÇmic_’”gy
(
boŞ
 
is_max_
) const;

61 
´iv©e
:

62 
	`š™
();

63 
	`ÿlc_i_¡©ic
();

65 
´iv©e
:

66 
ušt32_t
 
m_d•th
;

	@ruby/network/orion/FlipFlop.cc

36 
	~<ÿs£¹
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/FlFlİ.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

42 
usšg
 
Çme¥aû
 
	g¡d
;

44 
	gFlFlİ
::
	$FlFlİ
(

45 cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
,

46 
lßd_
,

47 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


50 ià(
ff_mod–_¡r_
 =ğ
	`¡ršg
("NEG_DFF"))

52 
m_ff_mod–
 = 
NEG_DFF
;

56 
m_ff_mod–
 = 
NO_MODEL
;

59 ià(
m_ff_mod–
 !ğ
NO_MODEL
)

61 
	`as£¹
(
lßd_
 ==†oad_);

63 
m_lßd
 = 
lßd_
;

64 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

66 
	`š™
();

68 
	}
}

70 
	gFlFlİ
::~
	$FlFlİ
()

71 {
	}
}

73 
FlFlİ
::
	$š™
()

75 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
;

77 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

78 
m_ff_mod–
)

80 
NEG_DFF
:

81 
c1
 = 
c5
 = 
c6
 = 
	`ÿlc_node_ÿp
(2, 1);

82 
c2
 = 
	`ÿlc_node_ÿp
(2, 3);

83 
c3
 = 
	`ÿlc_node_ÿp
(3, 2);

84 
c4
 = 
	`ÿlc_node_ÿp
(2, 3);

86 
m_e_sw™ch
 = (
c1
+
c2
+
c3
+
c4
+
c5
+
c6
+
m_lßd
)*
e_çùÜ
/2.0;

88 
m_e_k“p_1
 = 
c3
*
e_çùÜ
;

89 
m_e_k“p_0
 = 
c2
*
e_çùÜ
;

90 
m_e_şock
 = 
	`ÿlc_şock_ÿp
()*
e_çùÜ
;

92 
m_i_¡©ic
 = 
	`ÿlc_i_¡©ic
();

95 
û¼
 << "”rÜ" << 
’dl
;

98 
	}
}

106 
	gFlFlİ
::
	$ÿlc_node_ÿp
(
ušt32_t
 
num_çnš_
, ušt32_ˆ
num_çnout_
)

108 
tÙ®_ÿp
 = 0;

112 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

113 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

114 
tÙ®_ÿp
 +ğ
num_çnš_
*
m_‹ch_·¿m_±r
->
	`ÿlc_d¿šÿp
(
WdecNORn
, 
TechP¬am‘”
::
NCH
, 1è+ m_‹ch_·¿m_±r->ÿlc_d¿šÿp(
WdecNORp
, TechP¬am‘”::
PCH
,‚um_fanin_);

117 
tÙ®_ÿp
 +ğ
num_çnout_
*
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 0);

118  
tÙ®_ÿp
;

119 
	}
}

121 
	gFlFlİ
::
	$ÿlc_şock_ÿp
()

123 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

124 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

125  (2*
m_‹ch_·¿m_±r
->
	`ÿlc_g©eÿp
(
WdecNORn
+
WdecNORp
, 0));

126 
	}
}

128 
	gFlFlİ
::
	$ÿlc_i_¡©ic
()

130 
WdecNORn
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORn
();

131 
WdecNORp
 = 
m_‹ch_·¿m_±r
->
	`g‘_WdecNORp
();

132 
NOR2_TAB_0
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(0);

133 
NOR2_TAB_1
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(1);

134 
NOR2_TAB_2
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(2);

135 
NOR2_TAB_3
 = 
m_‹ch_·¿m_±r
->
	`g‘_NOR2_TAB
(3);

137  (
WdecNORp
*
NOR2_TAB_0
 + 
WdecNORn
*(
NOR2_TAB_1
+
NOR2_TAB_2
+
NOR2_TAB_3
))/4*6;

138 
	}
}

	@ruby/network/orion/FlipFlop.hh

36 #iâdeà
__FLIPFLOP_H__


37 
	#__FLIPFLOP_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

43 şas 
	cFlFlİ


45 
	mpublic
:

46 
	eFFMod–


48 
NO_MODEL
 = 0,

49 
	mNEG_DFF


52 
	gpublic
:

53 
FlFlİ
(

54 cÚ¡ 
¡ršg
& 
ff_mod–_¡r_
,

55 
lßd_
,

56 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


58 ~
FlFlİ
();

60 
	gpublic
:

61 
	$g‘_e_sw™ch
(ècÚ¡ {  
m_e_sw™ch
; 
	}
}

62 
	$g‘_e_k“p_1
(ècÚ¡ {  
m_e_k“p_1
; 
	}
}

63 
	$g‘_e_k“p_0
(ècÚ¡ {  
m_e_k“p_0
; 
	}
}

64 
	$g‘_e_şock
(ècÚ¡ {  
m_e_şock
; 
	}
}

65 
	$g‘_i_¡©ic
(ècÚ¡ {  
m_i_¡©ic
; 
	}
}

67 
	g´iv©e
:

68 
š™
();

69 
ÿlc_node_ÿp
(
ušt32_t
 
num_çnš_
, ušt32_ˆ
num_çnout_
);

70 
ÿlc_şock_ÿp
();

71 
ÿlc_i_¡©ic
();

73 
	g´iv©e
:

74 
FFMod–
 
m_ff_mod–
;

75 cÚ¡ 
TechP¬am‘”
* 
	gm_‹ch_·¿m_±r
;

77 
	gm_lßd
;

79 
	gm_e_sw™ch
;

80 
	gm_e_k“p_1
;

81 
	gm_e_k“p_0
;

82 
	gm_e_şock
;

84 
	gm_i_¡©ic
;

	@ruby/network/orion/NetworkPower.cc

32 
	~"mem/ruby/ÃtwÜk/ÜiÚ/N‘wÜkPow”.hh
"

33 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

34 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚLšk.hh
"

35 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚRou‹r.hh
"

38 
	gRou‹r_d
::
	$ÿlcuÏ‹_pow”
()

41 
	`ÿlcuÏ‹_³rfÜmªû_numb”s
();

42 
sim_cyşes
 = 
	`curCyşe
(è- 
g_ruby_¡¬t
;

47 
num_aùive_vşass
 = 0;

48 
¡d
::
veùÜ
<
boŞ
 > 
aùive_vşass_¬y
;

49 
aùive_vşass_¬y
.
	`»size
(
m_vœtu®_ÃtwÜks
);

51 
¡d
::
veùÜ
<> 
vc_loÿl_¬b™_couÁ_aùive
;

52 
¡d
::
veùÜ
<> 
vc_glob®_¬b™_couÁ_aùive
;

53 
¡d
::
veùÜ
<> 
buf_»ad_couÁ_aùive
;

54 
¡d
::
veùÜ
<> 
buf_wr™e_couÁ_aùive
;

56 
i
 =0; i < 
m_vœtu®_ÃtwÜks
; i++) {

58 
aùive_vşass_¬y
[
i
] = (
	`g‘_Ãt_±r
())->
	`v®idVœtu®N‘wÜk
(i);

59 ià(
aùive_vşass_¬y
[
i
]) {

60 
num_aùive_vşass
++;

61 
vc_loÿl_¬b™_couÁ_aùive
.
	`push_back
(
vc_loÿl_¬b™_couÁ
[
i
]);

62 
vc_glob®_¬b™_couÁ_aùive
.
	`push_back
(
vc_glob®_¬b™_couÁ
[
i
]);

63 
buf_»ad_couÁ_aùive
.
	`push_back
(
buf_»ad_couÁ
[
i
]);

64 
buf_wr™e_couÁ_aùive
.
	`push_back
(
buf_wr™e_couÁ
[
i
]);

68 
	`as£¹
(
vc_glob®_¬b™_couÁ
[
i
] == 0);

69 
	`as£¹
(
vc_loÿl_¬b™_couÁ
[
i
] == 0);

74 
OriÚCÚfig
* 
ÜiÚ_cfg_±r
;

75 
OriÚRou‹r
* 
ÜiÚ_¹r_±r
;

76 
äeq_Hz
;

78 cÚ¡ 
¡ršg
 
cfg_â
 = "src/mem/ruby/network/orion/router.cfg";

79 
ÜiÚ_cfg_±r
 = 
Ãw
 
	`OriÚCÚfig
(
cfg_â
);

80 
äeq_Hz
 = 
ÜiÚ_cfg_±r
->
g‘
<>("FREQUENCY");

82 
ušt32_t
 
num_š_pÜt
 = 
m_šput_un™
.
	`size
();

83 
ušt32_t
 
num_out_pÜt
 = 
m_ouut_un™
.
	`size
();

84 
ušt32_t
 
num_vşass
 = 
num_aùive_vşass
;

85 
¡d
::
veùÜ
<
ušt32_t
 > 
vşass_ty³_¬y
;

87 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
; i++) {

88 ià(
aùive_vşass_¬y
[
i
]) {

89 
‹mp_vc
 = 
i
*
m_vc_³r_vÃt
;

90 
vşass_ty³_¬y
.
	`push_back
((
ušt32_t
)

91 
m_ÃtwÜk_±r
->
	`g‘_vÃt_ty³
(
‹mp_vc
));

94 
	`as£¹
(
vşass_ty³_¬y
.
	`size
(è=ğ
num_aùive_vşass
);

96 
ušt32_t
 
num_vc_³r_vşass
 = 
m_vc_³r_vÃt
;

97 
ušt32_t
 
š_buf_³r_d©a_vc
 = 
m_ÃtwÜk_±r
->
	`g‘BufãrsP”D©aVC
();

98 
ušt32_t
 
š_buf_³r_ù¾_vc
 = 
m_ÃtwÜk_±r
->
	`g‘BufãrsP”CŒlVC
();

100 
ušt32_t
 
æ™_width_b™s
 = 
m_ÃtwÜk_±r
->
	`g‘NiFl™Size
() * 8;

102 
ÜiÚ_¹r_±r
 = 
Ãw
 
	`OriÚRou‹r
(

103 
num_š_pÜt
,

104 
num_out_pÜt
,

105 
num_vşass
,

106 
vşass_ty³_¬y
,

107 
num_vc_³r_vşass
,

108 
š_buf_³r_d©a_vc
,

109 
š_buf_³r_ù¾_vc
,

110 
æ™_width_b™s
,

111 
ÜiÚ_cfg_±r


116 
Pbuf_wr_dyn
 = 0.0;

117 
Pbuf_rd_dyn
 = 0.0;

118 
Pvc_¬b_loÿl_dyn
 = 0.0;

119 
Pvc_¬b_glob®_dyn
 = 0.0;

120 
Psw_¬b_loÿl_dyn
 = 0.0;

121 
Psw_¬b_glob®_dyn
 = 0.0;

122 
Pxb¬_dyn
 = 0.0;

124 
Pbuf_¡a
 = 0.0;

125 
Pvc_¬b_¡a
 = 0.0;

126 
Psw_¬b_¡a
 = 0.0;

127 
Pxb¬_¡a
 = 0.0;

135 
i
 = 0; i < 
num_vşass
; i++) {

137 
Pbuf_wr_dyn
 +=

138 
ÜiÚ_¹r_±r
->
	`ÿlc_dyÇmic_’”gy_buf
(
i
, 
WRITE_MODE
, 
çl£
)*

139 (
buf_wr™e_couÁ_aùive
[
i
]/
sim_cyşes
)*
äeq_Hz
;

142 
Pbuf_rd_dyn
 +=

143 
ÜiÚ_¹r_±r
->
	`ÿlc_dyÇmic_’”gy_buf
(
i
, 
READ_MODE
, 
çl£
)*

144 (
buf_»ad_couÁ_aùive
[
i
]/
sim_cyşes
)*
äeq_Hz
;

150 
Pvc_¬b_loÿl_dyn
 +=

151 
ÜiÚ_¹r_±r
->
	`ÿlc_dyÇmic_’”gy_loÿl_vc_¬b
(
i
,

152 
num_vc_³r_vşass
/2, 
çl£
)*

153 (
vc_loÿl_¬b™_couÁ_aùive
[
i
]/
sim_cyşes
)*

154 
äeq_Hz
;

165 
Pvc_¬b_glob®_dyn
 +=

166 
ÜiÚ_¹r_±r
->
	`ÿlc_dyÇmic_’”gy_glob®_vc_¬b
(
i
,

167 
num_š_pÜt
/2, 
çl£
)*

168 (
vc_glob®_¬b™_couÁ_aùive
[
i
]/
sim_cyşes
)*

169 
äeq_Hz
;

175 
Psw_¬b_loÿl_dyn
 =

176 
ÜiÚ_¹r_±r
->
	`ÿlc_dyÇmic_’”gy_loÿl_sw_¬b
(

177 
num_vşass
*
num_vc_³r_vşass
/2, 
çl£
)*

178 (
sw_loÿl_¬b™_couÁ
/
sim_cyşes
)*

179 
äeq_Hz
;

184 
Psw_¬b_glob®_dyn
 =

185 
ÜiÚ_¹r_±r
->
	`ÿlc_dyÇmic_’”gy_glob®_sw_¬b
(

186 
num_š_pÜt
/2, 
çl£
)*

187 (
sw_glob®_¬b™_couÁ
/
sim_cyşes
)*

188 
äeq_Hz
;

191 
Pxb¬_dyn
 =

192 
ÜiÚ_¹r_±r
->
	`ÿlc_dyÇmic_’”gy_xb¬
(
çl£
)*

193 (
üossb¬_couÁ
/
sim_cyşes
)*
äeq_Hz
;

196 
m_pow”_dyn
 = 
Pbuf_wr_dyn
 + 
Pbuf_rd_dyn
 +

197 
Pvc_¬b_loÿl_dyn
 + 
Pvc_¬b_glob®_dyn
 +

198 
Psw_¬b_loÿl_dyn
 + 
Psw_¬b_glob®_dyn
 +

199 
Pxb¬_dyn
;

202 
m_şk_pow”
 = 
ÜiÚ_¹r_±r
->
	`ÿlc_dyÇmic_’”gy_şock
()*
äeq_Hz
;

205 
Pbuf_¡a
 = 
ÜiÚ_¹r_±r
->
	`g‘_¡©ic_pow”_buf
();

206 
Pvc_¬b_¡a
 = 
ÜiÚ_¹r_±r
->
	`g‘_¡©ic_pow”_va
();

207 
Psw_¬b_¡a
 = 
ÜiÚ_¹r_±r
->
	`g‘_¡©ic_pow”_§
();

208 
Pxb¬_¡a
 = 
ÜiÚ_¹r_±r
->
	`g‘_¡©ic_pow”_xb¬
();

210 
m_pow”_¡a
 = 
Pbuf_¡a
 + 
Pvc_¬b_¡a
 + 
Psw_¬b_¡a
 + 
Pxb¬_¡a
;

211 
	}
}

214 
	gN‘wÜkLšk_d
::
	$ÿlcuÏ‹_pow”
()

216 
OriÚCÚfig
* 
ÜiÚ_cfg_±r
;

217 
OriÚLšk
* 
ÜiÚ_lšk_±r
;

218 
äeq_Hz
;

219 
lšk_Ëngth
;

222 cÚ¡ 
¡ršg
 
cfg_â
 = "src/mem/ruby/network/orion/router.cfg";

223 
ÜiÚ_cfg_±r
 = 
Ãw
 
	`OriÚCÚfig
(
cfg_â
);

224 
äeq_Hz
 = 
ÜiÚ_cfg_±r
->
g‘
<>("FREQUENCY");

226 
lšk_Ëngth
 = 
ÜiÚ_cfg_±r
->
g‘
<>("LINK_LENGTH");

228 
chªÃl_width_b™s
 = 
chªÃl_width
*8;

230 
ÜiÚ_lšk_±r
 = 
Ãw
 
	`OriÚLšk
(

231 
lšk_Ëngth
,

232 
chªÃl_width_b™s
,

233 
ÜiÚ_cfg_±r
);

235 
sim_cyşes
 = ()(
m_Ãt_±r
->
	`curCyşe
(è- 
g_ruby_¡¬t
);

239 
lšk_dyÇmic_’”gy
 =

240 
ÜiÚ_lšk_±r
->
	`ÿlc_dyÇmic_’”gy
(
chªÃl_width_b™s
/2);

241 
m_pow”_dyn
 = 
lšk_dyÇmic_’”gy
 * (
m_lšk_utized
 / 
sim_cyşes
) *

242 
äeq_Hz
;

248 
m_pow”_¡a
 = 
ÜiÚ_lšk_±r
->
	`g‘_¡©ic_pow”
();

250 
d–‘e
 
ÜiÚ_lšk_±r
;

251 
d–‘e
 
ÜiÚ_cfg_±r
;

252 
	}
}

	@ruby/network/orion/NetworkPower.hh

32 #iâdeà
POWER_TRACE_H


33 
	#POWER_TRACE_H


	)

35 
	~<ÿs£¹
>

36 
	~<c¡dio
>

37 
	~<c¡dlib
>

39 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/G¬ÃtN‘wÜk_d.hh
"

40 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/N‘wÜkLšk_d.hh
"

41 
	~"mem/ruby/ÃtwÜk/g¬Ãt/fixed-p–še/Rou‹r_d.hh
"

44 
	#READ_MODE
 0

	)

45 
	#WRITE_MODE
 1

	)

	@ruby/network/orion/OrionConfig.cc

31 
	~<io¡»am
>

32 
	~<¡ršg
>

34 
	~"mem/ruby/ÃtwÜk/ÜiÚ/CÚfigFe.hh
"

35 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

36 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

38 
usšg
 
Çme¥aû
 
	g¡d
;

40 
¡ršg
 
	gOriÚCÚfig
::
ms_·¿m_Çme
[] = {

97 
	gOriÚCÚfig
::
	$OriÚCÚfig
(cÚ¡ 
¡ršg
& 
cfg_â_
)

99 
ušt32_t
 
num_·¿m
 = (
ms_·¿m_Çme
)/(
¡ršg
);

101 
ušt32_t
 
i
 = 0; i < 
num_·¿m
; i++)

103 
m_·¿ms_m­
[
ms_·¿m_Çme
[
i
]] = "NOT_SET";

106 
	`»ad_fe
(
cfg_â_
);

107 
m_‹ch_·¿m_±r
 = 
Ãw
 
	`TechP¬am‘”
(
this
);

108 
	}
}

110 
	gOriÚCÚfig
::
	$OriÚCÚfig
(cÚ¡ 
OriÚCÚfig
& 
ÜiÚ_cfg_
)

112 
m_·¿ms_m­
 = 
ÜiÚ_cfg_
.m_params_map;

113 
m_num_š_pÜt
 = 
ÜiÚ_cfg_
.m_num_in_port;

114 
m_num_out_pÜt
 = 
ÜiÚ_cfg_
.m_num_out_port;

115 
m_num_vşass
 = 
ÜiÚ_cfg_
.m_num_vclass;

116 
m_num_vchªÃl
 = 
ÜiÚ_cfg_
.m_num_vchannel;

117 
m_š_buf_num_£t
 = 
ÜiÚ_cfg_
.m_in_buf_num_set;

118 
m_æ™_width
 = 
ÜiÚ_cfg_
.m_flit_width;

120 
m_‹ch_·¿m_±r
 = 
Ãw
 
	`TechP¬am‘”
(
this
);

121 
	}
}

123 
	gOriÚCÚfig
::~
	$OriÚCÚfig
()

125 
d–‘e
 
m_‹ch_·¿m_±r
;

126 
	}
}

128 
	gOriÚCÚfig
::
	$£t_num_š_pÜt
(
ušt32_t
 
num_š_pÜt_
)

130 
m_·¿ms_m­
[
	`¡ršg
("NUM_INPUT_PORT")] = 
T_as_¡ršg
<
ušt32_t
>(
num_š_pÜt_
);

131 
m_num_š_pÜt
 = 
num_š_pÜt_
;

133 
	}
}

135 
	gOriÚCÚfig
::
	$£t_num_out_pÜt
(
ušt32_t
 
num_out_pÜt_
)

137 
m_·¿ms_m­
[
	`¡ršg
("NUM_OUTPUT_PORT")] = 
T_as_¡ršg
<
ušt32_t
>(
num_out_pÜt_
);

138 
m_num_out_pÜt
 = 
num_out_pÜt_
;

140 
	}
}

142 
	gOriÚCÚfig
::
	$£t_num_vşass
(
ušt32_t
 
num_vşass_
)

144 
m_·¿ms_m­
[
	`¡ršg
("NUM_VIRTUAL_CLASS")] = 
T_as_¡ršg
<
ušt32_t
>(
num_vşass_
);

145 
m_num_vşass
 = 
num_vşass_
;

147 
	}
}

149 
	gOriÚCÚfig
::
	$£t_num_vchªÃl
(
ušt32_t
 
num_vchªÃl_
)

151 
m_·¿ms_m­
[
	`¡ršg
("NUM_VIRTUAL_CHANNEL")] = 
T_as_¡ršg
<
ušt32_t
>(
num_vchªÃl_
);

152 
m_num_vchªÃl
 = 
num_vchªÃl_
;

154 
	}
}

156 
	gOriÚCÚfig
::
	$£t_š_buf_num_£t
(
ušt32_t
 
š_buf_num_£t_
)

158 
m_·¿ms_m­
[
	`¡ršg
("IN_BUF_NUM_SET")] = 
T_as_¡ršg
<
ušt32_t
>(
š_buf_num_£t_
);

159 
m_š_buf_num_£t
 = 
š_buf_num_£t_
;

161 
	}
}

163 
	gOriÚCÚfig
::
	$£t_æ™_width
(
ušt32_t
 
æ™_width_
)

165 
m_·¿ms_m­
[
	`¡ršg
("FLIT_WIDTH")] = 
T_as_¡ršg
<
ušt32_t
>(
æ™_width_
);

166 
m_æ™_width
 = 
æ™_width_
;

168 
	}
}

170 
	gOriÚCÚfig
::
	$»ad_fe
(

171 cÚ¡ 
¡ršg
& 
f’ame_


174 
CÚfigFe
 
	`cfg_fe
(
f’ame_
);

176 
ušt32_t
 
num_·¿m
 = (
ms_·¿m_Çme
)/(
¡ršg
);

177 
ušt32_t
 
i
 = 0; i < 
num_·¿m
; i++)

179 
cfg_fe
.
	`»adIÁo
(
m_·¿ms_m­
[
ms_·¿m_Çme
[
i
]], ms_param_name[i]);

182 
m_num_š_pÜt
 = 
g‘
<
ušt32_t
>("NUM_INPUT_PORT");

183 
m_num_out_pÜt
 = 
g‘
<
ušt32_t
>("NUM_OUTPUT_PORT");

184 
m_num_vşass
 = 
g‘
<
ušt32_t
>("NUM_VIRTUAL_CLASS");

185 
m_num_vchªÃl
 = 
g‘
<
ušt32_t
>("NUM_VIRTUAL_CHANNEL");

186 
m_š_buf_num_£t
 = 
g‘
<
ušt32_t
>("IN_BUF_NUM_SET");

187 
m_æ™_width
 = 
g‘
<
ušt32_t
>("FLIT_WIDTH");

189 
	}
}

191 
	gOriÚCÚfig
::
	$´št_cÚfig
(
o¡»am
& 
out_
)

193 
ušt32_t
 
num_·¿m
 = (
ms_·¿m_Çme
)/(
¡ršg
);

195 
ušt32_t
 
i
 = 0; i < 
num_·¿m
; i++)

197 
out_
 << 
ms_·¿m_Çme
[
i
] << " = " << 
m_·¿ms_m­
[ms_·¿m_Çme[i]] << 
’dl
;

200 
	}
}

	@ruby/network/orion/OrionConfig.hh

31 #iâdeà
__ORIONCONFIG_H__


32 
	#__ORIONCONFIG_H__


	)

34 
	~<io¡»am
>

35 
	~<m­
>

36 
	~<s¡»am
>

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

40 
şass
 
	gTechP¬am‘”
;

42 şas 
	cOriÚCÚfig


44 
	mpublic
:

45 
OriÚCÚfig
(cÚ¡ 
¡ršg
& 
cfg_â_
);

46 
OriÚCÚfig
(cÚ¡ OriÚCÚfig& 
ÜiÚ_cfg_
);

47 ~
OriÚCÚfig
();

49 
	mpublic
:

50 
£t_num_š_pÜt
(
ušt32_t
 
num_š_pÜt_
);

51 
£t_num_out_pÜt
(
ušt32_t
 
num_out_pÜt_
);

52 
£t_num_vşass
(
ušt32_t
 
num_vşass_
);

53 
£t_num_vchªÃl
(
ušt32_t
 
num_vchªÃl_
);

54 
£t_š_buf_num_£t
(
ušt32_t
 
š_buf_num_£t_
);

55 
£t_æ™_width
(
ušt32_t
 
æ™_width_
);

57 
»ad_fe
(cÚ¡ 
¡d
::
¡ršg
& 
f’ame_
);

58 
´št_cÚfig
(
¡d
::
o¡»am
& 
out_
);

60 
	mpublic
:

61 
‹m¶©e
<
şass
 
T
>

62 
T
 
g‘
(cÚ¡ 
¡d
::
¡ršg
& 
key_
) const;

63 cÚ¡ 
TechP¬am‘”
* 
	$g‘_‹ch_·¿m_±r
(ècÚ¡ {  
m_‹ch_·¿m_±r
; }

64 
ušt32_t
 
	$g‘_num_š_pÜt
(ècÚ¡ {  
m_num_š_pÜt
; 
	}
}

65 
ušt32_t
 
	$g‘_num_out_pÜt
(ècÚ¡ {  
m_num_out_pÜt
; 
	}
}

66 
ušt32_t
 
	$g‘_num_vşass
(ècÚ¡ {  
m_num_vşass
; 
	}
}

67 
ušt32_t
 
	$g‘_num_vchªÃl
(ècÚ¡ {  
m_num_vchªÃl
; 
	}
}

68 
ušt32_t
 
	$g‘_š_buf_num_£t
(ècÚ¡ {  
m_š_buf_num_£t
; 
	}
}

69 
ušt32_t
 
	$g‘_æ™_width
(ècÚ¡ {  
m_æ™_width
; 
	}
}

71 
	g´iv©e
:

72 
¡d
::
m­
<¡d::
¡ršg
, 
	g¡d
::¡ršg> 
m_·¿ms_m­
;

74 
TechP¬am‘”
* 
	gm_‹ch_·¿m_±r
;

75 
ušt32_t
 
	gm_num_š_pÜt
;

76 
ušt32_t
 
	gm_num_out_pÜt
;

77 
ušt32_t
 
	gm_num_vşass
;

78 
ušt32_t
 
	gm_num_vchªÃl
;

79 
ušt32_t
 
	gm_š_buf_num_£t
;

80 
ušt32_t
 
	gm_æ™_width
;

82 
	g´Ùeùed
:

83 
	skey_nÙ_found


85 
¡d
::
¡ršg
 
m_key
;

86 
key_nÙ_found
(cÚ¡ 
¡d
::
¡ršg
& 
key_
 = sŒšg()è: 
m_key
(key_)

89 
	g‹m¶©e
<
şass
 
	gT
>

90 
T
 
¡ršg_as_T
(cÚ¡ 
¡d
::
¡ršg
& 
¡r_
);

91 
	g‹m¶©e
<
şass
 
	gT
>

92 
	g¡d
::
¡ršg
 
T_as_¡ršg
(cÚ¡ 
T
& 
t_
);

94 
	g´iv©e
:

95 
¡d
::
¡ršg
 
ms_·¿m_Çme
[];

98 
	g‹m¶©e
<
şass
 
	gT
>

99 
T
 
	gOriÚCÚfig
::
	$g‘
(cÚ¡ 
¡ršg
& 
key_
) const

101 
¡d
::
m­
<¡d::
¡ršg
, std::¡ršg>::
cÚ¡_™”©Ü
 
™
;

103 
™
 = 
m_·¿ms_m­
.
	`fšd
(
key_
);

104 ià(
™
 =ğ
m_·¿ms_m­
.
	`’d
())

106 
¡d
::
û¼
 << 
key_
 << " NOT FOUND!" << std::
’dl
;

107 
throw
 
	`key_nÙ_found
(
key_
);

109  
¡ršg_as_T
<
T
>(
™
->
£cÚd
);

110 
	}
}

112 
	g‹m¶©e
<
şass
 
	gT
>

113 
T
 
	gOriÚCÚfig
::
	$¡ršg_as_T
(cÚ¡ 
¡ršg
& 
¡r_
)

115 
T
 
»t
;

116 
¡d
::
i¡ršg¡»am
 
	`i¡
(
¡r_
);

117 
i¡
 >> 
»t
;

118  
»t
;

119 
	}
}

121 
	g‹m¶©e
<>

122 
šlše
 
¡ršg
 
	gOriÚCÚfig
::
¡ršg_as_T
<¡ršg>(cÚ¡ sŒšg& 
¡r_
)

124  
¡r_
;

127 
	g‹m¶©e
<>

128 
šlše
 
boŞ
 
	gOriÚCÚfig
::
¡ršg_as_T
<boŞ>(cÚ¡ 
¡ršg
& 
¡r_
)

130 
boŞ
 
»t
;

131 ià(
	g¡r_
 =ğ
¡ršg
("TRUE"))

133 
»t
 = 
Œue
;

135 ià(
	g¡r_
 =ğ
¡ršg
("FALSE"))

137 
»t
 = 
çl£
;

141 
	g¡d
::
û¼
 << "Inv®id boŞ v®ue: '" << 
¡r_
 <<

142 "'. T»©ed‡ FALSE." << 
¡d
::
’dl
;

143 
	g»t
 = 
çl£
;

145  
	g»t
;

148 
	g‹m¶©e
<
şass
 
	gT
>

149 
¡ršg
 
	gOriÚCÚfig
::
	$T_as_¡ršg
(cÚ¡ 
T
& 
t
)

151 
¡d
::
o¡ršg¡»am
 
o¡
;

152 
o¡
 << 
t
;

153  
o¡
.
	`¡r
();

154 
	}
}

	@ruby/network/orion/OrionLink.cc

36 
	~<ÿs£¹
>

37 
	~<io¡»am
>

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚLšk.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Wœe.hh
"

43 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	gOriÚLšk
::
	$OriÚLšk
(

46 
Ën_
,

47 
ušt32_t
 
lše_width_
,

48 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


51 
	`as£¹
(
Ën_
 ==†en_);

52 
	`as£¹
(
lše_width_
 ==†ine_width_);

54 
m_Ën
 = 
Ën_
;

55 
m_lše_width
 = 
lše_width_
;

56 
m_ÜiÚ_cfg_±r
 = 
ÜiÚ_cfg_±r_
;

58 
	`š™
();

59 
	}
}

61 
	gOriÚLšk
::~
	$OriÚLšk
()

62 {
	}
}

64 
OriÚLšk
::
	$ÿlc_dyÇmic_’”gy
(
ušt32_t
 
num_b™_æ_
) const

66 
	`as£¹
(
num_b™_æ_
 <ğ
m_lše_width
);

67  (
num_b™_æ_
*(
m_dyÇmic_’”gy_³r_b™
/2));

68 
	}
}

70 
	gOriÚLšk
::
	$g‘_¡©ic_pow”
() const

72  (
m_lše_width
*
m_¡©ic_pow”_³r_b™
);

73 
	}
}

75 
	gOriÚLšk
::
	$š™
()

77 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r
 = 
m_ÜiÚ_cfg_±r
->
	`g‘_‹ch_·¿m_±r
();

79 cÚ¡ 
¡ršg
& 
width_¥acšg_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("WIRE_WIDTH_SPACING");

80 cÚ¡ 
¡ršg
& 
buf_scheme_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("WIRE_BUFFERING_MODEL");

81 
boŞ
 
is_sh›ldšg
 = 
m_ÜiÚ_cfg_±r
->
g‘
<bool>("WIRE_IS_SHIELDING");

82 
Wœe
 
	`wœe
(
width_¥acšg_mod–_¡r
, 
buf_scheme_¡r
, 
is_sh›ldšg
, 
‹ch_·¿m_±r
);

84 
m_dyÇmic_’”gy_³r_b™
 = 
wœe
.
	`ÿlc_dyÇmic_’”gy
(
m_Ën
);

85 
m_¡©ic_pow”_³r_b™
 = 
wœe
.
	`ÿlc_¡©ic_pow”
(
m_Ën
);

87 
	}
}

89 
	gOriÚLšk
::
	$´št
() const

91 
cout
 << "Lšk - DyÇmiøEÃrgy" << 
’dl
;

92 
cout
 << "\t" << "OÃ B™ = " << 
	`ÿlc_dyÇmic_’”gy
(1è<< 
’dl
;

93 
cout
 << 
’dl
;

94 
cout
 << "Lšk - StiøPow”" << 
’dl
;

95 
cout
 << "\t" << "OÃ B™ = " << 
	`g‘_¡©ic_pow”
(è<< 
’dl
;

96 
cout
 << 
’dl
;

98 
	}
}

	@ruby/network/orion/OrionLink.hh

36 #iâdeà
__ORIONLINK_H__


37 
	#__ORIONLINK_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

42 
şass
 
	gOriÚCÚfig
;

44 şas 
	cOriÚLšk


46 
	mpublic
:

47 
OriÚLšk
(

48 
Ën_
,

49 
ušt32_t
 
lše_width_
,

50 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


52 ~
OriÚLšk
();

54 
	mpublic
:

55 
	$ÿlc_dyÇmic_’”gy
(
ušt32_t
 
num_b™_æ_
) const;

56 
	$g‘_¡©ic_pow”
() const;

58 
	$´št
() const;

60 
´iv©e
:

61 
	`š™
();

63 
´iv©e
:

64 
m_Ën
;

65 
ušt32_t
 
m_lše_width
;

66 cÚ¡ 
OriÚCÚfig
* 
m_ÜiÚ_cfg_±r
;

68 
m_dyÇmic_’”gy_³r_b™
;

69 
m_¡©ic_pow”_³r_b™
;

	@ruby/network/orion/OrionRouter.cc

36 
	~<ÿs£¹
>

38 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/SWAÎoÿtÜ.hh
"

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/AÎoÿtÜ/VCAÎoÿtÜ.hh
"

40 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Bufãr/Bufãr.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Crossb¬/Crossb¬.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Clock.hh
"

43 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

44 
	~"OriÚRou‹r.hh
"

46 
usšg
 
Çme¥aû
 
	g¡d
;

48 
	gOriÚRou‹r
::
OriÚRou‹r
(

49 
ušt32_t
 
num_š_pÜt_
,

50 
ušt32_t
 
num_out_pÜt_
,

51 
ušt32_t
 
num_vşass_
,

52 
¡d
::
veùÜ
<
ušt32_t
 > 
vşass_ty³_¬y_
,

53 
ušt32_t
 
num_vc_³r_vşass_
,

54 
ušt32_t
 
š_buf_³r_d©a_vc_
,

55 
ušt32_t
 
š_buf_³r_ù¾_vc_
,

56 
ušt32_t
 
æ™_width_
,

57 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


60 
as£¹
((
num_š_pÜt_
 ==‚um_in_port_) && (num_in_port_ != 0));

61 
as£¹
((
num_out_pÜt_
 ==‚um_out_port_) && (num_out_port_ != 0));

62 
as£¹
((
num_vşass_
 ==‚um_vclass_) && (num_vclass_ != 0));

63 
as£¹
((
num_vc_³r_vşass_
 ==‚um_vc_per_vclass_) && (num_vc_per_vclass_ != 0));

64 
as£¹
(
š_buf_³r_d©a_vc_
 != 0);

65 
as£¹
(
š_buf_³r_ù¾_vc_
 != 0);

66 
as£¹
((
æ™_width_
 == flit_width_) && (flit_width_ != 0));

68 
	gÜiÚ_cfg_±r_
->
£t_num_š_pÜt
(
num_š_pÜt_
);

69 
	gÜiÚ_cfg_±r_
->
£t_num_out_pÜt
(
num_out_pÜt_
);

70 
	gÜiÚ_cfg_±r_
->
£t_num_vşass
(
num_vşass_
);

71 
	gÜiÚ_cfg_±r_
->
£t_æ™_width
(
æ™_width_
);

72 
	gm_ÜiÚ_cfg_±r
 = 
ÜiÚ_cfg_±r_
;

74 
	gm_num_š_pÜt
 = 
m_ÜiÚ_cfg_±r
->
g‘
<
ušt32_t
>("NUM_INPUT_PORT");

75 
	gm_num_out_pÜt
 = 
m_ÜiÚ_cfg_±r
->
g‘
<
ušt32_t
>("NUM_OUTPUT_PORT");

76 
	gm_æ™_width
 = 
m_ÜiÚ_cfg_±r
->
g‘
<
ušt32_t
>("FLIT_WIDTH");

77 
	gm_num_vşass
 = 
m_ÜiÚ_cfg_±r
->
g‘
<
ušt32_t
>("NUM_VIRTUAL_CLASS");

79 
	gm_num_vc_³r_vşass_¬y
 = 
Ãw
 
ušt32_t
 [
m_num_vşass
];

80 
	gm_š_buf_num_£t_¬y
 = 
Ãw
 
ušt32_t
 [
m_num_vşass
];

81 
	gi
 = 0; i < 
	gm_num_vşass
; i++)

84 
	gm_num_vc_³r_vşass_¬y
[
i
] = 
num_vc_³r_vşass_
;

86 ià(
	gvşass_ty³_¬y_
[
i
] == 0)

87 
m_š_buf_num_£t_¬y
[
i
] = 
š_buf_³r_ù¾_vc_
;

88 ià(
	gvşass_ty³_¬y_
[
i
] == 1)

89 
m_š_buf_num_£t_¬y
[
i
] = 
š_buf_³r_d©a_vc_
;

91 
as£¹
(0);

94 
š™
();

97 
	gOriÚRou‹r
::~
	$OriÚRou‹r
()

99 
d–‘e
[] 
m_num_vc_³r_vşass_¬y
;

100 
d–‘e
[] 
m_š_buf_num_£t_¬y
;

102 ià(
m_š_buf_¬y_±r
)

104 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

106 
d–‘e
 
m_š_buf_¬y_±r
[
i
];

108 
d–‘e
[] 
m_š_buf_¬y_±r
;

111 ià(
m_va_¬y_±r
)

113 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

115 
d–‘e
 
m_va_¬y_±r
[
i
];

117 
d–‘e
[] 
m_va_¬y_±r
;

120 
d–‘e
 
m_xb¬_±r
;

121 
d–‘e
 
m_§_±r
;

122 
d–‘e
 
m_şk_±r
;

123 
	}
}

125 
	gOriÚRou‹r
::
	$ÿlc_dyÇmic_’”gy_buf
(
ušt32_t
 
vşass_id_
, 
boŞ
 
is_»ad_
, boŞ 
is_max_
) const

127 
	`as£¹
(
vşass_id_
 < 
m_num_vşass
);

128 ià(
m_š_buf_¬y_±r
)

130 ià(
m_š_buf_¬y_±r
[
vşass_id_
])

132  
m_š_buf_¬y_±r
[
vşass_id_
]->
	`g‘_dyÇmic_’”gy
(
is_»ad_
, 
is_max_
);

143 
	}
}

145 
	gOriÚRou‹r
::
	$ÿlc_dyÇmic_’”gy_xb¬
(
boŞ
 
is_max_
) const

147 ià(
m_xb¬_±r
)

149  
m_xb¬_±r
->
	`g‘_dyÇmic_’”gy
(
is_max_
);

155 
	}
}

157 
	gOriÚRou‹r
::
	$ÿlc_dyÇmic_’”gy_loÿl_vc_¬b
(
ušt32_t
 
vşass_id_
, 
num_»q_
, 
boŞ
 
is_max_
) const

159 
	`as£¹
(
vşass_id_
 < 
m_num_vşass
);

161 ià(
m_va_¬y_±r
)

163 ià(
m_va_¬y_±r
[
vşass_id_
])

165  
m_va_¬y_±r
[
vşass_id_
]->
	`g‘_dyÇmic_’”gy_loÿl_vc_¬b
(
num_»q_
, 
is_max_
);

176 
	}
}

178 
	gOriÚRou‹r
::
	$ÿlc_dyÇmic_’”gy_glob®_vc_¬b
(
ušt32_t
 
vşass_id_
, 
num_»q_
, 
boŞ
 
is_max_
) const

180 
	`as£¹
(
vşass_id_
 < 
m_num_vşass
);

182 ià(
m_va_¬y_±r
)

184 ià(
m_va_¬y_±r
[
vşass_id_
])

186  
m_va_¬y_±r
[
vşass_id_
]->
	`g‘_dyÇmic_’”gy_glob®_vc_¬b
(
num_»q_
, 
is_max_
);

197 
	}
}

211 
	gOriÚRou‹r
::
	$ÿlc_dyÇmic_’”gy_loÿl_sw_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const

213 ià(
m_§_±r
)

215  
m_§_±r
->
	`g‘_dyÇmic_’”gy_loÿl_sw_¬b
(
num_»q_
, 
is_max_
);

221 
	}
}

223 
	gOriÚRou‹r
::
	$ÿlc_dyÇmic_’”gy_glob®_sw_¬b
(
num_»q_
, 
boŞ
 
is_max_
) const

225 ià(
m_§_±r
)

227  
m_§_±r
->
	`g‘_dyÇmic_’”gy_glob®_sw_¬b
(
num_»q_
, 
is_max_
);

233 
	}
}

235 
	gOriÚRou‹r
::
	$ÿlc_dyÇmic_’”gy_şock
() const

237 ià(
m_şk_±r
)

239  
m_şk_±r
->
	`g‘_dyÇmic_’”gy
();

245 
	}
}

247 
	gOriÚRou‹r
::
	$g‘_¡©ic_pow”_buf
() const

249 ià(
m_š_buf_¬y_±r
)

251 
tÙ®_¡©ic_pow”
 = 0;

253 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

255 
ušt32_t
 
num_š_buf
;

256 ià(
m_is_š_sh¬ed_buf
)

258 
num_š_buf
 = 
m_num_š_pÜt
;

262 
num_š_buf
 = 
m_num_vc_³r_vşass_¬y
[
i
]*
m_num_š_pÜt
;

264 
tÙ®_¡©ic_pow”
 +ğ
m_š_buf_¬y_±r
[
i
]->
	`g‘_¡©ic_pow”
()*()
num_š_buf
;

266  
tÙ®_¡©ic_pow”
;

272 
	}
}

274 
	gOriÚRou‹r
::
	$g‘_¡©ic_pow”_xb¬
() const

276 ià(
m_xb¬_±r
)

278  
m_xb¬_±r
->
	`g‘_¡©ic_pow”
();

284 
	}
}

286 
	gOriÚRou‹r
::
	$g‘_¡©ic_pow”_va
() const

288 ià(
m_va_¬y_±r
)

290 
tÙ®_¡©ic_pow”
 = 0;

292 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

294 
tÙ®_¡©ic_pow”
 +ğ
m_va_¬y_±r
[
i
]->
	`g‘_¡©ic_pow”
();

296  
tÙ®_¡©ic_pow”
;

302 
	}
}

316 
	gOriÚRou‹r
::
	$g‘_¡©ic_pow”_§
() const

318 ià(
m_§_±r
)

320  
m_§_±r
->
	`g‘_¡©ic_pow”
();

326 
	}
}

328 
	gOriÚRou‹r
::
	$g‘_¡©ic_pow”_şock
() const

330 ià(
m_şk_±r
)

332  
m_şk_±r
->
	`g‘_¡©ic_pow”
();

338 
	}
}

340 
	gOriÚRou‹r
::
	$š™
()

342 
m_tÙ®_num_vc
 = 0;

343 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

345 
m_tÙ®_num_vc
 +ğ
m_num_vc_³r_vşass_¬y
[
i
];

348 ià(
m_tÙ®_num_vc
 > 1)

350 
m_is_š_sh¬ed_buf
 = 
m_ÜiÚ_cfg_±r
->
g‘
<
boŞ
>("IS_IN_SHARED_BUFFER");

351 
m_is_out_sh¬ed_buf
 = 
m_ÜiÚ_cfg_±r
->
g‘
<
boŞ
>("IS_OUT_SHARED_BUFFER");

352 
m_is_š_sh¬ed_sw™ch
 = 
m_ÜiÚ_cfg_±r
->
g‘
<
boŞ
>("IS_IN_SHARED_SWITCH");

353 
m_is_out_sh¬ed_sw™ch
 = 
m_ÜiÚ_cfg_±r
->
g‘
<
boŞ
>("IS_OUT_SHARED_SWITCH");

357 
m_is_š_sh¬ed_buf
 = 
çl£
;

358 
m_is_out_sh¬ed_buf
 = 
çl£
;

359 
m_is_š_sh¬ed_sw™ch
 = 
çl£
;

360 
m_is_out_sh¬ed_sw™ch
 = 
çl£
;

364 
boŞ
 
is_š_buf
 = 
m_ÜiÚ_cfg_±r
->
g‘
<bool>("IS_INPUT_BUFFER");

365 ià(
is_š_buf
)

367 
boŞ
 
is_fifo
 = 
Œue
;

368 
boŞ
 
is_outdrv
 = (!
m_is_š_sh¬ed_buf
è&& (
m_is_š_sh¬ed_sw™ch
);

369 cÚ¡ 
¡ršg
& 
š_buf_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("IN_BUF_MODEL");

370 
m_š_buf_¬y_±r
 = 
Ãw
 
Bufãr
* [
m_num_vşass
];

371 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

373 
ušt32_t
 
š_buf_num_»ad_pÜt
 = 
m_ÜiÚ_cfg_±r
->
g‘
<uint32_t>("IN_BUF_NUM_READ_PORT");

374 
ušt32_t
 
š_buf_num_£t
 = 
m_š_buf_num_£t_¬y
[
i
];

375 
m_š_buf_¬y_±r
[
i
] = 
Ãw
 
	`Bufãr
(
š_buf_mod–_¡r
, 
is_fifo
, 
is_outdrv
,

376 
š_buf_num_£t
, 
m_æ™_width
, 
š_buf_num_»ad_pÜt
, 1, 
m_ÜiÚ_cfg_±r
);

381 
m_š_buf_¬y_±r
 = 
NULL
;

384 
boŞ
 
is_out_buf
 = 
m_ÜiÚ_cfg_±r
->
g‘
<bool>("IS_OUTPUT_BUFFER");

387 
ušt32_t
 
num_sw™ch_š
;

388 ià(
is_š_buf
)

390 ià(
m_is_š_sh¬ed_buf
)

392 
ušt32_t
 
š_buf_num_»ad_pÜt
 = 
m_ÜiÚ_cfg_±r
->
g‘
<uint32_t>("IN_BUF_NUM_READ_PORT");

393 
num_sw™ch_š
 = 
š_buf_num_»ad_pÜt
*
m_num_š_pÜt
;

395 ià(
m_is_š_sh¬ed_sw™ch
)

397 
num_sw™ch_š
 = 1*
m_num_š_pÜt
;

401 
num_sw™ch_š
 = 
m_tÙ®_num_vc
*
m_num_š_pÜt
;

406 
num_sw™ch_š
 = 1*
m_num_š_pÜt
;

408 
ušt32_t
 
num_sw™ch_out
;

409 ià(
is_out_buf
)

411 ià(
m_is_out_sh¬ed_buf
)

413 
ušt32_t
 
out_buf_num_wr™e_pÜt
 = 
m_ÜiÚ_cfg_±r
->
g‘
<uint32_t>("OUT_BUF_NUM_WRITE_PORT");

414 
num_sw™ch_out
 = 
out_buf_num_wr™e_pÜt
*
m_num_out_pÜt
;

416 ià(
m_is_out_sh¬ed_sw™ch
)

418 
num_sw™ch_out
 = 1*
m_num_out_pÜt
;

422 
num_sw™ch_out
 = 
m_tÙ®_num_vc
*
m_num_out_pÜt
;

427 
num_sw™ch_out
 = 1*
m_num_out_pÜt
;

429 cÚ¡ 
¡ršg
& 
xb¬_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("CROSSBAR_MODEL");

430 
m_xb¬_±r
 = 
Crossb¬
::
	`ü—‹_üossb¬
(
xb¬_mod–_¡r
,

431 
num_sw™ch_š
, 
num_sw™ch_out
, 
m_æ™_width
, 
m_ÜiÚ_cfg_±r
);

434 cÚ¡ 
¡ršg
& 
va_mod–_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("VA_MODEL");

435 
m_va_¬y_±r
 = 
Ãw
 
VCAÎoÿtÜ
* [
m_num_vşass
];

437 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

439 
m_va_¬y_±r
[
i
] = 
VCAÎoÿtÜ
::
	`ü—‹_vÿÎoÿtÜ
(
va_mod–_¡r
,

440 
m_num_š_pÜt
, 
m_num_out_pÜt
, 1, 
m_num_vc_³r_vşass_¬y
[
i
],

441 
m_ÜiÚ_cfg_±r
);

447 
m_§_±r
 = 
SWAÎoÿtÜ
::
	`ü—‹_sw®loÿtÜ
(

448 
m_num_š_pÜt
, 
m_num_out_pÜt
, 1, 
m_tÙ®_num_vc
,

449 
m_xb¬_±r
, 
m_ÜiÚ_cfg_±r
);

452 
m_şk_±r
 = 
Ãw
 
	`Clock
(
is_š_buf
, 
m_is_š_sh¬ed_sw™ch
, 
is_out_buf
, 
m_is_out_sh¬ed_sw™ch
, 
m_ÜiÚ_cfg_±r
);

455 
	}
}

457 
	gOriÚRou‹r
::
	$´št
() const

459 ià(
m_š_buf_¬y_±r
)

461 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

463 
cout
 << "VCÏs " << 
i
 << 
’dl
;

464 ià(
m_š_buf_¬y_±r
[
i
]èm_š_buf_¬y_±r[i]->
	`´št_®l
();

467 
m_xb¬_±r
->
	`´št_®l
();

468 
ušt32_t
 
i
 = 0; i < 
m_num_vşass
; i++)

470 
cout
 << "VCÏs " << 
i
 << 
’dl
;

471 
m_va_¬y_±r
[
i
]->
	`´št_®l
();

474 
m_§_±r
->
	`´št_®l
();

496 
	}
}

	@ruby/network/orion/OrionRouter.hh

36 #iâdeà
__ORIONROUTER_H__


37 
	#__ORIONROUTER_H__


	)

39 
	~<veùÜ
>

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

43 
şass
 
	gOriÚCÚfig
;

44 
şass
 
	gBufãr
;

45 
şass
 
	gCrossb¬
;

46 
şass
 
	gVCAÎoÿtÜ
;

47 
şass
 
	gSWAÎoÿtÜ
;

48 
şass
 
	gClock
;

50 şas 
	cOriÚRou‹r


52 
	mpublic
:

53 
OriÚRou‹r
(

54 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


58 
OriÚRou‹r
(

59 
ušt32_t
 
num_š_pÜt_
,

60 
ušt32_t
 
num_out_pÜt_
,

61 
ušt32_t
 
num_vşass_
,

62 
¡d
::
veùÜ
<
ušt32_t
 > 
vşass_ty³_
,

63 
ušt32_t
 
num_vc_³r_vşass_
,

64 
ušt32_t
 
š_buf_³r_d©a_vc_
,

65 
ušt32_t
 
š_buf_³r_ù¾_vc_
,

66 
ušt32_t
 
æ™_width_
,

67 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


69 ~
OriÚRou‹r
();

71 
	mpublic
:

75 
	$ÿlc_dyÇmic_’”gy_buf
(
ušt32_t
 
vşass_id_
, 
boŞ
 
is_»ad_
, boŞ 
is_max_
 = 
çl£
) const;

76 
	$ÿlc_dyÇmic_’”gy_xb¬
(
boŞ
 
is_max_
 = 
çl£
) const;

77 
	$ÿlc_dyÇmic_’”gy_loÿl_vc_¬b
(
ušt32_t
 
vşass_id_
, 
num_»q_
, 
boŞ
 
is_max_
 = 
çl£
) const;

78 
	$ÿlc_dyÇmic_’”gy_glob®_vc_¬b
(
ušt32_t
 
vşass_id_
, 
num_»q_
, 
boŞ
 
is_max_
 = 
çl£
) const;

80 
	$ÿlc_dyÇmic_’”gy_loÿl_sw_¬b
(
num_»q_
, 
boŞ
 
is_max_
 = 
çl£
) const;

81 
	$ÿlc_dyÇmic_’”gy_glob®_sw_¬b
(
num_»q_
, 
boŞ
 
is_max_
 = 
çl£
) const;

82 
	$ÿlc_dyÇmic_’”gy_şock
() const;

84 
	$g‘_¡©ic_pow”_buf
() const;

85 
	$g‘_¡©ic_pow”_xb¬
() const;

86 
	$g‘_¡©ic_pow”_va
() const;

87 
	$g‘_¡©ic_pow”_§
() const;

88 
	$g‘_¡©ic_pow”_şock
() const;

90 
	$´št
() const;

92 
	`š™
();

94 
´iv©e
:

95 cÚ¡ 
OriÚCÚfig
* 
m_ÜiÚ_cfg_±r
;

97 
ušt32_t
 
m_num_š_pÜt
;

98 
ušt32_t
 
m_num_out_pÜt
;

99 
ušt32_t
 
m_æ™_width
;

100 
ušt32_t
 
m_num_vşass
;

101 
ušt32_t
 
num_vc_³r_vşass
;

102 
ušt32_t
 
m_tÙ®_num_vc
;

103 
ušt32_t
* 
m_num_vc_³r_vşass_¬y
;

104 
ušt32_t
* 
m_š_buf_num_£t_¬y
;

105 
boŞ
 
m_is_š_sh¬ed_buf
;

106 
boŞ
 
m_is_out_sh¬ed_buf
;

107 
boŞ
 
m_is_š_sh¬ed_sw™ch
;

108 
boŞ
 
m_is_out_sh¬ed_sw™ch
;

110 
Bufãr
** 
m_š_buf_¬y_±r
;

111 
Crossb¬
* 
m_xb¬_±r
;

112 
VCAÎoÿtÜ
** 
m_va_¬y_±r
;

114 
SWAÎoÿtÜ
* 
m_§_±r
;

115 
Clock
* 
m_şk_±r
;

	@ruby/network/orion/TechParameter.cc

36 
	~<cm©h
>

37 
	~<c¡dlib
>

38 
	~<io¡»am
>

39 
	~<¡ršg
>

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

44 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gTechP¬am‘”
::
	$TechP¬am‘”
(

47 cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_


50 
m_ÜiÚ_cfg_±r
 = 
ÜiÚ_cfg_±r_
;

51 
ušt32_t
 
‹ch_node
 = 
m_ÜiÚ_cfg_±r
->
g‘
<uint32_t>("TECH_NODE");

52 
‹ch_node
)

64 
m_‹ch_node
 = 
‹ch_node
;

67 
û¼
 << "Inv®idechnŞogy‚od(" << 
‹ch_node
 << ")" << 
’dl
;

68 
	`ex™
(1);

71 cÚ¡ 
¡ršg
& 
Œªsi¡Ü_ty³_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("TRANSISTOR_TYPE");

72 if(
Œªsi¡Ü_ty³_¡r
 == "LVT")

74 
m_Œªsi¡Ü_ty³
 = 
LVT
;

76 if(
Œªsi¡Ü_ty³_¡r
 == "NVT")

78 
m_Œªsi¡Ü_ty³
 = 
NVT
;

80 if(
Œªsi¡Ü_ty³_¡r
 == "HVT")

82 
m_Œªsi¡Ü_ty³
 = 
HVT
;

86 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
Œªsi¡Ü_ty³_¡r
 << ")" << 
’dl
;

87 
	`ex™
(1);

90 
m_vdd
 = 
m_ÜiÚ_cfg_±r
->
g‘
<>("VDD");

91 
m_äeq
 = 
m_ÜiÚ_cfg_±r
->
g‘
<>("FREQUENCY");

92 
m_³riod
 = 1 / 
m_äeq
;

94 cÚ¡ 
¡ršg
& 
wœe_Ïy”_ty³_¡r
 = 
m_ÜiÚ_cfg_±r
->
g‘
<string>("WIRE_LAYER_TYPE");

95 ià(
wœe_Ïy”_ty³_¡r
 == "LOCAL")

97 
m_wœe_Ïy”_ty³
 = 
LOCAL
;

99 ià(
wœe_Ïy”_ty³_¡r
 == "INTERMEDIATE")

101 
m_wœe_Ïy”_ty³
 = 
INTERMEDIATE
;

103 ià(
wœe_Ïy”_ty³_¡r
 == "GLOBAL")

105 
m_wœe_Ïy”_ty³
 = 
GLOBAL
;

109 
û¼
 << "Inv®id wœÏy”y³ (" << 
wœe_Ïy”_ty³_¡r
 << ")" << 
’dl
;

110 
	`ex™
(1);

113 
	`š™
();

114 
	}
}

116 
	gTechP¬am‘”
::~
	$TechP¬am‘”
()

117 {
	}
}

119 
TechP¬am‘”
::
	$š™
()

121 
m_af
 = 5.000000e-01;

122 
m_max_n
 = 8;

123 
m_max_sub¬¿ys
 = 8;

124 
m_max_¥d
 = 8;

125 
m_vth_outdr_nÜ
 = 4.310000e-01;

126 
m_vth_comp_šv
 = 4.370000e-01;

127 
m_b™_out
 = 64;

128 
m_ruu_issue_width
 = 4;

129 
m_amp_id§t
 = 5.000000e-04;

130 
m_vs_šv
 = 4.560000e-01;

131 
m_g’_pow”_çùÜ
 = 1.310000e+00;

132 
m_vth_Çnd_60x90
 = 5.610000e-01;

133 
m_fudge_çùÜ
 = 1.000000e+00;

134 
m_vth_outdrive
 = 4.250000e-01;

135 
m_vth_muxdrv1
 = 4.370000e-01;

136 
m_vth_muxdrv2
 = 4.860000e-01;

137 
m_nÜm®ize_sÿË
 = 6.488730e-10;

138 
m_vth_muxdrv3
 = 4.370000e-01;

139 
m_add»ss_b™s
 = 64;

140 
m_ruu_size
 = 16;

141 
m_vth_nÜ_12x4x1
 = 5.030000e-01;

142 
m_vth_nÜ_12x4x2
 = 4.520000e-01;

143 
m_vth_outdr_šv
 = 4.370000e-01;

144 
m_vth_nÜ_12x4x3
 = 4.170000e-01;

145 
m_vth_ev®_šv
 = 2.670000e-01;

146 
m_vth_nÜ_12x4x4
 = 3.900000e-01;

147 
m_»s_Ÿlu
 = 4;

148 
m_vth_outdr_Çnd
 = 4.410000e-01;

149 
m_vth_šv_100x60
 = 4.380000e-01;

151 if((
m_‹ch_node
 >= 110))

153 
	`š™_‹ch_110_800
();

157 
	`š™_‹ch_32_90
();

160 
	}
}

162 
	gTechP¬am‘”
::
	$š™_‹ch_110_800
()

164 
m_Cg©•ass
 = 1.450000e-15;

165 
m_Cpdifç»a
 = 6.060000e-16;

166 
m_Cpdiffside
 = 2.400000e-16;

167 
m_Cndiffside
 = 2.400000e-16;

168 
m_Cndifç»a
 = 6.600000e-16;

169 
m_Cnov”Ïp
 = 1.320000e-16;

170 
m_Cpov”Ïp
 = 1.210000e-16;

171 
m_Cg©e
 = 9.040000e-15;

172 
m_CpdiffovÍ
 = 1.380000e-16;

173 
m_CndiffovÍ
 = 1.380000e-16;

174 
m_CnoxideovÍ
 = 2.230000e-16;

175 
m_CpoxideovÍ
 = 3.380000e-16;

179 
	}
}

181 
	gTechP¬am‘”
::
	$š™_‹ch_32_90
()

183 
m_Œªsi¡Ü_ty³
)

185 
LVT
:

186 
m_Cg©•ass
 = 1.5225000e-14;

187 
m_Cpdifç»a
 = 6.05520000e-15;

188 
m_Cpdiffside
 = 2.38380000e-15;

189 
m_Cndiffside
 = 2.8500000e-16;

190 
m_Cndifç»a
 = 5.7420000e-15;

191 
m_Cnov”Ïp
 = 1.320000e-16;

192 
m_Cpov”Ïp
 = 1.210000e-16;

193 
m_Cg©e
 = 7.8648000e-14;

194 
m_CpdiffovÍ
 = 1.420000e-16;

195 
m_CndiffovÍ
 = 1.420000e-16;

196 
m_CnoxideovÍ
 = 2.580000e-16;

197 
m_CpoxideovÍ
 = 3.460000e-16;

199 
NVT
:

200 
m_Cg©•ass
 = 8.32500e-15;

201 
m_Cpdifç»a
 = 3.330600e-15;

202 
m_Cpdiffside
 = 1.29940000e-15;

203 
m_Cndiffside
 = 2.5500000e-16;

204 
m_Cndifç»a
 = 2.9535000e-15;

205 
m_Cnov”Ïp
 = 1.270000e-16;

206 
m_Cpov”Ïp
 = 1.210000e-16;

207 
m_Cg©e
 = 3.9664000e-14;

208 
m_CpdiffovÍ
 = 1.31000e-16;

209 
m_CndiffovÍ
 = 1.310000e-16;

210 
m_CnoxideovÍ
 = 2.410000e-16;

211 
m_CpoxideovÍ
 = 3.170000e-16;

213 
HVT
:

214 
m_Cg©•ass
 = 1.45000e-15;

215 
m_Cpdifç»a
 = 6.06000e-16;

216 
m_Cpdiffside
 = 2.150000e-16;

217 
m_Cndiffside
 = 2.25000e-16;

218 
m_Cndifç»a
 = 1.650000e-16;

219 
m_Cnov”Ïp
 = 1.220000e-16;

220 
m_Cpov”Ïp
 = 1.210000e-16;

221 
m_Cg©e
 = 6.8000e-16;

222 
m_CpdiffovÍ
 = 1.20000e-16;

223 
m_CndiffovÍ
 = 1.20000e-16;

224 
m_CnoxideovÍ
 = 2.230000e-16;

225 
m_CpoxideovÍ
 = 2.880000e-16;

228 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

229 
	`ex™
(1);

232 
m_Vb™´e
 = 
m_vdd
;

233 
m_Vb™£n£
 = 0.08;

234 
m_EÃrgyFaùÜ
 = 
m_vdd
*m_vdd;

235 
m_S’£EÃrgyFaùÜ
 = 
m_vdd
*m_vdd/2;

236 
m_S’£EÃrgyFaùÜ2
 = (
m_Vb™´e
-
m_Vb™£n£
)*(m_Vbitpre-m_Vbitsense);

237 
m_S’£EÃrgyFaùÜ3
 = 
m_Vb™£n£
*m_Vbitsense;

239 if((
m_‹ch_node
 == 90) || (m_tech_node == 65))

241 
m_SCALE_T
 = 1;

242 
m_SCALE_M
 = 1;

243 
m_SCALE_S
 = 1;

244 
m_SCALE_W
 = 1;

245 
m_SCALE_H
 = 1;

246 
m_SCALE_BW
 = 1;

247 
m_SCALE_Crs
 = 1;

249 if(
m_‹ch_node
 == 45)

251 
m_Œªsi¡Ü_ty³
)

253 
LVT
:

254 
m_SCALE_T
 = 0.9123404;

255 
m_SCALE_M
 = 0.6442105;

256 
m_SCALE_S
 = 2.3352694;

257 
m_SCALE_W
 = 0.51;

258 
m_SCALE_H
 = 0.88;

259 
m_SCALE_BW
 = 0.73;

260 
m_SCALE_Crs
 = 0.7;

262 
NVT
:

263 
m_SCALE_T
 = 0.8233582;

264 
m_SCALE_M
 = 0.6442105;

265 
m_SCALE_S
 = 2.1860558;

266 
m_SCALE_W
 = 0.51;

267 
m_SCALE_H
 = 0.88;

268 
m_SCALE_BW
 = 0.73;

269 
m_SCALE_Crs
 = 0.7;

271 
HVT
:

272 
m_SCALE_T
 = 0.73437604;

273 
m_SCALE_M
 = 0.6442105;

274 
m_SCALE_S
 = 2.036842;

275 
m_SCALE_W
 = 0.51;

276 
m_SCALE_H
 = 0.88;

277 
m_SCALE_BW
 = 0.73;

278 
m_SCALE_Crs
 = 0.7;

281 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

282 
	`ex™
(1);

285 if(
m_‹ch_node
 == 32)

287 
m_Œªsi¡Ü_ty³
)

289 
LVT
:

290 
m_SCALE_T
 = 0.7542128;

291 
m_SCALE_M
 = 0.4863158;

292 
m_SCALE_S
 = 2.9692334;

293 
m_SCALE_W
 = 0.26;

294 
m_SCALE_H
 = 0.77;

295 
m_SCALE_BW
 = 0.53;

296 
m_SCALE_Crs
 = 0.49;

298 
NVT
:

299 
m_SCALE_T
 = 0.6352095;

300 
m_SCALE_M
 = 0.4863158;

301 
m_SCALE_S
 = 3.1319851;

302 
m_SCALE_W
 = 0.26;

303 
m_SCALE_H
 = 0.77;

304 
m_SCALE_BW
 = 0.53;

305 
m_SCALE_Crs
 = 0.49;

307 
HVT
:

308 
m_SCALE_T
 = 0.5162063;

309 
m_SCALE_M
 = 0.4863158;

310 
m_SCALE_S
 = 3.294737;

311 
m_SCALE_W
 = 0.26;

312 
m_SCALE_H
 = 0.77;

313 
m_SCALE_BW
 = 0.53;

314 
m_SCALE_Crs
 = 0.49;

317 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

318 
	`ex™
(1);

323 
û¼
 << "Inv®idechnŞogy‚od(" << 
m_‹ch_node
 << ")" << 
’dl
;

324 
	`ex™
(1);

327 if(
m_‹ch_node
 == 90)

329 
m_LSCALE
 = 0.125;

330 
m_MSCALE
 = (
m_LSCALE
 * .624 / .2250);

333 
m_B™Width
 = 2.0;

336 
m_B™Height
 = 2.0;

338 
m_Cout
 = 6.25e-14;

340 
m_B™lšeS·cšg
 = 1.1;

341 
m_WÜdlšeS·cšg
 = 1.1;

343 
m_RegC–lHeight
 = 2.8;

344 
m_RegC–lWidth
 = 1.9;

346 
m_CwÜdm‘®
 = 1.936e-15;

347 
m_Cb™m‘®
 = 3.872e-15;

349 
m_Cm‘®
 = 
m_Cb™m‘®
/16;

350 
m_CM2m‘®
 = 
m_Cb™m‘®
/16;

351 
m_CM3m‘®
 = 
m_Cb™m‘®
/16;

354 
m_CCm‘®
 = 0.18608e-15;

355 
m_CCM2m‘®
 = 0.18608e-15;

356 
m_CCM3m‘®
 = 0.18608e-15;

358 
m_CC2m‘®
 = 0.12529e-15;

359 
m_CC2M2m‘®
 = 0.12529e-15;

360 
m_CC2M3m‘®
 = 0.12529e-15;

362 
m_CC3m‘®
 = 0.11059e-15;

363 
m_CC3M2m‘®
 = 0.11059e-15;

364 
m_CC3M3m‘®
 = 0.11059e-15;

367 
m_Clockwœe
 = 404.8e-12;

368 
m_Reswœe
 = 36.66e3;

369 
m_švC­
 = 3.816e-14;

370 
m_Resout
 = 213.6;

373 
m_Leff
 = 0.1;

375 
m_Lamda
 = 
m_Leff
 * 0.5;

378 
m_CpŞywœe
 = 2.6317875e-15;

381 
m_RnchªÃl¡©ic
 = 3225;

384 
m_RpchªÃl¡©ic
 = 7650;

387 
m_Œªsi¡Ü_ty³
)

389 
LVT
:

390 
m_RnchªÃlÚ
 = 1716;

391 
m_RpchªÃlÚ
 = 4202;

393 
NVT
:

394 
m_RnchªÃlÚ
 = 4120;

395 
m_RpchªÃlÚ
 = 10464;

397 
HVT
:

398 
m_RnchªÃlÚ
 = 4956;

399 
m_RpchªÃlÚ
 = 12092;

402 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

403 
	`ex™
(1);

407 
m_Rb™m‘®
 = 1.38048;

408 
m_RwÜdm‘®
 = 0.945536;

410 
m_Œªsi¡Ü_ty³
)

412 
LVT
:

413 
m_Vt
 = 0.237;

415 
NVT
:

416 
m_Vt
 = 0.307;

418 
HVT
:

419 
m_Vt
 = 0.482;

422 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

423 
	`ex™
(1);

427 
m_Œªsi¡Ü_ty³
)

429 
LVT
:

430 
m_Wdecdriv•
 = 12.50;

431 
m_Wdecdriv’
 = 6.25;

432 
m_Wdec3to8n
 = 11.25;

433 
m_Wdec3to8p
 = 7.5;

434 
m_WdecNORn
 = 0.30;

435 
m_WdecNORp
 = 1.5;

436 
m_Wdecšvn
 = 0.63;

437 
m_Wdecšvp
 = 1.25;

438 
m_Wdff
 = 12.29;

440 
m_WwÜddrivemax
 = 12.50;

441 
m_WmemûÎa
 = 0.35;

442 
m_WmemûÎr
 = 0.50;

443 
m_WmemûÎw
 = 0.26;

444 
m_WmemûÎbsÿË
 = 2;

445 
m_Wb™´“qu
 = 1.25;

447 
m_Wb™muxn
 = 1.25;

448 
m_W£n£Q1to4
 = 0.55;

449 
m_Wcompšvp1
 = 1.25;

450 
m_Wcompšvn1
 = 0.75;

451 
m_Wcompšvp2
 = 2.50;

452 
m_Wcompšvn2
 = 1.50;

453 
m_Wcompšvp3
 = 5.15;

454 
m_Wcompšvn3
 = 3.25;

455 
m_Wev®švp
 = 2.50;

456 
m_Wev®švn
 = 9.45;

458 
m_Wcom²
 = 1.25;

459 
m_Wcomµ
 = 3.75;

460 
m_Wcomµ»equ
 = 5.15;

461 
m_Wmuxdrv12n
 = 3.75;

462 
m_Wmuxdrv12p
 = 6.25;

463 
m_WmuxdrvNANDn
 = 2.50;

464 
m_WmuxdrvNANDp
 = 10.33;

465 
m_WmuxdrvNORn
 = 7.33;

466 
m_WmuxdrvNORp
 = 10.66;

467 
m_Wmuxdrv3n
 = 24.85;

468 
m_Wmuxdrv3p
 = 60.25;

469 
m_Woutdrv£Ê
 = 1.55;

470 
m_Woutdrv£Í
 = 2.33;

471 
m_WoutdrvÇndn
 = 3.27;

472 
m_WoutdrvÇndp
 = 1.25;

473 
m_WoutdrvnÜn
 = 0.75;

474 
m_WoutdrvnÜp
 = 5.33;

475 
m_Woutdriv”n
 = 6.16;

476 
m_Woutdriv”p
 = 9.77;

477 
m_Wbusdrvn
 = 6.16;

478 
m_Wbusdrvp
 = 10.57;

480 
m_WcompûÎpd2
 = 0.33;

481 
m_Wcompdriv”n
 = 50.95;

482 
m_Wcompdriv”p
 = 102.67;

483 
m_Wcom·»n2
 = 5.13;

484 
m_Wcom·»n1
 = 2.5;

485 
m_Wm©chpchg
 = 1.25;

486 
m_Wm©chšvn
 = 1.33;

487 
m_Wm©chšvp
 = 2.77;

488 
m_Wm©chÇndn
 = 2.33;

489 
m_Wm©chÇndp
 = 1.76;

490 
m_Wm©chnÜn
 = 2.66;

491 
m_Wm©chnÜp
 = 1.15;

493 
m_WS–ORn
 = 1.25;

494 
m_WS–OR´equ
 = 5.15;

495 
m_WS–Pn
 = 1.86;

496 
m_WS–Pp
 = 1.86;

497 
m_WS–EÂ
 = 0.63;

498 
m_WS–EÅ
 = 1.25;

500 
m_W£n£extdrv1p
 = 5.15;

501 
m_W£n£extdrv1n
 = 3.05;

502 
m_W£n£extdrv2p
 = 25.20;

503 
m_W£n£extdrv2n
 = 15.65;

505 
NVT
:

506 
m_Wdecdriv•
 = 11.57;

507 
m_Wdecdriv’
 = 5.74;

508 
m_Wdec3to8n
 = 10.31;

509 
m_Wdec3to8p
 = 6.87;

510 
m_WdecNORn
 = 0.28;

511 
m_WdecNORp
 = 1.38;

512 
m_Wdecšvn
 = 0.58;

513 
m_Wdecšvp
 = 1.15;

514 
m_Wdff
 = 6.57;

516 
m_WwÜddrivemax
 = 11.57;

517 
m_WmemûÎa
 = 0.33;

518 
m_WmemûÎr
 = 0.46;

519 
m_WmemûÎw
 = 0.24;

520 
m_WmemûÎbsÿË
 = 2;

521 
m_Wb™´“qu
 = 1.15;

523 
m_Wb™muxn
 = 1.15;

524 
m_W£n£Q1to4
 = 0.49;

525 
m_Wcompšvp1
 = 1.17;

526 
m_Wcompšvn1
 = 0.69;

527 
m_Wcompšvp2
 = 2.29;

528 
m_Wcompšvn2
 = 1.38;

529 
m_Wcompšvp3
 = 4.66;

530 
m_Wcompšvn3
 = 2.88;

531 
m_Wev®švp
 = 2.29;

532 
m_Wev®švn
 = 8.89;

534 
m_Wcom²
 = 1.15;

535 
m_Wcomµ
 = 3.44;

536 
m_Wcomµ»equ
 = 4.66;

537 
m_Wmuxdrv12n
 = 3.44;

538 
m_Wmuxdrv12p
 = 5.74;

539 
m_WmuxdrvNANDn
 = 2.29;

540 
m_WmuxdrvNANDp
 = 9.33;

541 
m_WmuxdrvNORn
 = 6.79;

542 
m_WmuxdrvNORp
 = 9.49;

543 
m_Wmuxdrv3n
 = 22.83;

544 
m_Wmuxdrv3p
 = 55.09;

545 
m_Woutdrv£Ê
 = 1.40;

546 
m_Woutdrv£Í
 = 2.21;

547 
m_WoutdrvÇndn
 = 2.89;

548 
m_WoutdrvÇndp
 = 1.15;

549 
m_WoutdrvnÜn
 = 0.69;

550 
m_WoutdrvnÜp
 = 4.75;

551 
m_Woutdriv”n
 = 5.58;

552 
m_Woutdriv”p
 = 9.05;

553 
m_Wbusdrvn
 = 5.58;

554 
m_Wbusdrvp
 = 9.45;

556 
m_WcompûÎpd2
 = 0.29;

557 
m_Wcompdriv”n
 = 46.28;

558 
m_Wcompdriv”p
 = 92.94;

559 
m_Wcom·»n2
 = 4.65;

560 
m_Wcom·»n1
 = 2.29;

561 
m_Wm©chpchg
 = 1.15;

562 
m_Wm©chšvn
 = 1.19;

563 
m_Wm©chšvp
 = 2.43;

564 
m_Wm©chÇndn
 = 2.21;

565 
m_Wm©chÇndp
 = 1.42;

566 
m_Wm©chnÜn
 = 2.37;

567 
m_Wm©chnÜp
 = 1.10;

569 
m_WS–ORn
 = 1.15;

570 
m_WS–OR´equ
 = 4.66;

571 
m_WS–Pn
 = 1.45;

572 
m_WS–Pp
 = 1.71;

573 
m_WS–EÂ
 = 0.58;

574 
m_WS–EÅ
 = 1.15;

576 
m_W£n£extdrv1p
 = 4.66;

577 
m_W£n£extdrv1n
 = 2.78;

578 
m_W£n£extdrv2p
 = 23.02;

579 
m_W£n£extdrv2n
 = 14.07;

581 
HVT
:

582 
m_Wdecdriv•
 = 10.64;

583 
m_Wdecdriv’
 = 5.23;

584 
m_Wdec3to8n
 = 9.36;

585 
m_Wdec3to8p
 = 6.24;

586 
m_WdecNORn
 = 0.25;

587 
m_WdecNORp
 = 1.25;

588 
m_Wdecšvn
 = 0.52;

589 
m_Wdecšvp
 = 1.04;

590 
m_Wdff
 = 5.43;

592 
m_WwÜddrivemax
 = 10.64;

593 
m_WmemûÎa
 = 0.25;

594 
m_WmemûÎr
 = 0.42;

595 
m_WmemûÎw
 = 0.22;

596 
m_WmemûÎbsÿË
 = 2;

597 
m_Wb™´“qu
 = 1.04;

599 
m_Wb™muxn
 = 1.04;

600 
m_W£n£Q1to4
 = 0.42;

601 
m_Wcompšvp1
 = 1.08;

602 
m_Wcompšvn1
 = 0.62;

603 
m_Wcompšvp2
 = 2.08;

604 
m_Wcompšvn2
 = 1.25;

605 
m_Wcompšvp3
 = 4.16;

606 
m_Wcompšvn3
 = 2.50;

607 
m_Wev®švp
 = 2.08;

608 
m_Wev®švn
 = 8.32;

610 
m_Wcom²
 = 1.04;

611 
m_Wcomµ
 = 3.12;

612 
m_Wcomµ»equ
 = 4.16;

613 
m_Wmuxdrv12n
 = 3.12;

614 
m_Wmuxdrv12p
 = 5.23;

615 
m_WmuxdrvNANDn
 = 2.08;

616 
m_WmuxdrvNANDp
 = 8.32;

617 
m_WmuxdrvNORn
 = 6.24;

618 
m_WmuxdrvNORp
 = 8.32;

619 
m_Wmuxdrv3n
 = 20.80;

620 
m_Wmuxdrv3p
 = 49.92;

621 
m_Woutdrv£Ê
 = 1.25;

622 
m_Woutdrv£Í
 = 2.08;

623 
m_WoutdrvÇndn
 = 2.50;

624 
m_WoutdrvÇndp
 = 1.04;

625 
m_WoutdrvnÜn
 = 0.62;

626 
m_WoutdrvnÜp
 = 4.16;

627 
m_Woutdriv”n
 = 4.99;

628 
m_Woutdriv”p
 = 8.32;

629 
m_Wbusdrvn
 = 4.99;

630 
m_Wbusdrvp
 = 8.32;

632 
m_WcompûÎpd2
 = 0.25;

633 
m_Wcompdriv”n
 = 41.60;

634 
m_Wcompdriv”p
 = 83.20;

635 
m_Wcom·»n2
 = 4.16;

636 
m_Wcom·»n1
 = 2.08;

637 
m_Wm©chpchg
 = 1.04;

638 
m_Wm©chšvn
 = 1.04;

639 
m_Wm©chšvp
 = 2.08;

640 
m_Wm©chÇndn
 = 2.08;

641 
m_Wm©chÇndp
 = 1.08;

642 
m_Wm©chnÜn
 = 2.08;

643 
m_Wm©chnÜp
 = 1.04;

645 
m_WS–ORn
 = 1.04;

646 
m_WS–OR´equ
 = 4.16;

647 
m_WS–Pn
 = 1.04;

648 
m_WS–Pp
 = 1.56;

649 
m_WS–EÂ
 = 0.52;

650 
m_WS–EÅ
 = 1.04;

652 
m_W£n£extdrv1p
 = 4.16;

653 
m_W£n£extdrv1n
 = 2.50;

654 
m_W£n£extdrv2p
 = 20.83;

655 
m_W£n£extdrv2n
 = 12.48;

658 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

659 
	`ex™
(1);

662 
m_CamC–lHeight
 = 4.095;

663 
m_CamC–lWidth
 = 3.51;

665 
m_M©chlšeS·cšg
 = 0.75;

666 
m_TaglšeS·cšg
 = 0.75;

668 
m_Crsb¬C–lHeight
 = 2.94;

669 
m_Crsb¬C–lWidth
 = 2.94;

671 
m_kri£
 = 0.5e-10;

672 
m_t£n£d©a
 = 0.725e-10;

673 
m_t£n£g
 = 0.325e-10;

674 
m_tçÎd©a
 = 0.875e-10;

675 
m_tçÎg
 = 0.875e-10;

678 if(
m_‹ch_node
 <= 65)

682 
m_LSCALE
 = 0.087;

683 
m_MSCALE
 = 
m_LSCALE
 * .624 / .2250;

686 
m_B™Width
 = 1.4;

689 
m_B™Height
 = 1.4;

691 
m_Cout
 = 4.35e-14;

694 
m_B™lšeS·cšg
 = 0.8 * 
m_SCALE_BW
;

695 
m_WÜdlšeS·cšg
 = 0.8 * 
m_SCALE_BW
;

697 
m_RegC–lHeight
 = 2.1 * 
m_SCALE_H
;

698 
m_RegC–lWidth
 = 1.4 * 
m_SCALE_W
;

700 
m_CwÜdm‘®
 = 1.63e-15 * 
m_SCALE_M
;

701 
m_Cb™m‘®
 = 3.27e-15 * 
m_SCALE_M
;

703 
m_Cm‘®
 = 
m_Cb™m‘®
/16;

704 
m_CM2m‘®
 = 
m_Cb™m‘®
/16;

705 
m_CM3m‘®
 = 
m_Cb™m‘®
/16;

708 
m_CCm‘®
 = 0.146206e-15;

709 
m_CCM2m‘®
 = 0.146206e-15;

710 
m_CCM3m‘®
 = 0.146206e-15;

712 
m_CC2m‘®
 = 0.09844e-15;

713 
m_CC2M2m‘®
 = 0.09844e-15;

714 
m_CC2M3m‘®
 = 0.09844e-15;

716 
m_CC3m‘®
 = 0.08689e-15;

717 
m_CC3M2m‘®
 = 0.08689e-15;

718 
m_CC3M3m‘®
 = 0.08689e-15;

722 
m_Clockwœe
 = 323.4e-12 * 
m_SCALE_M
;

723 
m_Reswœe
 = 61.11e3 * 1.0/
m_SCALE_M
;

724 
m_švC­
 = 3.12e-14;

725 
m_Resout
 = 361.00;

728 
m_Leff
 = 0.0696;

730 
m_Lamda
 = 
m_Leff
 * 0.5;

733 
m_CpŞywœe
 = 1.832e-15;

735 
m_RnchªÃl¡©ic
 = 2244.6;

738 
m_RpchªÃl¡©ic
 = 5324.4;

740 
m_Œªsi¡Ü_ty³
)

742 
LVT
:

743 
m_RnchªÃlÚ
 = 1370;

744 
m_RpchªÃlÚ
 = 3301;

746 
NVT
:

747 
m_RnchªÃlÚ
 = 2540;

748 
m_RpchªÃlÚ
 = 5791;

750 
HVT
:

751 
m_RnchªÃlÚ
 = 4530;

752 
m_RpchªÃlÚ
 = 10101;

755 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

756 
	`ex™
(1);

759 
m_Rb™m‘®
 = 1.92644;

760 
m_RwÜdm‘®
 = 1.31948;

762 
m_Œªsi¡Ü_ty³
)

764 
LVT
:

765 
m_Vt
 = 0.195;

767 
NVT
:

768 
m_Vt
 = 0.285;

770 
HVT
:

771 
m_Vt
 = 0.524;

774 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

775 
	`ex™
(1);

779 
m_Œªsi¡Ü_ty³
)

781 
LVT
:

782 
m_Wdecdriv•
 = 8.27;

783 
m_Wdecdriv’
 = 6.70;

784 
m_Wdec3to8n
 = 2.33;

785 
m_Wdec3to8p
 = 2.33;

786 
m_WdecNORn
 = 1.50;

787 
m_WdecNORp
 = 3.82;

788 
m_Wdecšvn
 = 8.46;

789 
m_Wdecšvp
 = 10.93;

790 
m_Wdff
 = 8.6;

792 
m_WwÜddrivemax
 = 9.27;

793 
m_WmemûÎa
 = 0.2225;

794 
m_WmemûÎr
 = 0.3708;

795 
m_WmemûÎw
 = 0.1947;

796 
m_WmemûÎbsÿË
 = 1.87;

797 
m_Wb™´“qu
 = 0.927;

799 
m_Wb™muxn
 = 0.927;

800 
m_W£n£Q1to4
 = 0.371;

801 
m_Wcompšvp1
 = 0.927;

802 
m_Wcompšvn1
 = 0.5562;

803 
m_Wcompšvp2
 = 1.854;

804 
m_Wcompšvn2
 = 1.1124;

805 
m_Wcompšvp3
 = 3.708;

806 
m_Wcompšvn3
 = 2.2248;

807 
m_Wev®švp
 = 1.854;

808 
m_Wev®švn
 = 7.416;

811 
m_Wcom²
 = 1.854;

812 
m_Wcomµ
 = 2.781;

813 
m_Wcomµ»equ
 = 3.712;

814 
m_Wmuxdrv12n
 = 2.785;

815 
m_Wmuxdrv12p
 = 4.635;

816 
m_WmuxdrvNANDn
 = 1.860;

817 
m_WmuxdrvNANDp
 = 7.416;

818 
m_WmuxdrvNORn
 = 5.562;

819 
m_WmuxdrvNORp
 = 7.416;

820 
m_Wmuxdrv3n
 = 18.54;

821 
m_Wmuxdrv3p
 = 44.496;

822 
m_Woutdrv£Ê
 = 1.112;

823 
m_Woutdrv£Í
 = 1.854;

824 
m_WoutdrvÇndn
 = 2.225;

825 
m_WoutdrvÇndp
 = 0.927;

826 
m_WoutdrvnÜn
 = 0.5562;

827 
m_WoutdrvnÜp
 = 3.708;

828 
m_Woutdriv”n
 = 4.450;

829 
m_Woutdriv”p
 = 7.416;

830 
m_Wbusdrvn
 = 4.450;

831 
m_Wbusdrvp
 = 7.416;

833 
m_WcompûÎpd2
 = 0.222;

834 
m_Wcompdriv”n
 = 37.08;

835 
m_Wcompdriv”p
 = 74.20;

836 
m_Wcom·»n2
 = 3.708;

837 
m_Wcom·»n1
 = 1.854;

838 
m_Wm©chpchg
 = 0.927;

839 
m_Wm©chšvn
 = 0.930;

840 
m_Wm©chšvp
 = 1.854;

841 
m_Wm©chÇndn
 = 1.854;

842 
m_Wm©chÇndp
 = 0.927;

843 
m_Wm©chnÜn
 = 1.860;

844 
m_Wm©chnÜp
 = 0.930;

846 
m_WS–ORn
 = 0.930;

847 
m_WS–OR´equ
 = 3.708;

848 
m_WS–Pn
 = 0.927;

849 
m_WS–Pp
 = 1.391;

850 
m_WS–EÂ
 = 0.434;

851 
m_WS–EÅ
 = 0.930;

853 
m_W£n£extdrv1p
 = 3.708;

854 
m_W£n£extdrv1n
 = 2.225;

855 
m_W£n£extdrv2p
 = 18.54;

856 
m_W£n£extdrv2n
 = 11.124;

858 
NVT
:

859 
m_Wdecdriv•
 = 6.7;

860 
m_Wdecdriv’
 = 4.7;

861 
m_Wdec3to8n
 = 1.33;

862 
m_Wdec3to8p
 = 1.33;

863 
m_WdecNORn
 = 1.20;

864 
m_WdecNORp
 = 2.62;

865 
m_Wdecšvn
 = 1.46;

866 
m_Wdecšvp
 = 3.93;

867 
m_Wdff
 = 4.6;

869 
m_WwÜddrivemax
 = 9.225;

870 
m_WmemûÎa
 = 0.221;

871 
m_WmemûÎr
 = 0.369;

872 
m_WmemûÎw
 = 0.194;

873 
m_WmemûÎbsÿË
 = 1.87;

874 
m_Wb™´“qu
 = 0.923;

876 
m_Wb™muxn
 = 0.923;

877 
m_W£n£Q1to4
 = 0.369;

878 
m_Wcompšvp1
 = 0.924;

879 
m_Wcompšvn1
 = 0.554;

880 
m_Wcompšvp2
 = 1.845;

881 
m_Wcompšvn2
 = 1.107;

882 
m_Wcompšvp3
 = 3.69;

883 
m_Wcompšvn3
 = 2.214;

884 
m_Wev®švp
 = 1.842;

885 
m_Wev®švn
 = 7.368;

887 
m_Wcom²
 = 1.845;

888 
m_Wcomµ
 = 2.768;

889 
m_Wcomµ»equ
 = 3.692;

890 
m_Wmuxdrv12n
 = 2.773;

891 
m_Wmuxdrv12p
 = 4.618;

892 
m_WmuxdrvNANDn
 = 1.848;

893 
m_WmuxdrvNANDp
 = 7.38;

894 
m_WmuxdrvNORn
 = 5.535;

895 
m_WmuxdrvNORp
 = 7.380;

896 
m_Wmuxdrv3n
 = 18.45;

897 
m_Wmuxdrv3p
 = 44.28;

898 
m_Woutdrv£Ê
 = 1.105;

899 
m_Woutdrv£Í
 = 1.842;

900 
m_WoutdrvÇndn
 = 2.214;

901 
m_WoutdrvÇndp
 = 0.923;

902 
m_WoutdrvnÜn
 = 0.554;

903 
m_WoutdrvnÜp
 = 3.69;

904 
m_Woutdriv”n
 = 4.428;

905 
m_Woutdriv”p
 = 7.380;

906 
m_Wbusdrvn
 = 4.421;

907 
m_Wbusdrvp
 = 7.368;

909 
m_WcompûÎpd2
 = 0.221;

910 
m_Wcompdriv”n
 = 36.84;

911 
m_Wcompdriv”p
 = 73.77;

912 
m_Wcom·»n2
 = 3.684;

913 
m_Wcom·»n1
 = 1.842;

914 
m_Wm©chpchg
 = 0.921;

915 
m_Wm©chšvn
 = 0.923;

916 
m_Wm©chšvp
 = 1.852;

917 
m_Wm©chÇndn
 = 1.852;

918 
m_Wm©chÇndp
 = 0.921;

919 
m_Wm©chnÜn
 = 1.845;

920 
m_Wm©chnÜp
 = 0.923;

922 
m_WS–ORn
 = 0.923;

923 
m_WS–OR´equ
 = 3.684;

924 
m_WS–Pn
 = 0.921;

925 
m_WS–Pp
 = 1.382;

926 
m_WS–EÂ
 = 0.446;

927 
m_WS–EÅ
 = 0.923;

929 
m_W£n£extdrv1p
 = 3.684;

930 
m_W£n£extdrv1n
 = 2.211;

931 
m_W£n£extdrv2p
 = 18.42;

932 
m_W£n£extdrv2n
 = 11.052;

934 
HVT
:

935 
m_Wdecdriv•
 = 3.11;

936 
m_Wdecdriv’
 = 1.90;

937 
m_Wdec3to8n
 = 1.33;

938 
m_Wdec3to8p
 = 1.33;

939 
m_WdecNORn
 = 0.90;

940 
m_WdecNORp
 = 1.82;

941 
m_Wdecšvn
 = 0.46;

942 
m_Wdecšvp
 = 0.93;

943 
m_Wdff
 = 3.8;

945 
m_WwÜddrivemax
 = 9.18;

946 
m_WmemûÎa
 = 0.220;

947 
m_WmemûÎr
 = 0.367;

948 
m_WmemûÎw
 = 0.193;

949 
m_WmemûÎbsÿË
 = 1.87;

950 
m_Wb™´“qu
 = 0.918;

952 
m_Wb™muxn
 = 0.918;

953 
m_W£n£Q1to4
 = 0.366;

954 
m_Wcompšvp1
 = 0.920;

955 
m_Wcompšvn1
 = 0.551;

956 
m_Wcompšvp2
 = 1.836;

957 
m_Wcompšvn2
 = 1.102;

958 
m_Wcompšvp3
 = 3.672;

959 
m_Wcompšvn3
 = 2.203;

960 
m_Wev®švp
 = 1.83;

961 
m_Wev®švn
 = 7.32;

963 
m_Wcom²
 = 1.836;

964 
m_Wcomµ
 = 2.754;

965 
m_Wcomµ»equ
 = 3.672;

966 
m_Wmuxdrv12n
 = 2.760;

967 
m_Wmuxdrv12p
 = 4.60;

968 
m_WmuxdrvNANDn
 = 1.836;

969 
m_WmuxdrvNANDp
 = 7.344;

970 
m_WmuxdrvNORn
 = 5.508;

971 
m_WmuxdrvNORp
 = 7.344;

972 
m_Wmuxdrv3n
 = 18.36;

973 
m_Wmuxdrv3p
 = 44.064;

974 
m_Woutdrv£Ê
 = 1.098;

975 
m_Woutdrv£Í
 = 1.83;

976 
m_WoutdrvÇndn
 = 2.203;

977 
m_WoutdrvÇndp
 = 0.918;

978 
m_WoutdrvnÜn
 = 0.551;

979 
m_WoutdrvnÜp
 = 3.672;

980 
m_Woutdriv”n
 = 4.406;

981 
m_Woutdriv”p
 = 7.344;

982 
m_Wbusdrvn
 = 4.392;

983 
m_Wbusdrvp
 = 7.32;

985 
m_WcompûÎpd2
 = 0.220;

986 
m_Wcompdriv”n
 = 36.6;

987 
m_Wcompdriv”p
 = 73.33;

988 
m_Wcom·»n2
 = 3.66;

989 
m_Wcom·»n1
 = 1.83;

990 
m_Wm©chpchg
 = 0.915;

991 
m_Wm©chšvn
 = 0.915;

992 
m_Wm©chšvp
 = 1.85;

993 
m_Wm©chÇndn
 = 1.85;

994 
m_Wm©chÇndp
 = 0.915;

995 
m_Wm©chnÜn
 = 1.83;

996 
m_Wm©chnÜp
 = 0.915;

998 
m_WS–ORn
 = 0.915;

999 
m_WS–OR´equ
 = 3.66;

1000 
m_WS–Pn
 = 0.915;

1001 
m_WS–Pp
 = 1.373;

1002 
m_WS–EÂ
 = 0.458;

1003 
m_WS–EÅ
 = 0.915;

1005 
m_W£n£extdrv1p
 = 3.66;

1006 
m_W£n£extdrv1n
 = 2.196;

1007 
m_W£n£extdrv2p
 = 18.3;

1008 
m_W£n£extdrv2n
 = 10.98;

1011 
û¼
 << "Inv®id¿nsi¡Üy³ (" << 
m_Œªsi¡Ü_ty³
 << ")" << 
’dl
;

1012 
	`ex™
(1);

1015 
m_CamC–lHeight
 = 2.9575;

1016 
m_CamC–lWidth
 = 2.535;

1018 
m_M©chlšeS·cšg
 = 0.522;

1019 
m_TaglšeS·cšg
 = 0.522;

1021 
m_Crsb¬C–lHeight
 = 2.06 * 
m_SCALE_Crs
;

1022 
m_Crsb¬C–lWidth
 = 2.06 * 
m_SCALE_Crs
;

1024 
m_kri£
 = 0.348e-10;

1025 
m_t£n£d©a
 = 0.5046e-10;

1026 
m_t£n£g
 = 0.2262e-10;

1027 
m_tçÎd©a
 = 0.609e-10;

1028 
m_tçÎg
 = 0.6609e-10;

1033 if(
m_‹ch_node
 == 90)

1035 if(
m_wœe_Ïy”_ty³
 =ğ
LOCAL
)

1037 
m_WœeMšWidth
 = 214e-9;

1038 
m_WœeMšS·cšg
 = 214e-9;

1039 
m_WœeM‘®ThickÃss
 = 363.8e-9;

1040 
m_WœeB¬r›rThickÃss
 = 10e-9;

1041 
m_WœeD›ËùricThickÃss
 = 363.8e-9;

1042 
m_WœeD›ËùricCÚ¡ªt
 = 3.3;

1044 if(
m_wœe_Ïy”_ty³
 =ğ
INTERMEDIATE
)

1046 
m_WœeMšWidth
 = 275e-9;

1047 
m_WœeMšS·cšg
 = 275e-9;

1048 
m_WœeM‘®ThickÃss
 = 467.5e-9;

1049 
m_WœeB¬r›rThickÃss
 = 10e-9;

1050 
m_WœeD›ËùricThickÃss
 = 412.5e-9;

1051 
m_WœeD›ËùricCÚ¡ªt
 = 3.3;

1053 if(
m_wœe_Ïy”_ty³
 =ğ
GLOBAL
)

1055 
m_WœeMšWidth
 = 410e-9;

1056 
m_WœeMšS·cšg
 = 410e-9;

1057 
m_WœeM‘®ThickÃss
 = 861e-9;

1058 
m_WœeB¬r›rThickÃss
 = 10e-9;

1059 
m_WœeD›ËùricThickÃss
 = 779e-9;

1060 
m_WœeD›ËùricCÚ¡ªt
 = 3.3;

1063 if(
m_‹ch_node
 == 65)

1065 if(
m_wœe_Ïy”_ty³
 =ğ
LOCAL
)

1067 
m_WœeMšWidth
 = 136e-9;

1068 
m_WœeMšS·cšg
 = 136e-9;

1069 
m_WœeM‘®ThickÃss
 = 231.2e-9;

1070 
m_WœeB¬r›rThickÃss
 = 4.8e-9;

1071 
m_WœeD›ËùricThickÃss
 = 231.2e-9;

1072 
m_WœeD›ËùricCÚ¡ªt
 = 2.85;

1074 if(
m_wœe_Ïy”_ty³
 =ğ
INTERMEDIATE
)

1076 
m_WœeMšWidth
 = 140e-9;

1077 
m_WœeMšS·cšg
 = 140e-9;

1078 
m_WœeM‘®ThickÃss
 = 252e-9;

1079 
m_WœeB¬r›rThickÃss
 = 5.2e-9;

1080 
m_WœeD›ËùricThickÃss
 = 224e-9;

1081 
m_WœeD›ËùricCÚ¡ªt
 = 2.85;

1083 if(
m_wœe_Ïy”_ty³
 =ğ
GLOBAL
)

1085 
m_WœeMšWidth
 = 400e-9;

1086 
m_WœeMšS·cšg
 = 400e-9;

1087 
m_WœeM‘®ThickÃss
 = 400e-9;

1088 
m_WœeB¬r›rThickÃss
 = 5.2e-9;

1089 
m_WœeD›ËùricThickÃss
 = 790e-9;

1090 
m_WœeD›ËùricCÚ¡ªt
 = 2.9;

1093 if(
m_‹ch_node
 == 45)

1095 if(
m_wœe_Ïy”_ty³
 =ğ
LOCAL
)

1097 
m_WœeMšWidth
 = 45e-9;

1098 
m_WœeMšS·cšg
 = 45e-9;

1099 
m_WœeM‘®ThickÃss
 = 129.6e-9;

1100 
m_WœeB¬r›rThickÃss
 = 3.3e-9;

1101 
m_WœeD›ËùricThickÃss
 = 162e-9;

1102 
m_WœeD›ËùricCÚ¡ªt
 = 2.0;

1104 if(
m_wœe_Ïy”_ty³
 =ğ
INTERMEDIATE
)

1106 
m_WœeMšWidth
 = 45e-9;

1107 
m_WœeMšS·cšg
 = 45e-9;

1108 
m_WœeM‘®ThickÃss
 = 129.6e-9;

1109 
m_WœeB¬r›rThickÃss
 = 3.3e-9;

1110 
m_WœeD›ËùricThickÃss
 = 72e-9;

1111 
m_WœeD›ËùricCÚ¡ªt
 = 2.0;

1113 if(
m_wœe_Ïy”_ty³
 =ğ
GLOBAL
)

1115 
m_WœeMšWidth
 = 67.5e-9;

1116 
m_WœeMšS·cšg
 = 67.5e-9;

1117 
m_WœeM‘®ThickÃss
 = 155.25e-9;

1118 
m_WœeB¬r›rThickÃss
 = 3.3e-9;

1119 
m_WœeD›ËùricThickÃss
 = 141.75e-9;

1120 
m_WœeD›ËùricCÚ¡ªt
 = 2.0;

1123 if(
m_‹ch_node
 == 32)

1125 if(
m_wœe_Ïy”_ty³
 =ğ
LOCAL
)

1127 
m_WœeMšWidth
 = 32e-9;

1128 
m_WœeMšS·cšg
 = 32e-9;

1129 
m_WœeM‘®ThickÃss
 = 60.8e-9;

1130 
m_WœeB¬r›rThickÃss
 = 2.4e-9;

1131 
m_WœeD›ËùricThickÃss
 = 60.8e-9;

1132 
m_WœeD›ËùricCÚ¡ªt
 = 1.9;

1134 if(
m_wœe_Ïy”_ty³
 =ğ
INTERMEDIATE
)

1136 
m_WœeMšWidth
 = 32e-9;

1137 
m_WœeMšS·cšg
 = 32e-9;

1138 
m_WœeM‘®ThickÃss
 = 60.8e-9;

1139 
m_WœeB¬r›rThickÃss
 = 2.4e-9;

1140 
m_WœeD›ËùricThickÃss
 = 54.4e-9;

1141 
m_WœeD›ËùricCÚ¡ªt
 = 1.9;

1143 if(
m_wœe_Ïy”_ty³
 =ğ
GLOBAL
)

1145 
m_WœeMšWidth
 = 48e-9;

1146 
m_WœeMšS·cšg
 = 48e-9;

1147 
m_WœeM‘®ThickÃss
 = 120e-9;

1148 
m_WœeB¬r›rThickÃss
 = 2.4e-9;

1149 
m_WœeD›ËùricThickÃss
 = 110.4e-9;

1150 
m_WœeD›ËùricCÚ¡ªt
 = 1.9;

1156 if(
m_‹ch_node
 == 90)

1158 
m_BufãrDriveResi¡ªû
 = 5.12594e+03;

1159 
m_BufãrIÁršsicD–ay
 = 4.13985e-11;

1160 if(
m_Œªsi¡Ü_ty³
 =ğ
LVT
)

1162 
m_BufãrIÅutC­ac™ªû
 = 1.59e-15;

1163 
m_BufãrPMOSOffCu¼’t
 = 116.2e-09;

1164 
m_BufãrNMOSOffCu¼’t
 = 52.1e-09;

1165 
m_ClockC­
 = 2.7e-14;

1167 if(
m_Œªsi¡Ü_ty³
 =ğ
NVT
)

1169 
m_BufãrIÅutC­ac™ªû
 = 4.7e-15;

1170 
m_BufãrPMOSOffCu¼’t
 = 67.6e-09;

1171 
m_BufãrNMOSOffCu¼’t
 = 31.1e-09;

1172 
m_ClockC­
 = 1.0e-14;

1174 if(
m_Œªsi¡Ü_ty³
 =ğ
HVT
)

1176 
m_BufãrIÅutC­ac™ªû
 = 15.0e-15;

1177 
m_BufãrPMOSOffCu¼’t
 = 19.2e-09;

1178 
m_BufãrNMOSOffCu¼’t
 = 10.1e-09;

1179 
m_ClockC­
 = 0.3e-15;

1183 if(
m_‹ch_node
 == 65)

1185 
m_BufãrDriveResi¡ªû
 = 6.77182e+03;

1186 
m_BufãrIÁršsicD–ay
 = 3.31822e-11;

1187 if(
m_Œªsi¡Ü_ty³
 =ğ
LVT
)

1189 
m_BufãrPMOSOffCu¼’t
 = 317.2e-09;

1190 
m_BufãrNMOSOffCu¼’t
 = 109.7e-09;

1191 
m_BufãrIÅutC­ac™ªû
 = 1.3e-15;

1192 
m_ClockC­
 = 2.6e-14;

1194 if(
m_Œªsi¡Ü_ty³
 =ğ
NVT
)

1196 
m_BufãrPMOSOffCu¼’t
 = 113.1e-09;

1197 
m_BufãrNMOSOffCu¼’t
 = 67.3e-09;

1198 
m_BufãrIÅutC­ac™ªû
 = 2.6e-15;

1199 
m_ClockC­
 = 1.56e-14;

1201 if(
m_Œªsi¡Ü_ty³
 =ğ
HVT
)

1203 
m_BufãrPMOSOffCu¼’t
 = 35.2e-09;

1204 
m_BufãrNMOSOffCu¼’t
 = 18.4e-09;

1205 
m_BufãrIÅutC­ac™ªû
 = 7.8e-15;

1206 
m_ClockC­
 = 0.9e-15;

1210 if(
m_‹ch_node
 == 45)

1212 
m_BufãrDriveResi¡ªû
 = 7.3228e+03;

1213 
m_BufãrIÁršsicD–ay
 = 4.6e-11;

1214 if(
m_Œªsi¡Ü_ty³
 =ğ
LVT
)

1216 
m_BufãrIÅutC­ac™ªû
 = 1.25e-15;

1217 
m_BufãrPMOSOffCu¼’t
 = 1086.75e-09;

1218 
m_BufãrNMOSOffCu¼’t
 = 375.84e-09;

1219 
m_ClockC­
 = 2.5e-14;

1221 if(
m_Œªsi¡Ü_ty³
 =ğ
NVT
)

1223 
m_BufãrIÅutC­ac™ªû
 = 2.5e-15;

1224 
m_BufãrPMOSOffCu¼’t
 = 382.3e-09;

1225 
m_BufãrNMOSOffCu¼’t
 = 195.5e-09;

1226 
m_ClockC­
 = 1.5e-14;

1228 if(
m_Œªsi¡Ü_ty³
 =ğ
HVT
)

1230 
m_BufãrIÅutC­ac™ªû
 = 7.5e-15;

1231 
m_BufãrPMOSOffCu¼’t
 = 76.4e-09;

1232 
m_BufãrNMOSOffCu¼’t
 = 39.1e-09;

1233 
m_ClockC­
 = 0.84e-15;

1237 if(
m_‹ch_node
 == 32)

1239 
m_BufãrDriveResi¡ªû
 = 10.4611e+03;

1240 
m_BufãrIÁršsicD–ay
 = 4.0e-11;

1241 if(
m_Œªsi¡Ü_ty³
 =ğ
LVT
)

1243 
m_BufãrPMOSOffCu¼’t
 = 1630.08e-09;

1244 
m_BufãrNMOSOffCu¼’t
 = 563.74e-09;

1245 
m_BufãrIÅutC­ac™ªû
 = 1.2e-15;

1246 
m_ClockC­
 = 2.2e-14;

1248 if(
m_Œªsi¡Ü_ty³
 =ğ
NVT
)

1250 
m_BufãrPMOSOffCu¼’t
 = 792.4e-09;

1251 
m_BufãrNMOSOffCu¼’t
 = 405.1e-09;

1252 
m_BufãrIÅutC­ac™ªû
 = 2.4e-15;

1253 
m_ClockC­
 = 1.44e-14;

1255 if(
m_Œªsi¡Ü_ty³
 =ğ
HVT
)

1257 
m_BufãrPMOSOffCu¼’t
 = 129.9e-09;

1258 
m_BufãrNMOSOffCu¼’t
 = 66.4e-09;

1259 
m_BufãrIÅutC­ac™ªû
 = 7.2e-15;

1260 
m_ClockC­
 = 0.53e-15;

1265 if(
m_‹ch_node
 == 90)

1267 
m_A»aNOR
 = 4.23;

1268 
m_A»aINV
 = 2.82;

1269 
m_A»aAND
 = 4.23;

1270 
m_A»aDFF
 = 16.23;

1271 
m_A»aMUX2
 = 7.06;

1272 
m_A»aMUX3
 = 11.29;

1273 
m_A»aMUX4
 = 16.93;

1275 if(
m_‹ch_node
 <= 65)

1277 
m_A»aNOR
 = 2.52 * 
m_SCALE_T
;

1278 
m_A»aINV
 = 1.44 * 
m_SCALE_T
;

1279 
m_A»aDFF
 = 8.28 * 
m_SCALE_T
;

1280 
m_A»aAND
 = 2.52 * 
m_SCALE_T
;

1281 
m_A»aMUX2
 = 6.12 * 
m_SCALE_T
;

1282 
m_A»aMUX3
 = 9.36 * 
m_SCALE_T
;

1283 
m_A»aMUX4
 = 12.6 * 
m_SCALE_T
;

1286 ià(
m_‹ch_node
 == 90)

1288 ià(
m_Œªsi¡Ü_ty³
 =ğ
LVT
)

1290 
m_NMOS_TAB
[0] = 19.9e-9;

1291 
m_PMOS_TAB
[0] = 16.6e-9;

1292 
m_NAND2_TAB
[0] = 7.8e-9;

1293 
m_NAND2_TAB
[1] = 24.6e-9;

1294 
m_NAND2_TAB
[2] = 14.1e-9;

1295 
m_NAND2_TAB
[3] = 34.3e-9;

1296 
m_NOR2_TAB
[0] = 51.2e-9;

1297 
m_NOR2_TAB
[1] = 23.9e-9;

1298 
m_NOR2_TAB
[2] = 19.5e-9;

1299 
m_NOR2_TAB
[3] = 8.4e-9;

1300 
m_DFF_TAB
[0] = 219.7e-9;

1302 ià(
m_Œªsi¡Ü_ty³
 =ğ
NVT
)

1304 
m_NMOS_TAB
[0] = 15.6e-9;

1305 
m_PMOS_TAB
[0] = 11.3e-9;

1306 
m_NAND2_TAB
[0] = 2.8e-9;

1307 
m_NAND2_TAB
[1] = 19.6e-9;

1308 
m_NAND2_TAB
[2] = 10.4e-9;

1309 
m_NAND2_TAB
[3] = 29.3e-9;

1310 
m_NOR2_TAB
[0] = 41.5e-9;

1311 
m_NOR2_TAB
[1] = 13.1e-9;

1312 
m_NOR2_TAB
[2] = 14.5e-9;

1313 
m_NOR2_TAB
[3] = 1.4e-9;

1314 
m_DFF_TAB
[0] = 194.7e-9;

1318 
m_NMOS_TAB
[0] = 12.2e-9;

1319 
m_PMOS_TAB
[0] = 9.3e-9;

1320 
m_NAND2_TAB
[0] = 1.8e-9;

1321 
m_NAND2_TAB
[1] = 12.4e-9;

1322 
m_NAND2_TAB
[2] = 8.9e-9;

1323 
m_NAND2_TAB
[3] = 19.3e-9;

1324 
m_NOR2_TAB
[0] = 29.5e-9;

1325 
m_NOR2_TAB
[1] = 8.3e-9;

1326 
m_NOR2_TAB
[2] = 11.1e-9;

1327 
m_NOR2_TAB
[3] = 0.9e-9;

1328 
m_DFF_TAB
[0] = 194.7e-9;

1331 ià(
m_‹ch_node
 <= 65)

1333 ià(
m_Œªsi¡Ü_ty³
 =ğ
LVT
)

1335 
m_NMOS_TAB
[0] = 311.7e-9;

1336 
m_PMOS_TAB
[0] = 674.3e-9;

1337 
m_NAND2_TAB
[0] = 303.0e-9;

1338 
m_NAND2_TAB
[1] = 423.0e-9;

1339 
m_NAND2_TAB
[2] = 498.3e-9;

1340 
m_NAND2_TAB
[3] = 626.3e-9;

1341 
m_NOR2_TAB
[0] = 556.0e-9;

1342 
m_NOR2_TAB
[1] = 393.7e-9;

1343 
m_NOR2_TAB
[2] = 506.7e-9;

1344 
m_NOR2_TAB
[3] = 369.7e-9;

1345 
m_DFF_TAB
[0] = 970.4e-9;

1347 ià(
m_Œªsi¡Ü_ty³
 =ğ
NVT
)

1349 
m_NMOS_TAB
[0] = 115.1e-9;

1350 
m_PMOS_TAB
[0] = 304.8e-9;

1351 
m_NAND2_TAB
[0] = 111.4e-9;

1352 
m_NAND2_TAB
[1] = 187.2e-9;

1353 
m_NAND2_TAB
[2] = 230.7e-9;

1354 
m_NAND2_TAB
[3] = 306.9e-9;

1355 
m_NOR2_TAB
[0] = 289.7e-9;

1356 
m_NOR2_TAB
[1] = 165.7e-9;

1357 
m_NOR2_TAB
[2] = 236.9e-9;

1358 
m_NOR2_TAB
[3] = 141.4e-9;

1359 
m_DFF_TAB
[0] = 400.3e-9;

1363 
m_NMOS_TAB
[0] = 18.4e-9;

1364 
m_PMOS_TAB
[0] = 35.2e-9;

1365 
m_NAND2_TAB
[0] = 19.7e-9;

1366 
m_NAND2_TAB
[1] = 51.3e-9;

1367 
m_NAND2_TAB
[2] = 63.0e-9;

1368 
m_NAND2_TAB
[3] = 87.6e-9;

1369 
m_NOR2_TAB
[0] = 23.4e-9;

1370 
m_NOR2_TAB
[1] = 37.6e-9;

1371 
m_NOR2_TAB
[2] = 67.9e-9;

1372 
m_NOR2_TAB
[3] = 12.3e-9;

1373 
m_DFF_TAB
[0] = 231.3e-9;

1377 
	}
}

1383 
	gTechP¬am‘”
::
	$ÿlc_g©eÿp
(

1384 
width_
,

1385 
wœ–’gth_


1388  ((
width_
*
m_Leff
*
m_Cg©e
 + 
wœ–’gth_
*
m_CpŞywœe
*m_Leff)*
m_SCALE_T
);

1389 
	}
}

1391 
	gTechP¬am‘”
::
	$ÿlc_g©eÿµass
(

1392 
width_
,

1393 
wœ–’gth_


1396  
	`ÿlc_g©eÿp
(
width_
, 
wœ–’gth_
);

1397 
	}
}

1407 
	gTechP¬am‘”
::
	$ÿlc_d¿šÿp
(

1408 
width_
,

1409 
ChªÃlTy³
 
ch_
,

1410 
ušt32_t
 
num_¡ack_


1413 
Cdiffside
, 
Cdifç»a
, 
Cov”Ïp
, 
tÙ®_ÿp
;

1415 ià(
ch_
 =ğ
NCH
)

1417 
Cdiffside
 = 
m_Cndiffside
;

1418 
Cdifç»a
 = 
m_Cndifç»a
;

1419 
Cov”Ïp
 = 
m_Cnov”Ïp
;

1423 
Cdiffside
 = 
m_Cpdiffside
;

1424 
Cdifç»a
 = 
m_Cpdifç»a
;

1425 
Cov”Ïp
 = 
m_Cpov”Ïp
;

1428 ià(
width_
 >= 10)

1430 
tÙ®_ÿp
 = (3.0*
m_Leff
*
width_
/2.0)*
Cdifç»a
 + 6.0*m_Leff*
Cdiffside
 + width_*
Cov”Ïp
;

1431 
tÙ®_ÿp
 +ğ()(
num_¡ack_
 - 1)*(
m_Leff
*
width_
*
Cdifç»a
 + 4.0*m_Leff*
Cdiffside
 + 2.0*width_*
Cov”Ïp
);

1435 
tÙ®_ÿp
 = (3.0*
m_Leff
*
width_
)*
Cdifç»a
 + (6.0*m_Lefà+ width_)*
Cdiffside
 + width_*
Cov”Ïp
;

1436 
tÙ®_ÿp
 +ğ()(
num_¡ack_
 - 1)*(
m_Leff
*
width_
*
Cdifç»a
 + 2.0*m_Leff*
Cdiffside
 + 2.0*width_*
Cov”Ïp
);

1439  (
tÙ®_ÿp
*
m_SCALE_T
);

1440 
	}
}

1442 
	gTechP¬am‘”
::
	$ÿlc_»¡owidth
(

1443 
»s_
,

1444 
ChªÃlTy³
 
ch_


1447 
»¡¿ns
;

1449 
»¡¿ns
 = (
ch_
 =ğ
NCH
)? 
m_RnchªÃlÚ
 : 
m_RpchªÃlÚ
;

1451  (
»¡¿ns
 / 
»s_
);

1452 
	}
}

1454 
	gTechP¬am‘”
::
	$ÿlc_driv”_psize
(

1455 
ÿp_
,

1456 
ri£_time_


1459 
psize
;

1460 
Rpdrive
;

1462 
Rpdrive
 = 
ri£_time_
 / (
ÿp_
 * 
	`log
(
m_vs_šv
) * (-1.0));

1463 
psize
 = 
	`ÿlc_»¡owidth
(
Rpdrive
, 
PCH
);

1465 ià(
psize
 > 
m_WwÜddrivemax
)

1467 
psize
 = 
m_WwÜddrivemax
;

1469 ià(
psize
 < 4.0 * 
m_LSCALE
)

1471 
psize
 = 4.0 * 
m_LSCALE
;

1474  
psize
;

1475 
	}
}

	@ruby/network/orion/TechParameter.hh

36 #iâdeà
__TECHPARAMETER_H__


37 
	#__TECHPARAMETER_H__


	)

39 
	~<¡ršg
>

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

43 
şass
 
	gOriÚCÚfig
;

45 şas 
	cTechP¬am‘”


47 
	mpublic
:

48 
	eT¿nsi¡ÜTy³


50 
LVT
 = 0,

51 
	mNVT
,

52 
	mHVT
,

53 
	mNUM_TRANSISTOR_TYPE


55 
	eWœeLay”Ty³


57 
	gLOCAL
 = 0,

58 
	gINTERMEDIATE
,

59 
	gGLOBAL
,

60 
	gNUM_WIRE_LAYER_TYPE


62 
	eChªÃlTy³


64 
	gNCH
,

65 
	gPCH


68 
	gpublic
:

69 
TechP¬am‘”
(cÚ¡ 
OriÚCÚfig
* 
ÜiÚ_cfg_±r_
);

70 ~
TechP¬am‘”
();

72 
	gpublic
:

73 
	$ÿlc_g©eÿp
(
width_
, 
wœ–’gth_
) const;

74 
	$ÿlc_g©eÿµass
(
width_
, 
wœ–’gth_
) const;

75 
	$ÿlc_d¿šÿp
(
width_
, 
ChªÃlTy³
 
ch_
, 
ušt32_t
 
num_¡ack_
) const;

76 
	$ÿlc_»¡owidth
(
»s_
, 
ChªÃlTy³
 
ch_
) const;

77 
	$ÿlc_driv”_psize
(
ÿp_
, 
ri£_time_
) const;

79 
public
:

80 
boŞ
 
	$is_Œªs_ty³_hvt
(ècÚ¡ {  (
m_Œªsi¡Ü_ty³
 =ğ
HVT
); 
	}
}

81 
boŞ
 
	$is_Œªs_ty³_nvt
(ècÚ¡ {  (
m_Œªsi¡Ü_ty³
 =ğ
NVT
); 
	}
}

82 
boŞ
 
	$is_Œªs_ty³_lvt
(ècÚ¡ {  (
m_Œªsi¡Ü_ty³
 =ğ
LVT
); 
	}
}

83 
	$g‘_‹ch_node
(ècÚ¡ {  
m_‹ch_node
; 
	}
}

84 
	$g‘_vdd
(ècÚ¡ {  
m_vdd
; 
	}
}

85 
	$g‘_äeq
(ècÚ¡ {  
m_äeq
; 
	}
}

86 
	$g‘_³riod
(ècÚ¡ {  
m_³riod
; 
	}
}

87 
	$g‘_amp_id§t
(ècÚ¡ {  
m_amp_id§t
; 
	}
}

89 
	$g‘_SCALE_S
(ècÚ¡ {  
m_SCALE_S
; 
	}
}

90 
	$g‘_MSCALE
(ècÚ¡ {  
m_MSCALE
; 
	}
}

92 
	$g‘_Lamda
(ècÚ¡ {  
m_Lamda
; 
	}
}

94 
	$g‘_Cm‘®
(ècÚ¡ {  
m_Cm‘®
; 
	}
}

95 
	$g‘_CM2m‘®
(ècÚ¡ {  
m_CM2m‘®
; 
	}
}

96 
	$g‘_CM3m‘®
(ècÚ¡ {  
m_CM3m‘®
; 
	}
}

97 
	$g‘_CCm‘®
(ècÚ¡ {  
m_CCm‘®
; 
	}
}

98 
	$g‘_CCM2m‘®
(ècÚ¡ {  
m_CCM2m‘®
; 
	}
}

99 
	$g‘_CCM3m‘®
(ècÚ¡ {  
m_CCM3m‘®
; 
	}
}

100 
	$g‘_CC2m‘®
(ècÚ¡ {  
m_CC2m‘®
; 
	}
}

101 
	$g‘_CC2M2m‘®
(ècÚ¡ {  
m_CC2M2m‘®
; 
	}
}

102 
	$g‘_CC2M3m‘®
(ècÚ¡ {  
m_CC2M3m‘®
; 
	}
}

103 
	$g‘_CC3m‘®
(ècÚ¡ {  
m_CC3m‘®
; 
	}
}

104 
	$g‘_CC3M2m‘®
(ècÚ¡ {  
m_CC3M2m‘®
; 
	}
}

105 
	$g‘_CC3M3m‘®
(ècÚ¡ {  
m_CC3M3m‘®
; 
	}
}

107 
	$g‘_EÃrgyFaùÜ
(ècÚ¡ {  
m_EÃrgyFaùÜ
; 
	}
}

108 
	$g‘_S’£EÃrgyFaùÜ
(ècÚ¡ {  
m_S’£EÃrgyFaùÜ
; 
	}
}

110 
	$g‘_Woutdrv£Ê
(ècÚ¡ {  
m_Woutdrv£Ê
; 
	}
}

111 
	$g‘_Woutdrv£Í
(ècÚ¡ {  
m_Woutdrv£Í
; 
	}
}

112 
	$g‘_WoutdrvÇndn
(ècÚ¡ {  
m_WoutdrvÇndn
; 
	}
}

113 
	$g‘_WoutdrvÇndp
(ècÚ¡ {  
m_WoutdrvÇndp
; 
	}
}

114 
	$g‘_WoutdrvnÜn
(ècÚ¡ {  
m_WoutdrvnÜn
; 
	}
}

115 
	$g‘_WoutdrvnÜp
(ècÚ¡ {  
m_WoutdrvnÜp
; 
	}
}

116 
	$g‘_Woutdriv”n
(ècÚ¡ {  
m_Woutdriv”n
; 
	}
}

117 
	$g‘_Woutdriv”p
(ècÚ¡ {  
m_Woutdriv”p
; 
	}
}

119 
	$g‘_W£n£Q1to4
(ècÚ¡ {  
m_W£n£Q1to4
; 
	}
}

120 
	$g‘_Wb™muxn
(ècÚ¡ {  
m_Wb™muxn
; 
	}
}

121 
	$g‘_WmemûÎr
(ècÚ¡ {  
m_WmemûÎr
; 
	}
}

122 
	$g‘_WmemûÎw
(ècÚ¡ {  
m_WmemûÎw
; 
	}
}

123 
	$g‘_WmemûÎa
(ècÚ¡ {  
m_WmemûÎa
; 
	}
}

124 
	$g‘_WmemûÎbsÿË
(ècÚ¡ {  
m_WmemûÎbsÿË
; 
	}
}

126 
	$g‘_RegC–lHeight
(ècÚ¡ {  
m_RegC–lHeight
; 
	}
}

127 
	$g‘_RegC–lWidth
(ècÚ¡ {  
m_RegC–lWidth
; 
	}
}

128 
	$g‘_WÜdlšeS·cšg
(ècÚ¡ {  
m_WÜdlšeS·cšg
; 
	}
}

129 
	$g‘_B™lšeS·cšg
(ècÚ¡ {  
m_B™lšeS·cšg
; 
	}
}

130 
	$g‘_B™Width
(ècÚ¡ {  
m_B™Width
; 
	}
}

132 
	$g‘_Wdecšvn
(ècÚ¡ {  
m_Wdecšvn
; 
	}
}

133 
	$g‘_Wdecšvp
(ècÚ¡ {  
m_Wdecšvp
; 
	}
}

134 
	$g‘_Wdec3to8n
(ècÚ¡ {  
m_Wdec3to8n
; 
	}
}

135 
	$g‘_Wdec3to8p
(ècÚ¡ {  
m_Wdec3to8p
; 
	}
}

136 
	$g‘_WdecNORn
(ècÚ¡ {  
m_WdecNORn
; 
	}
}

137 
	$g‘_WdecNORp
(ècÚ¡ {  
m_WdecNORp
; 
	}
}

138 
	$g‘_Wdecdriv’
(ècÚ¡ {  
m_Wdecdriv’
; 
	}
}

139 
	$g‘_Wdecdriv•
(ècÚ¡ {  
m_Wdecdriv•
; 
	}
}

141 
	$g‘_Crsb¬C–lWidth
(ècÚ¡ {  
m_Crsb¬C–lWidth
; 
	}
}

142 
	$g‘_Crsb¬C–lHeight
(ècÚ¡ {  
m_Crsb¬C–lHeight
; 
	}
}

144 
	$g‘_Wdff
(ècÚ¡ {  
m_Wdff
; 
	}
}

146 
	$g‘_WœeMšWidth
(ècÚ¡ {  
m_WœeMšWidth
; 
	}
}

147 
	$g‘_WœeMšS·cšg
(ècÚ¡ {  
m_WœeMšS·cšg
; 
	}
}

148 
	$g‘_WœeB¬r›rThickÃss
(ècÚ¡ {  
m_WœeB¬r›rThickÃss
; 
	}
}

149 
	$g‘_WœeM‘®ThickÃss
(ècÚ¡ {  
m_WœeM‘®ThickÃss
; 
	}
}

150 
	$g‘_WœeD›ËùricThickÃss
(ècÚ¡ {  
m_WœeD›ËùricThickÃss
; 
	}
}

151 
	$g‘_WœeD›ËùricCÚ¡ªt
(ècÚ¡ {  
m_WœeD›ËùricCÚ¡ªt
; 
	}
}

152 
	$g‘_BufãrDriveResi¡ªû
(ècÚ¡ {  
m_BufãrDriveResi¡ªû
; 
	}
}

153 
	$g‘_BufãrIÅutC­ac™ªû
(ècÚ¡ {  
m_BufãrIÅutC­ac™ªû
; 
	}
}

154 
	$g‘_BufãrNMOSOffCu¼’t
(ècÚ¡ {  
m_BufãrNMOSOffCu¼’t
; 
	}
}

155 
	$g‘_BufãrPMOSOffCu¼’t
(ècÚ¡ {  
m_BufãrPMOSOffCu¼’t
; 
	}
}

156 
	$g‘_ClockC­
(ècÚ¡ {  
m_ClockC­
; 
	}
}

157 
	$g‘_Clockwœe
(ècÚ¡ {  
m_Clockwœe
; 
	}
}

158 
	$g‘_Reswœe
(ècÚ¡ {  
m_Reswœe
; 
	}
}

160 
	$g‘_NMOS_TAB
(
ušt32_t
 
idx
ècÚ¡ {  
m_NMOS_TAB
[idx]; 
	}
}

161 
	$g‘_PMOS_TAB
(
ušt32_t
 
idx
ècÚ¡ {  
m_PMOS_TAB
[idx]; 
	}
}

162 
	$g‘_NAND2_TAB
(
ušt32_t
 
idx
ècÚ¡ {  
m_NAND2_TAB
[idx]; 
	}
}

163 
	$g‘_NOR2_TAB
(
ušt32_t
 
idx
ècÚ¡ {  
m_NOR2_TAB
[idx]; 
	}
}

164 
	$g‘_DFF_TAB
(
ušt32_t
 
idx
ècÚ¡ {  
m_DFF_TAB
[idx]; 
	}
}

166 
	g´iv©e
:

167 
š™
();

168 
š™_‹ch_110_800
();

169 
š™_‹ch_32_90
();

170 
š™_‹ch_90
();

172 
	g´iv©e
:

173 cÚ¡ 
OriÚCÚfig
* 
m_ÜiÚ_cfg_±r
;

174 
	gm_‹ch_node
;

175 
T¿nsi¡ÜTy³
 
	gm_Œªsi¡Ü_ty³
;

176 
	gm_vdd
;

177 
	gm_äeq
;

178 
	gm_³riod
;

179 
WœeLay”Ty³
 
	gm_wœe_Ïy”_ty³
;

181 
	gm_af
;

182 
ušt32_t
 
	gm_max_n
;

183 
ušt32_t
 
	gm_max_sub¬¿ys
;

184 
ušt32_t
 
	gm_max_¥d
;

185 
	gm_vth_outdr_nÜ
;

186 
	gm_vth_comp_šv
;

187 
ušt32_t
 
	gm_b™_out
;

188 
ušt32_t
 
	gm_ruu_issue_width
;

189 
	gm_amp_id§t
;

190 
	gm_vs_šv
;

191 
	gm_g’_pow”_çùÜ
;

192 
	gm_vth_Çnd_60x90
;

193 
	gm_fudge_çùÜ
;

194 
	gm_vth_outdrive
;

195 
	gm_vth_muxdrv1
;

196 
	gm_vth_muxdrv2
;

197 
	gm_nÜm®ize_sÿË
;

198 
	gm_vth_muxdrv3
;

199 
ušt32_t
 
	gm_add»ss_b™s
;

200 
ušt32_t
 
	gm_ruu_size
;

201 
	gm_vth_nÜ_12x4x1
;

202 
	gm_vth_nÜ_12x4x2
;

203 
	gm_vth_outdr_šv
;

204 
	gm_vth_nÜ_12x4x3
;

205 
	gm_vth_ev®_šv
;

206 
	gm_vth_nÜ_12x4x4
;

207 
ušt32_t
 
	gm_»s_Ÿlu
;

208 
	gm_vth_outdr_Çnd
;

209 
	gm_vth_šv_100x60
;

211 
	gm_Cpdifç»a
;

212 
	gm_Cpdiffside
;

213 
	gm_Cpov”Ïp
;

214 
	gm_Cndifç»a
;

215 
	gm_Cndiffside
;

216 
	gm_Cnov”Ïp
;

217 
	gm_Cg©•ass
;

218 
	gm_Cg©e
;

219 
	gm_CpdiffovÍ
;

220 
	gm_CndiffovÍ
;

221 
	gm_CpoxideovÍ
;

222 
	gm_CnoxideovÍ
;

224 
	gm_Vb™´e
;

225 
	gm_Vb™£n£
;

226 
	gm_EÃrgyFaùÜ
;

227 
	gm_S’£EÃrgyFaùÜ
;

228 
	gm_S’£EÃrgyFaùÜ3
;

229 
	gm_S’£EÃrgyFaùÜ2
;

231 
	gm_SCALE_T
;

232 
	gm_SCALE_M
;

233 
	gm_SCALE_S
;

234 
	gm_SCALE_W
;

235 
	gm_SCALE_H
;

236 
	gm_SCALE_BW
;

237 
	gm_SCALE_Crs
;

239 
	gm_LSCALE
;

240 
	gm_MSCALE
;

242 
	gm_B™Width
;

243 
	gm_B™Height
;

244 
	gm_B™lšeS·cšg
;

245 
	gm_WÜdlšeS·cšg
;

247 
	gm_RegC–lWidth
;

248 
	gm_RegC–lHeight
;

250 
	gm_Cout
;

252 
	gm_CwÜdm‘®
;

253 
	gm_Cb™m‘®
;

255 
	gm_Cm‘®
;

256 
	gm_CM2m‘®
;

257 
	gm_CM3m‘®
;

259 
	gm_CCm‘®
;

260 
	gm_CCM2m‘®
;

261 
	gm_CCM3m‘®
;

263 
	gm_CC2m‘®
;

264 
	gm_CC2M2m‘®
;

265 
	gm_CC2M3m‘®
;

267 
	gm_CC3m‘®
;

268 
	gm_CC3M2m‘®
;

269 
	gm_CC3M3m‘®
;

271 
	gm_Clockwœe
;

272 
	gm_Reswœe
;

273 
	gm_švC­
;

274 
	gm_Resout
;

276 
	gm_Leff
;

277 
	gm_Lamda
;

279 
	gm_CpŞywœe
;

281 
	gm_RnchªÃl¡©ic
;

282 
	gm_RpchªÃl¡©ic
;

284 
	gm_RnchªÃlÚ
;

285 
	gm_RpchªÃlÚ
;

287 
	gm_Rb™m‘®
;

288 
	gm_RwÜdm‘®
;

290 
	gm_Vt
;

292 
	gm_Wdecdriv•
;

293 
	gm_Wdecdriv’
;

294 
	gm_Wdec3to8n
;

295 
	gm_Wdec3to8p
;

296 
	gm_WdecNORn
;

297 
	gm_WdecNORp
;

298 
	gm_Wdecšvn
;

299 
	gm_Wdecšvp
;

300 
	gm_Wdff
;

302 
	gm_WwÜddrivemax
;

303 
	gm_WmemûÎa
;

304 
	gm_WmemûÎr
;

305 
	gm_WmemûÎw
;

306 
	gm_WmemûÎbsÿË
;

307 
	gm_Wb™´“qu
;

309 
	gm_Wb™muxn
;

310 
	gm_W£n£Q1to4
;

311 
	gm_Wcompšvp1
;

312 
	gm_Wcompšvn1
;

313 
	gm_Wcompšvp2
;

314 
	gm_Wcompšvn2
;

315 
	gm_Wcompšvp3
;

316 
	gm_Wcompšvn3
;

317 
	gm_Wev®švp
;

318 
	gm_Wev®švn
;

320 
	gm_Wcom²
;

321 
	gm_Wcomµ
;

322 
	gm_Wcomµ»equ
;

323 
	gm_Wmuxdrv12n
;

324 
	gm_Wmuxdrv12p
;

325 
	gm_WmuxdrvNANDn
;

326 
	gm_WmuxdrvNANDp
;

327 
	gm_WmuxdrvNORn
;

328 
	gm_WmuxdrvNORp
;

329 
	gm_Wmuxdrv3n
;

330 
	gm_Wmuxdrv3p
;

331 
	gm_Woutdrv£Ê
;

332 
	gm_Woutdrv£Í
;

333 
	gm_WoutdrvÇndn
;

334 
	gm_WoutdrvÇndp
;

335 
	gm_WoutdrvnÜn
;

336 
	gm_WoutdrvnÜp
;

337 
	gm_Woutdriv”n
;

338 
	gm_Woutdriv”p
;

339 
	gm_Wbusdrvn
;

340 
	gm_Wbusdrvp
;

342 
	gm_WcompûÎpd2
;

343 
	gm_Wcompdriv”n
;

344 
	gm_Wcompdriv”p
;

345 
	gm_Wcom·»n2
;

346 
	gm_Wcom·»n1
;

347 
	gm_Wm©chpchg
;

348 
	gm_Wm©chšvn
;

349 
	gm_Wm©chšvp
;

350 
	gm_Wm©chÇndn
;

351 
	gm_Wm©chÇndp
;

352 
	gm_Wm©chnÜn
;

353 
	gm_Wm©chnÜp
;

355 
	gm_WS–ORn
;

356 
	gm_WS–OR´equ
;

357 
	gm_WS–Pn
;

358 
	gm_WS–Pp
;

359 
	gm_WS–EÂ
;

360 
	gm_WS–EÅ
;

362 
	gm_W£n£extdrv1p
;

363 
	gm_W£n£extdrv1n
;

364 
	gm_W£n£extdrv2p
;

365 
	gm_W£n£extdrv2n
;

367 
	gm_CamC–lHeight
;

368 
	gm_CamC–lWidth
;

370 
	gm_M©chlšeS·cšg
;

371 
	gm_TaglšeS·cšg
;

373 
	gm_Crsb¬C–lHeight
;

374 
	gm_Crsb¬C–lWidth
;

376 
	gm_kri£
;

377 
	gm_t£n£d©a
;

378 
	gm_t£n£g
;

379 
	gm_tçÎd©a
;

380 
	gm_tçÎg
;

382 
	gm_WœeMšWidth
;

383 
	gm_WœeMšS·cšg
;

384 
	gm_WœeM‘®ThickÃss
;

385 
	gm_WœeB¬r›rThickÃss
;

386 
	gm_WœeD›ËùricThickÃss
;

387 
	gm_WœeD›ËùricCÚ¡ªt
;

389 
	gm_BufãrDriveResi¡ªû
;

390 
	gm_BufãrIÁršsicD–ay
;

391 
	gm_BufãrIÅutC­ac™ªû
;

392 
	gm_BufãrPMOSOffCu¼’t
;

393 
	gm_BufãrNMOSOffCu¼’t
;

394 
	gm_ClockC­
;

396 
	gm_A»aNOR
;

397 
	gm_A»aINV
;

398 
	gm_A»aAND
;

399 
	gm_A»aDFF
;

400 
	gm_A»aMUX2
;

401 
	gm_A»aMUX3
;

402 
	gm_A»aMUX4
;

404 
	gm_NMOS_TAB
[1];

405 
	gm_PMOS_TAB
[1];

406 
	gm_NAND2_TAB
[4];

407 
	gm_NOR2_TAB
[4];

408 
	gm_DFF_TAB
[1];

	@ruby/network/orion/Type.hh

36 #iâdeà
__TYPE_H__


37 
	#__TYPE_H__


	)

39 
	tušt32_t
;

41 
	~<¡ršg
>

42 
usšg
 
	g¡d
::
¡ršg
;

	@ruby/network/orion/Wire.cc

36 
	~<cm©h
>

37 
	~<c¡dlib
>

38 
	~<io¡»am
>

40 
	~"ba£/misc.hh
"

41 
	~"mem/ruby/ÃtwÜk/ÜiÚ/TechP¬am‘”.hh
"

42 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Wœe.hh
"

44 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gWœe
::
	$Wœe
(

47 cÚ¡ 
¡ršg
& 
wœe_¥acšg_mod–_¡r_
,

48 cÚ¡ 
¡ršg
& 
buf_scheme_¡r_
,

49 
boŞ
 
is_sh›ldšg_
,

50 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


53 
	`£t_width_¥acšg_mod–
(
wœe_¥acšg_mod–_¡r_
);

54 
	`£t_buf_scheme
(
buf_scheme_¡r_
);

56 
m_is_sh›ldšg
 = 
is_sh›ldšg_
;

58 
m_‹ch_·¿m_±r
 = 
‹ch_·¿m_±r_
;

60 ià(
m_‹ch_·¿m_±r
->
	`g‘_‹ch_node
() > 90)

62 
û¼
 << "ERROR: Wœmod– oÆy suµÜˆ‹ch‚od<ğ90" << 
’dl
;

63 
	`ex™
(1);

66 
	`š™
();

67 
	}
}

69 
	gWœe
::~
	$Wœe
()

70 {
	}
}

74 
Wœe
::
	$ÿlc_İt_bufãršg
(

75 * 
k_
,

76 * 
h_
,

77 
Ën_


80 
BufãrDriveResi¡ªû
 = 
m_‹ch_·¿m_±r
->
	`g‘_BufãrDriveResi¡ªû
();

81 
BufãrIÅutC­ac™ªû
 = 
m_‹ch_·¿m_±r
->
	`g‘_BufãrIÅutC­ac™ªû
();

82 
m_buf_scheme
)

84 
MIN_DELAY
:

86 ià(
m_is_sh›ldšg
)

88 
r
 = 
m_»s_un™_Ën
*
Ën_
;

89 
c_g
 = 2*
m_gnd_ÿp_un™_Ën
*
Ën_
;

90 
c_c
 = 2*
m_cou¶e_ÿp_un™_Ën
*
Ën_
;

91 *
k_
 = (è
	`sq¹
(((0.4*
r
*
c_g
)+(0.57*r*
c_c
))/

92 (0.7*
BufãrDriveResi¡ªû
*
BufãrIÅutC­ac™ªû
));

93 *
h_
 = 
	`sq¹
(((0.7*
BufãrDriveResi¡ªû
*
c_g
)+

94 (1.4*1.5*
BufãrDriveResi¡ªû
*
c_c
))/(0.7*
r
*
BufãrIÅutC­ac™ªû
));

99 
r
 = 
m_»s_un™_Ën
*
Ën_
;

100 
c_g
 = 2*
m_gnd_ÿp_un™_Ën
*
Ën_
;

101 
c_c
 = 2*
m_cou¶e_ÿp_un™_Ën
*
Ën_
;

102 *
k_
 = (è
	`sq¹
(((0.4*
r
*
c_g
)+(1.51*r*
c_c
))/

103 (0.7*
BufãrDriveResi¡ªû
*
BufãrIÅutC­ac™ªû
));

104 *
h_
 = 
	`sq¹
(((0.7*
BufãrDriveResi¡ªû
*
c_g
)+

105 (1.4*2.2*
BufãrDriveResi¡ªû
*
c_c
))/(0.7*
r
*
BufãrIÅutC­ac™ªû
));

109 
STAGGERED
:

111 
r
 = 
m_»s_un™_Ën
*
Ën_
;

112 
c_g
 = 2*
m_gnd_ÿp_un™_Ën
*
Ën_
;

113 
c_c
 = 2*
m_cou¶e_ÿp_un™_Ën
*
Ën_
;

115 *
k_
 = (è
	`sq¹
(((0.4*
r
*
c_g
)+(0.57*r*
c_c
))/

116 (0.7*
BufãrDriveResi¡ªû
*
BufãrIÅutC­ac™ªû
));

117 *
h_
 = 
	`sq¹
(((0.7*
BufãrDriveResi¡ªû
*
c_g
)+

118 (1.4*1.5*
BufãrDriveResi¡ªû
*
c_c
))/(0.7*
r
*
BufãrIÅutC­ac™ªû
));

125 *
k_
 = 0;

126 *
h_
 = 0;

131 
	}
}

133 
	gWœe
::
	$ÿlc_dyÇmic_’”gy
(
Ën_
) const

136 
c_g
 = 2*
m_gnd_ÿp_un™_Ën
*
Ën_
;

137 
c_c
 = 2*
m_cou¶e_ÿp_un™_Ën
*
Ën_
;

138 
ÿp_wœe
 = 
c_g
 + 
c_c
;

140 
k
;

141 
h
;

143 
	`ÿlc_İt_bufãršg
(&
k
, &
h
, 
Ën_
);

145 
BufãrIÅutC­ac™ªû
 = 
m_‹ch_·¿m_±r
->
	`g‘_BufãrIÅutC­ac™ªû
();

146 
ÿp_buf
 = (()
k
)*
BufãrIÅutC­ac™ªû
*
h
;

148 
e_çùÜ
 = 
m_‹ch_·¿m_±r
->
	`g‘_EÃrgyFaùÜ
();

149  ((
ÿp_wœe
+
ÿp_buf
)*
e_çùÜ
);

150 
	}
}

152 
	gWœe
::
	$ÿlc_¡©ic_pow”
(
Ën_
) const

154 
k
;

155 
h
;

156 
	`ÿlc_İt_bufãršg
(&
k
, &
h
, 
Ën_
);

158 
BufãrNMOSOffCu¼’t
 = 
m_‹ch_·¿m_±r
->
	`g‘_BufãrNMOSOffCu¼’t
();

159 
BufãrPMOSOffCu¼’t
 = 
m_‹ch_·¿m_±r
->
	`g‘_BufãrPMOSOffCu¼’t
();

160 
i_¡©ic_nmos
 = 
BufãrNMOSOffCu¼’t
*
h
*
k
;

161 
i_¡©ic_pmos
 = 
BufãrPMOSOffCu¼’t
*
h
*
k
;

163 
vdd
 = 
m_‹ch_·¿m_±r
->
	`g‘_vdd
();

164  (
vdd
*(
i_¡©ic_pmos
+
i_¡©ic_nmos
)/2);

165 
	}
}

167 
	gWœe
::
	$š™
()

169 
m_»s_un™_Ën
 = 
	`ÿlc_»s_un™_Ën
();

170 
m_gnd_ÿp_un™_Ën
 = 
	`ÿlc_gnd_ÿp_un™_Ën
();

171 
m_cou¶e_ÿp_un™_Ën
 = 
	`ÿlc_cou¶e_ÿp_un™_Ën
();

173 
	}
}

175 
	gWœe
::
	$£t_width_¥acšg_mod–
(

176 cÚ¡ 
¡ršg
& 
wœe_¥acšg_mod–_¡r_


179 ià(
wœe_¥acšg_mod–_¡r_
 =ğ
	`¡ršg
("SWIDTH_SSPACE"))

181 
m_width_¥acšg_mod–
 = 
SWIDTH_SSPACE
;

183 ià(
wœe_¥acšg_mod–_¡r_
 =ğ
	`¡ršg
("SWIDTH_DSPACE"))

185 
m_width_¥acšg_mod–
 = 
SWIDTH_DSPACE
;

187 ià(
wœe_¥acšg_mod–_¡r_
 =ğ
	`¡ršg
("DWIDTH_SSPACE"))

189 
m_width_¥acšg_mod–
 = 
DWIDTH_SSPACE
;

191 ià(
wœe_¥acšg_mod–_¡r_
 =ğ
	`¡ršg
("DWIDTH_DSPACE"))

193 
m_width_¥acšg_mod–
 = 
DWIDTH_DSPACE
;

197 
û¼
 << "ERROR: Inv®id wœwidth/¥acšg mod–" << 
’dl
;

198 
	`ex™
(1);

201 
	}
}

203 
	gWœe
::
	$£t_buf_scheme
(

204 cÚ¡ 
¡ršg
& 
buf_scheme_¡r_


207 ià(
buf_scheme_¡r_
 =ğ
	`¡ršg
("MIN_DELAY"))

209 
m_buf_scheme
 = 
MIN_DELAY
;

211 ià(
buf_scheme_¡r_
 =ğ
	`¡ršg
("STAGGERED"))

213 
m_buf_scheme
 = 
STAGGERED
;

217 
û¼
 << "ERROR: Inv®id wœbuàscheme" << 
’dl
;

218 
	`ex™
(1);

221 
	}
}

225 
	gWœe
::
	$ÿlc_»s_un™_Ën
()

227 
r
 = -1.0;

228 
rho
;

231 
WœeMšWidth
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeMšWidth
();

232 
WœeB¬r›rThickÃss
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeB¬r›rThickÃss
();

233 
WœeM‘®ThickÃss
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeM‘®ThickÃss
();

235 
m_width_¥acšg_mod–
)

237 
SWIDTH_SSPACE
:

238 
SWIDTH_DSPACE
:

239 
rho
 = 2.202e-8 + (1.030e-15 / (
WœeMšWidth
 - 2*
WœeB¬r›rThickÃss
));

240 
r
 = ((
rho
è/ ((
WœeMšWidth
 - 2*
WœeB¬r›rThickÃss
) *

241 (
WœeM‘®ThickÃss
 - 
WœeB¬r›rThickÃss
)));

243 
DWIDTH_SSPACE
:

244 
DWIDTH_DSPACE
:

245 
rho
 = 2.202e-8 + (1.030e-15 / (2*
WœeMšWidth
 - 2*
WœeB¬r›rThickÃss
));

246 
r
 = ((
rho
è/ ((2*
WœeMšWidth
 - 2*
WœeB¬r›rThickÃss
) *

247 (
WœeM‘®ThickÃss
 - 
WœeB¬r›rThickÃss
)));

250 
	`w¬n
("OriÚ: Width s·cšg mod–‚Ù found: %s\n", 
m_width_¥acšg_mod–
);

251 
r
 = 1.0;

253  
r
;

254 
	}
}

257 
	gWœe
::
	$ÿlc_gnd_ÿp_un™_Ën
()

260 
c_g
 = -1.0;

262 
WœeMšWidth
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeMšWidth
();

263 
WœeMšS·cšg
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeMšS·cšg
();

264 
WœeM‘®ThickÃss
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeM‘®ThickÃss
();

265 
WœeD›ËùricThickÃss
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeD›ËùricThickÃss
();

266 
WœeD›ËùricCÚ¡ªt
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeD›ËùricCÚ¡ªt
();

268 
m_width_¥acšg_mod–
)

270 
SWIDTH_SSPACE
:

272 
A
 = (
WœeMšWidth
/
WœeD›ËùricThickÃss
);

273 
B
 = 2.04*
	`pow
((
WœeMšS·cšg
/(WireMinSpacing +

274 0.54*
WœeD›ËùricThickÃss
)), 1.77);

275 
C
 = 
	`pow
((
WœeM‘®ThickÃss
/(WireMetalThickness +

276 4.53*
WœeD›ËùricThickÃss
)), 0.07);

277 
c_g
 = 
WœeD›ËùricCÚ¡ªt
*8.85e-12*(
A
+(
B
*
C
));

280 
SWIDTH_DSPACE
:

282 
mšS·cšgNew
 = 2*
WœeMšS·cšg
 + 
WœeMšWidth
;

283 
A
 = (
WœeMšWidth
/
WœeD›ËùricThickÃss
);

284 
B
 = 2.04*
	`pow
((
mšS·cšgNew
/(minSpacingNew +

285 0.54*
WœeD›ËùricThickÃss
)), 1.77);

286 
C
 = 
	`pow
((
WœeM‘®ThickÃss
/(WireMetalThickness +

287 4.53*
WœeD›ËùricThickÃss
)), 0.07);

288 
c_g
 = 
WœeD›ËùricCÚ¡ªt
*8.85e-12*(
A
+(
B
*
C
));

291 
DWIDTH_SSPACE
:

293 
mšWidthNew
 = 2*
WœeMšWidth
;

294 
A
 = (
mšWidthNew
/
WœeD›ËùricThickÃss
);

295 
B
 = 2.04*
	`pow
((
WœeMšS·cšg
/(WireMinSpacing +

296 0.54*
WœeD›ËùricThickÃss
)), 1.77);

297 
C
 = 
	`pow
((
WœeM‘®ThickÃss
/(WireMetalThickness +

298 4.53*
WœeD›ËùricThickÃss
)), 0.07);

299 
c_g
 = 
WœeD›ËùricCÚ¡ªt
*8.85e-12*(
A
+(
B
*
C
));

302 
DWIDTH_DSPACE
:

304 
mšWidthNew
 = 2*
WœeMšWidth
;

305 
mšS·cšgNew
 = 2*
WœeMšS·cšg
;

306 
A
 = (
mšWidthNew
/
WœeD›ËùricThickÃss
);

307 
B
 = 2.04*
	`pow
((
mšS·cšgNew
/(minSpacingNew+

308 0.54*
WœeD›ËùricThickÃss
)), 1.77);

309 
C
 = 
	`pow
((
WœeM‘®ThickÃss
/(WireMetalThickness +

310 4.53*
WœeD›ËùricThickÃss
)), 0.07);

311 
c_g
 = 
WœeD›ËùricCÚ¡ªt
*8.85e-12*(
A
+(
B
*
C
));

315 
	`w¬n
("OriÚ: Width s·cšg mod–‚Ù found: %s\n", 
m_width_¥acšg_mod–
);

316 
c_g
 = 1.0;

319  
c_g
;

320 
	}
}

323 
	gWœe
::
	$ÿlc_cou¶e_ÿp_un™_Ën
()

326 
c_c
 = -1.0;

328 
WœeMšWidth
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeMšWidth
();

329 
WœeMšS·cšg
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeMšS·cšg
();

330 
WœeM‘®ThickÃss
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeM‘®ThickÃss
();

331 
WœeD›ËùricThickÃss
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeD›ËùricThickÃss
();

332 
WœeD›ËùricCÚ¡ªt
 = 
m_‹ch_·¿m_±r
->
	`g‘_WœeD›ËùricCÚ¡ªt
();

334 
m_width_¥acšg_mod–
)

336 
SWIDTH_SSPACE
:

338 
A
 = 1.14*(
WœeM‘®ThickÃss
/
WœeMšS·cšg
) *

339 
	`exp
(-4*
WœeMšS·cšg
/(WœeMšS·cšg + 8.01*
WœeD›ËùricThickÃss
));

340 
B
 = 2.37*
	`pow
((
WœeMšWidth
/(WœeMšWidth + 0.31*
WœeMšS·cšg
)), 0.28);

341 
C
 = 
	`pow
((
WœeD›ËùricThickÃss
/(WireDielectricThickness +

342 8.96*
WœeMšS·cšg
)), 0.76) *

343 
	`exp
(-2*
WœeMšS·cšg
/(WœeMšS·cšg + 6*
WœeD›ËùricThickÃss
));

344 
c_c
 = 
WœeD›ËùricCÚ¡ªt
*8.85e-12*(
A
 + (
B
*
C
));

347 
SWIDTH_DSPACE
:

349 
mšS·cšgNew
 = 2*
WœeMšS·cšg
 + 
WœeMšWidth
;

350 
A
 = 1.14*(
WœeM‘®ThickÃss
/
mšS·cšgNew
) *

351 
	`exp
(-4*
mšS·cšgNew
/(mšS·cšgNew + 8.01*
WœeD›ËùricThickÃss
));

352 
B
 = 2.37*
	`pow
((
WœeMšWidth
/(WœeMšWidth + 0.31*
mšS·cšgNew
)), 0.28);

353 
C
 = 
	`pow
((
WœeD›ËùricThickÃss
/(WireDielectricThickness +

354 8.96*
mšS·cšgNew
)), 0.76) *

355 
	`exp
(-2*
mšS·cšgNew
/(mšS·cšgNew + 6*
WœeD›ËùricThickÃss
));

356 
c_c
 = 
WœeD›ËùricCÚ¡ªt
*8.85e-12*(
A
 + (
B
*
C
));

359 
DWIDTH_SSPACE
:

361 
mšWidthNew
 = 2*
WœeMšWidth
;

362 
A
 = 1.14*(
WœeM‘®ThickÃss
/
WœeMšS·cšg
) *

363 
	`exp
(-4*
WœeMšS·cšg
/(WœeMšS·cšg + 8.01*
WœeD›ËùricThickÃss
));

364 
B
 = 2.37*
	`pow
((2*
mšWidthNew
/(2*mšWidthNew + 0.31*
WœeMšS·cšg
)), 0.28);

365 
C
 = 
	`pow
((
WœeD›ËùricThickÃss
/(WireDielectricThickness +

366 8.96*
WœeMšS·cšg
)), 0.76) *

367 
	`exp
(-2*
WœeMšS·cšg
/(WœeMšS·cšg + 6*
WœeD›ËùricThickÃss
));

368 
c_c
 = 
WœeD›ËùricCÚ¡ªt
*8.85e-12*(
A
 + (
B
*
C
));

371 
DWIDTH_DSPACE
:

373 
mšWidthNew
 = 2*
WœeMšWidth
;

374 
mšS·cšgNew
 = 2*
WœeMšS·cšg
;

375 
A
 = 1.14*(
WœeM‘®ThickÃss
/
mšS·cšgNew
) *

376 
	`exp
(-4*
mšS·cšgNew
/(mšS·cšgNew + 8.01*
WœeD›ËùricThickÃss
));

377 
B
 = 2.37*
	`pow
((
mšWidthNew
/(mšWidthNew + 0.31*
mšS·cšgNew
)), 0.28);

378 
C
 = 
	`pow
((
WœeD›ËùricThickÃss
/(WireDielectricThickness +

379 8.96*
mšS·cšgNew
)), 0.76) *

380 
	`exp
(-2*
mšS·cšgNew
/(mšS·cšgNew + 6*
WœeD›ËùricThickÃss
));

381 
c_c
 = 
WœeD›ËùricCÚ¡ªt
*8.85e-12*(
A
 + (
B
*
C
));

385 
	`w¬n
("OriÚ: Width s·cšg mod–‚Ù found: %s\n", 
m_width_¥acšg_mod–
);

386 
c_c
 = 1.0;

389  
c_c
;

390 
	}
}

	@ruby/network/orion/Wire.hh

36 #iâdeà
__WIRE_H__


37 
	#__WIRE_H__


	)

39 
	~"mem/ruby/ÃtwÜk/ÜiÚ/Ty³.hh
"

41 
şass
 
	gTechP¬am‘”
;

43 şas 
	cWœe


45 
	mpublic
:

46 
	eWidthS·cšgMod–


48 
SWIDTH_SSPACE
,

49 
	mSWIDTH_DSPACE
,

50 
	mDWIDTH_SSPACE
,

51 
	mDWIDTH_DSPACE


53 
	eBufãrScheme


55 
	gMIN_DELAY
,

56 
	gSTAGGERED


59 
	gpublic
:

60 
Wœe
(

61 cÚ¡ 
¡ršg
& 
wœe_¥acšg_mod–_¡r_
,

62 cÚ¡ 
¡ršg
& 
buf_scheme_¡r_
,

63 
boŞ
 
is_sh›ldšg_
,

64 cÚ¡ 
TechP¬am‘”
* 
‹ch_·¿m_±r_


66 ~
Wœe
();

68 
	gpublic
:

69 
	$ÿlc_İt_bufãršg
(* 
k_
, * 
h_
, 
Ën_
) const;

70 
	$ÿlc_dyÇmic_’”gy
(
Ën_
) const;

71 
	$ÿlc_¡©ic_pow”
(
Ën_
) const;

73 
´iv©e
:

74 
	`š™
();

75 
	`£t_width_¥acšg_mod–
(cÚ¡ 
¡ršg
& 
wœe_¥acšg_mod–_¡r_
);

76 
	`£t_buf_scheme
(cÚ¡ 
¡ršg
& 
buf_scheme_¡r_
);

77 
	`ÿlc_»s_un™_Ën
();

78 
	`ÿlc_gnd_ÿp_un™_Ën
();

79 
	`ÿlc_cou¶e_ÿp_un™_Ën
();

81 
´iv©e
:

82 cÚ¡ 
TechP¬am‘”
* 
m_‹ch_·¿m_±r
;

83 
WidthS·cšgMod–
 
m_width_¥acšg_mod–
;

84 
BufãrScheme
 
m_buf_scheme
;

85 
boŞ
 
m_is_sh›ldšg
;

87 
m_»s_un™_Ën
;

88 
m_gnd_ÿp_un™_Ën
;

89 
m_cou¶e_ÿp_un™_Ën
;

90 
	}
};

	@ruby/network/orion/orion.hh

31 #iâdeà
__ORION_H__


32 
	#__ORION_H__


	)

34 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚCÚfig.hh
"

35 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚLšk.hh
"

36 
	~"mem/ruby/ÃtwÜk/ÜiÚ/OriÚRou‹r.hh
"

	@ruby/network/simple/PerfectSwitch.cc

29 
	~<®gÜ™hm
>

31 
	~"ba£/ÿ¡.hh
"

32 
	~"debug/RubyN‘wÜk.hh
"

33 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

34 
	~"mem/ruby/ÃtwÜk/sim¶e/P”ãùSw™ch.hh
"

35 
	~"mem/ruby/ÃtwÜk/sim¶e/Sim¶eN‘wÜk.hh
"

36 
	~"mem/ruby/ÃtwÜk/sim¶e/Sw™ch.hh
"

37 
	~"mem/ruby/¦icc_š‹rçû/N‘wÜkMes§ge.hh
"

39 
usšg
 
Çme¥aû
 
	g¡d
;

41 cÚ¡ 
	gPRIORITY_SWITCH_LIMIT
 = 128;

44 
boŞ


45 
	gİ”©Ü
<(cÚ¡ 
	gLškOrd”
& 
	gl1
, cÚ¡ LškOrd”& 
	gl2
)

47  (
	gl1
.
	gm_v®ue
 < 
	gl2
.m_value);

50 
	gP”ãùSw™ch
::
	$P”ãùSw™ch
(
Sw™chID
 
sid
, 
Sw™ch
 *
sw
, 
ušt32_t
 
vœt_Ãts
)

51 : 
	$CÚsum”
(
sw
)

53 
m_sw™ch_id
 = 
sid
;

54 
m_round_robš_¡¬t
 = 0;

55 
m_wakeups_wo_sw™ch
 = 0;

56 
m_vœtu®_ÃtwÜks
 = 
vœt_Ãts
;

57 
	}
}

60 
	gP”ãùSw™ch
::
	$š™
(
Sim¶eN‘wÜk
 *
ÃtwÜk_±r
)

62 
m_ÃtwÜk_±r
 = 
ÃtwÜk_±r
;

64 
i
 = 0;˜< 
m_vœtu®_ÃtwÜks
;++i)

66 
m_³ndšg_mes§ge_couÁ
.
	`push_back
(0);

68 
	}
}

71 
	gP”ãùSw™ch
::
addInPÜt
(cÚ¡ 
veùÜ
<
Mes§geBufãr
*>& 
š
)

73 
as£¹
(
š
.
size
(è=ğ
m_vœtu®_ÃtwÜks
);

74 
NodeID
 
	gpÜt
 = 
m_š
.
size
();

75 
	gm_š
.
push_back
(
š
);

77 
	gj
 = 0; j < 
	gm_vœtu®_ÃtwÜks
; j++) {

78 
	gm_š
[
pÜt
][
j
]->
£tCÚsum”
(
this
);

80 
¡ršg
 
	gdesc
 = 
c¥rštf
("[Queue from…ort %s %s %so PerfectSwitch]",

81 
to_¡ršg
(
m_sw™ch_id
),o_¡ršg(
pÜt
),o_¡ršg(
j
));

82 
	gm_š
[
pÜt
][
j
]->
£tDesütiÚ
(
desc
);

83 
	gm_š
[
pÜt
][
j
]->
£tIncomšgLšk
(port);

84 
	gm_š
[
pÜt
][
j
]->
£tVÃt
(j);

89 
	gP”ãùSw™ch
::
addOutPÜt
(cÚ¡ 
veùÜ
<
Mes§geBufãr
*>& 
out
,

90 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

92 
as£¹
(
out
.
size
(è=ğ
m_vœtu®_ÃtwÜks
);

95 
LškOrd”
 
	gl
;

96 
	gl
.
	gm_v®ue
 = 0;

97 
	gl
.
	gm_lšk
 = 
m_out
.
size
();

98 
	gm_lšk_Üd”
.
push_back
(
l
);

101 
	gm_out
.
push_back
(
out
);

102 
	gm_routšg_bË
.
push_back
(
routšg_bË_’Œy
);

105 
	gP”ãùSw™ch
::~
	$P”ãùSw™ch
()

107 
	}
}

110 
P”ãùSw™ch
::
	$wakeup
()

112 
MsgPŒ
 
msg_±r
;

115 
m_wakeups_wo_sw™ch
++;

116 
highe¡_´io_vÃt
 = 
m_vœtu®_ÃtwÜks
-1;

117 
lowe¡_´io_vÃt
 = 0;

118 
deüem’‹r
 = 1;

119 
N‘wÜkMes§ge
* 
Ãt_msg_±r
 = 
NULL
;

122 ià(
m_wakeups_wo_sw™ch
 > 
PRIORITY_SWITCH_LIMIT
) {

123 
m_wakeups_wo_sw™ch
 = 0;

124 
highe¡_´io_vÃt
 = 0;

125 
lowe¡_´io_vÃt
 = 
m_vœtu®_ÃtwÜks
-1;

126 
deüem’‹r
 = -1;

130 
vÃt
 = 
highe¡_´io_vÃt
;

131 (
vÃt
 * 
deüem’‹r
è>ğ(deüem’‹¸* 
lowe¡_´io_vÃt
);

132 
vÃt
 -ğ
deüem’‹r
) {

135 
šcomšg
 = 
m_round_robš_¡¬t
;

136 
m_round_robš_¡¬t
++;

137 ià(
m_round_robš_¡¬t
 >ğ
m_š
.
	`size
()) {

138 
m_round_robš_¡¬t
 = 0;

141 if(
m_³ndšg_mes§ge_couÁ
[
vÃt
] > 0) {

143 
couÁ”
 = 0; couÁ” < 
m_š
.
	`size
(); counter++) {

145 
šcomšg
++;

146 ià(
šcomšg
 >ğ
m_š
.
	`size
()) {

147 
šcomšg
 = 0;

151 
veùÜ
<
LškID
> 
ouut_lšks
;

152 
veùÜ
<
N‘De¡
> 
ouut_lšk_de¡š©iÚs
;

155 
m_š
[
šcomšg
][
vÃt
]->
	`isR—dy
()) {

156 
	`DPRINTF
(
RubyN‘wÜk
, "šcomšg: %d\n", 
šcomšg
);

159 
msg_±r
 = 
m_š
[
šcomšg
][
vÃt
]->
	`³ekMsgPŒ
();

160 
Ãt_msg_±r
 = 
§ã_ÿ¡
<
N‘wÜkMes§ge
*>(
msg_±r
.
	`g‘
());

161 
	`DPRINTF
(
RubyN‘wÜk
, "Mes§ge: %s\n", (*
Ãt_msg_±r
));

163 
ouut_lšks
.
	`ş—r
();

164 
ouut_lšk_de¡š©iÚs
.
	`ş—r
();

165 
N‘De¡
 
msg_d¡s
 =

166 
Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
();

172 
	`as£¹
(
m_lšk_Üd”
.
	`size
(è=ğ
m_routšg_bË
.size());

173 
	`as£¹
(
m_lšk_Üd”
.
	`size
(è=ğ
m_out
.size());

175 ià(
m_ÃtwÜk_±r
->
	`g‘Ad­tiveRoutšg
()) {

176 ià(
m_ÃtwÜk_±r
->
	`isVN‘Ord”ed
(
vÃt
)) {

178 
out
 = 0; ouˆ< 
m_out
.
	`size
(); out++) {

179 
m_lšk_Üd”
[
out
].
m_lšk
 = out;

180 
m_lšk_Üd”
[
out
].
m_v®ue
 = 0;

184 
out
 = 0; ouˆ< 
m_out
.
	`size
(); out++) {

185 
out_queue_Ëngth
 = 0;

186 
v
 = 0; v < 
m_vœtu®_ÃtwÜks
; v++) {

187 
out_queue_Ëngth
 +ğ
m_out
[
out
][
v
]->
	`g‘Size
();

189 
v®ue
 =

190 (
out_queue_Ëngth
 << 8è| (
	`¿ndom
() & 0xff);

191 
m_lšk_Üd”
[
out
].
m_lšk
 = out;

192 
m_lšk_Üd”
[
out
].
m_v®ue
 = 
v®ue
;

196 
	`sÜt
(
m_lšk_Üd”
.
	`begš
(), m_lšk_Üd”.
	`’d
());

200 
i
 = 0; i < 
m_routšg_bË
.
	`size
(); i++) {

202 
lšk
 = 
m_lšk_Üd”
[
i
].
m_lšk
;

203 
N‘De¡
 
d¡
 = 
m_routšg_bË
[
lšk
];

204 
	`DPRINTF
(
RubyN‘wÜk
, "d¡: %s\n", 
d¡
);

206 ià(!
msg_d¡s
.
	`š‹r£ùiÚIsNÙEm±y
(
d¡
))

210 
ouut_lšks
.
	`push_back
(
lšk
);

217 
ouut_lšk_de¡š©iÚs
.
	`push_back
(
msg_d¡s
.
	`AND
(
d¡
));

222 
msg_d¡s
.
	`»moveN‘De¡
(
d¡
);

225 
	`as£¹
(
msg_d¡s
.
	`couÁ
() == 0);

229 
boŞ
 
’ough
 = 
Œue
;

230 
i
 = 0; i < 
ouut_lšks
.
	`size
(); i++) {

231 
outgošg
 = 
ouut_lšks
[
i
];

232 ià(!
m_out
[
outgošg
][
vÃt
]->
	`¬eNSlÙsAvaabË
(1))

233 
’ough
 = 
çl£
;

234 
	`DPRINTF
(
RubyN‘wÜk
, "Checking if‚ode is blocked ..."

236 
outgošg
, 
vÃt
, 
’ough
);

240 ià(!
’ough
) {

241 
	`scheduËEv’t
(
	`Cyşes
(1));

242 
	`DPRINTF
(
RubyN‘wÜk
, "Can't deliver message since‡‚ode "

244 
	`DPRINTF
(
RubyN‘wÜk
, "Mes§ge: %s\n", (*
Ãt_msg_±r
));

248 
MsgPŒ
 
unmodif›d_msg_±r
;

250 ià(
ouut_lšks
.
	`size
() > 1) {

260 
unmodif›d_msg_±r
 = 
msg_±r
->
	`şÚe
();

264 
i
=0; i<
ouut_lšks
.
	`size
(); i++) {

265 
outgošg
 = 
ouut_lšks
[
i
];

267 ià(
i
 > 0) {

270 
msg_±r
 = 
unmodif›d_msg_±r
->
	`şÚe
();

276 
Ãt_msg_±r
 = 
§ã_ÿ¡
<
N‘wÜkMes§ge
*>(
msg_±r
.
	`g‘
());

277 
Ãt_msg_±r
->
	`g‘IÁ”ÇlDe¡š©iÚ
() =

278 
ouut_lšk_de¡š©iÚs
[
i
];

281 
	`DPRINTF
(
RubyN‘wÜk
, "Enqueuing‚et msg from "

283 
šcomšg
, 
vÃt
, 
outgošg
, vnet);

285 
m_out
[
outgošg
][
vÃt
]->
	`’queue
(
msg_±r
);

289 
m_š
[
šcomšg
][
vÃt
]->
	`pİ
();

290 
m_³ndšg_mes§ge_couÁ
[
vÃt
]--;

295 
	}
}

298 
	gP”ãùSw™ch
::
	$¡ÜeEv’tInfo
(
šfo
)

300 
m_³ndšg_mes§ge_couÁ
[
šfo
]++;

301 
	}
}

304 
	gP”ãùSw™ch
::
	$ş—rSts
()

306 
	}
}

308 
P”ãùSw™ch
::
	$cŞÏ‹Sts
()

310 
	}
}

314 
P”ãùSw™ch
::
´št
(
¡d
::
o¡»am
& 
out
) const

316 
out
 << "[P”ãùSw™ch " << 
m_sw™ch_id
 << "]";

	@ruby/network/simple/PerfectSwitch.hh

36 #iâdeà
__MEM_RUBY_NETWORK_SIMPLE_PERFECTSWITCH_HH__


37 
	#__MEM_RUBY_NETWORK_SIMPLE_PERFECTSWITCH_HH__


	)

39 
	~<io¡»am
>

40 
	~<¡ršg
>

41 
	~<veùÜ
>

43 
	~"mem/ruby/commÚ/CÚsum”.hh
"

45 
şass
 
	gMes§geBufãr
;

46 
şass
 
	gN‘De¡
;

47 
şass
 
	gSim¶eN‘wÜk
;

48 
şass
 
	gSw™ch
;

50 
	sLškOrd”


52 
	mm_lšk
;

53 
	mm_v®ue
;

56 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gLškOrd”
& 
	gl1
, cÚ¡ LškOrd”& 
	gl2
);

58 şas 
	cP”ãùSw™ch
 : 
public
 
CÚsum”


60 
public
:

61 
P”ãùSw™ch
(
Sw™chID
 
sid
, 
Sw™ch
 *, 
ušt32_t
);

62 ~
P”ãùSw™ch
();

64 
	m¡d
::
¡ršg
 
	$Çme
()

65 {  
	`c¥rštf
("P”ãùSw™ch-%i", 
m_sw™ch_id
); }

67 
	`š™
(
Sim¶eN‘wÜk
 *);

68 
	`addInPÜt
(cÚ¡ 
¡d
::
veùÜ
<
Mes§geBufãr
*>& 
š
);

69 
	`addOutPÜt
(cÚ¡ 
¡d
::
veùÜ
<
Mes§geBufãr
*>& 
out
,

70 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

71 
	$g‘InLšks
(ècÚ¡ {  
m_š
.
	`size
(); 
	}
}

72 
	$g‘OutLšks
(ècÚ¡ {  
m_out
.
	`size
(); 
	}
}

74 
wakeup
();

75 
¡ÜeEv’tInfo
(
šfo
);

77 
ş—rSts
();

78 
cŞÏ‹Sts
();

79 
´št
(
¡d
::
o¡»am
& 
out
) const;

81 
	g´iv©e
:

83 
P”ãùSw™ch
(cÚ¡ P”ãùSw™ch& 
obj
);

84 
	gP”ãùSw™ch
& 
	gİ”©Ü
=(cÚ¡ 
P”ãùSw™ch
& 
obj
);

86 
Sw™chID
 
	gm_sw™ch_id
;

89 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
Mes§geBufãr
*> > 
m_š
;

90 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
Mes§geBufãr
*> > 
m_out
;

91 
	g¡d
::
veùÜ
<
N‘De¡
> 
m_routšg_bË
;

92 
	g¡d
::
veùÜ
<
LškOrd”
> 
m_lšk_Üd”
;

94 
ušt32_t
 
	gm_vœtu®_ÃtwÜks
;

95 
	gm_round_robš_¡¬t
;

96 
	gm_wakeups_wo_sw™ch
;

98 
Sim¶eN‘wÜk
* 
	gm_ÃtwÜk_±r
;

99 
	g¡d
::
veùÜ
<> 
m_³ndšg_mes§ge_couÁ
;

102 
šlše
 
	g¡d
::
o¡»am
&

103 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gP”ãùSw™ch
& 
	gobj
)

105 
	gobj
.
´št
(
out
);

106 
	gout
 << 
	g¡d
::
æush
;

107  
	gout
;

	@ruby/network/simple/SimpleLink.cc

29 
	~"mem/ruby/ÃtwÜk/sim¶e/Sim¶eLšk.hh
"

31 
	gSim¶eExtLšk
::
	$Sim¶eExtLšk
(cÚ¡ 
P¬ams
 *
p
)

32 : 
	$BasicExtLšk
(
p
)

38 
m_bw_muÉl›r
 = 
p
->
bªdwidth_çùÜ
;

39 
	}
}

42 
	gSim¶eExtLšk
::
´št
(
¡d
::
o¡»am
& 
out
) const

44 
out
 << 
Çme
();

47 
Sim¶eExtLšk
 *

48 
	gSim¶eExtLškP¬ams
::
	$ü—‹
()

50  
Ãw
 
	`Sim¶eExtLšk
(
this
);

51 
	}
}

53 
	gSim¶eIÁLšk
::
	$Sim¶eIÁLšk
(cÚ¡ 
P¬ams
 *
p
)

54 : 
	$BasicIÁLšk
(
p
)

60 
m_bw_muÉl›r
 = 
p
->
bªdwidth_çùÜ
;

61 
	}
}

64 
	gSim¶eIÁLšk
::
´št
(
¡d
::
o¡»am
& 
out
) const

66 
out
 << 
Çme
();

69 
Sim¶eIÁLšk
 *

70 
	gSim¶eIÁLškP¬ams
::
	$ü—‹
()

72  
Ãw
 
	`Sim¶eIÁLšk
(
this
);

73 
	}
}

	@ruby/network/simple/SimpleLink.hh

29 #iâdeà
__MEM_RUBY_NETWORK_SIMPLE_LINK_HH__


30 
	#__MEM_RUBY_NETWORK_SIMPLE_LINK_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"·¿ms/Sim¶eExtLšk.hh
"

37 
	~"·¿ms/Sim¶eIÁLšk.hh
"

38 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

40 şas 
	cSim¶eExtLšk
 : 
public
 
BasicExtLšk


42 
public
:

43 
Sim¶eExtLškP¬ams
 
	tP¬ams
;

44 
Sim¶eExtLšk
(cÚ¡ 
P¬ams
 *
p
);

45 cÚ¡ 
P¬ams
 *
	$·¿ms
(ècÚ¡ {  (cÚ¡ 
P¬ams
 *)
_·¿ms
; }

47 
ä›nd
 
şass
 
TİŞogy
;

48 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

50 
m_bw_muÉl›r
;

51 
	}
};

53 
šlše
 
	g¡d
::
o¡»am
&

54 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gSim¶eExtLšk
& 
	gobj
)

56 
	gobj
.
´št
(
out
);

57 
	gout
 << 
	g¡d
::
æush
;

58  
	gout
;

61 şas 
	cSim¶eIÁLšk
 : 
public
 
BasicIÁLšk


63 
public
:

64 
Sim¶eIÁLškP¬ams
 
	tP¬ams
;

65 
Sim¶eIÁLšk
(cÚ¡ 
P¬ams
 *
p
);

66 cÚ¡ 
P¬ams
 *
	$·¿ms
(ècÚ¡ {  (cÚ¡ 
P¬ams
 *)
_·¿ms
; }

68 
ä›nd
 
şass
 
TİŞogy
;

69 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

71 
m_bw_muÉl›r
;

72 
	}
};

74 
šlše
 
	g¡d
::
o¡»am
&

75 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gSim¶eIÁLšk
& 
	gobj
)

77 
	gobj
.
´št
(
out
);

78 
	gout
 << 
	g¡d
::
æush
;

79  
	gout
;

	@ruby/network/simple/SimpleNetwork.cc

29 
	~<ÿs£¹
>

30 
	~<num”ic
>

32 
	~"ba£/ÿ¡.hh
"

33 
	~"ba£/¡l_h–³rs.hh
"

34 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

35 
	~"mem/ruby/commÚ/N‘De¡.hh
"

36 
	~"mem/ruby/ÃtwÜk/BasicLšk.hh
"

37 
	~"mem/ruby/ÃtwÜk/sim¶e/Sim¶eLšk.hh
"

38 
	~"mem/ruby/ÃtwÜk/sim¶e/Sim¶eN‘wÜk.hh
"

39 
	~"mem/ruby/ÃtwÜk/sim¶e/Sw™ch.hh
"

40 
	~"mem/ruby/ÃtwÜk/sim¶e/ThrÙe.hh
"

41 
	~"mem/ruby/ÃtwÜk/TİŞogy.hh
"

42 
	~"mem/ruby/´of”/Prof”.hh
"

43 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

45 
usšg
 
Çme¥aû
 
	g¡d
;

46 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

48 
	gSim¶eN‘wÜk
::
	$Sim¶eN‘wÜk
(cÚ¡ 
P¬ams
 *
p
)

49 : 
	$N‘wÜk
(
p
)

51 
m_bufãr_size
 = 
p
->
bufãr_size
;

52 
m_’dpošt_bªdwidth
 = 
p
->
’dpošt_bªdwidth
;

53 
m_ad­tive_routšg
 = 
p
->
ad­tive_routšg
;

59 
m_’dpošt_sw™ches
.
	`»size
(
m_nodes
);

61 
m_š_u£
.
	`»size
(
m_vœtu®_ÃtwÜks
);

62 
m_Üd”ed
.
	`»size
(
m_vœtu®_ÃtwÜks
);

63 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
; i++) {

64 
m_š_u£
[
i
] = 
çl£
;

65 
m_Üd”ed
[
i
] = 
çl£
;

69 
m_toN‘Queues
.
	`»size
(
m_nodes
);

70 
m_äomN‘Queues
.
	`»size
(
m_nodes
);

71 
node
 = 0;‚od< 
m_nodes
;‚ode++) {

72 
m_toN‘Queues
[
node
].
	`»size
(
m_vœtu®_ÃtwÜks
);

73 
m_äomN‘Queues
[
node
].
	`»size
(
m_vœtu®_ÃtwÜks
);

74 
j
 = 0; j < 
m_vœtu®_ÃtwÜks
; j++) {

75 
m_toN‘Queues
[
node
][
j
] =

76 
Ãw
 
	`Mes§geBufãr
(
	`c¥rštf
("toN‘‚od%d j %d", 
node
, 
j
));

77 
m_äomN‘Queues
[
node
][
j
] =

78 
Ãw
 
	`Mes§geBufãr
(
	`c¥rštf
("äomN‘‚od%d j %d", 
node
, 
j
));

83 
veùÜ
<
BasicRou‹r
*>::
cÚ¡_™”©Ü
 
i
 = 
p
->
rou‹rs
.
	`begš
();

84 
i
 !ğ
p
->
rou‹rs
.
	`’d
(); ++i) {

85 
Sw™ch
* 
s
 = 
§ã_ÿ¡
<Sw™ch*>(*
i
);

86 
m_sw™ches
.
	`push_back
(
s
);

87 
s
->
	`š™_Ãt_±r
(
this
);

89 
	}
}

92 
	gSim¶eN‘wÜk
::
	$š™
()

94 
N‘wÜk
::
	`š™
();

98 
	`as£¹
(
m_tİŞogy_±r
 !ğ
NULL
);

99 
m_tİŞogy_±r
->
	`ü—‹Lšks
(
this
);

100 
	}
}

102 
	gSim¶eN‘wÜk
::~
	$Sim¶eN‘wÜk
()

104 
i
 = 0; i < 
m_nodes
; i++) {

105 
	`d–‘ePoš‹rs
(
m_toN‘Queues
[
i
]);

106 
	`d–‘ePoš‹rs
(
m_äomN‘Queues
[
i
]);

108 
	`d–‘ePoš‹rs
(
m_sw™ches
);

109 
	`d–‘ePoš‹rs
(
m_bufãrs_to_ä“
);

111 
	}
}

115 
	gSim¶eN‘wÜk
::
	$makeOutLšk
(
Sw™chID
 
¤c
, 
NodeID
 
de¡
, 
BasicLšk
* 
lšk
,

116 
LškDœeùiÚ
 
dœeùiÚ
,

117 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

119 
	`as£¹
(
de¡
 < 
m_nodes
);

120 
	`as£¹
(
¤c
 < 
m_sw™ches
.
	`size
());

121 
	`as£¹
(
m_sw™ches
[
¤c
] !ğ
NULL
);

123 
Sim¶eExtLšk
 *
sim¶e_lšk
 = 
§ã_ÿ¡
<Sim¶eExtLšk*>(
lšk
);

125 
m_sw™ches
[
¤c
]->
	`addOutPÜt
(
m_äomN‘Queues
[
de¡
],

126 
routšg_bË_’Œy
,

127 
sim¶e_lšk
->
m_Ï‹ncy
,

128 
sim¶e_lšk
->
m_bw_muÉl›r
);

130 
m_’dpošt_sw™ches
[
de¡
] = 
m_sw™ches
[
¤c
];

131 
	}
}

135 
	gSim¶eN‘wÜk
::
	$makeInLšk
(
NodeID
 
¤c
, 
Sw™chID
 
de¡
, 
BasicLšk
* 
lšk
,

136 
LškDœeùiÚ
 
dœeùiÚ
,

137 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

139 
	`as£¹
(
¤c
 < 
m_nodes
);

140 
m_sw™ches
[
de¡
]->
	`addInPÜt
(
m_toN‘Queues
[
¤c
]);

141 
	}
}

145 
	gSim¶eN‘wÜk
::
	$makeIÁ”ÇlLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

146 
LškDœeùiÚ
 
dœeùiÚ
,

147 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
)

150 
¡d
::
veùÜ
<
Mes§geBufãr
*> 
queues
;

151 
i
 = 0; i < 
m_vœtu®_ÃtwÜks
; i++) {

153 
Mes§geBufãr
* 
bufãr_±r
 = 
Ãw
 MessageBuffer;

154 
bufãr_±r
->
	`£tOrd”šg
(
Œue
);

155 ià(
m_bufãr_size
 > 0) {

156 
bufãr_±r
->
	`»size
(
m_bufãr_size
);

158 
queues
.
	`push_back
(
bufãr_±r
);

160 
m_bufãrs_to_ä“
.
	`push_back
(
bufãr_±r
);

163 
Sim¶eIÁLšk
 *
sim¶e_lšk
 = 
§ã_ÿ¡
<Sim¶eIÁLšk*>(
lšk
);

165 
m_sw™ches
[
de¡
]->
	`addInPÜt
(
queues
);

166 
m_sw™ches
[
¤c
]->
	`addOutPÜt
(
queues
, 
routšg_bË_’Œy
,

167 
sim¶e_lšk
->
m_Ï‹ncy
,

168 
sim¶e_lšk
->
m_bw_muÉl›r
);

169 
	}
}

172 
	gSim¶eN‘wÜk
::
	$checkN‘wÜkAÎoÿtiÚ
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
)

174 
	`as£¹
(
id
 < 
m_nodes
);

175 
	`as£¹
(
ÃtwÜk_num
 < 
m_vœtu®_ÃtwÜks
);

177 ià(
Üd”ed
) {

178 
m_Üd”ed
[
ÃtwÜk_num
] = 
Œue
;

180 
m_š_u£
[
ÃtwÜk_num
] = 
Œue
;

181 
	}
}

183 
Mes§geBufãr
*

184 
	gSim¶eN‘wÜk
::
g‘ToN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
,

185 
¡d
::
¡ršg
 
vÃt_ty³
)

187 
checkN‘wÜkAÎoÿtiÚ
(
id
, 
Üd”ed
, 
ÃtwÜk_num
);

188  
	gm_toN‘Queues
[
id
][
ÃtwÜk_num
];

191 
Mes§geBufãr
*

192 
	gSim¶eN‘wÜk
::
g‘FromN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
,

193 
¡d
::
¡ršg
 
vÃt_ty³
)

195 
checkN‘wÜkAÎoÿtiÚ
(
id
, 
Üd”ed
, 
ÃtwÜk_num
);

196  
	gm_äomN‘Queues
[
id
][
ÃtwÜk_num
];

199 cÚ¡ 
	g¡d
::
veùÜ
<
ThrÙe
*>*

200 
Sim¶eN‘wÜk
::
	$g‘ThrÙes
(
NodeID
 
id
) const

202 
	`as£¹
(
id
 >= 0);

203 
	`as£¹
(
id
 < 
m_nodes
);

204 
	`as£¹
(
m_’dpošt_sw™ches
[
id
] !ğ
NULL
);

205  
m_’dpošt_sw™ches
[
id
]->
	`g‘ThrÙes
();

206 
	}
}

209 
	gSim¶eN‘wÜk
::
	$»gSts
()

211 
Mes§geSizeTy³
 
ty³
 = 
Mes§geSizeTy³_FIRST
;

212 
ty³
 < 
Mes§geSizeTy³_NUM
; ++type) {

213 
m_msg_couÁs
[(è
ty³
]

214 .
	`Çme
Òame(è+ ".msg_couÁ." + 
	`Mes§geSizeTy³_to_¡ršg
(
ty³
))

215 .
	`æags
(
Sts
::
noz”o
)

217 
m_msg_by‹s
[(è
ty³
]

218 .
	`Çme
Òame(è+ ".msg_by‹." + 
	`Mes§geSizeTy³_to_¡ršg
(
ty³
))

219 .
	`æags
(
Sts
::
noz”o
)

223 
i
 = 0; i < 
m_sw™ches
.
	`size
(); i++) {

224 
m_msg_couÁs
[(è
ty³
] +=

225 
	`sum
(
m_sw™ches
[
i
]->
	`g‘MsgCouÁ
(
ty³
));

228 
m_msg_by‹s
[(è
ty³
] =

229 
m_msg_couÁs
[(è
ty³
] * 
Sts
::
	`cÚ¡ªt
(

230 
N‘wÜk
::
	`Mes§geSizeTy³_to_št
(
ty³
));

232 
	}
}

235 
	gSim¶eN‘wÜk
::
	$cŞÏ‹Sts
()

237 
i
 = 0; i < 
m_sw™ches
.
	`size
(); i++) {

238 
m_sw™ches
[
i
]->
	`cŞÏ‹Sts
();

240 
	}
}

243 
	gSim¶eN‘wÜk
::
	$´št
(
o¡»am
& 
out
) const

245 
out
 << "[SimpleNetwork]";

246 
	}
}

248 
Sim¶eN‘wÜk
 *

249 
	gSim¶eN‘wÜkP¬ams
::
	$ü—‹
()

251  
Ãw
 
	`Sim¶eN‘wÜk
(
this
);

252 
	}
}

259 
boŞ


260 
	gSim¶eN‘wÜk
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

262 
i
 = 0; i < 
m_sw™ches
.
	`size
(); i++) {

263 ià(
m_sw™ches
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

264  
Œue
;

268 
i
 = 0; i < 
m_bufãrs_to_ä“
.
	`size
(); ++i) {

269 ià(
m_bufãrs_to_ä“
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

270  
Œue
;

274  
çl£
;

275 
	}
}

277 
ušt32_t


278 
	gSim¶eN‘wÜk
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

280 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

282 
i
 = 0; i < 
m_sw™ches
.
	`size
(); i++) {

283 
num_funùiÚ®_wr™es
 +ğ
m_sw™ches
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

286 
i
 = 0; i < 
m_bufãrs_to_ä“
.
	`size
(); ++i) {

287 
num_funùiÚ®_wr™es
 +ğ
m_bufãrs_to_ä“
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

289  
num_funùiÚ®_wr™es
;

290 
	}
}

	@ruby/network/simple/SimpleNetwork.hh

29 #iâdeà
__MEM_RUBY_NETWORK_SIMPLE_SIMPLENETWORK_HH__


30 
	#__MEM_RUBY_NETWORK_SIMPLE_SIMPLENETWORK_HH__


	)

32 
	~<io¡»am
>

33 
	~<veùÜ
>

35 
	~"mem/ruby/commÚ/Glob®.hh
"

36 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

37 
	~"·¿ms/Sim¶eN‘wÜk.hh
"

38 
	~"sim/sim_objeù.hh
"

40 
şass
 
	gN‘De¡
;

41 
şass
 
	gMes§geBufãr
;

42 
şass
 
	gThrÙe
;

43 
şass
 
	gSw™ch
;

44 
şass
 
	gTİŞogy
;

46 şas 
	cSim¶eN‘wÜk
 : 
public
 
N‘wÜk


48 
public
:

49 
Sim¶eN‘wÜkP¬ams
 
	tP¬ams
;

50 
Sim¶eN‘wÜk
(cÚ¡ 
P¬ams
 *
p
);

51 ~
Sim¶eN‘wÜk
();

53 
š™
();

55 
	$g‘BufãrSize
(è{  
m_bufãr_size
; }

56 
	$g‘EndpoštBªdwidth
(è{  
m_’dpošt_bªdwidth
; 
	}
}

57 
boŞ
 
	$g‘Ad­tiveRoutšg
(è{ 
m_ad­tive_routšg
; 
	}
}

59 
cŞÏ‹Sts
();

60 
»gSts
();

63 
Mes§geBufãr
* 
g‘ToN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
, 
¡d
::
¡ršg
 
vÃt_ty³
);

64 
Mes§geBufãr
* 
g‘FromN‘Queue
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
, 
¡d
::
¡ršg
 
vÃt_ty³
);

65 
vœtu®
 cÚ¡ 
	g¡d
::
veùÜ
<
ThrÙe
*>* 
	$g‘ThrÙes
(
NodeID
 
id
) const;

67 
boŞ
 
	$isVN‘Ord”ed
(
vÃt
è{  
m_Üd”ed
[vÃt]; 
	}
}

68 
boŞ
 
	$v®idVœtu®N‘wÜk
(
vÃt
è{  
m_š_u£
[vÃt]; 
	}
}

70 
	$g‘NumNodes
(è{ 
m_nodes
; 
	}
}

73 
makeOutLšk
(
Sw™chID
 
¤c
, 
NodeID
 
de¡
, 
BasicLšk
* 
lšk
,

74 
LškDœeùiÚ
 
dœeùiÚ
,

75 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

76 
makeInLšk
(
NodeID
 
¤c
, 
Sw™chID
 
de¡
, 
BasicLšk
* 
lšk
,

77 
LškDœeùiÚ
 
dœeùiÚ
,

78 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

79 
makeIÁ”ÇlLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
BasicLšk
* 
lšk
,

80 
LškDœeùiÚ
 
dœeùiÚ
,

81 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
);

83 
´št
(
¡d
::
o¡»am
& 
out
) const;

85 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *
pkt
);

86 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

88 
	g´iv©e
:

89 
checkN‘wÜkAÎoÿtiÚ
(
NodeID
 
id
, 
boŞ
 
Üd”ed
, 
ÃtwÜk_num
);

90 
addLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
, 
lšk_Ï‹ncy
);

91 
makeLšk
(
Sw™chID
 
¤c
, Sw™chID 
de¡
,

92 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
, 
lšk_Ï‹ncy
);

93 
makeTİŞogy
();

96 
Sim¶eN‘wÜk
(cÚ¡ Sim¶eN‘wÜk& 
obj
);

97 
	gSim¶eN‘wÜk
& 
	gİ”©Ü
=(cÚ¡ 
Sim¶eN‘wÜk
& 
obj
);

100 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
Mes§geBufãr
*> > 
m_toN‘Queues
;

101 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
Mes§geBufãr
*> > 
m_äomN‘Queues
;

103 
	g¡d
::
veùÜ
<
boŞ
> 
m_š_u£
;

104 
	g¡d
::
veùÜ
<
boŞ
> 
m_Üd”ed
;

105 
	g¡d
::
veùÜ
<
Sw™ch
*> 
m_sw™ches
;

106 
	g¡d
::
veùÜ
<
Mes§geBufãr
*> 
m_bufãrs_to_ä“
;

107 
	g¡d
::
veùÜ
<
Sw™ch
*> 
m_’dpošt_sw™ches
;

109 
	gm_bufãr_size
;

110 
	gm_’dpošt_bªdwidth
;

111 
boŞ
 
	gm_ad­tive_routšg
;

114 
	gSts
::
FÜmuÏ
 
m_msg_couÁs
[
Mes§geSizeTy³_NUM
];

115 
	gSts
::
FÜmuÏ
 
m_msg_by‹s
[
Mes§geSizeTy³_NUM
];

118 
šlše
 
	g¡d
::
o¡»am
&

119 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gSim¶eN‘wÜk
& 
	gobj
)

121 
	gobj
.
´št
(
out
);

122 
	gout
 << 
	g¡d
::
æush
;

123  
	gout
;

	@ruby/network/simple/Switch.cc

29 
	~<num”ic
>

31 
	~"ba£/ÿ¡.hh
"

32 
	~"ba£/¡l_h–³rs.hh
"

33 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

34 
	~"mem/ruby/ÃtwÜk/sim¶e/P”ãùSw™ch.hh
"

35 
	~"mem/ruby/ÃtwÜk/sim¶e/Sim¶eN‘wÜk.hh
"

36 
	~"mem/ruby/ÃtwÜk/sim¶e/Sw™ch.hh
"

37 
	~"mem/ruby/ÃtwÜk/sim¶e/ThrÙe.hh
"

39 
usšg
 
Çme¥aû
 
	g¡d
;

40 
usšg
 
	gm5
::
¡l_h–³rs
::
d–‘ePoš‹rs
;

41 
usšg
 
	gm5
::
¡l_h–³rs
::
İ”©Ü
<<;

43 
	gSw™ch
::
	$Sw™ch
(cÚ¡ 
P¬ams
 *
p
è: 
	$BasicRou‹r
(
p
)

45 
m_³rãù_sw™ch
 = 
Ãw
 
	`P”ãùSw™ch
(
m_id
, 
this
, 
p
->
vœt_Ãts
);

46 
	}
}

48 
	gSw™ch
::~
	$Sw™ch
()

50 
d–‘e
 
m_³rãù_sw™ch
;

53 
	`d–‘ePoš‹rs
(
m_thrÙes
);

56 
	`d–‘ePoš‹rs
(
m_bufãrs_to_ä“
);

57 
	}
}

60 
	gSw™ch
::
	$š™
()

62 
BasicRou‹r
::
	`š™
();

63 
m_³rãù_sw™ch
->
	`š™
(
m_ÃtwÜk_±r
);

64 
	}
}

67 
	gSw™ch
::
addInPÜt
(cÚ¡ 
veùÜ
<
Mes§geBufãr
*>& 
š
)

69 
m_³rãù_sw™ch
->
addInPÜt
(
š
);

71 
	gi
 = 0; i < 
	gš
.
size
(); i++) {

72 
	gš
[
i
]->
£tReûiv”
(
this
);

77 
	gSw™ch
::
addOutPÜt
(cÚ¡ 
veùÜ
<
Mes§geBufãr
*>& 
out
,

78 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
, 
Cyşes
 
lšk_Ï‹ncy
, 
bw_muÉl›r
)

81 
ThrÙe
* 
	gthrÙe_±r
 = 
Ãw
 ThrÙe(
m_id
, 
m_thrÙes
.
size
(),

82 
lšk_Ï‹ncy
, 
bw_muÉl›r
, 
m_ÃtwÜk_±r
->
g‘EndpoštBªdwidth
(),

83 
this
);

84 
	gm_thrÙes
.
push_back
(
thrÙe_±r
);

87 
	gveùÜ
<
	gMes§geBufãr
*> 
	gš‹rmedŸ‹Bufãrs
;

88 
	gi
 = 0; i < 
	gout
.
size
(); i++) {

89 
	gout
[
i
]->
£tS’d”
(
this
);

91 
Mes§geBufãr
* 
	gbufãr_±r
 = 
Ãw
 MessageBuffer;

93 
	gbufãr_±r
->
£tOrd”šg
(
Œue
);

94 ià(
	gm_ÃtwÜk_±r
->
g‘BufãrSize
() > 0) {

95 
	gbufãr_±r
->
»size
(
m_ÃtwÜk_±r
->
g‘BufãrSize
());

98 
	gš‹rmedŸ‹Bufãrs
.
push_back
(
bufãr_±r
);

99 
	gm_bufãrs_to_ä“
.
push_back
(
bufãr_±r
);

101 
	gbufãr_±r
->
£tS’d”
(
this
);

102 
	gbufãr_±r
->
£tReûiv”
(
this
);

106 
	gm_³rãù_sw™ch
->
addOutPÜt
(
š‹rmedŸ‹Bufãrs
, 
routšg_bË_’Œy
);

109 
	gthrÙe_±r
->
addLšks
(
š‹rmedŸ‹Bufãrs
, 
out
);

112 cÚ¡ 
ThrÙe
*

113 
	gSw™ch
::
	$g‘ThrÙe
(
LškID
 
lšk_numb”
) const

115 
	`as£¹
(
m_thrÙes
[
lšk_numb”
] !ğ
NULL
);

116  
m_thrÙes
[
lšk_numb”
];

117 
	}
}

119 cÚ¡ 
	gveùÜ
<
	gThrÙe
*>*

120 
	gSw™ch
::
	$g‘ThrÙes
() const

122  &
m_thrÙes
;

123 
	}
}

126 
	gSw™ch
::
	$»gSts
()

128 
lšk
 = 0;†šk < 
m_thrÙes
.
	`size
();†ink++) {

129 
m_thrÙes
[
lšk
]->
	`»gSts
(
	`Çme
());

132 
m_avg_utiz©iÚ
.
	`Çme
(name() + ".percent_links_utilized");

133 
i
 = 0; i < 
m_thrÙes
.
	`size
(); i++) {

134 
m_avg_utiz©iÚ
 +ğ
m_thrÙes
[
i
]->
	`g‘Utiz©iÚ
();

136 
m_avg_utiz©iÚ
 /ğ
Sts
::
	`cÚ¡ªt
(
m_thrÙes
.
	`size
());

138 
ty³
 = 
Mes§geSizeTy³_FIRST
;

139 
ty³
 < 
Mes§geSizeTy³_NUM
; ++type) {

140 
m_msg_couÁs
[
ty³
]

141 .
	`Çme
(name() + ".msg_count." +

142 
	`Mes§geSizeTy³_to_¡ršg
(
	`Mes§geSizeTy³
(
ty³
)))

143 .
	`æags
(
Sts
::
noz”o
)

145 
m_msg_by‹s
[
ty³
]

146 .
	`Çme
(name() + ".msg_bytes." +

147 
	`Mes§geSizeTy³_to_¡ršg
(
	`Mes§geSizeTy³
(
ty³
)))

148 .
	`æags
(
Sts
::
noz”o
)

151 
i
 = 0; i < 
m_thrÙes
.
	`size
(); i++) {

152 
m_msg_couÁs
[
ty³
] +ğ
m_thrÙes
[
i
]->
	`g‘MsgCouÁ
(type);

154 
m_msg_by‹s
[
ty³
] = 
m_msg_couÁs
[ty³] * 
Sts
::
	`cÚ¡ªt
(

155 
N‘wÜk
::
	`Mes§geSizeTy³_to_št
(
	`Mes§geSizeTy³
(
ty³
)));

157 
	}
}

160 
	gSw™ch
::
	$»£tSts
()

162 
m_³rãù_sw™ch
->
	`ş—rSts
();

163 
i
 = 0; i < 
m_thrÙes
.
	`size
(); i++) {

164 
m_thrÙes
[
i
]->
	`ş—rSts
();

166 
	}
}

169 
	gSw™ch
::
	$cŞÏ‹Sts
()

171 
m_³rãù_sw™ch
->
	`cŞÏ‹Sts
();

172 
i
 = 0; i < 
m_thrÙes
.
	`size
(); i++) {

173 
m_thrÙes
[
i
]->
	`cŞÏ‹Sts
();

175 
	}
}

178 
	gSw™ch
::
´št
(
¡d
::
o¡»am
& 
out
) const

181 
out
 << "[Switch]";

184 
boŞ


185 
	gSw™ch
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

188 
i
 = 0; i < 
m_bufãrs_to_ä“
.
	`size
(); ++i) {

189 ià(
m_bufãrs_to_ä“
[
i
]->
	`funùiÚ®R—d
(
pkt
)) {

190  
Œue
;

193  
çl£
;

194 
	}
}

196 
ušt32_t


197 
	gSw™ch
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

200 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

201 
i
 = 0; i < 
m_bufãrs_to_ä“
.
	`size
(); ++i) {

202 
num_funùiÚ®_wr™es
 +ğ
m_bufãrs_to_ä“
[
i
]->
	`funùiÚ®Wr™e
(
pkt
);

204  
num_funùiÚ®_wr™es
;

205 
	}
}

207 
Sw™ch
 *

208 
	gSw™chP¬ams
::
	$ü—‹
()

210  
Ãw
 
	`Sw™ch
(
this
);

211 
	}
}

	@ruby/network/simple/Switch.hh

39 #iâdeà
__MEM_RUBY_NETWORK_SIMPLE_SWITCH_HH__


40 
	#__MEM_RUBY_NETWORK_SIMPLE_SWITCH_HH__


	)

42 
	~<io¡»am
>

43 
	~<veùÜ
>

45 
	~"mem/·ck‘.hh
"

46 
	~"mem/´ÙocŞ/Mes§geSizeTy³.hh
"

47 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

48 
	~"mem/ruby/ÃtwÜk/BasicRou‹r.hh
"

49 
	~"·¿ms/Sw™ch.hh
"

51 
şass
 
	gMes§geBufãr
;

52 
şass
 
	gP”ãùSw™ch
;

53 
şass
 
	gN‘De¡
;

54 
şass
 
	gSim¶eN‘wÜk
;

55 
şass
 
	gThrÙe
;

57 şas 
	cSw™ch
 : 
public
 
BasicRou‹r


59 
public
:

60 
Sw™chP¬ams
 
	tP¬ams
;

61 
Sw™ch
(cÚ¡ 
P¬ams
 *
p
);

62 ~
Sw™ch
();

64 
š™
();

65 
addInPÜt
(cÚ¡ 
¡d
::
veùÜ
<
Mes§geBufãr
*>& 
š
);

66 
addOutPÜt
(cÚ¡ 
¡d
::
veùÜ
<
Mes§geBufãr
*>& 
out
,

67 cÚ¡ 
N‘De¡
& 
routšg_bË_’Œy
, 
Cyşes
 
lšk_Ï‹ncy
,

68 
bw_muÉl›r
);

69 cÚ¡ 
ThrÙe
* 
	$g‘ThrÙe
(
LškID
 
lšk_numb”
) const;

70 cÚ¡ 
¡d
::
veùÜ
<
ThrÙe
*>* 
	$g‘ThrÙes
() const;

72 
	`»£tSts
();

73 
	`cŞÏ‹Sts
();

74 
	`»gSts
();

75 cÚ¡ 
Sts
::
FÜmuÏ
 & 
	$g‘MsgCouÁ
(
ty³
) const

76 {  
m_msg_couÁs
[
ty³
]; }

78 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

79 
	$š™_Ãt_±r
(
Sim¶eN‘wÜk
* 
Ãt_±r
è{ 
m_ÃtwÜk_±r
 =‚‘_±r; 
	}
}

81 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *);

82 
ušt32_t
 
funùiÚ®Wr™e
(
Pack‘
 *);

84 
	g´iv©e
:

86 
Sw™ch
(cÚ¡ Sw™ch& 
obj
);

87 
	gSw™ch
& 
	gİ”©Ü
=(cÚ¡ 
Sw™ch
& 
obj
);

89 
P”ãùSw™ch
* 
	gm_³rãù_sw™ch
;

90 
Sim¶eN‘wÜk
* 
	gm_ÃtwÜk_±r
;

91 
	g¡d
::
veùÜ
<
ThrÙe
*> 
m_thrÙes
;

92 
	g¡d
::
veùÜ
<
Mes§geBufãr
*> 
m_bufãrs_to_ä“
;

95 
	gSts
::
FÜmuÏ
 
m_avg_utiz©iÚ
;

96 
	gSts
::
FÜmuÏ
 
m_msg_couÁs
[
Mes§geSizeTy³_NUM
];

97 
	gSts
::
FÜmuÏ
 
m_msg_by‹s
[
Mes§geSizeTy³_NUM
];

100 
šlše
 
	g¡d
::
o¡»am
&

101 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gSw™ch
& 
	gobj
)

103 
	gobj
.
´št
(
out
);

104 
	gout
 << 
	g¡d
::
æush
;

105  
	gout
;

	@ruby/network/simple/Throttle.cc

29 
	~<ÿs£¹
>

31 
	~"ba£/ÿ¡.hh
"

32 
	~"ba£/ırštf.hh
"

33 
	~"debug/RubyN‘wÜk.hh
"

34 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

35 
	~"mem/ruby/ÃtwÜk/sim¶e/ThrÙe.hh
"

36 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

37 
	~"mem/ruby/¦icc_š‹rçû/N‘wÜkMes§ge.hh
"

38 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

40 
usšg
 
Çme¥aû
 
	g¡d
;

42 cÚ¡ 
	gHIGH_RANGE
 = 256;

43 cÚ¡ 
	gADJUST_INTERVAL
 = 50000;

44 cÚ¡ 
	gMESSAGE_SIZE_MULTIPLIER
 = 1000;

46 cÚ¡ 
	gBROADCAST_SCALING
 = 1;

47 cÚ¡ 
	gPRIORITY_SWITCH_LIMIT
 = 128;

49 
ÃtwÜk_mes§ge_to_size
(
N‘wÜkMes§ge
* 
Ãt_msg_±r
);

51 
	gThrÙe
::
	$ThrÙe
(
sID
, 
NodeID
 
node
, 
Cyşes
 
lšk_Ï‹ncy
,

52 
lšk_bªdwidth_muÉl›r
, 
’dpošt_bªdwidth
,

53 
ClockedObjeù
 *
em
)

54 : 
	$CÚsum”
(
em
)

56 
	`š™
(
node
, 
lšk_Ï‹ncy
, 
lšk_bªdwidth_muÉl›r
, 
’dpošt_bªdwidth
);

57 
m_sID
 = 
sID
;

58 
	}
}

60 
	gThrÙe
::
	$ThrÙe
(
NodeID
 
node
, 
Cyşes
 
lšk_Ï‹ncy
,

61 
lšk_bªdwidth_muÉl›r
, 
’dpošt_bªdwidth
,

62 
ClockedObjeù
 *
em
)

63 : 
	$CÚsum”
(
em
)

65 
	`š™
(
node
, 
lšk_Ï‹ncy
, 
lšk_bªdwidth_muÉl›r
, 
’dpošt_bªdwidth
);

66 
m_sID
 = 0;

67 
	}
}

70 
	gThrÙe
::
	$š™
(
NodeID
 
node
, 
Cyşes
 
lšk_Ï‹ncy
,

71 
lšk_bªdwidth_muÉl›r
, 
’dpošt_bªdwidth
)

73 
m_node
 = 
node
;

74 
m_vÃts
 = 0;

76 
	`as£¹
(
lšk_bªdwidth_muÉl›r
 > 0);

77 
m_lšk_bªdwidth_muÉl›r
 = 
lšk_bªdwidth_muÉl›r
;

78 
m_lšk_Ï‹ncy
 = 
lšk_Ï‹ncy
;

79 
m_’dpošt_bªdwidth
 = 
’dpošt_bªdwidth
;

81 
m_wakeups_wo_sw™ch
 = 0;

83 
m_lšk_utiz©iÚ_´oxy
 = 0;

84 
	}
}

87 
	gThrÙe
::
addLšks
(cÚ¡ 
¡d
::
veùÜ
<
Mes§geBufãr
*>& 
š_vec
,

88 cÚ¡ 
¡d
::
veùÜ
<
Mes§geBufãr
*>& 
out_vec
)

90 
as£¹
(
š_vec
.
size
(è=ğ
out_vec
.size());

91 
	gi
=0; i<
	gš_vec
.
size
(); i++) {

92 
addVœtu®N‘wÜk
(
š_vec
[
i
], 
out_vec
[i]);

97 
	gThrÙe
::
	$addVœtu®N‘wÜk
(
Mes§geBufãr
* 
š_±r
, Mes§geBufãr* 
out_±r
)

99 
m_un™s_»maššg
.
	`push_back
(0);

100 
m_š
.
	`push_back
(
š_±r
);

101 
m_out
.
	`push_back
(
out_±r
);

104 
m_š
[
m_vÃts
]->
	`£tCÚsum”
(
this
);

106 
¡ršg
 
desc
 = "[QueutØThrÙ" + 
	`to_¡ršg
(
m_sID
) + " " +

107 
	`to_¡ršg
(
m_node
) + "]";

108 
m_š
[
m_vÃts
]->
	`£tDesütiÚ
(
desc
);

109 
m_vÃts
++;

110 
	}
}

113 
	gThrÙe
::
	$wakeup
()

116 
	`as£¹
(
	`g‘LškBªdwidth
() > 0);

117 
bw_»maššg
 = 
	`g‘LškBªdwidth
();

120 
m_wakeups_wo_sw™ch
++;

121 
highe¡_´io_vÃt
 = 
m_vÃts
-1;

122 
lowe¡_´io_vÃt
 = 0;

123 
couÁ”
 = 1;

124 
boŞ
 
scheduË_wakeup
 = 
çl£
;

127 ià(
m_wakeups_wo_sw™ch
 > 
PRIORITY_SWITCH_LIMIT
) {

128 
m_wakeups_wo_sw™ch
 = 0;

129 
highe¡_´io_vÃt
 = 0;

130 
lowe¡_´io_vÃt
 = 
m_vÃts
-1;

131 
couÁ”
 = -1;

134 
vÃt
 = 
highe¡_´io_vÃt
;

135 (
vÃt
 * 
couÁ”
è>ğ(couÁ” * 
lowe¡_´io_vÃt
);

136 
vÃt
 -ğ
couÁ”
) {

138 
	`as£¹
(
m_out
[
vÃt
] !ğ
NULL
);

139 
	`as£¹
(
m_š
[
vÃt
] !ğ
NULL
);

140 
	`as£¹
(
m_un™s_»maššg
[
vÃt
] >= 0);

142 
bw_»maššg
 > 0 &&

143 (
m_š
[
vÃt
]->
	`isR—dy
(è|| 
m_un™s_»maššg
[vnet] > 0) &&

144 
m_out
[
vÃt
]->
	`¬eNSlÙsAvaabË
(1)) {

148 ià(
m_un™s_»maššg
[
vÃt
] =ğ0 && 
m_š
[vÃt]->
	`isR—dy
()) {

150 
MsgPŒ
 
msg_±r
 = 
m_š
[
vÃt
]->
	`³ekMsgPŒ
();

151 
N‘wÜkMes§ge
* 
Ãt_msg_±r
 =

152 
§ã_ÿ¡
<
N‘wÜkMes§ge
*>(
msg_±r
.
	`g‘
());

153 
m_un™s_»maššg
[
vÃt
] +=

154 
	`ÃtwÜk_mes§ge_to_size
(
Ãt_msg_±r
);

156 
	`DPRINTF
(
RubyN‘wÜk
, "throttle: %d my bw %d bw spent "

158 
m_node
, 
	`g‘LškBªdwidth
(), 
m_un™s_»maššg
[
vÃt
],

159 
g_sy¡em_±r
->
	`curCyşe
());

162 
m_out
[
vÃt
]->
	`’queue
(
m_š
[vÃt]->
	`³ekMsgPŒ
(), 
m_lšk_Ï‹ncy
);

163 
m_š
[
vÃt
]->
	`pİ
();

166 
m_msg_couÁs
[
Ãt_msg_±r
->
	`g‘Mes§geSize
()][
vÃt
]++;

168 
	`DPRINTF
(
RubyN‘wÜk
, "%s\n", *
m_out
[
vÃt
]);

172 
diff
 = 
m_un™s_»maššg
[
vÃt
] - 
bw_»maššg
;

173 
m_un™s_»maššg
[
vÃt
] = 
	`max
(0, 
diff
);

174 
bw_»maššg
 = 
	`max
(0, -
diff
);

177 ià(
bw_»maššg
 > 0 &&

178 (
m_š
[
vÃt
]->
	`isR—dy
(è|| 
m_un™s_»maššg
[vnet] > 0) &&

179 !
m_out
[
vÃt
]->
	`¬eNSlÙsAvaabË
(1)) {

180 
	`DPRINTF
(
RubyN‘wÜk
, "vÃt: %d", 
vÃt
);

183 
scheduË_wakeup
 = 
Œue
;

192 
¿tio
 = 1.0 - ((
bw_»maššg
è/ (
	`g‘LškBªdwidth
()));

195 
m_lšk_utiz©iÚ_´oxy
 +ğ
¿tio
;

197 ià(
bw_»maššg
 > 0 && !
scheduË_wakeup
) {

201 
	`DPRINTF
(
RubyN‘wÜk
, "% nÙ scheduËd‡gaš\n", *
this
);

203 
	`DPRINTF
(
RubyN‘wÜk
, "% scheduËd‡gaš\n", *
this
);

207 
	`scheduËEv’t
(
	`Cyşes
(1));

209 
	}
}

212 
	gThrÙe
::
	$»gSts
(
¡ršg
 
·»Á
)

214 
m_lšk_utiz©iÚ


215 .
	`Çme
(
·»Á
 + 
	`c¥rštf
(".thrÙe%i", 
m_node
) + ".link_utilization");

217 
Mes§geSizeTy³
 
ty³
 = 
Mes§geSizeTy³_FIRST
;

218 
ty³
 < 
Mes§geSizeTy³_NUM
; ++type) {

219 
m_msg_couÁs
[()
ty³
]

220 .
	`š™
(
m_vÃts
)

221 .
	`Çme
(
·»Á
 + 
	`c¥rštf
(".thrÙe%i", 
m_node
) + ".msg_count." +

222 
	`Mes§geSizeTy³_to_¡ršg
(
ty³
))

223 .
	`æags
(
Sts
::
noz”o
)

225 
m_msg_by‹s
[(è
ty³
]

226 .
	`Çme
(
·»Á
 + 
	`c¥rštf
(".thrÙe%i", 
m_node
) + ".msg_bytes." +

227 
	`Mes§geSizeTy³_to_¡ršg
(
ty³
))

228 .
	`æags
(
Sts
::
noz”o
)

231 
m_msg_by‹s
[(è
ty³
] = 
m_msg_couÁs
[ty³] * 
Sts
::
	`cÚ¡ªt
(

232 
N‘wÜk
::
	`Mes§geSizeTy³_to_št
(
ty³
));

234 
	}
}

237 
	gThrÙe
::
	$ş—rSts
()

239 
m_lšk_utiz©iÚ_´oxy
 = 0;

240 
	}
}

243 
	gThrÙe
::
	$cŞÏ‹Sts
()

245 
m_lšk_utiz©iÚ
 = 100.0 * 
m_lšk_utiz©iÚ_´oxy


246 / ((
g_sy¡em_±r
->
	`curCyşe
(è- 
g_ruby_¡¬t
));

247 
	}
}

250 
	gThrÙe
::
	$´št
(
o¡»am
& 
out
) const

252 
	`cırštf
(
out
, "[%˜bw: %i]", 
m_node
, 
	`g‘LškBªdwidth
());

253 
	}
}

256 
	$ÃtwÜk_mes§ge_to_size
(
N‘wÜkMes§ge
* 
Ãt_msg_±r
)

258 
	`as£¹
(
Ãt_msg_±r
 !ğ
NULL
);

260 
size
 = 
N‘wÜk
::
	`Mes§geSizeTy³_to_št
(
Ãt_msg_±r
->
	`g‘Mes§geSize
());

261 
size
 *ğ
MESSAGE_SIZE_MULTIPLIER
;

264 ià(
BROADCAST_SCALING
 > 1 && 
Ãt_msg_±r
->
	`g‘De¡š©iÚ
().
	`isBrßdÿ¡
())

265 
size
 *ğ
BROADCAST_SCALING
;

267  
size
;

268 
	}
}

	@ruby/network/simple/Throttle.hh

38 #iâdeà
__MEM_RUBY_NETWORK_SIMPLE_THROTTLE_HH__


39 
	#__MEM_RUBY_NETWORK_SIMPLE_THROTTLE_HH__


	)

41 
	~<io¡»am
>

42 
	~<¡ršg
>

43 
	~<veùÜ
>

45 
	~"mem/ruby/commÚ/CÚsum”.hh
"

46 
	~"mem/ruby/commÚ/Glob®.hh
"

47 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

48 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

50 
şass
 
	gMes§geBufãr
;

52 şas 
	cThrÙe
 : 
public
 
CÚsum”


54 
public
:

55 
ThrÙe
(
sID
, 
NodeID
 
node
, 
Cyşes
 
lšk_Ï‹ncy
,

56 
lšk_bªdwidth_muÉl›r
, 
’dpošt_bªdwidth
,

57 
ClockedObjeù
 *
em
);

58 
ThrÙe
(
NodeID
 
node
, 
Cyşes
 
lšk_Ï‹ncy
, 
lšk_bªdwidth_muÉl›r
,

59 
’dpošt_bªdwidth
, 
ClockedObjeù
 *
em
);

60 ~
	$ThrÙe
() {}

62 
¡d
::
¡ršg
 
	$Çme
()

63 {  
	`c¥rštf
("ThrÙe-%i", 
m_sID
); 
	}
}

65 
addLšks
(cÚ¡ 
¡d
::
veùÜ
<
Mes§geBufãr
*>& 
š_vec
,

66 cÚ¡ 
¡d
::
veùÜ
<
Mes§geBufãr
*>& 
out_vec
);

67 
wakeup
();

70 cÚ¡ 
	gSts
::
SÿÏr
 & 
	$g‘Utiz©iÚ
() const

71 {  
m_lšk_utiz©iÚ
; 
	}
}

72 cÚ¡ 
	gSts
::
VeùÜ
 & 
	$g‘MsgCouÁ
(
ty³
) const

73 {  
m_msg_couÁs
[
ty³
]; 
	}
}

75 
	$g‘LškBªdwidth
() const

76 {  
m_’dpošt_bªdwidth
 * 
m_lšk_bªdwidth_muÉl›r
; 
	}
}

78 
Cyşes
 
	$g‘L©’cy
(ècÚ¡ {  
m_lšk_Ï‹ncy
; 
	}
}

80 
ş—rSts
();

81 
cŞÏ‹Sts
();

82 
»gSts
(
¡d
::
¡ršg
 
Çme
);

83 
´št
(
¡d
::
o¡»am
& 
out
) const;

85 
	g´iv©e
:

86 
š™
(
NodeID
 
node
, 
Cyşes
 
lšk_Ï‹ncy
, 
lšk_bªdwidth_muÉl›r
,

87 
’dpošt_bªdwidth
);

88 
addVœtu®N‘wÜk
(
Mes§geBufãr
* 
š_±r
, Mes§geBufãr* 
out_±r
);

91 
ThrÙe
(cÚ¡ ThrÙe& 
obj
);

92 
	gThrÙe
& 
	gİ”©Ü
=(cÚ¡ 
ThrÙe
& 
obj
);

94 
	g¡d
::
veùÜ
<
Mes§geBufãr
*> 
m_š
;

95 
	g¡d
::
veùÜ
<
Mes§geBufãr
*> 
m_out
;

96 
	gm_vÃts
;

97 
	g¡d
::
veùÜ
<> 
m_un™s_»maššg
;

98 
	gm_sID
;

99 
NodeID
 
	gm_node
;

100 
	gm_lšk_bªdwidth_muÉl›r
;

101 
Cyşes
 
	gm_lšk_Ï‹ncy
;

102 
	gm_wakeups_wo_sw™ch
;

103 
	gm_’dpošt_bªdwidth
;

106 
	gSts
::
SÿÏr
 
m_lšk_utiz©iÚ
;

107 
	gSts
::
VeùÜ
 
m_msg_couÁs
[
Mes§geSizeTy³_NUM
];

108 
	gSts
::
FÜmuÏ
 
m_msg_by‹s
[
Mes§geSizeTy³_NUM
];

110 
	gm_lšk_utiz©iÚ_´oxy
;

113 
šlše
 
	g¡d
::
o¡»am
&

114 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gThrÙe
& 
	gobj
)

116 
	gobj
.
´št
(
out
);

117 
	gout
 << 
	g¡d
::
æush
;

118  
	gout
;

	@ruby/profiler/AccessTraceForAddress.cc

29 
	~"mem/ruby/commÚ/Hi¡og¿m.hh
"

30 
	~"mem/ruby/´of”/AcûssT¿ûFÜAdd»ss.hh
"

32 
	gAcûssT¿ûFÜAdd»ss
::~
	$AcûssT¿ûFÜAdd»ss
()

34 ià(
m_hi¡og¿m_±r
) {

35 
d–‘e
 
m_hi¡og¿m_±r
;

36 
m_hi¡og¿m_±r
 = 
NULL
;

38 
	}
}

41 
	gAcûssT¿ûFÜAdd»ss
::
´št
(
¡d
::
o¡»am
& 
out
) const

43 
out
 << 
m_addr
;

45 ià(
	gm_hi¡og¿m_±r
 =ğ
NULL
) {

46 
out
 << " " << 
m_tÙ®
;

47 
	gout
 << " | " << 
	gm_lßds
;

48 
	gout
 << " " << 
	gm_¡Ües
;

49 
	gout
 << " " << 
	gm_©omics
;

50 
	gout
 << " | " << 
	gm_u£r
;

51 
	gout
 << " " << 
	gm_tÙ®
-
	gm_u£r
;

52 
	gout
 << " | " << 
	gm_sh¬šg
;

53 
	gout
 << " | " << 
	gm_touched_by
.
couÁ
();

55 
as£¹
(
m_tÙ®
 == 0);

56 
	gout
 << " " << (*
	gm_hi¡og¿m_±r
);

61 
	gAcûssT¿ûFÜAdd»ss
::
	$upd©e
(
RubyReque¡Ty³
 
ty³
,

62 
RubyAcûssMode
 
acûss_mode
, 
NodeID
 
ıu
,

63 
boŞ
 
sh¬šg_miss
)

65 
m_touched_by
.
	`add
(
ıu
);

66 
m_tÙ®
++;

67 if(
ty³
 =ğ
RubyReque¡Ty³_ATOMIC
) {

68 
m_©omics
++;

69 } if(
ty³
 =ğ
RubyReque¡Ty³_LD
){

70 
m_lßds
++;

71 } ià(
ty³
 =ğ
RubyReque¡Ty³_ST
){

72 
m_¡Ües
++;

77 ià(
acûss_mode
 =ğ
RubyAcûssMode_U£r
) {

78 
m_u£r
++;

81 ià(
sh¬šg_miss
) {

82 
m_sh¬šg
++;

84 
	}
}

87 
	gAcûssT¿ûFÜAdd»ss
::
	$g‘TÙ®
() const

89 ià(
m_hi¡og¿m_±r
 =ğ
NULL
) {

90  
m_tÙ®
;

92  
m_hi¡og¿m_±r
->
	`g‘TÙ®
();

94 
	}
}

97 
	gAcûssT¿ûFÜAdd»ss
::
	$addSam¶e
(
v®ue
)

99 
	`as£¹
(
m_tÙ®
 == 0);

100 ià(
m_hi¡og¿m_±r
 =ğ
NULL
) {

101 
m_hi¡og¿m_±r
 = 
Ãw
 
Hi¡og¿m
;

103 
m_hi¡og¿m_±r
->
	`add
(
v®ue
);

104 
	}
}

	@ruby/profiler/AccessTraceForAddress.hh

29 #iâdeà
__MEM_RUBY_PROFILER_ACCESSTRACEFORADDRESS_HH__


30 
	#__MEM_RUBY_PROFILER_ACCESSTRACEFORADDRESS_HH__


	)

32 
	~<io¡»am
>

34 
	~"mem/´ÙocŞ/RubyAcûssMode.hh
"

35 
	~"mem/´ÙocŞ/RubyReque¡Ty³.hh
"

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/commÚ/S‘.hh
"

40 
şass
 
	gHi¡og¿m
;

42 şas 
	cAcûssT¿ûFÜAdd»ss


44 
	mpublic
:

45 
	$AcûssT¿ûFÜAdd»ss
()

46 : 
	`m_lßds
(0), 
	`m_¡Ües
(0), 
	`m_©omics
(0), 
	`m_tÙ®
(0), 
	`m_u£r
(0),

47 
	`m_sh¬šg
(0), 
	$m_hi¡og¿m_±r
(
NULL
)

49 ~
	`AcûssT¿ûFÜAdd»ss
();

51 
	$£tAdd»ss
(cÚ¡ 
Add»ss
& 
addr
è{ 
m_addr
 =‡ddr; 
	}
}

52 
upd©e
(
RubyReque¡Ty³
 
ty³
, 
RubyAcûssMode
 
acûss_mode
, 
NodeID
 
ıu
,

53 
boŞ
 
sh¬šg_miss
);

54 
	$g‘TÙ®
() const;

55 
	$g‘Sh¬šg
(ècÚ¡ {  
m_sh¬šg
; 
	}
}

56 
	$g‘TouchedBy
(ècÚ¡ {  
m_touched_by
.
	`couÁ
(); 
	}
}

57 cÚ¡ 
	gAdd»ss
& 
	$g‘Add»ss
(ècÚ¡ {  
m_addr
; 
	}
}

58 
addSam¶e
(
v®ue
);

60 
´št
(
¡d
::
o¡»am
& 
out
) const;

62 
šlše
 
boŞ


63 
	$Ëss_equ®
(cÚ¡ 
AcûssT¿ûFÜAdd»ss
* 
n1
,

64 cÚ¡ 
AcûssT¿ûFÜAdd»ss
* 
n2
)

66  
n1
->
	`g‘TÙ®
(è<ğ
n2
->getTotal();

67 
	}
}

69 
	g´iv©e
:

70 
Add»ss
 
m_addr
;

71 
ušt64
 
	gm_lßds
;

72 
ušt64
 
	gm_¡Ües
;

73 
ušt64
 
	gm_©omics
;

74 
ušt64
 
	gm_tÙ®
;

75 
ušt64
 
	gm_u£r
;

76 
ušt64
 
	gm_sh¬šg
;

77 
S‘
 
	gm_touched_by
;

78 
Hi¡og¿m
* 
	gm_hi¡og¿m_±r
;

81 
šlše
 
	g¡d
::
o¡»am
&

82 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gAcûssT¿ûFÜAdd»ss
& 
	gobj
)

84 
	gobj
.
´št
(
out
);

85 
	gout
 << 
	g¡d
::
æush
;

86  
	gout
;

	@ruby/profiler/AddressProfiler.cc

29 
	~<veùÜ
>

31 
	~"ba£/¡l_h–³rs.hh
"

32 
	~"mem/´ÙocŞ/RubyReque¡.hh
"

33 
	~"mem/ruby/´of”/Add»ssProf”.hh
"

34 
	~"mem/ruby/´of”/Prof”.hh
"

35 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

37 
usšg
 
Çme¥aû
 
	g¡d
;

38 
	gAdd»ssProf”
::
	tAdd»ssM­
 AddressMap;

40 
usšg
 
	gm5
::
¡l_h–³rs
::
İ”©Ü
<<;

43 
	gAcûssT¿ûFÜAdd»ss
&

44 
	$lookupT¿ûFÜAdd»ss
(cÚ¡ 
Add»ss
& 
addr
, 
Add»ssM­
& 
»cÜd_m­
)

50 cÚ¡ 
AcûssT¿ûFÜAdd»ss
 
dæt
;

52 
·œ
<
Add»ssM­
::
™”©Ü
, 
boŞ
> 
r
 =

53 
»cÜd_m­
.
	`š£¹
(
	`make_·œ
(
addr
, 
dæt
));

54 
Add»ssM­
::
™”©Ü
 
i
 = 
r
.
fœ¡
;

55 
AcûssT¿ûFÜAdd»ss
 &
acûss_Œaû
 = 
i
->
£cÚd
;

56 ià(
r
.
£cÚd
) {

59 
acûss_Œaû
.
	`£tAdd»ss
(
addr
);

62  
acûss_Œaû
;

63 
	}
}

66 
	$´štSÜ‹d
(
o¡»am
& 
out
, 
num_of_£qu’ûrs
, cÚ¡ 
Add»ssM­
 &
»cÜd_m­
,

67 
¡ršg
 
desütiÚ
)

69 cÚ¡ 
»cÜds_´š‹d
 = 100;

71 
ušt64
 
mis£s
 = 0;

72 
¡d
::
veùÜ
<cÚ¡ 
AcûssT¿ûFÜAdd»ss
 *> 
sÜ‹d
;

74 
Add»ssM­
::
cÚ¡_™”©Ü
 
i
 = 
»cÜd_m­
.
	`begš
();

75 
Add»ssM­
::
cÚ¡_™”©Ü
 
’d
 = 
»cÜd_m­
.
	`’d
();

76 ; 
i
 !ğ
’d
; ++i) {

77 cÚ¡ 
AcûssT¿ûFÜAdd»ss
* 
»cÜd
 = &
i
->
£cÚd
;

78 
mis£s
 +ğ
»cÜd
->
	`g‘TÙ®
();

79 
sÜ‹d
.
	`push_back
(
»cÜd
);

81 
	`sÜt
(
sÜ‹d
.
	`begš
(), sÜ‹d.
	`’d
(), 
AcûssT¿ûFÜAdd»ss
::
Ëss_equ®
);

83 
out
 << "TÙ®_’Œ›s_" << 
desütiÚ
 << ": " << 
»cÜd_m­
.
	`size
()

84 << 
’dl
;

85 ià(
g_sy¡em_±r
->
	`g‘Prof”
()->
	`g‘AÎIn¡ruùiÚs
())

86 
out
 << "TÙ®_In¡ruùiÚs_" << 
desütiÚ
 << ": " << 
mis£s
 << 
’dl
;

88 
out
 << "TÙ®_d©a_mis£s_" << 
desütiÚ
 << ": " << 
mis£s
 << 
’dl
;

90 
out
 << "total |†oad store‡tomic | user supervisor | sharing |ouched-by"

91 << 
’dl
;

93 
Hi¡og¿m
 
	`»maššg_»cÜds
(1, 100);

94 
Hi¡og¿m
 
	`®l_»cÜds
(1, 100);

95 
Hi¡og¿m
 
	`»maššg_»cÜds_log
(-1);

96 
Hi¡og¿m
 
	`®l_»cÜds_log
(-1);

99 
¡d
::
veùÜ
<
št64
> 
m_touched_vec
;

100 
¡d
::
veùÜ
<
št64
> 
m_touched_weigh‹d_vec
;

101 
m_touched_vec
.
	`»size
(
num_of_£qu’ûrs
+1);

102 
m_touched_weigh‹d_vec
.
	`»size
(
num_of_£qu’ûrs
+1);

103 
j
 = 0; j < 
m_touched_vec
.
	`size
(); j++) {

104 
m_touched_vec
[
j
] = 0;

105 
m_touched_weigh‹d_vec
[
j
] = 0;

108 
couÁ”
 = 0;

109 
max
 = 
sÜ‹d
.
	`size
();

110 
couÁ”
 < 
max
 && couÁ” < 
»cÜds_´š‹d
) {

111 cÚ¡ 
AcûssT¿ûFÜAdd»ss
* 
»cÜd
 = 
sÜ‹d
[
couÁ”
];

112 
³rûÁ
 = 100.0 * (
»cÜd
->
	`g‘TÙ®
(è/ (
mis£s
));

113 
out
 << 
desütiÚ
 << " | " << 
³rûÁ
 << " % " << *
»cÜd
 << 
’dl
;

114 
®l_»cÜds
.
	`add
(
»cÜd
->
	`g‘TÙ®
());

115 
®l_»cÜds_log
.
	`add
(
»cÜd
->
	`g‘TÙ®
());

116 
couÁ”
++;

117 
m_touched_vec
[
»cÜd
->
	`g‘TouchedBy
()]++;

118 
m_touched_weigh‹d_vec
[
»cÜd
->
	`g‘TouchedBy
()] +ğ»cÜd->
	`g‘TÙ®
();

121 
couÁ”
 < 
max
) {

122 cÚ¡ 
AcûssT¿ûFÜAdd»ss
* 
»cÜd
 = 
sÜ‹d
[
couÁ”
];

123 
®l_»cÜds
.
	`add
(
»cÜd
->
	`g‘TÙ®
());

124 
»maššg_»cÜds
.
	`add
(
»cÜd
->
	`g‘TÙ®
());

125 
®l_»cÜds_log
.
	`add
(
»cÜd
->
	`g‘TÙ®
());

126 
»maššg_»cÜds_log
.
	`add
(
»cÜd
->
	`g‘TÙ®
());

127 
m_touched_vec
[
»cÜd
->
	`g‘TouchedBy
()]++;

128 
m_touched_weigh‹d_vec
[
»cÜd
->
	`g‘TouchedBy
()] +ğ»cÜd->
	`g‘TÙ®
();

130 
out
 << 
’dl
;

131 
out
 << "®l_»cÜds_" << 
desütiÚ
 << ": "

132 << 
®l_»cÜds
 << 
’dl


133 << "®l_»cÜds_log_" << 
desütiÚ
 << ": "

134 << 
®l_»cÜds_log
 << 
’dl


135 << "»maššg_»cÜds_" << 
desütiÚ
 << ": "

136 << 
»maššg_»cÜds
 << 
’dl


137 << "»maššg_»cÜds_log_" << 
desütiÚ
 << ": "

138 << 
»maššg_»cÜds_log
 << 
’dl


139 << "touched_by_" << 
desütiÚ
 << ": "

140 << 
m_touched_vec
 << 
’dl


141 << "touched_by_weigh‹d_" << 
desütiÚ
 << ": "

142 << 
m_touched_weigh‹d_vec
 << 
’dl


143 << 
’dl
;

144 
	}
}

146 
	gAdd»ssProf”
::
	$Add»ssProf”
(
num_of_£qu’ûrs
)

148 
m_num_of_£qu’ûrs
 = 
num_of_£qu’ûrs
;

149 
	`ş—rSts
();

150 
	}
}

152 
	gAdd»ssProf”
::~
	$Add»ssProf”
()

154 
	}
}

157 
Add»ssProf”
::
	$£tHÙLšes
(
boŞ
 
hÙ_lšes
)

159 
m_hÙ_lšes
 = 
hÙ_lšes
;

160 
	}
}

163 
	gAdd»ssProf”
::
	$£tAÎIn¡ruùiÚs
(
boŞ
 
®l_š¡ruùiÚs
)

165 
m_®l_š¡ruùiÚs
 = 
®l_š¡ruùiÚs
;

166 
	}
}

169 
	gAdd»ssProf”
::
	$´štSts
(
o¡»am
& 
out
) const

171 ià(
m_hÙ_lšes
) {

172 
out
 << 
’dl
;

173 
out
 << "Add»ssProf” Sts" << 
’dl
;

174 
out
 << "---------------------" << 
’dl
;

176 
out
 << 
’dl
;

177 
out
 << "sh¬šg_mis£s: " << 
m_sh¬šg_miss_couÁ”
 << 
’dl
;

178 
out
 << "g‘x_sh¬šg_hi¡og¿m: " << 
m_g‘x_sh¬šg_hi¡og¿m
 << 
’dl
;

179 
out
 << "g‘s_sh¬šg_hi¡og¿m: " << 
m_g‘s_sh¬šg_hi¡og¿m
 << 
’dl
;

181 
out
 << 
’dl
;

182 
out
 << "HÙ D©¨Blocks" << 
’dl
;

183 
out
 << "---------------" << 
’dl
;

184 
out
 << 
’dl
;

185 
	`´štSÜ‹d
(
out
, 
m_num_of_£qu’ûrs
, 
m_d©aAcûssT¿û
,

188 
out
 << 
’dl
;

189 
out
 << "HÙ MaüoD©¨Blocks" << 
’dl
;

190 
out
 << "--------------------" << 
’dl
;

191 
out
 << 
’dl
;

192 
	`´štSÜ‹d
(
out
, 
m_num_of_£qu’ûrs
, 
m_maüoBlockAcûssT¿û
,

195 
out
 << "HÙ In¡ruùiÚs" << 
’dl
;

196 
out
 << "----------------" << 
’dl
;

197 
out
 << 
’dl
;

198 
	`´štSÜ‹d
(
out
, 
m_num_of_£qu’ûrs
, 
m_´og¿mCouÁ”AcûssT¿û
,

202 ià(
m_®l_š¡ruùiÚs
) {

203 
out
 << 
’dl
;

204 
out
 << "AÎ In¡ruùiÚ Profe:" << 
’dl
;

205 
out
 << "-------------------------" << 
’dl
;

206 
out
 << 
’dl
;

207 
	`´štSÜ‹d
(
out
, 
m_num_of_£qu’ûrs
, 
m_´og¿mCouÁ”AcûssT¿û
,

209 
out
 << 
’dl
;

212 ià(
m_»ŒyProfeHi¡o
.
	`size
() > 0) {

213 
out
 << "R‘ry Profe" << 
’dl
;

214 
out
 << "-------------" << 
’dl
;

215 
out
 << 
’dl
;

216 
out
 << "»Œy_hi¡og¿m_absŞu‹: " << 
m_»ŒyProfeHi¡o
 << 
’dl
;

217 
out
 << "»Œy_hi¡og¿m_wr™e: " << 
m_»ŒyProfeHi¡oWr™e
 << 
’dl
;

218 
out
 << "»Œy_hi¡og¿m_»ad: " << 
m_»ŒyProfeHi¡oR—d
 << 
’dl
;

220 
out
 << "retry_histogram_percent: ";

221 
m_»ŒyProfeHi¡o
.
	`´štP”ûÁ
(
out
);

222 
out
 << 
’dl
;

224 
	`´štSÜ‹d
(
out
, 
m_num_of_£qu’ûrs
, 
m_»ŒyProfeM­
,

226 
out
 << 
’dl
;

228 
	}
}

231 
	gAdd»ssProf”
::
	$ş—rSts
()

234 
m_sh¬šg_miss_couÁ”
 = 0;

235 
m_d©aAcûssT¿û
.
	`ş—r
();

236 
m_maüoBlockAcûssT¿û
.
	`ş—r
();

237 
m_´og¿mCouÁ”AcûssT¿û
.
	`ş—r
();

238 
m_»ŒyProfeM­
.
	`ş—r
();

239 
m_»ŒyProfeHi¡o
.
	`ş—r
();

240 
m_»ŒyProfeHi¡oR—d
.
	`ş—r
();

241 
m_»ŒyProfeHi¡oWr™e
.
	`ş—r
();

242 
m_g‘x_sh¬šg_hi¡og¿m
.
	`ş—r
();

243 
m_g‘s_sh¬šg_hi¡og¿m
.
	`ş—r
();

244 
	}
}

247 
	gAdd»ssProf”
::
	$´ofeG‘X
(cÚ¡ 
Add»ss
& 
d©ablock
, cÚ¡ Add»ss& 
PC
,

248 cÚ¡ 
S‘
& 
owÃr
, cÚ¡ S‘& 
sh¬”s
,

249 
NodeID
 
»que¡Ü
)

251 
S‘
 
šdœeùiÚ_£t
;

252 
šdœeùiÚ_£t
.
	`addS‘
(
sh¬”s
);

253 
šdœeùiÚ_£t
.
	`addS‘
(
owÃr
);

254 
šdœeùiÚ_£t
.
	`»move
(
»que¡Ü
);

255 
num_šdœeùiÚs
 = 
šdœeùiÚ_£t
.
	`couÁ
();

257 
m_g‘x_sh¬šg_hi¡og¿m
.
	`add
(
num_šdœeùiÚs
);

258 
boŞ
 
šdœeùiÚ_miss
 = (
num_šdœeùiÚs
 > 0);

260 
	`addT¿ûSam¶e
(
d©ablock
, 
PC
, 
RubyReque¡Ty³_ST
, 
	`RubyAcûssMode
(0),

261 
»que¡Ü
, 
šdœeùiÚ_miss
);

262 
	}
}

265 
	gAdd»ssProf”
::
	$´ofeG‘S
(cÚ¡ 
Add»ss
& 
d©ablock
, cÚ¡ Add»ss& 
PC
,

266 cÚ¡ 
S‘
& 
owÃr
, cÚ¡ S‘& 
sh¬”s
,

267 
NodeID
 
»que¡Ü
)

269 
S‘
 
šdœeùiÚ_£t
;

270 
šdœeùiÚ_£t
.
	`addS‘
(
owÃr
);

271 
šdœeùiÚ_£t
.
	`»move
(
»que¡Ü
);

272 
num_šdœeùiÚs
 = 
šdœeùiÚ_£t
.
	`couÁ
();

274 
m_g‘s_sh¬šg_hi¡og¿m
.
	`add
(
num_šdœeùiÚs
);

275 
boŞ
 
šdœeùiÚ_miss
 = (
num_šdœeùiÚs
 > 0);

277 
	`addT¿ûSam¶e
(
d©ablock
, 
PC
, 
RubyReque¡Ty³_LD
, 
	`RubyAcûssMode
(0),

278 
»que¡Ü
, 
šdœeùiÚ_miss
);

279 
	}
}

282 
	gAdd»ssProf”
::
	$addT¿ûSam¶e
(
Add»ss
 
d©a_addr
, Add»s 
pc_addr
,

283 
RubyReque¡Ty³
 
ty³
,

284 
RubyAcûssMode
 
acûss_mode
, 
NodeID
 
id
,

285 
boŞ
 
sh¬šg_miss
)

287 ià(
m_®l_š¡ruùiÚs
) {

288 ià(
sh¬šg_miss
) {

289 
m_sh¬šg_miss_couÁ”
++;

293 
d©a_addr
.
	`makeLšeAdd»ss
();

294 
	`lookupT¿ûFÜAdd»ss
(
d©a_addr
, 
m_d©aAcûssT¿û
).

295 
	`upd©e
(
ty³
, 
acûss_mode
, 
id
, 
sh¬šg_miss
);

300 
Add»ss
 
	`maüo_addr
(
d©a_addr
.
	`maskLowOrd”B™s
(10));

301 
	`lookupT¿ûFÜAdd»ss
(
maüo_addr
, 
m_maüoBlockAcûssT¿û
).

302 
	`upd©e
(
ty³
, 
acûss_mode
, 
id
, 
sh¬šg_miss
);

305 
	`lookupT¿ûFÜAdd»ss
(
pc_addr
, 
m_´og¿mCouÁ”AcûssT¿û
).

306 
	`upd©e
(
ty³
, 
acûss_mode
, 
id
, 
sh¬šg_miss
);

309 ià(
m_®l_š¡ruùiÚs
) {

313 
	`lookupT¿ûFÜAdd»ss
(
pc_addr
, 
m_´og¿mCouÁ”AcûssT¿û
).

314 
	`upd©e
(
ty³
, 
acûss_mode
, 
id
, 
sh¬šg_miss
);

316 
	}
}

319 
	gAdd»ssProf”
::
	$´ofeR‘ry
(cÚ¡ 
Add»ss
& 
d©a_addr
, 
AcûssTy³
 
ty³
,

320 
couÁ
)

322 
m_»ŒyProfeHi¡o
.
	`add
(
couÁ
);

323 ià(
ty³
 =ğ
AcûssTy³_R—d
) {

324 
m_»ŒyProfeHi¡oR—d
.
	`add
(
couÁ
);

326 
m_»ŒyProfeHi¡oWr™e
.
	`add
(
couÁ
);

328 ià(
couÁ
 > 1) {

329 
	`lookupT¿ûFÜAdd»ss
(
d©a_addr
, 
m_»ŒyProfeM­
).
	`addSam¶e
(
couÁ
);

331 
	}
}

	@ruby/profiler/AddressProfiler.hh

29 #iâdeà
__MEM_RUBY_PROFILER_ADDRESSPROFILER_HH__


30 
	#__MEM_RUBY_PROFILER_ADDRESSPROFILER_HH__


	)

32 
	~<io¡»am
>

34 
	~"ba£/hashm­.hh
"

35 
	~"mem/´ÙocŞ/AcûssTy³.hh
"

36 
	~"mem/´ÙocŞ/RubyReque¡.hh
"

37 
	~"mem/ruby/commÚ/Add»ss.hh
"

38 
	~"mem/ruby/commÚ/Glob®.hh
"

39 
	~"mem/ruby/commÚ/Hi¡og¿m.hh
"

40 
	~"mem/ruby/´of”/AcûssT¿ûFÜAdd»ss.hh
"

42 
şass
 
	gS‘
;

44 şas 
	cAdd»ssProf”


46 
	mpublic
:

47 
m5
::
	thash_m­
<
	tAdd»ss
, 
	tAcûssT¿ûFÜAdd»ss
> 
	tAdd»ssM­
;

49 
	mpublic
:

50 
Add»ssProf”
(
num_of_£qu’ûrs
);

51 ~
Add»ssProf”
();

53 
´štSts
(
¡d
::
o¡»am
& 
out
) const;

54 
ş—rSts
();

56 
addT¿ûSam¶e
(
Add»ss
 
d©a_addr
, Add»s 
pc_addr
,

57 
RubyReque¡Ty³
 
ty³
, 
RubyAcûssMode
 
acûss_mode
,

58 
NodeID
 
id
, 
boŞ
 
sh¬šg_miss
);

59 
´ofeR‘ry
(cÚ¡ 
Add»ss
& 
d©a_addr
, 
AcûssTy³
 
ty³
, 
couÁ
);

60 
´ofeG‘X
(cÚ¡ 
Add»ss
& 
d©ablock
, cÚ¡ Add»ss& 
PC
,

61 cÚ¡ 
S‘
& 
owÃr
, cÚ¡ S‘& 
sh¬”s
, 
NodeID
 
»que¡Ü
);

62 
´ofeG‘S
(cÚ¡ 
Add»ss
& 
d©ablock
, cÚ¡ Add»ss& 
PC
,

63 cÚ¡ 
S‘
& 
owÃr
, cÚ¡ S‘& 
sh¬”s
, 
NodeID
 
»que¡Ü
);

65 
´št
(
¡d
::
o¡»am
& 
out
) const;

68 
£tHÙLšes
(
boŞ
 
hÙ_lšes
);

69 
£tAÎIn¡ruùiÚs
(
boŞ
 
®l_š¡ruùiÚs
);

71 
	m´iv©e
:

73 
Add»ssProf”
(cÚ¡ Add»ssProf”& 
obj
);

74 
	mAdd»ssProf”
& 
	mİ”©Ü
=(cÚ¡ 
Add»ssProf”
& 
obj
);

76 
št64
 
	mm_sh¬šg_miss_couÁ”
;

78 
Add»ssM­
 
	mm_d©aAcûssT¿û
;

79 
Add»ssM­
 
	mm_maüoBlockAcûssT¿û
;

80 
Add»ssM­
 
	mm_´og¿mCouÁ”AcûssT¿û
;

81 
Add»ssM­
 
	mm_»ŒyProfeM­
;

82 
Hi¡og¿m
 
	mm_»ŒyProfeHi¡o
;

83 
Hi¡og¿m
 
	mm_»ŒyProfeHi¡oWr™e
;

84 
Hi¡og¿m
 
	mm_»ŒyProfeHi¡oR—d
;

85 
Hi¡og¿m
 
	mm_g‘x_sh¬šg_hi¡og¿m
;

86 
Hi¡og¿m
 
	mm_g‘s_sh¬šg_hi¡og¿m
;

89 
boŞ
 
	mm_hÙ_lšes
;

90 
boŞ
 
	mm_®l_š¡ruùiÚs
;

92 
	mm_num_of_£qu’ûrs
;

95 
	gAcûssT¿ûFÜAdd»ss
& 
lookupT¿ûFÜAdd»ss
(cÚ¡ 
Add»ss
& 
addr
,

96 
Add»ssProf”
::
Add»ssM­
&

97 
»cÜd_m­
);

99 
´štSÜ‹d
(
¡d
::
o¡»am
& 
out
, 
num_of_£qu’ûrs
,

100 cÚ¡ 
Add»ssProf”
::
Add»ssM­
 &
»cÜd_m­
,

101 
¡d
::
¡ršg
 
desütiÚ
);

103 
šlše
 
	g¡d
::
o¡»am
&

104 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gAdd»ssProf”
& 
	gobj
)

106 
	gobj
.
´št
(
out
);

107 
	gout
 << 
	g¡d
::
æush
;

108  
	gout
;

	@ruby/profiler/MemCntrlProfiler.cc

29 
	~"mem/ruby/´of”/MemCÁ¾Prof”.hh
"

31 
usšg
 
Çme¥aû
 
	g¡d
;

33 
	gMemCÁ¾Prof”
::
	$MemCÁ¾Prof”
(cÚ¡ 
¡ršg
& 
desütiÚ
,

34 
bªks_³r_¿nk
, 
¿nks_³r_dimm
, 
dimms_³r_chªÃl
)

36 
m_desütiÚ
 = 
desütiÚ
;

37 
m_bªks_³r_¿nk
 = 
bªks_³r_¿nk
;

38 
m_¿nks_³r_dimm
 = 
¿nks_³r_dimm
;

39 
m_dimms_³r_chªÃl
 = 
dimms_³r_chªÃl
;

40 
	}
}

42 
	gMemCÁ¾Prof”
::~
	$MemCÁ¾Prof”
()

44 
	}
}

47 
MemCÁ¾Prof”
::
	$´ofeMemReq
(
bªk
)

49 
m_memReq
++;

50 
m_memBªkCouÁ
[
bªk
]++;

51 
	}
}

54 
	gMemCÁ¾Prof”
::
	$´ofeMemBªkBusy
()

56 
m_memBªkBusy
++;

57 
	}
}

60 
	gMemCÁ¾Prof”
::
	$´ofeMemBusBusy
()

62 
m_memBusBusy
++;

63 
	}
}

66 
	gMemCÁ¾Prof”
::
	$´ofeMemR—dWr™eBusy
()

68 
m_memR—dWr™eBusy
++;

69 
	}
}

72 
	gMemCÁ¾Prof”
::
	$´ofeMemD©aBusBusy
()

74 
m_memD©aBusBusy
++;

75 
	}
}

78 
	gMemCÁ¾Prof”
::
	$´ofeMemTçwBusy
()

80 
m_memTçwBusy
++;

81 
	}
}

84 
	gMemCÁ¾Prof”
::
	$´ofeMemReäesh
()

86 
m_memReäesh
++;

87 
	}
}

90 
	gMemCÁ¾Prof”
::
	$´ofeMemR—d
()

92 
m_memR—d
++;

93 
	}
}

96 
	gMemCÁ¾Prof”
::
	$´ofeMemWr™e
()

98 
m_memWr™e
++;

99 
	}
}

102 
	gMemCÁ¾Prof”
::
	$´ofeMemWa™Cyşes
(
cyşes
)

104 
m_memWa™Cyşes
 +ğ
cyşes
;

105 
	}
}

108 
	gMemCÁ¾Prof”
::
	$´ofeMemIÅutQ
(
cyşes
)

110 
m_memIÅutQ
 +ğ
cyşes
;

111 
	}
}

114 
	gMemCÁ¾Prof”
::
	$´ofeMemBªkQ
(
cyşes
)

116 
m_memBªkQ
 +ğ
cyşes
;

117 
	}
}

120 
	gMemCÁ¾Prof”
::
	$´ofeMemArbWa™
(
cyşes
)

122 
m_memArbWa™
 +ğ
cyşes
;

123 
	}
}

126 
	gMemCÁ¾Prof”
::
	$´ofeMemRªdBusy
()

128 
m_memRªdBusy
++;

129 
	}
}

132 
	gMemCÁ¾Prof”
::
	$´ofeMemNÙOld
()

134 
m_memNÙOld
++;

135 
	}
}

138 
	gMemCÁ¾Prof”
::
	$»gSts
()

140 
m_memReq


141 .
	`Çme
(
m_desütiÚ
 + ".memReq")

142 .
	`desc
("Total‚umber of memory„equests")

143 .
	`æags
(
Sts
::
noz”o
)

146 
m_memR—d


147 .
	`Çme
(
m_desütiÚ
 + ".memRead")

148 .
	`desc
("Number of memory„eads")

149 .
	`æags
(
Sts
::
noz”o
)

152 
m_memWr™e


153 .
	`Çme
(
m_desütiÚ
 + ".memWrite")

154 .
	`desc
("Number of memory writes")

155 .
	`æags
(
Sts
::
noz”o
)

158 
m_memReäesh


159 .
	`Çme
(
m_desütiÚ
 + ".memRefresh")

160 .
	`desc
("Number of memory„efreshes")

161 .
	`æags
(
Sts
::
noz”o
)

164 
m_memIÅutQ


165 .
	`Çme
(
m_desütiÚ
 + ".memInputQ")

166 .
	`desc
("Delay inhe input queue")

167 .
	`æags
(
Sts
::
noz”o
)

170 
m_memBªkQ


171 .
	`Çme
(
m_desütiÚ
 + ".memBankQ")

172 .
	`desc
("Delay behindhe head ofhe bank queue")

173 .
	`æags
(
Sts
::
noz”o
)

176 
m_memWa™Cyşes


177 .
	`Çme
(
m_desütiÚ
 + ".memWaitCycles")

178 .
	`desc
("Delay stalled‡the head ofhe bank queue")

179 .
	`æags
(
Sts
::
noz”o
)

182 
m_tÙ®SÎs


183 .
	`Çme
(
m_desütiÚ
 + ".totalStalls")

184 .
	`desc
("Total‚umber of stall cycles")

185 .
	`æags
(
Sts
::
noz”o
)

188 
m_tÙ®SÎs
 = 
m_memIÅutQ
 + 
m_memBªkQ
 + 
m_memWa™Cyşes
;

190 
m_¡®lsP”Req


191 .
	`Çme
(
m_desütiÚ
 + ".stallsPerReq")

192 .
	`desc
("Expected‚umber of stall cycles…er„equest")

193 .
	`æags
(
Sts
::
noz”o
)

196 
m_¡®lsP”Req
 = 
m_tÙ®SÎs
 / 
m_memReq
;

207 
m_memBªkBusy


208 .
	`Çme
(
m_desütiÚ
 + ".memBankBusy")

209 .
	`desc
("memory stalls dueo busy bank")

210 .
	`æags
(
Sts
::
noz”o
)

213 
m_memRªdBusy


214 .
	`Çme
(
m_desütiÚ
 + ".memRandBusy")

215 .
	`desc
("memory stalls dueo busy„andom")

216 .
	`æags
(
Sts
::
noz”o
)

219 
m_memNÙOld


220 .
	`Çme
(
m_desütiÚ
 + ".memNotOld")

221 .
	`desc
("memory stalls dueo‡nti starvation")

222 .
	`æags
(
Sts
::
noz”o
)

225 
m_memArbWa™


226 .
	`Çme
(
m_desütiÚ
 + ".memArbWait")

227 .
	`desc
("memory stalls dueo‡rbitration")

228 .
	`æags
(
Sts
::
noz”o
)

231 
m_memBusBusy


232 .
	`Çme
(
m_desütiÚ
 + ".memBusBusy")

233 .
	`desc
("memory stalls dueo busy bus")

234 .
	`æags
(
Sts
::
noz”o
)

237 
m_memTçwBusy


238 .
	`Çme
(
m_desütiÚ
 + ".memTfawBusy")

239 .
	`desc
("memory stalls for Tfaw")

240 .
	`æags
(
Sts
::
noz”o
)

243 
m_memR—dWr™eBusy


244 .
	`Çme
(
m_desütiÚ
 + ".memReadWriteBusy")

245 .
	`desc
("memory stalls dueo„ead writeurnaround")

246 .
	`æags
(
Sts
::
noz”o
)

249 
m_memD©aBusBusy


250 .
	`Çme
(
m_desütiÚ
 + ".memDataBusBusy")

251 .
	`desc
("memory stalls dueo„ead„eadurnaround")

252 .
	`æags
(
Sts
::
noz”o
)

255 
tÙ®Bªks
 = 
m_bªks_³r_¿nk
 * 
m_¿nks_³r_dimm
 * 
m_dimms_³r_chªÃl
;

256 
m_memBªkCouÁ


257 .
	`š™
(
tÙ®Bªks
)

258 .
	`Çme
(
m_desütiÚ
 + ".memBankCount")

259 .
	`desc
("Number of‡ccesses…er bank")

260 .
	`æags
(
Sts
::
pdf
 | Sts::
tÙ®
|Sts::
Ú–še
)

262 
i
 = 0; i < 
tÙ®Bªks
; i++) {

263 
m_memBªkCouÁ
.
	`subÇme
(
i
, "");

265 
	}
}

	@ruby/profiler/MemCntrlProfiler.hh

29 #iâdeà
__MEM_RUBY_PROFILER_MEMCNTRLPROFILER_HH__


30 
	#__MEM_RUBY_PROFILER_MEMCNTRLPROFILER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"ba£/¡©i¡ics.hh
"

37 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

39 şas 
	cMemCÁ¾Prof”


41 
	mpublic
:

42 
MemCÁ¾Prof”
(cÚ¡ 
¡d
::
¡ršg
& 
desütiÚ
, 
bªks_³r_¿nk
,

43 
¿nks_³r_dimm
, 
dimms_³r_chªÃl
);

44 ~
MemCÁ¾Prof”
();

46 
»gSts
();

48 
´ofeMemReq
(
bªk
);

49 
´ofeMemBªkBusy
();

50 
´ofeMemBusBusy
();

51 
´ofeMemTçwBusy
();

52 
´ofeMemR—dWr™eBusy
();

53 
´ofeMemD©aBusBusy
();

54 
´ofeMemReäesh
();

55 
´ofeMemR—d
();

56 
´ofeMemWr™e
();

57 
´ofeMemWa™Cyşes
(
cyşes
);

58 
´ofeMemIÅutQ
(
cyşes
);

59 
´ofeMemBªkQ
(
cyşes
);

60 
´ofeMemArbWa™
(
cyşes
);

61 
´ofeMemRªdBusy
();

62 
´ofeMemNÙOld
();

64 
´št
(
¡d
::
o¡»am
& 
out
) const;

66 
	m´iv©e
:

68 
MemCÁ¾Prof”
(cÚ¡ MemCÁ¾Prof”& 
obj
);

69 
	mMemCÁ¾Prof”
& 
	mİ”©Ü
=(cÚ¡ 
MemCÁ¾Prof”
& 
obj
);

71 
	m¡d
::
¡ršg
 
m_desütiÚ
;

72 
	mSts
::
SÿÏr
 
m_memReq
;

73 
	mSts
::
SÿÏr
 
m_memR—d
;

74 
	mSts
::
SÿÏr
 
m_memWr™e
;

75 
	mSts
::
SÿÏr
 
m_memReäesh
;

77 
	mSts
::
SÿÏr
 
m_memWa™Cyşes
;

78 
	mSts
::
SÿÏr
 
m_memIÅutQ
;

79 
	mSts
::
SÿÏr
 
m_memBªkQ
;

80 
	mSts
::
FÜmuÏ
 
m_tÙ®SÎs
;

81 
	mSts
::
FÜmuÏ
 
m_¡®lsP”Req
;

83 
	mSts
::
SÿÏr
 
m_memBªkBusy
;

84 
	mSts
::
SÿÏr
 
m_memBusBusy
;

85 
	mSts
::
SÿÏr
 
m_memTçwBusy
;

86 
	mSts
::
SÿÏr
 
m_memR—dWr™eBusy
;

87 
	mSts
::
SÿÏr
 
m_memD©aBusBusy
;

88 
	mSts
::
SÿÏr
 
m_memArbWa™
;

89 
	mSts
::
SÿÏr
 
m_memRªdBusy
;

90 
	mSts
::
SÿÏr
 
m_memNÙOld
;

91 
	mSts
::
VeùÜ
 
m_memBªkCouÁ
;

93 
	mm_bªks_³r_¿nk
;

94 
	mm_¿nks_³r_dimm
;

95 
	mm_dimms_³r_chªÃl
;

98 
šlše
 
	g¡d
::
o¡»am
&

99 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gMemCÁ¾Prof”
& 
	gobj
)

101 
	gobj
.
´št
(
out
);

102 
	gout
 << 
	g¡d
::
æush
;

103  
	gout
;

	@ruby/profiler/Profiler.cc

45 
	~<sys/ty³s.h
>

46 
	~<uni¡d.h
>

48 
	~<®gÜ™hm
>

49 
	~<f¡»am
>

51 
	~"ba£/¡l_h–³rs.hh
"

52 
	~"ba£/¡r.hh
"

53 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

54 
	~"mem/´ÙocŞ/RubyReque¡.hh
"

55 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

56 
	~"mem/ruby/´of”/Add»ssProf”.hh
"

57 
	~"mem/ruby/´of”/Prof”.hh
"

58 
	~"mem/ruby/sy¡em/Sequ’ûr.hh
"

59 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

61 
usšg
 
Çme¥aû
 
	g¡d
;

62 
usšg
 
	gm5
::
¡l_h–³rs
::
İ”©Ü
<<;

64 
	gProf”
::
	$Prof”
(cÚ¡ 
P¬ams
 *
p
)

65 : 
	$SimObjeù
(
p
)

67 
m_š¡_´of”_±r
 = 
NULL
;

68 
m_add»ss_´of”_±r
 = 
NULL
;

69 
m_»®_time_¡¬t_time
 = 
	`time
(
NULL
);

71 
m_hÙ_lšes
 = 
p
->
hÙ_lšes
;

72 
m_®l_š¡ruùiÚs
 = 
p
->
®l_š¡ruùiÚs
;

74 
m_num_of_£qu’ûrs
 = 
p
->
num_of_£qu’ûrs
;

76 
m_hÙ_lšes
 = 
çl£
;

77 
m_®l_š¡ruùiÚs
 = 
çl£
;

79 
m_add»ss_´of”_±r
 = 
Ãw
 
	`Add»ssProf”
(
m_num_of_£qu’ûrs
);

80 
m_add»ss_´of”_±r
->
	`£tHÙLšes
(
m_hÙ_lšes
);

81 
m_add»ss_´of”_±r
->
	`£tAÎIn¡ruùiÚs
(
m_®l_š¡ruùiÚs
);

83 ià(
m_®l_š¡ruùiÚs
) {

84 
m_š¡_´of”_±r
 = 
Ãw
 
	`Add»ssProf”
(
m_num_of_£qu’ûrs
);

85 
m_š¡_´of”_±r
->
	`£tHÙLšes
(
m_hÙ_lšes
);

86 
m_š¡_´of”_±r
->
	`£tAÎIn¡ruùiÚs
(
m_®l_š¡ruùiÚs
);

89 
p
->
ruby_sy¡em
->
	`»gi¡”Prof”
(
this
);

90 
	}
}

92 
	gProf”
::~
	$Prof”
()

94 
	}
}

97 
Prof”
::
	$´št
(
o¡»am
& 
out
) const

99 
out
 << "[Profiler]";

100 
	}
}

103 
	gProf”
::
	$´štReque¡Profe
(
o¡»am
 &
out
) const

105 
out
 << "Reque¡ vs. RubySy¡em S‹ Profe" << 
’dl
;

106 
out
 << "--------------------------------" << 
’dl
;

107 
out
 << 
’dl
;

109 
m­
<
¡ršg
, 
ušt64_t
> 
m_»que¡ProfeM­
;

110 
ušt64_t
 
m_»que¡s
 = 0;

112 
ušt32_t
 
i
 = 0; i < 
MachšeTy³_NUM
; i++) {

113 
m­
<
ušt32_t
, 
Ab¡¿ùCÚŒŞËr
*>::
™”©Ü
 
™
 =

114 
g_abs_cÚŒŞs
[
i
].
	`begš
();

115 
™
 !ğ
g_abs_cÚŒŞs
[
i
].
	`’d
(); ++it) {

117 
Ab¡¿ùCÚŒŞËr
 *
ùr
 = (*
™
).
£cÚd
;

118 
m­
<
¡ršg
, 
ušt64_t
> 
mp
 = 
ùr
->
	`g‘Reque¡ProfeM­
();

120 
m­
<
¡ršg
, 
ušt64_t
>::
™”©Ü
 
jt
 = 
mp
.
	`begš
();

121 
jt
 !ğ
mp
.
	`’d
(); ++jt) {

123 
m­
<
¡ršg
, 
ušt64_t
>::
™”©Ü
 
kt
 =

124 
m_»que¡ProfeM­
.
	`fšd
((*
jt
).
fœ¡
);

125 ià(
kt
 !ğ
m_»que¡ProfeM­
.
	`’d
()) {

126 (*
kt
).
£cÚd
 +ğ(*
jt
).second;

128 
m_»que¡ProfeM­
[(*
jt
).
fœ¡
] = (*jt).
£cÚd
;

132 
m_»que¡s
 +ğ
ùr
->
	`g‘Reque¡CouÁ
();

136 
m­
<
¡ršg
, 
ušt64_t
>::
cÚ¡_™”©Ü
 
i
 = 
m_»que¡ProfeM­
.
	`begš
();

137 
m­
<
¡ršg
, 
ušt64_t
>::
cÚ¡_™”©Ü
 
’d
 = 
m_»que¡ProfeM­
.
	`’d
();

138 ; 
i
 !ğ
’d
; ++i) {

139 cÚ¡ 
¡ršg
 &
key
 = 
i
->
fœ¡
;

140 
ušt64_t
 
couÁ
 = 
i
->
£cÚd
;

142 
³rûÁ
 = (100.0 * (
couÁ
)è/ (
m_»que¡s
);

143 
veùÜ
<
¡ršg
> 
™ems
;

144 
	`tok’ize
(
™ems
, 
key
, ':');

145 
veùÜ
<
¡ršg
>::
™”©Ü
 
j
 = 
™ems
.
	`begš
();

146 
veùÜ
<
¡ršg
>::
™”©Ü
 
’d
 = 
™ems
.
	`’d
();

147 ; 
j
 !ğ
’d
; ++
i
)

148 
out
 << 
	`£tw
(10è<< *
j
;

149 
out
 << 
	`£tw
(11è<< 
couÁ
;

150 
out
 << 
	`£tw
(14è<< 
³rûÁ
 << 
’dl
;

152 
out
 << 
’dl
;

153 
	}
}

156 
	gProf”
::
	$´štD–ayProfe
(
o¡»am
 &
out
) const

158 
out
 << "Mes§gD–ayed Cyşes" << 
’dl
;

159 
out
 << "----------------------" << 
’dl
;

161 
ušt32_t
 
numVN‘s
 = 
N‘wÜk
::
	`g‘Numb”OfVœtu®N‘wÜks
();

162 
Hi¡og¿m
 
d–ayHi¡og¿m
;

163 
¡d
::
veùÜ
<
Hi¡og¿m
> 
	`d–ayVCHi¡og¿m
(
numVN‘s
);

165 
ušt32_t
 
i
 = 0; i < 
MachšeTy³_NUM
; i++) {

166 
m­
<
ušt32_t
, 
Ab¡¿ùCÚŒŞËr
*>::
™”©Ü
 
™
 =

167 
g_abs_cÚŒŞs
[
i
].
	`begš
();

168 
™
 !ğ
g_abs_cÚŒŞs
[
i
].
	`’d
(); ++it) {

170 
Ab¡¿ùCÚŒŞËr
 *
ùr
 = (*
™
).
£cÚd
;

171 
d–ayHi¡og¿m
.
	`add
(
ùr
->
	`g‘D–ayHi¡
());

173 
ušt32_t
 
i
 = 0; i < 
numVN‘s
; i++) {

174 
d–ayVCHi¡og¿m
[
i
].
	`add
(
ùr
->
	`g‘D–ayVCHi¡
(i));

179 
out
 << "TÙ®_d–ay_cyşes: " << 
d–ayHi¡og¿m
 << 
’dl
;

181 
i
 = 0; i < 
numVN‘s
; i++) {

182 
out
 << " vœtu®_ÃtwÜk_" << 
i
 << "_delay_cycles: "

183 << 
d–ayVCHi¡og¿m
[
i
] << 
’dl
;

185 
	}
}

188 
	gProf”
::
	$´štOut¡ªdšgReqProfe
(
o¡»am
 &
out
) const

190 
Hi¡og¿m
 
£qu’ûrReque¡s
;

192 
ušt32_t
 
i
 = 0; i < 
MachšeTy³_NUM
; i++) {

193 
m­
<
ušt32_t
, 
Ab¡¿ùCÚŒŞËr
*>::
™”©Ü
 
™
 =

194 
g_abs_cÚŒŞs
[
i
].
	`begš
();

195 
™
 !ğ
g_abs_cÚŒŞs
[
i
].
	`’d
(); ++it) {

197 
Ab¡¿ùCÚŒŞËr
 *
ùr
 = (*
™
).
£cÚd
;

198 
Sequ’ûr
 *
£q
 = 
ùr
->
	`g‘Sequ’ûr
();

199 ià(
£q
 !ğ
NULL
) {

200 
£qu’ûrReque¡s
.
	`add
(
£q
->
	`g‘Out¡ªdReqHi¡
());

205 
out
 << "sequencer_requests_outstanding: "

206 << 
£qu’ûrReque¡s
 << 
’dl
;

207 
	}
}

210 
	gProf”
::
	$´štMissL©’cyProfe
(
o¡»am
 &
out
) const

213 
Hi¡og¿m
 
Ï‹ncy_hi¡
;

214 
¡d
::
veùÜ
<
Hi¡og¿m
> 
	`ty³_Ï‹ncy_hi¡
(
RubyReque¡Ty³_NUM
);

216 
Hi¡og¿m
 
h™_Ï‹ncy_hi¡
;

217 
¡d
::
veùÜ
<
Hi¡og¿m
> 
	`h™_ty³_Ï‹ncy_hi¡
(
RubyReque¡Ty³_NUM
);

219 
¡d
::
veùÜ
<
Hi¡og¿m
> 
	`h™_mach_Ï‹ncy_hi¡
(
MachšeTy³_NUM
);

220 
¡d
::
veùÜ
<¡d::veùÜ<
Hi¡og¿m
> >

221 
	`h™_ty³_mach_Ï‹ncy_hi¡
(
RubyReque¡Ty³_NUM
,

222 
¡d
::
veùÜ
<
Hi¡og¿m
>(
MachšeTy³_NUM
));

224 
Hi¡og¿m
 
miss_Ï‹ncy_hi¡
;

225 
¡d
::
veùÜ
<
Hi¡og¿m
> 
	`miss_ty³_Ï‹ncy_hi¡
(
RubyReque¡Ty³_NUM
);

227 
¡d
::
veùÜ
<
Hi¡og¿m
> 
	`miss_mach_Ï‹ncy_hi¡
(
MachšeTy³_NUM
);

228 
¡d
::
veùÜ
<¡d::veùÜ<
Hi¡og¿m
> >

229 
	`miss_ty³_mach_Ï‹ncy_hi¡
(
RubyReque¡Ty³_NUM
,

230 
¡d
::
veùÜ
<
Hi¡og¿m
>(
MachšeTy³_NUM
));

232 
¡d
::
veùÜ
<
Hi¡og¿m
> 
	`issue_to_š™Ÿl_d–ay_hi¡
(
MachšeTy³_NUM
);

233 
¡d
::
veùÜ
<
Hi¡og¿m
> 
	`š™Ÿl_to_fÜw¬d_d–ay_hi¡
(
MachšeTy³_NUM
);

234 
¡d
::
veùÜ
<
Hi¡og¿m
>

235 
	`fÜw¬d_to_fœ¡_»¥Ú£_d–ay_hi¡
(
MachšeTy³_NUM
);

236 
¡d
::
veùÜ
<
Hi¡og¿m
>

237 
	`fœ¡_»¥Ú£_to_com¶‘iÚ_d–ay_hi¡
(
MachšeTy³_NUM
);

238 
¡d
::
veùÜ
<
ušt64_t
> 
	`šcom¶‘e_times
(
MachšeTy³_NUM
);

240 
ušt32_t
 
i
 = 0; i < 
MachšeTy³_NUM
; i++) {

241 
m­
<
ušt32_t
, 
Ab¡¿ùCÚŒŞËr
*>::
™”©Ü
 
™
 =

242 
g_abs_cÚŒŞs
[
i
].
	`begš
();

243 
™
 !ğ
g_abs_cÚŒŞs
[
i
].
	`’d
(); ++it) {

245 
Ab¡¿ùCÚŒŞËr
 *
ùr
 = (*
™
).
£cÚd
;

246 
Sequ’ûr
 *
£q
 = 
ùr
->
	`g‘Sequ’ûr
();

247 ià(
£q
 !ğ
NULL
) {

249 
Ï‹ncy_hi¡
.
	`add
(
£q
->
	`g‘L©’cyHi¡
());

250 
h™_Ï‹ncy_hi¡
.
	`add
(
£q
->
	`g‘H™L©’cyHi¡
());

251 
miss_Ï‹ncy_hi¡
.
	`add
(
£q
->
	`g‘MissL©’cyHi¡
());

254 
ušt32_t
 
j
 = 0; j < 
RubyReque¡Ty³_NUM
; ++j) {

255 
ty³_Ï‹ncy_hi¡
[
j
]

256 .
	`add
(
£q
->
	`g‘Ty³L©’cyHi¡
(
j
));

257 
h™_ty³_Ï‹ncy_hi¡
[
j
]

258 .
	`add
(
£q
->
	`g‘H™Ty³L©’cyHi¡
(
j
));

259 
miss_ty³_Ï‹ncy_hi¡
[
j
]

260 .
	`add
(
£q
->
	`g‘MissTy³L©’cyHi¡
(
j
));

264 
ušt32_t
 
j
 = 0; j < 
MachšeTy³_NUM
; ++j) {

265 
h™_mach_Ï‹ncy_hi¡
[
j
]

266 .
	`add
(
£q
->
	`g‘H™MachL©’cyHi¡
(
j
));

267 
miss_mach_Ï‹ncy_hi¡
[
j
]

268 .
	`add
(
£q
->
	`g‘MissMachL©’cyHi¡
(
j
));

270 
issue_to_š™Ÿl_d–ay_hi¡
[
j
].
	`add
(

271 
£q
->
	`g‘IssueToIn™ŸlD–ayHi¡
(
	`MachšeTy³
(
j
)));

273 
š™Ÿl_to_fÜw¬d_d–ay_hi¡
[
j
].
	`add
(

274 
£q
->
	`g‘In™ŸlToFÜw¬dD–ayHi¡
(
	`MachšeTy³
(
j
)));

275 
fÜw¬d_to_fœ¡_»¥Ú£_d–ay_hi¡
[
j
].
	`add
(
£q
->

276 
	`g‘FÜw¬dReque¡ToFœ¡Re¥Ú£Hi¡
(
	`MachšeTy³
(
j
)));

278 
fœ¡_»¥Ú£_to_com¶‘iÚ_d–ay_hi¡
[
j
].
	`add
(
£q
->

279 
	`g‘Fœ¡Re¥Ú£ToCom¶‘iÚD–ayHi¡
(
	`MachšeTy³
(
j
)));

280 
šcom¶‘e_times
[
j
] +=

281 
£q
->
	`g‘Incom¶‘eTimes
(
	`MachšeTy³
(
j
));

285 
ušt32_t
 
j
 = 0; j < 
RubyReque¡Ty³_NUM
; j++) {

286 
ušt32_t
 
k
 = 0; k < 
MachšeTy³_NUM
; k++) {

287 
h™_ty³_mach_Ï‹ncy_hi¡
[
j
][
k
].
	`add
(

288 
£q
->
	`g‘H™Ty³MachL©’cyHi¡
(
j
,
k
));

289 
miss_ty³_mach_Ï‹ncy_hi¡
[
j
][
k
].
	`add
(

290 
£q
->
	`g‘MissTy³MachL©’cyHi¡
(
j
,
k
));

297 
out
 << "Ï‹ncy: " << 
Ï‹ncy_hi¡
 << 
’dl
;

298 
i
 = 0; i < 
RubyReque¡Ty³_NUM
; i++) {

299 ià(
ty³_Ï‹ncy_hi¡
[
i
].
	`size
() > 0) {

300 
out
 << "Ï‹ncy: " << 
	`RubyReque¡Ty³
(
i
) << ": "

301 << 
ty³_Ï‹ncy_hi¡
[
i
] << 
’dl
;

305 
out
 << "h™†©’cy: " << 
h™_Ï‹ncy_hi¡
 << 
’dl
;

306 
i
 = 0; i < 
RubyReque¡Ty³_NUM
; i++) {

307 ià(
h™_ty³_Ï‹ncy_hi¡
[
i
].
	`size
() > 0) {

308 
out
 << "h™†©’cy: " << 
	`RubyReque¡Ty³
(
i
) << ": "

309 << 
h™_ty³_Ï‹ncy_hi¡
[
i
] << 
’dl
;

313 
i
 = 0; i < 
MachšeTy³_NUM
; i++) {

314 ià(
h™_mach_Ï‹ncy_hi¡
[
i
].
	`size
() > 0) {

315 
out
 << "h™†©’cy: " << 
	`MachšeTy³
(
i
) << ": "

316 << 
h™_mach_Ï‹ncy_hi¡
[
i
] << 
’dl
;

320 
i
 = 0; i < 
RubyReque¡Ty³_NUM
; i++) {

321 
j
 = 0; j < 
MachšeTy³_NUM
; j++) {

322 ià(
h™_ty³_mach_Ï‹ncy_hi¡
[
i
][
j
].
	`size
() > 0) {

323 
out
 << "h™†©’cy: " << 
	`RubyReque¡Ty³
(
i
)

324 << ": " << 
	`MachšeTy³
(
j
) << ": "

325 << 
h™_ty³_mach_Ï‹ncy_hi¡
[
i
][
j
] << 
’dl
;

330 
out
 << "mis Ï‹ncy: " << 
miss_Ï‹ncy_hi¡
 << 
’dl
;

331 
i
 = 0; i < 
RubyReque¡Ty³_NUM
; i++) {

332 ià(
miss_ty³_Ï‹ncy_hi¡
[
i
].
	`size
() > 0) {

333 
out
 << "mis Ï‹ncy: " << 
	`RubyReque¡Ty³
(
i
) << ": "

334 << 
miss_ty³_Ï‹ncy_hi¡
[
i
] << 
’dl
;

338 
i
 = 0; i < 
MachšeTy³_NUM
; i++) {

339 ià(
miss_mach_Ï‹ncy_hi¡
[
i
].
	`size
() > 0) {

340 
out
 << "mis Ï‹ncy: " << 
	`MachšeTy³
(
i
) << ": "

341 << 
miss_mach_Ï‹ncy_hi¡
[
i
] << 
’dl
;

343 
out
 << "mis Ï‹ncy: " << 
	`MachšeTy³
(
i
)

345 << 
issue_to_š™Ÿl_d–ay_hi¡
[
i
] << 
’dl
;

346 
out
 << "mis Ï‹ncy: " << 
	`MachšeTy³
(
i
)

348 << 
š™Ÿl_to_fÜw¬d_d–ay_hi¡
[
i
] << 
’dl
;

349 
out
 << "mis Ï‹ncy: " << 
	`MachšeTy³
(
i
)

351 << 
fÜw¬d_to_fœ¡_»¥Ú£_d–ay_hi¡
[
i
] << 
’dl
;

352 
out
 << "mis Ï‹ncy: " << 
	`MachšeTy³
(
i
)

354 << 
fœ¡_»¥Ú£_to_com¶‘iÚ_d–ay_hi¡
[
i
] << 
’dl
;

355 
out
 << "šcom¶‘times: " << 
šcom¶‘e_times
[
i
] << 
’dl
;

359 
i
 = 0; i < 
RubyReque¡Ty³_NUM
; i++) {

360 
j
 = 0; j < 
MachšeTy³_NUM
; j++) {

361 ià(
miss_ty³_mach_Ï‹ncy_hi¡
[
i
][
j
].
	`size
() > 0) {

362 
out
 << "mis Ï‹ncy: " << 
	`RubyReque¡Ty³
(
i
)

363 << ": " << 
	`MachšeTy³
(
j
) << ": "

364 << 
miss_ty³_mach_Ï‹ncy_hi¡
[
i
][
j
] << 
’dl
;

369 
out
 << 
’dl
;

370 
	}
}

373 
	gProf”
::
	$´štSts
(
o¡»am
& 
out
, 
boŞ
 
shÜt_¡©s
)

375 
out
 << 
’dl
;

376 ià(
shÜt_¡©s
) {

377 
out
 << "SHORT ";

379 
out
 << "Prof” Sts" << 
’dl
;

380 
out
 << "--------------" << 
’dl
;

382 
Cyşes
 
ruby_cyşes
 = 
g_sy¡em_±r
->
	`curCyşe
()-
m_ruby_¡¬t
;

384 
out
 << "Ruby_cu¼’t_time: " << 
g_sy¡em_±r
->
	`curCyşe
(è<< 
’dl
;

385 
out
 << "Ruby_¡¬t_time: " << 
m_ruby_¡¬t
 << 
’dl
;

386 
out
 << "Ruby_cyşes: " << 
ruby_cyşes
 << 
’dl
;

387 
out
 << 
’dl
;

389 ià(!
shÜt_¡©s
) {

390 
out
 << "Busy CÚŒŞË¸CouÁs:" << 
’dl
;

391 
ušt32_t
 
i
 = 0; i < 
MachšeTy³_NUM
; i++) {

392 
ušt32_t
 
size
 = 
	`MachšeTy³_ba£_couÁ
((
MachšeTy³
)
i
);

394 
ušt32_t
 
j
 = 0; j < 
size
; j++) {

395 
MachšeID
 
machID
;

396 
machID
.
ty³
 = (
MachšeTy³
)
i
;

397 
machID
.
num
 = 
j
;

399 
Ab¡¿ùCÚŒŞËr
 *
ùr
 =

400 (*(
g_abs_cÚŒŞs
[
i
].
	`fšd
(
j
))).
£cÚd
;

401 
out
 << 
machID
 << ":" << 
ùr
->
	`g‘FuÎyBusyCyşes
() << " ";

402 ià((
j
 + 1) % 8 == 0) {

403 
out
 << 
’dl
;

406 
out
 << 
’dl
;

408 
out
 << 
’dl
;

410 
out
 << "Busy Bªk CouÁ:" << 
m_busyBªkCouÁ
 << 
’dl
;

411 
out
 << 
’dl
;

413 
	`´štOut¡ªdšgReqProfe
(
out
);

414 
out
 << 
’dl
;

417 ià(!
shÜt_¡©s
) {

418 
out
 << "AÎ NÚ-Z”ØCyşDemªd CachAcûs£s" << 
’dl
;

419 
out
 << "----------------------------------------" << 
’dl
;

420 
	`´štMissL©’cyProfe
(
out
);

422 ià(
m_®l_sh¬šg_hi¡og¿m
.
	`size
() > 0) {

423 
out
 << "®l_sh¬šg: " << 
m_®l_sh¬šg_hi¡og¿m
 << 
’dl
;

424 
out
 << "»ad_sh¬šg: " << 
m_»ad_sh¬šg_hi¡og¿m
 << 
’dl
;

425 
out
 << "wr™e_sh¬šg: " << 
m_wr™e_sh¬šg_hi¡og¿m
 << 
’dl
;

427 
out
 << "all_sharing_percent: ";

428 
m_®l_sh¬šg_hi¡og¿m
.
	`´štP”ûÁ
(
out
);

429 
out
 << 
’dl
;

431 
out
 << "read_sharing_percent: ";

432 
m_»ad_sh¬šg_hi¡og¿m
.
	`´štP”ûÁ
(
out
);

433 
out
 << 
’dl
;

435 
out
 << "write_sharing_percent: ";

436 
m_wr™e_sh¬šg_hi¡og¿m
.
	`´štP”ûÁ
(
out
);

437 
out
 << 
’dl
;

439 
št64
 
tÙ®_miss
 = 
m_ÿche_to_ÿche
 + 
m_memÜy_to_ÿche
;

440 
out
 << "®l_mis£s: " << 
tÙ®_miss
 << 
’dl
;

441 
out
 << "ÿche_to_ÿche_mis£s: " << 
m_ÿche_to_ÿche
 << 
’dl
;

442 
out
 << "memÜy_to_ÿche_mis£s: " << 
m_memÜy_to_ÿche
 << 
’dl
;

443 
out
 << "cache_to_cache_percent: "

444 << 100.0 * ((
m_ÿche_to_ÿche
è/ (
tÙ®_miss
))

445 << 
’dl
;

446 
out
 << "memory_to_cache_percent: "

447 << 100.0 * ((
m_memÜy_to_ÿche
è/ (
tÙ®_miss
))

448 << 
’dl
;

449 
out
 << 
’dl
;

452 
	`´štReque¡Profe
(
out
);

454 ià(!
m_®l_š¡ruùiÚs
) {

455 
m_add»ss_´of”_±r
->
	`´štSts
(
out
);

458 ià(
m_®l_š¡ruùiÚs
) {

459 
m_š¡_´of”_±r
->
	`´štSts
(
out
);

462 
out
 << 
’dl
;

463 
	`´štD–ayProfe
(
out
);

465 
	}
}

468 
	gProf”
::
	$ş—rSts
()

470 
m_ruby_¡¬t
 = 
g_sy¡em_±r
->
	`curCyşe
();

471 
m_»®_time_¡¬t_time
 = 
	`time
(
NULL
);

473 
m_busyBªkCouÁ
 = 0;

474 
m_»ad_sh¬šg_hi¡og¿m
.
	`ş—r
();

475 
m_wr™e_sh¬šg_hi¡og¿m
.
	`ş—r
();

476 
m_®l_sh¬šg_hi¡og¿m
.
	`ş—r
();

477 
m_ÿche_to_ÿche
 = 0;

478 
m_memÜy_to_ÿche
 = 0;

481 
m_ruby_¡¬t
 = 
g_sy¡em_±r
->
	`curCyşe
();

482 
	}
}

485 
	gProf”
::
	$addAdd»ssT¿ûSam¶e
(cÚ¡ 
RubyReque¡
& 
msg
, 
NodeID
 
id
)

487 ià(
msg
.
	`g‘Ty³
(è!ğ
RubyReque¡Ty³_IFETCH
) {

494 
m_add»ss_´of”_±r
->

495 
	`addT¿ûSam¶e
(
msg
.
	`g‘LšeAdd»ss
(), msg.
	`g‘Prog¿mCouÁ”
(),

496 
msg
.
	`g‘Ty³
(), msg.
	`g‘AcûssMode
(), 
id
, 
çl£
);

498 
	}
}

501 
	gProf”
::
	$´ofeSh¬šg
(cÚ¡ 
Add»ss
& 
addr
, 
AcûssTy³
 
ty³
,

502 
NodeID
 
»que¡Ü
, cÚ¡ 
S‘
& 
sh¬”s
,

503 cÚ¡ 
S‘
& 
owÃr
)

505 
S‘
 
	`£t_cÚùed
(
owÃr
);

506 ià(
ty³
 =ğ
AcûssTy³_Wr™e
) {

507 
£t_cÚùed
.
	`addS‘
(
sh¬”s
);

509 
£t_cÚùed
.
	`»move
(
»que¡Ü
);

510 
numb”_cÚùed
 = 
£t_cÚùed
.
	`couÁ
();

512 ià(
ty³
 =ğ
AcûssTy³_Wr™e
) {

513 
m_wr™e_sh¬šg_hi¡og¿m
.
	`add
(
numb”_cÚùed
);

515 
m_»ad_sh¬šg_hi¡og¿m
.
	`add
(
numb”_cÚùed
);

517 
m_®l_sh¬šg_hi¡og¿m
.
	`add
(
numb”_cÚùed
);

519 ià(
numb”_cÚùed
 == 0) {

520 
m_memÜy_to_ÿche
++;

522 
m_ÿche_to_ÿche
++;

524 
	}
}

527 
	gProf”
::
	$bªkBusy
()

529 
m_busyBªkCouÁ
++;

530 
	}
}

533 
	gProf”
::
	$rubyW©ch
(
id
)

535 
ušt64
 
Œ
 = 0;

536 
Add»ss
 
w©ch_add»ss
 = 
	`Add»ss
(
Œ
);

538 
	`DPRINTFN
("%7 %3 RUBY WATCH %d\n", 
g_sy¡em_±r
->
	`curCyşe
(), 
id
,

539 
w©ch_add»ss
);

542 
m_w©ch_add»ss_£t
.
	`š£¹
(
w©ch_add»ss
);

543 
	}
}

545 
boŞ


546 
	gProf”
::
	$w©chAdd»ss
(
Add»ss
 
addr
)

548  
m_w©ch_add»ss_£t
.
	`couÁ
(
addr
) > 0;

549 
	}
}

551 
Prof”
 *

552 
	gRubyProf”P¬ams
::
	$ü—‹
()

554  
Ãw
 
	`Prof”
(
this
);

555 
	}
}

	@ruby/profiler/Profiler.hh

45 #iâdeà
__MEM_RUBY_PROFILER_PROFILER_HH__


46 
	#__MEM_RUBY_PROFILER_PROFILER_HH__


	)

48 
	~<io¡»am
>

49 
	~<m­
>

50 
	~<¡ršg
>

51 
	~<veùÜ
>

53 
	~"ba£/hashm­.hh
"

54 
	~"mem/´ÙocŞ/AcûssTy³.hh
"

55 
	~"mem/´ÙocŞ/P»ãtchB™.hh
"

56 
	~"mem/´ÙocŞ/RubyAcûssMode.hh
"

57 
	~"mem/´ÙocŞ/RubyReque¡Ty³.hh
"

58 
	~"mem/ruby/commÚ/Add»ss.hh
"

59 
	~"mem/ruby/commÚ/Glob®.hh
"

60 
	~"mem/ruby/commÚ/Hi¡og¿m.hh
"

61 
	~"mem/ruby/commÚ/S‘.hh
"

62 
	~"mem/ruby/sy¡em/MachšeID.hh
"

63 
	~"mem/ruby/sy¡em/MemÜyCÚŒŞ.hh
"

64 
	~"·¿ms/RubyProf”.hh
"

65 
	~"sim/sim_objeù.hh
"

67 
şass
 
	gRubyReque¡
;

68 
şass
 
	gAdd»ssProf”
;

70 şas 
	cProf”
 : 
public
 
SimObjeù


72 
public
:

73 
RubyProf”P¬ams
 
	tP¬ams
;

74 
Prof”
(cÚ¡ 
P¬ams
 *);

75 ~
Prof”
();

77 
wakeup
();

79 
£tP”iodicStsFe
(cÚ¡ 
¡d
::
¡ršg
& 
f’ame
);

80 
£tP”iodicStsIÁ”v®
(
št64_t
 
³riod
);

82 
´štSts
(
¡d
::
o¡»am
& 
out
, 
boŞ
 
shÜt_¡©s
=
çl£
);

83 
´štShÜtSts
(
¡d
::
o¡»am
& 
out
è{ 
´štSts
(out, 
Œue
); }

84 
´štT¿ûSts
(
¡d
::
o¡»am
& 
out
) const;

85 
ş—rSts
();

86 
´štResourûU§ge
(
¡d
::
o¡»am
& 
out
) const;

88 
Add»ssProf”
* 
	$g‘Add»ssProf”
(è{  
m_add»ss_´of”_±r
; 
	}
}

89 
Add»ssProf”
* 
	$g‘In¡ruùiÚProf”
(è{  
m_š¡_´of”_±r
; 
	}
}

91 
addAdd»ssT¿ûSam¶e
(cÚ¡ 
RubyReque¡
& 
msg
, 
NodeID
 
id
);

93 
´ofeReque¡
(cÚ¡ 
¡d
::
¡ršg
& 
»que¡SŒ
);

94 
´ofeSh¬šg
(cÚ¡ 
Add»ss
& 
addr
, 
AcûssTy³
 
ty³
,

95 
NodeID
 
»que¡Ü
, cÚ¡ 
S‘
& 
sh¬”s
,

96 cÚ¡ 
S‘
& 
owÃr
);

98 
´ofeMuÉiÿ¡R‘ry
(cÚ¡ 
Add»ss
& 
addr
, 
couÁ
);

100 
´ofeF‹rAùiÚ
(
aùiÚ
);

102 
´ofeCÚæiùšgReque¡s
(cÚ¡ 
Add»ss
& 
addr
);

105 
	$´ofeAv”ageL©’cyE¡im©e
(
Ï‹ncy
)

107 
m_av”age_Ï‹ncy_e¡im©e
.
	`add
(
Ï‹ncy
);

108 
	}
}

110 
cÚŒŞËrBusy
(
MachšeID
 
machID
);

111 
bªkBusy
();

113 
´št
(
¡d
::
o¡»am
& 
out
) const;

115 
rubyW©ch
(
´oc
);

116 
boŞ
 
w©chAdd»ss
(
Add»ss
 
addr
);

119 
Cyşes
 
	$g‘RubyS¹Time
(è{  
m_ruby_¡¬t
; 
	}
}

122 
boŞ
 
	$g‘HÙLšes
(è{  
m_hÙ_lšes
; 
	}
}

123 
boŞ
 
	$g‘AÎIn¡ruùiÚs
(è{  
m_®l_š¡ruùiÚs
; 
	}
}

125 
	g´iv©e
:

126 
´štReque¡Profe
(
¡d
::
o¡»am
 &
out
) const;

127 
´štD–ayProfe
(
¡d
::
o¡»am
 &
out
) const;

128 
´štOut¡ªdšgReqProfe
(
¡d
::
o¡»am
 &
out
) const;

129 
´štMissL©’cyProfe
(
¡d
::
o¡»am
 &
out
) const;

131 
	g´iv©e
:

133 
Prof”
(cÚ¡ Prof”& 
obj
);

134 
	gProf”
& 
	gİ”©Ü
=(cÚ¡ 
Prof”
& 
obj
);

136 
Add»ssProf”
* 
	gm_add»ss_´of”_±r
;

137 
Add»ssProf”
* 
	gm_š¡_´of”_±r
;

139 
Cyşes
 
	gm_ruby_¡¬t
;

140 
time_t
 
	gm_»®_time_¡¬t_time
;

142 
št64_t
 
	gm_busyBªkCouÁ
;

144 
Hi¡og¿m
 
	gm_»ad_sh¬šg_hi¡og¿m
;

145 
Hi¡og¿m
 
	gm_wr™e_sh¬šg_hi¡og¿m
;

146 
Hi¡og¿m
 
	gm_®l_sh¬šg_hi¡og¿m
;

147 
št64
 
	gm_ÿche_to_ÿche
;

148 
št64
 
	gm_memÜy_to_ÿche
;

150 
Hi¡og¿m
 
	gm_av”age_Ï‹ncy_e¡im©e
;

151 
	gm5
::
hash_£t
<
Add»ss
> 
m_w©ch_add»ss_£t
;

154 
boŞ
 
	gm_hÙ_lšes
;

155 
boŞ
 
	gm_®l_š¡ruùiÚs
;

157 
	gm_num_of_£qu’ûrs
;

160 
šlše
 
	g¡d
::
o¡»am
&

161 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gProf”
& 
	gobj
)

163 
	gobj
.
´št
(
out
);

164 
	gout
 << 
	g¡d
::
æush
;

165  
	gout
;

	@ruby/profiler/StoreTrace.cc

29 
	~"mem/ruby/´of”/StÜeT¿û.hh
"

30 
	~"sim/cÜe.hh
"

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 
boŞ
 
	gStÜeT¿û
::
s_š™
 = 
çl£
;

36 
št64
 
	gStÜeT¿û
::
s_tÙ®_§m¶es
 = 0;

38 
Hi¡og¿m
* 
	gStÜeT¿û
::
s_¡Üe_couÁ_±r
 = 
NULL
;

39 
Hi¡og¿m
* 
	gStÜeT¿û
::
s_¡Üe_fœ¡_to_¡Ş’_±r
 = 
NULL
;

40 
Hi¡og¿m
* 
	gStÜeT¿û
::
s_¡Üe_Ï¡_to_¡Ş’_±r
 = 
NULL
;

41 
Hi¡og¿m
* 
	gStÜeT¿û
::
s_¡Üe_fœ¡_to_Ï¡_±r
 = 
NULL
;

43 
	gStÜeT¿û
::
	$StÜeT¿û
(cÚ¡ 
Add»ss
& 
addr
)

44 : 
	`m_¡Üe_couÁ
(-1), 
	`m_¡Üe_fœ¡_to_¡Ş’
(-1),

45 
	`m_¡Üe_Ï¡_to_¡Ş’
(-1), 
	`m_¡Üe_fœ¡_to_Ï¡
(-1)

47 
StÜeT¿û
::
	`š™Summ¬y
();

48 
m_addr
 = 
addr
;

49 
m_tÙ®_§m¶es
 = 0;

52 
m_Ï¡_wr™”
 = -1;

53 
m_¡Ües_this_š‹rv®
 = 0;

54 
	}
}

56 
	gStÜeT¿û
::~
	$StÜeT¿û
()

58 
	}
}

61 
StÜeT¿û
::
	$´št
(
o¡»am
& 
out
) const

63 
out
 << 
m_addr


64 << "Ù®_§m¶es: " << 
m_tÙ®_§m¶es
 << 
’dl


65 << "¡Üe_couÁ: " << 
m_¡Üe_couÁ
 << 
’dl


66 << "¡Üe_fœ¡_to_¡Ş’: " << 
m_¡Üe_fœ¡_to_¡Ş’
 << 
’dl


67 << "¡Üe_Ï¡_to_¡Ş’: " << 
m_¡Üe_Ï¡_to_¡Ş’
 << 
’dl


68 << "¡Üe_fœ¡_to_Ï¡: " << 
m_¡Üe_fœ¡_to_Ï¡
 << 
’dl
;

69 
	}
}

72 
	gStÜeT¿û
::
	$š™Summ¬y
()

74 ià(!
s_š™
) {

75 
s_tÙ®_§m¶es
 = 0;

76 
s_¡Üe_couÁ_±r
 = 
Ãw
 
	`Hi¡og¿m
(-1);

77 
s_¡Üe_fœ¡_to_¡Ş’_±r
 = 
Ãw
 
	`Hi¡og¿m
(-1);

78 
s_¡Üe_Ï¡_to_¡Ş’_±r
 = 
Ãw
 
	`Hi¡og¿m
(-1);

79 
s_¡Üe_fœ¡_to_Ï¡_±r
 = 
Ãw
 
	`Hi¡og¿m
(-1);

81 
s_š™
 = 
Œue
;

82 
	}
}

85 
	gStÜeT¿û
::
	$´štSumm¬y
(
o¡»am
& 
out
)

87 
out
 << "tÙ®_§m¶es: " << 
s_tÙ®_§m¶es
 << 
’dl
;

88 
out
 << "¡Üe_couÁ: " << (*
s_¡Üe_couÁ_±r
è<< 
’dl
;

89 
out
 << "¡Üe_fœ¡_to_¡Ş’: " << (*
s_¡Üe_fœ¡_to_¡Ş’_±r
è<< 
’dl
;

90 
out
 << "¡Üe_Ï¡_to_¡Ş’: " << (*
s_¡Üe_Ï¡_to_¡Ş’_±r
è<< 
’dl
;

91 
out
 << "¡Üe_fœ¡_to_Ï¡: " << (*
s_¡Üe_fœ¡_to_Ï¡_±r
è<< 
’dl
;

92 
	}
}

95 
	gStÜeT¿û
::
	$ş—rSumm¬y
()

97 
StÜeT¿û
::
	`š™Summ¬y
();

98 
s_tÙ®_§m¶es
 = 0;

99 
s_¡Üe_couÁ_±r
->
	`ş—r
();

100 
s_¡Üe_fœ¡_to_¡Ş’_±r
->
	`ş—r
();

101 
s_¡Üe_Ï¡_to_¡Ş’_±r
->
	`ş—r
();

102 
s_¡Üe_fœ¡_to_Ï¡_±r
->
	`ş—r
();

103 
	}
}

106 
	gStÜeT¿û
::
	$¡Üe
(
NodeID
 
node
)

108 
Tick
 
cu¼’t
 = 
	`curTick
();

110 
	`as£¹
((
m_Ï¡_wr™”
 =ğ-1è|| (m_Ï¡_wr™” =ğ
node
));

112 
m_Ï¡_wr™”
 = 
node
;

113 ià(
m_Ï¡_wr™”
 == -1) {

114 
	`as£¹
(
m_¡Ües_this_š‹rv®
 == 0);

117 ià(
m_¡Ües_this_š‹rv®
 == 0) {

119 
m_fœ¡_¡Üe
 = 
cu¼’t
;

122 
m_Ï¡_¡Üe
 = 
cu¼’t
;

123 
m_¡Ües_this_š‹rv®
++;

124 
	}
}

127 
	gStÜeT¿û
::
	$downg¿de
(
NodeID
 
node
)

129 ià(
node
 =ğ
m_Ï¡_wr™”
) {

130 
Time
 
cu¼’t
 = 
	`curTick
();

131 
	`as£¹
(
m_¡Ües_this_š‹rv®
 != 0);

132 
	`as£¹
(
m_Ï¡_¡Üe
 != 0);

133 
	`as£¹
(
m_fœ¡_¡Üe
 != 0);

134 
	`as£¹
(
m_Ï¡_wr™”
 != -1);

137 
m_¡Üe_fœ¡_to_¡Ş’
.
	`add
(
cu¼’t
 - 
m_fœ¡_¡Üe
);

138 
m_¡Üe_couÁ
.
	`add
(
m_¡Ües_this_š‹rv®
);

139 
m_¡Üe_Ï¡_to_¡Ş’
.
	`add
(
cu¼’t
 - 
m_Ï¡_¡Üe
);

140 
m_¡Üe_fœ¡_to_Ï¡
.
	`add
(
m_Ï¡_¡Üe
 - 
m_fœ¡_¡Üe
);

141 
m_tÙ®_§m¶es
++;

144 
	`as£¹
(
s_¡Üe_fœ¡_to_¡Ş’_±r
 !ğ
NULL
);

145 
s_¡Üe_fœ¡_to_¡Ş’_±r
->
	`add
(
cu¼’t
 - 
m_fœ¡_¡Üe
);

146 
s_¡Üe_couÁ_±r
->
	`add
(
m_¡Ües_this_š‹rv®
);

147 
s_¡Üe_Ï¡_to_¡Ş’_±r
->
	`add
(
cu¼’t
 - 
m_Ï¡_¡Üe
);

148 
s_¡Üe_fœ¡_to_Ï¡_±r
->
	`add
(
m_Ï¡_¡Üe
 - 
m_fœ¡_¡Üe
);

149 
s_tÙ®_§m¶es
++;

152 
m_¡Ües_this_š‹rv®
 = 0;

153 
m_Ï¡_¡Üe
 = 0;

154 
m_fœ¡_¡Üe
 = 0;

155 
m_Ï¡_wr™”
 = -1;

157 
	}
}

	@ruby/profiler/StoreTrace.hh

29 #iâdeà
__MEM_RUBY_PROFILER_STORETRACE_HH__


30 
	#__MEM_RUBY_PROFILER_STORETRACE_HH__


	)

32 
	~<io¡»am
>

34 
	~"mem/ruby/commÚ/Add»ss.hh
"

35 
	~"mem/ruby/commÚ/Hi¡og¿m.hh
"

37 şas 
	cStÜeT¿û


39 
	mpublic
:

40 
	$StÜeT¿û
() { }

41 
ex¶ic™
 
	`StÜeT¿û
(cÚ¡ 
Add»ss
& 
addr
);

42 ~
	`StÜeT¿û
();

44 
	`¡Üe
(
NodeID
 
node
);

45 
	`downg¿de
(
NodeID
 
node
);

46 
	$g‘TÙ®
(ècÚ¡ {  
m_tÙ®_§m¶es
; 
	}
}

47 
š™Summ¬y
();

48 
´štSumm¬y
(
¡d
::
o¡»am
& 
out
);

49 
ş—rSumm¬y
();

51 
´št
(
¡d
::
o¡»am
& 
out
) const;

53 
	g´iv©e
:

54 
boŞ
 
s_š™
;

55 
št64
 
	gs_tÙ®_§m¶es
;

57 
Hi¡og¿m
* 
	gs_¡Üe_couÁ_±r
;

58 
Hi¡og¿m
* 
	gs_¡Üe_fœ¡_to_¡Ş’_±r
;

59 
Hi¡og¿m
* 
	gs_¡Üe_Ï¡_to_¡Ş’_±r
;

60 
Hi¡og¿m
* 
	gs_¡Üe_fœ¡_to_Ï¡_±r
;

62 
Add»ss
 
	gm_addr
;

63 
NodeID
 
	gm_Ï¡_wr™”
;

64 
Time
 
	gm_fœ¡_¡Üe
;

65 
Time
 
	gm_Ï¡_¡Üe
;

66 
	gm_¡Ües_this_š‹rv®
;

68 
št64
 
	gm_tÙ®_§m¶es
;

69 
Hi¡og¿m
 
	gm_¡Üe_couÁ
;

70 
Hi¡og¿m
 
	gm_¡Üe_fœ¡_to_¡Ş’
;

71 
Hi¡og¿m
 
	gm_¡Üe_Ï¡_to_¡Ş’
;

72 
Hi¡og¿m
 
	gm_¡Üe_fœ¡_to_Ï¡
;

75 
šlše
 
boŞ


76 
	$node_Ëss_th’_eq
(cÚ¡ 
StÜeT¿û
* 
n1
, cÚ¡ StÜeT¿û* 
n2
)

78  
n1
->
	`g‘TÙ®
(è> 
n2
->getTotal();

79 
	}
}

81 
šlše
 
	g¡d
::
o¡»am
&

82 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gStÜeT¿û
& 
	gobj
)

84 
	gobj
.
´št
(
out
);

85 
	gout
 << 
	g¡d
::
æush
;

86  
	gout
;

	@ruby/recorder/CacheRecorder.cc

30 
	~"debug/RubyCacheT¿û.hh
"

31 
	~"mem/ruby/»cÜd”/CacheRecÜd”.hh
"

32 
	~"mem/ruby/sy¡em/Sequ’ûr.hh
"

33 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

35 
usšg
 
Çme¥aû
 
	g¡d
;

38 
	gT¿ûRecÜd
::
	$´št
(
o¡»am
& 
out
) const

40 
out
 << "[T¿ûRecÜd: Node, " << 
m_úŒl_id
 << ", "

41 << 
m_d©a_add»ss
 << ", " << 
m_pc_add»ss
 << ", "

42 << 
m_ty³
 << ", Time: " << 
m_time
 << "]";

43 
	}
}

45 
	gCacheRecÜd”
::
	$CacheRecÜd”
()

46 : 
	`m_uncom´es£d_Œaû
(
NULL
),

47 
	$m_uncom´es£d_Œaû_size
(0)

49 
	}
}

51 
	gCacheRecÜd”
::
CacheRecÜd”
(
ušt8_t
* 
uncom´es£d_Œaû
,

52 
ušt64_t
 
uncom´es£d_Œaû_size
,

53 
¡d
::
veùÜ
<
Sequ’ûr
*>& 
£q_m­
)

54 : 
m_uncom´es£d_Œaû
(
uncom´es£d_Œaû
),

55 
m_uncom´es£d_Œaû_size
(
uncom´es£d_Œaû_size
),

56 
m_£q_m­
(
£q_m­
), 
m_by‹s_»ad
(0), 
m_»cÜds_»ad
(0),

57 
	$m_»cÜds_æushed
(0)

59 
	}
}

61 
	gCacheRecÜd”
::~
	$CacheRecÜd”
()

63 ià(
m_uncom´es£d_Œaû
 !ğ
NULL
) {

64 
d–‘e
 [] 
m_uncom´es£d_Œaû
;

65 
m_uncom´es£d_Œaû
 = 
NULL
;

67 
m_£q_m­
.
	`ş—r
();

68 
	}
}

71 
	gCacheRecÜd”
::
	$’queueNextFlushReque¡
()

73 ià(
m_»cÜds_æushed
 < 
m_»cÜds
.
	`size
()) {

74 
T¿ûRecÜd
* 
»c
 = 
m_»cÜds
[
m_»cÜds_æushed
];

75 
m_»cÜds_æushed
++;

76 
Reque¡
* 
»q
 = 
Ãw
 
	`Reque¡
(
»c
->
m_d©a_add»ss
,

77 
RubySy¡em
::
	`g‘BlockSizeBy‹s
(),0,

78 
Reque¡
::
funcMa¡”Id
);

79 
MemCmd
::
Commªd
 
»que¡Ty³
 = MemCmd::
FlushReq
;

80 
Pack‘
 *
pkt
 = 
Ãw
 
	`Pack‘
(
»q
, 
»que¡Ty³
);

82 
Sequ’ûr
* 
m_£qu’ûr_±r
 = 
m_£q_m­
[
»c
->
m_úŒl_id
];

83 
	`as£¹
(
m_£qu’ûr_±r
 !ğ
NULL
);

84 
m_£qu’ûr_±r
->
	`makeReque¡
(
pkt
);

86 
	`DPRINTF
(
RubyCacheT¿û
, "Flushšg %s\n", *
»c
);

88 
	}
}

91 
	gCacheRecÜd”
::
	$’queueNextF‘chReque¡
()

93 ià(
m_by‹s_»ad
 < 
m_uncom´es£d_Œaû_size
) {

94 
T¿ûRecÜd
* 
ŒaûRecÜd
 = (T¿ûRecÜd*è(
m_uncom´es£d_Œaû
 +

95 
m_by‹s_»ad
);

97 
	`DPRINTF
(
RubyCacheT¿û
, "Issušg %s\n", *
ŒaûRecÜd
);

98 
Reque¡
* 
»q
 = 
Ãw
 
	`Reque¡
();

99 
MemCmd
::
Commªd
 
»que¡Ty³
;

101 ià(
ŒaûRecÜd
->
m_ty³
 =ğ
RubyReque¡Ty³_LD
) {

102 
»que¡Ty³
 = 
MemCmd
::
R—dReq
;

103 
»q
->
	`£tPhys
(
ŒaûRecÜd
->
m_d©a_add»ss
,

104 
RubySy¡em
::
	`g‘BlockSizeBy‹s
(),0, 
Reque¡
::
funcMa¡”Id
);

105 } ià(
ŒaûRecÜd
->
m_ty³
 =ğ
RubyReque¡Ty³_IFETCH
) {

106 
»que¡Ty³
 = 
MemCmd
::
R—dReq
;

107 
»q
->
	`£tPhys
(
ŒaûRecÜd
->
m_d©a_add»ss
,

108 
RubySy¡em
::
	`g‘BlockSizeBy‹s
(),

109 
Reque¡
::
INST_FETCH
, Reque¡::
funcMa¡”Id
);

111 
»que¡Ty³
 = 
MemCmd
::
Wr™eReq
;

112 
»q
->
	`£tPhys
(
ŒaûRecÜd
->
m_d©a_add»ss
,

113 
RubySy¡em
::
	`g‘BlockSizeBy‹s
(),0, 
Reque¡
::
funcMa¡”Id
);

116 
Pack‘
 *
pkt
 = 
Ãw
 
	`Pack‘
(
»q
, 
»que¡Ty³
);

117 
pkt
->
	`d©aStic
(
ŒaûRecÜd
->
m_d©a
);

119 
Sequ’ûr
* 
m_£qu’ûr_±r
 = 
m_£q_m­
[
ŒaûRecÜd
->
m_úŒl_id
];

120 
	`as£¹
(
m_£qu’ûr_±r
 !ğ
NULL
);

121 
m_£qu’ûr_±r
->
	`makeReque¡
(
pkt
);

123 
m_by‹s_»ad
 +ğ((
T¿ûRecÜd
) +

124 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

125 
m_»cÜds_»ad
++;

127 
	}
}

130 
	gCacheRecÜd”
::
	$addRecÜd
(
úŒl
, cÚ¡ 
physiÿl_add»ss_t
 
d©a_addr
,

131 cÚ¡ 
physiÿl_add»ss_t
 
pc_addr
,

132 
RubyReque¡Ty³
 
ty³
, 
Time
 
time
, 
D©aBlock
& 
d©a
)

134 
T¿ûRecÜd
* 
»c
 = (T¿ûRecÜd*)
	`m®loc
((TraceRecord) +

135 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

136 
»c
->
m_úŒl_id
 = 
úŒl
;

137 
»c
->
m_time
 = 
time
;

138 
»c
->
m_d©a_add»ss
 = 
d©a_addr
;

139 
»c
->
m_pc_add»ss
 = 
pc_addr
;

140 
»c
->
m_ty³
 = 
ty³
;

141 
	`memıy
(
»c
->
m_d©a
, 
d©a
.
	`g‘D©a
(0, 
RubySy¡em
::
	`g‘BlockSizeBy‹s
()),

142 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

144 
m_»cÜds
.
	`push_back
(
»c
);

145 
	}
}

147 
ušt64


148 
	gCacheRecÜd”
::
	$agg»g©eRecÜds
(
ušt8_t
** 
buf
, 
ušt64
 
tÙ®_size
)

150 
¡d
::
	`sÜt
(
m_»cÜds
.
	`begš
(), m_»cÜds.
	`’d
(), 
com·»T¿ûRecÜds
);

152 
size
 = 
m_»cÜds
.
	`size
();

153 
ušt64
 
cu¼’t_size
 = 0;

154 
»cÜd_size
 = (
T¿ûRecÜd
è+ 
RubySy¡em
::
	`g‘BlockSizeBy‹s
();

156 
i
 = 0; i < 
size
; ++i) {

158 ià(
cu¼’t_size
 + 
»cÜd_size
 > 
tÙ®_size
) {

159 
ušt8_t
* 
Ãw_buf
 = 
	`Ãw
 (
nÙhrow
èušt8_t[
tÙ®_size
 * 2];

160 ià(
Ãw_buf
 =ğ
NULL
) {

161 
	`çl
("Unableo‡llocate buffer of size %s\n",

162 
tÙ®_size
 * 2);

164 
tÙ®_size
 =otal_size * 2;

165 
ušt8_t
* 
Şd_buf
 = *
buf
;

166 
	`memıy
(
Ãw_buf
, 
Şd_buf
, 
cu¼’t_size
);

167 *
buf
 = 
Ãw_buf
;

168 
d–‘e
 [] 
Şd_buf
;

172 
	`memıy
(&((*
buf
)[
cu¼’t_size
]), 
m_»cÜds
[
i
], 
»cÜd_size
);

173 
cu¼’t_size
 +ğ
»cÜd_size
;

175 
	`ä“
(
m_»cÜds
[
i
]);

176 
m_»cÜds
[
i
] = 
NULL
;

179 
m_»cÜds
.
	`ş—r
();

180  
cu¼’t_size
;

181 
	}
}

	@ruby/recorder/CacheRecorder.hh

35 #iâdeà
__MEM_RUBY_RECORDER_CACHERECORDER_HH__


36 
	#__MEM_RUBY_RECORDER_CACHERECORDER_HH__


	)

38 
	~<veùÜ
>

40 
	~"ba£/hashm­.hh
"

41 
	~"mem/´ÙocŞ/RubyReque¡Ty³.hh
"

42 
	~"mem/ruby/commÚ/Add»ss.hh
"

43 
	~"mem/ruby/commÚ/D©aBlock.hh
"

44 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

46 
şass
 
	gSequ’ûr
;

54 şas 
	cT¿ûRecÜd
 {

55 
	mpublic
:

56 
m_úŒl_id
;

57 
Time
 
	mm_time
;

58 
physiÿl_add»ss_t
 
	mm_d©a_add»ss
;

59 
physiÿl_add»ss_t
 
	mm_pc_add»ss
;

60 
RubyReque¡Ty³
 
	mm_ty³
;

61 
ušt8_t
 
	mm_d©a
[0];

63 
´št
(
¡d
::
o¡»am
& 
out
) const;

66 şas 
	cCacheRecÜd”


68 
	mpublic
:

69 
CacheRecÜd”
();

70 ~
CacheRecÜd”
();

72 
CacheRecÜd”
(
ušt8_t
* 
uncom´es£d_Œaû
,

73 
ušt64_t
 
uncom´es£d_Œaû_size
,

74 
¡d
::
veùÜ
<
Sequ’ûr
*>& 
Sequ’ûrM­
);

75 
addRecÜd
(
úŒl
, cÚ¡ 
physiÿl_add»ss_t
 
d©a_addr
,

76 cÚ¡ 
physiÿl_add»ss_t
 
pc_addr
, 
RubyReque¡Ty³
 
ty³
,

77 
Time
 
time
, 
D©aBlock
& 
d©a
);

79 
ušt64
 
agg»g©eRecÜds
(
ušt8_t
** 
d©a
, ušt64 
size
);

89 
’queueNextFlushReque¡
();

98 
’queueNextF‘chReque¡
();

100 
	m´iv©e
:

102 
CacheRecÜd”
(cÚ¡ CacheRecÜd”& 
obj
);

103 
	mCacheRecÜd”
& 
	mİ”©Ü
=(cÚ¡ 
CacheRecÜd”
& 
obj
);

105 
	m¡d
::
veùÜ
<
T¿ûRecÜd
*> 
m_»cÜds
;

106 
ušt8_t
* 
	mm_uncom´es£d_Œaû
;

107 
ušt64_t
 
	mm_uncom´es£d_Œaû_size
;

108 
	m¡d
::
veùÜ
<
Sequ’ûr
*> 
m_£q_m­
;

109 
ušt64_t
 
	mm_by‹s_»ad
;

110 
ušt64_t
 
	mm_»cÜds_»ad
;

111 
ušt64_t
 
	mm_»cÜds_æushed
;

114 
šlše
 
boŞ


115 
	$com·»T¿ûRecÜds
(cÚ¡ 
T¿ûRecÜd
* 
n1
, cÚ¡ T¿ûRecÜd* 
n2
)

117  
n1
->
m_time
 > 
n2
->m_time;

118 
	}
}

120 
šlše
 
	g¡d
::
o¡»am
&

121 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gT¿ûRecÜd
& 
	gobj
)

123 
	gobj
.
´št
(
out
);

124 
	gout
 << 
	g¡d
::
æush
;

125  
	gout
;

	@ruby/slicc_interface/AbstractCacheEntry.cc

29 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùCacheEÁry.hh
"

31 
	gAb¡¿ùCacheEÁry
::
	$Ab¡¿ùCacheEÁry
()

33 
m_P”missiÚ
 = 
AcûssP”missiÚ_NÙP»£Á
;

34 
m_Add»ss
.
	`£tAdd»ss
(0);

35 
m_locked
 = -1;

36 
	}
}

38 
	gAb¡¿ùCacheEÁry
::~
	$Ab¡¿ùCacheEÁry
()

40 
	}
}

43 
Ab¡¿ùCacheEÁry
::
	$chªgeP”missiÚ
(
AcûssP”missiÚ
 
Ãw_³rm
)

45 
Ab¡¿ùEÁry
::
	`chªgeP”missiÚ
(
Ãw_³rm
);

46 ià((
Ãw_³rm
 =ğ
AcûssP”missiÚ_Inv®id
) ||

47 (
Ãw_³rm
 =ğ
AcûssP”missiÚ_NÙP»£Á
)) {

48 
m_locked
 = -1;

50 
	}
}

	@ruby/slicc_interface/AbstractCacheEntry.hh

33 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_ABSTRACTCACHEENTRY_HH__


34 
	#__MEM_RUBY_SLICC_INTERFACE_ABSTRACTCACHEENTRY_HH__


	)

36 
	~<io¡»am
>

38 
	~"mem/´ÙocŞ/AcûssP”missiÚ.hh
"

39 
	~"mem/ruby/commÚ/Add»ss.hh
"

40 
	~"mem/ruby/commÚ/Glob®.hh
"

41 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùEÁry.hh
"

43 
şass
 
	gD©aBlock
;

45 şas 
	cAb¡¿ùCacheEÁry
 : 
public
 
Ab¡¿ùEÁry


47 
public
:

48 
Ab¡¿ùCacheEÁry
();

49 
	mvœtu®
 ~
Ab¡¿ùCacheEÁry
() = 0;

52 
chªgeP”missiÚ
(
AcûssP”missiÚ
 
Ãw_³rm
);

54 
Add»ss
 
	mm_Add»ss
;

55 
	mm_locked
;

59 
šlše
 
	g¡d
::
o¡»am
&

60 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gAb¡¿ùCacheEÁry
& 
	gobj
)

62 
	gobj
.
´št
(
out
);

63 
	gout
 << 
	g¡d
::
æush
;

64  
	gout
;

	@ruby/slicc_interface/AbstractController.cc

29 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùCÚŒŞËr.hh
"

30 
	~"mem/ruby/sy¡em/Sequ’ûr.hh
"

31 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

33 
	gAb¡¿ùCÚŒŞËr
::
	$Ab¡¿ùCÚŒŞËr
(cÚ¡ 
P¬ams
 *
p
)

34 : 
	`ClockedObjeù
(
p
), 
	`CÚsum”
(
this
), 
	`m_fuÎy_busy_cyşes
(0),

35 
	$m_»que¡_couÁ
(0)

37 
m_v”siÚ
 = 
p
->
v”siÚ
;

38 
m_şu¡”ID
 = 
p
->
şu¡”_id
;

40 
m_Œªs™iÚs_³r_cyşe
 = 
p
->
Œªs™iÚs_³r_cyşe
;

41 
m_bufãr_size
 = 
p
->
bufãr_size
;

42 
m_»cyşe_Ï‹ncy
 = 
p
->
»cyşe_Ï‹ncy
;

43 
m_numb”_of_TBEs
 = 
p
->
numb”_of_TBEs
;

44 
m_is_blockšg
 = 
çl£
;

46 ià(
m_v”siÚ
 == 0) {

49 
Sts
::
	`»gi¡”DumpC®lback
(
Ãw
 
	`StsC®lback
(
this
));

51 
	}
}

54 
	gAb¡¿ùCÚŒŞËr
::
	$š™
()

56 
	`·¿ms
()->
ruby_sy¡em
->
	`»gi¡”Ab¡¿ùCÚŒŞËr
(
this
);

57 
	}
}

60 
	gAb¡¿ùCÚŒŞËr
::
	$ş—rSts
()

62 
m_»que¡ProfeM­
.
	`ş—r
();

63 
m_»que¡_couÁ
 = 0;

65 
m_d–ayHi¡og¿m
.
	`ş—r
();

67 
ušt32_t
 
size
 = 
N‘wÜk
::
	`g‘Numb”OfVœtu®N‘wÜks
();

68 
m_d–ayVCHi¡og¿m
.
	`»size
(
size
);

69 
ušt32_t
 
i
 = 0; i < 
size
; i++) {

70 
m_d–ayVCHi¡og¿m
[
i
].
	`ş—r
();

73 
Sequ’ûr
 *
£q
 = 
	`g‘Sequ’ûr
();

74 ià(
£q
 !ğ
NULL
) {

75 
£q
->
	`ş—rSts
();

77 
	}
}

80 
	gAb¡¿ùCÚŒŞËr
::
´ofeReque¡
(cÚ¡ 
¡d
::
¡ršg
 &
»que¡
)

82 
m_»que¡_couÁ
++;

86 
	gm_»que¡ProfeM­
[
»que¡
]++;

90 
	gAb¡¿ùCÚŒŞËr
::
	$´ofeMsgD–ay
(
ušt32_t
 
vœtu®N‘wÜk
, 
Cyşes
 
d–ay
)

92 
	`as£¹
(
vœtu®N‘wÜk
 < 
m_d–ayVCHi¡og¿m
.
	`size
());

93 
m_d–ayHi¡og¿m
.
	`add
(
d–ay
);

94 
m_d–ayVCHi¡og¿m
[
vœtu®N‘wÜk
].
	`add
(
d–ay
);

95 
	}
}

98 
	gAb¡¿ùCÚŒŞËr
::
	$cÚÃùW™hP“r
(
Ab¡¿ùCÚŒŞËr
 *
c
)

100 
	`g‘QueuesFromP“r
(
c
);

101 
c
->
	`g‘QueuesFromP“r
(
this
);

102 
	}
}

105 
	gAb¡¿ùCÚŒŞËr
::
	$¡®lBufãr
(
Mes§geBufãr
* 
buf
, 
Add»ss
 
addr
)

107 ià(
m_wa™šg_bufãrs
.
	`couÁ
(
addr
) == 0) {

108 
MsgVecTy³
* 
msgVec
 = 
Ãw
 MsgVecType;

109 
msgVec
->
	`»size
(
m_š_pÜts
, 
NULL
);

110 
m_wa™šg_bufãrs
[
addr
] = 
msgVec
;

112 (*(
m_wa™šg_bufãrs
[
addr
]))[
m_cur_š_pÜt
] = 
buf
;

113 
	}
}

116 
	gAb¡¿ùCÚŒŞËr
::
	$wakeUpBufãrs
(
Add»ss
 
addr
)

118 ià(
m_wa™šg_bufãrs
.
	`couÁ
(
addr
) > 0) {

123 
š_pÜt_¿nk
 = 
m_cur_š_pÜt
 - 1;

124 
š_pÜt_¿nk
 >= 0;

125 
š_pÜt_¿nk
--) {

126 ià((*(
m_wa™šg_bufãrs
[
addr
]))[
š_pÜt_¿nk
] !ğ
NULL
) {

127 (*(
m_wa™šg_bufãrs
[
addr
]))[
š_pÜt_¿nk
]->
	`»ª®yzeMes§ges
(addr);

130 
d–‘e
 
m_wa™šg_bufãrs
[
addr
];

131 
m_wa™šg_bufãrs
.
	`”a£
(
addr
);

133 
	}
}

136 
	gAb¡¿ùCÚŒŞËr
::
	$wakeUpAÎBufãrs
(
Add»ss
 
addr
)

138 ià(
m_wa™šg_bufãrs
.
	`couÁ
(
addr
) > 0) {

143 
š_pÜt_¿nk
 = 
m_š_pÜts
 - 1;

144 
š_pÜt_¿nk
 >= 0;

145 
š_pÜt_¿nk
--) {

146 ià((*(
m_wa™šg_bufãrs
[
addr
]))[
š_pÜt_¿nk
] !ğ
NULL
) {

147 (*(
m_wa™šg_bufãrs
[
addr
]))[
š_pÜt_¿nk
]->
	`»ª®yzeMes§ges
(addr);

150 
d–‘e
 
m_wa™šg_bufãrs
[
addr
];

151 
m_wa™šg_bufãrs
.
	`”a£
(
addr
);

153 
	}
}

156 
	gAb¡¿ùCÚŒŞËr
::
	$wakeUpAÎBufãrs
()

162 
¡d
::
veùÜ
<
MsgVecTy³
*> 
wokeUpMsgVecs
;

164 if(
m_wa™šg_bufãrs
.
	`size
() > 0) {

165 
Wa™šgBufTy³
::
™”©Ü
 
buf_™”
 = 
m_wa™šg_bufãrs
.
	`begš
();

166 
buf_™”
 !ğ
m_wa™šg_bufãrs
.
	`’d
();

167 ++
buf_™”
) {

168 
MsgVecTy³
::
™”©Ü
 
vec_™”
 = 
buf_™”
->
£cÚd
->
	`begš
();

169 
vec_™”
 !ğ
buf_™”
->
£cÚd
->
	`’d
();

170 ++
vec_™”
) {

171 ià(*
vec_™”
 !ğ
NULL
) {

172 (*
vec_™”
)->
	`»ª®yzeAÎMes§ges
();

175 
wokeUpMsgVecs
.
	`push_back
(
buf_™”
->
£cÚd
);

178 
¡d
::
veùÜ
<
MsgVecTy³
*>::
™”©Ü
 
wb_™”
 = 
wokeUpMsgVecs
.
	`begš
();

179 
wb_™”
 !ğ
wokeUpMsgVecs
.
	`’d
();

180 ++
wb_™”
) {

181 
	`d–‘e
 (*
wb_™”
);

184 
m_wa™šg_bufãrs
.
	`ş—r
();

186 
	}
}

189 
	gAb¡¿ùCÚŒŞËr
::
	$blockOnQueue
(
Add»ss
 
addr
, 
Mes§geBufãr
* 
pÜt
)

191 
m_is_blockšg
 = 
Œue
;

192 
m_block_m­
[
addr
] = 
pÜt
;

193 
	}
}

196 
	gAb¡¿ùCÚŒŞËr
::
	$unblock
(
Add»ss
 
addr
)

198 
m_block_m­
.
	`”a£
(
addr
);

199 ià(
m_block_m­
.
	`size
() == 0) {

200 
m_is_blockšg
 = 
çl£
;

202 
	}
}

	@ruby/slicc_interface/AbstractController.hh

29 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_ABSTRACTCONTROLLER_HH__


30 
	#__MEM_RUBY_SLICC_INTERFACE_ABSTRACTCONTROLLER_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

35 
	~"ba£/ÿÎback.hh
"

36 
	~"mem/´ÙocŞ/AcûssP”missiÚ.hh
"

37 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

38 
	~"mem/ruby/commÚ/Add»ss.hh
"

39 
	~"mem/ruby/commÚ/CÚsum”.hh
"

40 
	~"mem/ruby/commÚ/D©aBlock.hh
"

41 
	~"mem/ruby/commÚ/Hi¡og¿m.hh
"

42 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

43 
	~"mem/ruby/»cÜd”/CacheRecÜd”.hh
"

44 
	~"mem/ruby/sy¡em/MachšeID.hh
"

45 
	~"mem/·ck‘.hh
"

46 
	~"·¿ms/RubyCÚŒŞËr.hh
"

47 
	~"sim/şocked_objeù.hh
"

49 
şass
 
	gN‘wÜk
;

51 
şass
 
	gAb¡¿ùCÚŒŞËr
 : 
public
 
ClockedObjeù
,…ubliø
	gCÚsum”


53 
	gpublic
:

54 
RubyCÚŒŞËrP¬ams
 
	tP¬ams
;

55 
Ab¡¿ùCÚŒŞËr
(cÚ¡ 
P¬ams
 *
p
);

56 
š™
();

57 cÚ¡ 
P¬ams
 *
·¿ms
(ècÚ¡ {  (cÚ¡ 
	gP¬ams
 *)
	g_·¿ms
; }

59 cÚ¡ 
NodeID
 
g‘V”siÚ
(ècÚ¡ {  
	gm_v”siÚ
; }

60 
š™N‘wÜkPŒ
(
N‘wÜk
* 
Ãt_±r
è{ 
	gm_Ãt_±r
 =‚et_ptr; }

63 cÚ¡ 
	g¡d
::
¡ršg
 
g‘Name
(ècÚ¡ {  
m_Çme
; }

64 
blockOnQueue
(
Add»ss
, 
Mes§geBufãr
*);

65 
unblock
(
Add»ss
);

67 
vœtu®
 
Mes§geBufãr
* 
g‘Mªd©ÜyQueue
() const = 0;

68 
vœtu®
 cÚ¡ 
	g¡d
::
¡ršg
 
toSŒšg
() const = 0;

70 
vœtu®
 
AcûssP”missiÚ
 
g‘AcûssP”missiÚ
(cÚ¡ 
Add»ss
& 
addr
) = 0;

71 
vœtu®
 
	gD©aBlock
& 
g‘D©aBlock
(cÚ¡ 
Add»ss
& 
addr
) = 0;

73 
vœtu®
 
´št
(
¡d
::
o¡»am
 & 
out
) const = 0;

74 
vœtu®
 
wakeup
() = 0;

75 
vœtu®
 
ş—rSts
() = 0;

76 
vœtu®
 
»gSts
() = 0;

78 
vœtu®
 
»cÜdCacheT¿û
(
úŒl
, 
CacheRecÜd”
* 
Œ
) = 0;

79 
vœtu®
 
Sequ’ûr
* 
g‘Sequ’ûr
() const = 0;

85 
vœtu®
 
boŞ
 
funùiÚ®R—dBufãrs
(
Pack‘PŒ
&) = 0;

88 
vœtu®
 
ušt32_t
 
funùiÚ®Wr™eBufãrs
(
Pack‘PŒ
&) = 0;

91 
vœtu®
 
’queueP»ãtch
(cÚ¡ 
Add»ss
&, cÚ¡ 
RubyReque¡Ty³
&)

92 { 
çl
("Prefetches‚ot implemented!");}

97 
vœtu®
 
cŞÏ‹Sts
()

98 {
çl
("collateStats() should be overridden!");}

100 
	gpublic
:

101 
MachšeID
 
g‘MachšeID
(ècÚ¡ {  
m_machšeID
; }

102 
ušt64_t
 
g‘FuÎyBusyCyşes
(ècÚ¡ {  
	gm_fuÎy_busy_cyşes
; }

103 
ušt64_t
 
g‘Reque¡CouÁ
(ècÚ¡ {  
	gm_»que¡_couÁ
; }

104 cÚ¡ 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gušt64_t
>& 
g‘Reque¡ProfeM­
() const

105 {  
	gm_»que¡ProfeM­
; }

107 
	gHi¡og¿m
& 
g‘D–ayHi¡
(è{  
	gm_d–ayHi¡og¿m
; }

108 
	gHi¡og¿m
& 
g‘D–ayVCHi¡
(
ušt32_t
 
šdex
)

109 {  
	gm_d–ayVCHi¡og¿m
[
šdex
]; }

111 
Mes§geBufãr
 *
g‘P“rQueue
(
ušt32_t
 
pid
)

113 
	g¡d
::
m­
<
ušt32_t
, 
	gMes§geBufãr
 *>::
™”©Ü
 
™
 =

114 
³”QueueM­
.
fšd
(
pid
);

115 
as£¹
(
™
 !ğ
³”QueueM­
.
’d
());

116  (*
	g™
).
	g£cÚd
;

119 
	g´Ùeùed
:

121 
´ofeReque¡
(cÚ¡ 
¡d
::
¡ršg
 &
»que¡
);

123 
´ofeMsgD–ay
(
ušt32_t
 
vœtu®N‘wÜk
, 
Cyşes
 
d–ay
);

126 
cÚÃùW™hP“r
(
Ab¡¿ùCÚŒŞËr
 *);

127 
vœtu®
 
g‘QueuesFromP“r
(
Ab¡¿ùCÚŒŞËr
 *)

128 { 
çl
("getQueuesFromPeer() should be called only if implemented!"); }

130 
¡®lBufãr
(
Mes§geBufãr
* 
buf
, 
Add»ss
 
addr
);

131 
wakeUpBufãrs
(
Add»ss
 
addr
);

132 
wakeUpAÎBufãrs
(
Add»ss
 
addr
);

133 
wakeUpAÎBufãrs
();

135 
	g´Ùeùed
:

136 
¡d
::
¡ršg
 
m_Çme
;

137 
NodeID
 
	gm_v”siÚ
;

138 
MachšeID
 
	gm_machšeID
;

139 
NodeID
 
	gm_şu¡”ID
;

141 
N‘wÜk
* 
	gm_Ãt_±r
;

142 
boŞ
 
	gm_is_blockšg
;

143 
	g¡d
::
m­
<
Add»ss
, 
	gMes§geBufãr
*> 
	gm_block_m­
;

144 
	g¡d
::
	tveùÜ
<
	tMes§geBufãr
*> 
	tMsgVecTy³
;

145 
	g¡d
::
	tm­
< 
	tAdd»ss
, 
	tMsgVecTy³
* > 
	tWa™šgBufTy³
;

146 
Wa™šgBufTy³
 
	gm_wa™šg_bufãrs
;

147 
	gm_š_pÜts
;

148 
	gm_cur_š_pÜt
;

149 
	gm_numb”_of_TBEs
;

150 
	gm_Œªs™iÚs_³r_cyşe
;

151 
	gm_bufãr_size
;

152 
Cyşes
 
	gm_»cyşe_Ï‹ncy
;

155 
	g¡d
::
m­
<
ušt32_t
, 
	gMes§geBufãr
*> 
	g³”QueueM­
;

159 
ušt64_t
 
	gm_fuÎy_busy_cyşes
;

163 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gušt64_t
> 
	gm_»que¡ProfeM­
;

164 
ušt64_t
 
	gm_»que¡_couÁ
;

168 
Hi¡og¿m
 
	gm_d–ayHi¡og¿m
;

169 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_d–ayVCHi¡og¿m
;

173 şas 
	cStsC®lback
 : 
public
 
C®lback


175 
´iv©e
:

176 
Ab¡¿ùCÚŒŞËr
 *
ùr
;

178 
	gpublic
:

179 
vœtu®
 ~
StsC®lback
() {}

181 
StsC®lback
(
Ab¡¿ùCÚŒŞËr
 *
_ùr
)

182 : 
ùr
(
_ùr
)

186 
´oûss
(è{
ùr
->
cŞÏ‹Sts
();}

	@ruby/slicc_interface/AbstractEntry.cc

29 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùEÁry.hh
"

31 
	gAb¡¿ùEÁry
::
	$Ab¡¿ùEÁry
()

33 
m_P”missiÚ
 = 
AcûssP”missiÚ_NÙP»£Á
;

34 
	}
}

36 
	gAb¡¿ùEÁry
::~
	$Ab¡¿ùEÁry
()

38 
	}
}

40 
AcûssP”missiÚ


41 
Ab¡¿ùEÁry
::
	$g‘P”missiÚ
() const

43  
m_P”missiÚ
;

44 
	}
}

47 
	gAb¡¿ùEÁry
::
	$chªgeP”missiÚ
(
AcûssP”missiÚ
 
Ãw_³rm
)

49 
m_P”missiÚ
 = 
Ãw_³rm
;

50 
	}
}

	@ruby/slicc_interface/AbstractEntry.hh

29 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_ABSTRACTENTRY_HH__


30 
	#__MEM_RUBY_SLICC_INTERFACE_ABSTRACTENTRY_HH__


	)

32 
	~<io¡»am
>

34 
	~"mem/´ÙocŞ/AcûssP”missiÚ.hh
"

36 
şass
 
	gD©aBlock
;

38 şas 
	cAb¡¿ùEÁry


40 
	mpublic
:

41 
Ab¡¿ùEÁry
();

42 
	mvœtu®
 ~
Ab¡¿ùEÁry
() = 0;

45 
AcûssP”missiÚ
 
	$g‘P”missiÚ
() const;

46 
	`chªgeP”missiÚ
(
AcûssP”missiÚ
 
Ãw_³rm
);

50 
vœtu®
 
D©aBlock
& 
	`g‘D©aBlk
() = 0;

52 
vœtu®
 
	`´št
(
¡d
::
o¡»am
& 
out
) const = 0;

54 
AcûssP”missiÚ
 
m_P”missiÚ
;

58 
šlše
 
¡d
::
o¡»am
&

59 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
Ab¡¿ùEÁry
& 
obj
)

61 
obj
.
	`´št
(
out
);

62 
out
 << 
¡d
::
æush
;

63  
out
;

64 
	}
}

	@ruby/slicc_interface/AbstractProtocol.hh

35 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_ABSTRACTPROTOCOL_HH__


36 
	#__MEM_RUBY_SLICC_INTERFACE_ABSTRACTPROTOCOL_HH__


	)

38 şas 
	cAb¡¿ùPrÙocŞ


40 
	mpublic
:

41 
	$Ab¡¿ùPrÙocŞ
() {}

43 
vœtu®
 ~
	`Ab¡¿ùPrÙocŞ
() = 0;

45 cÚ¡ 
boŞ
 
m_CMP
 = 
çl£
 ;

46 cÚ¡ 
boŞ
 
m_TwoLev–Cache
 = 
çl£
 ;

47 
	}
};

	@ruby/slicc_interface/Message.hh

29 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_MESSAGE_HH__


30 
	#__MEM_RUBY_SLICC_INTERFACE_MESSAGE_HH__


	)

32 
	~<io¡»am
>

34 
	~"ba£/»fút.hh
"

35 
	~"mem/·ck‘.hh
"

37 
şass
 
	gMes§ge
;

38 
	gRefCouÁšgPŒ
<
	tMes§ge
> 
	tMsgPŒ
;

40 şas 
	cMes§ge
 : 
public
 
RefCouÁed


42 
public
:

43 
	$Mes§ge
(
Tick
 
curTime
)

44 : 
	`m_time
(
curTime
),

45 
	`m_La¡EnqueueTime
(
curTime
),

46 
	$m_D–ayedTicks
(0)

49 
	$Mes§ge
(cÚ¡ 
Mes§ge
 &
Ùh”
)

50 : 
	`m_time
(
Ùh”
.
m_time
),

51 
	`m_La¡EnqueueTime
(
Ùh”
.
m_La¡EnqueueTime
),

52 
	$m_D–ayedTicks
(
Ùh”
.
m_D–ayedTicks
)

53 { 
	}
}

55 
	gvœtu®
 ~
	$Mes§ge
(è{ 
	}
}

57 
vœtu®
 
Mes§ge
* 
	$şÚe
() const = 0;

58 
vœtu®
 
	`´št
(
¡d
::
o¡»am
& 
out
) const = 0;

59 
vœtu®
 
	$£tIncomšgLšk
(è{
	}
}

60 
vœtu®
 
	$£tVÃt
(è{
	}
}

69 
vœtu®
 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *
pkt
) = 0;

71 
vœtu®
 
boŞ
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
) = 0;

74 
	$£tD–ayedTicks
(cÚ¡ 
Tick
 
ticks
è{ 
m_D–ayedTicks
 =icks; 
	}
}

75 cÚ¡ 
Tick
 
	$g‘D–ayedTicks
(ècÚ¡ { 
m_D–ayedTicks
;
	}
}

77 
	$£tLa¡EnqueueTime
(cÚ¡ 
Tick
& 
time
è{ 
m_La¡EnqueueTime
 =ime; 
	}
}

78 cÚ¡ 
Tick
 
	$g‘La¡EnqueueTime
(ècÚ¡ { 
m_La¡EnqueueTime
;
	}
}

80 cÚ¡ 
	gTick
& 
	$g‘Time
(ècÚ¡ {  
m_time
; 
	}
}

81 
	$£tTime
(cÚ¡ 
Tick
& 
Ãw_time
è{ 
m_time
 =‚ew_time; 
	}
}

83 
	g´iv©e
:

84 
Tick
 
m_time
;

85 
Tick
 
	gm_La¡EnqueueTime
;

86 
Tick
 
	gm_D–ayedTicks
;

89 
šlše
 
	g¡d
::
o¡»am
&

90 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gMes§ge
& 
	gobj
)

92 
	gobj
.
´št
(
out
);

93 
	gout
 << 
	g¡d
::
æush
;

94  
	gout
;

	@ruby/slicc_interface/NetworkMessage.hh

29 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_NETWORKMESSAGE_HH__


30 
	#__MEM_RUBY_SLICC_INTERFACE_NETWORKMESSAGE_HH__


	)

32 
	~<io¡»am
>

34 
	~"ba£/»fút.hh
"

35 
	~"mem/´ÙocŞ/Mes§geSizeTy³.hh
"

36 
	~"mem/ruby/commÚ/N‘De¡.hh
"

37 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

39 
şass
 
	gN‘wÜkMes§ge
;

40 
	gRefCouÁšgPŒ
<
	tN‘wÜkMes§ge
> 
	tN‘MsgPŒ
;

42 şas 
	cN‘wÜkMes§ge
 : 
public
 
Mes§ge


44 
public
:

45 
	$N‘wÜkMes§ge
(
Tick
 
curTime
)

46 : 
	`Mes§ge
(
curTime
), 
	$m_š‹º®_de¡_v®id
(
çl£
)

49 
	$N‘wÜkMes§ge
(cÚ¡ 
N‘wÜkMes§ge
 &
Ùh”
)

50 : 
	`Mes§ge
(
Ùh”
), 
	`m_š‹º®_de¡
(Ùh”.
m_š‹º®_de¡
),

51 
	$m_š‹º®_de¡_v®id
(
Ùh”
.
m_š‹º®_de¡_v®id
)

52 { 
	}
}

54 
	gvœtu®
 ~
	$N‘wÜkMes§ge
(è{ 
	}
}

56 
vœtu®
 cÚ¡ 
	gN‘De¡
& 
	$g‘De¡š©iÚ
() const = 0;

57 
vœtu®
 
N‘De¡
& 
	`g‘De¡š©iÚ
() = 0;

58 
vœtu®
 cÚ¡ 
Mes§geSizeTy³
& 
	$g‘Mes§geSize
() const = 0;

59 
vœtu®
 
Mes§geSizeTy³
& 
	`g‘Mes§geSize
() = 0;

61 cÚ¡ 
N‘De¡
&

62 
	$g‘IÁ”ÇlDe¡š©iÚ
() const

64 ià(
m_š‹º®_de¡_v®id
 =ğ
çl£
)

65  
	`g‘De¡š©iÚ
();

67  
m_š‹º®_de¡
;

68 
	}
}

70 
	gN‘De¡
&

71 
	$g‘IÁ”ÇlDe¡š©iÚ
()

73 ià(
m_š‹º®_de¡_v®id
 =ğ
çl£
) {

74 
m_š‹º®_de¡
 = 
	`g‘De¡š©iÚ
();

75 
m_š‹º®_de¡_v®id
 = 
Œue
;

77  
m_š‹º®_de¡
;

78 
	}
}

80 
vœtu®
 
´št
(
¡d
::
o¡»am
& 
out
) const = 0;

82 
	$g‘IncomšgLšk
(ècÚ¡ {  
šcomšg_lšk
; 
	}
}

83 
	$£tIncomšgLšk
(
lšk
è{ 
šcomšg_lšk
 =†šk; 
	}
}

84 
	$g‘VÃt
(ècÚ¡ {  
vÃt
; 
	}
}

85 
	$£tVÃt
(
Ãt
è{ 
vÃt
 =‚‘; 
	}
}

87 
	g´iv©e
:

88 
N‘De¡
 
m_š‹º®_de¡
;

89 
boŞ
 
	gm_š‹º®_de¡_v®id
;

90 
	gšcomšg_lšk
;

91 
	gvÃt
;

94 
šlše
 
	g¡d
::
o¡»am
&

95 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gN‘wÜkMes§ge
& 
	gobj
)

97 
	gobj
.
´št
(
out
);

98 
	gout
 << 
	g¡d
::
æush
;

99  
	gout
;

	@ruby/slicc_interface/RubyRequest.cc

1 
	~<io¡»am
>

3 
	~"mem/ruby/¦icc_š‹rçû/RubyReque¡.hh
"

5 
usšg
 
Çme¥aû
 
	g¡d
;

8 
	gRubyReque¡
::
	$´št
(
o¡»am
& 
out
) const

10 
out
 << "[RubyRequest: ";

11 
out
 << "LšeAdd»s ğ" << 
m_LšeAdd»ss
 << " ";

12 
out
 << "PhysiÿlAdd»s ğ" << 
m_PhysiÿlAdd»ss
 << " ";

13 
out
 << "Ty³ = " << 
m_Ty³
 << " ";

14 
out
 << "Prog¿mCouÁ” = " << 
m_Prog¿mCouÁ”
 << " ";

15 
out
 << "AcûssModğ" << 
m_AcûssMode
 << " ";

16 
out
 << "Sizğ" << 
m_Size
 << " ";

17 
out
 << "P»ãtch = " << 
m_P»ãtch
 << " ";

19 
out
 << "]";

20 
	}
}

22 
boŞ


23 
	gRubyReque¡
::
	$funùiÚ®R—d
(
Pack‘
 *
pkt
)

29  
çl£
;

30 
	}
}

32 
boŞ


33 
	gRubyReque¡
::
	$funùiÚ®Wr™e
(
Pack‘
 *
pkt
)

42 
Addr
 
wBa£
 = 
pkt
->
	`g‘Addr
();

43 
Addr
 
wTa
 = 
wBa£
 + 
pkt
->
	`g‘Size
();

44 
Addr
 
mBa£
 = 
m_PhysiÿlAdd»ss
.
	`g‘Add»ss
();

45 
Addr
 
mTa
 = 
mBa£
 + 
m_Size
;

47 
ušt8_t
 * 
pktD©a
 = 
pkt
->
g‘PŒ
<ušt8_t>(
Œue
);

49 
Addr
 
cBa£
 = 
¡d
::
	`max
(
wBa£
, 
mBa£
);

50 
Addr
 
cTa
 = 
¡d
::
	`mš
(
wTa
, 
mTa
);

52 
Addr
 
i
 = 
cBa£
; i < 
cTa
; ++i) {

53 
d©a
[
i
 - 
mBa£
] = 
pktD©a
[˜- 
wBa£
];

56  
cBa£
 < 
cTa
;

57 
	}
}

	@ruby/slicc_interface/RubyRequest.hh

29 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_RUBY_REQUEST_HH__


30 
	#__MEM_RUBY_SLICC_INTERFACE_RUBY_REQUEST_HH__


	)

32 
	~<o¡»am
>

34 
	~"mem/´ÙocŞ/Mes§ge.hh
"

35 
	~"mem/´ÙocŞ/P»ãtchB™.hh
"

36 
	~"mem/´ÙocŞ/RubyAcûssMode.hh
"

37 
	~"mem/´ÙocŞ/RubyReque¡Ty³.hh
"

38 
	~"mem/ruby/commÚ/Add»ss.hh
"

40 şas 
	cRubyReque¡
 : 
public
 
Mes§ge


42 
public
:

43 
Add»ss
 
m_PhysiÿlAdd»ss
;

44 
Add»ss
 
	mm_LšeAdd»ss
;

45 
RubyReque¡Ty³
 
	mm_Ty³
;

46 
Add»ss
 
	mm_Prog¿mCouÁ”
;

47 
RubyAcûssMode
 
	mm_AcûssMode
;

48 
	mm_Size
;

49 
P»ãtchB™
 
	mm_P»ãtch
;

50 
ušt8_t
* 
	md©a
;

51 
Pack‘PŒ
 
	mpkt
;

52 
	mm_cÚ‹xtId
;

54 
	$RubyReque¡
(
Tick
 
curTime
, 
ušt64_t
 
_·ddr
, 
ušt8_t
* 
_d©a
, 
_Ën
,

55 
ušt64_t
 
_pc
, 
RubyReque¡Ty³
 
_ty³
, 
RubyAcûssMode
 
_acûss_mode
,

56 
Pack‘PŒ
 
_pkt
, 
P»ãtchB™
 
_pb
 = 
P»ãtchB™_No
,

57 
_´oc_id
 = 100)

58 : 
	`Mes§ge
(
curTime
),

59 
	`m_PhysiÿlAdd»ss
(
_·ddr
),

60 
	`m_Ty³
(
_ty³
),

61 
	`m_Prog¿mCouÁ”
(
_pc
),

62 
	`m_AcûssMode
(
_acûss_mode
),

63 
	`m_Size
(
_Ën
),

64 
	`m_P»ãtch
(
_pb
),

65 
	`d©a
(
_d©a
),

66 
	`pkt
(
_pkt
),

67 
	$m_cÚ‹xtId
(
_´oc_id
)

69 
m_LšeAdd»ss
 = 
m_PhysiÿlAdd»ss
;

70 
m_LšeAdd»ss
.
	`makeLšeAdd»ss
();

73 
	$RubyReque¡
(
Tick
 
curTime
è: 
	$Mes§ge
(
curTime
è{
	}
}

74 
RubyReque¡
* 
	$şÚe
(ècÚ¡ {  
Ãw
 
	`RubyReque¡
(*
this
); 
	}
}

76 cÚ¡ 
	gAdd»ss
& 
	$g‘LšeAdd»ss
(ècÚ¡ {  
m_LšeAdd»ss
; 
	}
}

77 cÚ¡ 
	gAdd»ss
& 
	$g‘PhysiÿlAdd»ss
(ècÚ¡ {  
m_PhysiÿlAdd»ss
; 
	}
}

78 cÚ¡ 
	gRubyReque¡Ty³
& 
	$g‘Ty³
(ècÚ¡ {  
m_Ty³
; 
	}
}

79 cÚ¡ 
	gAdd»ss
& 
	$g‘Prog¿mCouÁ”
(ècÚ¡ {  
m_Prog¿mCouÁ”
; 
	}
}

80 cÚ¡ 
	gRubyAcûssMode
& 
	$g‘AcûssMode
(ècÚ¡ {  
m_AcûssMode
; 
	}
}

81 cÚ¡ & 
	$g‘Size
(ècÚ¡ {  
m_Size
; 
	}
}

82 cÚ¡ 
	gP»ãtchB™
& 
	$g‘P»ãtch
(ècÚ¡ {  
m_P»ãtch
; 
	}
}

84 
´št
(
¡d
::
o¡»am
& 
out
) const;

85 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *
pkt
);

86 
boŞ
 
funùiÚ®Wr™e
(
Pack‘
 *
pkt
);

89 
šlše
 
	g¡d
::
o¡»am
&

90 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gRubyReque¡
& 
	gobj
)

92 
	gobj
.
´št
(
out
);

93 
	gout
 << 
	g¡d
::
æush
;

94  
	gout
;

	@ruby/slicc_interface/RubySlicc_ComponentMapping.hh

29 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_RUBYSLICC_COMPONENTMAPPINGS_HH__


30 
	#__MEM_RUBY_SLICC_INTERFACE_RUBYSLICC_COMPONENTMAPPINGS_HH__


	)

32 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

33 
	~"mem/ruby/commÚ/Add»ss.hh
"

34 
	~"mem/ruby/commÚ/Glob®.hh
"

35 
	~"mem/ruby/commÚ/N‘De¡.hh
"

36 
	~"mem/ruby/sy¡em/DœeùÜyMemÜy.hh
"

37 
	~"mem/ruby/sy¡em/MachšeID.hh
"

41 
šlše
 
NodeID


42 
	$m­_Add»ss_to_DœeùÜyNode
(cÚ¡ 
Add»ss
& 
addr
)

44  
DœeùÜyMemÜy
::
	`m­Add»ssToDœeùÜyV”siÚ
(
addr
);

45 
	}
}

49 
šlše
 
MachšeID


50 
	$m­_Add»ss_to_DœeùÜy
(cÚ¡ 
Add»ss
 &
addr
)

52 
MachšeID
 
mach
 =

53 {
MachšeTy³_DœeùÜy
, 
	`m­_Add»ss_to_DœeùÜyNode
(
addr
)};

54  
mach
;

55 
	}
}

57 
šlše
 
N‘De¡


58 
	$brßdÿ¡
(
MachšeTy³
 
ty³
)

60 
N‘De¡
 
de¡
;

61 
NodeID
 
i
 = 0; i < 
	`MachšeTy³_ba£_couÁ
(
ty³
); i++) {

62 
MachšeID
 
mach
 = {
ty³
, 
i
};

63 
de¡
.
	`add
(
mach
);

65  
de¡
;

66 
	}
}

68 
šlše
 
MachšeID


69 
	$m­Add»ssToRªge
(cÚ¡ 
Add»ss
 & 
addr
, 
MachšeTy³
 
ty³
, 
low_b™
,

70 
num_b™s
, 
şu¡”_id
 = 0)

72 
MachšeID
 
mach
 = {
ty³
, 0};

73 ià(
num_b™s
 == 0)

74 
mach
.
num
 = 
şu¡”_id
;

76 
mach
.
num
 = 
addr
.
	`b™S–eù
(
low_b™
,†ow_b™ + 
num_b™s
 - 1)

77 + (1 << 
num_b™s
è* 
şu¡”_id
;

78  
mach
;

79 
	}
}

81 
šlše
 
NodeID


82 
	$machšeIDToNodeID
(
MachšeID
 
machID
)

84  
machID
.
num
;

85 
	}
}

87 
šlše
 
MachšeTy³


88 
	$machšeIDToMachšeTy³
(
MachšeID
 
machID
)

90  
machID
.
ty³
;

91 
	}
}

93 
šlše
 

94 
	$machšeCouÁ
(
MachšeTy³
 
machTy³
)

96  
	`MachšeTy³_ba£_couÁ
(
machTy³
);

97 
	}
}

99 
šlše
 
MachšeID


100 
	$ü—‹MachšeID
(
MachšeTy³
 
ty³
, 
NodeID
 
id
)

102 
MachšeID
 
mach
 = {
ty³
, 
id
};

103  
mach
;

104 
	}
}

	@ruby/slicc_interface/RubySlicc_Util.hh

33 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_RUBYSLICCUTIL_HH__


34 
	#__MEM_RUBY_SLICC_INTERFACE_RUBYSLICCUTIL_HH__


	)

36 
	~<ÿs£¹
>

38 
	~"debug/RubySlicc.hh
"

39 
	~"mem/ruby/commÚ/Add»ss.hh
"

40 
	~"mem/ruby/¦icc_š‹rçû/RubySlicc_CompÚ’tM­pšg.hh
"

41 
	~"mem/·ck‘.hh
"

43 
šlše
 

44 
	$¿ndom
(
n
)

46  
	`¿ndom
(è% 
n
;

47 
	}
}

49 
šlše
 
Cyşes
 
	$z”o_time
(è{  
	`Cyşes
(0); 
	}
}

50 
šlše
 
Cyşes
 
	$TimeToCyşes
(
Time
 
t
è{  
	`Cyşes
Ñ); 
	}
}

52 
šlše
 
NodeID


53 
	$štToID
(
nod’um
)

55 
NodeID
 
id
 = 
nod’um
;

56  
id
;

57 
	}
}

59 
šlše
 

60 
	$IDToIÁ
(
NodeID
 
id
)

62 
nod’um
 = 
id
;

63  
nod’um
;

64 
	}
}

67 
šlše
 
Add»ss


68 
	$£tOff£t
(
Add»ss
 
addr
, 
off£t
)

70 
Add»ss
 
»suÉ
 = 
addr
;

71 
»suÉ
.
	`£tOff£t
(
off£t
);

72  
»suÉ
;

73 
	}
}

76 
šlše
 
Add»ss


77 
	$makeLšeAdd»ss
(
Add»ss
 
addr
)

79 
Add»ss
 
»suÉ
 = 
addr
;

80 
»suÉ
.
	`makeLšeAdd»ss
();

81  
»suÉ
;

82 
	}
}

84 
šlše
 

85 
	$add»ssOff£t
(
Add»ss
 
addr
)

87  
addr
.
	`g‘Off£t
();

88 
	}
}

90 
šlše
 

91 
	$mod
(
v®
, 
mod
)

93  
v®
 % 
mod
;

94 
	}
}

96 
šlše
 
	$max_tok’s
()

99 
	}
}

107 
šlše
 
boŞ


108 
	$‹¡AndR—d
(
Add»ss
 
addr
, 
D©aBlock
& 
blk
, 
Pack‘
 *
pkt
)

110 
Add»ss
 
	`pktLšeAddr
(
pkt
->
	`g‘Addr
());

111 
pktLšeAddr
.
	`makeLšeAdd»ss
();

113 
Add»ss
 
lšeAddr
 = 
addr
;

114 
lšeAddr
.
	`makeLšeAdd»ss
();

116 ià(
pktLšeAddr
 =ğ
lšeAddr
) {

117 
ušt8_t
 *
d©a
 = 
pkt
->
g‘PŒ
<ušt8_t>(
Œue
);

118 
size_š_by‹s
 = 
pkt
->
	`g‘Size
();

119 
¡¬tBy‹
 = 
pkt
->
	`g‘Addr
(è- 
lšeAddr
.
	`g‘Add»ss
();

121 
i
 = 0; i < 
size_š_by‹s
; ++i) {

122 
d©a
[
i
] = 
blk
.
	`g‘By‹
(˜+ 
¡¬tBy‹
);

124  
Œue
;

126  
çl£
;

127 
	}
}

135 
šlše
 
boŞ


136 
	$‹¡AndWr™e
(
Add»ss
 
addr
, 
D©aBlock
& 
blk
, 
Pack‘
 *
pkt
)

138 
Add»ss
 
	`pktLšeAddr
(
pkt
->
	`g‘Addr
());

139 
pktLšeAddr
.
	`makeLšeAdd»ss
();

141 
Add»ss
 
lšeAddr
 = 
addr
;

142 
lšeAddr
.
	`makeLšeAdd»ss
();

144 ià(
pktLšeAddr
 =ğ
lšeAddr
) {

145 
ušt8_t
 *
d©a
 = 
pkt
->
g‘PŒ
<ušt8_t>(
Œue
);

146 
size_š_by‹s
 = 
pkt
->
	`g‘Size
();

147 
¡¬tBy‹
 = 
pkt
->
	`g‘Addr
(è- 
lšeAddr
.
	`g‘Add»ss
();

149 
i
 = 0; i < 
size_š_by‹s
; ++i) {

150 
blk
.
	`£tBy‹
(
i
 + 
¡¬tBy‹
, 
d©a
[i]);

152  
Œue
;

154  
çl£
;

155 
	}
}

	@ruby/slicc_interface/RubySlicc_includes.hh

29 #iâdeà
__MEM_RUBY_SLICC_INTERFACE_RUBYSLICC_INCLUDES_HH__


30 
	#__MEM_RUBY_SLICC_INTERFACE_RUBYSLICC_INCLUDES_HH__


	)

32 
	~"mem/ruby/¦icc_š‹rçû/RubySlicc_CompÚ’tM­pšg.hh
"

33 
	~"mem/ruby/¦icc_š‹rçû/RubySlicc_Ut.hh
"

	@ruby/structures/Prefetcher.cc

29 
	~"debug/RubyP»ãtch”.hh
"

30 
	~"mem/ruby/¦icc_š‹rçû/RubySlicc_CompÚ’tM­pšg.hh
"

31 
	~"mem/ruby/¡ruùu»s/P»ãtch”.hh
"

32 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

34 
P»ãtch”
*

35 
	gP»ãtch”P¬ams
::
	$ü—‹
()

37  
Ãw
 
	`P»ãtch”
(
this
);

38 
	}
}

40 
	gP»ãtch”
::
	$P»ãtch”
(cÚ¡ 
P¬ams
 *
p
)

41 : 
	`SimObjeù
(
p
), 
	`m_num_¡»ams
Õ->
num_¡»ams
),

42 
	`m_¬¿y
(
p
->
num_¡»ams
), 
	`m_Œaš_mis£s
Õ->
Œaš_mis£s
),

43 
	`m_num_¡¬tup_pfs
(
p
->
num_¡¬tup_pfs
), 
	`m_num_un™_f‹rs
Õ->
un™_f‹r
),

44 
	`m_num_nÚun™_f‹rs
(
p
->
nÚun™_f‹r
),

45 
	`m_un™_f‹r
(
p
->
un™_f‹r
, 
	`Add»ss
(0)),

46 
	`m_Ãg©ive_f‹r
(
p
->
un™_f‹r
, 
	`Add»ss
(0)),

47 
	`m_nÚun™_f‹r
(
p
->
nÚun™_f‹r
, 
	`Add»ss
(0)),

48 
	`m_´eãtch_üoss_·ges
(
p
->
üoss_·ge
)

50 
	`as£¹
(
m_num_¡»ams
 > 0);

51 
	`as£¹
(
m_num_¡¬tup_pfs
 <ğ
MAX_PF_INFLIGHT
);

54 
m_un™_f‹r_šdex
 = 0;

55 
m_un™_f‹r_h™
 = 
Ãw
 
ušt32_t
[
m_num_un™_f‹rs
];

56 
ušt32_t
 
i
 =0; i < 
m_num_un™_f‹rs
; i++) {

57 
m_un™_f‹r_h™
[
i
] = 0;

61 
m_Ãg©ive_f‹r_šdex
 = 0;

62 
m_Ãg©ive_f‹r_h™
 = 
Ãw
 
ušt32_t
[
m_num_un™_f‹rs
];

63 
i
 =0; i < 
m_num_un™_f‹rs
; i++) {

64 
m_Ãg©ive_f‹r_h™
[
i
] = 0;

68 
m_nÚun™_šdex
 = 0;

69 
m_nÚun™_¡ride
 = 
Ãw
 [
m_num_nÚun™_f‹rs
];

70 
m_nÚun™_h™
 = 
Ãw
 
ušt32_t
[
m_num_nÚun™_f‹rs
];

71 
i
 =0; i < 
m_num_nÚun™_f‹rs
; i++) {

72 
m_nÚun™_¡ride
[
i
] = 0;

73 
m_nÚun™_h™
[
i
] = 0;

75 
	}
}

77 
	gP»ãtch”
::~
	$P»ãtch”
()

79 
d–‘e
 
m_un™_f‹r_h™
;

80 
d–‘e
 
m_Ãg©ive_f‹r_h™
;

81 
d–‘e
 
m_nÚun™_¡ride
;

82 
d–‘e
 
m_nÚun™_h™
;

83 
	}
}

86 
	gP»ãtch”
::
	$»gSts
()

88 
numMissOb£rved


89 .
	`Çme
(name() + ".miss_observed")

90 .
	`desc
("number of misses observed")

93 
numAÎoÿ‹dSŒ—ms


94 .
	`Çme
(name() + ".allocated_streams")

95 .
	`desc
("number of streams‡llocated for…refetching")

98 
numP»ãtchReque¡ed


99 .
	`Çme
(name() + ".prefetches_requested")

100 .
	`desc
("number of…refetch„equests made")

103 
numP»ãtchAcû±ed


104 .
	`Çme
(name() + ".prefetches_accepted")

105 .
	`desc
("number of…refetch„equests‡ccepted")

108 
numDrİ³dP»ãtches


109 .
	`Çme
(name() + ".dropped_prefetches")

110 .
	`desc
("number of…refetch„equests dropped")

113 
numH™s


114 .
	`Çme
(name() + ".hits")

115 .
	`desc
("number of…refetched blocks‡ccessed")

118 
numP¬tŸlH™s


119 .
	`Çme
(name() + ".partial_hits")

120 .
	`desc
("number of misses observed for‡ block being…refetched")

123 
numPagesCros£d


124 .
	`Çme
(name() + ".pages_crossed")

125 .
	`desc
("number of…refetches‡cross…ages")

128 
numMis£dP»ãtchedBlocks


129 .
	`Çme
(name() + ".misses_on_prefetched_blocks")

130 .
	`desc
("number of misses for blockshat were…refetched, yet missed")

132 
	}
}

135 
	gP»ãtch”
::
	$ob£rveMiss
(cÚ¡ 
Add»ss
& 
add»ss
, cÚ¡ 
RubyReque¡Ty³
& 
ty³
)

137 
	`DPRINTF
(
RubyP»ãtch”
, "Ob£rved mis fÜ %s\n", 
add»ss
);

138 
Add»ss
 
lše_addr
 = 
	`lše_add»ss
(
add»ss
);

139 
numMissOb£rved
++;

142 
ušt32_t
 
šdex
 = 0;

143 
P»ãtchEÁry
 *
pfEÁry
 = 
	`g‘P»ãtchEÁry
(
lše_addr
, 
šdex
);

144 ià(
pfEÁry
 !ğ
NULL
) {

145 ià(
pfEÁry
->
»que¡Issued
[
šdex
]) {

146 ià(
pfEÁry
->
»que¡Com¶‘ed
[
šdex
]) {

149 
numMis£dP»ãtchedBlocks
++;

154 
numP¬tŸlH™s
++;

155 
	`ob£rvePfH™
(
lše_addr
);

166 
boŞ
 
®loc
 = 
çl£
;

167 
boŞ
 
h™
 = 
	`acûssUn™F‹r
(
m_un™_f‹r
, 
m_un™_f‹r_h™
,

168 
m_un™_f‹r_šdex
, 
lše_addr
, 1, 
®loc
);

169 ià(
®loc
) {

171 
	`š™ŸlizeSŒ—m
(
lše_addr
, 1, 
	`g‘LRUšdex
(), 
ty³
);

173 ià(
h™
) {

174 
	`DPRINTF
(
RubyP»ãtch”
, " *** hit in unit stride buffer\n");

178 
h™
 = 
	`acûssUn™F‹r
(
m_Ãg©ive_f‹r
, 
m_Ãg©ive_f‹r_h™
,

179 
m_Ãg©ive_f‹r_šdex
, 
lše_addr
, -1, 
®loc
);

180 ià(
®loc
) {

182 
	`š™ŸlizeSŒ—m
(
lše_addr
, -1, 
	`g‘LRUšdex
(), 
ty³
);

184 ià(
h™
) {

185 
	`DPRINTF
(
RubyP»ãtch”
, " *** hit in unit‚egative unit buffer\n");

190 
¡ride
 = 0;

191 
h™
 = 
	`acûssNÚun™F‹r
(
add»ss
, &
¡ride
, 
®loc
);

192 ià(
®loc
) {

193 
	`as£¹
(
¡ride
 != 0);

194 
	`š™ŸlizeSŒ—m
(
lše_addr
, 
¡ride
, 
	`g‘LRUšdex
(), 
ty³
);

196 ià(
h™
) {

197 
	`DPRINTF
(
RubyP»ãtch”
, " *** hit in‚on-unit stride buffer\n");

200 
	}
}

203 
	gP»ãtch”
::
	$ob£rvePfMiss
(cÚ¡ 
Add»ss
& 
add»ss
)

205 
numP¬tŸlH™s
++;

206 
	`DPRINTF
(
RubyP»ãtch”
, "Ob£rved…¬tŸÈh™ fÜ %s\n", 
add»ss
);

207 
	`issueNextP»ãtch
(
add»ss
, 
NULL
);

208 
	}
}

211 
	gP»ãtch”
::
	$ob£rvePfH™
(cÚ¡ 
Add»ss
& 
add»ss
)

213 
numH™s
++;

214 
	`DPRINTF
(
RubyP»ãtch”
, "Ob£rved h™ fÜ %s\n", 
add»ss
);

215 
	`issueNextP»ãtch
(
add»ss
, 
NULL
);

216 
	}
}

219 
	gP»ãtch”
::
	$issueNextP»ãtch
(cÚ¡ 
Add»ss
 &
add»ss
, 
P»ãtchEÁry
 *
¡»am
)

222 ià(
¡»am
 =ğ
NULL
) {

223 
ušt32_t
 
šdex
 = 0;

224 
¡»am
 = 
	`g‘P»ãtchEÁry
(
add»ss
, 
šdex
);

228 ià(
¡»am
 =ğ
NULL
) {

229 
	`DPRINTF
(
RubyP»ãtch”
, "Unallocated stream,„eturning\n");

234 
Add»ss
 
·ge_addr
 = 
	`·ge_add»ss
(
¡»am
->
m_add»ss
);

235 
Add»ss
 
lše_addr
 = 
	`Ãxt_¡ride_add»ss
(
¡»am
->
m_add»ss
,

236 
¡»am
->
m_¡ride
);

239 ià(
·ge_addr
 !ğ
	`·ge_add»ss
(
lše_addr
)) {

240 
numPagesCros£d
++;

241 ià(!
m_´eãtch_üoss_·ges
) {

244 
¡»am
->
m_is_v®id
 = 
çl£
;

250 
¡»am
->
m_add»ss
 = 
lše_addr
;

251 
¡»am
->
m_u£_time
 = 
m_cÚŒŞËr
->
	`curCyşe
();

252 
	`DPRINTF
(
RubyP»ãtch”
, "Reque¡šg…»ãtch fÜ %s\n", 
lše_addr
);

253 
m_cÚŒŞËr
->
	`’queueP»ãtch
(
lše_addr
, 
¡»am
->
m_ty³
);

254 
	}
}

256 
ušt32_t


257 
	gP»ãtch”
::
	$g‘LRUšdex
()

259 
ušt32_t
 
Ìu_šdex
 = 0;

260 
Cyşes
 
Ìu_acûss
 = 
m_¬¿y
[
Ìu_šdex
].
m_u£_time
;

262 
ušt32_t
 
i
 = 0; i < 
m_num_¡»ams
; i++) {

263 ià(!
m_¬¿y
[
i
].
m_is_v®id
) {

264  
i
;

266 ià(
m_¬¿y
[
i
].
m_u£_time
 < 
Ìu_acûss
) {

267 
Ìu_acûss
 = 
m_¬¿y
[
i
].
m_u£_time
;

268 
Ìu_šdex
 = 
i
;

272  
Ìu_šdex
;

273 
	}
}

276 
	gP»ãtch”
::
	$ş—rNÚun™EÁry
(
ušt32_t
 
šdex
)

278 
m_nÚun™_f‹r
[
šdex
].
	`£tAdd»ss
(0);

279 
m_nÚun™_¡ride
[
šdex
] = 0;

280 
m_nÚun™_h™
[
šdex
] = 0;

281 
	}
}

284 
	gP»ãtch”
::
	$š™ŸlizeSŒ—m
(cÚ¡ 
Add»ss
& 
add»ss
, 
¡ride
,

285 
ušt32_t
 
šdex
, cÚ¡ 
RubyReque¡Ty³
& 
ty³
)

287 
numAÎoÿ‹dSŒ—ms
++;

290 
P»ãtchEÁry
 *
my¡»am
 = &(
m_¬¿y
[
šdex
]);

291 
my¡»am
->
m_add»ss
 = 
	`lše_add»ss
(
add»ss
);

292 
my¡»am
->
m_¡ride
 = 
¡ride
;

293 
my¡»am
->
m_u£_time
 = 
m_cÚŒŞËr
->
	`curCyşe
();

294 
my¡»am
->
m_is_v®id
 = 
Œue
;

295 
my¡»am
->
m_ty³
 = 
ty³
;

298 
Add»ss
 
·ge_addr
 = 
	`·ge_add»ss
(
my¡»am
->
m_add»ss
);

299 
Add»ss
 
lše_addr
 = 
	`lše_add»ss
(
my¡»am
->
m_add»ss
);

300 
Add»ss
 
´ev_addr
 = 
lše_addr
;

303 
k
 = 0; k < 
m_num_¡¬tup_pfs
; k++) {

304 
lše_addr
 = 
	`Ãxt_¡ride_add»ss
Öše_addr, 
¡ride
);

306 ià(
·ge_addr
 !ğ
	`·ge_add»ss
(
lše_addr
)) {

307 
numPagesCros£d
++;

308 ià(!
m_´eãtch_üoss_·ges
) {

310 
my¡»am
->
m_is_v®id
 = 
çl£
;

316 
numP»ãtchReque¡ed
++;

317 
	`DPRINTF
(
RubyP»ãtch”
, "Reque¡šg…»ãtch fÜ %s\n", 
lše_addr
);

318 
m_cÚŒŞËr
->
	`’queueP»ãtch
(
lše_addr
, 
m_¬¿y
[
šdex
].
m_ty³
);

319 
´ev_addr
 = 
lše_addr
;

323 
my¡»am
->
m_add»ss
 = 
lše_addr
;

324 
	}
}

326 
P»ãtchEÁry
 *

327 
	gP»ãtch”
::
	$g‘P»ãtchEÁry
(cÚ¡ 
Add»ss
 &
add»ss
, 
ušt32_t
 &
šdex
)

330 
i
 = 0; i < 
m_num_¡»ams
; i++) {

332 ià(
m_¬¿y
[
i
].
m_is_v®id
) {

333 
j
 = 0; j < 
m_num_¡¬tup_pfs
; j++) {

334 ià(
	`Ãxt_¡ride_add»ss
(
m_¬¿y
[
i
].
m_add»ss
,

335 -(
m_¬¿y
[
i
].
m_¡ride
*
j
)è=ğ
add»ss
) {

336  &(
m_¬¿y
[
i
]);

341  
NULL
;

342 
	}
}

344 
boŞ


345 
	gP»ãtch”
::
acûssUn™F‹r
(
¡d
::
veùÜ
<
Add»ss
>& 
f‹r_bË
,

346 
ušt32_t
 *
f‹r_h™
, ušt32_ˆ&
šdex
, cÚ¡ 
Add»ss
 &
add»ss
,

347 
¡ride
, 
boŞ
 &
®loc
)

350 
	g®loc
 = 
çl£
;

352 
Add»ss
 
	glše_addr
 = 
lše_add»ss
(
add»ss
);

353 
	gi
 = 0; i < 
	gm_num_un™_f‹rs
; i++) {

354 ià(
	gf‹r_bË
[
i
] =ğ
lše_addr
) {

355 
f‹r_bË
[
i
] = 
Ãxt_¡ride_add»ss
(f‹r_bË[i], 
¡ride
);

356 
	gf‹r_h™
[
i
]++;

357 ià(
	gf‹r_h™
[
i
] >ğ
m_Œaš_mis£s
) {

358 
®loc
 = 
Œue
;

360  
	gŒue
;

365 
	gloÿl_šdex
 = 
šdex
;

366 
	gf‹r_bË
[
loÿl_šdex
] = 
Ãxt_¡ride_add»ss
(
lše_addr
, 
¡ride
);

367 
	gf‹r_h™
[
loÿl_šdex
] = 0;

368 
	gloÿl_šdex
 = 
loÿl_šdex
 + 1;

369 ià(
	gloÿl_šdex
 >ğ
m_num_un™_f‹rs
) {

370 
loÿl_šdex
 = 0;

373 
	gšdex
 = 
loÿl_šdex
;

374  
	gçl£
;

377 
boŞ


378 
	gP»ãtch”
::
	$acûssNÚun™F‹r
(cÚ¡ 
Add»ss
& 
add»ss
, *
¡ride
,

379 
boŞ
 &
®loc
)

382 
®loc
 = 
çl£
;

385 
Add»ss
 
·ge_addr
 = 
	`·ge_add»ss
(
add»ss
);

386 
Add»ss
 
lše_addr
 = 
	`lše_add»ss
(
add»ss
);

388 
ušt32_t
 
i
 = 0; i < 
m_num_nÚun™_f‹rs
; i++) {

389 ià(
	`·ge_add»ss
(
m_nÚun™_f‹r
[
i
]è=ğ
·ge_addr
) {

392 
d–
 = 
lše_addr
.
	`g‘Add»ss
(è- 
m_nÚun™_f‹r
[
i
].getAddress();

394 ià(
d–
 != 0) {

397 ià(
d–
 =ğ
m_nÚun™_¡ride
[
i
]) {

400 
m_nÚun™_h™
[
i
]++;

401 ià(
m_nÚun™_h™
[
i
] > 
m_Œaš_mis£s
) {

405 *
¡ride
 = 
m_nÚun™_¡ride
[
i
]/
RubySy¡em
::
	`g‘BlockSizeBy‹s
();

408 
	`ş—rNÚun™EÁry
(
i
);

409 
®loc
 = 
Œue
;

413 
m_nÚun™_h™
[
i
] = 0;

417 
m_nÚun™_¡ride
[
i
] = 
d–
;

418 
m_nÚun™_f‹r
[
i
] = 
lše_addr
;

419  
Œue
;

421  
çl£
;

427 
m_nÚun™_f‹r
[
m_nÚun™_šdex
] = 
lše_addr
;

428 
m_nÚun™_¡ride
[
m_nÚun™_šdex
] = 0;

429 
m_nÚun™_h™
[
m_nÚun™_šdex
] = 0;

431 
m_nÚun™_šdex
 = m_nonunit_index + 1;

432 ià(
m_nÚun™_šdex
 >ğ
m_num_nÚun™_f‹rs
) {

433 
m_nÚun™_šdex
 = 0;

435  
çl£
;

436 
	}
}

439 
	gP»ãtch”
::
´št
(
¡d
::
o¡»am
& 
out
) const

441 
out
 << 
Çme
() << " Prefetcher State\n";

443 
	gout
 << "unitable:\n";

444 
	gi
 = 0; i < 
	gm_num_un™_f‹rs
; i++) {

445 
	gout
 << 
	gm_un™_f‹r
[
i
] << 
	g¡d
::
’dl
;

448 
	gout
 << "negativeable:\n";

449 
	gi
 = 0; i < 
	gm_num_un™_f‹rs
; i++) {

450 
	gout
 << 
	gm_Ãg©ive_f‹r
[
i
] << 
	g¡d
::
’dl
;

454 
	gout
 << "non-unitable:\n";

455 
	gi
 = 0; i < 
	gm_num_nÚun™_f‹rs
; i++) {

456 
	gout
 << 
	gm_nÚun™_f‹r
[
i
] << " "

457 << 
	gm_nÚun™_¡ride
[
i
] << " "

458 << 
	gm_nÚun™_h™
[
i
] << 
	g¡d
::
’dl
;

462 
	gout
 << "streams:\n";

463 
	gi
 = 0; i < 
	gm_num_¡»ams
; i++) {

464 
	gout
 << 
	gm_¬¿y
[
i
].
	gm_add»ss
 << " "

465 << 
	gm_¬¿y
[
i
].
	gm_¡ride
 << " "

466 << 
	gm_¬¿y
[
i
].
	gm_is_v®id
 << " "

467 << 
	gm_¬¿y
[
i
].
	gm_u£_time
 << 
	g¡d
::
’dl
;

	@ruby/structures/Prefetcher.hh

29 #iâdeà
PREFETCHER_H


30 
	#PREFETCHER_H


	)

34 
	~<b™£t
>

36 
	~"ba£/¡©i¡ics.hh
"

37 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

38 
	~"mem/ruby/commÚ/Add»ss.hh
"

39 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùCÚŒŞËr.hh
"

40 
	~"mem/ruby/¦icc_š‹rçû/RubyReque¡.hh
"

41 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

42 
	~"·¿ms/P»ãtch”.hh
"

43 
	~"sim/sim_objeù.hh
"

45 
	#MAX_PF_INFLIGHT
 8

	)

47 şas 
	cP»ãtchEÁry


49 
	mpublic
:

51 
	$P»ãtchEÁry
()

54 
m_¡ride
 = (1 << 
RubySy¡em
::
	`g‘BlockSizeB™s
());

55 
m_u£_time
 = 
	`Cyşes
(0);

56 
m_is_v®id
 = 
çl£
;

60 
Add»ss
 
m_add»ss
;

63 
m_¡ride
;

66 
Cyşes
 
m_u£_time
;

69 
boŞ
 
m_is_v®id
;

72 
RubyReque¡Ty³
 
m_ty³
;

76 
¡d
::
b™£t
<
MAX_PF_INFLIGHT
> 
»que¡Issued
;

77 
¡d
::
b™£t
<
MAX_PF_INFLIGHT
> 
»que¡Com¶‘ed
;

78 
	}
};

80 şas 
	cP»ãtch”
 : 
public
 
SimObjeù


82 
public
:

83 
P»ãtch”P¬ams
 
	tP¬ams
;

84 
P»ãtch”
(cÚ¡ 
P¬ams
 *
p
);

85 ~
P»ãtch”
();

87 
issueNextP»ãtch
(cÚ¡ 
Add»ss
 &
add»ss
, 
P»ãtchEÁry
 *
¡»am
);

94 
ob£rvePfH™
(cÚ¡ 
Add»ss
& 
add»ss
);

95 
ob£rvePfMiss
(cÚ¡ 
Add»ss
& 
add»ss
);

102 
ob£rveMiss
(cÚ¡ 
Add»ss
& 
add»ss
, cÚ¡ 
RubyReque¡Ty³
& 
ty³
);

107 
´št
(
¡d
::
o¡»am
& 
out
) const;

108 
	$£tCÚŒŞËr
(
Ab¡¿ùCÚŒŞËr
 *
_ù¾
)

109 { 
m_cÚŒŞËr
 = 
_ù¾
; }

111 
	`»gSts
();

113 
´iv©e
:

119 
ušt32_t
 
	`g‘LRUšdex
();

122 
	`ş—rNÚun™EÁry
(
ušt32_t
 
šdex
);

125 
	`š™ŸlizeSŒ—m
(cÚ¡ 
Add»ss
& 
add»ss
, 
¡ride
,

126 
ušt32_t
 
šdex
, cÚ¡ 
RubyReque¡Ty³
& 
ty³
);

130 
P»ãtchEÁry
* 
	`g‘P»ãtchEÁry
(cÚ¡ 
Add»ss
 &
add»ss
,

131 
ušt32_t
 &
šdex
);

134 
boŞ
 
	`acûssUn™F‹r
(
¡d
::
veùÜ
<
Add»ss
>& 
f‹r_bË
,

135 
ušt32_t
 *
h™_bË
, ušt32_ˆ&
šdex
, cÚ¡ 
Add»ss
 &
add»ss
,

136 
¡ride
, 
boŞ
 &
®loc
);

139 
boŞ
 
	`acûssNÚun™F‹r
(cÚ¡ 
Add»ss
& 
add»ss
, *
¡ride
,

140 
boŞ
 &
®loc
);

143 
ušt32_t
 
m_num_¡»ams
;

145 
¡d
::
veùÜ
<
P»ãtchEÁry
> 
m_¬¿y
;

148 
ušt32_t
 
m_Œaš_mis£s
;

150 
ušt32_t
 
m_num_¡¬tup_pfs
;

152 
ušt32_t
 
m_num_un™_f‹rs
;

154 
ušt32_t
 
m_num_nÚun™_f‹rs
;

158 
¡d
::
veùÜ
<
Add»ss
> 
m_un™_f‹r
;

160 
ušt32_t
 
m_un™_f‹r_šdex
;

163 
ušt32_t
 *
m_un™_f‹r_h™
;

167 
¡d
::
veùÜ
<
Add»ss
> 
m_Ãg©ive_f‹r
;

169 
ušt32_t
 
m_Ãg©ive_f‹r_šdex
;

172 
ušt32_t
 *
m_Ãg©ive_f‹r_h™
;

176 
¡d
::
veùÜ
<
Add»ss
> 
m_nÚun™_f‹r
;

178 *
m_nÚun™_¡ride
;

181 
ušt32_t
 *
m_nÚun™_h™
;

183 
ušt32_t
 
m_nÚun™_šdex
;

186 
boŞ
 
m_´eãtch_üoss_·ges
;

188 
Ab¡¿ùCÚŒŞËr
 *
m_cÚŒŞËr
;

191 
Sts
::
SÿÏr
 
numMissOb£rved
;

193 
Sts
::
SÿÏr
 
numAÎoÿ‹dSŒ—ms
;

195 
Sts
::
SÿÏr
 
numP»ãtchReque¡ed
;

197 
Sts
::
SÿÏr
 
numP»ãtchAcû±ed
;

199 
Sts
::
SÿÏr
 
numDrİ³dP»ãtches
;

201 
Sts
::
SÿÏr
 
numH™s
;

203 
Sts
::
SÿÏr
 
numP¬tŸlH™s
;

205 
Sts
::
SÿÏr
 
numPagesCros£d
;

207 
Sts
::
SÿÏr
 
numMis£dP»ãtchedBlocks
;

208 
	}
};

	@ruby/system/AbstractReplacementPolicy.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_ABSTRACTREPLACEMENTPOLICY_HH__


30 
	#__MEM_RUBY_SYSTEM_ABSTRACTREPLACEMENTPOLICY_HH__


	)

32 
	~"ba£/ty³s.hh
"

34 şas 
	cAb¡¿ùR•Ïûm’tPŞicy


36 
	mpublic
:

37 
Ab¡¿ùR•Ïûm’tPŞicy
(
Index
 
num_£ts
, Index 
assoc
);

38 
	mvœtu®
 ~
Ab¡¿ùR•Ïûm’tPŞicy
();

41 
vœtu®
 
touch
(
Index
 
£t
, Index 
way
, 
Tick
 
time
) = 0;

44 
vœtu®
 
Index
 
	$g‘Viùim
(
Index
 
£t
) const = 0;

47 
Tick
 
	`g‘La¡Acûss
(
Index
 
£t
, Index 
way
);

49 
´Ùeùed
:

50 
m_num_£ts
;

51 
m_assoc
;

52 
Tick
 **
m_Ï¡_»f_±r
;

55 
šlše


56 
Ab¡¿ùR•Ïûm’tPŞicy
::
	$Ab¡¿ùR•Ïûm’tPŞicy
(
Index
 
num_£ts
,

57 
Index
 
assoc
)

59 
m_num_£ts
 = 
num_£ts
;

60 
m_assoc
 = 
assoc
;

61 
m_Ï¡_»f_±r
 = 
Ãw
 
Tick
*[
m_num_£ts
];

62 
i
 = 0; i < 
m_num_£ts
; i++){

63 
m_Ï¡_»f_±r
[
i
] = 
Ãw
 
Tick
[
m_assoc
];

64 
j
 = 0; j < 
m_assoc
; j++){

65 
m_Ï¡_»f_±r
[
i
][
j
] = 0;

68 
	}
}

70 
šlše


71 
	gAb¡¿ùR•Ïûm’tPŞicy
::~
	$Ab¡¿ùR•Ïûm’tPŞicy
()

73 ià(
m_Ï¡_»f_±r
 !ğ
NULL
){

74 
i
 = 0; i < 
m_num_£ts
; i++){

75 ià(
m_Ï¡_»f_±r
[
i
] !ğ
NULL
){

76 
d–‘e
[] 
m_Ï¡_»f_±r
[
i
];

79 
d–‘e
[] 
m_Ï¡_»f_±r
;

81 
	}
}

83 
šlše
 
Tick


84 
	gAb¡¿ùR•Ïûm’tPŞicy
::
	$g‘La¡Acûss
(
Index
 
£t
, Index 
way
)

86  
m_Ï¡_»f_±r
[
£t
][
way
];

87 
	}
}

	@ruby/system/BankedArray.cc

32 
	~"ba£/štm©h.hh
"

33 
	~"mem/ruby/sy¡em/BªkedA¼ay.hh
"

34 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

36 
	gBªkedA¼ay
::
	$BªkedA¼ay
(
bªks
, 
Cyşes
 
acûssL©’cy
,

37 
¡¬tIndexB™
)

39 
this
->
bªks
 = banks;

40 
this
->
acûssL©’cy
 =‡ccessLatency;

41 
this
->
¡¬tIndexB™
 = startIndexBit;

43 ià(
bªks
 != 0) {

44 
bªkB™s
 = 
	`æoÜLog2
(
bªks
);

47 
busyBªks
.
	`»size
(
bªks
);

48 
	}
}

50 
boŞ


51 
	gBªkedA¼ay
::
	$ŒyAcûss
(
Index
 
idx
)

53 ià(
acûssL©’cy
 == 0)

54  
Œue
;

56 
bªk
 = 
	`m­IndexToBªk
(
idx
);

57 
	`as£¹
(
bªk
 < 
bªks
);

59 ià(
busyBªks
[
bªk
].
’dAcûss
 >ğ
	`curTick
()) {

60 ià(!(
busyBªks
[
bªk
].
¡¬tAcûss
 =ğ
	`curTick
() &&

61 
busyBªks
[
bªk
].
idx
 == idx)) {

62  
çl£
;

66  
Œue
;

70 
busyBªks
[
bªk
].
idx
 = idx;

71 
busyBªks
[
bªk
].
¡¬tAcûss
 = 
	`curTick
();

72 
busyBªks
[
bªk
].
’dAcûss
 = 
	`curTick
() +

73 (
acûssL©’cy
-1è* 
g_sy¡em_±r
->
	`şockP”iod
();

75  
Œue
;

76 
	}
}

79 
	gBªkedA¼ay
::
	$m­IndexToBªk
(
Index
 
idx
)

81 ià(
bªks
 == 1) {

84  
idx
 % 
bªks
;

85 
	}
}

	@ruby/system/BankedArray.hh

32 #iâdeà
__MEM_RUBY_SYSTEM_BANKEDARRAY_HH__


33 
	#__MEM_RUBY_SYSTEM_BANKEDARRAY_HH__


	)

35 
	~<veùÜ
>

37 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

38 
	~"sim/cÜe.hh
"

40 şas 
	cBªkedA¼ay


42 
	m´iv©e
:

43 
bªks
;

44 
Cyşes
 
	macûssL©’cy
;

45 
	mbªkB™s
;

46 
	m¡¬tIndexB™
;

48 şas 
	cAcûssRecÜd


50 
	mpublic
:

51 
AcûssRecÜd
(è: 
idx
(0), 
¡¬tAcûss
(0), 
’dAcûss
(0) {}

52 
Index
 
	midx
;

53 
Tick
 
	m¡¬tAcûss
;

54 
Tick
 
	m’dAcûss
;

59 
	g¡d
::
veùÜ
<
AcûssRecÜd
> 
busyBªks
;

61 
m­IndexToBªk
(
Index
 
idx
);

63 
	gpublic
:

64 
BªkedA¼ay
(
bªks
, 
Cyşes
 
acûssL©’cy
, 
¡¬tIndexB™
);

68 
boŞ
 
ŒyAcûss
(
Index
 
idx
);

	@ruby/system/CacheMemory.cc

29 
	~"ba£/štm©h.hh
"

30 
	~"debug/RubyCache.hh
"

31 
	~"debug/RubyCacheT¿û.hh
"

32 
	~"debug/RubyResourûSÎs.hh
"

33 
	~"debug/RubySts.hh
"

34 
	~"mem/´ÙocŞ/AcûssP”missiÚ.hh
"

35 
	~"mem/ruby/sy¡em/CacheMemÜy.hh
"

36 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

38 
usšg
 
Çme¥aû
 
	g¡d
;

40 
	go¡»am
&

41 
	gİ”©Ü
<<(
	go¡»am
& 
	gout
, cÚ¡ 
	gCacheMemÜy
& 
	gobj
)

43 
	gobj
.
´št
(
out
);

44 
	gout
 << 
	gæush
;

45  
	gout
;

48 
CacheMemÜy
 *

49 
	gRubyCacheP¬ams
::
	$ü—‹
()

51  
Ãw
 
	`CacheMemÜy
(
this
);

52 
	}
}

54 
	gCacheMemÜy
::
	$CacheMemÜy
(cÚ¡ 
P¬ams
 *
p
)

55 : 
	`SimObjeù
(
p
),

56 
	`d©aA¼ay
(
p
->
d©aA¼ayBªks
,…->
d©aAcûssL©’cy
,…->
¡¬t_šdex_b™
),

57 
	`gA¼ay
(
p
->
gA¼ayBªks
,…->
gAcûssL©’cy
,…->
¡¬t_šdex_b™
)

59 
m_ÿche_size
 = 
p
->
size
;

60 
m_Ï‹ncy
 = 
p
->
Ï‹ncy
;

61 
m_ÿche_assoc
 = 
p
->
assoc
;

62 
m_pŞicy
 = 
p
->
»¶aûm’t_pŞicy
;

63 
m_¡¬t_šdex_b™
 = 
p
->
¡¬t_šdex_b™
;

64 
m_is_š¡ruùiÚ_Úly_ÿche
 = 
p
->
is_iÿche
;

65 
m_»sourû_¡®ls
 = 
p
->
»sourûSÎs
;

66 
	}
}

69 
	gCacheMemÜy
::
	$š™
()

71 
m_ÿche_num_£ts
 = (
m_ÿche_size
 / 
m_ÿche_assoc
) /

72 
RubySy¡em
::
	`g‘BlockSizeBy‹s
();

73 
	`as£¹
(
m_ÿche_num_£ts
 > 1);

74 
m_ÿche_num_£t_b™s
 = 
	`æoÜLog2
(
m_ÿche_num_£ts
);

75 
	`as£¹
(
m_ÿche_num_£t_b™s
 > 0);

77 ià(
m_pŞicy
 == "PSEUDO_LRU")

78 
m_»¶aûm’tPŞicy_±r
 =

79 
Ãw
 
	`P£udoLRUPŞicy
(
m_ÿche_num_£ts
, 
m_ÿche_assoc
);

80 ià(
m_pŞicy
 == "LRU")

81 
m_»¶aûm’tPŞicy_±r
 =

82 
Ãw
 
	`LRUPŞicy
(
m_ÿche_num_£ts
, 
m_ÿche_assoc
);

84 
	`as£¹
(
çl£
);

86 
m_ÿche
.
	`»size
(
m_ÿche_num_£ts
);

87 
i
 = 0; i < 
m_ÿche_num_£ts
; i++) {

88 
m_ÿche
[
i
].
	`»size
(
m_ÿche_assoc
);

89 
j
 = 0; j < 
m_ÿche_assoc
; j++) {

90 
m_ÿche
[
i
][
j
] = 
NULL
;

93 
	}
}

95 
	gCacheMemÜy
::~
	$CacheMemÜy
()

97 ià(
m_»¶aûm’tPŞicy_±r
 !ğ
NULL
)

98 
d–‘e
 
m_»¶aûm’tPŞicy_±r
;

99 
i
 = 0; i < 
m_ÿche_num_£ts
; i++) {

100 
j
 = 0; j < 
m_ÿche_assoc
; j++) {

101 
d–‘e
 
m_ÿche
[
i
][
j
];

104 
	}
}

107 
Index


108 
	gCacheMemÜy
::
	$add»ssToCacheS‘
(cÚ¡ 
Add»ss
& 
add»ss
) const

110 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

111  
add»ss
.
	`b™S–eù
(
m_¡¬t_šdex_b™
,

112 
m_¡¬t_šdex_b™
 + 
m_ÿche_num_£t_b™s
 - 1);

113 
	}
}

118 
	gCacheMemÜy
::
	$fšdTagInS‘
(
Index
 
ÿcheS‘
, cÚ¡ 
Add»ss
& 
g
) const

120 
	`as£¹
(
g
 =ğ
	`lše_add»ss
(tag));

122 
m5
::
hash_m­
<
Add»ss
, >::
cÚ¡_™”©Ü
 
™
 = 
m_g_šdex
.
	`fšd
(
g
);

123 ià(
™
 !ğ
m_g_šdex
.
	`’d
())

124 ià(
m_ÿche
[
ÿcheS‘
][
™
->
£cÚd
]->
m_P”missiÚ
 !=

125 
AcûssP”missiÚ_NÙP»£Á
)

126  
™
->
£cÚd
;

128 
	}
}

133 
	gCacheMemÜy
::
	$fšdTagInS‘IgnÜeP”missiÚs
(
Index
 
ÿcheS‘
,

134 cÚ¡ 
Add»ss
& 
g
) const

136 
	`as£¹
(
g
 =ğ
	`lše_add»ss
(tag));

138 
m5
::
hash_m­
<
Add»ss
, >::
cÚ¡_™”©Ü
 
™
 = 
m_g_šdex
.
	`fšd
(
g
);

139 ià(
™
 !ğ
m_g_šdex
.
	`’d
())

140  
™
->
£cÚd
;

142 
	}
}

144 
boŞ


145 
	gCacheMemÜy
::
	$ŒyCacheAcûss
(cÚ¡ 
Add»ss
& 
add»ss
, 
RubyReque¡Ty³
 
ty³
,

146 
D©aBlock
*& 
d©a_±r
)

148 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

149 
	`DPRINTF
(
RubyCache
, "add»ss: %s\n", 
add»ss
);

150 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

151 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

152 ià(
loc
 != -1) {

154 
Ab¡¿ùCacheEÁry
* 
’Œy
 = 
m_ÿche
[
ÿcheS‘
][
loc
];

155 
m_»¶aûm’tPŞicy_±r
->
	`touch
(
ÿcheS‘
, 
loc
, 
	`curTick
());

156 
d©a_±r
 = &(
’Œy
->
	`g‘D©aBlk
());

158 ià(
’Œy
->
m_P”missiÚ
 =ğ
AcûssP”missiÚ_R—d_Wr™e
) {

159  
Œue
;

161 ià((
’Œy
->
m_P”missiÚ
 =ğ
AcûssP”missiÚ_R—d_OÆy
) &&

162 (
ty³
 =ğ
RubyReque¡Ty³_LD
 ||y³ =ğ
RubyReque¡Ty³_IFETCH
)) {

163  
Œue
;

167 
d©a_±r
 = 
NULL
;

168  
çl£
;

169 
	}
}

171 
boŞ


172 
	gCacheMemÜy
::
	$‹¡CacheAcûss
(cÚ¡ 
Add»ss
& 
add»ss
, 
RubyReque¡Ty³
 
ty³
,

173 
D©aBlock
*& 
d©a_±r
)

175 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

176 
	`DPRINTF
(
RubyCache
, "add»ss: %s\n", 
add»ss
);

177 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

178 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

180 ià(
loc
 != -1) {

182 
Ab¡¿ùCacheEÁry
* 
’Œy
 = 
m_ÿche
[
ÿcheS‘
][
loc
];

183 
m_»¶aûm’tPŞicy_±r
->
	`touch
(
ÿcheS‘
, 
loc
, 
	`curTick
());

184 
d©a_±r
 = &(
’Œy
->
	`g‘D©aBlk
());

186  
m_ÿche
[
ÿcheS‘
][
loc
]->
m_P”missiÚ
 !=

187 
AcûssP”missiÚ_NÙP»£Á
;

190 
d©a_±r
 = 
NULL
;

191  
çl£
;

192 
	}
}

195 
boŞ


196 
	gCacheMemÜy
::
	$isTagP»£Á
(cÚ¡ 
Add»ss
& 
add»ss
) const

198 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

199 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

200 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

202 ià(
loc
 == -1) {

204 
	`DPRINTF
(
RubyCache
, "NØg m©ch fÜ‡dd»ss: %s\n", 
add»ss
);

205  
çl£
;

207 
	`DPRINTF
(
RubyCache
, "add»ss: % found\n", 
add»ss
);

208  
Œue
;

209 
	}
}

214 
boŞ


215 
	gCacheMemÜy
::
	$ÿcheAva
(cÚ¡ 
Add»ss
& 
add»ss
) const

217 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

219 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

221 
i
 = 0; i < 
m_ÿche_assoc
; i++) {

222 
Ab¡¿ùCacheEÁry
* 
’Œy
 = 
m_ÿche
[
ÿcheS‘
][
i
];

223 ià(
’Œy
 !ğ
NULL
) {

224 ià(
’Œy
->
m_Add»ss
 =ğ
add»ss
 ||

225 
’Œy
->
m_P”missiÚ
 =ğ
AcûssP”missiÚ_NÙP»£Á
) {

227  
Œue
;

230  
Œue
;

233  
çl£
;

234 
	}
}

236 
Ab¡¿ùCacheEÁry
*

237 
	gCacheMemÜy
::
	$®loÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
, 
Ab¡¿ùCacheEÁry
* 
’Œy
)

239 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

240 
	`as£¹
(!
	`isTagP»£Á
(
add»ss
));

241 
	`as£¹
(
	`ÿcheAva
(
add»ss
));

242 
	`DPRINTF
(
RubyCache
, "add»ss: %s\n", 
add»ss
);

245 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

246 
¡d
::
veùÜ
<
Ab¡¿ùCacheEÁry
*> &
£t
 = 
m_ÿche
[
ÿcheS‘
];

247 
i
 = 0; i < 
m_ÿche_assoc
; i++) {

248 ià(!
£t
[
i
] || s‘[i]->
m_P”missiÚ
 =ğ
AcûssP”missiÚ_NÙP»£Á
) {

249 
£t
[
i
] = 
’Œy
;

250 
£t
[
i
]->
m_Add»ss
 = 
add»ss
;

251 
£t
[
i
]->
m_P”missiÚ
 = 
AcûssP”missiÚ_Inv®id
;

252 
	`DPRINTF
(
RubyCache
, "Allocate clearing†ock for‡ddr: %x\n",

253 
add»ss
);

254 
£t
[
i
]->
m_locked
 = -1;

255 
m_g_šdex
[
add»ss
] = 
i
;

257 
m_»¶aûm’tPŞicy_±r
->
	`touch
(
ÿcheS‘
, 
i
, 
	`curTick
());

259  
’Œy
;

262 
	`·nic
("Allocate didn't find‡n‡vailableƒntry");

263 
	}
}

266 
	gCacheMemÜy
::
	$d—Îoÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
)

268 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

269 
	`as£¹
(
	`isTagP»£Á
(
add»ss
));

270 
	`DPRINTF
(
RubyCache
, "add»ss: %s\n", 
add»ss
);

271 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

272 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

273 ià(
loc
 != -1) {

274 
d–‘e
 
m_ÿche
[
ÿcheS‘
][
loc
];

275 
m_ÿche
[
ÿcheS‘
][
loc
] = 
NULL
;

276 
m_g_šdex
.
	`”a£
(
add»ss
);

278 
	}
}

281 
Add»ss


282 
	gCacheMemÜy
::
	$ÿcheProbe
(cÚ¡ 
Add»ss
& 
add»ss
) const

284 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

285 
	`as£¹
(!
	`ÿcheAva
(
add»ss
));

287 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

288  
m_ÿche
[
ÿcheS‘
][
m_»¶aûm’tPŞicy_±r
->
	`g‘Viùim
(cacheSet)]->

289 
m_Add»ss
;

290 
	}
}

293 
Ab¡¿ùCacheEÁry
*

294 
	gCacheMemÜy
::
	$lookup
(cÚ¡ 
Add»ss
& 
add»ss
)

296 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

297 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

298 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

299 if(
loc
 =ğ-1è 
NULL
;

300  
m_ÿche
[
ÿcheS‘
][
loc
];

301 
	}
}

304 cÚ¡ 
Ab¡¿ùCacheEÁry
*

305 
	gCacheMemÜy
::
	$lookup
(cÚ¡ 
Add»ss
& 
add»ss
) const

307 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

308 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

309 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

310 if(
loc
 =ğ-1è 
NULL
;

311  
m_ÿche
[
ÿcheS‘
][
loc
];

312 
	}
}

316 
	gCacheMemÜy
::
	$£tMRU
(cÚ¡ 
Add»ss
& 
add»ss
)

318 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

319 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

321 if(
loc
 != -1)

322 
m_»¶aûm’tPŞicy_±r
->
	`touch
(
ÿcheS‘
, 
loc
, 
	`curTick
());

323 
	}
}

326 
	gCacheMemÜy
::
	$»cÜdCacheCÚ‹Ás
(
úŒl
, 
CacheRecÜd”
* 
Œ
) const

328 
ušt64
 
w¬medUpBlocks
 = 0;

329 
ušt64
 
tÙ®Blocks
 
M5_VAR_USED
 = (ušt64)
m_ÿche_num_£ts


330 * (
ušt64
)
m_ÿche_assoc
;

332 
i
 = 0; i < 
m_ÿche_num_£ts
; i++) {

333 
j
 = 0; j < 
m_ÿche_assoc
; j++) {

334 ià(
m_ÿche
[
i
][
j
] !ğ
NULL
) {

335 
AcûssP”missiÚ
 
³rm
 = 
m_ÿche
[
i
][
j
]->
m_P”missiÚ
;

336 
RubyReque¡Ty³
 
»que¡_ty³
 = 
RubyReque¡Ty³_NULL
;

337 ià(
³rm
 =ğ
AcûssP”missiÚ_R—d_OÆy
) {

338 ià(
m_is_š¡ruùiÚ_Úly_ÿche
) {

339 
»que¡_ty³
 = 
RubyReque¡Ty³_IFETCH
;

341 
»que¡_ty³
 = 
RubyReque¡Ty³_LD
;

343 } ià(
³rm
 =ğ
AcûssP”missiÚ_R—d_Wr™e
) {

344 
»que¡_ty³
 = 
RubyReque¡Ty³_ST
;

347 ià(
»que¡_ty³
 !ğ
RubyReque¡Ty³_NULL
) {

348 
Œ
->
	`addRecÜd
(
úŒl
, 
m_ÿche
[
i
][
j
]->
m_Add»ss
.
	`g‘Add»ss
(),

349 0, 
»que¡_ty³
,

350 
m_»¶aûm’tPŞicy_±r
->
	`g‘La¡Acûss
(
i
, 
j
),

351 
m_ÿche
[
i
][
j
]->
	`g‘D©aBlk
());

352 
w¬medUpBlocks
++;

358 
	`DPRINTF
(
RubyCacheT¿û
, "%s: %lli blocks of %lliotal blocks"

359 "»cÜded %.2f%% \n", 
	`Çme
().
	`c_¡r
(), 
w¬medUpBlocks
,

360 (
ušt64
)
m_ÿche_num_£ts
 * (ušt64)
m_ÿche_assoc
,

361 ((
w¬medUpBlocks
)/(
tÙ®Blocks
))*100.0);

362 
	}
}

365 
	gCacheMemÜy
::
	$´št
(
o¡»am
& 
out
) const

367 
out
 << "Cachdump: " << 
m_ÿche_Çme
 << 
’dl
;

368 
i
 = 0; i < 
m_ÿche_num_£ts
; i++) {

369 
j
 = 0; j < 
m_ÿche_assoc
; j++) {

370 ià(
m_ÿche
[
i
][
j
] !ğ
NULL
) {

371 
out
 << " Index: " << 
i


372 << " way: " << 
j


373 << "ƒÁry: " << *
m_ÿche
[
i
][
j
] << 
’dl
;

375 
out
 << " Index: " << 
i


376 << " way: " << 
j


377 << "ƒÁry: NULL" << 
’dl
;

381 
	}
}

384 
	gCacheMemÜy
::
	$´štD©a
(
o¡»am
& 
out
) const

386 
out
 << "´štD©a(ènÙ suµÜ‹d" << 
’dl
;

387 
	}
}

390 
	gCacheMemÜy
::
	$£tLocked
(cÚ¡ 
Add»ss
& 
add»ss
, 
cÚ‹xt
)

392 
	`DPRINTF
(
RubyCache
, "S‘tšg Lock fÜ‡ddr: %xØ%d\n", 
add»ss
, 
cÚ‹xt
);

393 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

394 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

395 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

396 
	`as£¹
(
loc
 != -1);

397 
m_ÿche
[
ÿcheS‘
][
loc
]->
m_locked
 = 
cÚ‹xt
;

398 
	}
}

401 
	gCacheMemÜy
::
	$ş—rLocked
(cÚ¡ 
Add»ss
& 
add»ss
)

403 
	`DPRINTF
(
RubyCache
, "CË¬ Lock fÜ‡ddr: %x\n", 
add»ss
);

404 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

405 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

406 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

407 
	`as£¹
(
loc
 != -1);

408 
m_ÿche
[
ÿcheS‘
][
loc
]->
m_locked
 = -1;

409 
	}
}

411 
boŞ


412 
	gCacheMemÜy
::
	$isLocked
(cÚ¡ 
Add»ss
& 
add»ss
, 
cÚ‹xt
)

414 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

415 
Index
 
ÿcheS‘
 = 
	`add»ssToCacheS‘
(
add»ss
);

416 
loc
 = 
	`fšdTagInS‘
(
ÿcheS‘
, 
add»ss
);

417 
	`as£¹
(
loc
 != -1);

418 
	`DPRINTF
(
RubyCache
, "Testing Lock for‡ddr: %llx cur %d con %d\n",

419 
add»ss
, 
m_ÿche
[
ÿcheS‘
][
loc
]->
m_locked
, 
cÚ‹xt
);

420  
m_ÿche
[
ÿcheS‘
][
loc
]->
m_locked
 =ğ
cÚ‹xt
;

421 
	}
}

424 
	gCacheMemÜy
::
	$»gSts
()

426 
m_demªd_h™s


427 .
	`Çme
(name() + ".demand_hits")

428 .
	`desc
("Number of cache demand hits")

431 
m_demªd_mis£s


432 .
	`Çme
(name() + ".demand_misses")

433 .
	`desc
("Number of cache demand misses")

436 
m_demªd_acûs£s


437 .
	`Çme
(name() + ".demand_accesses")

438 .
	`desc
("Number of cache demand‡ccesses")

441 
m_demªd_acûs£s
 = 
m_demªd_h™s
 + 
m_demªd_mis£s
;

443 
m_sw_´eãtches


444 .
	`Çme
(name() + ".total_sw_prefetches")

445 .
	`desc
("Number of software…refetches")

446 .
	`æags
(
Sts
::
noz”o
)

449 
m_hw_´eãtches


450 .
	`Çme
(name() + ".total_hw_prefetches")

451 .
	`desc
("Number of hardware…refetches")

452 .
	`æags
(
Sts
::
noz”o
)

455 
m_´eãtches


456 .
	`Çme
(name() + ".total_prefetches")

457 .
	`desc
("Number of…refetches")

458 .
	`æags
(
Sts
::
noz”o
)

461 
m_´eãtches
 = 
m_sw_´eãtches
 + 
m_hw_´eãtches
;

463 
m_acûssModeTy³


464 .
	`š™
(
RubyReque¡Ty³_NUM
)

465 .
	`Çme
(name() + ".access_mode")

466 .
	`æags
(
Sts
::
pdf
 | Sts::
tÙ®
)

468 
i
 = 0; i < 
RubyAcûssMode_NUM
; i++) {

469 
m_acûssModeTy³


470 .
	`subÇme
(
i
, 
	`RubyAcûssMode_to_¡ršg
(
	`RubyAcûssMode
(i)))

471 .
	`æags
(
Sts
::
noz”o
)

475 
numD©aA¼ayR—ds


476 .
	`Çme
(name() + ".num_data_array_reads")

477 .
	`desc
("number of data‡rray„eads")

478 .
	`æags
(
Sts
::
noz”o
)

481 
numD©aA¼ayWr™es


482 .
	`Çme
(name() + ".num_data_array_writes")

483 .
	`desc
("number of data‡rray writes")

484 .
	`æags
(
Sts
::
noz”o
)

487 
numTagA¼ayR—ds


488 .
	`Çme
(name() + ".num_tag_array_reads")

489 .
	`desc
("number ofag‡rray„eads")

490 .
	`æags
(
Sts
::
noz”o
)

493 
numTagA¼ayWr™es


494 .
	`Çme
(name() + ".num_tag_array_writes")

495 .
	`desc
("number ofag‡rray writes")

496 .
	`æags
(
Sts
::
noz”o
)

499 
numTagA¼aySÎs


500 .
	`Çme
(name() + ".num_tag_array_stalls")

501 .
	`desc
("number of stalls caused byag‡rray")

502 .
	`æags
(
Sts
::
noz”o
)

505 
numD©aA¼aySÎs


506 .
	`Çme
(name() + ".num_data_array_stalls")

507 .
	`desc
("number of stalls caused by data‡rray")

508 .
	`æags
(
Sts
::
noz”o
)

510 
	}
}

513 
	gCacheMemÜy
::
	$»cÜdReque¡Ty³
(
CacheReque¡Ty³
 
»que¡Ty³
)

515 
	`DPRINTF
(
RubySts
, "Recorded statistic: %s\n",

516 
	`CacheReque¡Ty³_to_¡ršg
(
»que¡Ty³
));

517 
»que¡Ty³
) {

518 
CacheReque¡Ty³_D©aA¼ayR—d
:

519 
numD©aA¼ayR—ds
++;

521 
CacheReque¡Ty³_D©aA¼ayWr™e
:

522 
numD©aA¼ayWr™es
++;

524 
CacheReque¡Ty³_TagA¼ayR—d
:

525 
numTagA¼ayR—ds
++;

527 
CacheReque¡Ty³_TagA¼ayWr™e
:

528 
numTagA¼ayWr™es
++;

531 
	`w¬n
("CacheMemory‡ccess_type‚ot found: %s",

532 
	`CacheReque¡Ty³_to_¡ršg
(
»que¡Ty³
));

534 
	}
}

536 
boŞ


537 
	gCacheMemÜy
::
	$checkResourûAvaabË
(
CacheResourûTy³
 
»s
, 
Add»ss
 
addr
)

539 ià(!
m_»sourû_¡®ls
) {

540  
Œue
;

543 ià(
»s
 =ğ
CacheResourûTy³_TagA¼ay
) {

544 ià(
gA¼ay
.
	`ŒyAcûss
(
	`add»ssToCacheS‘
(
addr
))è 
Œue
;

546 
	`DPRINTF
(
RubyResourûSÎs
,

548 
addr
, 
	`add»ssToCacheS‘
(addr));

549 
numTagA¼aySÎs
++;

550  
çl£
;

552 } ià(
»s
 =ğ
CacheResourûTy³_D©aA¼ay
) {

553 ià(
d©aA¼ay
.
	`ŒyAcûss
(
	`add»ssToCacheS‘
(
addr
))è 
Œue
;

555 
	`DPRINTF
(
RubyResourûSÎs
,

557 
addr
, 
	`add»ssToCacheS‘
(addr));

558 
numD©aA¼aySÎs
++;

559  
çl£
;

562 
	`as£¹
(
çl£
);

563  
Œue
;

565 
	}
}

	@ruby/system/CacheMemory.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_CACHEMEMORY_HH__


30 
	#__MEM_RUBY_SYSTEM_CACHEMEMORY_HH__


	)

32 
	~<¡ršg
>

33 
	~<veùÜ
>

35 
	~"ba£/hashm­.hh
"

36 
	~"ba£/¡©i¡ics.hh
"

37 
	~"mem/´ÙocŞ/CacheResourûTy³.hh
"

38 
	~"mem/´ÙocŞ/CacheReque¡Ty³.hh
"

39 
	~"mem/´ÙocŞ/RubyReque¡.hh
"

40 
	~"mem/ruby/commÚ/D©aBlock.hh
"

41 
	~"mem/ruby/»cÜd”/CacheRecÜd”.hh
"

42 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùCacheEÁry.hh
"

43 
	~"mem/ruby/¦icc_š‹rçû/RubySlicc_CompÚ’tM­pšg.hh
"

44 
	~"mem/ruby/sy¡em/BªkedA¼ay.hh
"

45 
	~"mem/ruby/sy¡em/LRUPŞicy.hh
"

46 
	~"mem/ruby/sy¡em/P£udoLRUPŞicy.hh
"

47 
	~"·¿ms/RubyCache.hh
"

48 
	~"sim/sim_objeù.hh
"

50 şas 
	cCacheMemÜy
 : 
public
 
SimObjeù


52 
public
:

53 
RubyCacheP¬ams
 
	tP¬ams
;

54 
CacheMemÜy
(cÚ¡ 
P¬ams
 *
p
);

55 ~
CacheMemÜy
();

57 
š™
();

61 
boŞ
 
ŒyCacheAcûss
(cÚ¡ 
Add»ss
& 
add»ss
, 
RubyReque¡Ty³
 
ty³
,

62 
D©aBlock
*& 
d©a_±r
);

65 
boŞ
 
‹¡CacheAcûss
(cÚ¡ 
Add»ss
& 
add»ss
, 
RubyReque¡Ty³
 
ty³
,

66 
D©aBlock
*& 
d©a_±r
);

69 
boŞ
 
	$isTagP»£Á
(cÚ¡ 
Add»ss
& 
add»ss
) const;

74 
boŞ
 
	$ÿcheAva
(cÚ¡ 
Add»ss
& 
add»ss
) const;

77 
Ab¡¿ùCacheEÁry
* 
	`®loÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
, Ab¡¿ùCacheEÁry* 
Ãw_’Œy
);

78 
	$®loÿ‹Void
(cÚ¡ 
Add»ss
& 
add»ss
, 
Ab¡¿ùCacheEÁry
* 
Ãw_’Œy
)

80 
	`®loÿ‹
(
add»ss
, 
Ãw_’Œy
);

84 
	`d—Îoÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
);

87 
Add»ss
 
	$ÿcheProbe
(cÚ¡ 
Add»ss
& 
add»ss
) const;

90 
Ab¡¿ùCacheEÁry
* 
	`lookup
(cÚ¡ 
Add»ss
& 
add»ss
);

91 cÚ¡ 
Ab¡¿ùCacheEÁry
* 
	$lookup
(cÚ¡ 
Add»ss
& 
add»ss
) const;

93 
Cyşes
 
	$g‘L©’cy
(ècÚ¡ {  
m_Ï‹ncy
; 
	}
}

96 
	$»cÜdCacheCÚ‹Ás
(
úŒl
, 
CacheRecÜd”
* 
Œ
) const;

99 
	`£tMRU
(cÚ¡ 
Add»ss
& 
add»ss
);

101 
	`£tLocked
 (cÚ¡ 
Add»ss
& 
addr
, 
cÚ‹xt
);

102 
	`ş—rLocked
 (cÚ¡ 
Add»ss
& 
addr
);

103 
boŞ
 
	`isLocked
 (cÚ¡ 
Add»ss
& 
addr
, 
cÚ‹xt
);

106 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

107 
	`´štD©a
(
¡d
::
o¡»am
& 
out
) const;

109 
	`»gSts
();

110 
boŞ
 
	`checkResourûAvaabË
(
CacheResourûTy³
 
»s
, 
Add»ss
 
addr
);

111 
	`»cÜdReque¡Ty³
(
CacheReque¡Ty³
 
»que¡Ty³
);

113 
public
:

114 
Sts
::
SÿÏr
 
m_demªd_h™s
;

115 
Sts
::
SÿÏr
 
m_demªd_mis£s
;

116 
Sts
::
FÜmuÏ
 
m_demªd_acûs£s
;

118 
Sts
::
SÿÏr
 
m_sw_´eãtches
;

119 
Sts
::
SÿÏr
 
m_hw_´eãtches
;

120 
Sts
::
FÜmuÏ
 
m_´eãtches
;

122 
Sts
::
VeùÜ
 
m_acûssModeTy³
;

124 
Sts
::
SÿÏr
 
numD©aA¼ayR—ds
;

125 
Sts
::
SÿÏr
 
numD©aA¼ayWr™es
;

126 
Sts
::
SÿÏr
 
numTagA¼ayR—ds
;

127 
Sts
::
SÿÏr
 
numTagA¼ayWr™es
;

129 
Sts
::
SÿÏr
 
numTagA¼aySÎs
;

130 
Sts
::
SÿÏr
 
numD©aA¼aySÎs
;

132 
´iv©e
:

134 
Index
 
	$add»ssToCacheS‘
(cÚ¡ 
Add»ss
& 
add»ss
) const;

138 
	$fšdTagInS‘
(
Index
 
lše
, cÚ¡ 
Add»ss
& 
g
) const;

139 
	$fšdTagInS‘IgnÜeP”missiÚs
(
Index
 
ÿcheS‘
,

140 cÚ¡ 
Add»ss
& 
g
) const;

143 
	`CacheMemÜy
(cÚ¡ 
CacheMemÜy
& 
obj
);

144 
CacheMemÜy
& 
İ”©Ü
=(cÚ¡ CacheMemÜy& 
obj
);

146 
´iv©e
:

147 cÚ¡ 
¡d
::
¡ršg
 
m_ÿche_Çme
;

148 
Cyşes
 
m_Ï‹ncy
;

151 
boŞ
 
m_is_š¡ruùiÚ_Úly_ÿche
;

155 
m5
::
hash_m­
<
Add»ss
, > 
m_g_šdex
;

156 
¡d
::
veùÜ
<¡d::veùÜ<
Ab¡¿ùCacheEÁry
*> > 
m_ÿche
;

158 
Ab¡¿ùR•Ïûm’tPŞicy
 *
m_»¶aûm’tPŞicy_±r
;

160 
BªkedA¼ay
 
d©aA¼ay
;

161 
BªkedA¼ay
 
gA¼ay
;

163 
m_ÿche_size
;

164 
¡d
::
¡ršg
 
m_pŞicy
;

165 
m_ÿche_num_£ts
;

166 
m_ÿche_num_£t_b™s
;

167 
m_ÿche_assoc
;

168 
m_¡¬t_šdex_b™
;

169 
boŞ
 
m_»sourû_¡®ls
;

170 
	}
};

172 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am& 
out
, cÚ¡ 
	gCacheMemÜy
& 
	gobj
);

	@ruby/system/DMASequencer.cc

29 
	~"debug/RubyDma.hh
"

30 
	~"debug/RubySts.hh
"

31 
	~"mem/´ÙocŞ/Sequ’ûrMsg.hh
"

32 
	~"mem/´ÙocŞ/Sequ’ûrReque¡Ty³.hh
"

33 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

34 
	~"mem/ruby/sy¡em/DMASequ’ûr.hh
"

35 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

37 
	gDMASequ’ûr
::
	$DMASequ’ûr
(cÚ¡ 
P¬ams
 *
p
)

38 : 
	$RubyPÜt
(
p
)

40 
	}
}

43 
DMASequ’ûr
::
	$š™
()

45 
RubyPÜt
::
	`š™
();

46 
m_is_busy
 = 
çl£
;

47 
m_d©a_block_mask
 = ~ (~0 << 
RubySy¡em
::
	`g‘BlockSizeB™s
());

48 
	}
}

50 
Reque¡Stus


51 
	gDMASequ’ûr
::
	$makeReque¡
(
Pack‘PŒ
 
pkt
)

53 ià(
m_is_busy
) {

54  
Reque¡Stus_BufãrFuÎ
;

57 
ušt64_t
 
·ddr
 = 
pkt
->
	`g‘Addr
();

58 
ušt8_t
* 
d©a
 = 
pkt
->
g‘PŒ
<ušt8_t>(
Œue
);

59 
Ën
 = 
pkt
->
	`g‘Size
();

60 
boŞ
 
wr™e
 = 
pkt
->
	`isWr™e
();

62 
	`as£¹
(!
m_is_busy
);

63 
m_is_busy
 = 
Œue
;

65 
aùive_»que¡
.
¡¬t_·ddr
 = 
·ddr
;

66 
aùive_»que¡
.
wr™e
 = write;

67 
aùive_»que¡
.
d©a
 = data;

68 
aùive_»que¡
.
Ën
 =†en;

69 
aùive_»que¡
.
by‹s_com¶‘ed
 = 0;

70 
aùive_»que¡
.
by‹s_issued
 = 0;

71 
aùive_»que¡
.
pkt
 =…kt;

73 
Sequ’ûrMsg
 *
msg
 = 
Ãw
 
	`Sequ’ûrMsg
(
	`şockEdge
());

74 
msg
->
	`g‘PhysiÿlAdd»ss
(èğ
	`Add»ss
(
·ddr
);

75 
msg
->
	`g‘LšeAdd»ss
(èğ
	`lše_add»ss
(msg->
	`g‘PhysiÿlAdd»ss
());

76 
msg
->
	`g‘Ty³
(èğ
wr™e
 ? 
Sequ’ûrReque¡Ty³_ST
 : 
Sequ’ûrReque¡Ty³_LD
;

77 
off£t
 = 
·ddr
 & 
m_d©a_block_mask
;

79 
msg
->
	`g‘L’
(èğ(
off£t
 + 
Ën
è<ğ
RubySy¡em
::
	`g‘BlockSizeBy‹s
() ?

80 
Ën
 : 
RubySy¡em
::
	`g‘BlockSizeBy‹s
(è- 
off£t
;

82 ià(
wr™e
 && (
d©a
 !ğ
NULL
)) {

83 ià(
aùive_»que¡
.
d©a
 !ğ
NULL
) {

84 
msg
->
	`g‘D©aBlk
().
	`£tD©a
(
d©a
, 
off£t
, msg->
	`g‘L’
());

88 
	`as£¹
(
m_mªd©Üy_q_±r
 !ğ
NULL
);

89 
m_mªd©Üy_q_±r
->
	`’queue
(
msg
);

90 
aùive_»que¡
.
by‹s_issued
 +ğ
msg
->
	`g‘L’
();

92  
Reque¡Stus_Issued
;

93 
	}
}

96 
	gDMASequ’ûr
::
	$issueNext
()

98 
	`as£¹
(
m_is_busy
 =ğ
Œue
);

99 
aùive_»que¡
.
by‹s_com¶‘ed
 =‡ùive_»que¡.
by‹s_issued
;

100 ià(
aùive_»que¡
.
Ën
 =ğaùive_»que¡.
by‹s_com¶‘ed
) {

105 
	`DPRINTF
(
RubyDma
, "DMA„equest completed\n");

106 
m_is_busy
 = 
çl£
;

107 
	`ruby_h™_ÿÎback
(
aùive_»que¡
.
pkt
);

111 
Sequ’ûrMsg
 *
msg
 = 
Ãw
 
	`Sequ’ûrMsg
(
	`şockEdge
());

112 
msg
->
	`g‘PhysiÿlAdd»ss
(èğ
	`Add»ss
(
aùive_»que¡
.
¡¬t_·ddr
 +

113 
aùive_»que¡
.
by‹s_com¶‘ed
);

115 
	`as£¹
((
msg
->
	`g‘PhysiÿlAdd»ss
().
	`g‘Add»ss
(è& 
m_d©a_block_mask
) == 0);

116 
msg
->
	`g‘LšeAdd»ss
(èğ
	`lše_add»ss
(msg->
	`g‘PhysiÿlAdd»ss
());

118 
msg
->
	`g‘Ty³
(èğ(
aùive_»que¡
.
wr™e
 ? 
Sequ’ûrReque¡Ty³_ST
 :

119 
Sequ’ûrReque¡Ty³_LD
);

121 
msg
->
	`g‘L’
() =

122 (
aùive_»que¡
.
Ën
 -

123 
aùive_»que¡
.
by‹s_com¶‘ed
 < 
RubySy¡em
::
	`g‘BlockSizeBy‹s
() ?

124 
aùive_»que¡
.
Ën
 -‡ùive_»que¡.
by‹s_com¶‘ed
 :

125 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

127 ià(
aùive_»que¡
.
wr™e
) {

128 
msg
->
	`g‘D©aBlk
().

129 
	`£tD©a
(&
aùive_»que¡
.
d©a
[aùive_»que¡.
by‹s_com¶‘ed
],

130 0, 
msg
->
	`g‘L’
());

131 
msg
->
	`g‘Ty³
(èğ
Sequ’ûrReque¡Ty³_ST
;

133 
msg
->
	`g‘Ty³
(èğ
Sequ’ûrReque¡Ty³_LD
;

136 
	`as£¹
(
m_mªd©Üy_q_±r
 !ğ
NULL
);

137 
m_mªd©Üy_q_±r
->
	`’queue
(
msg
);

138 
aùive_»que¡
.
by‹s_issued
 +ğ
msg
->
	`g‘L’
();

139 
	`DPRINTF
(
RubyDma
,

141 
aùive_»que¡
.
by‹s_issued
,‡ùive_»que¡.
by‹s_com¶‘ed
,

142 
aùive_»que¡
.
Ën
);

143 
	}
}

146 
	gDMASequ’ûr
::
	$d©aC®lback
(cÚ¡ 
D©aBlock
 & 
dblk
)

148 
	`as£¹
(
m_is_busy
 =ğ
Œue
);

149 
Ën
 = 
aùive_»que¡
.
by‹s_issued
 -‡ùive_»que¡.
by‹s_com¶‘ed
;

150 
off£t
 = 0;

151 ià(
aùive_»que¡
.
by‹s_com¶‘ed
 == 0)

152 
off£t
 = 
aùive_»que¡
.
¡¬t_·ddr
 & 
m_d©a_block_mask
;

153 
	`as£¹
(
aùive_»que¡
.
wr™e
 =ğ
çl£
);

154 ià(
aùive_»que¡
.
d©a
 !ğ
NULL
) {

155 
	`memıy
(&
aùive_»que¡
.
d©a
[aùive_»que¡.
by‹s_com¶‘ed
],

156 
dblk
.
	`g‘D©a
(
off£t
, 
Ën
),†en);

158 
	`issueNext
();

159 
	}
}

162 
	gDMASequ’ûr
::
	$ackC®lback
()

164 
	`issueNext
();

165 
	}
}

168 
	gDMASequ’ûr
::
	$»cÜdReque¡Ty³
(
DMASequ’ûrReque¡Ty³
 
»que¡Ty³
) {

169 
	`DPRINTF
(
RubySts
, "Recorded statistic: %s\n",

170 
	`DMASequ’ûrReque¡Ty³_to_¡ršg
(
»que¡Ty³
));

171 
	}
}

173 
DMASequ’ûr
 *

174 
	gDMASequ’ûrP¬ams
::
	$ü—‹
()

176  
Ãw
 
	`DMASequ’ûr
(
this
);

177 
	}
}

	@ruby/system/DMASequencer.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_DMASEQUENCER_HH__


30 
	#__MEM_RUBY_SYSTEM_DMASEQUENCER_HH__


	)

32 
	~<o¡»am
>

34 
	~"mem/´ÙocŞ/DMASequ’ûrReque¡Ty³.hh
"

35 
	~"mem/ruby/commÚ/D©aBlock.hh
"

36 
	~"mem/ruby/sy¡em/RubyPÜt.hh
"

37 
	~"·¿ms/DMASequ’ûr.hh
"

39 
	sDMAReque¡


41 
ušt64_t
 
	m¡¬t_·ddr
;

42 
	mËn
;

43 
boŞ
 
	mwr™e
;

44 
	mby‹s_com¶‘ed
;

45 
	mby‹s_issued
;

46 
ušt8_t
 *
	md©a
;

47 
Pack‘PŒ
 
	mpkt
;

50 şas 
	cDMASequ’ûr
 : 
public
 
RubyPÜt


52 
public
:

53 
DMASequ’ûrP¬ams
 
	tP¬ams
;

54 
DMASequ’ûr
(cÚ¡ 
P¬ams
 *);

55 
š™
();

57 
Reque¡Stus
 
makeReque¡
(
Pack‘PŒ
 
pkt
);

58 
boŞ
 
	$busy
(è{  
m_is_busy
;}

59 
	$out¡ªdšgCouÁ
(ècÚ¡ {  (
m_is_busy
 ? 1 : 0); 
	}
}

60 
boŞ
 
	$isD—dlockEv’tScheduËd
(ècÚ¡ {  
çl£
; 
	}
}

61 
	$descheduËD—dlockEv’t
(è{
	}
}

64 
d©aC®lback
(cÚ¡ 
D©aBlock
 & 
dblk
);

65 
ackC®lback
();

67 
»cÜdReque¡Ty³
(
DMASequ’ûrReque¡Ty³
 
»que¡Ty³
);

69 
	g´iv©e
:

70 
issueNext
();

72 
	g´iv©e
:

73 
boŞ
 
m_is_busy
;

74 
ušt64_t
 
	gm_d©a_block_mask
;

75 
DMAReque¡
 
	gaùive_»que¡
;

	@ruby/system/DirectoryMemory.cc

29 
	~"ba£/štm©h.hh
"

30 
	~"debug/RubyCache.hh
"

31 
	~"debug/RubySts.hh
"

32 
	~"mem/ruby/¦icc_š‹rçû/RubySlicc_Ut.hh
"

33 
	~"mem/ruby/sy¡em/DœeùÜyMemÜy.hh
"

34 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

36 
usšg
 
Çme¥aû
 
	g¡d
;

38 
	gDœeùÜyMemÜy
::
m_num_dœeùÜ›s
 = 0;

39 
	gDœeùÜyMemÜy
::
m_num_dœeùÜ›s_b™s
 = 0;

40 
ušt64_t
 
	gDœeùÜyMemÜy
::
m_tÙ®_size_by‹s
 = 0;

41 
	gDœeùÜyMemÜy
::
m_numa_high_b™
 = 0;

43 
	gDœeùÜyMemÜy
::
	$DœeùÜyMemÜy
(cÚ¡ 
P¬ams
 *
p
)

44 : 
	$SimObjeù
(
p
)

46 
m_v”siÚ
 = 
p
->
v”siÚ
;

47 
m_size_by‹s
 = 
p
->
size
;

48 
m_size_b™s
 = 
	`æoÜLog2
(
m_size_by‹s
);

49 
m_num_’Œ›s
 = 0;

50 
m_u£_m­
 = 
p
->
u£_m­
;

51 
m_m­_Ëv–s
 = 
p
->
m­_Ëv–s
;

52 
m_numa_high_b™
 = 
p
->
numa_high_b™
;

53 
	}
}

56 
	gDœeùÜyMemÜy
::
	$š™
()

58 
m_num_’Œ›s
 = 
m_size_by‹s
 / 
RubySy¡em
::
	`g‘BlockSizeBy‹s
();

60 ià(
m_u£_m­
) {

61 
m_¥¬£MemÜy
 = 
Ãw
 
	`S·r£MemÜy
(
m_m­_Ëv–s
);

62 
g_sy¡em_±r
->
	`»gi¡”S·r£MemÜy
(
m_¥¬£MemÜy
);

64 
m_’Œ›s
 = 
Ãw
 
Ab¡¿ùEÁry
*[
m_num_’Œ›s
];

65 
i
 = 0; i < 
m_num_’Œ›s
; i++)

66 
m_’Œ›s
[
i
] = 
NULL
;

67 
m_¿m
 = 
g_sy¡em_±r
->
	`g‘MemÜyVeùÜ
();

70 
m_num_dœeùÜ›s
++;

71 
m_num_dœeùÜ›s_b™s
 = 
	`ûLog2
(
m_num_dœeùÜ›s
);

72 
m_tÙ®_size_by‹s
 +ğ
m_size_by‹s
;

74 ià(
m_numa_high_b™
 == 0) {

75 
m_numa_high_b™
 = 
RubySy¡em
::
	`g‘MemÜySizeB™s
() - 1;

77 
	`as£¹
(
m_numa_high_b™
 != 0);

78 
	}
}

80 
	gDœeùÜyMemÜy
::~
	$DœeùÜyMemÜy
()

83 ià(
m_’Œ›s
 !ğ
NULL
) {

84 
ušt64
 
i
 = 0; i < 
m_num_’Œ›s
; i++) {

85 ià(
m_’Œ›s
[
i
] !ğ
NULL
) {

86 
d–‘e
 
m_’Œ›s
[
i
];

89 
d–‘e
 [] 
m_’Œ›s
;

90 } ià(
m_u£_m­
) {

91 
d–‘e
 
m_¥¬£MemÜy
;

93 
	}
}

95 
ušt64


96 
	gDœeùÜyMemÜy
::
	$m­Add»ssToDœeùÜyV”siÚ
(
PhysAdd»ss
 
add»ss
)

98 ià(
m_num_dœeùÜ›s_b™s
 == 0)

101 
ušt64
 
»t
 = 
add»ss
.
	`b™S–eù
(
m_numa_high_b™
 - 
m_num_dœeùÜ›s_b™s
 + 1,

102 
m_numa_high_b™
);

103  
»t
;

104 
	}
}

106 
boŞ


107 
	gDœeùÜyMemÜy
::
	$isP»£Á
(
PhysAdd»ss
 
add»ss
)

109 
boŞ
 
»t
 = (
	`m­Add»ssToDœeùÜyV”siÚ
(
add»ss
è=ğ
m_v”siÚ
);

110  
»t
;

111 
	}
}

113 
ušt64


114 
	gDœeùÜyMemÜy
::
	$m­Add»ssToLoÿlIdx
(
PhysAdd»ss
 
add»ss
)

116 
ušt64
 
»t
;

117 ià(
m_num_dœeùÜ›s_b™s
 > 0) {

118 
»t
 = 
add»ss
.
	`b™Remove
(
m_numa_high_b™
 - 
m_num_dœeùÜ›s_b™s
 + 1,

119 
m_numa_high_b™
);

121 
»t
 = 
add»ss
.
	`g‘Add»ss
();

124  
»t
 >> (
RubySy¡em
::
	`g‘BlockSizeB™s
());

125 
	}
}

127 
Ab¡¿ùEÁry
*

128 
	gDœeùÜyMemÜy
::
	$lookup
(
PhysAdd»ss
 
add»ss
)

130 
	`as£¹
(
	`isP»£Á
(
add»ss
));

131 
	`DPRINTF
(
RubyCache
, "Lookšg u°add»ss: %s\n", 
add»ss
);

133 ià(
m_u£_m­
) {

134  
m_¥¬£MemÜy
->
	`lookup
(
add»ss
);

136 
ušt64_t
 
idx
 = 
	`m­Add»ssToLoÿlIdx
(
add»ss
);

137 
	`as£¹
(
idx
 < 
m_num_’Œ›s
);

138  
m_’Œ›s
[
idx
];

140 
	}
}

142 
Ab¡¿ùEÁry
*

143 
	gDœeùÜyMemÜy
::
	$®loÿ‹
(cÚ¡ 
PhysAdd»ss
& 
add»ss
, 
Ab¡¿ùEÁry
* 
’Œy
)

145 
	`as£¹
(
	`isP»£Á
(
add»ss
));

146 
ušt64
 
idx
;

147 
	`DPRINTF
(
RubyCache
, "Lookšg u°add»ss: %s\n", 
add»ss
);

149 ià(
m_u£_m­
) {

150 
m_¥¬£MemÜy
->
	`add
(
add»ss
, 
’Œy
);

151 
’Œy
->
	`chªgeP”missiÚ
(
AcûssP”missiÚ_R—d_Wr™e
);

153 
idx
 = 
	`m­Add»ssToLoÿlIdx
(
add»ss
);

154 
	`as£¹
(
idx
 < 
m_num_’Œ›s
);

155 
’Œy
->
	`g‘D©aBlk
().
	`assign
(
m_¿m
->
	`g‘BlockPŒ
(
add»ss
));

156 
’Œy
->
	`chªgeP”missiÚ
(
AcûssP”missiÚ_R—d_OÆy
);

157 
m_’Œ›s
[
idx
] = 
’Œy
;

160  
’Œy
;

161 
	}
}

164 
	gDœeùÜyMemÜy
::
	$šv®id©eBlock
(
PhysAdd»ss
 
add»ss
)

166 ià(
m_u£_m­
) {

167 
	`as£¹
(
m_¥¬£MemÜy
->
	`exi¡
(
add»ss
));

168 
m_¥¬£MemÜy
->
	`»move
(
add»ss
);

172 
	`as£¹
(
	`isP»£Á
(
add»ss
));

174 
Index
 
šdex
 = 
add»ss
.
	`memÜyModuËIndex
();

176 ià(
šdex
 < 0 || index > 
m_size
) {

177 
	`ERROR_MSG
("Directory Memory Assertion: "

181 ià(
m_’Œ›s
[
šdex
] !ğ
NULL
){

182 
d–‘e
 
m_’Œ›s
[
šdex
];

183 
m_’Œ›s
[
šdex
] = 
NULL
;

187 
	}
}

190 
	gDœeùÜyMemÜy
::
	$´št
(
o¡»am
& 
out
) const

192 
	}
}

195 
DœeùÜyMemÜy
::
	$»gSts
()

197 ià(
m_u£_m­
) {

198 
m_¥¬£MemÜy
->
	`»gSts
(
	`Çme
());

200 
	}
}

203 
	gDœeùÜyMemÜy
::
	$»cÜdReque¡Ty³
(
DœeùÜyReque¡Ty³
 
»que¡Ty³
) {

204 
	`DPRINTF
(
RubySts
, "Recorded statistic: %s\n",

205 
	`DœeùÜyReque¡Ty³_to_¡ršg
(
»que¡Ty³
));

206 
	}
}

208 
DœeùÜyMemÜy
 *

209 
	gRubyDœeùÜyMemÜyP¬ams
::
	$ü—‹
()

211  
Ãw
 
	`DœeùÜyMemÜy
(
this
);

212 
	}
}

	@ruby/system/DirectoryMemory.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_DIRECTORYMEMORY_HH__


30 
	#__MEM_RUBY_SYSTEM_DIRECTORYMEMORY_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

35 
	~"mem/ruby/commÚ/Add»ss.hh
"

36 
	~"mem/´ÙocŞ/DœeùÜyReque¡Ty³.hh
"

37 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùEÁry.hh
"

38 
	~"mem/ruby/sy¡em/MemÜyVeùÜ.hh
"

39 
	~"mem/ruby/sy¡em/S·r£MemÜy.hh
"

40 
	~"·¿ms/RubyDœeùÜyMemÜy.hh
"

41 
	~"sim/sim_objeù.hh
"

43 şas 
	cDœeùÜyMemÜy
 : 
public
 
SimObjeù


45 
public
:

46 
RubyDœeùÜyMemÜyP¬ams
 
	tP¬ams
;

47 
DœeùÜyMemÜy
(cÚ¡ 
P¬ams
 *
p
);

48 ~
DœeùÜyMemÜy
();

50 
š™
();

52 
ušt64
 
m­Add»ssToLoÿlIdx
(
PhysAdd»ss
 
add»ss
);

53 
ušt64
 
m­Add»ssToDœeùÜyV”siÚ
(
PhysAdd»ss
 
add»ss
);

55 
boŞ
 
	$isS·r£Im¶em’tiÚ
(è{  
m_u£_m­
; }

56 
ušt64
 
	$g‘Size
(è{  
m_size_by‹s
; 
	}
}

58 
boŞ
 
isP»£Á
(
PhysAdd»ss
 
add»ss
);

59 
Ab¡¿ùEÁry
* 
lookup
(
PhysAdd»ss
 
add»ss
);

60 
Ab¡¿ùEÁry
* 
®loÿ‹
(cÚ¡ 
PhysAdd»ss
& 
add»ss
,

61 
Ab¡¿ùEÁry
* 
Ãw_’Œy
);

63 
šv®id©eBlock
(
PhysAdd»ss
 
add»ss
);

65 
´št
(
¡d
::
o¡»am
& 
out
) const;

66 
»gSts
();

68 
»cÜdReque¡Ty³
(
DœeùÜyReque¡Ty³
 
»que¡Ty³
);

70 
	g´iv©e
:

72 
DœeùÜyMemÜy
(cÚ¡ DœeùÜyMemÜy& 
obj
);

73 
	gDœeùÜyMemÜy
& 
	gİ”©Ü
=(cÚ¡ 
DœeùÜyMemÜy
& 
obj
);

75 
	g´iv©e
:

76 cÚ¡ 
¡d
::
¡ršg
 
m_Çme
;

77 
Ab¡¿ùEÁry
 **
	gm_’Œ›s
;

80 
ušt64
 
	gm_size_by‹s
;

81 
ušt64
 
	gm_size_b™s
;

82 
ušt64
 
	gm_num_’Œ›s
;

83 
	gm_v”siÚ
;

85 
	gm_num_dœeùÜ›s
;

86 
	gm_num_dœeùÜ›s_b™s
;

87 
ušt64_t
 
	gm_tÙ®_size_by‹s
;

88 
	gm_numa_high_b™
;

90 
MemÜyVeùÜ
* 
	gm_¿m
;

91 
S·r£MemÜy
* 
	gm_¥¬£MemÜy
;

92 
boŞ
 
	gm_u£_m­
;

93 
	gm_m­_Ëv–s
;

96 
šlše
 
	g¡d
::
o¡»am
&

97 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gDœeùÜyMemÜy
& 
	gobj
)

99 
	gobj
.
´št
(
out
);

100 
	gout
 << 
	g¡d
::
æush
;

101  
	gout
;

	@ruby/system/LRUPolicy.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_LRUPOLICY_HH__


30 
	#__MEM_RUBY_SYSTEM_LRUPOLICY_HH__


	)

32 
	~"mem/ruby/sy¡em/Ab¡¿ùR•Ïûm’tPŞicy.hh
"

36 şas 
	cLRUPŞicy
 : 
public
 
Ab¡¿ùR•Ïûm’tPŞicy


38 
public
:

39 
LRUPŞicy
(
Index
 
num_£ts
, Index 
assoc
);

40 ~
LRUPŞicy
();

42 
touch
(
Index
 
£t
, Index 
way
, 
Tick
 
time
);

43 
Index
 
	$g‘Viùim
(
Index
 
£t
) const;

46 
šlše


47 
LRUPŞicy
::
	$LRUPŞicy
(
Index
 
num_£ts
, Index 
assoc
)

48 : 
	$Ab¡¿ùR•Ïûm’tPŞicy
(
num_£ts
, 
assoc
)

50 
	}
}

52 
šlše


53 
	gLRUPŞicy
::~
	$LRUPŞicy
()

55 
	}
}

57 
šlše
 

58 
LRUPŞicy
::
	$touch
(
Index
 
£t
, Index 
šdex
, 
Tick
 
time
)

60 
	`as£¹
(
šdex
 >ğ0 && index < 
m_assoc
);

61 
	`as£¹
(
£t
 >ğ0 && s‘ < 
m_num_£ts
);

63 
m_Ï¡_»f_±r
[
£t
][
šdex
] = 
time
;

64 
	}
}

66 
šlše
 
Index


67 
	gLRUPŞicy
::
	$g‘Viùim
(
Index
 
£t
) const

70 
Tick
 
time
, 
sm®Ë¡_time
;

71 
Index
 
sm®Ë¡_šdex
;

73 
sm®Ë¡_šdex
 = 0;

74 
sm®Ë¡_time
 = 
m_Ï¡_»f_±r
[
£t
][0];

76 
i
 = 0; i < 
m_assoc
; i++) {

77 
time
 = 
m_Ï¡_»f_±r
[
£t
][
i
];

81 ià(
time
 < 
sm®Ë¡_time
) {

82 
sm®Ë¡_šdex
 = 
i
;

83 
sm®Ë¡_time
 = 
time
;

92  
sm®Ë¡_šdex
;

93 
	}
}

	@ruby/system/MachineID.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_MACHINEID_HH__


30 
	#__MEM_RUBY_SYSTEM_MACHINEID_HH__


	)

32 
	~<io¡»am
>

33 
	~<¡ršg
>

35 
	~"ba£/ırštf.hh
"

36 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

38 
	sMachšeID


40 
MachšeTy³
 
	mty³
;

42 
NodeID
 
	mnum
;

44 
MachšeTy³
 
g‘Ty³
(ècÚ¡ {  
	mty³
; }

45 
NodeID
 
g‘Num
(ècÚ¡ {  
	mnum
; }

48 
šlše
 
	g¡d
::
¡ršg


49 
	$MachšeIDToSŒšg
(
MachšeID
 
machše
)

51  
	`c¥rštf
("%s_%d", 
	`MachšeTy³_to_¡ršg
(
machše
.
ty³
), machše.
num
);

52 
	}
}

54 
šlše
 
boŞ


55 
	gİ”©Ü
==(cÚ¡ 
MachšeID
 & 
obj1
, cÚ¡ 
	gMachšeID
 & 
	gobj2
)

57  (
	gobj1
.
	gty³
 =ğ
obj2
.
ty³
 && 
obj1
.
num
 == obj2.num);

60 
šlše
 
boŞ


61 
	gİ”©Ü
!=(cÚ¡ 
MachšeID
 & 
obj1
, cÚ¡ 
	gMachšeID
 & 
	gobj2
)

63  (
	gobj1
.
	gty³
 !ğ
obj2
.
ty³
 || 
obj1
.
num
 != obj2.num);

67 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am& 
out
, cÚ¡ 
	gMachšeID
& 
	gobj
);

69 
šlše
 
	g¡d
::
o¡»am
&

70 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gMachšeID
& 
	gobj
)

72 ià((
	gobj
.
	gty³
 < 
	gMachšeTy³_NUM
è&& (obj.ty³ >ğ
MachšeTy³_FIRST
)) {

73 
out
 << 
MachšeTy³_to_¡ršg
(
obj
.
ty³
);

75 
	gout
 << "NULL";

77 
	gout
 << "-";

78 
	gout
 << 
	gobj
.
	gnum
;

79 
	gout
 << 
	g¡d
::
æush
;

80  
	gout
;

	@ruby/system/MemoryControl.cc

30 
	~"debug/RubySts.hh
"

31 
	~"mem/ruby/commÚ/Glob®.hh
"

32 
	~"mem/ruby/¦icc_š‹rçû/RubySlicc_CompÚ’tM­pšg.hh
"

33 
	~"mem/ruby/sy¡em/MemÜyCÚŒŞ.hh
"

34 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

36 
usšg
 
Çme¥aû
 
	g¡d
;

37 
	gMemÜyCÚŒŞ
::
	$MemÜyCÚŒŞ
(cÚ¡ 
P¬ams
 *
p
)

38 : 
	`ClockedObjeù
(
p
), 
	`CÚsum”
(
this
), 
	$m_ev’t
(
this
)

40 
g_sy¡em_±r
->
	`»gi¡”MemCÚŒŞËr
(
this
);

41 
	}
}

43 
	gMemÜyCÚŒŞ
::~
	$MemÜyCÚŒŞ
(è{
	}
};

46 
	gMemÜyCÚŒŞ
::
	$»cÜdReque¡Ty³
(
MemÜyCÚŒŞReque¡Ty³
 
»que¡
) {

47 
	`DPRINTF
(
RubySts
, "Recorded„equest: %s\n",

48 
	`MemÜyCÚŒŞReque¡Ty³_to_¡ršg
(
»que¡
));

49 
	}
}

	@ruby/system/MemoryControl.hh

30 #iâdeà
__MEM_RUBY_SYSTEM_ABSTRACT_MEMORY_CONTROL_HH__


31 
	#__MEM_RUBY_SYSTEM_ABSTRACT_MEMORY_CONTROL_HH__


	)

33 
	~<io¡»am
>

34 
	~<li¡
>

35 
	~<¡ršg
>

37 
	~"mem/´ÙocŞ/MemÜyCÚŒŞReque¡Ty³.hh
"

38 
	~"mem/ruby/commÚ/CÚsum”.hh
"

39 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

40 
	~"mem/ruby/sy¡em/MemÜyNode.hh
"

41 
	~"·¿ms/MemÜyCÚŒŞ.hh
"

42 
	~"sim/şocked_objeù.hh
"

46 
şass
 
	gMemÜyCÚŒŞ
 : 
public
 
ClockedObjeù
,…ubliø
	gCÚsum”


48 
	gpublic
:

49 
MemÜyCÚŒŞP¬ams
 
	tP¬ams
;

50 cÚ¡ 
P¬ams
 *
·¿ms
() const

51 {  
	gdyÇmic_ÿ¡
<cÚ¡ 
	gP¬ams
 *>(
	g_·¿ms
); }

53 
MemÜyCÚŒŞ
(cÚ¡ 
P¬ams
 *
p
);

54 
vœtu®
 
š™
() = 0;

55 
vœtu®
 
»£t
() = 0;

57 ~
MemÜyCÚŒŞ
();

59 
vœtu®
 
wakeup
() = 0;

61 
vœtu®
 
£tCÚsum”
(
CÚsum”
* 
cÚsum”_±r
) = 0;

62 
vœtu®
 
CÚsum”
* 
g‘CÚsum”
() = 0;

63 
vœtu®
 
£tClockObj
(
ClockedObjeù
* 
cÚsum”_±r
) {}

65 
vœtu®
 
£tDesütiÚ
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
) = 0;

66 
vœtu®
 
	g¡d
::
¡ršg
 
g‘DesütiÚ
() = 0;

69 
vœtu®
 
’queue
(cÚ¡ 
MsgPŒ
& 
mes§ge
, 
Cyşes
 
Ï‹ncy
) = 0;

70 
vœtu®
 
’queueMemRef
(
MemÜyNode
& 
memRef
) = 0;

71 
vœtu®
 
dequeue
() = 0;

72 
vœtu®
 cÚ¡ 
Mes§ge
* 
³ek
() = 0;

73 
vœtu®
 
MemÜyNode
 
³ekNode
() = 0;

74 
vœtu®
 
boŞ
 
isR—dy
() = 0;

75 
vœtu®
 
boŞ
 
¬eNSlÙsAvaabË
(
n
) = 0;

77 
vœtu®
 
´št
(
¡d
::
o¡»am
& 
out
) const = 0;

78 
vœtu®
 
»gSts
() {};

80 
vœtu®
 cÚ¡ 
g‘ChªÃl
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const = 0;

81 
vœtu®
 cÚ¡ 
g‘Bªk
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const = 0;

82 
vœtu®
 cÚ¡ 
g‘Rªk
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const = 0;

83 
vœtu®
 cÚ¡ 
g‘Row
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const = 0;

86 
vœtu®
 
g‘BªksP”Rªk
() = 0;

87 
vœtu®
 
g‘RªksP”Dimm
() = 0;

88 
vœtu®
 
g‘DimmsP”ChªÃl
() = 0;

90 
vœtu®
 
»cÜdReque¡Ty³
(
MemÜyCÚŒŞReque¡Ty³
 
»que¡Ty³
);

92 
vœtu®
 
boŞ
 
funùiÚ®R—dBufãrs
(
Pack‘
 *
pkt
)

93 { 
çl
("Functional„ead‡ccess‚ot implemented!");}

94 
vœtu®
 
ušt32_t
 
funùiÚ®Wr™eBufãrs
(
Pack‘
 *
pkt
)

95 { 
çl
("Functional„ead‡ccess‚ot implemented!");}

97 
	g´Ùeùed
:

98 şas 
	cMemCÁ¾Ev’t
 : 
public
 
Ev’t


100 
public
:

101 
MemCÁ¾Ev’t
(
MemÜyCÚŒŞ
* 
_mem_úŒl
)

103 
mem_úŒl
 = 
_mem_úŒl
;

105 
	g´iv©e
:

106 
´oûss
(è{ 
mem_úŒl
->
wakeup
(); }

108 
MemÜyCÚŒŞ
* 
	gmem_úŒl
;

111 
MemCÁ¾Ev’t
 
	gm_ev’t
;

	@ruby/system/MemoryNode.cc

29 
	~"mem/ruby/sy¡em/MemÜyNode.hh
"

31 
usšg
 
Çme¥aû
 
	g¡d
;

34 
	gMemÜyNode
::
	$´št
(
o¡»am
& 
out
) const

36 
out
 << "[";

37 
out
 << 
m_time
 << ", ";

38 
out
 << 
m_msg_couÁ”
 << ", ";

39 
out
 << 
m_msg±r
 << "; ";

40 
out
 << "]";

41 
	}
}

	@ruby/system/MemoryNode.hh

38 #iâdeà
__MEM_RUBY_SYSTEM_MEMORYNODE_HH__


39 
	#__MEM_RUBY_SYSTEM_MEMORYNODE_HH__


	)

41 
	~<io¡»am
>

43 
	~"mem/ruby/commÚ/Ty³Defšes.hh
"

44 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

46 şas 
	cMemÜyNode


48 
	mpublic
:

50 
	$MemÜyNode
(cÚ¡ 
Cyşes
& 
time
, 
couÁ”
, cÚ¡ 
MsgPŒ
& 
msg±r
,

51 cÚ¡ 
physiÿl_add»ss_t
 
addr
, cÚ¡ 
boŞ
 
is_mem_»ad
)

52 : 
	$m_time
(
time
)

54 
m_msg_couÁ”
 = 
couÁ”
;

55 
m_msg±r
 = 
msg±r
;

56 
m_addr
 = 
addr
;

57 
m_is_mem_»ad
 = 
is_mem_»ad
;

58 
m_is_dœty_wb
 = !
is_mem_»ad
;

62 
	$MemÜyNode
(cÚ¡ 
Cyşes
& 
time
, cÚ¡ 
MsgPŒ
& 
msg±r
,

63 cÚ¡ 
physiÿl_add»ss_t
 
addr
, cÚ¡ 
boŞ
 
is_mem_»ad
,

64 cÚ¡ 
boŞ
 
is_dœty_wb
)

65 : 
	$m_time
(
time
)

67 
m_msg_couÁ”
 = 0;

68 
m_msg±r
 = 
msg±r
;

69 
m_addr
 = 
addr
;

70 
m_is_mem_»ad
 = 
is_mem_»ad
;

71 
m_is_dœty_wb
 = 
is_dœty_wb
;

72 
	}
}

74 
´št
(
¡d
::
o¡»am
& 
out
) const;

76 
Cyşes
 
	gm_time
;

77 
	gm_msg_couÁ”
;

78 
MsgPŒ
 
	gm_msg±r
;

79 
physiÿl_add»ss_t
 
	gm_addr
;

80 
boŞ
 
	gm_is_mem_»ad
;

81 
boŞ
 
	gm_is_dœty_wb
;

84 
šlše
 
	g¡d
::
o¡»am
&

85 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gMemÜyNode
& 
	gobj
)

87 
	gobj
.
´št
(
out
);

88 
	gout
 << 
	g¡d
::
æush
;

89  
	gout
;

	@ruby/system/MemoryVector.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_MEMORYVECTOR_HH__


30 
	#__MEM_RUBY_SYSTEM_MEMORYVECTOR_HH__


	)

32 
	~"ba£/Œaû.hh
"

33 
	~"debug/RubyCacheT¿û.hh
"

34 
	~"mem/ruby/commÚ/Add»ss.hh
"

36 
şass
 
	gDœeùÜyMemÜy
;

41 şas 
	cMemÜyVeùÜ


43 
	mpublic
:

44 
MemÜyVeùÜ
();

45 
MemÜyVeùÜ
(
ušt64
 
size
);

46 ~
MemÜyVeùÜ
();

47 
ä›nd
 
şass
 
	mDœeùÜyMemÜy
;

49 
»size
(
ušt64
 
size
);

51 
wr™e
(cÚ¡ 
Add»ss
 & 
·ddr
, 
ušt8_t
 *
d©a
, 
Ën
);

52 
ušt8_t
 *
»ad
(cÚ¡ 
Add»ss
 & 
·ddr
, ušt8_ˆ*
d©a
, 
Ën
);

53 
ušt32_t
 
cŞÏ‹Pages
(
ušt8_t
 *&
¿w_d©a
);

54 
pİuÏ‹Pages
(
ušt8_t
 *
¿w_d©a
);

56 
	m´iv©e
:

57 
ušt8_t
 *
g‘BlockPŒ
(cÚ¡ 
PhysAdd»ss
 & 
addr
);

59 
ušt64
 
	mm_size
;

60 
ušt8_t
 **
	mm_·ges
;

61 
ušt32_t
 
	mm_num_·ges
;

62 cÚ¡ 
ušt32_t
 
	mm_·ge_off£t_mask
;

63 cÚ¡ 
ušt32_t
 
	mPAGE_SIZE
 = 4096;

66 
šlše


67 
	gMemÜyVeùÜ
::
	$MemÜyVeùÜ
()

68 : 
	$m_·ge_off£t_mask
(4095)

70 
m_size
 = 0;

71 
m_num_·ges
 = 0;

72 
m_·ges
 = 
NULL
;

73 
	}
}

75 
šlše


76 
	gMemÜyVeùÜ
::
	$MemÜyVeùÜ
(
ušt64
 
size
)

77 : 
	$m_·ge_off£t_mask
(4095)

79 
	`»size
(
size
);

80 
	}
}

82 
šlše


83 
	gMemÜyVeùÜ
::~
	$MemÜyVeùÜ
()

85 
i
 = 0; i < 
m_num_·ges
; i++) {

86 ià(
m_·ges
[
i
] != 0) {

87 
d–‘e
 [] 
m_·ges
[
i
];

90 
d–‘e
 [] 
m_·ges
;

91 
	}
}

93 
šlše
 

94 
	gMemÜyVeùÜ
::
	$»size
(
ušt64
 
size
)

96 ià(
m_·ges
 !ğ
NULL
){

97 
i
 = 0; i < 
m_num_·ges
; i++) {

98 ià(
m_·ges
[
i
] != 0) {

99 
d–‘e
 [] 
m_·ges
[
i
];

102 
d–‘e
 [] 
m_·ges
;

104 
m_size
 = 
size
;

105 
	`as£¹
(
size
%
PAGE_SIZE
 == 0);

106 
m_num_·ges
 = 
size
 >> 12;

107 
m_·ges
 = 
Ãw
 
ušt8_t
*[
m_num_·ges
];

108 
	`mem£t
(
m_·ges
, 0, 
m_num_·ges
 * (
ušt8_t
*));

109 
	}
}

111 
šlše
 

112 
	gMemÜyVeùÜ
::
	$wr™e
(cÚ¡ 
Add»ss
 & 
·ddr
, 
ušt8_t
 *
d©a
, 
Ën
)

114 
	`as£¹
(
·ddr
.
	`g‘Add»ss
(è+ 
Ën
 <ğ
m_size
);

115 
ušt32_t
 
·ge_num
 = 
·ddr
.
	`g‘Add»ss
() >> 12;

116 ià(
m_·ges
[
·ge_num
] == 0) {

117 
boŞ
 
®l_z”os
 = 
Œue
;

118 
i
 = 0; i < 
Ën
;i++) {

119 ià(
d©a
[
i
] != 0) {

120 
®l_z”os
 = 
çl£
;

124 ià(
®l_z”os
)

126 
m_·ges
[
·ge_num
] = 
Ãw
 
ušt8_t
[
PAGE_SIZE
];

127 
	`mem£t
(
m_·ges
[
·ge_num
], 0, 
PAGE_SIZE
);

128 
ušt32_t
 
off£t
 = 
·ddr
.
	`g‘Add»ss
(è& 
m_·ge_off£t_mask
;

129 
	`memıy
(&
m_·ges
[
·ge_num
][
off£t
], 
d©a
, 
Ën
);

131 
	`memıy
(&
m_·ges
[
·ge_num
][
·ddr
.
	`g‘Add»ss
()&
m_·ge_off£t_mask
],

132 
d©a
, 
Ën
);

134 
	}
}

136 
šlše
 
ušt8_t
*

137 
	gMemÜyVeùÜ
::
	$»ad
(cÚ¡ 
Add»ss
 & 
·ddr
, 
ušt8_t
 *
d©a
, 
Ën
)

139 
	`as£¹
(
·ddr
.
	`g‘Add»ss
(è+ 
Ën
 <ğ
m_size
);

140 
ušt32_t
 
·ge_num
 = 
·ddr
.
	`g‘Add»ss
() >> 12;

141 ià(
m_·ges
[
·ge_num
] == 0) {

142 
	`mem£t
(
d©a
, 0, 
Ën
);

144 
	`memıy
(
d©a
, &
m_·ges
[
·ge_num
][
·ddr
.
	`g‘Add»ss
()&
m_·ge_off£t_mask
],

145 
Ën
);

147  
d©a
;

148 
	}
}

150 
šlše
 
ušt8_t
*

151 
	gMemÜyVeùÜ
::
	$g‘BlockPŒ
(cÚ¡ 
PhysAdd»ss
 & 
·ddr
)

153 
ušt32_t
 
·ge_num
 = 
·ddr
.
	`g‘Add»ss
() >> 12;

154 ià(
m_·ges
[
·ge_num
] == 0) {

155 
m_·ges
[
·ge_num
] = 
Ãw
 
ušt8_t
[
PAGE_SIZE
];

156 
	`mem£t
(
m_·ges
[
·ge_num
], 0, 
PAGE_SIZE
);

158  &
m_·ges
[
·ge_num
][
·ddr
.
	`g‘Add»ss
()&
m_·ge_off£t_mask
];

159 
	}
}

169 
šlše
 
ušt32_t


170 
	gMemÜyVeùÜ
::
	$cŞÏ‹Pages
(
ušt8_t
 *&
¿w_d©a
)

172 
ušt32_t
 
num_z”o_·ges
 = 0;

173 
ušt32_t
 
d©a_size
 = 0;

175 
ušt32_t
 
i
 = 0;˜< 
m_num_·ges
; ++i)

177 ià(
m_·ges
[
i
] =ğ0è
num_z”o_·ges
++;

180 
¿w_d©a
 = 
Ãw
 
ušt8_t
[(
ušt32_t
) +

181 
m_num_·ges
 +

182 
PAGE_SIZE
 * (
m_num_·ges
 - 
num_z”o_·ges
)];

185 
	`memıy
(
¿w_d©a
, &
m_num_·ges
, (
ušt32_t
));

186 
d©a_size
 = (
ušt32_t
);

188 
	`DPRINTF
(
RubyCacheT¿û
, "cŞÏtšg %d…ages\n", 
m_num_·ges
);

190 
ušt32_t
 
i
 = 0;˜< 
m_num_·ges
; ++i)

192 ià(
m_·ges
[
i
] == 0) {

193 
¿w_d©a
[
d©a_size
] = 0;

195 
¿w_d©a
[
d©a_size
] = 1;

196 
	`memıy
(
¿w_d©a
 + 
d©a_size
 + 1, 
m_·ges
[
i
], 
PAGE_SIZE
);

197 
d©a_size
 +ğ
PAGE_SIZE
;

199 
d©a_size
 += 1;

202  
d©a_size
;

203 
	}
}

212 
šlše
 

213 
	gMemÜyVeùÜ
::
	$pİuÏ‹Pages
(
ušt8_t
 *
¿w_d©a
)

215 
ušt32_t
 
d©a_size
 = 0;

216 
ušt32_t
 
num_·ges
 = 0;

219 
	`memıy
(&
num_·ges
, 
¿w_d©a
, (
ušt32_t
));

220 
d©a_size
 = (
ušt32_t
);

221 
	`as£¹
(
num_·ges
 =ğ
m_num_·ges
);

223 
	`DPRINTF
(
RubyCacheT¿û
, "PİuÏtšg %d…ages\n", 
num_·ges
);

225 
ušt32_t
 
i
 = 0;˜< 
m_num_·ges
; ++i)

227 
	`as£¹
(
m_·ges
[
i
] == 0);

228 ià(
¿w_d©a
[
d©a_size
] != 0) {

229 
m_·ges
[
i
] = 
Ãw
 
ušt8_t
[
PAGE_SIZE
];

230 
	`memıy
(
m_·ges
[
i
], 
¿w_d©a
 + 
d©a_size
 + 1, 
PAGE_SIZE
);

231 
d©a_size
 +ğ
PAGE_SIZE
;

233 
d©a_size
 += 1;

235 
	}
}

	@ruby/system/PerfectCacheMemory.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_PERFECTCACHEMEMORY_HH__


30 
	#__MEM_RUBY_SYSTEM_PERFECTCACHEMEMORY_HH__


	)

32 
	~"ba£/hashm­.hh
"

33 
	~"mem/´ÙocŞ/AcûssP”missiÚ.hh
"

34 
	~"mem/ruby/commÚ/Add»ss.hh
"

36 
	g‹m¶©e
<
şass
 
	gENTRY
>

37 
	sP”ãùCacheLšeS‹


39 
P”ãùCacheLšeS‹
(è{ 
	mm_³rmissiÚ
 = 
AcûssP”missiÚ_NUM
; }

40 
AcûssP”missiÚ
 
	mm_³rmissiÚ
;

41 
ENTRY
 
	mm_’Œy
;

44 
	g‹m¶©e
<
şass
 
	gENTRY
>

45 
šlše
 
	g¡d
::
o¡»am
&

46 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gP”ãùCacheLšeS‹
<
	gENTRY
>& 
	gobj
)

48  
	gout
;

51 
	g‹m¶©e
<
şass
 
	gENTRY
>

52 şas 
	cP”ãùCacheMemÜy


54 
	mpublic
:

55 
P”ãùCacheMemÜy
();

58 
boŞ
 
	$isTagP»£Á
(cÚ¡ 
Add»ss
& 
add»ss
) const;

63 
boŞ
 
	$ÿcheAva
(cÚ¡ 
Add»ss
& 
add»ss
) const;

66 
	`®loÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
);

68 
	`d—Îoÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
);

71 
Add»ss
 
	$ÿcheProbe
(cÚ¡ 
Add»ss
& 
ÃwAdd»ss
) const;

74 
ENTRY
& 
	`lookup
(cÚ¡ 
Add»ss
& 
add»ss
);

75 cÚ¡ 
ENTRY
& 
	$lookup
(cÚ¡ 
Add»ss
& 
add»ss
) const;

78 
AcûssP”missiÚ
 
	$g‘P”missiÚ
(cÚ¡ 
Add»ss
& 
add»ss
) const;

79 
	`chªgeP”missiÚ
(cÚ¡ 
Add»ss
& 
add»ss
, 
AcûssP”missiÚ
 
Ãw_³rm
);

82 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

84 
´iv©e
:

86 
	`P”ãùCacheMemÜy
(cÚ¡ 
P”ãùCacheMemÜy
& 
obj
);

87 
P”ãùCacheMemÜy
& 
İ”©Ü
=(cÚ¡ P”ãùCacheMemÜy& 
obj
);

90 
m5
::
hash_m­
<
Add»ss
, 
P”ãùCacheLšeS‹
<
ENTRY
> > 
m_m­
;

93 
‹m¶©e
<
şass
 
ENTRY
>

94 
šlše
 
¡d
::
o¡»am
&

95 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
P”ãùCacheMemÜy
<
ENTRY
>& 
obj
)

97 
obj
.
	`´št
(
out
);

98 
out
 << 
¡d
::
æush
;

99  
out
;

100 
	}
}

102 
	g‹m¶©e
<
şass
 
	gENTRY
>

103 
šlše


104 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$P”ãùCacheMemÜy
()

106 
	}
}

109 
‹m¶©e
<
şass
 
ENTRY
>

110 
šlše
 
boŞ


111 
P”ãùCacheMemÜy
<
ENTRY
>::
	$isTagP»£Á
(cÚ¡ 
Add»ss
& 
add»ss
) const

113  
m_m­
.
	`couÁ
(
	`lše_add»ss
(
add»ss
)) > 0;

114 
	}
}

116 
	g‹m¶©e
<
şass
 
	gENTRY
>

117 
šlše
 
boŞ


118 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$ÿcheAva
(cÚ¡ 
Add»ss
& 
add»ss
) const

120  
Œue
;

121 
	}
}

125 
	g‹m¶©e
<
şass
 
	gENTRY
>

126 
šlše
 

127 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$®loÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
)

129 
P”ãùCacheLšeS‹
<
ENTRY
> 
lše_¡©e
;

130 
lše_¡©e
.
m_³rmissiÚ
 = 
AcûssP”missiÚ_Inv®id
;

131 
lše_¡©e
.
m_’Œy
 = 
	`ENTRY
();

132 
m_m­
[
	`lše_add»ss
(
add»ss
)] = 
lše_¡©e
;

133 
	}
}

136 
	g‹m¶©e
<
şass
 
	gENTRY
>

137 
šlše
 

138 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$d—Îoÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
)

140 
m_m­
.
	`”a£
(
	`lše_add»ss
(
add»ss
));

141 
	}
}

144 
	g‹m¶©e
<
şass
 
	gENTRY
>

145 
šlše
 
Add»ss


146 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$ÿcheProbe
(cÚ¡ 
Add»ss
& 
ÃwAdd»ss
) const

148 
	`·nic
("cacheProbe called in…erfect cache");

149  
ÃwAdd»ss
;

150 
	}
}

153 
	g‹m¶©e
<
şass
 
	gENTRY
>

154 
šlše
 
	gENTRY
&

155 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$lookup
(cÚ¡ 
Add»ss
& 
add»ss
)

157  
m_m­
[
	`lše_add»ss
(
add»ss
)].
m_’Œy
;

158 
	}
}

161 
	g‹m¶©e
<
şass
 
	gENTRY
>

162 
šlše
 cÚ¡ 
	gENTRY
&

163 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$lookup
(cÚ¡ 
Add»ss
& 
add»ss
) const

165  
m_m­
[
	`lše_add»ss
(
add»ss
)].
m_’Œy
;

166 
	}
}

168 
	g‹m¶©e
<
şass
 
	gENTRY
>

169 
šlše
 
AcûssP”missiÚ


170 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$g‘P”missiÚ
(cÚ¡ 
Add»ss
& 
add»ss
) const

172  
m_m­
[
	`lše_add»ss
(
add»ss
)].
m_³rmissiÚ
;

173 
	}
}

175 
	g‹m¶©e
<
şass
 
	gENTRY
>

176 
šlše
 

177 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
	$chªgeP”missiÚ
(cÚ¡ 
Add»ss
& 
add»ss
,

178 
AcûssP”missiÚ
 
Ãw_³rm
)

180 
Add»ss
 
lše_add»ss
 = 
add»ss
;

181 
lše_add»ss
.
	`makeLšeAdd»ss
();

182 
P”ãùCacheLšeS‹
<
ENTRY
>& 
lše_¡©e
 = 
m_m­
[
lše_add»ss
];

183 
lše_¡©e
.
m_³rmissiÚ
 = 
Ãw_³rm
;

184 
	}
}

186 
	g‹m¶©e
<
şass
 
	gENTRY
>

187 
šlše
 

188 
	gP”ãùCacheMemÜy
<
	gENTRY
>::
´št
(
¡d
::
o¡»am
& 
out
) const

	@ruby/system/PersistentTable.cc

29 
	~"mem/ruby/sy¡em/P”si¡’tTabË.hh
"

31 
usšg
 
Çme¥aû
 
	g¡d
;

35 
	g³rsi¡’t_¿ndomize
[] = {0, 4, 8, 12, 1, 5, 9, 13, 2, 6,

37 
	g³rsi¡’t_¿ndomize
[] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9,

41 
	gP”si¡’tTabË
::
	$P”si¡’tTabË
()

43 
	}
}

45 
P”si¡’tTabË
::~
	$P”si¡’tTabË
()

47 
	}
}

50 
P”si¡’tTabË
::
	$³rsi¡’tReque¡Lock
(cÚ¡ 
Add»ss
& 
add»ss
,

51 
MachšeID
 
lock”
,

52 
AcûssTy³
 
ty³
)

55 ià(
lock”
 =ğ
m_ch_±r
->
	`g‘ID
())

56 
cout
 << "Ch " << 
m_ch_±r
->
	`g‘ID
(è<< ": " << 
Îock”


57 << "„eque¡šg†ock fÜ " << 
add»ss
 << 
’dl
;

59 
MachšeID
 
lock”
 = (MachšeIDè
³rsi¡’t_¿ndomize
[
Îock”
];

62 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

64 cÚ¡ 
P”si¡’tTabËEÁry
 
dæt
;

65 
·œ
<
Add»ssM­
::
™”©Ü
, 
boŞ
> 
r
 =

66 
m_m­
.
	`š£¹
(
Add»ssM­
::
	`v®ue_ty³
(
add»ss
, 
dæt
));

67 
boŞ
 
´e£Á
 = !
r
.
£cÚd
;

68 
Add»ssM­
::
™”©Ü
 
i
 = 
r
.
fœ¡
;

69 
P”si¡’tTabËEÁry
 &
’Œy
 = 
i
->
£cÚd
;

71 ià(
´e£Á
) {

73 
	`as£¹
(!(
’Œy
.
m_¡¬všg
.
	`isEËm’t
(
lock”
)));

76 
’Œy
.
m_¡¬všg
.
	`add
(
lock”
);

77 ià(
ty³
 =ğ
AcûssTy³_Wr™e
)

78 
’Œy
.
m_»que¡_to_wr™e
.
	`add
(
lock”
);

80 ià(
´e£Á
)

81 
	`as£¹
(
’Œy
.
m_m¬ked
.
	`isSub£t
ÓÁry.
m_¡¬všg
));

82 
	}
}

85 
	gP”si¡’tTabË
::
	$³rsi¡’tReque¡UÆock
(cÚ¡ 
Add»ss
& 
add»ss
,

86 
MachšeID
 
uÆock”
)

89 ià(
uÆock”
 =ğ
m_ch_±r
->
	`g‘ID
())

90 
cout
 << "Ch " << 
m_ch_±r
->
	`g‘ID
(è<< ": " << 
uuÆock”


91 << "„eque¡šg uÆock fÜ " << 
add»ss
 << 
’dl
;

93 
MachšeID
 
uÆock”
 = (MachšeIDè
³rsi¡’t_¿ndomize
[
uuÆock”
];

96 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

97 
	`as£¹
(
m_m­
.
	`couÁ
(
add»ss
));

98 
P”si¡’tTabËEÁry
& 
’Œy
 = 
m_m­
[
add»ss
];

103 
	`as£¹
(
’Œy
.
m_¡¬všg
.
	`isEËm’t
(
uÆock”
));

104 
	`as£¹
(
’Œy
.
m_m¬ked
.
	`isSub£t
ÓÁry.
m_¡¬všg
));

105 
’Œy
.
m_¡¬všg
.
	`»move
(
uÆock”
);

106 
’Œy
.
m_m¬ked
.
	`»move
(
uÆock”
);

107 
’Œy
.
m_»que¡_to_wr™e
.
	`»move
(
uÆock”
);

108 
	`as£¹
(
’Œy
.
m_m¬ked
.
	`isSub£t
ÓÁry.
m_¡¬všg
));

111 ià(
’Œy
.
m_¡¬všg
.
	`isEm±y
()) {

112 
	`as£¹
(
’Œy
.
m_m¬ked
.
	`isEm±y
());

113 
m_m­
.
	`”a£
(
add»ss
);

115 
	}
}

117 
boŞ


118 
	gP”si¡’tTabË
::
	$okToIssueSrvšg
(cÚ¡ 
Add»ss
& 
add»ss
,

119 
MachšeID
 
machId
) const

121 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

123 
Add»ssM­
::
cÚ¡_™”©Ü
 
i
 = 
m_m­
.
	`fšd
(
add»ss
);

124 ià(
i
 =ğ
m_m­
.
	`’d
()) {

126  
Œue
;

129 cÚ¡ 
P”si¡’tTabËEÁry
 &
’Œy
 = 
i
->
£cÚd
;

131 ià(
’Œy
.
m_¡¬všg
.
	`isEËm’t
(
machId
)) {

134  
çl£
;

137  
’Œy
.
m_m¬ked
.
	`isEm±y
();

138 
	}
}

140 
MachšeID


141 
	gP”si¡’tTabË
::
	$fšdSm®Ë¡
(cÚ¡ 
Add»ss
& 
add»ss
) const

143 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

144 
Add»ssM­
::
cÚ¡_™”©Ü
 
i
 = 
m_m­
.
	`fšd
(
add»ss
);

145 
	`as£¹
(
i
 !ğ
m_m­
.
	`’d
());

146 cÚ¡ 
P”si¡’tTabËEÁry
& 
’Œy
 = 
i
->
£cÚd
;

147  
’Œy
.
m_¡¬všg
.
	`sm®Ë¡EËm’t
();

148 
	}
}

150 
AcûssTy³


151 
	gP”si¡’tTabË
::
	$ty³OfSm®Ë¡
(cÚ¡ 
Add»ss
& 
add»ss
) const

153 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

154 
Add»ssM­
::
cÚ¡_™”©Ü
 
i
 = 
m_m­
.
	`fšd
(
add»ss
);

155 
	`as£¹
(
i
 !ğ
m_m­
.
	`’d
());

156 cÚ¡ 
P”si¡’tTabËEÁry
& 
’Œy
 = 
i
->
£cÚd
;

157 ià(
’Œy
.
m_»que¡_to_wr™e
.

158 
	`isEËm’t
(
’Œy
.
m_¡¬všg
.
	`sm®Ë¡EËm’t
())) {

159  
AcûssTy³_Wr™e
;

161  
AcûssTy³_R—d
;

163 
	}
}

166 
	gP”si¡’tTabË
::
	$m¬kEÁr›s
(cÚ¡ 
Add»ss
& 
add»ss
)

168 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

169 
Add»ssM­
::
™”©Ü
 
i
 = 
m_m­
.
	`fšd
(
add»ss
);

170 ià(
i
 =ğ
m_m­
.
	`’d
())

173 
P”si¡’tTabËEÁry
& 
’Œy
 = 
i
->
£cÚd
;

176 
	`as£¹
(
’Œy
.
m_m¬ked
.
	`isEm±y
());

179 
’Œy
.
m_m¬ked
 =ƒÁry.
m_¡¬všg
;

180 
	}
}

182 
boŞ


183 
	gP”si¡’tTabË
::
	$isLocked
(cÚ¡ 
Add»ss
& 
add»ss
) const

185 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

188  
m_m­
.
	`couÁ
(
add»ss
) > 0;

189 
	}
}

192 
	gP”si¡’tTabË
::
	$couÁSrvšgFÜAdd»ss
(cÚ¡ 
Add»ss
& 
add»ss
) const

194 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

195 
Add»ssM­
::
cÚ¡_™”©Ü
 
i
 = 
m_m­
.
	`fšd
(
add»ss
);

196 ià(
i
 =ğ
m_m­
.
	`’d
())

199 cÚ¡ 
P”si¡’tTabËEÁry
& 
’Œy
 = 
i
->
£cÚd
;

200  
’Œy
.
m_¡¬všg
.
	`couÁ
();

201 
	}
}

204 
	gP”si¡’tTabË
::
	$couÁR—dSrvšgFÜAdd»ss
(cÚ¡ 
Add»ss
& 
add»ss
) const

206 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

207 
Add»ssM­
::
cÚ¡_™”©Ü
 
i
 = 
m_m­
.
	`fšd
(
add»ss
);

208 ià(
i
 =ğ
m_m­
.
	`’d
())

211 cÚ¡ 
P”si¡’tTabËEÁry
& 
’Œy
 = 
i
->
£cÚd
;

212  
’Œy
.
m_¡¬všg
.
	`couÁ
(è-ƒÁry.
m_»que¡_to_wr™e
.count();

213 
	}
}

216 
	gP”si¡’tTabË
::
	$´št
(
o¡»am
& 
out
) const

218 
	}
}

	@ruby/system/PersistentTable.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_PERSISTENTTABLE_HH__


30 
	#__MEM_RUBY_SYSTEM_PERSISTENTTABLE_HH__


	)

32 
	~<io¡»am
>

34 
	~"ba£/hashm­.hh
"

35 
	~"mem/´ÙocŞ/AcûssTy³.hh
"

36 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	~"mem/ruby/commÚ/N‘De¡.hh
"

38 
	~"mem/ruby/sy¡em/MachšeID.hh
"

40 şas 
	cP”si¡’tTabËEÁry


42 
	mpublic
:

43 
	$P”si¡’tTabËEÁry
() {}

44 
	`´št
(
¡d
::
o¡»am
& 
out
ècÚ¡ {
	}
}

46 
N‘De¡
 
m_¡¬všg
;

47 
N‘De¡
 
	gm_m¬ked
;

48 
N‘De¡
 
	gm_»que¡_to_wr™e
;

51 şas 
	cP”si¡’tTabË


53 
	mpublic
:

55 
P”si¡’tTabË
();

58 ~
P”si¡’tTabË
();

61 
³rsi¡’tReque¡Lock
(cÚ¡ 
Add»ss
& 
add»ss
, 
MachšeID
 
lock”
,

62 
AcûssTy³
 
ty³
);

63 
³rsi¡’tReque¡UÆock
(cÚ¡ 
Add»ss
& 
add»ss
, 
MachšeID
 
uÆock”
);

64 
boŞ
 
	$okToIssueSrvšg
(cÚ¡ 
Add»ss
& 
add»ss
, 
MachšeID
 
machID
) const;

65 
MachšeID
 
	$fšdSm®Ë¡
(cÚ¡ 
Add»ss
& 
add»ss
) const;

66 
AcûssTy³
 
	$ty³OfSm®Ë¡
(cÚ¡ 
Add»ss
& 
add»ss
) const;

67 
	`m¬kEÁr›s
(cÚ¡ 
Add»ss
& 
add»ss
);

68 
boŞ
 
	$isLocked
(cÚ¡ 
Add»ss
& 
addr
) const;

69 
	$couÁSrvšgFÜAdd»ss
(cÚ¡ 
Add»ss
& 
addr
) const;

70 
	$couÁR—dSrvšgFÜAdd»ss
(cÚ¡ 
Add»ss
& 
addr
) const;

72 
	`´št
(
¡d
::
o¡»am
& 
out
) const;

74 
´iv©e
:

76 
	`P”si¡’tTabË
(cÚ¡ 
P”si¡’tTabË
& 
obj
);

77 
P”si¡’tTabË
& 
İ”©Ü
=(cÚ¡ P”si¡’tTabË& 
obj
);

80 
m5
::
	thash_m­
<
	tAdd»ss
, 
	tP”si¡’tTabËEÁry
> 
	tAdd»ssM­
;

81 
Add»ssM­
 
m_m­
;

84 
šlše
 
¡d
::
o¡»am
&

85 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
P”si¡’tTabË
& 
obj
)

87 
obj
.
	`´št
(
out
);

88 
out
 << 
¡d
::
æush
;

89  
out
;

90 
	}
}

92 
šlše
 
	g¡d
::
o¡»am
&

93 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gP”si¡’tTabËEÁry
& 
	gobj
)

95 
	gobj
.
´št
(
out
);

96 
	gout
 << 
	g¡d
::
æush
;

97  
	gout
;

	@ruby/system/PseudoLRUPolicy.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_PSEUDOLRUPOLICY_HH__


30 
	#__MEM_RUBY_SYSTEM_PSEUDOLRUPOLICY_HH__


	)

32 
	~"mem/ruby/sy¡em/Ab¡¿ùR•Ïûm’tPŞicy.hh
"

47 şas 
	cP£udoLRUPŞicy
 : 
public
 
Ab¡¿ùR•Ïûm’tPŞicy


49 
public
:

50 
P£udoLRUPŞicy
(
Index
 
num_£ts
, Index 
assoc
);

51 ~
P£udoLRUPŞicy
();

53 
touch
(
Index
 
£t
, Index 
way
, 
Tick
 
time
);

54 
Index
 
	$g‘Viùim
(
Index
 
£t
) const;

56 
´iv©e
:

57 
m_efãùive_assoc
;

58 
m_num_Ëv–s
;

59 
ušt64
* 
m_Œ“s
;

63 
šlše


64 
P£udoLRUPŞicy
::
	$P£udoLRUPŞicy
(
Index
 
num_£ts
, Index 
assoc
)

65 : 
	$Ab¡¿ùR•Ïûm’tPŞicy
(
num_£ts
, 
assoc
)

68 
	`as£¹
(
num_£ts
 > 0 && 
assoc
 > 1 &&‡ssoø<ğ(
Index
è(
ušt64
)*4);

70 
m_Œ“s
 = 
NULL
;

71 
m_num_Ëv–s
 = 0;

73 
m_efãùive_assoc
 = 1;

74 
m_efãùive_assoc
 < 
assoc
) {

76 
m_efãùive_assoc
 <<= 1;

78 
assoc
 = 
m_efãùive_assoc
;

79 
Œue
) {

80 
assoc
 /= 2;

81 if(!
assoc
) ;

82 
m_num_Ëv–s
++;

84 
	`as£¹
(
m_num_Ëv–s
 < ()*4);

85 
m_Œ“s
 = 
Ãw
 
ušt64
[
m_num_£ts
];

86 
i
 = 0; i < 
m_num_£ts
; i++) {

87 
m_Œ“s
[
i
] = 0;

89 
	}
}

91 
šlše


92 
	gP£udoLRUPŞicy
::~
	$P£udoLRUPŞicy
()

94 ià(
m_Œ“s
 !ğ
NULL
)

95 
d–‘e
[] 
m_Œ“s
;

96 
	}
}

98 
šlše
 

99 
	gP£udoLRUPŞicy
::
	$touch
(
Index
 
£t
, Index 
šdex
, 
Tick
 
time
)

101 
	`as£¹
(
šdex
 >ğ0 && index < 
m_assoc
);

102 
	`as£¹
(
£t
 >ğ0 && s‘ < 
m_num_£ts
);

104 
Œ“_šdex
 = 0;

105 
node_v®
;

106 
i
 = 
m_num_Ëv–s
 - 1; i >= 0; i--) {

107 
node_v®
 = (
šdex
 >> 
i
)&1;

108 ià(
node_v®
)

109 
m_Œ“s
[
£t
] |ğ
node_v®
 << 
Œ“_šdex
;

111 
m_Œ“s
[
£t
] &ğ~(1 << 
Œ“_šdex
);

112 
Œ“_šdex
 = 
node_v®
 ? (tree_index*2)+2 : (tree_index*2)+1;

114 
m_Ï¡_»f_±r
[
£t
][
šdex
] = 
time
;

115 
	}
}

117 
šlše
 
Index


118 
	gP£udoLRUPŞicy
::
	$g‘Viùim
(
Index
 
£t
) const

121 
Index
 
šdex
 = 0;

123 
Œ“_šdex
 = 0;

124 
node_v®
;

125 
i
 = 0; i < 
m_num_Ëv–s
; i++){

126 
node_v®
 = (
m_Œ“s
[
£t
] >> 
Œ“_šdex
) & 1;

127 
šdex
 +ğ
node_v®
 ? 0 : (
m_efãùive_assoc
 >> (
i
 + 1));

128 
Œ“_šdex
 = 
node_v®
 ? (tree_index * 2) + 1 : (tree_index * 2) + 2;

130 
	`as£¹
(
šdex
 >ğ0 && index < 
m_efãùive_assoc
);

134  (
šdex
 > (
m_assoc
 - 1)) ? m_assoc - 1 : index;

135 
	}
}

	@ruby/system/RubyMemoryControl.cc

108 
	~"ba£/ÿ¡.hh
"

109 
	~"ba£/ırštf.hh
"

110 
	~"mem/ruby/commÚ/Add»ss.hh
"

111 
	~"mem/ruby/commÚ/CÚsum”.hh
"

112 
	~"mem/ruby/commÚ/Glob®.hh
"

113 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

114 
	~"mem/ruby/´of”/Prof”.hh
"

115 
	~"mem/ruby/¦icc_š‹rçû/N‘wÜkMes§ge.hh
"

116 
	~"mem/ruby/¦icc_š‹rçû/RubySlicc_CompÚ’tM­pšg.hh
"

117 
	~"mem/ruby/sy¡em/RubyMemÜyCÚŒŞ.hh
"

118 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

120 
usšg
 
Çme¥aû
 
	g¡d
;

122 
şass
 
	gCÚsum”
;

133 
	#IDLECOUNT_MAX_VALUE
 1000

	)

137 
	go¡»am
&

138 
	gİ”©Ü
<<(
	go¡»am
& 
	gout
, cÚ¡ 
	gRubyMemÜyCÚŒŞ
& 
	gobj
)

140 
	gobj
.
´št
(
out
);

141 
	gout
 << 
	gæush
;

142  
	gout
;

149 
	gRubyMemÜyCÚŒŞ
::
	$RubyMemÜyCÚŒŞ
(cÚ¡ 
P¬ams
 *
p
)

150 : 
	$MemÜyCÚŒŞ
(
p
)

152 
m_bªks_³r_¿nk
 = 
p
->
bªks_³r_¿nk
;

153 
m_¿nks_³r_dimm
 = 
p
->
¿nks_³r_dimm
;

154 
m_dimms_³r_chªÃl
 = 
p
->
dimms_³r_chªÃl
;

155 
m_bªk_b™_0
 = 
p
->
bªk_b™_0
;

156 
m_¿nk_b™_0
 = 
p
->
¿nk_b™_0
;

157 
m_dimm_b™_0
 = 
p
->
dimm_b™_0
;

158 
m_bªk_queue_size
 = 
p
->
bªk_queue_size
;

159 
m_bªk_busy_time
 = 
p
->
bªk_busy_time
;

160 
m_¿nk_¿nk_d–ay
 = 
p
->
¿nk_¿nk_d–ay
;

161 
m_»ad_wr™e_d–ay
 = 
p
->
»ad_wr™e_d–ay
;

162 
m_basic_bus_busy_time
 = 
p
->
basic_bus_busy_time
;

163 
m_mem_ùl_Ï‹ncy
 = 
p
->
mem_ùl_Ï‹ncy
;

164 
m_»äesh_³riod
 = 
p
->
»äesh_³riod
;

165 
m_tFaw
 = 
p
->
tFaw
;

166 
m_mem_¿ndom_¬b™¿‹
 = 
p
->
mem_¿ndom_¬b™¿‹
;

167 
m_mem_fixed_d–ay
 = 
p
->
mem_fixed_d–ay
;

169 
m_´of”_±r
 = 
Ãw
 
	`MemCÁ¾Prof”
(
	`Çme
(),

170 
m_bªks_³r_¿nk
,

171 
m_¿nks_³r_dimm
,

172 
m_dimms_³r_chªÃl
);

173 
	}
}

176 
	gRubyMemÜyCÚŒŞ
::
	$š™
()

178 
m_msg_couÁ”
 = 0;

180 
	`as£¹
(
m_tFaw
 <= 62);

182 
m_tÙ®_bªks
 = 
m_bªks_³r_¿nk
 * 
m_¿nks_³r_dimm
 * 
m_dimms_³r_chªÃl
;

183 
m_tÙ®_¿nks
 = 
m_¿nks_³r_dimm
 * 
m_dimms_³r_chªÃl
;

184 
m_»äesh_³riod_sy¡em
 = 
m_»äesh_³riod
 / 
m_tÙ®_bªks
;

186 
m_bªkQueues
 = 
Ãw
 
li¡
<
MemÜyNode
> [
m_tÙ®_bªks
];

187 
	`as£¹
(
m_bªkQueues
);

189 
m_bªkBusyCouÁ”
 = 
Ãw
 [
m_tÙ®_bªks
];

190 
	`as£¹
(
m_bªkBusyCouÁ”
);

192 
m_ŞdReque¡
 = 
Ãw
 [
m_tÙ®_bªks
];

193 
	`as£¹
(
m_ŞdReque¡
);

195 
i
 = 0; i < 
m_tÙ®_bªks
; i++) {

196 
m_bªkBusyCouÁ”
[
i
] = 0;

197 
m_ŞdReque¡
[
i
] = 0;

200 
m_busBusyCouÁ”_Basic
 = 0;

201 
m_busBusyCouÁ”_Wr™e
 = 0;

202 
m_busBusyCouÁ”_R—dNewRªk
 = 0;

203 
m_busBusy_WhichRªk
 = 0;

205 
m_roundRobš
 = 0;

206 
m_»äesh_couÁ
 = 1;

207 
m_Ãed_»äesh
 = 0;

208 
m_»äesh_bªk
 = 0;

209 
m_idËCouÁ
 = 0;

210 
m_ageCouÁ”
 = 0;

217 
m_tçw_shiá
 = 
Ãw
 
ušt64
[
m_tÙ®_¿nks
];

218 
m_tçw_couÁ
 = 
Ãw
 [
m_tÙ®_¿nks
];

219 
i
 = 0; i < 
m_tÙ®_¿nks
; i++) {

220 
m_tçw_shiá
[
i
] = 0;

221 
m_tçw_couÁ
[
i
] = 0;

223 
	}
}

226 
	gRubyMemÜyCÚŒŞ
::
	$»£t
()

228 
m_msg_couÁ”
 = 0;

230 
	`as£¹
(
m_tFaw
 <= 62);

232 
m_tÙ®_bªks
 = 
m_bªks_³r_¿nk
 * 
m_¿nks_³r_dimm
 * 
m_dimms_³r_chªÃl
;

233 
m_tÙ®_¿nks
 = 
m_¿nks_³r_dimm
 * 
m_dimms_³r_chªÃl
;

234 
m_»äesh_³riod_sy¡em
 = 
m_»äesh_³riod
 / 
m_tÙ®_bªks
;

236 
	`as£¹
(
m_bªkQueues
);

238 
	`as£¹
(
m_bªkBusyCouÁ”
);

240 
	`as£¹
(
m_ŞdReque¡
);

242 
i
 = 0; i < 
m_tÙ®_bªks
; i++) {

243 
m_bªkBusyCouÁ”
[
i
] = 0;

244 
m_ŞdReque¡
[
i
] = 0;

247 
m_busBusyCouÁ”_Basic
 = 0;

248 
m_busBusyCouÁ”_Wr™e
 = 0;

249 
m_busBusyCouÁ”_R—dNewRªk
 = 0;

250 
m_busBusy_WhichRªk
 = 0;

252 
m_roundRobš
 = 0;

253 
m_»äesh_couÁ
 = 1;

254 
m_Ãed_»äesh
 = 0;

255 
m_»äesh_bªk
 = 0;

256 
m_idËCouÁ
 = 0;

257 
m_ageCouÁ”
 = 0;

264 
i
 = 0; i < 
m_tÙ®_¿nks
; i++) {

265 
m_tçw_shiá
[
i
] = 0;

266 
m_tçw_couÁ
[
i
] = 0;

268 
	}
}

270 
	gRubyMemÜyCÚŒŞ
::~
	$RubyMemÜyCÚŒŞ
()

272 
d–‘e
 [] 
m_bªkQueues
;

273 
d–‘e
 [] 
m_bªkBusyCouÁ”
;

274 
d–‘e
 [] 
m_ŞdReque¡
;

275 
d–‘e
 
m_´of”_±r
;

276 
	}
}

280 
	gRubyMemÜyCÚŒŞ
::
	$’queue
(cÚ¡ 
MsgPŒ
& 
mes§ge
, 
Cyşes
 
Ï‹ncy
)

282 
Cyşes
 
¬riv®_time
 = 
	`curCyşe
(è+ 
Ï‹ncy
;

283 cÚ¡ 
MemÜyMsg
* 
memMess
 = 
§ã_ÿ¡
<cÚ¡ MemÜyMsg*>(
mes§ge
.
	`g‘
());

284 
physiÿl_add»ss_t
 
addr
 = 
memMess
->
	`g‘Addr
().
	`g‘Add»ss
();

285 
MemÜyReque¡Ty³
 
ty³
 = 
memMess
->
	`g‘Ty³
();

286 
boŞ
 
is_mem_»ad
 = (
ty³
 =ğ
MemÜyReque¡Ty³_MEMORY_READ
);

287 
MemÜyNode
 
	`thisReq
(
¬riv®_time
, 
mes§ge
, 
addr
, 
is_mem_»ad
, !is_mem_read);

288 
	`’queueMemRef
(
thisReq
);

289 
	}
}

294 
	gRubyMemÜyCÚŒŞ
::
	$’queueMemRef
(
MemÜyNode
& 
memRef
)

296 
m_msg_couÁ”
++;

297 
memRef
.
m_msg_couÁ”
 = m_msg_counter;

298 
physiÿl_add»ss_t
 
addr
 = 
memRef
.
m_addr
;

299 
bªk
 = 
	`g‘Bªk
(
addr
);

301 
	`DPRINTF
(
RubyMemÜy
,

303 
m_msg_couÁ”
, 
addr
, 
memRef
.
m_is_mem_»ad
 ? 'R':'W',

304 
memRef
.
m_time
 * 
g_sy¡em_±r
->
	`şockP”iod
(),

305 
bªk
, 
m_ev’t
.
	`scheduËd
() ? 'Y':'N');

307 
m_´of”_±r
->
	`´ofeMemReq
(
bªk
);

308 
m_šput_queue
.
	`push_back
(
memRef
);

310 ià(!
m_ev’t
.
	`scheduËd
()) {

311 
	`scheduË
(
m_ev’t
, 
	`şockEdge
());

313 
	}
}

318 
	gRubyMemÜyCÚŒŞ
::
	$dequeue
()

320 
	`as£¹
(
	`isR—dy
());

321 
m_»¥Ú£_queue
.
	`pİ_äÚt
();

322 
	}
}

324 cÚ¡ 
Mes§ge
*

325 
	gRubyMemÜyCÚŒŞ
::
	$³ek
()

327 
MemÜyNode
 
node
 = 
	`³ekNode
();

328 
Mes§ge
* 
msg_±r
 = 
node
.
m_msg±r
.
	`g‘
();

329 
	`as£¹
(
msg_±r
 !ğ
NULL
);

330  
msg_±r
;

331 
	}
}

333 
MemÜyNode


334 
	gRubyMemÜyCÚŒŞ
::
	$³ekNode
()

336 
	`as£¹
(
	`isR—dy
());

337 
MemÜyNode
 
»q
 = 
m_»¥Ú£_queue
.
	`äÚt
();

338 
	`DPRINTF
(
RubyMemÜy
, "Peek: memory„equest%7d: %#08x %c sched %c\n",

339 
»q
.
m_msg_couÁ”
,„eq.
m_addr
,„eq.
m_is_mem_»ad
 ? 'R':'W',

340 
m_ev’t
.
	`scheduËd
() ? 'Y':'N');

342  
»q
;

343 
	}
}

345 
boŞ


346 
	gRubyMemÜyCÚŒŞ
::
	$isR—dy
()

348  ((!
m_»¥Ú£_queue
.
	`em±y
()) &&

349 (
m_»¥Ú£_queue
.
	`äÚt
().
m_time
 <ğ
g_sy¡em_±r
->
	`curCyşe
()));

350 
	}
}

353 
	gRubyMemÜyCÚŒŞ
::
	$£tCÚsum”
(
CÚsum”
* 
cÚsum”_±r
)

355 
m_cÚsum”_±r
 = 
cÚsum”_±r
;

356 
	}
}

359 
	gRubyMemÜyCÚŒŞ
::
	$´št
(
o¡»am
& 
out
) const

361 
	}
}

365 
RubyMemÜyCÚŒŞ
::
	$’queueToDœeùÜy
(
MemÜyNode
 
»q
, 
Cyşes
 
Ï‹ncy
)

367 
Tick
 
¬riv®_time
 = 
	`şockEdge
(
Ï‹ncy
);

368 
Cyşes
 
ruby_¬riv®_time
 = 
g_sy¡em_±r
->
	`ticksToCyşes
(
¬riv®_time
);

369 
»q
.
m_time
 = 
ruby_¬riv®_time
;

370 
m_»¥Ú£_queue
.
	`push_back
(
»q
);

372 
	`DPRINTF
(
RubyMemÜy
, "Enqueueing msg %#08x %c backo directory‡t %15d\n",

373 
»q
.
m_addr
,„eq.
m_is_mem_»ad
 ? 'R':'W', 
¬riv®_time
);

376 
m_cÚsum”_±r
->
	`scheduËEv’tAbsŞu‹
(
¬riv®_time
);

377 
	}
}

382 
	gRubyMemÜyCÚŒŞ
::
	$g‘Bªk
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const

384 
dimm
 = (
addr
 >> 
m_dimm_b™_0
è& (
m_dimms_³r_chªÃl
 - 1);

385 
¿nk
 = (
addr
 >> 
m_¿nk_b™_0
è& (
m_¿nks_³r_dimm
 - 1);

386 
bªk
 = (
addr
 >> 
m_bªk_b™_0
è& (
m_bªks_³r_¿nk
 - 1);

387  (
dimm
 * 
m_¿nks_³r_dimm
 * 
m_bªks_³r_¿nk
)

388 + (
¿nk
 * 
m_bªks_³r_¿nk
)

389 + 
bªk
;

390 
	}
}

393 
	gRubyMemÜyCÚŒŞ
::
	$g‘Rªk
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const

395 
bªk
 = 
	`g‘Bªk
(
addr
);

396 
¿nk
 = (
bªk
 / 
m_bªks_³r_¿nk
);

397 
	`as£¹
 (
¿nk
 < (
m_¿nks_³r_dimm
 * 
m_dimms_³r_chªÃl
));

398  
¿nk
;

399 
	}
}

404 
	gRubyMemÜyCÚŒŞ
::
	$g‘Rªk
(
bªk
) const

406 
¿nk
 = (
bªk
 / 
m_bªks_³r_¿nk
);

407 
	`as£¹
 (
¿nk
 < (
m_¿nks_³r_dimm
 * 
m_dimms_³r_chªÃl
));

408  
¿nk
;

409 
	}
}

413 
	gRubyMemÜyCÚŒŞ
::
	$g‘ChªÃl
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const

415 
	`as£¹
(
çl£
);

417 
	}
}

421 
	gRubyMemÜyCÚŒŞ
::
	$g‘Row
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const

423 
	`as£¹
(
çl£
);

425 
	}
}

429 
boŞ


430 
	gRubyMemÜyCÚŒŞ
::
	$queueR—dy
(
bªk
)

432 ià((
m_bªkBusyCouÁ”
[
bªk
] > 0è&& !
m_mem_fixed_d–ay
) {

433 
m_´of”_±r
->
	`´ofeMemBªkBusy
();

435 
	`DPRINTF
(
RubyMemÜy
, "bªk %x busy %d\n", 
bªk
, 
m_bªkBusyCouÁ”
[bank]);

436  
çl£
;

439 ià(
m_mem_¿ndom_¬b™¿‹
 >= 2) {

440 ià((
	`¿ndom
(è% 100è< 
m_mem_¿ndom_¬b™¿‹
) {

441 
m_´of”_±r
->
	`´ofeMemRªdBusy
();

442  
çl£
;

446 ià(
m_mem_fixed_d–ay
)

447  
Œue
;

449 ià((
m_ageCouÁ”
 > (2 * 
m_bªk_busy_time
)è&& !
m_ŞdReque¡
[
bªk
]) {

450 
m_´of”_±r
->
	`´ofeMemNÙOld
();

451  
çl£
;

454 ià(
m_busBusyCouÁ”_Basic
 =ğ
m_basic_bus_busy_time
) {

460 
m_´of”_±r
->
	`´ofeMemArbWa™
(1);

461  
çl£
;

464 ià(
m_busBusyCouÁ”_Basic
 > 0) {

465 
m_´of”_±r
->
	`´ofeMemBusBusy
();

466  
çl£
;

469 
¿nk
 = 
	`g‘Rªk
(
bªk
);

470 ià(
m_tçw_couÁ
[
¿nk
] >ğ
ACTIVATE_PER_TFAW
) {

471 
m_´of”_±r
->
	`´ofeMemTçwBusy
();

472  
çl£
;

475 
boŞ
 
wr™e
 = !
m_bªkQueues
[
bªk
].
	`äÚt
().
m_is_mem_»ad
;

476 ià(
wr™e
 && (
m_busBusyCouÁ”_Wr™e
 > 0)) {

477 
m_´of”_±r
->
	`´ofeMemR—dWr™eBusy
();

478  
çl£
;

481 ià(!
wr™e
 && (
¿nk
 !ğ
m_busBusy_WhichRªk
)

482 && (
m_busBusyCouÁ”_R—dNewRªk
 > 0)) {

483 
m_´of”_±r
->
	`´ofeMemD©aBusBusy
();

484  
çl£
;

487  
Œue
;

488 
	}
}

492 
boŞ


493 
	gRubyMemÜyCÚŒŞ
::
	$issueReäesh
(
bªk
)

495 ià(!
m_Ãed_»äesh
 || (
m_»äesh_bªk
 !ğ
bªk
))

496  
çl£
;

497 ià(
m_bªkBusyCouÁ”
[
bªk
] > 0)

498  
çl£
;

501 ià(
m_busBusyCouÁ”_Basic
 > 0)

502  
çl£
;

503 
¿nk
 = 
	`g‘Rªk
(
bªk
);

504 ià(
m_tçw_couÁ
[
¿nk
] >ğ
ACTIVATE_PER_TFAW
)

505  
çl£
;

508 
	`DPRINTF
(
RubyMemÜy
, "Reäesh bªk %3x\n", 
bªk
);

510 
m_´of”_±r
->
	`´ofeMemReäesh
();

511 
m_Ãed_»äesh
--;

512 
m_»äesh_bªk
++;

513 ià(
m_»äesh_bªk
 >ğ
m_tÙ®_bªks
)

514 
m_»äesh_bªk
 = 0;

515 
m_bªkBusyCouÁ”
[
bªk
] = 
m_bªk_busy_time
;

516 
m_busBusyCouÁ”_Basic
 = 
m_basic_bus_busy_time
;

517 
m_busBusyCouÁ”_Wr™e
 = 
m_basic_bus_busy_time
;

518 
m_busBusyCouÁ”_R—dNewRªk
 = 
m_basic_bus_busy_time
;

519 
	`m¬kTçw
(
¿nk
);

520  
Œue
;

521 
	}
}

525 
	gRubyMemÜyCÚŒŞ
::
	$m¬kTçw
(
¿nk
)

527 ià(
m_tFaw
) {

528 
m_tçw_shiá
[
¿nk
] |ğ(1 << (
m_tFaw
-1));

529 
m_tçw_couÁ
[
¿nk
]++;

531 
	}
}

537 
	gRubyMemÜyCÚŒŞ
::
	$issueReque¡
(
bªk
)

539 
¿nk
 = 
	`g‘Rªk
(
bªk
);

540 
MemÜyNode
 
»q
 = 
m_bªkQueues
[
bªk
].
	`äÚt
();

541 
m_bªkQueues
[
bªk
].
	`pİ_äÚt
();

543 
	`DPRINTF
(
RubyMemÜy
, "Mem issue„equest%7d: %#08x %c "

544 "bªk=%3x sched %c\n", 
»q
.
m_msg_couÁ”
,„eq.
m_addr
,

545 
»q
.
m_is_mem_»ad
? 'R':'W',

546 
bªk
, 
m_ev’t
.
	`scheduËd
() ? 'Y':'N');

548 ià(
»q
.
m_msg±r
) {

549 
	`’queueToDœeùÜy
(
»q
, 
	`Cyşes
(
m_mem_ùl_Ï‹ncy
 + 
m_mem_fixed_d–ay
));

551 
m_ŞdReque¡
[
bªk
] = 0;

552 
	`m¬kTçw
(
¿nk
);

553 
m_bªkBusyCouÁ”
[
bªk
] = 
m_bªk_busy_time
;

554 
m_busBusy_WhichRªk
 = 
¿nk
;

555 ià(
»q
.
m_is_mem_»ad
) {

556 
m_´of”_±r
->
	`´ofeMemR—d
();

557 
m_busBusyCouÁ”_Basic
 = 
m_basic_bus_busy_time
;

558 
m_busBusyCouÁ”_Wr™e
 = 
m_basic_bus_busy_time
 + 
m_»ad_wr™e_d–ay
;

559 
m_busBusyCouÁ”_R—dNewRªk
 =

560 
m_basic_bus_busy_time
 + 
m_¿nk_¿nk_d–ay
;

562 
m_´of”_±r
->
	`´ofeMemWr™e
();

563 
m_busBusyCouÁ”_Basic
 = 
m_basic_bus_busy_time
;

564 
m_busBusyCouÁ”_Wr™e
 = 
m_basic_bus_busy_time
;

565 
m_busBusyCouÁ”_R—dNewRªk
 = 
m_basic_bus_busy_time
;

567 
	}
}

572 
	gRubyMemÜyCÚŒŞ
::
	$execu‹Cyşe
()

575 
bªk
=0; bªk < 
m_tÙ®_bªks
; bank++) {

576 ià(
m_bªkBusyCouÁ”
[
bªk
] > 0) m_bankBusyCounter[bank]--;

578 ià(
m_busBusyCouÁ”_Wr™e
 > 0)

579 
m_busBusyCouÁ”_Wr™e
--;

580 ià(
m_busBusyCouÁ”_R—dNewRªk
 > 0)

581 
m_busBusyCouÁ”_R—dNewRªk
--;

582 ià(
m_busBusyCouÁ”_Basic
 > 0)

583 
m_busBusyCouÁ”_Basic
--;

586 
¿nk
=0;„ªk < 
m_tÙ®_¿nks
;„ank++) {

587 ià(
m_tçw_shiá
[
¿nk
] & 1è
m_tçw_couÁ
[rank]--;

588 
m_tçw_shiá
[
¿nk
] >>= 1;

593 ià(!
m_mem_fixed_d–ay
è
m_»äesh_couÁ
--;

594 ià(
m_»äesh_couÁ
 == 0) {

595 
m_»äesh_couÁ
 = 
m_»äesh_³riod_sy¡em
;

598 
	`as£¹
(
m_Ãed_»äesh
 < 10);

599 
m_Ãed_»äesh
++;

603 
m_ageCouÁ”
++;

604 
ªyOld
 = 0;

605 
bªk
=0; bªk < 
m_tÙ®_bªks
; bank++) {

606 
ªyOld
 |ğ
m_ŞdReque¡
[
bªk
];

608 ià(!
ªyOld
) {

609 
bªk
=0; bªk < 
m_tÙ®_bªks
; bank++) {

610 ià(!
m_bªkQueues
[
bªk
].
	`em±y
()è
m_ŞdReque¡
[bank] = 1;

612 
m_ageCouÁ”
 = 0;

616 ià(
m_mem_¿ndom_¬b™¿‹
) {

617 
m_roundRobš
 = 
	`¿ndom
(è% 
m_tÙ®_bªks
;

626 
queueH—ds
 = 0;

627 
bªksIssued
 = 0;

628 
i
 = 0; i < 
m_tÙ®_bªks
; i++) {

629 
m_roundRobš
++;

630 ià(
m_roundRobš
 >ğ
m_tÙ®_bªks
) m_roundRobin = 0;

631 
	`issueReäesh
(
m_roundRobš
);

632 
qs
 = 
m_bªkQueues
[
m_roundRobš
].
	`size
();

633 ià(
qs
 > 1) {

634 
m_´of”_±r
->
	`´ofeMemBªkQ
(
qs
-1);

636 ià(
qs
 > 0) {

638 
m_idËCouÁ
 = 
IDLECOUNT_MAX_VALUE
;

639 
queueH—ds
++;

640 ià(
	`queueR—dy
(
m_roundRobš
)) {

641 
	`issueReque¡
(
m_roundRobš
);

642 
bªksIssued
++;

643 ià(
m_mem_fixed_d–ay
) {

644 
m_´of”_±r
->
	`´ofeMemWa™Cyşes
(
m_mem_fixed_d–ay
);

652 
m_´of”_±r
->
	`´ofeMemWa™Cyşes
(
queueH—ds
 - 
bªksIssued
);

660 ià(!
m_šput_queue
.
	`em±y
()) {

662 
m_idËCouÁ
 = 
IDLECOUNT_MAX_VALUE
;

663 
MemÜyNode
 
»q
 = 
m_šput_queue
.
	`äÚt
();

664 
bªk
 = 
	`g‘Bªk
(
»q
.
m_addr
);

665 ià(
m_bªkQueues
[
bªk
].
	`size
(è< 
m_bªk_queue_size
) {

666 
m_šput_queue
.
	`pİ_äÚt
();

667 
m_bªkQueues
[
bªk
].
	`push_back
(
»q
);

669 
m_´of”_±r
->
	`´ofeMemIÅutQ
(
m_šput_queue
.
	`size
());

671 
	}
}

674 
	gRubyMemÜyCÚŒŞ
::
	$d¿š
(
D¿šMªag”
 *
dm
)

676 
	`DPRINTF
(
RubyMemÜy
, "MemoryController drain\n");

677 if(
m_ev’t
.
	`scheduËd
()) {

678 
	`descheduË
(
m_ev’t
);

681 
	}
}

685 
	gRubyMemÜyCÚŒŞ
::
	$wakeup
()

687 
	`DPRINTF
(
RubyMemÜy
, "MemoryController wakeup\n");

689 
	`execu‹Cyşe
();

691 
m_idËCouÁ
--;

692 ià(
m_idËCouÁ
 > 0) {

693 
	`as£¹
(!
m_ev’t
.
	`scheduËd
());

694 
	`scheduË
(
m_ev’t
, 
	`şockEdge
(
	`Cyşes
(1)));

696 
	}
}

707 
boŞ


708 
	gRubyMemÜyCÚŒŞ
::
	$funùiÚ®R—dBufãrs
(
Pack‘
 *
pkt
)

710 
¡d
::
li¡
<
MemÜyNode
>::
™”©Ü
 
™
 = 
m_šput_queue
.
	`begš
();

711 
™
 !ğ
m_šput_queue
.
	`’d
(); ++it) {

712 
Mes§ge
* 
msg_±r
 = (*
™
).
m_msg±r
.
	`g‘
();

713 ià(
msg_±r
->
	`funùiÚ®R—d
(
pkt
)) {

714  
Œue
;

718 
¡d
::
li¡
<
MemÜyNode
>::
™”©Ü
 
™
 = 
m_»¥Ú£_queue
.
	`begš
();

719 
™
 !ğ
m_»¥Ú£_queue
.
	`’d
(); ++it) {

720 
Mes§ge
* 
msg_±r
 = (*
™
).
m_msg±r
.
	`g‘
();

721 ià(
msg_±r
->
	`funùiÚ®R—d
(
pkt
)) {

722  
Œue
;

726 
ušt32_t
 
bªk
 = 0; bªk < 
m_tÙ®_bªks
; ++bank) {

727 
¡d
::
li¡
<
MemÜyNode
>::
™”©Ü
 
™
 = 
m_bªkQueues
[
bªk
].
	`begš
();

728 
™
 !ğ
m_bªkQueues
[
bªk
].
	`’d
(); ++it) {

729 
Mes§ge
* 
msg_±r
 = (*
™
).
m_msg±r
.
	`g‘
();

730 ià(
msg_±r
->
	`funùiÚ®R—d
(
pkt
)) {

731  
Œue
;

736  
çl£
;

737 
	}
}

747 
ušt32_t


748 
	gRubyMemÜyCÚŒŞ
::
	$funùiÚ®Wr™eBufãrs
(
Pack‘
 *
pkt
)

750 
ušt32_t
 
num_funùiÚ®_wr™es
 = 0;

752 
¡d
::
li¡
<
MemÜyNode
>::
™”©Ü
 
™
 = 
m_šput_queue
.
	`begš
();

753 
™
 !ğ
m_šput_queue
.
	`’d
(); ++it) {

754 
Mes§ge
* 
msg_±r
 = (*
™
).
m_msg±r
.
	`g‘
();

755 ià(
msg_±r
->
	`funùiÚ®Wr™e
(
pkt
)) {

756 
num_funùiÚ®_wr™es
++;

760 
¡d
::
li¡
<
MemÜyNode
>::
™”©Ü
 
™
 = 
m_»¥Ú£_queue
.
	`begš
();

761 
™
 !ğ
m_»¥Ú£_queue
.
	`’d
(); ++it) {

762 
Mes§ge
* 
msg_±r
 = (*
™
).
m_msg±r
.
	`g‘
();

763 ià(
msg_±r
->
	`funùiÚ®Wr™e
(
pkt
)) {

764 
num_funùiÚ®_wr™es
++;

768 
ušt32_t
 
bªk
 = 0; bªk < 
m_tÙ®_bªks
; ++bank) {

769 
¡d
::
li¡
<
MemÜyNode
>::
™”©Ü
 
™
 = 
m_bªkQueues
[
bªk
].
	`begš
();

770 
™
 !ğ
m_bªkQueues
[
bªk
].
	`’d
(); ++it) {

771 
Mes§ge
* 
msg_±r
 = (*
™
).
m_msg±r
.
	`g‘
();

772 ià(
msg_±r
->
	`funùiÚ®Wr™e
(
pkt
)) {

773 
num_funùiÚ®_wr™es
++;

778  
num_funùiÚ®_wr™es
;

779 
	}
}

782 
	gRubyMemÜyCÚŒŞ
::
	$»gSts
()

784 
m_´of”_±r
->
	`»gSts
();

785 
	}
}

787 
RubyMemÜyCÚŒŞ
 *

788 
	gRubyMemÜyCÚŒŞP¬ams
::
	$ü—‹
()

790  
Ãw
 
	`RubyMemÜyCÚŒŞ
(
this
);

791 
	}
}

	@ruby/system/RubyMemoryControl.hh

30 #iâdeà
__MEM_RUBY_SYSTEM_MEMORY_CONTROL_HH__


31 
	#__MEM_RUBY_SYSTEM_MEMORY_CONTROL_HH__


	)

33 
	~<io¡»am
>

34 
	~<li¡
>

35 
	~<¡ršg
>

37 
	~"mem/´ÙocŞ/MemÜyMsg.hh
"

38 
	~"mem/ruby/commÚ/Add»ss.hh
"

39 
	~"mem/ruby/commÚ/CÚsum”.hh
"

40 
	~"mem/ruby/commÚ/Glob®.hh
"

41 
	~"mem/ruby/´of”/MemCÁ¾Prof”.hh
"

42 
	~"mem/ruby/¦icc_š‹rçû/Mes§ge.hh
"

43 
	~"mem/ruby/sy¡em/MemÜyCÚŒŞ.hh
"

44 
	~"mem/ruby/sy¡em/MemÜyNode.hh
"

45 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

46 
	~"·¿ms/RubyMemÜyCÚŒŞ.hh
"

47 
	~"sim/sim_objeù.hh
"

51 
	#ACTIVATE_PER_TFAW
 4

	)

55 şas 
	cRubyMemÜyCÚŒŞ
 : 
public
 
MemÜyCÚŒŞ


57 
public
:

58 
RubyMemÜyCÚŒŞP¬ams
 
	tP¬ams
;

59 
RubyMemÜyCÚŒŞ
(cÚ¡ 
P¬ams
 *
p
);

60 
š™
();

61 
»£t
();

63 ~
RubyMemÜyCÚŒŞ
();

65 
d¿š
(
D¿šMªag”
 *
dm
);

67 
wakeup
();

69 
£tCÚsum”
(
CÚsum”
* 
cÚsum”_±r
);

70 
CÚsum”
* 
	$g‘CÚsum”
(è{  
m_cÚsum”_±r
; };

71 
	`£tDesütiÚ
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
è{ 
m_desütiÚ
 =‚ame; 
	}
};

72 
	g¡d
::
¡ršg
 
	$g‘DesütiÚ
(è{  
m_desütiÚ
; 
	}
};

75 
’queue
(cÚ¡ 
MsgPŒ
& 
mes§ge
, 
Cyşes
 
Ï‹ncy
);

76 
’queueMemRef
(
MemÜyNode
& 
memRef
);

77 
dequeue
();

78 cÚ¡ 
Mes§ge
* 
³ek
();

79 
MemÜyNode
 
³ekNode
();

80 
boŞ
 
isR—dy
();

81 
boŞ
 
	$¬eNSlÙsAvaabË
(
n
è{  
Œue
; 
	}
};

83 
´št
(
¡d
::
o¡»am
& 
out
) const;

84 
»gSts
();

86 cÚ¡ 
	$g‘Bªk
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const;

87 cÚ¡ 
	$g‘Rªk
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const;

90 cÚ¡ 
	$g‘ChªÃl
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const;

91 cÚ¡ 
	$g‘Row
(cÚ¡ 
physiÿl_add»ss_t
 
addr
) const;

94 
	$g‘BªksP”Rªk
(è{  
m_bªks_³r_¿nk
; 
	}
};

95 
	$g‘RªksP”Dimm
(è{  
m_¿nks_³r_dimm
; 
	}
};

96 
	$g‘DimmsP”ChªÃl
(è{  
m_dimms_³r_chªÃl
; 
	}
}

98 
boŞ
 
funùiÚ®R—dBufãrs
(
Pack‘
 *
pkt
);

99 
ušt32_t
 
funùiÚ®Wr™eBufãrs
(
Pack‘
 *
pkt
);

101 
	g´iv©e
:

102 
’queueToDœeùÜy
(
MemÜyNode
 
»q
, 
Cyşes
 
Ï‹ncy
);

103 cÚ¡ 
	$g‘Rªk
(
bªk
) const;

104 
boŞ
 
	`queueR—dy
(
bªk
);

105 
	`issueReque¡
(
bªk
);

106 
boŞ
 
	`issueReäesh
(
bªk
);

107 
	`m¬kTçw
(
¿nk
);

108 
	`execu‹Cyşe
();

111 
	`RubyMemÜyCÚŒŞ
 (cÚ¡ 
RubyMemÜyCÚŒŞ
& 
obj
);

112 
RubyMemÜyCÚŒŞ
& 
İ”©Ü
=(cÚ¡ RubyMemÜyCÚŒŞ& 
obj
);

115 
CÚsum”
* 
m_cÚsum”_±r
;

116 
¡d
::
¡ršg
 
m_desütiÚ
;

117 
m_msg_couÁ”
;

119 
m_bªks_³r_¿nk
;

120 
m_¿nks_³r_dimm
;

121 
m_dimms_³r_chªÃl
;

122 
m_bªk_b™_0
;

123 
m_¿nk_b™_0
;

124 
m_dimm_b™_0
;

125 
m_bªk_queue_size
;

126 
m_bªk_busy_time
;

127 
m_¿nk_¿nk_d–ay
;

128 
m_»ad_wr™e_d–ay
;

129 
m_basic_bus_busy_time
;

130 
Cyşes
 
m_mem_ùl_Ï‹ncy
;

131 
m_»äesh_³riod
;

132 
m_mem_¿ndom_¬b™¿‹
;

133 
m_tFaw
;

134 
Cyşes
 
m_mem_fixed_d–ay
;

136 
m_tÙ®_bªks
;

137 
m_tÙ®_¿nks
;

138 
m_»äesh_³riod_sy¡em
;

141 
¡d
::
li¡
<
MemÜyNode
> 
m_»¥Ú£_queue
;

142 
¡d
::
li¡
<
MemÜyNode
> 
m_šput_queue
;

143 
¡d
::
li¡
<
MemÜyNode
>* 
m_bªkQueues
;

147 * 
m_bªkBusyCouÁ”
;

148 * 
m_ŞdReque¡
;

150 
ušt64
* 
m_tçw_shiá
;

151 * 
m_tçw_couÁ
;

155 
m_busBusyCouÁ”_Wr™e
;

156 
m_busBusyCouÁ”_R—dNewRªk
;

157 
m_busBusyCouÁ”_Basic
;

159 
m_busBusy_WhichRªk
;

160 
m_roundRobš
;

161 
m_»äesh_couÁ
;

162 
m_Ãed_»äesh
;

163 
m_»äesh_bªk
;

164 
m_ageCouÁ”
;

165 
m_idËCouÁ
;

167 
MemCÁ¾Prof”
* 
m_´of”_±r
;

168 
	}
};

170 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am& 
out
, cÚ¡ 
	gRubyMemÜyCÚŒŞ
& 
	gobj
);

	@ruby/system/RubyPort.cc

42 
	~"ıu/‹¡”s/ruby‹¡/RubyTe¡”.hh
"

43 
	~"debug/CÚfig.hh
"

44 
	~"debug/D¿š.hh
"

45 
	~"debug/Ruby.hh
"

46 
	~"mem/´ÙocŞ/AcûssP”missiÚ.hh
"

47 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùCÚŒŞËr.hh
"

48 
	~"mem/ruby/sy¡em/RubyPÜt.hh
"

49 
	~"sim/sy¡em.hh
"

51 
	gRubyPÜt
::
	$RubyPÜt
(cÚ¡ 
P¬ams
 *
p
)

52 : 
	`MemObjeù
(
p
), 
	`m_v”siÚ
Õ->
v”siÚ
), 
	`m_cÚŒŞËr
(
NULL
),

53 
	`m_mªd©Üy_q_±r
(
NULL
),

54 
	`pio_pÜt
(
	`c¥rštf
("%s-pio-pÜt", 
	`Çme
()), 
this
),

55 
	`m_usšgRubyTe¡”
(
p
->
usšg_ruby_‹¡”
), 
	`m_»que¡_út
(0),

56 
	`d¿šMªag”
(
NULL
), 
	`ruby_sy¡em
(
p
->
ruby_sy¡em
), 
	`sy¡em
Õ->
sy¡em
),

57 
	`wa™šgOnSequ’ûr
(
çl£
), 
	`acûss_phys_mem
(
p
->
acûss_phys_mem
)

59 
	`as£¹
(
m_v”siÚ
 != -1);

62 
size_t
 
i
 = 0; i < 
p
->
pÜt_¦ave_cÚÃùiÚ_couÁ
; ++i) {

63 
¦ave_pÜts
.
	`push_back
(
Ãw
 
	`M5PÜt
(
	`c¥rštf
("%s-¦ave%d", 
	`Çme
(), 
i
),

64 
this
, 
ruby_sy¡em
, 
acûss_phys_mem
));

68 
size_t
 
i
 = 0; i < 
p
->
pÜt_ma¡”_cÚÃùiÚ_couÁ
; ++i) {

69 
ma¡”_pÜts
.
	`push_back
(
Ãw
 
	`PioPÜt
(
	`c¥rštf
("%s-ma¡”%d", 
	`Çme
(), 
i
),

70 
this
));

72 
	}
}

75 
	gRubyPÜt
::
	$š™
()

77 
	`as£¹
(
m_cÚŒŞËr
 !ğ
NULL
);

78 
m_mªd©Üy_q_±r
 = 
m_cÚŒŞËr
->
	`g‘Mªd©ÜyQueue
();

79 
m_mªd©Üy_q_±r
->
	`£tS’d”
(
this
);

80 
	}
}

82 
	gBa£Ma¡”PÜt
 &

83 
	gRubyPÜt
::
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

85 ià(
	gif_Çme
 == "pio_port") {

86  
pio_pÜt
;

91 ià(
	gif_Çme
 != "master") {

93  
MemObjeù
::
g‘Ma¡”PÜt
(
if_Çme
, 
idx
);

95 ià(
	gidx
 >ğ
¡©ic_ÿ¡
<
PÜtID
>(
ma¡”_pÜts
.
size
())) {

96 
·nic
("RubyPÜt::g‘Ma¡”PÜt: unknowÀšdex %d\n", 
idx
);

99  *
	gma¡”_pÜts
[
idx
];

103 
	gBa£SÏvePÜt
 &

104 
	gRubyPÜt
::
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

108 ià(
	gif_Çme
 != "slave") {

110  
MemObjeù
::
g‘SÏvePÜt
(
if_Çme
, 
idx
);

112 ià(
	gidx
 >ğ
¡©ic_ÿ¡
<
PÜtID
>(
¦ave_pÜts
.
size
())) {

113 
·nic
("RubyPÜt::g‘SÏvePÜt: unknowÀšdex %d\n", 
idx
);

116  *
	g¦ave_pÜts
[
idx
];

120 
	gRubyPÜt
::
PioPÜt
::PioPÜt(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
,

121 
RubyPÜt
 *
_pÜt
)

122 : 
QueuedMa¡”PÜt
(
_Çme
, 
_pÜt
, 
queue
), 
	$queue
(*
_pÜt
, *
this
)

124 
	`DPRINTF
(
RubyPÜt
, "ü—tšg ma¡”…ÜˆÚ„uby sequ’û¸%s\n", 
_Çme
);

125 
	}
}

127 
	gRubyPÜt
::
M5PÜt
::M5PÜt(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
RubyPÜt
 *
_pÜt
,

128 
RubySy¡em
 *
_sy¡em
, 
boŞ
 
_acûss_phys_mem
)

129 : 
QueuedSÏvePÜt
(
_Çme
, 
_pÜt
, 
queue
), queue(*_pÜt, *
this
),

130 
ruby_pÜt
(
_pÜt
), 
ruby_sy¡em
(
_sy¡em
),

131 
_ÚR‘ryLi¡
(
çl£
), 
	$acûss_phys_mem
(
_acûss_phys_mem
)

133 
	`DPRINTF
(
RubyPÜt
, "ü—tšg sÏvpÜˆÚ„uby sequ’û¸%s\n", 
_Çme
);

134 
	}
}

136 
Tick


137 
	gRubyPÜt
::
M5PÜt
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

139 
	`·nic
("RubyPort::M5Port::recvAtomic()‚ot implemented!\n");

141 
	}
}

144 
boŞ


145 
	gRubyPÜt
::
PioPÜt
::
	$»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
)

149 
	`DPRINTF
(
RubyPÜt
, "PiØ»¥Ú£ fÜ‡dd»s %#x\n", 
pkt
->
	`g‘Addr
());

152 
RubyPÜt
::
S’d”S‹
 *
£nd”S‹
 =

153 
§ã_ÿ¡
<
RubyPÜt
::
S’d”S‹
 *>(
pkt
->
	`pİS’d”S‹
());

154 
M5PÜt
 *
pÜt
 = 
£nd”S‹
->port;

155 
	`as£¹
(
pÜt
 !ğ
NULL
);

156 
d–‘e
 
£nd”S‹
;

158 
pÜt
->
	`£ndTimšgRe¥
(
pkt
);

160  
Œue
;

161 
	}
}

163 
boŞ


164 
	gRubyPÜt
::
M5PÜt
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

166 
	`DPRINTF
(
RubyPÜt
,

167 "Timšg‡cûs ÿughˆfÜ‡dd»s %#x\n", 
pkt
->
	`g‘Addr
());

171 ià(
pkt
->
	`memInhib™As£¹ed
())

172 
	`·nic
("RubyPort should‚ever see‡n inhibited„equest\n");

176 
pkt
->
	`pushS’d”S‹
(
Ãw
 
	`S’d”S‹
(
this
));

180 ià(!
	`isPhysMemAdd»ss
(
pkt
->
	`g‘Addr
())) {

181 
	`as£¹
(
ruby_pÜt
->
pio_pÜt
.
	`isCÚÃùed
());

182 
	`DPRINTF
(
RubyPÜt
,

184 
pkt
->
	`g‘Addr
());

187 
ruby_pÜt
->
pio_pÜt
.
	`schedTimšgReq
(
pkt
,

188 
	`curTick
(è+ 
g_sy¡em_±r
->
	`şockP”iod
());

189  
Œue
;

192 
	`as£¹
(
	`Add»ss
(
pkt
->
	`g‘Addr
()).
	`g‘Off£t
(è+…kt->
	`g‘Size
() <=

193 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

196 
Reque¡Stus
 
»que¡Stus
 = 
ruby_pÜt
->
	`makeReque¡
(
pkt
);

201 ià(
»que¡Stus
 =ğ
Reque¡Stus_Issued
) {

202 
	`DPRINTF
(
RubyPÜt
, "Reque¡ %#x issued\n", 
pkt
->
	`g‘Addr
());

203  
Œue
;

210 ià(!
ruby_pÜt
->
m_usšgRubyTe¡”
) {

211 
ruby_pÜt
->
	`addToR‘ryLi¡
(
this
);

214 
	`DPRINTF
(
RubyPÜt
,

216 
pkt
->
	`g‘Addr
(), 
	`Reque¡Stus_to_¡ršg
(
»que¡Stus
));

218 
S’d”S‹
* 
£nd”S‹
 = 
§ã_ÿ¡
<S’d”S‹*>(
pkt
->senderState);

219 
pkt
->
£nd”S‹
 = s’d”S‹->
´edeûssÜ
;

220 
d–‘e
 
£nd”S‹
;

221  
çl£
;

222 
	}
}

225 
	gRubyPÜt
::
M5PÜt
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

227 
	`DPRINTF
(
RubyPÜt
, "Functional‡ccess caught for‡ddress %#x\n",

228 
pkt
->
	`g‘Addr
());

232 ià(!
	`isPhysMemAdd»ss
(
pkt
->
	`g‘Addr
())) {

233 
	`as£¹
(
ruby_pÜt
->
pio_pÜt
.
	`isCÚÃùed
());

234 
	`DPRINTF
(
RubyPÜt
, "Request for‡ddress 0x%#x is‡…io„equest\n",

235 
pkt
->
	`g‘Addr
());

236 
	`·nic
("RubyPort::PioPort::recvFunctional()‚ot implemented!\n");

239 
	`as£¹
(
pkt
->
	`g‘Addr
(è+…kt->
	`g‘Size
() <=

240 
	`lše_add»ss
(
	`Add»ss
(
pkt
->
	`g‘Addr
())).
	`g‘Add»ss
() +

241 
RubySy¡em
::
	`g‘BlockSizeBy‹s
());

243 
boŞ
 
acûssSucûeded
 = 
çl£
;

244 
boŞ
 
ÃedsRe¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
();

247 ià(
pkt
->
	`isR—d
()) {

248 
acûssSucûeded
 = 
ruby_sy¡em
->
	`funùiÚ®R—d
(
pkt
);

249 } ià(
pkt
->
	`isWr™e
()) {

250 
acûssSucûeded
 = 
ruby_sy¡em
->
	`funùiÚ®Wr™e
(
pkt
);

252 
	`·nic
("RubyPort: unsupported functional command %s\n",

253 
pkt
->
	`cmdSŒšg
());

258 ià(!
acûssSucûeded
 && !
pkt
->
	`suµ»ssFuncE¼Ü
()) {

259 
	`çl
("Ruby functional %s failed for‡ddress %#x\n",

260 
pkt
->
	`isWr™e
(è? "wr™e" : "»ad",…kt->
	`g‘Addr
());

263 ià(
acûss_phys_mem
) {

268 
ruby_pÜt
->
sy¡em
->
	`g‘PhysMem
().
	`funùiÚ®Acûss
(
pkt
);

272 ià(
ÃedsRe¥Ú£
) {

273 
pkt
->
	`£tFunùiÚ®Re¥Ú£Stus
(
acûssSucûeded
);

280 
	`DPRINTF
(
RubyPÜt
, "Functional‡ccess %s!\n",

281 
acûssSucûeded
 ? "successful":"failed");

282 
	}
}

285 
	gRubyPÜt
::
	$ruby_h™_ÿÎback
(
Pack‘PŒ
 
pkt
)

288 
RubyPÜt
::
S’d”S‹
 *
£nd”S‹
 =

289 
§ã_ÿ¡
<
RubyPÜt
::
S’d”S‹
 *>(
pkt
->
£nd”S‹
);

290 
M5PÜt
 *
pÜt
 = 
£nd”S‹
->port;

291 
	`as£¹
(
pÜt
 !ğ
NULL
);

294 
pkt
->
£nd”S‹
 = s’d”S‹->
´edeûssÜ
;

295 
d–‘e
 
£nd”S‹
;

297 
pÜt
->
	`h™C®lback
(
pkt
);

303 ià(
wa™šgOnSequ’ûr
) {

311 
¡d
::
li¡
<
M5PÜt
*> 
	`curR‘ryLi¡
(
»ŒyLi¡
);

313 
»ŒyLi¡
.
	`ş—r
();

314 
wa™šgOnSequ’ûr
 = 
çl£
;

316 
¡d
::
li¡
<
M5PÜt
*>::
™”©Ü
 
i
 = 
curR‘ryLi¡
.
	`begš
();

317 
i
 !ğ
curR‘ryLi¡
.
	`’d
(); ++i) {

318 
	`DPRINTF
(
RubyPÜt
,

320 (*
i
)->
	`Çme
());

321 (*
i
)->
	`ÚR‘ryLi¡
(
çl£
);

322 (*
i
)->
	`£ndR‘ry
();

326 
	`‹¡D¿šCom¶‘e
();

327 
	}
}

330 
	gRubyPÜt
::
	$‹¡D¿šCom¶‘e
()

333 ià(
d¿šMªag”
 !ğ
NULL
) {

334 
d¿šCouÁ
 = 
	`out¡ªdšgCouÁ
();

335 
	`DPRINTF
(
D¿š
, "D¿š couÁ: %u\n", 
d¿šCouÁ
);

336 ià(
d¿šCouÁ
 == 0) {

337 
	`DPRINTF
(
D¿š
, "RubyPort done draining, signaling drain done\n");

338 
d¿šMªag”
->
	`sigÇlD¿šDÚe
();

340 
d¿šMªag”
 = 
NULL
;

343 
	}
}

346 
	gRubyPÜt
::
	$g‘ChdD¿šCouÁ
(
D¿šMªag”
 *
dm
)

348 
couÁ
 = 0;

350 ià(
pio_pÜt
.
	`isCÚÃùed
()) {

351 
couÁ
 +ğ
pio_pÜt
.
	`d¿š
(
dm
);

352 
	`DPRINTF
(
CÚfig
, "couÁ‡á”…iØcheck %d\n", 
couÁ
);

355 
CpuPÜtI‹r
 
p
 = 
¦ave_pÜts
.
	`begš
();… !ğ¦ave_pÜts.
	`’d
(); ++p) {

356 
couÁ
 +ğ(*
p
)->
	`d¿š
(
dm
);

357 
	`DPRINTF
(
CÚfig
, "couÁ‡á” sÏvpÜˆcheck %d\n", 
couÁ
);

360 
¡d
::
veùÜ
<
PioPÜt
*>::
™”©Ü
 
p
 = 
ma¡”_pÜts
.
	`begš
();

361 
p
 !ğ
ma¡”_pÜts
.
	`’d
(); ++p) {

362 
couÁ
 +ğ(*
p
)->
	`d¿š
(
dm
);

363 
	`DPRINTF
(
CÚfig
, "couÁ‡á” ma¡”…Üˆcheck %d\n", 
couÁ
);

366 
	`DPRINTF
(
CÚfig
, "fš® couÁ %d\n", 
couÁ
);

368  
couÁ
;

369 
	}
}

372 
	gRubyPÜt
::
	$d¿š
(
D¿šMªag”
 *
dm
)

374 ià(
	`isD—dlockEv’tScheduËd
()) {

375 
	`descheduËD—dlockEv’t
();

382 
	`DPRINTF
(
CÚfig
, "out¡ªdšg couÁ %d\n", 
	`out¡ªdšgCouÁ
());

383 
boŞ
 
Ãed_d¿š
 = 
	`out¡ªdšgCouÁ
() > 0;

389 
chd_d¿š_couÁ
 = 
	`g‘ChdD¿šCouÁ
(
dm
);

392 ià(
Ãed_d¿š
) {

393 
d¿šMªag”
 = 
dm
;

395 
	`DPRINTF
(
D¿š
, "RubyPort‚ot drained\n");

396 
	`£tD¿šS‹
(
D¿šabË
::
D¿ššg
);

397  
chd_d¿š_couÁ
 + 1;

400 
d¿šMªag”
 = 
NULL
;

401 
	`£tD¿šS‹
(
D¿šabË
::
D¿šed
);

402  
chd_d¿š_couÁ
;

403 
	}
}

406 
	gRubyPÜt
::
M5PÜt
::
	$h™C®lback
(
Pack‘PŒ
 
pkt
)

408 
boŞ
 
ÃedsRe¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
();

414 
boŞ
 
acûssPhysMem
 = 
acûss_phys_mem
;

416 ià(
pkt
->
	`isLLSC
()) {

417 ià(
pkt
->
	`isWr™e
()) {

418 ià(
pkt
->
»q
->
	`g‘ExŒaD©a
() != 0) {

422 
pkt
->
	`cÚv”tScToWr™e
();

428 
acûssPhysMem
 = 
çl£
;

435 
pkt
->
	`cÚv”tLlToR—d
();

442 ià(
pkt
->
	`isFlush
()) {

443 
acûssPhysMem
 = 
çl£
;

446 
	`DPRINTF
(
RubyPÜt
, "H™ c®lback‚“d »¥Ú£ %d\n", 
ÃedsRe¥Ú£
);

448 ià(
acûssPhysMem
) {

449 
ruby_pÜt
->
sy¡em
->
	`g‘PhysMem
().
	`acûss
(
pkt
);

450 } ià(
ÃedsRe¥Ú£
) {

451 
pkt
->
	`makeRe¥Ú£
();

455 ià(
ÃedsRe¥Ú£
) {

456 
	`DPRINTF
(
RubyPÜt
, "Sending…acket back over…ort\n");

458 
	`schedTimšgRe¥
(
pkt
, 
	`curTick
(è+ 
g_sy¡em_±r
->
	`şockP”iod
());

460 
d–‘e
 
pkt
;

462 
	`DPRINTF
(
RubyPÜt
, "Hit callback done!\n");

463 
	}
}

465 
AddrRªgeLi¡


466 
	gRubyPÜt
::
M5PÜt
::
	$g‘AddrRªges
() const

469 
AddrRªgeLi¡
 
¿nges
;

470  
¿nges
;

471 
	}
}

473 
boŞ


474 
	gRubyPÜt
::
M5PÜt
::
	$isPhysMemAdd»ss
(
Addr
 
addr
)

476  
ruby_pÜt
->
sy¡em
->
	`isMemAddr
(
addr
);

477 
	}
}

480 
	gRubyPÜt
::
	$ruby_eviùiÚ_ÿÎback
(cÚ¡ 
Add»ss
& 
add»ss
)

482 
	`DPRINTF
(
RubyPÜt
, "Sending invalidations.\n");

486 
Reque¡PŒ
 
»q
 =

487 
Ãw
 
	`Reque¡
(
add»ss
.
	`g‘Add»ss
(), 0, 0, 
Reque¡
::
funcMa¡”Id
);

490 
Pack‘
 
	`pkt
(
»q
, 
MemCmd
::
Inv®id©iÚReq
);

491 
CpuPÜtI‹r
 
p
 = 
¦ave_pÜts
.
	`begš
();… !ğ¦ave_pÜts.
	`’d
(); ++p) {

493 ià((*
p
)->
	`isSnoİšg
()) {

495 (*
p
)->
	`£ndTimšgSnoİReq
(&
pkt
);

498 
	}
}

	@ruby/system/RubyPort.hh

42 #iâdeà
__MEM_RUBY_SYSTEM_RUBYPORT_HH__


43 
	#__MEM_RUBY_SYSTEM_RUBYPORT_HH__


	)

45 
	~<ÿs£¹
>

46 
	~<¡ršg
>

48 
	~"mem/´ÙocŞ/Reque¡Stus.hh
"

49 
	~"mem/ruby/bufãrs/Mes§geBufãr.hh
"

50 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

51 
	~"mem/mem_objeù.hh
"

52 
	~"mem/physiÿl.hh
"

53 
	~"mem/Üt.hh
"

54 
	~"·¿ms/RubyPÜt.hh
"

56 
şass
 
	gAb¡¿ùCÚŒŞËr
;

58 şas 
	cRubyPÜt
 : 
public
 
MemObjeù


60 
public
:

61 şas 
	cM5PÜt
 : 
public
 
QueuedSÏvePÜt


63 
´iv©e
:

65 
SÏvePack‘Queue
 
queue
;

66 
RubyPÜt
 *
	mruby_pÜt
;

67 
RubySy¡em
* 
	mruby_sy¡em
;

68 
boŞ
 
	m_ÚR‘ryLi¡
;

69 
boŞ
 
	macûss_phys_mem
;

71 
	mpublic
:

72 
M5PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
RubyPÜt
 *
_pÜt
,

73 
RubySy¡em
*
_sy¡em
, 
boŞ
 
_acûss_phys_mem
);

74 
h™C®lback
(
Pack‘PŒ
 
pkt
);

75 
eviùiÚC®lback
(cÚ¡ 
Add»ss
& 
add»ss
);

77 
boŞ
 
ÚR‘ryLi¡
()

78 {  
	m_ÚR‘ryLi¡
; }

80 
ÚR‘ryLi¡
(
boŞ
 
ÃwV®
)

81 { 
	m_ÚR‘ryLi¡
 = 
ÃwV®
; }

83 
	m´Ùeùed
:

84 
vœtu®
 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

85 
vœtu®
 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

86 
vœtu®
 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

87 
vœtu®
 
AddrRªgeLi¡
 
g‘AddrRªges
() const;

89 
	m´iv©e
:

90 
boŞ
 
isPhysMemAdd»ss
(
Addr
 
addr
);

93 
ä›nd
 
şass
 
	gM5PÜt
;

95 şas 
	cPioPÜt
 : 
public
 
QueuedMa¡”PÜt


97 
´iv©e
:

99 
Ma¡”Pack‘Queue
 
queue
;

101 
	gpublic
:

102 
PioPÜt
(cÚ¡ 
¡d
::
¡ršg
 &
_Çme
, 
RubyPÜt
 *
_pÜt
);

104 
	g´Ùeùed
:

105 
vœtu®
 
boŞ
 
»cvTimšgRe¥
(
Pack‘PŒ
 
pkt
);

108 
ä›nd
 
şass
 
	gPioPÜt
;

110 
	gS’d”S‹
 : 
public
 
Pack‘
::
S’d”S‹


112 
M5PÜt
* 
pÜt
;

114 
S’d”S‹
(
M5PÜt
* 
_pÜt
è: 
pÜt
(_port)

118 
RubyPÜtP¬ams
 
	tP¬ams
;

119 
RubyPÜt
(cÚ¡ 
P¬ams
 *
p
);

120 
	gvœtu®
 ~
	$RubyPÜt
(è{
	}
}

122 
š™
();

124 
	gBa£Ma¡”PÜt
 &
g‘Ma¡”PÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
,

125 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

126 
	gBa£SÏvePÜt
 &
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
,

127 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

129 
vœtu®
 
Reque¡Stus
 
makeReque¡
(
Pack‘PŒ
 
pkt
) = 0;

130 
vœtu®
 
	$out¡ªdšgCouÁ
() const = 0;

131 
vœtu®
 
boŞ
 
	$isD—dlockEv’tScheduËd
() const = 0;

132 
vœtu®
 
	`descheduËD—dlockEv’t
() = 0;

138 
	$£tCÚŒŞËr
(
Ab¡¿ùCÚŒŞËr
* 
_úŒl
è{ 
m_cÚŒŞËr
 = _úŒl; 
	}
}

139 
	$g‘Id
(è{  
m_v”siÚ
; 
	}
}

140 
d¿š
(
D¿šMªag”
 *
dm
);

142 
	g´Ùeùed
:

143 cÚ¡ 
¡d
::
¡ršg
 
m_Çme
;

144 
ruby_h™_ÿÎback
(
Pack‘PŒ
 
pkt
);

145 
‹¡D¿šCom¶‘e
();

146 
ruby_eviùiÚ_ÿÎback
(cÚ¡ 
Add»ss
& 
add»ss
);

148 
	gm_v”siÚ
;

149 
Ab¡¿ùCÚŒŞËr
* 
	gm_cÚŒŞËr
;

150 
Mes§geBufãr
* 
	gm_mªd©Üy_q_±r
;

151 
PioPÜt
 
	gpio_pÜt
;

152 
boŞ
 
	gm_usšgRubyTe¡”
;

154 
	g´iv©e
:

155 
	$addToR‘ryLi¡
(
M5PÜt
 * 
pÜt
)

157 ià(!
pÜt
->
	`ÚR‘ryLi¡
()) {

158 
pÜt
->
	`ÚR‘ryLi¡
(
Œue
);

159 
»ŒyLi¡
.
	`push_back
(
pÜt
);

160 
wa™šgOnSequ’ûr
 = 
Œue
;

162 
	}
}

164 
g‘ChdD¿šCouÁ
(
D¿šMªag”
 *
dm
);

166 
ušt16_t
 
	gm_pÜt_id
;

167 
ušt64_t
 
	gm_»que¡_út
;

170 
	g¡d
::
	tveùÜ
<
	tM5PÜt
*>::
	t™”©Ü
 
	tCpuPÜtI‹r
;

171 
	g¡d
::
veùÜ
<
M5PÜt
*> 
¦ave_pÜts
;

172 
	g¡d
::
veùÜ
<
PioPÜt
*> 
ma¡”_pÜts
;

174 
D¿šMªag”
 *
	gd¿šMªag”
;

176 
RubySy¡em
* 
	gruby_sy¡em
;

177 
Sy¡em
* 
	gsy¡em
;

183 
	g¡d
::
li¡
<
M5PÜt
*> 
»ŒyLi¡
;

185 
boŞ
 
	gwa™šgOnSequ’ûr
;

186 
boŞ
 
	gacûss_phys_mem
;

	@ruby/system/RubyPortProxy.cc

40 
	~"mem/ruby/sy¡em/RubyPÜtProxy.hh
"

42 
	gRubyPÜtProxy
::
	$RubyPÜtProxy
(cÚ¡ 
RubyPÜtProxyP¬ams
* 
p
) :

43 
	$RubyPÜt
(
p
) {

44 
	}
}

46 
RubyPÜtProxy
::~
	$RubyPÜtProxy
()

48 
	}
}

51 
RubyPÜtProxy
::
	$š™
()

54 
	}
}

56 
Reque¡Stus


57 
RubyPÜtProxy
::
	$makeReque¡
(
Pack‘PŒ
 
pkt
)

62 
	`·nic
("RubyPortProxy::makeRequest should‚ot be called");

63  
Reque¡Stus_NULL
;

64 
	}
}

66 
RubyPÜtProxy
*

67 
	gRubyPÜtProxyP¬ams
::
	$ü—‹
()

69  
Ãw
 
	`RubyPÜtProxy
(
this
);

70 
	}
}

	@ruby/system/RubyPortProxy.hh

48 #iâdeà
__MEM_RUBY_SYSTEM_RUBYPORTPROXY_HH__


49 
	#__MEM_RUBY_SYSTEM_RUBYPORTPROXY_HH__


	)

51 
	~"mem/ruby/sy¡em/RubyPÜt.hh
"

52 
	~"·¿ms/RubyPÜtProxy.hh
"

54 şas 
	cRubyPÜtProxy
 : 
public
 
RubyPÜt


57 
public
:

64 
RubyPÜtProxy
(cÚ¡ 
RubyPÜtProxyP¬ams
* 
p
);

69 
	mvœtu®
 ~
RubyPÜtProxy
();

75 
š™
();

85 
Reque¡Stus
 
makeReque¡
(
Pack‘PŒ
 
pkt
);

94 
	$out¡ªdšgCouÁ
() const {  0; }

103 
boŞ
 
	$isD—dlockEv’tScheduËd
(ècÚ¡ {  
çl£
; 
	}
}

110 
	$descheduËD—dlockEv’t
(è{ 
	}
}

	@ruby/system/Sequencer.cc

29 
	~"ba£/misc.hh
"

30 
	~"ba£/¡r.hh
"

31 
	~"cÚfig/the_i§.hh
"

32 #ià
THE_ISA
 =ğ
X86_ISA


33 
	~"¬ch/x86/š¡s/miüŞd¡İ.hh
"

35 
	~"ıu/‹¡”s/ruby‹¡/RubyTe¡”.hh
"

36 
	~"debug/MemÜyAcûss.hh
"

37 
	~"debug/PrÙocŞT¿û.hh
"

38 
	~"debug/RubySequ’ûr.hh
"

39 
	~"debug/RubySts.hh
"

40 
	~"mem/´ÙocŞ/P»ãtchB™.hh
"

41 
	~"mem/´ÙocŞ/RubyAcûssMode.hh
"

42 
	~"mem/ruby/commÚ/Glob®.hh
"

43 
	~"mem/ruby/´of”/Prof”.hh
"

44 
	~"mem/ruby/¦icc_š‹rçû/RubyReque¡.hh
"

45 
	~"mem/ruby/sy¡em/Sequ’ûr.hh
"

46 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

47 
	~"mem/·ck‘.hh
"

49 
usšg
 
Çme¥aû
 
	g¡d
;

51 
Sequ’ûr
 *

52 
	gRubySequ’ûrP¬ams
::
	$ü—‹
()

54  
Ãw
 
	`Sequ’ûr
(
this
);

55 
	}
}

57 
	gSequ’ûr
::
	$Sequ’ûr
(cÚ¡ 
P¬ams
 *
p
)

58 : 
	`RubyPÜt
(
p
), 
	$d—dlockCheckEv’t
(
this
)

60 
m_¡Üe_wa™šg_Ú_lßd_cyşes
 = 0;

61 
m_¡Üe_wa™šg_Ú_¡Üe_cyşes
 = 0;

62 
m_lßd_wa™šg_Ú_¡Üe_cyşes
 = 0;

63 
m_lßd_wa™šg_Ú_lßd_cyşes
 = 0;

65 
m_out¡ªdšg_couÁ
 = 0;

67 
m_š¡Cache_±r
 = 
p
->
iÿche
;

68 
m_d©aCache_±r
 = 
p
->
dÿche
;

69 
m_max_out¡ªdšg_»que¡s
 = 
p
->
max_out¡ªdšg_»que¡s
;

70 
m_d—dlock_th»shŞd
 = 
p
->
d—dlock_th»shŞd
;

72 
	`as£¹
(
m_max_out¡ªdšg_»que¡s
 > 0);

73 
	`as£¹
(
m_d—dlock_th»shŞd
 > 0);

74 
	`as£¹
(
m_š¡Cache_±r
 !ğ
NULL
);

75 
	`as£¹
(
m_d©aCache_±r
 !ğ
NULL
);

77 
m_usšgN‘wÜkTe¡”
 = 
p
->
usšg_ÃtwÜk_‹¡”
;

78 
	}
}

80 
	gSequ’ûr
::~
	$Sequ’ûr
()

82 
	}
}

85 
Sequ’ûr
::
	$wakeup
()

87 
	`as£¹
(
	`g‘D¿šS‹
(è!ğ
D¿šabË
::
D¿ššg
);

90 
Cyşes
 
cu¼’t_time
 = 
	`curCyşe
();

93 
tÙ®_out¡ªdšg
 = 0;

95 
Reque¡TabË
::
™”©Ü
 
»ad
 = 
m_»adReque¡TabË
.
	`begš
();

96 
Reque¡TabË
::
™”©Ü
 
»ad_’d
 = 
m_»adReque¡TabË
.
	`’d
();

97 ; 
»ad
 !ğ
»ad_’d
; ++read) {

98 
Sequ’ûrReque¡
* 
»que¡
 = 
»ad
->
£cÚd
;

99 ià(
cu¼’t_time
 - 
»que¡
->
issue_time
 < 
m_d—dlock_th»shŞd
)

102 
	`·nic
("Possible Deadlock detected. Aborting!\n"

104 "cu¼’ˆtime: %u issue_time: %d difã»nû: %d\n", 
m_v”siÚ
,

105 
	`Add»ss
(
»que¡
->
pkt
->
	`g‘Addr
()), 
m_»adReque¡TabË
.
	`size
(),

106 
cu¼’t_time
 * 
	`şockP”iod
(), 
»que¡
->
issue_time
 * clockPeriod(),

107 (
cu¼’t_time
 * 
	`şockP”iod
()è- (
»que¡
->
issue_time
 * clockPeriod()));

110 
Reque¡TabË
::
™”©Ü
 
wr™e
 = 
m_wr™eReque¡TabË
.
	`begš
();

111 
Reque¡TabË
::
™”©Ü
 
wr™e_’d
 = 
m_wr™eReque¡TabË
.
	`’d
();

112 ; 
wr™e
 !ğ
wr™e_’d
; ++write) {

113 
Sequ’ûrReque¡
* 
»que¡
 = 
wr™e
->
£cÚd
;

114 ià(
cu¼’t_time
 - 
»que¡
->
issue_time
 < 
m_d—dlock_th»shŞd
)

117 
	`·nic
("Possible Deadlock detected. Aborting!\n"

119 "cu¼’ˆtime: %u issue_time: %d difã»nû: %d\n", 
m_v”siÚ
,

120 
	`Add»ss
(
»que¡
->
pkt
->
	`g‘Addr
()), 
m_wr™eReque¡TabË
.
	`size
(),

121 
cu¼’t_time
 * 
	`şockP”iod
(), 
»que¡
->
issue_time
 * clockPeriod(),

122 (
cu¼’t_time
 * 
	`şockP”iod
()è- (
»que¡
->
issue_time
 * clockPeriod()));

125 
tÙ®_out¡ªdšg
 +ğ
m_wr™eReque¡TabË
.
	`size
();

126 
tÙ®_out¡ªdšg
 +ğ
m_»adReque¡TabË
.
	`size
();

128 
	`as£¹
(
m_out¡ªdšg_couÁ
 =ğ
tÙ®_out¡ªdšg
);

130 ià(
m_out¡ªdšg_couÁ
 > 0) {

132 
	`scheduË
(
d—dlockCheckEv’t
, 
	`şockEdge
(
m_d—dlock_th»shŞd
));

134 
	}
}

136 
	gSequ’ûr
::
	$ş—rSts
()

138 
m_out¡ªdReqHi¡
.
	`ş—r
();

141 
m_Ï‹ncyHi¡
.
	`ş—r
(20);

142 
m_ty³L©’cyHi¡
.
	`»size
(
RubyReque¡Ty³_NUM
);

143 
i
 = 0; i < 
RubyReque¡Ty³_NUM
; i++) {

144 
m_ty³L©’cyHi¡
[
i
].
	`ş—r
(20);

149 
m_h™L©’cyHi¡
.
	`ş—r
(20);

150 
m_h™Ty³L©’cyHi¡
.
	`»size
(
RubyReque¡Ty³_NUM
);

151 
m_h™Ty³MachL©’cyHi¡
.
	`»size
(
RubyReque¡Ty³_NUM
);

153 
i
 = 0; i < 
RubyReque¡Ty³_NUM
; i++) {

154 
m_h™Ty³L©’cyHi¡
[
i
].
	`ş—r
(20);

155 
m_h™Ty³MachL©’cyHi¡
[
i
].
	`»size
(
MachšeTy³_NUM
);

156 
j
 = 0; j < 
MachšeTy³_NUM
; j++) {

157 
m_h™Ty³MachL©’cyHi¡
[
i
][
j
].
	`ş—r
(20);

163 
m_missL©’cyHi¡
.
	`ş—r
(20);

164 
m_missTy³L©’cyHi¡
.
	`»size
(
RubyReque¡Ty³_NUM
);

165 
m_missTy³MachL©’cyHi¡
.
	`»size
(
RubyReque¡Ty³_NUM
);

167 
i
 = 0; i < 
RubyReque¡Ty³_NUM
; i++) {

168 
m_missTy³L©’cyHi¡
[
i
].
	`ş—r
(20);

169 
m_missTy³MachL©’cyHi¡
[
i
].
	`»size
(
MachšeTy³_NUM
);

170 
j
 = 0; j < 
MachšeTy³_NUM
; j++) {

171 
m_missTy³MachL©’cyHi¡
[
i
][
j
].
	`ş—r
(20);

175 
m_h™MachL©’cyHi¡
.
	`»size
(
MachšeTy³_NUM
);

176 
m_missMachL©’cyHi¡
.
	`»size
(
MachšeTy³_NUM
);

177 
m_IssueToIn™ŸlD–ayHi¡
.
	`»size
(
MachšeTy³_NUM
);

178 
m_In™ŸlToFÜw¬dD–ayHi¡
.
	`»size
(
MachšeTy³_NUM
);

179 
m_FÜw¬dToFœ¡Re¥Ú£D–ayHi¡
.
	`»size
(
MachšeTy³_NUM
);

180 
m_Fœ¡Re¥Ú£ToCom¶‘iÚD–ayHi¡
.
	`»size
(
MachšeTy³_NUM
);

181 
m_Incom¶‘eTimes
.
	`»size
(
MachšeTy³_NUM
);

183 
i
 = 0; i < 
MachšeTy³_NUM
; i++) {

184 
m_missMachL©’cyHi¡
[
i
].
	`ş—r
(20);

185 
m_h™MachL©’cyHi¡
[
i
].
	`ş—r
(20);

187 
m_IssueToIn™ŸlD–ayHi¡
[
i
].
	`ş—r
(20);

188 
m_In™ŸlToFÜw¬dD–ayHi¡
[
i
].
	`ş—r
(20);

189 
m_FÜw¬dToFœ¡Re¥Ú£D–ayHi¡
[
i
].
	`ş—r
(20);

190 
m_Fœ¡Re¥Ú£ToCom¶‘iÚD–ayHi¡
[
i
].
	`ş—r
(20);

192 
m_Incom¶‘eTimes
[
i
] = 0;

194 
	}
}

197 
	gSequ’ûr
::
	$´štSts
(
o¡»am
 & 
out
) const

199 
out
 << "Sequ’ûr: " << 
m_Çme
 << 
’dl


201 << 
m_¡Üe_wa™šg_Ú_lßd_cyşes
 << 
’dl


203 << 
m_¡Üe_wa™šg_Ú_¡Üe_cyşes
 << 
’dl


205 << 
m_lßd_wa™šg_Ú_lßd_cyşes
 << 
’dl


207 << 
m_lßd_wa™šg_Ú_¡Üe_cyşes
 << 
’dl
;

208 
	}
}

211 
	gSequ’ûr
::
	$´štProg»ss
(
o¡»am
& 
out
) const

214 
tÙ®_demªd
 = 0;

215 
out
 << "Sequ’û¸St V”siÚ " << 
m_v”siÚ
 << 
’dl
;

216 
out
 << "Cu¼’ˆtimğ" << 
g_sy¡em_±r
->
	`g‘Time
(è<< 
’dl
;

217 
out
 << "---------------" << 
’dl
;

218 
out
 << "out¡ªdšg„eque¡s" << 
’dl
;

220 
out
 << "´oø" << 
m_R—d


221 << " v”siÚ Reque¡ ğ" << 
m_»adReque¡TabË
.
	`size
(è<< 
’dl
;

224 
Reque¡TabË
::
™”©Ü
 
»ad
 = 
m_»adReque¡TabË
.
	`begš
();

225 
Reque¡TabË
::
™”©Ü
 
»ad_’d
 = 
m_»adReque¡TabË
.
	`’d
();

226 ; 
»ad
 !ğ
»ad_’d
; ++read) {

227 
Sequ’ûrReque¡
* 
»que¡
 = 
»ad
->
£cÚd
;

228 
out
 << "\tReque¡[ " << 
i
 << " ] = " << 
»que¡
->
ty³


229 << " Add»s " << 
rkeys
[
i
]

230 << " Po¡ed " << 
»que¡
->
issue_time


231 << " PF " << 
P»ãtchB™_No
 << 
’dl
;

232 
tÙ®_demªd
++;

235 
out
 << "´oø" << 
m_v”siÚ


236 << " Wr™Reque¡ ğ" << 
m_wr™eReque¡TabË
.
size
 << 
’dl
;

239 
Reque¡TabË
::
™”©Ü
 
wr™e
 = 
m_wr™eReque¡TabË
.
	`begš
();

240 
Reque¡TabË
::
™”©Ü
 
wr™e_’d
 = 
m_wr™eReque¡TabË
.
	`’d
();

241 ; 
wr™e
 !ğ
wr™e_’d
; ++write) {

242 
Sequ’ûrReque¡
* 
»que¡
 = 
wr™e
->
£cÚd
;

243 
out
 << "\tReque¡[ " << 
i
 << " ] = " << 
»que¡
.
	`g‘Ty³
()

244 << " Add»s " << 
wkeys
[
i
]

245 << " Po¡ed " << 
»que¡
.
	`g‘Time
()

246 << " PF " << 
»que¡
.
	`g‘P»ãtch
(è<< 
’dl
;

247 ià(
»que¡
.
	`g‘P»ãtch
(è=ğ
P»ãtchB™_No
) {

248 
tÙ®_demªd
++;

252 
out
 << 
’dl
;

254 
out
 << "TÙ® Numb” Out¡ªdšg: " << 
m_out¡ªdšg_couÁ
 << 
’dl


255 << "TÙ® Numb” Demªd : " << 
tÙ®_demªd
 << 
’dl


256 << "TÙ® Numb” P»ãtche : " << 
m_out¡ªdšg_couÁ
 - 
tÙ®_demªd


257 << 
’dl
 <<ƒndl <<ƒndl;

259 
	}
}

263 
Reque¡Stus


264 
	gSequ’ûr
::
	$š£¹Reque¡
(
Pack‘PŒ
 
pkt
, 
RubyReque¡Ty³
 
»que¡_ty³
)

266 
	`as£¹
(
m_out¡ªdšg_couÁ
 ==

267 (
m_wr™eReque¡TabË
.
	`size
(è+ 
m_»adReque¡TabË
.size()));

270 ià(!
d—dlockCheckEv’t
.
	`scheduËd
() &&

271 
	`g‘D¿šS‹
(è!ğ
D¿šabË
::
D¿ššg
) {

272 
	`scheduË
(
d—dlockCheckEv’t
, 
	`şockEdge
(
m_d—dlock_th»shŞd
));

275 
Add»ss
 
	`lše_addr
(
pkt
->
	`g‘Addr
());

276 
lše_addr
.
	`makeLšeAdd»ss
();

279 
Reque¡TabË
::
v®ue_ty³
 
	`deçuÉ_’Œy
(
lše_addr
,

280 (
Sequ’ûrReque¡
*è
NULL
);

282 ià((
»que¡_ty³
 =ğ
RubyReque¡Ty³_ST
) ||

283 (
»que¡_ty³
 =ğ
RubyReque¡Ty³_RMW_R—d
) ||

284 (
»que¡_ty³
 =ğ
RubyReque¡Ty³_RMW_Wr™e
) ||

285 (
»que¡_ty³
 =ğ
RubyReque¡Ty³_Lßd_Lšked
) ||

286 (
»que¡_ty³
 =ğ
RubyReque¡Ty³_StÜe_CÚd™iÚ®
) ||

287 (
»que¡_ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_R—d
) ||

288 (
»que¡_ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_Wr™e
) ||

289 (
»que¡_ty³
 =ğ
RubyReque¡Ty³_FLUSH
)) {

293 ià(
m_»adReque¡TabË
.
	`couÁ
(
lše_addr
) > 0) {

294 
m_¡Üe_wa™šg_Ú_lßd_cyşes
++;

295  
Reque¡Stus_AlŸ£d
;

298 
·œ
<
Reque¡TabË
::
™”©Ü
, 
boŞ
> 
r
 =

299 
m_wr™eReque¡TabË
.
	`š£¹
(
deçuÉ_’Œy
);

300 ià(
r
.
£cÚd
) {

301 
Reque¡TabË
::
™”©Ü
 
i
 = 
r
.
fœ¡
;

302 
i
->
£cÚd
 = 
Ãw
 
	`Sequ’ûrReque¡
(
pkt
, 
»que¡_ty³
, 
	`curCyşe
());

303 
m_out¡ªdšg_couÁ
++;

306 
m_¡Üe_wa™šg_Ú_¡Üe_cyşes
++;

307  
Reque¡Stus_AlŸ£d
;

312 ià(
m_wr™eReque¡TabË
.
	`couÁ
(
lše_addr
) > 0) {

313 
m_lßd_wa™šg_Ú_¡Üe_cyşes
++;

314  
Reque¡Stus_AlŸ£d
;

317 
·œ
<
Reque¡TabË
::
™”©Ü
, 
boŞ
> 
r
 =

318 
m_»adReque¡TabË
.
	`š£¹
(
deçuÉ_’Œy
);

320 ià(
r
.
£cÚd
) {

321 
Reque¡TabË
::
™”©Ü
 
i
 = 
r
.
fœ¡
;

322 
i
->
£cÚd
 = 
Ãw
 
	`Sequ’ûrReque¡
(
pkt
, 
»que¡_ty³
, 
	`curCyşe
());

323 
m_out¡ªdšg_couÁ
++;

326 
m_lßd_wa™šg_Ú_lßd_cyşes
++;

327  
Reque¡Stus_AlŸ£d
;

331 
m_out¡ªdReqHi¡
.
	`add
(
m_out¡ªdšg_couÁ
);

332 
	`as£¹
(
m_out¡ªdšg_couÁ
 ==

333 (
m_wr™eReque¡TabË
.
	`size
(è+ 
m_»adReque¡TabË
.size()));

335  
Reque¡Stus_R—dy
;

336 
	}
}

339 
	gSequ’ûr
::
	$m¬kRemoved
()

341 
m_out¡ªdšg_couÁ
--;

342 
	`as£¹
(
m_out¡ªdšg_couÁ
 ==

343 
m_wr™eReque¡TabË
.
	`size
(è+ 
m_»adReque¡TabË
.size());

344 
	}
}

347 
	gSequ’ûr
::
	$»moveReque¡
(
Sequ’ûrReque¡
* 
¤eque¡
)

349 
	`as£¹
(
m_out¡ªdšg_couÁ
 ==

350 
m_wr™eReque¡TabË
.
	`size
(è+ 
m_»adReque¡TabË
.size());

352 
Add»ss
 
	`lše_addr
(
¤eque¡
->
pkt
->
	`g‘Addr
());

353 
lše_addr
.
	`makeLšeAdd»ss
();

354 ià((
¤eque¡
->
m_ty³
 =ğ
RubyReque¡Ty³_ST
) ||

355 (
¤eque¡
->
m_ty³
 =ğ
RubyReque¡Ty³_RMW_R—d
) ||

356 (
¤eque¡
->
m_ty³
 =ğ
RubyReque¡Ty³_RMW_Wr™e
) ||

357 (
¤eque¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Lßd_Lšked
) ||

358 (
¤eque¡
->
m_ty³
 =ğ
RubyReque¡Ty³_StÜe_CÚd™iÚ®
) ||

359 (
¤eque¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_R—d
) ||

360 (
¤eque¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_Wr™e
)) {

361 
m_wr™eReque¡TabË
.
	`”a£
(
lše_addr
);

363 
m_»adReque¡TabË
.
	`”a£
(
lše_addr
);

366 
	`m¬kRemoved
();

367 
	}
}

370 
	gSequ’ûr
::
	$šv®id©eSC
(cÚ¡ 
Add»ss
& 
add»ss
)

372 
Reque¡TabË
::
™”©Ü
 
i
 = 
m_wr™eReque¡TabË
.
	`fšd
(
add»ss
);

373 ià(
i
 !ğ
m_wr™eReque¡TabË
.
	`’d
()) {

374 
Sequ’ûrReque¡
* 
»que¡
 = 
i
->
£cÚd
;

377 ià(
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_StÜe_CÚd™iÚ®
) {

378 
m_d©aCache_±r
->
	`ş—rLocked
(
add»ss
);

381 
	}
}

383 
boŞ


384 
	gSequ’ûr
::
	$hªdËLlsc
(cÚ¡ 
Add»ss
& 
add»ss
, 
Sequ’ûrReque¡
* 
»que¡
)

391 
boŞ
 
sucûss
 = 
Œue
;

392 ià(
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_StÜe_CÚd™iÚ®
) {

393 ià(!
m_d©aCache_±r
->
	`isLocked
(
add»ss
, 
m_v”siÚ
)) {

398 
»que¡
->
pkt
->
»q
->
	`£tExŒaD©a
(0);

399 
sucûss
 = 
çl£
;

405 
»que¡
->
pkt
->
»q
->
	`£tExŒaD©a
(1);

410 
m_d©aCache_±r
->
	`ş—rLocked
(
add»ss
);

411 } ià(
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Lßd_Lšked
) {

416 
m_d©aCache_±r
->
	`£tLocked
(
add»ss
, 
m_v”siÚ
);

417 } ià((
m_d©aCache_±r
->
	`isTagP»£Á
(
add»ss
)) &&

418 (
m_d©aCache_±r
->
	`isLocked
(
add»ss
, 
m_v”siÚ
))) {

422 
m_d©aCache_±r
->
	`ş—rLocked
(
add»ss
);

424  
sucûss
;

425 
	}
}

428 
	gSequ’ûr
::
	$»cÜdMissL©’cy
(cÚ¡ 
Cyşes
 
cyşes
, cÚ¡ 
RubyReque¡Ty³
 
ty³
,

429 cÚ¡ 
MachšeTy³
 
»¥ÚdšgMach
,

430 
boŞ
 
isEx‹º®H™
, 
Cyşes
 
issuedTime
,

431 
Cyşes
 
š™ŸlReque¡Time
,

432 
Cyşes
 
fÜw¬dReque¡Time
,

433 
Cyşes
 
fœ¡Re¥Ú£Time
, Cyşe 
com¶‘iÚTime
)

435 
m_Ï‹ncyHi¡
.
	`add
(
cyşes
);

436 
m_ty³L©’cyHi¡
[
ty³
].
	`add
(
cyşes
);

438 ià(
isEx‹º®H™
) {

439 
m_missL©’cyHi¡
.
	`add
(
cyşes
);

440 
m_missTy³L©’cyHi¡
[
ty³
].
	`add
(
cyşes
);

442 ià(
»¥ÚdšgMach
 !ğ
MachšeTy³_NUM
) {

443 
m_missMachL©’cyHi¡
[
»¥ÚdšgMach
].
	`add
(
cyşes
);

444 
m_missTy³MachL©’cyHi¡
[
ty³
][
»¥ÚdšgMach
].
	`add
(
cyşes
);

446 ià((
issuedTime
 <ğ
š™ŸlReque¡Time
) &&

447 (
š™ŸlReque¡Time
 <ğ
fÜw¬dReque¡Time
) &&

448 (
fÜw¬dReque¡Time
 <ğ
fœ¡Re¥Ú£Time
) &&

449 (
fœ¡Re¥Ú£Time
 <ğ
com¶‘iÚTime
)) {

451 
m_IssueToIn™ŸlD–ayHi¡
[
»¥ÚdšgMach
].
	`add
(

452 
š™ŸlReque¡Time
 - 
issuedTime
);

453 
m_In™ŸlToFÜw¬dD–ayHi¡
[
»¥ÚdšgMach
].
	`add
(

454 
fÜw¬dReque¡Time
 - 
š™ŸlReque¡Time
);

455 
m_FÜw¬dToFœ¡Re¥Ú£D–ayHi¡
[
»¥ÚdšgMach
].
	`add
(

456 
fœ¡Re¥Ú£Time
 - 
fÜw¬dReque¡Time
);

457 
m_Fœ¡Re¥Ú£ToCom¶‘iÚD–ayHi¡
[
»¥ÚdšgMach
].
	`add
(

458 
com¶‘iÚTime
 - 
fœ¡Re¥Ú£Time
);

460 
m_Incom¶‘eTimes
[
»¥ÚdšgMach
]++;

464 
m_h™L©’cyHi¡
.
	`add
(
cyşes
);

465 
m_h™Ty³L©’cyHi¡
[
ty³
].
	`add
(
cyşes
);

467 ià(
»¥ÚdšgMach
 !ğ
MachšeTy³_NUM
) {

468 
m_h™MachL©’cyHi¡
[
»¥ÚdšgMach
].
	`add
(
cyşes
);

469 
m_h™Ty³MachL©’cyHi¡
[
ty³
][
»¥ÚdšgMach
].
	`add
(
cyşes
);

472 
	}
}

475 
	gSequ’ûr
::
	$wr™eC®lback
(cÚ¡ 
Add»ss
& 
add»ss
, 
D©aBlock
& 
d©a
,

476 cÚ¡ 
boŞ
 
ex‹º®H™
, cÚ¡ 
MachšeTy³
 
mach
,

477 cÚ¡ 
Cyşes
 
š™ŸlReque¡Time
,

478 cÚ¡ 
Cyşes
 
fÜw¬dReque¡Time
,

479 cÚ¡ 
Cyşes
 
fœ¡Re¥Ú£Time
)

481 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

482 
	`as£¹
(
m_wr™eReque¡TabË
.
	`couÁ
(
	`lše_add»ss
(
add»ss
)));

484 
Reque¡TabË
::
™”©Ü
 
i
 = 
m_wr™eReque¡TabË
.
	`fšd
(
add»ss
);

485 
	`as£¹
(
i
 !ğ
m_wr™eReque¡TabË
.
	`’d
());

486 
Sequ’ûrReque¡
* 
»que¡
 = 
i
->
£cÚd
;

488 
m_wr™eReque¡TabË
.
	`”a£
(
i
);

489 
	`m¬kRemoved
();

491 
	`as£¹
((
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_ST
) ||

492 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_ATOMIC
) ||

493 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_RMW_R—d
) ||

494 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_RMW_Wr™e
) ||

495 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Lßd_Lšked
) ||

496 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_StÜe_CÚd™iÚ®
) ||

497 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_R—d
) ||

498 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_Wr™e
) ||

499 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_FLUSH
));

507 
boŞ
 
sucûss
 = 
Œue
;

508 if(!
m_usšgN‘wÜkTe¡”
)

509 
sucûss
 = 
	`hªdËLlsc
(
add»ss
, 
»que¡
);

511 ià(
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_R—d
) {

512 
m_cÚŒŞËr
->
	`blockOnQueue
(
add»ss
, 
m_mªd©Üy_q_±r
);

513 } ià(
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_Wr™e
) {

514 
m_cÚŒŞËr
->
	`unblock
(
add»ss
);

517 
	`h™C®lback
(
»que¡
, 
d©a
, 
sucûss
, 
mach
, 
ex‹º®H™
,

518 
š™ŸlReque¡Time
, 
fÜw¬dReque¡Time
, 
fœ¡Re¥Ú£Time
);

519 
	}
}

522 
	gSequ’ûr
::
	$»adC®lback
(cÚ¡ 
Add»ss
& 
add»ss
, 
D©aBlock
& 
d©a
,

523 
boŞ
 
ex‹º®H™
, cÚ¡ 
MachšeTy³
 
mach
,

524 
Cyşes
 
š™ŸlReque¡Time
,

525 
Cyşes
 
fÜw¬dReque¡Time
,

526 
Cyşes
 
fœ¡Re¥Ú£Time
)

528 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

529 
	`as£¹
(
m_»adReque¡TabË
.
	`couÁ
(
	`lše_add»ss
(
add»ss
)));

531 
Reque¡TabË
::
™”©Ü
 
i
 = 
m_»adReque¡TabË
.
	`fšd
(
add»ss
);

532 
	`as£¹
(
i
 !ğ
m_»adReque¡TabË
.
	`’d
());

533 
Sequ’ûrReque¡
* 
»que¡
 = 
i
->
£cÚd
;

535 
m_»adReque¡TabË
.
	`”a£
(
i
);

536 
	`m¬kRemoved
();

538 
	`as£¹
((
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_LD
) ||

539 (
»que¡
->
m_ty³
 =ğ
RubyReque¡Ty³_IFETCH
));

541 
	`h™C®lback
(
»que¡
, 
d©a
, 
Œue
, 
mach
, 
ex‹º®H™
,

542 
š™ŸlReque¡Time
, 
fÜw¬dReque¡Time
, 
fœ¡Re¥Ú£Time
);

543 
	}
}

546 
	gSequ’ûr
::
	$h™C®lback
(
Sequ’ûrReque¡
* 
¤eque¡
, 
D©aBlock
& 
d©a
,

547 
boŞ
 
ÎscSucûss
,

548 cÚ¡ 
MachšeTy³
 
mach
, cÚ¡ 
boŞ
 
ex‹º®H™
,

549 cÚ¡ 
Cyşes
 
š™ŸlReque¡Time
,

550 cÚ¡ 
Cyşes
 
fÜw¬dReque¡Time
,

551 cÚ¡ 
Cyşes
 
fœ¡Re¥Ú£Time
)

553 
Pack‘PŒ
 
pkt
 = 
¤eque¡
->pkt;

554 
Add»ss
 
	`»que¡_add»ss
(
pkt
->
	`g‘Addr
());

555 
Add»ss
 
	`»que¡_lše_add»ss
(
pkt
->
	`g‘Addr
());

556 
»que¡_lše_add»ss
.
	`makeLšeAdd»ss
();

557 
RubyReque¡Ty³
 
ty³
 = 
¤eque¡
->
m_ty³
;

558 
Cyşes
 
issued_time
 = 
¤eque¡
->
issue_time
;

561 ià(
ty³
 =ğ
RubyReque¡Ty³_IFETCH
) {

562 
m_š¡Cache_±r
->
	`£tMRU
(
»que¡_lše_add»ss
);

564 
m_d©aCache_±r
->
	`£tMRU
(
»que¡_lše_add»ss
);

567 
	`as£¹
(
	`curCyşe
(è>ğ
issued_time
);

568 
Cyşes
 
tÙ®_Ï‹ncy
 = 
	`curCyşe
(è- 
issued_time
;

571 
	`»cÜdMissL©’cy
(
tÙ®_Ï‹ncy
, 
ty³
, 
mach
, 
ex‹º®H™
, 
issued_time
,

572 
š™ŸlReque¡Time
, 
fÜw¬dReque¡Time
,

573 
fœ¡Re¥Ú£Time
, 
	`curCyşe
());

575 
	`DPRINTFR
(
PrÙocŞT¿û
, "%15s %3s %10s%20s %6s>%-6s %s %d cycles\n",

576 
	`curTick
(), 
m_v”siÚ
, "Seq",

577 
ÎscSucûss
 ? "Done" : "SC_Failed", "", "",

578 
»que¡_add»ss
, 
tÙ®_Ï‹ncy
);

581 ià(
g_sy¡em_±r
->
m_w¬mup_’abËd
) {

582 
	`as£¹
(
pkt
->
g‘PŒ
<
ušt8_t
>(
çl£
è!ğ
NULL
);

583 
d©a
.
	`£tD©a
(
pkt
->
g‘PŒ
<
ušt8_t
>(
çl£
),

584 
»que¡_add»ss
.
	`g‘Off£t
(), 
pkt
->
	`g‘Size
());

585 } ià(
pkt
->
g‘PŒ
<
ušt8_t
>(
Œue
è!ğ
NULL
) {

586 ià((
ty³
 =ğ
RubyReque¡Ty³_LD
) ||

587 (
ty³
 =ğ
RubyReque¡Ty³_IFETCH
) ||

588 (
ty³
 =ğ
RubyReque¡Ty³_RMW_R—d
) ||

589 (
ty³
 =ğ
RubyReque¡Ty³_Locked_RMW_R—d
) ||

590 (
ty³
 =ğ
RubyReque¡Ty³_Lßd_Lšked
)) {

591 
	`memıy
(
pkt
->
g‘PŒ
<
ušt8_t
>(
Œue
),

592 
d©a
.
	`g‘D©a
(
»que¡_add»ss
.
	`g‘Off£t
(), 
pkt
->
	`g‘Size
()),

593 
pkt
->
	`g‘Size
());

595 
d©a
.
	`£tD©a
(
pkt
->
g‘PŒ
<
ušt8_t
>(
Œue
),

596 
»que¡_add»ss
.
	`g‘Off£t
(), 
pkt
->
	`g‘Size
());

599 
	`DPRINTF
(
MemÜyAcûss
,

601 
	`RubyReque¡Ty³_to_¡ršg
(
ty³
));

609 ià(
m_usšgRubyTe¡”
) {

610 
RubyPÜt
::
S’d”S‹
 *
»qS’d”S‹
 =

611 
§ã_ÿ¡
<
RubyPÜt
::
S’d”S‹
*>(
pkt
->
£nd”S‹
);

614 
RubyTe¡”
::
S’d”S‹
* 
‹¡”S’d”S‹
 =

615 
§ã_ÿ¡
<
RubyTe¡”
::
S’d”S‹
*>(
»qS’d”S‹
->
´edeûssÜ
);

616 
‹¡”S’d”S‹
->
subBlock
.
	`m”geFrom
(
d©a
);

619 
d–‘e
 
¤eque¡
;

621 ià(
g_sy¡em_±r
->
m_w¬mup_’abËd
) {

622 
	`as£¹
(
pkt
->
»q
);

623 
d–‘e
 
pkt
->
»q
;

624 
d–‘e
 
pkt
;

625 
g_sy¡em_±r
->
m_ÿche_»cÜd”
->
	`’queueNextF‘chReque¡
();

626 } ià(
g_sy¡em_±r
->
m_coŞdown_’abËd
) {

627 
d–‘e
 
pkt
;

628 
g_sy¡em_±r
->
m_ÿche_»cÜd”
->
	`’queueNextFlushReque¡
();

630 
	`ruby_h™_ÿÎback
(
pkt
);

632 
	}
}

634 
boŞ


635 
	gSequ’ûr
::
	$em±y
() const

637  
m_wr™eReque¡TabË
.
	`em±y
(è&& 
m_»adReque¡TabË
.empty();

638 
	}
}

640 
Reque¡Stus


641 
	gSequ’ûr
::
	$makeReque¡
(
Pack‘PŒ
 
pkt
)

643 ià(
m_out¡ªdšg_couÁ
 >ğ
m_max_out¡ªdšg_»que¡s
) {

644  
Reque¡Stus_BufãrFuÎ
;

647 
RubyReque¡Ty³
 
´im¬y_ty³
 = 
RubyReque¡Ty³_NULL
;

648 
RubyReque¡Ty³
 
£cÚd¬y_ty³
 = 
RubyReque¡Ty³_NULL
;

650 ià(
pkt
->
	`isLLSC
()) {

659 ià(
pkt
->
	`isWr™e
()) {

660 
	`DPRINTF
(
RubySequ’ûr
, "Issuing SC\n");

661 
´im¬y_ty³
 = 
RubyReque¡Ty³_StÜe_CÚd™iÚ®
;

663 
	`DPRINTF
(
RubySequ’ûr
, "Issuing LL\n");

664 
	`as£¹
(
pkt
->
	`isR—d
());

665 
´im¬y_ty³
 = 
RubyReque¡Ty³_Lßd_Lšked
;

667 
£cÚd¬y_ty³
 = 
RubyReque¡Ty³_ATOMIC
;

668 } ià(
pkt
->
»q
->
	`isLocked
()) {

675 ià(
pkt
->
	`isWr™e
()) {

676 
	`DPRINTF
(
RubySequ’ûr
, "Issuing Locked RMW Write\n");

677 
´im¬y_ty³
 = 
RubyReque¡Ty³_Locked_RMW_Wr™e
;

679 
	`DPRINTF
(
RubySequ’ûr
, "Issuing Locked RMW Read\n");

680 
	`as£¹
(
pkt
->
	`isR—d
());

681 
´im¬y_ty³
 = 
RubyReque¡Ty³_Locked_RMW_R—d
;

683 
£cÚd¬y_ty³
 = 
RubyReque¡Ty³_ST
;

685 ià(
pkt
->
	`isR—d
()) {

686 ià(
pkt
->
»q
->
	`isIn¡F‘ch
()) {

687 
´im¬y_ty³
 = 
£cÚd¬y_ty³
 = 
RubyReque¡Ty³_IFETCH
;

689 #ià
THE_ISA
 =ğ
X86_ISA


690 
ušt32_t
 
æags
 = 
pkt
->
»q
->
	`g‘FÏgs
();

691 
boŞ
 
¡ÜeCheck
 = 
æags
 &

692 (
TheISA
::
StÜeCheck
 << TheISA::
FÏgShiá
);

694 
boŞ
 
¡ÜeCheck
 = 
çl£
;

696 ià(
¡ÜeCheck
) {

697 
´im¬y_ty³
 = 
RubyReque¡Ty³_RMW_R—d
;

698 
£cÚd¬y_ty³
 = 
RubyReque¡Ty³_ST
;

700 
´im¬y_ty³
 = 
£cÚd¬y_ty³
 = 
RubyReque¡Ty³_LD
;

703 } ià(
pkt
->
	`isWr™e
()) {

707 
´im¬y_ty³
 = 
£cÚd¬y_ty³
 = 
RubyReque¡Ty³_ST
;

708 } ià(
pkt
->
	`isFlush
()) {

709 
´im¬y_ty³
 = 
£cÚd¬y_ty³
 = 
RubyReque¡Ty³_FLUSH
;

711 
	`·nic
("Unsupported„uby…acketype\n");

715 
Reque¡Stus
 
¡©us
 = 
	`š£¹Reque¡
(
pkt
, 
´im¬y_ty³
);

716 ià(
¡©us
 !ğ
Reque¡Stus_R—dy
)

717  
¡©us
;

719 
	`issueReque¡
(
pkt
, 
£cÚd¬y_ty³
);

722  
Reque¡Stus_Issued
;

723 
	}
}

726 
	gSequ’ûr
::
	$issueReque¡
(
Pack‘PŒ
 
pkt
, 
RubyReque¡Ty³
 
£cÚd¬y_ty³
)

728 
	`as£¹
(
pkt
 !ğ
NULL
);

729 
´oc_id
 = -1;

730 ià(
pkt
->
»q
->
	`hasCÚ‹xtId
()) {

731 
´oc_id
 = 
pkt
->
»q
->
	`cÚ‹xtId
();

735 
Addr
 
pc
 = 0;

736 ià(
pkt
->
»q
->
	`hasPC
()) {

737 
pc
 = 
pkt
->
»q
->
	`g‘PC
();

740 
RubyReque¡
 *
msg
 = 
Ãw
 
	`RubyReque¡
(
	`şockEdge
(), 
pkt
->
	`g‘Addr
(),

741 
pkt
->
g‘PŒ
<
ušt8_t
>(
Œue
),

742 
pkt
->
	`g‘Size
(), 
pc
, 
£cÚd¬y_ty³
,

743 
RubyAcûssMode_Su³rvisÜ
, 
pkt
,

744 
P»ãtchB™_No
, 
´oc_id
);

746 
	`DPRINTFR
(
PrÙocŞT¿û
, "%15s %3s %10s%20s %6s>%-6s %s %s\n",

747 
	`curTick
(), 
m_v”siÚ
, "Seq", "Begin", "", "",

748 
msg
->
	`g‘PhysiÿlAdd»ss
(),

749 
	`RubyReque¡Ty³_to_¡ršg
(
£cÚd¬y_ty³
));

751 
Cyşes
 
	`Ï‹ncy
(0);

753 ià(
£cÚd¬y_ty³
 =ğ
RubyReque¡Ty³_IFETCH
)

754 
Ï‹ncy
 = 
m_š¡Cache_±r
->
	`g‘L©’cy
();

756 
Ï‹ncy
 = 
m_d©aCache_±r
->
	`g‘L©’cy
();

759 
	`as£¹
(
Ï‹ncy
 > 0);

761 
	`as£¹
(
m_mªd©Üy_q_±r
 !ğ
NULL
);

762 
m_mªd©Üy_q_±r
->
	`’queue
(
msg
, 
Ï‹ncy
);

763 
	}
}

765 
	g‹m¶©e
 <
şass
 
	gKEY
, cÏs 
	gVALUE
>

766 
	g¡d
::
o¡»am
 &

767 
İ”©Ü
<<(
o¡»am
 &
out
, cÚ¡ 
	gm5
::
hash_m­
<
KEY
, 
	gVALUE
> &
	gm­
)

769 
ty³Çme
 
	gm5
::
hash_m­
<
KEY
, 
	gVALUE
>::
cÚ¡_™”©Ü
 
i
 = 
m­
.
begš
();

770 
ty³Çme
 
	gm5
::
hash_m­
<
KEY
, 
	gVALUE
>::
cÚ¡_™”©Ü
 
’d
 = 
m­
.end();

772 
	gout
 << "[";

773 ; 
	gi
 !ğ
’d
; ++i)

774 
	gout
 << " " << 
	gi
->
	gfœ¡
 << "=" << i->
	g£cÚd
;

775 
	gout
 << " ]";

777  
	gout
;

781 
	gSequ’ûr
::
	$´št
(
o¡»am
& 
out
) const

783 
out
 << "[Sequ’ûr: " << 
m_v”siÚ


784 << ", out¡ªdšg„eque¡s: " << 
m_out¡ªdšg_couÁ


785 << ",„—d„eque¡abË: " << 
m_»adReque¡TabË


786 << ", wr™»que¡abË: " << 
m_wr™eReque¡TabË


788 
	}
}

794 
	gSequ’ûr
::
	$checkCoh”’û
(cÚ¡ 
Add»ss
& 
addr
)

796 #ifdeà
CHECK_COHERENCE


797 
g_sy¡em_±r
->
	`checkGlob®Coh”’ûInv¬ŸÁ
(
addr
);

799 
	}
}

802 
	gSequ’ûr
::
	$»cÜdReque¡Ty³
(
Sequ’ûrReque¡Ty³
 
»que¡Ty³
) {

803 
	`DPRINTF
(
RubySts
, "Recorded statistic: %s\n",

804 
	`Sequ’ûrReque¡Ty³_to_¡ršg
(
»que¡Ty³
));

805 
	}
}

809 
	gSequ’ûr
::
	$eviùiÚC®lback
(cÚ¡ 
Add»ss
& 
add»ss
)

811 
	`ruby_eviùiÚ_ÿÎback
(
add»ss
);

812 
	}
}

	@ruby/system/Sequencer.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_SEQUENCER_HH__


30 
	#__MEM_RUBY_SYSTEM_SEQUENCER_HH__


	)

32 
	~<io¡»am
>

34 
	~"ba£/hashm­.hh
"

35 
	~"mem/´ÙocŞ/MachšeTy³.hh
"

36 
	~"mem/´ÙocŞ/RubyReque¡Ty³.hh
"

37 
	~"mem/´ÙocŞ/Sequ’ûrReque¡Ty³.hh
"

38 
	~"mem/ruby/commÚ/Add»ss.hh
"

39 
	~"mem/ruby/sy¡em/CacheMemÜy.hh
"

40 
	~"mem/ruby/sy¡em/RubyPÜt.hh
"

41 
	~"·¿ms/RubySequ’ûr.hh
"

43 
şass
 
	gD©aBlock
;

45 
	sSequ’ûrReque¡


47 
Pack‘PŒ
 
	mpkt
;

48 
RubyReque¡Ty³
 
	mm_ty³
;

49 
Cyşes
 
	missue_time
;

51 
Sequ’ûrReque¡
(
Pack‘PŒ
 
_pkt
, 
RubyReque¡Ty³
 
_m_ty³
,

52 
Cyşes
 
_issue_time
)

53 : 
pkt
(
_pkt
), 
m_ty³
(
_m_ty³
), 
issue_time
(
_issue_time
)

57 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am& 
out
, cÚ¡ 
	gSequ’ûrReque¡
& 
	gobj
);

59 şas 
	cSequ’ûr
 : 
public
 
RubyPÜt


61 
public
:

62 
RubySequ’ûrP¬ams
 
	tP¬ams
;

63 
Sequ’ûr
(cÚ¡ 
P¬ams
 *);

64 ~
Sequ’ûr
();

67 
wakeup
();

68 
´štProg»ss
(
¡d
::
o¡»am
& 
out
) const;

69 
ş—rSts
();

71 
wr™eC®lback
(cÚ¡ 
Add»ss
& 
add»ss
,

72 
D©aBlock
& 
d©a
,

73 cÚ¡ 
boŞ
 
ex‹º®H™
 = 
çl£
,

74 cÚ¡ 
MachšeTy³
 
mach
 = 
MachšeTy³_NUM
,

75 cÚ¡ 
Cyşes
 
š™ŸlReque¡Time
 = Cycles(0),

76 cÚ¡ 
Cyşes
 
fÜw¬dReque¡Time
 = Cycles(0),

77 cÚ¡ 
Cyşes
 
fœ¡Re¥Ú£Time
 = Cycles(0));

79 
»adC®lback
(cÚ¡ 
Add»ss
& 
add»ss
,

80 
D©aBlock
& 
d©a
,

81 cÚ¡ 
boŞ
 
ex‹º®H™
 = 
çl£
,

82 cÚ¡ 
MachšeTy³
 
mach
 = 
MachšeTy³_NUM
,

83 cÚ¡ 
Cyşes
 
š™ŸlReque¡Time
 = Cycles(0),

84 cÚ¡ 
Cyşes
 
fÜw¬dReque¡Time
 = Cycles(0),

85 cÚ¡ 
Cyşes
 
fœ¡Re¥Ú£Time
 = Cycles(0));

87 
Reque¡Stus
 
makeReque¡
(
Pack‘PŒ
 
pkt
);

88 
boŞ
 
	$em±y
() const;

89 
	$out¡ªdšgCouÁ
(ècÚ¡ {  
m_out¡ªdšg_couÁ
; }

91 
boŞ
 
	$isD—dlockEv’tScheduËd
() const

92 {  
d—dlockCheckEv’t
.
	`scheduËd
(); 
	}
}

94 
	$descheduËD—dlockEv’t
()

95 { 
	`descheduË
(
d—dlockCheckEv’t
); 
	}
}

97 
´št
(
¡d
::
o¡»am
& 
out
) const;

98 
´štSts
(
¡d
::
o¡»am
& 
out
) const;

99 
checkCoh”’û
(cÚ¡ 
Add»ss
& 
add»ss
);

101 
m¬kRemoved
();

102 
»moveReque¡
(
Sequ’ûrReque¡
* 
»que¡
);

103 
eviùiÚC®lback
(cÚ¡ 
Add»ss
& 
add»ss
);

104 
šv®id©eSC
(cÚ¡ 
Add»ss
& 
add»ss
);

106 
»cÜdReque¡Ty³
(
Sequ’ûrReque¡Ty³
 
»que¡Ty³
);

107 
	gHi¡og¿m
& 
	$g‘Out¡ªdReqHi¡
(è{  
m_out¡ªdReqHi¡
; 
	}
}

109 
	gHi¡og¿m
& 
	$g‘L©’cyHi¡
(è{  
m_Ï‹ncyHi¡
; 
	}
}

110 
	gHi¡og¿m
& 
	$g‘Ty³L©’cyHi¡
(
ušt32_t
 
t
)

111 {  
m_ty³L©’cyHi¡
[
t
]; 
	}
}

113 
	gHi¡og¿m
& 
	$g‘H™L©’cyHi¡
(è{  
m_h™L©’cyHi¡
; 
	}
}

114 
	gHi¡og¿m
& 
	$g‘H™Ty³L©’cyHi¡
(
ušt32_t
 
t
)

115 {  
m_h™Ty³L©’cyHi¡
[
t
]; 
	}
}

117 
	gHi¡og¿m
& 
	$g‘H™MachL©’cyHi¡
(
ušt32_t
 
t
)

118 {  
m_h™MachL©’cyHi¡
[
t
]; 
	}
}

120 
	gHi¡og¿m
& 
	$g‘H™Ty³MachL©’cyHi¡
(
ušt32_t
 
r
, ušt32_ˆ
t
)

121 {  
m_h™Ty³MachL©’cyHi¡
[
r
][
t
]; 
	}
}

123 
	gHi¡og¿m
& 
	$g‘MissL©’cyHi¡
(è{  
m_missL©’cyHi¡
; 
	}
}

124 
	gHi¡og¿m
& 
	$g‘MissTy³L©’cyHi¡
(
ušt32_t
 
t
)

125 {  
m_missTy³L©’cyHi¡
[
t
]; 
	}
}

127 
	gHi¡og¿m
& 
	$g‘MissMachL©’cyHi¡
(
ušt32_t
 
t
)

128 {  
m_missMachL©’cyHi¡
[
t
]; 
	}
}

130 
	gHi¡og¿m
& 
	$g‘MissTy³MachL©’cyHi¡
(
ušt32_t
 
r
, ušt32_ˆ
t
)

131 {  
m_missTy³MachL©’cyHi¡
[
r
][
t
]; 
	}
}

133 
	gHi¡og¿m
& 
	$g‘IssueToIn™ŸlD–ayHi¡
(
ušt32_t
 
t
)

134 {  
m_IssueToIn™ŸlD–ayHi¡
[
t
]; 
	}
}

136 
	gHi¡og¿m
& 
	$g‘In™ŸlToFÜw¬dD–ayHi¡
(cÚ¡ 
MachšeTy³
 
t
)

137 {  
m_In™ŸlToFÜw¬dD–ayHi¡
[
t
]; 
	}
}

139 
	gHi¡og¿m
& 
	$g‘FÜw¬dReque¡ToFœ¡Re¥Ú£Hi¡
(cÚ¡ 
MachšeTy³
 
t
)

140 {  
m_FÜw¬dToFœ¡Re¥Ú£D–ayHi¡
[
t
]; 
	}
}

142 
	gHi¡og¿m
& 
	$g‘Fœ¡Re¥Ú£ToCom¶‘iÚD–ayHi¡
(cÚ¡ 
MachšeTy³
 
t
)

143 {  
m_Fœ¡Re¥Ú£ToCom¶‘iÚD–ayHi¡
[
t
]; 
	}
}

145 cÚ¡ 
ušt64_t
 
	$g‘Incom¶‘eTimes
(cÚ¡ 
MachšeTy³
 
t
) const

146 {  
m_Incom¶‘eTimes
[
t
]; 
	}
}

148 
	g´iv©e
:

149 
issueReque¡
(
Pack‘PŒ
 
pkt
, 
RubyReque¡Ty³
 
ty³
);

151 
h™C®lback
(
Sequ’ûrReque¡
* 
»que¡
, 
D©aBlock
& 
d©a
,

152 
boŞ
 
ÎscSucûss
,

153 cÚ¡ 
MachšeTy³
 
mach
, cÚ¡ 
boŞ
 
ex‹º®H™
,

154 cÚ¡ 
Cyşes
 
š™ŸlReque¡Time
,

155 cÚ¡ 
Cyşes
 
fÜw¬dReque¡Time
,

156 cÚ¡ 
Cyşes
 
fœ¡Re¥Ú£Time
);

158 
»cÜdMissL©’cy
(cÚ¡ 
Cyşes
 
t
, cÚ¡ 
RubyReque¡Ty³
 
ty³
,

159 cÚ¡ 
MachšeTy³
 
»¥ÚdšgMach
,

160 
boŞ
 
isEx‹º®H™
, 
Cyşes
 
issuedTime
,

161 
Cyşes
 
š™ŸlReque¡Time
,

162 
Cyşes
 
fÜw¬dReque¡Time
, Cyşe 
fœ¡Re¥Ú£Time
,

163 
Cyşes
 
com¶‘iÚTime
);

165 
Reque¡Stus
 
š£¹Reque¡
(
Pack‘PŒ
 
pkt
, 
RubyReque¡Ty³
 
»que¡_ty³
);

166 
boŞ
 
hªdËLlsc
(cÚ¡ 
Add»ss
& 
add»ss
, 
Sequ’ûrReque¡
* 
»que¡
);

169 
Sequ’ûr
(cÚ¡ Sequ’ûr& 
obj
);

170 
	gSequ’ûr
& 
	gİ”©Ü
=(cÚ¡ 
Sequ’ûr
& 
obj
);

172 
	g´iv©e
:

173 
m_max_out¡ªdšg_»que¡s
;

174 
Cyşes
 
	gm_d—dlock_th»shŞd
;

176 
CacheMemÜy
* 
	gm_d©aCache_±r
;

177 
CacheMemÜy
* 
	gm_š¡Cache_±r
;

179 
	gm5
::
	thash_m­
<
	tAdd»ss
, 
	tSequ’ûrReque¡
*> 
	tReque¡TabË
;

180 
Reque¡TabË
 
	gm_wr™eReque¡TabË
;

181 
Reque¡TabË
 
	gm_»adReque¡TabË
;

183 
	gm_out¡ªdšg_couÁ
;

184 
boŞ
 
	gm_d—dlock_check_scheduËd
;

186 
ušt32_t
 
	gm_¡Üe_wa™šg_Ú_lßd_cyşes
;

187 
ušt32_t
 
	gm_¡Üe_wa™šg_Ú_¡Üe_cyşes
;

188 
ušt32_t
 
	gm_lßd_wa™šg_Ú_¡Üe_cyşes
;

189 
ušt32_t
 
	gm_lßd_wa™šg_Ú_lßd_cyşes
;

191 
boŞ
 
	gm_usšgN‘wÜkTe¡”
;

194 
Hi¡og¿m
 
	gm_out¡ªdReqHi¡
;

197 
Hi¡og¿m
 
	gm_Ï‹ncyHi¡
;

198 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_ty³L©’cyHi¡
;

202 
Hi¡og¿m
 
	gm_h™L©’cyHi¡
;

203 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_h™Ty³L©’cyHi¡
;

207 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_h™MachL©’cyHi¡
;

208 
	g¡d
::
veùÜ
< 
¡d
::veùÜ<
Hi¡og¿m
> > 
m_h™Ty³MachL©’cyHi¡
;

212 
Hi¡og¿m
 
	gm_missL©’cyHi¡
;

213 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_missTy³L©’cyHi¡
;

217 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_missMachL©’cyHi¡
;

218 
	g¡d
::
veùÜ
< 
¡d
::veùÜ<
Hi¡og¿m
> > 
m_missTy³MachL©’cyHi¡
;

221 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_IssueToIn™ŸlD–ayHi¡
;

222 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_In™ŸlToFÜw¬dD–ayHi¡
;

223 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_FÜw¬dToFœ¡Re¥Ú£D–ayHi¡
;

224 
	g¡d
::
veùÜ
<
Hi¡og¿m
> 
m_Fœ¡Re¥Ú£ToCom¶‘iÚD–ayHi¡
;

225 
	g¡d
::
veùÜ
<
ušt64_t
> 
m_Incom¶‘eTimes
;

228 şas 
	cSequ’ûrWakeupEv’t
 : 
public
 
Ev’t


230 
´iv©e
:

231 
Sequ’ûr
 *
m_£qu’ûr_±r
;

233 
	gpublic
:

234 
Sequ’ûrWakeupEv’t
(
Sequ’ûr
 *
_£q
è: 
m_£qu’ûr_±r
(_seq) {}

235 
´oûss
(è{ 
m_£qu’ûr_±r
->
wakeup
(); }

236 cÚ¡ *
desütiÚ
() const {  "Sequencer deadlock check"; }

239 
Sequ’ûrWakeupEv’t
 
	gd—dlockCheckEv’t
;

242 
šlše
 
	g¡d
::
o¡»am
&

243 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gSequ’ûr
& 
	gobj
)

245 
	gobj
.
´št
(
out
);

246 
	gout
 << 
	g¡d
::
æush
;

247  
	gout
;

	@ruby/system/SparseMemory.cc

30 
	~<queue
>

32 
	~"debug/RubyCache.hh
"

33 
	~"mem/ruby/sy¡em/S·r£MemÜy.hh
"

34 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

36 
usšg
 
Çme¥aû
 
	g¡d
;

38 
	gS·r£MemÜy
::
	$S·r£MemÜy
(
numb”_of_Ëv–s
)

40 
ev’_Ëv–_b™s
;

41 
exŒa
;

42 
m_tÙ®_numb”_of_b™s
 = 
RubySy¡em
::
	`g‘MemÜySizeB™s
()

43 - 
RubySy¡em
::
	`g‘BlockSizeB™s
();;

45 
m_numb”_of_Ëv–s
 = 
numb”_of_Ëv–s
;

50 
m_numb”_of_b™s_³r_Ëv–
 = 
Ãw
 [
m_numb”_of_Ëv–s
];

51 
ev’_Ëv–_b™s
 = 
m_tÙ®_numb”_of_b™s
 / 
m_numb”_of_Ëv–s
;

52 
exŒa
 = 
m_tÙ®_numb”_of_b™s
 % 
m_numb”_of_Ëv–s
;

53 
Ëv–
 = 0;†ev– < 
m_numb”_of_Ëv–s
;†evel++) {

54 ià(
Ëv–
 < 
exŒa
)

55 
m_numb”_of_b™s_³r_Ëv–
[
Ëv–
] = 
ev’_Ëv–_b™s
 + 1;

57 
m_numb”_of_b™s_³r_Ëv–
[
Ëv–
] = 
ev’_Ëv–_b™s
;

59 
m_m­_h—d
 = 
Ãw
 
S·r£M­Ty³
;

60 
	}
}

62 
	gS·r£MemÜy
::~
	$S·r£MemÜy
()

64 
	`»cursiv–yRemoveTabËs
(
m_m­_h—d
, 0);

65 
d–‘e
 
m_m­_h—d
;

66 
d–‘e
 [] 
m_numb”_of_b™s_³r_Ëv–
;

67 
	}
}

72 
	gS·r£MemÜy
::
	$»cursiv–yRemoveTabËs
(
S·r£M­Ty³
* 
curTabË
, 
curLev–
)

74 
S·r£M­Ty³
::
™”©Ü
 
™”
;

76 
™”
 = 
curTabË
->
	`begš
(); i‹¸!ğcurTabË->
	`’d
(); iter++) {

77 
S·r£MemEÁry
 
’Œy
 = (*
™”
).
£cÚd
;

79 ià(
curLev–
 !ğ(
m_numb”_of_Ëv–s
 - 1)) {

82 
S·r£M­Ty³
* 
ÃxtTabË
 = (S·r£M­Ty³*)(
’Œy
);

83 
	`»cursiv–yRemoveTabËs
(
ÃxtTabË
, (
curLev–
 + 1));

84 
d–‘e
 
ÃxtTabË
;

87 
	`d–‘e
 (
Ab¡¿ùEÁry
*)(
’Œy
);

89 
’Œy
 = 
NULL
;

93 
curTabË
->
	`”a£
(curTabË->
	`begš
(), curTabË->
	`’d
());

94 
	}
}

97 
boŞ


98 
	gS·r£MemÜy
::
	$exi¡
(cÚ¡ 
Add»ss
& 
add»ss
) const

100 
S·r£M­Ty³
* 
curTabË
 = 
m_m­_h—d
;

101 
Add»ss
 
curAdd»ss
;

106 
highB™
 = 
m_tÙ®_numb”_of_b™s
 + 
RubySy¡em
::
	`g‘BlockSizeB™s
();

107 
lowB™
;

108 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

109 
	`DPRINTF
(
RubyCache
, "add»ss: %s\n", 
add»ss
);

111 
Ëv–
 = 0;†ev– < 
m_numb”_of_Ëv–s
;†evel++) {

116 
lowB™
 = 
highB™
 - 
m_numb”_of_b™s_³r_Ëv–
[
Ëv–
];

117 
curAdd»ss
.
	`£tAdd»ss
(
add»ss
.
	`b™S–eù
(
lowB™
, 
highB™
 - 1));

119 
	`DPRINTF
(
RubyCache
, "level: %d,†owBit: %d, highBit - 1: %d, "

121 
Ëv–
, 
lowB™
, 
highB™
 - 1, 
curAdd»ss
);

124 
highB™
 -ğ
m_numb”_of_b™s_³r_Ëv–
[
Ëv–
];

128 ià(
curTabË
->
	`couÁ
(
curAdd»ss
) != 0) {

129 
curTabË
 = (
S·r£M­Ty³
*)((*curTabË)[
curAdd»ss
]);

131 
	`DPRINTF
(
RubyCache
, "Not found\n");

132  
çl£
;

136 
	`DPRINTF
(
RubyCache
, "Entry found\n");

137  
Œue
;

138 
	}
}

142 
	gS·r£MemÜy
::
	$add
(cÚ¡ 
Add»ss
& 
add»ss
, 
Ab¡¿ùEÁry
* 
’Œy
)

144 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

145 
	`as£¹
(!
	`exi¡
(
add»ss
));

147 
m_tÙ®_adds
++;

149 
Add»ss
 
curAdd»ss
;

150 
S·r£M­Ty³
* 
curTabË
 = 
m_m­_h—d
;

155 
highB™
 = 
m_tÙ®_numb”_of_b™s
 + 
RubySy¡em
::
	`g‘BlockSizeB™s
();

156 
lowB™
;

157 * 
ÃwEÁry
 = 
NULL
;

159 
Ëv–
 = 0;†ev– < 
m_numb”_of_Ëv–s
;†evel++) {

164 
lowB™
 = 
highB™
 - 
m_numb”_of_b™s_³r_Ëv–
[
Ëv–
];

165 
curAdd»ss
.
	`£tAdd»ss
(
add»ss
.
	`b™S–eù
(
lowB™
, 
highB™
 - 1));

168 
highB™
 -ğ
m_numb”_of_b™s_³r_Ëv–
[
Ëv–
];

172 ià(
curTabË
->
	`couÁ
(
curAdd»ss
) != 0) {

173 
curTabË
 = (
S·r£M­Ty³
*)((*curTabË)[
curAdd»ss
]);

175 
m_adds_³r_Ëv–
[
Ëv–
]++;

178 ià(
Ëv–
 =ğ(
m_numb”_of_Ëv–s
 - 1)) {

179 
’Œy
->
	`g‘D©aBlk
().
	`ş—r
();

180 
ÃwEÁry
 = (*)
’Œy
;

182 
S·r£M­Ty³
* 
‹mpM­
 = 
Ãw
 SparseMapType;

183 
ÃwEÁry
 = (*)(
‹mpM­
);

188 (*
curTabË
)[
curAdd»ss
] = 
ÃwEÁry
;

191 
curTabË
 = (
S·r£M­Ty³
*)
ÃwEÁry
;

195 
	`as£¹
(
	`exi¡
(
add»ss
));

197 
	}
}

202 
	gS·r£MemÜy
::
	$»cursiv–yRemoveLev–s
(cÚ¡ 
Add»ss
& 
add»ss
,

203 
CurNextInfo
& 
curInfo
)

205 
Add»ss
 
curAdd»ss
;

206 
CurNextInfo
 
ÃxtInfo
;

207 
S·r£MemEÁry
 
’Œy
;

213 
curAdd»ss
.
	`£tAdd»ss
(
add»ss
.
	`b™S–eù
(
curInfo
.
lowB™
,

214 
curInfo
.
highB™
 - 1));

216 
	`DPRINTF
(
RubyCache
, "address: %s, curInfo.level: %d, curInfo.lowBit: %d, "

218 
add»ss
, 
curInfo
.
Ëv–
, curInfo.
lowB™
,

219 
curInfo
.
highB™
 - 1, 
curAdd»ss
);

221 
	`as£¹
(
curInfo
.
curTabË
->
	`couÁ
(
curAdd»ss
) != 0);

223 
’Œy
 = (*(
curInfo
.
curTabË
))[
curAdd»ss
];

225 ià(
curInfo
.
Ëv–
 < (
m_numb”_of_Ëv–s
 - 1)) {

227 
ÃxtInfo
.
curTabË
 = (
S·r£M­Ty³
*)(
’Œy
);

228 
ÃxtInfo
.
Ëv–
 = 
curInfo
.level + 1;

230 
ÃxtInfo
.
highB™
 = 
curInfo
.highBit -

231 
m_numb”_of_b™s_³r_Ëv–
[
curInfo
.
Ëv–
];

233 
ÃxtInfo
.
lowB™
 = 
curInfo
.lowBit -

234 
m_numb”_of_b™s_³r_Ëv–
[
curInfo
.
Ëv–
 + 1];

237 
bËSize
 = 
	`»cursiv–yRemoveLev–s
(
add»ss
, 
ÃxtInfo
);

241 ià(
bËSize
 == 0) {

242 
m_»moves_³r_Ëv–
[
curInfo
.
Ëv–
]++;

243 
d–‘e
 
ÃxtInfo
.
curTabË
;

244 
’Œy
 = 
NULL
;

245 
curInfo
.
curTabË
->
	`”a£
(
curAdd»ss
);

251 
	`d–‘e
 (
Ab¡¿ùEÁry
*)(
’Œy
);

252 
’Œy
 = 
NULL
;

253 
curInfo
.
curTabË
->
	`”a£
(
curAdd»ss
);

254 
m_»moves_³r_Ëv–
[
curInfo
.
Ëv–
]++;

256  
curInfo
.
curTabË
->
	`size
();

257 
	}
}

261 
	gS·r£MemÜy
::
	$»move
(cÚ¡ 
Add»ss
& 
add»ss
)

263 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

264 
	`as£¹
(
	`exi¡
(
add»ss
));

266 
m_tÙ®_»moves
++;

268 
CurNextInfo
 
ÃxtInfo
;

271 
ÃxtInfo
.
curTabË
 = 
m_m­_h—d
;

272 
ÃxtInfo
.
Ëv–
 = 0;

277 
ÃxtInfo
.
highB™
 = 
m_tÙ®_numb”_of_b™s
 + 
RubySy¡em
::
	`g‘BlockSizeB™s
();

278 
ÃxtInfo
.
lowB™
 =‚extInfo.
highB™
 - 
m_numb”_of_b™s_³r_Ëv–
[0];;

283 
	`»cursiv–yRemoveLev–s
(
add»ss
, 
ÃxtInfo
);

285 
	`as£¹
(!
	`exi¡
(
add»ss
));

287 
	}
}

290 
Ab¡¿ùEÁry
*

291 
	gS·r£MemÜy
::
	$lookup
(cÚ¡ 
Add»ss
& 
add»ss
)

293 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

295 
Add»ss
 
curAdd»ss
;

296 
S·r£M­Ty³
* 
curTabË
 = 
m_m­_h—d
;

297 
Ab¡¿ùEÁry
* 
’Œy
 = 
NULL
;

302 
highB™
 = 
m_tÙ®_numb”_of_b™s
 + 
RubySy¡em
::
	`g‘BlockSizeB™s
();

303 
lowB™
;

305 
Ëv–
 = 0;†ev– < 
m_numb”_of_Ëv–s
;†evel++) {

310 
lowB™
 = 
highB™
 - 
m_numb”_of_b™s_³r_Ëv–
[
Ëv–
];

311 
curAdd»ss
.
	`£tAdd»ss
(
add»ss
.
	`b™S–eù
(
lowB™
, 
highB™
 - 1));

313 
	`DPRINTF
(
RubyCache
, "level: %d,†owBit: %d, highBit - 1: %d, "

315 
Ëv–
, 
lowB™
, 
highB™
 - 1, 
curAdd»ss
);

318 
highB™
 -ğ
m_numb”_of_b™s_³r_Ëv–
[
Ëv–
];

322 ià(
curTabË
->
	`couÁ
(
curAdd»ss
) != 0) {

323 
curTabË
 = (
S·r£M­Ty³
*)((*curTabË)[
curAdd»ss
]);

325 
	`DPRINTF
(
RubyCache
, "Not found\n");

326  
NULL
;

331 
’Œy
 = (
Ab¡¿ùEÁry
*)
curTabË
;

333  
’Œy
;

334 
	}
}

337 
	gS·r£MemÜy
::
	$»cÜdBlocks
(
úŒl_id
, 
CacheRecÜd”
* 
Œ
) const

339 
queue
<
S·r£M­Ty³
*> 
uÃx¶Üed_nodes
[2];

340 
queue
<
physiÿl_add»ss_t
> 
add»ss_of_nodes
[2];

342 
uÃx¶Üed_nodes
[0].
	`push
(
m_m­_h—d
);

343 
add»ss_of_nodes
[0].
	`push
(0);

345 
·r™y_of_Ëv–
 = 0;

346 
physiÿl_add»ss_t
 
add»ss
, 
‹mp_add»ss
;

347 
Add»ss
 
curAdd»ss
;

352 
highB™
 = 
m_tÙ®_numb”_of_b™s
 + 
RubySy¡em
::
	`g‘BlockSizeB™s
();

353 
lowB™
;

355 
cur_Ëv–
 = 0; cur_Ëv– < 
m_numb”_of_Ëv–s
; cur_level++) {

361 
lowB™
 = 
highB™
 - 
m_numb”_of_b™s_³r_Ëv–
[
cur_Ëv–
];

363 !
uÃx¶Üed_nodes
[
·r™y_of_Ëv–
].
	`em±y
()) {

365 
S·r£M­Ty³
* 
node
 = 
uÃx¶Üed_nodes
[
·r™y_of_Ëv–
].
	`äÚt
();

366 
uÃx¶Üed_nodes
[
·r™y_of_Ëv–
].
	`pİ
();

368 
add»ss
 = 
add»ss_of_nodes
[
·r™y_of_Ëv–
].
	`äÚt
();

369 
add»ss_of_nodes
[
·r™y_of_Ëv–
].
	`pİ
();

371 
S·r£M­Ty³
::
™”©Ü
 
™”
;

373 
™”
 = 
node
->
	`begš
(); i‹¸!ğnode->
	`’d
(); iter++) {

374 
S·r£MemEÁry
 
’Œy
 = (*
™”
).
£cÚd
;

375 
curAdd»ss
 = (*
™”
).
fœ¡
;

377 ià(
cur_Ëv–
 !ğ(
m_numb”_of_Ëv–s
 - 1)) {

379 
uÃx¶Üed_nodes
[1 - 
·r™y_of_Ëv–
].
	`push
(

380 (
S·r£M­Ty³
*)(
’Œy
));

381 
add»ss_of_nodes
[1 - 
·r™y_of_Ëv–
].
	`push
(
add»ss
 |

382 (
curAdd»ss
.
	`g‘Add»ss
(è<< 
lowB™
));

385 
‹mp_add»ss
 = 
add»ss
 | (
curAdd»ss
.
	`g‘Add»ss
()

386 << 
lowB™
);

387 
D©aBlock
 
block
 = ((
Ab¡¿ùEÁry
*)
’Œy
)->
	`g‘D©aBlk
();

388 
Œ
->
	`addRecÜd
(
úŒl_id
, 
‹mp_add»ss
, 0, 
RubyReque¡Ty³_ST
, 0,

389 
block
);

395 
highB™
 -ğ
m_numb”_of_b™s_³r_Ëv–
[
cur_Ëv–
];

396 
·r™y_of_Ëv–
 = 1 -…arity_of_level;

398 
	}
}

401 
	gS·r£MemÜy
::
	$»gSts
(cÚ¡ 
¡ršg
 &
Çme
)

403 
m_tÙ®_adds
.
	`Çme
(
Çme
 + ".total_adds");

405 
m_adds_³r_Ëv–


406 .
	`š™
(
m_numb”_of_Ëv–s
)

407 .
	`Çme
(
Çme
 + ".adds_per_level")

408 .
	`æags
(
Sts
::
pdf
 | Sts::
tÙ®
)

411 
m_tÙ®_»moves
.
	`Çme
(
Çme
 + ".total_removes");

412 
m_»moves_³r_Ëv–


413 .
	`š™
(
m_numb”_of_Ëv–s
)

414 .
	`Çme
(
Çme
 + ".removes_per_level")

415 .
	`æags
(
Sts
::
pdf
 | Sts::
tÙ®
)

417 
	}
}

	@ruby/system/SparseMemory.hh

30 #iâdeà
__MEM_RUBY_SYSTEM_SPARSEMEMORY_HH__


31 
	#__MEM_RUBY_SYSTEM_SPARSEMEMORY_HH__


	)

33 
	~<io¡»am
>

34 
	~<¡ršg
>

36 
	~"ba£/hashm­.hh
"

37 
	~"ba£/¡©i¡ics.hh
"

38 
	~"mem/ruby/commÚ/Add»ss.hh
"

39 
	~"mem/ruby/»cÜd”/CacheRecÜd”.hh
"

40 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùEÁry.hh
"

42 * 
	tS·r£MemEÁry
;

43 
	gm5
::
	thash_m­
<
	tAdd»ss
, 
	tS·r£MemEÁry
> 
	tS·r£M­Ty³
;

45 
	sCurNextInfo


47 
S·r£M­Ty³
* 
	mcurTabË
;

48 
	mËv–
;

49 
	mhighB™
;

50 
	mlowB™
;

53 şas 
	cS·r£MemÜy


55 
	mpublic
:

56 
S·r£MemÜy
(
numb”_of_Ëv–s
);

57 ~
S·r£MemÜy
();

59 
boŞ
 
	$exi¡
(cÚ¡ 
Add»ss
& 
add»ss
) const;

60 
	`add
(cÚ¡ 
Add»ss
& 
add»ss
, 
Ab¡¿ùEÁry
*);

61 
	`»move
(cÚ¡ 
Add»ss
& 
add»ss
);

69 
	$»cÜdBlocks
(
úŒl_id
, 
CacheRecÜd”
 *) const;

71 
Ab¡¿ùEÁry
* 
	`lookup
(cÚ¡ 
Add»ss
& 
add»ss
);

72 
	`»gSts
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

74 
´iv©e
:

76 
	`S·r£MemÜy
(cÚ¡ 
S·r£MemÜy
& 
obj
);

77 
S·r£MemÜy
& 
İ”©Ü
=(cÚ¡ S·r£MemÜy& 
obj
);

80 
	`»cursiv–yRemoveTabËs
(
S·r£M­Ty³
* 
cu¼’tTabË
, 
Ëv–
);

83 
	`»cursiv–yRemoveLev–s
(cÚ¡ 
Add»ss
& 
add»ss
, 
CurNextInfo
& 
curInfo
);

86 
S·r£M­Ty³
* 
m_m­_h—d
;

88 
m_tÙ®_numb”_of_b™s
;

89 
m_numb”_of_Ëv–s
;

90 * 
m_numb”_of_b™s_³r_Ëv–
;

92 
Sts
::
SÿÏr
 
m_tÙ®_adds
;

93 
Sts
::
VeùÜ
 
m_adds_³r_Ëv–
;

94 
Sts
::
SÿÏr
 
m_tÙ®_»moves
;

95 
Sts
::
VeùÜ
 
m_»moves_³r_Ëv–
;

	@ruby/system/System.cc

29 
	~<fú.h
>

30 
	~<zlib.h
>

32 
	~<c¡dio
>

34 
	~"ba£/štm©h.hh
"

35 
	~"ba£/¡©i¡ics.hh
"

36 
	~"debug/RubyCacheT¿û.hh
"

37 
	~"debug/RubySy¡em.hh
"

38 
	~"mem/ruby/commÚ/Add»ss.hh
"

39 
	~"mem/ruby/ÃtwÜk/N‘wÜk.hh
"

40 
	~"mem/ruby/´of”/Prof”.hh
"

41 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

42 
	~"sim/ev’tq.hh
"

43 
	~"sim/simuÏ‹.hh
"

45 
usšg
 
Çme¥aû
 
	g¡d
;

47 
	gRubySy¡em
::
m_¿ndom_£ed
;

48 
boŞ
 
	gRubySy¡em
::
m_¿ndomiz©iÚ
;

49 
ušt32_t
 
	gRubySy¡em
::
m_block_size_by‹s
;

50 
ušt32_t
 
	gRubySy¡em
::
m_block_size_b™s
;

51 
ušt64_t
 
	gRubySy¡em
::
m_memÜy_size_by‹s
;

52 
ušt32_t
 
	gRubySy¡em
::
m_memÜy_size_b™s
;

54 
	gRubySy¡em
::
	$RubySy¡em
(cÚ¡ 
P¬ams
 *
p
)

55 : 
	$ClockedObjeù
(
p
)

57 ià(
g_sy¡em_±r
 !ğ
NULL
)

58 
	`çl
("Only one RubySystem object currently‡llowed.\n");

60 
m_¿ndom_£ed
 = 
p
->
¿ndom_£ed
;

61 
	`¤ªdom
(
m_¿ndom_£ed
);

62 
m_¿ndomiz©iÚ
 = 
p
->
¿ndomiz©iÚ
;

64 
m_block_size_by‹s
 = 
p
->
block_size_by‹s
;

65 
	`as£¹
(
	`isPow”Of2
(
m_block_size_by‹s
));

66 
m_block_size_b™s
 = 
	`æoÜLog2
(
m_block_size_by‹s
);

68 
m_memÜy_size_by‹s
 = 
p
->
mem_size
;

69 ià(
m_memÜy_size_by‹s
 == 0) {

70 
m_memÜy_size_b™s
 = 0;

72 
m_memÜy_size_b™s
 = 
	`ûLog2
(
m_memÜy_size_by‹s
);

75 ià(
p
->
no_mem_vec
) {

76 
m_mem_vec_±r
 = 
NULL
;

78 
m_mem_vec_±r
 = 
Ãw
 
MemÜyVeùÜ
;

79 
m_mem_vec_±r
->
	`»size
(
m_memÜy_size_by‹s
);

83 
Sts
::
	`»gi¡”DumpC®lback
(
Ãw
 
	`RubyDumpStsC®lback
(
p
->
¡©s_f’ame
,

84 
this
));

86 
m_w¬mup_’abËd
 = 
çl£
;

87 
m_coŞdown_’abËd
 = 
çl£
;

90 
g_sy¡em_±r
 = 
this
;

93 
g_abs_cÚŒŞs
.
	`»size
(
MachšeTy³_NUM
);

94 
	}
}

97 
	gRubySy¡em
::
	$»gi¡”N‘wÜk
(
N‘wÜk
* 
ÃtwÜk_±r
)

99 
m_ÃtwÜk_±r
 = 
ÃtwÜk_±r
;

100 
	}
}

103 
	gRubySy¡em
::
	$»gi¡”Prof”
(
Prof”
* 
´of”_±r
)

105 
m_´of”_±r
 = 
´of”_±r
;

106 
	}
}

109 
	gRubySy¡em
::
	$»gi¡”Ab¡¿ùCÚŒŞËr
(
Ab¡¿ùCÚŒŞËr
* 
úŒl
)

111 
m_abs_úŒl_vec
.
	`push_back
(
úŒl
);

113 
MachšeID
 
id
 = 
úŒl
->
	`g‘MachšeID
();

114 
g_abs_cÚŒŞs
[
id
.
	`g‘Ty³
()][id.
	`g‘Num
()] = 
úŒl
;

115 
	}
}

118 
	gRubySy¡em
::
	$»gi¡”S·r£MemÜy
(
S·r£MemÜy
* 
s
)

120 
m_¥¬£_memÜy_veùÜ
.
	`push_back
(
s
);

121 
	}
}

124 
	gRubySy¡em
::
	$»gi¡”MemCÚŒŞËr
(
MemÜyCÚŒŞ
 *
mc
) {

125 
m_memÜy_cÚŒŞËr_vec
.
	`push_back
(
mc
);

126 
	}
}

128 
	gRubySy¡em
::~
	$RubySy¡em
()

130 
d–‘e
 
m_ÃtwÜk_±r
;

131 
d–‘e
 
m_´of”_±r
;

132 ià(
m_mem_vec_±r
)

133 
d–‘e
 
m_mem_vec_±r
;

134 
	}
}

137 
	gRubySy¡em
::
	$´štSts
(
o¡»am
& 
out
)

139 
m_´of”_±r
->
	`´štSts
(
out
);

140 
	}
}

143 
	gRubySy¡em
::
	$wr™eCom´es£dT¿û
(
ušt8_t
 *
¿w_d©a
, 
¡ršg
 
f’ame
,

144 
ušt64
 
uncom´es£d_Œaû_size
)

147 
¡ršg
 
thefe
 = 
Checkpošt
::
	`dœ
(è+ "/" + 
f’ame
.
	`c_¡r
();

149 
fd
 = 
	`ü—t
(
thefe
.
	`c_¡r
(), 0664);

150 ià(
fd
 < 0) {

151 
	`³¼Ü
("creat");

152 
	`çl
("Cª'ˆİ’ memÜy¿û f'%s'\n", 
f’ame
);

155 
gzFe
 
com´es£dMemÜy
 = 
	`gzdİ’
(
fd
, "wb");

156 ià(
com´es£dMemÜy
 =ğ
NULL
)

157 
	`çl
("Insufficient memoryo‡llocate compression state for %s\n",

158 
f’ame
);

160 ià(
	`gzwr™e
(
com´es£dMemÜy
, 
¿w_d©a
, 
uncom´es£d_Œaû_size
) !=

161 
uncom´es£d_Œaû_size
) {

162 
	`çl
("Wr™çed oÀmemÜy¿û f'%s'\n", 
f’ame
);

165 ià(
	`gzşo£
(
com´es£dMemÜy
)) {

166 
	`çl
("Clo£ faed oÀmemÜy¿û f'%s'\n", 
f’ame
);

168 
d–‘e
 
¿w_d©a
;

169 
	}
}

172 
	gRubySy¡em
::
£rŸlize
(
¡d
::
o¡»am
 &
os
)

174 
m_coŞdown_’abËd
 = 
Œue
;

176 
	gveùÜ
<
	gSequ’ûr
*> 
	g£qu’ûr_m­
;

177 
Sequ’ûr
* 
	g£qu’ûr_±r
 = 
NULL
;

178 
	gúŒl_id
 = -1;

181 
	gúŒl
 = 0; cÁ¾ < 
	gm_abs_úŒl_vec
.
size
(); cntrl++) {

182 
	g£qu’ûr_m­
.
push_back
(
m_abs_úŒl_vec
[
úŒl
]->
g‘Sequ’ûr
());

183 ià(
	g£qu’ûr_±r
 =ğ
NULL
) {

184 
£qu’ûr_±r
 = 
£qu’ûr_m­
[
úŒl
];

185 
	gúŒl_id
 = 
úŒl
;

189 
as£¹
(
£qu’ûr_±r
 !ğ
NULL
);

191 
	gúŒl
 = 0; cÁ¾ < 
	gm_abs_úŒl_vec
.
size
(); cntrl++) {

192 ià(
	g£qu’ûr_m­
[
úŒl
] =ğ
NULL
) {

193 
£qu’ûr_m­
[
úŒl
] = 
£qu’ûr_±r
;

197 
DPRINTF
(
RubyCacheT¿û
, "Recording Cache Trace\n");

199 
	gm_ÿche_»cÜd”
 = 
Ãw
 
CacheRecÜd”
(
NULL
, 0, 
£qu’ûr_m­
);

201 
	gúŒl
 = 0; cÁ¾ < 
	gm_abs_úŒl_vec
.
size
(); cntrl++) {

202 
	gm_abs_úŒl_vec
[
úŒl
]->
»cÜdCacheT¿û
(úŒl, 
m_ÿche_»cÜd”
);

205 
DPRINTF
(
RubyCacheT¿û
, "Cache Trace Complete\n");

207 
Tick
 
	gcu¹ick_Üigš®
 = 
curTick
();

209 
Ev’t
* 
	gev’tq_h—d
 = 
ev’tq
->
»¶aûH—d
(
NULL
);

210 
DPRINTF
(
RubyCacheT¿û
, "Recording currentick %ld‡ndƒvent queue\n",

211 
cu¹ick_Üigš®
);

214 
DPRINTF
(
RubyCacheT¿û
, "Starting cache flush\n");

215 
’queueRubyEv’t
(
curTick
());

216 
simuÏ‹
();

217 
DPRINTF
(
RubyCacheT¿û
, "Cache flush complete\n");

220 
	gev’tq_h—d
 = 
ev’tq
->
»¶aûH—d
(
ev’tq_h—d
);

222 
£tCurTick
(
cu¹ick_Üigš®
);

224 
ušt8_t
 *
	g¿w_d©a
 = 
NULL
;

226 ià(
	gm_mem_vec_±r
 !ğ
NULL
) {

227 
ušt64
 
memÜy_Œaû_size
 = 
m_mem_vec_±r
->
cŞÏ‹Pages
(
¿w_d©a
);

229 
¡ršg
 
	gmemÜy_Œaû_fe
 = 
Çme
() + ".memory.gz";

230 
wr™eCom´es£dT¿û
(
¿w_d©a
, 
memÜy_Œaû_fe
,

231 
memÜy_Œaû_size
);

233 
SERIALIZE_SCALAR
(
memÜy_Œaû_fe
);

234 
SERIALIZE_SCALAR
(
memÜy_Œaû_size
);

237 
	gi
 = 0; i < 
	gm_¥¬£_memÜy_veùÜ
.
size
(); ++i) {

238 
	gm_¥¬£_memÜy_veùÜ
[
i
]->
»cÜdBlocks
(
úŒl_id
,

239 
m_ÿche_»cÜd”
);

244 
	g¿w_d©a
 = 
Ãw
 
ušt8_t
[4096];

245 
ušt64
 
	gÿche_Œaû_size
 = 
m_ÿche_»cÜd”
->
agg»g©eRecÜds
(&
¿w_d©a
,

247 
¡ršg
 
	gÿche_Œaû_fe
 = 
Çme
() + ".cache.gz";

248 
wr™eCom´es£dT¿û
(
¿w_d©a
, 
ÿche_Œaû_fe
, 
ÿche_Œaû_size
);

250 
SERIALIZE_SCALAR
(
ÿche_Œaû_fe
);

251 
SERIALIZE_SCALAR
(
ÿche_Œaû_size
);

253 
	gm_coŞdown_’abËd
 = 
çl£
;

257 
	gRubySy¡em
::
	$»adCom´es£dT¿û
(
¡ršg
 
f’ame
, 
ušt8_t
 *&
¿w_d©a
,

258 
ušt64
& 
uncom´es£d_Œaû_size
)

261 
gzFe
 
com´es£dT¿û
;

264 
fd
 = 
	`İ’
(
f’ame
.
	`c_¡r
(), 
O_RDONLY
);

265 ià(
fd
 < 0) {

266 
	`³¼Ü
("open");

267 
	`çl
("UÇbËØİ’¿û f%s", 
f’ame
);

270 
com´es£dT¿û
 = 
	`gzdİ’
(
fd
, "rb");

271 ià(
com´es£dT¿û
 =ğ
NULL
) {

272 
	`çl
("Insufficient memoryo‡llocate compression state for %s\n",

273 
f’ame
);

276 
¿w_d©a
 = 
Ãw
 
ušt8_t
[
uncom´es£d_Œaû_size
];

277 ià(
	`gz»ad
(
com´es£dT¿û
, 
¿w_d©a
, 
uncom´es£d_Œaû_size
) <

278 
uncom´es£d_Œaû_size
) {

279 
	`çl
("UÇbËØ»ad com¶‘Œaû from f%s\n", 
f’ame
);

282 ià(
	`gzşo£
(
com´es£dT¿û
)) {

283 
	`çl
("FaedØşo£ cachŒaû f'%s'\n", 
f’ame
);

285 
	}
}

288 
	gRubySy¡em
::
	$un£rŸlize
(
Checkpošt
 *
ı
, cÚ¡ 
¡ršg
 &
£ùiÚ
)

290 
ušt8_t
 *
uncom´es£d_Œaû
 = 
NULL
;

292 ià(
m_mem_vec_±r
 !ğ
NULL
) {

293 
¡ršg
 
memÜy_Œaû_fe
;

294 
ušt64
 
memÜy_Œaû_size
 = 0;

296 
	`UNSERIALIZE_SCALAR
(
memÜy_Œaû_fe
);

297 
	`UNSERIALIZE_SCALAR
(
memÜy_Œaû_size
);

298 
memÜy_Œaû_fe
 = 
ı
->
ıtDœ
 + "/" + memory_trace_file;

300 
	`»adCom´es£dT¿û
(
memÜy_Œaû_fe
, 
uncom´es£d_Œaû
,

301 
memÜy_Œaû_size
);

302 
m_mem_vec_±r
->
	`pİuÏ‹Pages
(
uncom´es£d_Œaû
);

304 
d–‘e
 [] 
uncom´es£d_Œaû
;

305 
uncom´es£d_Œaû
 = 
NULL
;

308 
¡ršg
 
ÿche_Œaû_fe
;

309 
ušt64
 
ÿche_Œaû_size
 = 0;

311 
	`UNSERIALIZE_SCALAR
(
ÿche_Œaû_fe
);

312 
	`UNSERIALIZE_SCALAR
(
ÿche_Œaû_size
);

313 
ÿche_Œaû_fe
 = 
ı
->
ıtDœ
 + "/" + cache_trace_file;

315 
	`»adCom´es£dT¿û
(
ÿche_Œaû_fe
, 
uncom´es£d_Œaû
,

316 
ÿche_Œaû_size
);

317 
m_w¬mup_’abËd
 = 
Œue
;

319 
veùÜ
<
Sequ’ûr
*> 
£qu’ûr_m­
;

320 
Sequ’ûr
* 
t
 = 
NULL
;

321 
úŒl
 = 0; cÁ¾ < 
m_abs_úŒl_vec
.
	`size
(); cntrl++) {

322 
£qu’ûr_m­
.
	`push_back
(
m_abs_úŒl_vec
[
úŒl
]->
	`g‘Sequ’ûr
());

323 ià(
t
 =ğ
NULL
èˆğ
£qu’ûr_m­
[
úŒl
];

326 
	`as£¹
(
t
 !ğ
NULL
);

328 
úŒl
 = 0; cÁ¾ < 
m_abs_úŒl_vec
.
	`size
(); cntrl++) {

329 ià(
£qu’ûr_m­
[
úŒl
] =ğ
NULL
) {

330 
£qu’ûr_m­
[
úŒl
] = 
t
;

334 
m_ÿche_»cÜd”
 = 
Ãw
 
	`CacheRecÜd”
(
uncom´es£d_Œaû
, 
ÿche_Œaû_size
,

335 
£qu’ûr_m­
);

336 
	}
}

339 
	gRubySy¡em
::
	$¡¬tup
()

358 ià(
m_w¬mup_’abËd
) {

360 
Tick
 
cu¹ick_Üigš®
 = 
	`curTick
();

362 
Ev’t
* 
ev’tq_h—d
 = 
ev’tq
->
	`»¶aûH—d
(
NULL
);

364 
	`£tCurTick
(0);

365 
	`»£tClock
();

368 
	`’queueRubyEv’t
(
	`curTick
());

369 
	`simuÏ‹
();

371 
d–‘e
 
m_ÿche_»cÜd”
;

372 
m_ÿche_»cÜd”
 = 
NULL
;

373 
m_w¬mup_’abËd
 = 
çl£
;

377 
i
 = 0; i < 
m_memÜy_cÚŒŞËr_vec
.
	`size
(); ++i) {

378 
m_memÜy_cÚŒŞËr_vec
[
i
]->
	`»£t
();

382 
ev’tq_h—d
 = 
ev’tq
->
	`»¶aûH—d
(eventq_head);

384 
	`£tCurTick
(
cu¹ick_Üigš®
);

385 
	`»£tClock
();

388 
	`»£tSts
();

389 
	}
}

392 
	gRubySy¡em
::
RubyEv’t
::
	$´oûss
()

394 ià(
ruby_sy¡em
->
m_w¬mup_’abËd
) {

395 
ruby_sy¡em
->
m_ÿche_»cÜd”
->
	`’queueNextF‘chReque¡
();

396 } ià(
ruby_sy¡em
->
m_coŞdown_’abËd
) {

397 
ruby_sy¡em
->
m_ÿche_»cÜd”
->
	`’queueNextFlushReque¡
();

399 
	}
}

402 
	gRubySy¡em
::
	$»£tSts
()

404 
m_´of”_±r
->
	`ş—rSts
();

405 
ušt32_t
 
úŒl
 = 0; cÁ¾ < 
m_abs_úŒl_vec
.
	`size
(); cntrl++) {

406 
m_abs_úŒl_vec
[
úŒl
]->
	`ş—rSts
();

409 
g_ruby_¡¬t
 = 
	`curCyşe
();

410 
	}
}

412 
boŞ


413 
	gRubySy¡em
::
	$funùiÚ®R—d
(
Pack‘PŒ
 
pkt
)

415 
Add»ss
 
	`add»ss
(
pkt
->
	`g‘Addr
());

416 
Add»ss
 
	`lše_add»ss
(
add»ss
);

417 
lše_add»ss
.
	`makeLšeAdd»ss
();

419 
AcûssP”missiÚ
 
acûss_³rm
 = 
AcûssP”missiÚ_NÙP»£Á
;

420 
num_cÚŒŞËrs
 = 
m_abs_úŒl_vec
.
	`size
();

422 
	`DPRINTF
(
RubySy¡em
, "FunùiÚ® R—d„eque¡ fÜ %s\n",
add»ss
);

424 
num_ro
 = 0;

425 
num_rw
 = 0;

426 
num_busy
 = 0;

427 
num_backšg_¡Üe
 = 0;

428 
num_šv®id
 = 0;

432 
i
 = 0; i < 
num_cÚŒŞËrs
; ++i) {

433 
acûss_³rm
 = 
m_abs_úŒl_vec
[
i
]-> 
	`g‘AcûssP”missiÚ
(
lše_add»ss
);

434 ià(
acûss_³rm
 =ğ
AcûssP”missiÚ_R—d_OÆy
)

435 
num_ro
++;

436 ià(
acûss_³rm
 =ğ
AcûssP”missiÚ_R—d_Wr™e
)

437 
num_rw
++;

438 ià(
acûss_³rm
 =ğ
AcûssP”missiÚ_Busy
)

439 
num_busy
++;

440 ià(
acûss_³rm
 =ğ
AcûssP”missiÚ_Backšg_StÜe
)

445 
num_backšg_¡Üe
++;

446 ià(
acûss_³rm
 =ğ
AcûssP”missiÚ_Inv®id
 ||

447 
acûss_³rm
 =ğ
AcûssP”missiÚ_NÙP»£Á
)

448 
num_šv®id
++;

450 
	`as£¹
(
num_rw
 <= 1);

452 
ušt8_t
 *
d©a
 = 
pkt
->
g‘PŒ
<ušt8_t>(
Œue
);

453 
size_š_by‹s
 = 
pkt
->
	`g‘Size
();

454 
¡¬tBy‹
 = 
add»ss
.
	`g‘Add»ss
(è- 
lše_add»ss
.getAddress();

464 ià(
num_šv®id
 =ğ(
num_cÚŒŞËrs
 - 1) &&

465 
num_backšg_¡Üe
 == 1) {

466 
	`DPRINTF
(
RubySy¡em
, "only copy in Backing_Store memory,„ead from it\n");

467 
i
 = 0; i < 
num_cÚŒŞËrs
; ++i) {

468 
acûss_³rm
 = 
m_abs_úŒl_vec
[
i
]->
	`g‘AcûssP”missiÚ
(
lše_add»ss
);

469 ià(
acûss_³rm
 =ğ
AcûssP”missiÚ_Backšg_StÜe
) {

470 
D©aBlock
& 
block
 = 
m_abs_úŒl_vec
[
i
]->

471 
	`g‘D©aBlock
(
lše_add»ss
);

473 
	`DPRINTF
(
RubySy¡em
, "reading from %s block %s\n",

474 
m_abs_úŒl_vec
[
i
]->
	`Çme
(), 
block
);

475 
j
 = 0; j < 
size_š_by‹s
; ++j) {

476 
d©a
[
j
] = 
block
.
	`g‘By‹
(j + 
¡¬tBy‹
);

478  
Œue
;

481 } ià(
num_ro
 > 0 || 
num_rw
 == 1) {

486 
	`DPRINTF
(
RubySy¡em
, "num_busy = %d,‚um_ro = %d,‚um_rw = %d\n",

487 
num_busy
, 
num_ro
, 
num_rw
);

491 
i
 = 0;˜< 
num_cÚŒŞËrs
;++i) {

492 
acûss_³rm
 = 
m_abs_úŒl_vec
[
i
]->
	`g‘AcûssP”missiÚ
(
lše_add»ss
);

493 ià(
acûss_³rm
 =ğ
AcûssP”missiÚ_R—d_OÆy
 ||

494 
acûss_³rm
 =ğ
AcûssP”missiÚ_R—d_Wr™e
) {

495 
D©aBlock
& 
block
 = 
m_abs_úŒl_vec
[
i
]->

496 
	`g‘D©aBlock
(
lše_add»ss
);

498 
	`DPRINTF
(
RubySy¡em
, "reading from %s block %s\n",

499 
m_abs_úŒl_vec
[
i
]->
	`Çme
(), 
block
);

500 
j
 = 0; j < 
size_š_by‹s
; ++j) {

501 
d©a
[
j
] = 
block
.
	`g‘By‹
(j + 
¡¬tBy‹
);

503  
Œue
;

508  
çl£
;

509 
	}
}

515 
boŞ


516 
	gRubySy¡em
::
	$funùiÚ®Wr™e
(
Pack‘PŒ
 
pkt
)

518 
Add»ss
 
	`addr
(
pkt
->
	`g‘Addr
());

519 
Add»ss
 
lše_addr
 = 
	`lše_add»ss
(
addr
);

520 
AcûssP”missiÚ
 
acûss_³rm
 = 
AcûssP”missiÚ_NÙP»£Á
;

521 
num_cÚŒŞËrs
 = 
m_abs_úŒl_vec
.
	`size
();

523 
	`DPRINTF
(
RubySy¡em
, "FunùiÚ® Wr™»que¡ fÜ %s\n",
addr
);

525 
ušt8_t
 *
d©a
 = 
pkt
->
g‘PŒ
<ušt8_t>(
Œue
);

526 
size_š_by‹s
 = 
pkt
->
	`g‘Size
();

527 
¡¬tBy‹
 = 
addr
.
	`g‘Add»ss
(è- 
lše_addr
.getAddress();

529 
ušt32_t
 
M5_VAR_USED
 
num_funùiÚ®_wr™es
 = 0;

531 
i
 = 0; i < 
num_cÚŒŞËrs
;++i) {

532 
num_funùiÚ®_wr™es
 +=

533 
m_abs_úŒl_vec
[
i
]->
	`funùiÚ®Wr™eBufãrs
(
pkt
);

535 
acûss_³rm
 = 
m_abs_úŒl_vec
[
i
]->
	`g‘AcûssP”missiÚ
(
lše_addr
);

536 ià(
acûss_³rm
 !ğ
AcûssP”missiÚ_Inv®id
 &&

537 
acûss_³rm
 !ğ
AcûssP”missiÚ_NÙP»£Á
) {

539 
num_funùiÚ®_wr™es
++;

541 
D©aBlock
& 
block
 = 
m_abs_úŒl_vec
[
i
]->
	`g‘D©aBlock
(
lše_addr
);

542 
	`DPRINTF
(
RubySy¡em
, "%s\n",
block
);

543 
j
 = 0; j < 
size_š_by‹s
; ++j) {

544 
block
.
	`£tBy‹
(
j
 + 
¡¬tBy‹
, 
d©a
[j]);

546 
	`DPRINTF
(
RubySy¡em
, "%s\n",
block
);

550 
i
 = 0; i < 
m_memÜy_cÚŒŞËr_vec
.
	`size
() ;++i) {

551 
num_funùiÚ®_wr™es
 +=

552 
m_memÜy_cÚŒŞËr_vec
[
i
]->
	`funùiÚ®Wr™eBufãrs
(
pkt
);

555 
num_funùiÚ®_wr™es
 +ğ
m_ÃtwÜk_±r
->
	`funùiÚ®Wr™e
(
pkt
);

556 
	`DPRINTF
(
RubySy¡em
, "Mes§ge wr™‹Àğ%u\n", 
num_funùiÚ®_wr™es
);

558  
Œue
;

559 
	}
}

561 #ifdeà
CHECK_COHERENCE


571 
	gRubySy¡em
::
	$checkGlob®Coh”’ûInv¬ŸÁ
(cÚ¡ 
Add»ss
& 
addr
)

574 
NodeID
 
exşusive
 = -1;

575 
boŞ
 
sh¬edD‘eùed
 = 
çl£
;

576 
NodeID
 
Ï¡Sh¬ed
 = -1;

578 
i
 = 0; i < 
m_ch_veùÜ
.
	`size
(); i++) {

579 ià(
m_ch_veùÜ
[
i
]->
	`isBlockExşusive
(
addr
)) {

580 ià(
exşusive
 != -1) {

582 
	`WARN_EXPR
(
exşusive
);

583 
	`WARN_EXPR
(
m_ch_veùÜ
[
i
]->
	`g‘ID
());

584 
	`WARN_EXPR
(
addr
);

585 
	`WARN_EXPR
(
	`g‘Time
());

586 
	`ERROR_MSG
("Coherence Violation Detected -- 2ƒxclusive chips");

587 } ià(
sh¬edD‘eùed
) {

588 
	`WARN_EXPR
(
Ï¡Sh¬ed
);

589 
	`WARN_EXPR
(
m_ch_veùÜ
[
i
]->
	`g‘ID
());

590 
	`WARN_EXPR
(
addr
);

591 
	`WARN_EXPR
(
	`g‘Time
());

592 
	`ERROR_MSG
("Coherence Violation Detected --ƒxclusive chip with >=1 shared");

594 
exşusive
 = 
m_ch_veùÜ
[
i
]->
	`g‘ID
();

596 } ià(
m_ch_veùÜ
[
i
]->
	`isBlockSh¬ed
(
addr
)) {

597 
sh¬edD‘eùed
 = 
Œue
;

598 
Ï¡Sh¬ed
 = 
m_ch_veùÜ
[
i
]->
	`g‘ID
();

600 ià(
exşusive
 != -1) {

601 
	`WARN_EXPR
(
Ï¡Sh¬ed
);

602 
	`WARN_EXPR
(
exşusive
);

603 
	`WARN_EXPR
(
addr
);

604 
	`WARN_EXPR
(
	`g‘Time
());

605 
	`ERROR_MSG
("Coherence Violation Detected --ƒxclusive chip with >=1 shared");

610 
	}
}

613 
RubySy¡em
 *

614 
	gRubySy¡emP¬ams
::
	$ü—‹
()

616  
Ãw
 
	`RubySy¡em
(
this
);

617 
	}
}

624 
	gRubyDumpStsC®lback
::
	$´oûss
()

626 
ruby_sy¡em
->
	`´štSts
(*
os
);

627 
	}
}

	@ruby/system/System.hh

35 #iâdeà
__MEM_RUBY_SYSTEM_SYSTEM_HH__


36 
	#__MEM_RUBY_SYSTEM_SYSTEM_HH__


	)

38 
	~"ba£/ÿÎback.hh
"

39 
	~"ba£/ouut.hh
"

40 
	~"mem/·ck‘.hh
"

41 
	~"mem/ruby/commÚ/Glob®.hh
"

42 
	~"mem/ruby/»cÜd”/CacheRecÜd”.hh
"

43 
	~"mem/ruby/¦icc_š‹rçû/Ab¡¿ùCÚŒŞËr.hh
"

44 
	~"mem/ruby/sy¡em/MemÜyVeùÜ.hh
"

45 
	~"mem/ruby/sy¡em/S·r£MemÜy.hh
"

46 
	~"·¿ms/RubySy¡em.hh
"

47 
	~"sim/şocked_objeù.hh
"

49 
şass
 
	gN‘wÜk
;

50 
şass
 
	gProf”
;

51 
şass
 
	gMemÜyCÚŒŞ
;

53 şas 
	cRubySy¡em
 : 
public
 
ClockedObjeù


55 
public
:

56 şas 
	cRubyEv’t
 : 
public
 
Ev’t


58 
public
:

59 
RubyEv’t
(
RubySy¡em
* 
_ruby_sy¡em
)

61 
ruby_sy¡em
 = 
_ruby_sy¡em
;

63 
	m´iv©e
:

64 
´oûss
();

66 
RubySy¡em
* 
	mruby_sy¡em
;

69 
ä›nd
 
şass
 
	gRubyEv’t
;

71 
RubySy¡emP¬ams
 
	tP¬ams
;

72 
RubySy¡em
(cÚ¡ 
P¬ams
 *
p
);

73 ~
RubySy¡em
();

76 
	$g‘RªdomS“d
(è{  
m_¿ndom_£ed
; 
	}
}

77 
	$g‘Rªdomiz©iÚ
(è{  
m_¿ndomiz©iÚ
; 
	}
}

78 
ušt32_t
 
	$g‘BlockSizeBy‹s
(è{  
m_block_size_by‹s
; 
	}
}

79 
ušt32_t
 
	$g‘BlockSizeB™s
(è{  
m_block_size_b™s
; 
	}
}

80 
ušt64_t
 
	$g‘MemÜySizeBy‹s
(è{  
m_memÜy_size_by‹s
; 
	}
}

81 
ušt32_t
 
	$g‘MemÜySizeB™s
(è{  
m_memÜy_size_b™s
; 
	}
}

84 
N‘wÜk
*

85 
	$g‘N‘wÜk
()

87 
	`as£¹
(
m_ÃtwÜk_±r
 !ğ
NULL
);

88  
m_ÃtwÜk_±r
;

89 
	}
}

91 
Prof”
*

92 
	$g‘Prof”
()

94 
	`as£¹
(
m_´of”_±r
 !ğ
NULL
);

95  
m_´of”_±r
;

96 
	}
}

98 
MemÜyVeùÜ
*

99 
	$g‘MemÜyVeùÜ
()

101 
	`as£¹
(
m_mem_vec_±r
 !ğ
NULL
);

102  
m_mem_vec_±r
;

103 
	}
}

105 
´štSts
(
¡d
::
o¡»am
& 
out
);

106 
»£tSts
();

107 
´št
(
¡d
::
o¡»am
& 
out
) const;

109 
£rŸlize
(
¡d
::
o¡»am
 &
os
);

110 
un£rŸlize
(
Checkpošt
 *
ı
, cÚ¡ 
¡d
::
¡ršg
 &
£ùiÚ
);

111 
´oûss
();

112 
¡¬tup
();

113 
boŞ
 
funùiÚ®R—d
(
Pack‘
 *
±r
);

114 
boŞ
 
funùiÚ®Wr™e
(
Pack‘
 *
±r
);

116 
»gi¡”N‘wÜk
(
N‘wÜk
*);

117 
»gi¡”Prof”
(
Prof”
*);

118 
»gi¡”Ab¡¿ùCÚŒŞËr
(
Ab¡¿ùCÚŒŞËr
*);

119 
»gi¡”S·r£MemÜy
(
S·r£MemÜy
*);

120 
»gi¡”MemCÚŒŞËr
(
MemÜyCÚŒŞ
 *
mc
);

122 
boŞ
 
	$ev’tQueueEm±y
(è{  
ev’tq
->
	`em±y
(); 
	}
}

123 
	$’queueRubyEv’t
(
Tick
 
tick
)

125 
RubyEv’t
* 
e
 = 
Ãw
 
	`RubyEv’t
(
this
);

126 
	`scheduË
(
e
, 
tick
);

127 
	}
}

129 
	g´iv©e
:

131 
RubySy¡em
(cÚ¡ RubySy¡em& 
obj
);

132 
	gRubySy¡em
& 
	gİ”©Ü
=(cÚ¡ 
RubySy¡em
& 
obj
);

134 
»adCom´es£dT¿û
(
¡d
::
¡ršg
 
f’ame
,

135 
ušt8_t
 *&
¿w_d©a
,

136 
ušt64
& 
uncom´es£d_Œaû_size
);

137 
wr™eCom´es£dT¿û
(
ušt8_t
 *
¿w_d©a
, 
¡d
::
¡ršg
 
fe
,

138 
ušt64
 
uncom´es£d_Œaû_size
);

140 
	g´iv©e
:

142 
m_¿ndom_£ed
;

143 
boŞ
 
	gm_¿ndomiz©iÚ
;

144 
ušt32_t
 
	gm_block_size_by‹s
;

145 
ušt32_t
 
	gm_block_size_b™s
;

146 
ušt64_t
 
	gm_memÜy_size_by‹s
;

147 
ušt32_t
 
	gm_memÜy_size_b™s
;

149 
N‘wÜk
* 
	gm_ÃtwÜk_±r
;

150 
	g¡d
::
veùÜ
<
MemÜyCÚŒŞ
 *> 
m_memÜy_cÚŒŞËr_vec
;

151 
	g¡d
::
veùÜ
<
Ab¡¿ùCÚŒŞËr
 *> 
m_abs_úŒl_vec
;

153 
	gpublic
:

154 
Prof”
* 
m_´of”_±r
;

155 
MemÜyVeùÜ
* 
	gm_mem_vec_±r
;

156 
boŞ
 
	gm_w¬mup_’abËd
;

157 
boŞ
 
	gm_coŞdown_’abËd
;

158 
CacheRecÜd”
* 
	gm_ÿche_»cÜd”
;

159 
	g¡d
::
veùÜ
<
S·r£MemÜy
*> 
m_¥¬£_memÜy_veùÜ
;

162 
šlše
 
	g¡d
::
o¡»am
&

163 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gRubySy¡em
& 
	gobj
)

166 
	gout
 << 
	g¡d
::
æush
;

167  
	gout
;

170 şas 
	cRubyDumpStsC®lback
 : 
public
 
C®lback


172 
´iv©e
:

173 
¡d
::
o¡»am
 *
os
;

174 
RubySy¡em
 *
	mruby_sy¡em
;

176 
	mpublic
:

177 
vœtu®
 ~
	$RubyDumpStsC®lback
() {}

179 
	`RubyDumpStsC®lback
(cÚ¡ 
¡d
::
¡ršg
& 
_¡©s_f’ame
,

180 
RubySy¡em
 *
sy¡em
)

182 
os
 = 
simout
.
	`ü—‹
(
_¡©s_f’ame
);

183 
ruby_sy¡em
 = 
sy¡em
;

184 
	}
}

186 
´oûss
();

	@ruby/system/TBETable.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_TBETABLE_HH__


30 
	#__MEM_RUBY_SYSTEM_TBETABLE_HH__


	)

32 
	~<io¡»am
>

34 
	~"ba£/hashm­.hh
"

35 
	~"mem/ruby/commÚ/Add»ss.hh
"

37 
	g‹m¶©e
<
şass
 
	gENTRY
>

38 şas 
	cTBETabË


40 
	mpublic
:

41 
	$TBETabË
(
numb”_of_TBEs
)

42 : 
	$m_numb”_of_TBEs
(
numb”_of_TBEs
)

46 
boŞ
 
	$isP»£Á
(cÚ¡ 
Add»ss
& 
add»ss
) const;

47 
	`®loÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
);

48 
	`d—Îoÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
);

49 
boŞ


50 
	$¬eNSlÙsAvaabË
(
n
) const

52  (
m_numb”_of_TBEs
 - 
m_m­
.
	`size
()è>ğ
n
;

53 
	}
}

55 
ENTRY
* 
lookup
(cÚ¡ 
Add»ss
& 
add»ss
);

58 
´št
(
¡d
::
o¡»am
& 
out
) const;

60 
	g´iv©e
:

62 
TBETabË
(cÚ¡ TBETabË& 
obj
);

63 
	gTBETabË
& 
	gİ”©Ü
=(cÚ¡ 
TBETabË
& 
obj
);

66 
	gm5
::
hash_m­
<
Add»ss
, 
	gENTRY
> 
	gm_m­
;

68 
	g´iv©e
:

69 
m_numb”_of_TBEs
;

72 
	g‹m¶©e
<
şass
 
	gENTRY
>

73 
šlše
 
	g¡d
::
o¡»am
&

74 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gTBETabË
<
	gENTRY
>& 
	gobj
)

76 
	gobj
.
´št
(
out
);

77 
	gout
 << 
	g¡d
::
æush
;

78  
	gout
;

81 
	g‹m¶©e
<
şass
 
	gENTRY
>

82 
šlše
 
boŞ


83 
	gTBETabË
<
	gENTRY
>::
	$isP»£Á
(cÚ¡ 
Add»ss
& 
add»ss
) const

85 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

86 
	`as£¹
(
m_m­
.
	`size
(è<ğ
m_numb”_of_TBEs
);

87  !!
m_m­
.
	`couÁ
(
add»ss
);

88 
	}
}

90 
	g‹m¶©e
<
şass
 
	gENTRY
>

91 
šlše
 

92 
	gTBETabË
<
	gENTRY
>::
	$®loÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
)

94 
	`as£¹
(!
	`isP»£Á
(
add»ss
));

95 
	`as£¹
(
m_m­
.
	`size
(è< 
m_numb”_of_TBEs
);

96 
m_m­
[
add»ss
] = 
	`ENTRY
();

97 
	}
}

99 
	g‹m¶©e
<
şass
 
	gENTRY
>

100 
šlše
 

101 
	gTBETabË
<
	gENTRY
>::
	$d—Îoÿ‹
(cÚ¡ 
Add»ss
& 
add»ss
)

103 
	`as£¹
(
	`isP»£Á
(
add»ss
));

104 
	`as£¹
(
m_m­
.
	`size
() > 0);

105 
m_m­
.
	`”a£
(
add»ss
);

106 
	}
}

109 
	g‹m¶©e
<
şass
 
	gENTRY
>

110 
šlše
 
ENTRY
*

111 
	gTBETabË
<
	gENTRY
>::
	$lookup
(cÚ¡ 
Add»ss
& 
add»ss
)

113 if(
m_m­
.
	`fšd
(
add»ss
è!ğm_m­.
	`’d
()è &(m_m­.fšd×dd»ss)->
£cÚd
);

114  
NULL
;

115 
	}
}

118 
	g‹m¶©e
<
şass
 
	gENTRY
>

119 
šlše
 

120 
	gTBETabË
<
	gENTRY
>::
´št
(
¡d
::
o¡»am
& 
out
) const

	@ruby/system/TimerTable.cc

29 
	~"mem/ruby/commÚ/Glob®.hh
"

30 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

31 
	~"mem/ruby/sy¡em/Tim”TabË.hh
"

33 
	gTim”TabË
::
	$Tim”TabË
()

34 : 
	$m_Ãxt_time
(0)

36 
m_cÚsum”_±r
 = 
NULL
;

37 
m_şockobj_±r
 = 
NULL
;

39 
m_Ãxt_v®id
 = 
çl£
;

40 
m_Ãxt_add»ss
 = 
	`Add»ss
(0);

41 
	}
}

43 
boŞ


44 
	gTim”TabË
::
	$isR—dy
() const

46 ià(
m_m­
.
	`em±y
())

47  
çl£
;

49 ià(!
m_Ãxt_v®id
) {

50 
	`upd©eNext
();

52 
	`as£¹
(
m_Ãxt_v®id
);

53  (
m_şockobj_±r
->
	`curCyşe
(è>ğ
m_Ãxt_time
);

54 
	}
}

56 cÚ¡ 
	gAdd»ss
&

57 
	gTim”TabË
::
	$»adyAdd»ss
() const

59 
	`as£¹
(
	`isR—dy
());

61 ià(!
m_Ãxt_v®id
) {

62 
	`upd©eNext
();

64 
	`as£¹
(
m_Ãxt_v®id
);

65  
m_Ãxt_add»ss
;

66 
	}
}

69 
	gTim”TabË
::
	$£t
(cÚ¡ 
Add»ss
& 
add»ss
, 
Cyşes
 
»Ïtive_Ï‹ncy
)

71 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

72 
	`as£¹
(
»Ïtive_Ï‹ncy
 > 0);

73 
	`as£¹
(!
m_m­
.
	`couÁ
(
add»ss
));

75 
Cyşes
 
»ady_time
 = 
m_şockobj_±r
->
	`curCyşe
(è+ 
»Ïtive_Ï‹ncy
;

76 
m_m­
[
add»ss
] = 
»ady_time
;

77 
	`as£¹
(
m_cÚsum”_±r
 !ğ
NULL
);

78 
m_cÚsum”_±r
->

79 
	`scheduËEv’tAbsŞu‹
(
m_şockobj_±r
->
	`şockP”iod
(è* 
»ady_time
);

80 
m_Ãxt_v®id
 = 
çl£
;

83 ià(
»ady_time
 <ğ
m_Ãxt_time
) {

84 
m_Ãxt_v®id
 = 
çl£
;

86 
	}
}

89 
	gTim”TabË
::
	$un£t
(cÚ¡ 
Add»ss
& 
add»ss
)

91 
	`as£¹
(
add»ss
 =ğ
	`lše_add»ss
(address));

92 
	`as£¹
(
m_m­
.
	`couÁ
(
add»ss
));

93 
m_m­
.
	`”a£
(
add»ss
);

96 ià(
add»ss
 =ğ
m_Ãxt_add»ss
) {

97 
m_Ãxt_v®id
 = 
çl£
;

99 
	}
}

102 
	gTim”TabË
::
´št
(
¡d
::
o¡»am
& 
out
) const

107 
Tim”TabË
::
	$upd©eNext
() const

109 ià(
m_m­
.
	`em±y
()) {

110 
	`as£¹
(!
m_Ãxt_v®id
);

114 
Add»ssM­
::
cÚ¡_™”©Ü
 
i
 = 
m_m­
.
	`begš
();

115 
Add»ssM­
::
cÚ¡_™”©Ü
 
’d
 = 
m_m­
.
	`’d
();

117 
m_Ãxt_add»ss
 = 
i
->
fœ¡
;

118 
m_Ãxt_time
 = 
i
->
£cÚd
;

119 ++
i
;

121 ; 
i
 !ğ
’d
; ++i) {

122 ià(
i
->
£cÚd
 < 
m_Ãxt_time
) {

123 
m_Ãxt_add»ss
 = 
i
->
fœ¡
;

124 
m_Ãxt_time
 = 
i
->
£cÚd
;

128 
m_Ãxt_v®id
 = 
Œue
;

129 
	}
}

	@ruby/system/TimerTable.hh

29 #iâdeà
__MEM_RUBY_SYSTEM_TIMERTABLE_HH__


30 
	#__MEM_RUBY_SYSTEM_TIMERTABLE_HH__


	)

32 
	~<ÿs£¹
>

33 
	~<io¡»am
>

34 
	~<m­
>

35 
	~<¡ršg
>

37 
	~"mem/ruby/commÚ/Add»ss.hh
"

38 
	~"mem/ruby/commÚ/CÚsum”.hh
"

40 şas 
	cTim”TabË


42 
	mpublic
:

43 
Tim”TabË
();

46 
	$£tCÚsum”
(
CÚsum”
* 
cÚsum”_±r
)

48 
	`as£¹
(
m_cÚsum”_±r
 =ğ
NULL
);

49 
m_cÚsum”_±r
 = 
cÚsum”_±r
;

52 
	$£tClockObj
(
ClockedObjeù
* 
obj
)

54 
	`as£¹
(
m_şockobj_±r
 =ğ
NULL
);

55 
m_şockobj_±r
 = 
obj
;

56 
	}
}

59 
£tDesütiÚ
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
)

61 
m_Çme
 = 
Çme
;

64 
boŞ
 
	$isR—dy
() const;

65 cÚ¡ 
Add»ss
& 
	$»adyAdd»ss
() const;

66 
boŞ
 
	$isS‘
(cÚ¡ 
Add»ss
& 
add»ss
ècÚ¡ {  !!
m_m­
.
	`couÁ
×dd»ss); 
	}
}

67 
£t
(cÚ¡ 
Add»ss
& 
add»ss
, 
Cyşes
 
»Ïtive_Ï‹ncy
);

68 
	$£t
(cÚ¡ 
Add»ss
& 
add»ss
, 
ušt64_t
 
»Ïtive_Ï‹ncy
)

69 { 
	`£t
(
add»ss
, 
	`Cyşes
(
»Ïtive_Ï‹ncy
)); 
	}
}

71 
un£t
(cÚ¡ 
Add»ss
& 
add»ss
);

72 
´št
(
¡d
::
o¡»am
& 
out
) const;

74 
	g´iv©e
:

75 
	$upd©eNext
() const;

78 
	`Tim”TabË
(cÚ¡ 
Tim”TabË
& 
obj
);

79 
Tim”TabË
& 
İ”©Ü
=(cÚ¡ Tim”TabË& 
obj
);

85 
¡d
::
	tm­
<
	tAdd»ss
, 
	tCyşes
> 
	tAdd»ssM­
;

86 
Add»ssM­
 
m_m­
;

87 
mubË
 
boŞ
 
m_Ãxt_v®id
;

88 
mubË
 
Cyşes
 
m_Ãxt_time
;

89 
mubË
 
Add»ss
 
m_Ãxt_add»ss
;

92 
ClockedObjeù
* 
m_şockobj_±r
;

94 
CÚsum”
* 
m_cÚsum”_±r
;

96 
¡d
::
¡ršg
 
m_Çme
;

97 
	}
};

99 
šlše
 
	g¡d
::
o¡»am
&

100 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gTim”TabË
& 
	gobj
)

102 
	gobj
.
´št
(
out
);

103 
	gout
 << 
	g¡d
::
æush
;

104  
	gout
;

	@ruby/system/WireBuffer.cc

32 
	~<®gÜ™hm
>

33 
	~<funùiÚ®
>

35 
	~"ba£/ırštf.hh
"

36 
	~"ba£/¡l_h–³rs.hh
"

37 
	~"mem/ruby/commÚ/Glob®.hh
"

38 
	~"mem/ruby/sy¡em/Sy¡em.hh
"

39 
	~"mem/ruby/sy¡em/WœeBufãr.hh
"

41 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	go¡»am
&

46 
	gİ”©Ü
<<(
	go¡»am
& 
	gout
, cÚ¡ 
	gWœeBufãr
& 
	gobj
)

48 
	gobj
.
´št
(
out
);

49 
	gout
 << 
	gæush
;

50  
	gout
;

57 
	gWœeBufãr
::
	$WœeBufãr
(cÚ¡ 
P¬ams
 *
p
)

58 : 
	$SimObjeù
(
p
)

60 
m_msg_couÁ”
 = 0;

61 
	}
}

64 
	gWœeBufãr
::
	$š™
()

66 
	}
}

68 
WœeBufãr
::~
	$WœeBufãr
()

70 
	}
}

73 
WœeBufãr
::
	$’queue
(
MsgPŒ
 
mes§ge
, 
Cyşes
 
Ï‹ncy
)

75 
m_msg_couÁ”
++;

76 
Cyşes
 
cu¼’t_time
 = 
g_sy¡em_±r
->
	`curCyşe
();

77 
Cyşes
 
¬riv®_time
 = 
cu¼’t_time
 + 
Ï‹ncy
;

78 
	`as£¹
(
¬riv®_time
 > 
cu¼’t_time
);

80 
Mes§geBufãrNode
 
	`thisNode
(
¬riv®_time
, 
m_msg_couÁ”
, 
mes§ge
);

81 
m_mes§ge_queue
.
	`push_back
(
thisNode
);

82 ià(
m_cÚsum”_±r
 !ğ
NULL
) {

83 
m_cÚsum”_±r
->

84 
	`scheduËEv’tAbsŞu‹
(
g_sy¡em_±r
->
	`şockP”iod
(è* 
¬riv®_time
);

86 
	`·nic
("NØCÚsum” fÜ WœeBufãr! %s\n", *
this
);

88 
	}
}

91 
	gWœeBufãr
::
	$dequeue
()

93 
	`as£¹
(
	`isR—dy
());

94 
	`pİ_h—p
(
m_mes§ge_queue
.
	`begš
(), m_mes§ge_queue.
	`’d
(),

95 
g»©”
<
Mes§geBufãrNode
>());

96 
m_mes§ge_queue
.
	`pİ_back
();

97 
	}
}

99 cÚ¡ 
Mes§ge
*

100 
	gWœeBufãr
::
	$³ek
()

102 
Mes§geBufãrNode
 
node
 = 
	`³ekNode
();

103 
Mes§ge
* 
msg_±r
 = 
node
.
m_msg±r
.
	`g‘
();

104 
	`as£¹
(
msg_±r
 !ğ
NULL
);

105  
msg_±r
;

106 
	}
}

108 
Mes§geBufãrNode


109 
	gWœeBufãr
::
	$³ekNode
()

111 
	`as£¹
(
	`isR—dy
());

112 
Mes§geBufãrNode
 
»q
 = 
m_mes§ge_queue
.
	`äÚt
();

113  
»q
;

114 
	}
}

117 
	gWœeBufãr
::
	$»cyşe
()

123 
	`as£¹
(
	`isR—dy
());

124 
Mes§geBufãrNode
 
node
 = 
m_mes§ge_queue
.
	`äÚt
();

125 
	`pİ_h—p
(
m_mes§ge_queue
.
	`begš
(), m_mes§ge_queue.
	`’d
(),

126 
g»©”
<
Mes§geBufãrNode
>());

128 
node
.
m_time
 = 
g_sy¡em_±r
->
	`curCyşe
(è+ 
	`Cyşes
(1);

129 
m_mes§ge_queue
.
	`back
(èğ
node
;

130 
	`push_h—p
(
m_mes§ge_queue
.
	`begš
(), m_mes§ge_queue.
	`’d
(),

131 
g»©”
<
Mes§geBufãrNode
>());

132 
m_cÚsum”_±r
->

133 
	`scheduËEv’tAbsŞu‹
(
g_sy¡em_±r
->
	`şockP”iod
(è* 
node
.
m_time
);

134 
	}
}

136 
boŞ


137 
	gWœeBufãr
::
	$isR—dy
()

139  ((!
m_mes§ge_queue
.
	`em±y
()) &&

140 (
m_mes§ge_queue
.
	`äÚt
().
m_time
 <ğ
g_sy¡em_±r
->
	`curCyşe
()));

141 
	}
}

144 
	gWœeBufãr
::
	$´št
(
o¡»am
& 
out
) const

146 
	}
}

149 
WœeBufãr
::
	$ş—rSts
() const

151 
	}
}

154 
WœeBufãr
::
	$´štSts
(
o¡»am
& 
out
) const

156 
	}
}

159 
WœeBufãr
::
	$wakeup
()

161 
	}
}

163 
WœeBufãr
 *

164 
RubyWœeBufãrP¬ams
::
	$ü—‹
()

166  
Ãw
 
	`WœeBufãr
(
this
);

167 
	}
}

	@ruby/system/WireBuffer.hh

32 #iâdeà
__MEM_RUBY_SYSTEM_WIREBUFFER_HH__


33 
	#__MEM_RUBY_SYSTEM_WIREBUFFER_HH__


	)

35 
	~<io¡»am
>

36 
	~<¡ršg
>

37 
	~<veùÜ
>

39 
	~"mem/ruby/bufãrs/Mes§geBufãrNode.hh
"

40 
	~"mem/ruby/commÚ/CÚsum”.hh
"

41 
	~"·¿ms/RubyWœeBufãr.hh
"

42 
	~"sim/sim_objeù.hh
"

54 
şass
 
	gMes§ge
;

56 şas 
	cWœeBufãr
 : 
public
 
SimObjeù


58 
public
:

59 
RubyWœeBufãrP¬ams
 
	tP¬ams
;

60 
WœeBufãr
(cÚ¡ 
P¬ams
 *
p
);

61 
š™
();

63 ~
WœeBufãr
();

65 
wakeup
();

67 
	$£tCÚsum”
(
CÚsum”
* 
cÚsum”_±r
)

69 
m_cÚsum”_±r
 = 
cÚsum”_±r
;

71 
CÚsum”
* 
	$g‘CÚsum”
(è{  
m_cÚsum”_±r
; 
	}
};

72 
£tDesütiÚ
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
è{ 
m_desütiÚ
 =‚ame; };

73 
	g¡d
::
¡ršg
 
	$g‘DesütiÚ
(è{  
m_desütiÚ
; 
	}
};

75 
’queue
(
MsgPŒ
 
mes§ge
, 
Cyşes
 
Ï‹ncy
);

76 
dequeue
();

77 cÚ¡ 
Mes§ge
* 
³ek
();

78 
Mes§geBufãrNode
 
³ekNode
();

79 
»cyşe
();

80 
boŞ
 
isR—dy
();

81 
boŞ
 
	$¬eNSlÙsAvaabË
(
n
è{  
Œue
; 
	}
};

83 
´št
(
¡d
::
o¡»am
& 
out
) const;

84 
	$ş—rSts
() const;

85 
	`´štSts
(
¡d
::
o¡»am
& 
out
) const;

87 
ušt64_t
 
m_msg_couÁ”
;

89 
´iv©e
:

91 
	`WœeBufãr
 (cÚ¡ 
WœeBufãr
& 
obj
);

92 
WœeBufãr
& 
İ”©Ü
=(cÚ¡ WœeBufãr& 
obj
);

95 
CÚsum”
* 
m_cÚsum”_±r
;

96 
¡d
::
¡ršg
 
m_desütiÚ
;

99 
¡d
::
veùÜ
<
Mes§geBufãrNode
> 
m_mes§ge_queue
;

101 
	}
};

103 
	g¡d
::
o¡»am
& 
İ”©Ü
<<(
¡d
::o¡»am& 
out
, cÚ¡ 
	gWœeBufãr
& 
	gobj
);

	@se_translating_port_proxy.cc

45 
	~<¡ršg
>

47 
	~"¬ch/i§_Œa™s.hh
"

48 
	~"ba£/chunk_g’”©Ü.hh
"

49 
	~"cÚfig/the_i§.hh
"

50 
	~"mem/·ge_bË.hh
"

51 
	~"mem/£_Œª¦©šg_pÜt_´oxy.hh
"

52 
	~"sim/´oûss.hh
"

53 
	~"sim/sy¡em.hh
"

55 
usšg
 
Çme¥aû
 
	gTheISA
;

57 
	gSET¿n¦©šgPÜtProxy
::
	$SET¿n¦©šgPÜtProxy
(
Ma¡”PÜt
& 
pÜt
, 
Proûss
 *
p
,

58 
AÎocTy³
 
®loc
)

59 : 
	`PÜtProxy
(
pÜt
, 
p
->
sy¡em
->
	`ÿcheLšeSize
()), 
	`pTabË
Õ->
pTabË
),

60 
	`´oûss
(
p
), 
	$®loÿtšg
(
®loc
)

61 { 
	}
}

63 
	gSET¿n¦©šgPÜtProxy
::~
	$SET¿n¦©šgPÜtProxy
()

64 { 
	}
}

66 
boŞ


67 
SET¿n¦©šgPÜtProxy
::
	$ŒyR—dBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const

69 
´evSize
 = 0;

71 
ChunkG’”©Ü
 
	`g’
(
addr
, 
size
, 
VMPageSize
); !
g’
.
	`dÚe
(); g’.
	`Ãxt
()) {

72 
Addr
 
·ddr
;

74 ià(!
pTabË
->
	`Œª¦©e
(
g’
.
	`addr
(),
·ddr
))

75  
çl£
;

77 
PÜtProxy
::
	`»adBlob
(
·ddr
, 
p
 + 
´evSize
, 
g’
.
	`size
());

78 
´evSize
 +ğ
g’
.
	`size
();

81  
Œue
;

82 
	}
}

85 
	gSET¿n¦©šgPÜtProxy
::
	$»adBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const

87 ià(!
	`ŒyR—dBlob
(
addr
, 
p
, 
size
))

88 
	`çl
("»adBlob(0x%x, ...èçed", 
addr
);

89 
	}
}

92 
boŞ


93 
	gSET¿n¦©šgPÜtProxy
::
	$ŒyWr™eBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const

95 
´evSize
 = 0;

97 
ChunkG’”©Ü
 
	`g’
(
addr
, 
size
, 
VMPageSize
); !
g’
.
	`dÚe
(); g’.
	`Ãxt
()) {

98 
Addr
 
·ddr
;

100 ià(!
pTabË
->
	`Œª¦©e
(
g’
.
	`addr
(), 
·ddr
)) {

101 ià(
®loÿtšg
 =ğ
Always
) {

102 
´oûss
->
	`®loÿ‹Mem
(
	`roundDown
(
g’
.
	`addr
(), 
VMPageSize
),

103 
VMPageSize
);

104 } ià(
®loÿtšg
 =ğ
NextPage
) {

106 ià(!
´oûss
->
	`fixupSckFauÉ
(
g’
.
	`addr
()))

107 
	`·nic
("Pageable fault when‡ccessing virtual‡ddress %#x "

108 "duršg funùiÚ® wr™e\n", 
g’
.
	`addr
());

110  
çl£
;

112 
pTabË
->
	`Œª¦©e
(
g’
.
	`addr
(), 
·ddr
);

115 
PÜtProxy
::
	`wr™eBlob
(
·ddr
, 
p
 + 
´evSize
, 
g’
.
	`size
());

116 
´evSize
 +ğ
g’
.
	`size
();

119  
Œue
;

120 
	}
}

124 
	gSET¿n¦©šgPÜtProxy
::
	$wr™eBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const

126 ià(!
	`ŒyWr™eBlob
(
addr
, 
p
, 
size
))

127 
	`çl
("wr™eBlob(0x%x, ...èçed", 
addr
);

128 
	}
}

130 
boŞ


131 
	gSET¿n¦©šgPÜtProxy
::
	$ŒyMem£tBlob
(
Addr
 
addr
, 
ušt8_t
 
v®
, 
size
) const

133 
ChunkG’”©Ü
 
	`g’
(
addr
, 
size
, 
VMPageSize
); !
g’
.
	`dÚe
(); g’.
	`Ãxt
()) {

134 
Addr
 
·ddr
;

136 ià(!
pTabË
->
	`Œª¦©e
(
g’
.
	`addr
(), 
·ddr
)) {

137 ià(
®loÿtšg
 =ğ
Always
) {

138 
´oûss
->
	`®loÿ‹Mem
(
	`roundDown
(
g’
.
	`addr
(), 
VMPageSize
),

139 
VMPageSize
);

140 
pTabË
->
	`Œª¦©e
(
g’
.
	`addr
(), 
·ddr
);

142  
çl£
;

146 
PÜtProxy
::
	`mem£tBlob
(
·ddr
, 
v®
, 
g’
.
	`size
());

149  
Œue
;

150 
	}
}

153 
	gSET¿n¦©šgPÜtProxy
::
	$mem£tBlob
(
Addr
 
addr
, 
ušt8_t
 
v®
, 
size
) const

155 ià(!
	`ŒyMem£tBlob
(
addr
, 
v®
, 
size
))

156 
	`çl
("mem£tBlob(0x%x, ...èçed", 
addr
);

157 
	}
}

160 
boŞ


161 
	gSET¿n¦©šgPÜtProxy
::
	$ŒyWr™eSŒšg
(
Addr
 
addr
, cÚ¡ *
¡r
) const

163 
ušt8_t
 
c
;

165 
Addr
 
vaddr
 = 
addr
;

168 
c
 = *
¡r
++;

169 
Addr
 
·ddr
;

171 ià(!
pTabË
->
	`Œª¦©e
(
vaddr
++, 
·ddr
))

172  
çl£
;

174 
PÜtProxy
::
	`wr™eBlob
(
·ddr
, &
c
, 1);

175 } 
c
);

177  
Œue
;

178 
	}
}

181 
	gSET¿n¦©šgPÜtProxy
::
	$wr™eSŒšg
(
Addr
 
addr
, cÚ¡ *
¡r
) const

183 ià(!
	`ŒyWr™eSŒšg
(
addr
, 
¡r
))

184 
	`çl
("wr™eSŒšg(0x%x, ...èçed", 
addr
);

185 
	}
}

187 
boŞ


188 
	gSET¿n¦©šgPÜtProxy
::
ŒyR—dSŒšg
(
¡d
::
¡ršg
 &
¡r
, 
Addr
 
addr
) const

190 
ušt8_t
 
	gc
;

192 
Addr
 
	gvaddr
 = 
addr
;

194 
	gŒue
) {

195 
Addr
 
	g·ddr
;

197 ià(!
	gpTabË
->
Œª¦©e
(
vaddr
++, 
·ddr
))

198  
	gçl£
;

200 
	gPÜtProxy
::
»adBlob
(
·ddr
, &
c
, 1);

201 ià(
	gc
 == '\0')

204 
	g¡r
 +ğ
c
;

207  
	gŒue
;

211 
	gSET¿n¦©šgPÜtProxy
::
»adSŒšg
(
¡d
::
¡ršg
 &
¡r
, 
Addr
 
addr
) const

213 ià(!
ŒyR—dSŒšg
(
¡r
, 
addr
))

214 
çl
("»adSŒšg(0x%x, ...èçed", 
addr
);

	@se_translating_port_proxy.hh

45 #iâdeà
__MEM_SE_TRANSLATING_PORT_PROXY_HH__


46 
	#__MEM_SE_TRANSLATING_PORT_PROXY_HH__


	)

48 
	~"mem/·ge_bË.hh
"

49 
	~"mem/pÜt_´oxy.hh
"

51 
şass
 
	gProûss
;

67 şas 
	cSET¿n¦©šgPÜtProxy
 : 
public
 
PÜtProxy


70 
public
:

71 
	eAÎocTy³
 {

72 
Always
,

73 
	mNev”
,

74 
	mNextPage


77 
	g´iv©e
:

78 
PageTabË
 *
pTabË
;

79 
Proûss
 *
	g´oûss
;

80 
AÎocTy³
 
	g®loÿtšg
;

82 
	gpublic
:

83 
SET¿n¦©šgPÜtProxy
(
Ma¡”PÜt
& 
pÜt
, 
Proûss
* 
p
, 
AÎocTy³
 
®loc
);

84 
	gvœtu®
 ~
SET¿n¦©šgPÜtProxy
();

86 
boŞ
 
	$ŒyR—dBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const;

87 
boŞ
 
	$ŒyWr™eBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const;

88 
boŞ
 
	$ŒyMem£tBlob
(
Addr
 
addr
, 
ušt8_t
 
v®
, 
size
) const;

89 
boŞ
 
	$ŒyWr™eSŒšg
(
Addr
 
addr
, cÚ¡ *
¡r
) const;

90 
boŞ
 
	`ŒyR—dSŒšg
(
¡d
::
¡ršg
 &
¡r
, 
Addr
 
addr
) const;

92 
vœtu®
 
	$»adBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const;

93 
vœtu®
 
	$wr™eBlob
(
Addr
 
addr
, 
ušt8_t
 *
p
, 
size
) const;

94 
vœtu®
 
	$mem£tBlob
(
Addr
 
addr
, 
ušt8_t
 
v®
, 
size
) const;

96 
	$wr™eSŒšg
(
Addr
 
addr
, cÚ¡ *
¡r
) const;

97 
	`»adSŒšg
(
¡d
::
¡ršg
 &
¡r
, 
Addr
 
addr
) const;

98 
	}
};

	@simple_dram.cc

45 
	~"ba£/Œaû.hh
"

46 
	~"ba£/b™f›ld.hh
"

47 
	~"debug/D¿š.hh
"

48 
	~"debug/DRAM.hh
"

49 
	~"mem/sim¶e_d¿m.hh
"

50 
	~"sim/sy¡em.hh
"

52 
usšg
 
Çme¥aû
 
	g¡d
;

54 
	gSim¶eDRAM
::
	$Sim¶eDRAM
(cÚ¡ 
Sim¶eDRAMP¬ams
* 
p
) :

55 
	`Ab¡¿ùMemÜy
(
p
),

56 
	`pÜt
(
	`Çme
(è+ ".pÜt", *
this
),

57 
	`»ŒyRdReq
(
çl£
), 
	`»ŒyWrReq
(false),

58 
	`rowH™FÏg
(
çl£
), 
	`¡İR—ds
(false),

59 
	`wr™eEv’t
(
this
), 
	`»¥ÚdEv’t
(this),

60 
	`»äeshEv’t
(
this
), 
	`ÃxtReqEv’t
Ñhis), 
	`d¿šMªag”
(
NULL
),

61 
	`deviûBusWidth
(
p
->
deviû_bus_width
), 
	`bur¡L’gth
Õ->
bur¡_Ëngth
),

62 
	`deviûRowBufãrSize
(
p
->
deviû_rowbufãr_size
),

63 
	`deviûsP”Rªk
(
p
->
deviûs_³r_¿nk
),

64 
	`bur¡Size
((
deviûsP”Rªk
 * 
bur¡L’gth
 * 
deviûBusWidth
) / 8),

65 
	`rowBufãrSize
(
deviûsP”Rªk
 * 
deviûRowBufãrSize
),

66 
	`¿nksP”ChªÃl
(
p
->
¿nks_³r_chªÃl
),

67 
	`bªksP”Rªk
(
p
->
bªks_³r_¿nk
), 
	`chªÃls
Õ->
chªÃls
), 
	`rowsP”Bªk
(0),

68 
	`»adBufãrSize
(
p
->
»ad_bufãr_size
),

69 
	`wr™eBufãrSize
(
p
->
wr™e_bufãr_size
),

70 
	`wr™eHighTh»shŞdP”c
(
p
->
wr™e_high_th»sh_³rc
),

71 
	`wr™eLowTh»shŞdP”c
(
p
->
wr™e_low_th»sh_³rc
),

72 
	`tWTR
(
p
->
tWTR
), 
	`tBURST
Õ->
tBURST
),

73 
	`tRCD
(
p
->
tRCD
), 
	`tCL
Õ->
tCL
), 
	`tRP
Õ->
tRP
), 
	`tRAS
Õ->
tRAS
),

74 
	`tRFC
(
p
->
tRFC
), 
	`tREFI
Õ->
tREFI
), 
	`tRRD
Õ->
tRRD
),

75 
	`tXAW
(
p
->
tXAW
), 
	`aùiv©iÚLim™
Õ->
aùiv©iÚ_lim™
),

76 
	`memSchedPŞicy
(
p
->
mem_sched_pŞicy
), 
	`addrM­pšg
Õ->
addr_m­pšg
),

77 
	`·geMgmt
(
p
->
·ge_pŞicy
),

78 
	`äÚ‹ndL©’cy
(
p
->
¡©ic_äÚ‹nd_Ï‹ncy
),

79 
	`back’dL©’cy
(
p
->
¡©ic_back’d_Ï‹ncy
),

80 
	`busBusyUÁ
(0), 
	`wr™eS¹Time
(0),

81 
	`´evA¼iv®
(0), 
	`numReqs
(0),

82 
	`numWr™esThisTime
(0), 
	`ÃwTime
(0),

83 
	`¡¬tTickP»ch¬geAÎ
(0), 
	$numBªksAùive
(0)

87 
bªks
.
	`»size
(
¿nksP”ChªÃl
);

88 
aùTicks
.
	`»size
(
¿nksP”ChªÃl
);

89 
size_t
 
c
 = 0; c < 
¿nksP”ChªÃl
; ++c) {

90 
bªks
[
c
].
	`»size
(
bªksP”Rªk
);

91 
aùTicks
[
c
].
	`»size
(
aùiv©iÚLim™
, 0);

96 
wr™eHighTh»shŞd
 = 
wr™eBufãrSize
 * 
wr™eHighTh»shŞdP”c
 / 100.0;

97 
wr™eLowTh»shŞd
 = 
wr™eBufãrSize
 * 
wr™eLowTh»shŞdP”c
 / 100.0;

98 
	}
}

101 
	gSim¶eDRAM
::
	$š™
()

103 ià(!
pÜt
.
	`isCÚÃùed
()) {

104 
	`çl
("Sim¶eDRAM % i uncÚÃùed!\n", 
	`Çme
());

106 
pÜt
.
	`£ndRªgeChªge
();

111 
	`DPRINTF
(
DRAM
, "Bur¡ siz%d by‹s\n", 
bur¡Size
);

114 
ušt64_t
 
ÿ·c™y
 = 
	`ULL
(1è<< 
	`ûLog2
(
Ab¡¿ùMemÜy
::
	`size
());

116 
	`DPRINTF
(
DRAM
, "MemÜy c­ac™y %Îd (%Îdèby‹s\n", 
ÿ·c™y
,

117 
Ab¡¿ùMemÜy
::
	`size
());

119 
cŞumnsP”RowBufãr
 = 
rowBufãrSize
 / 
bur¡Size
;

121 
	`DPRINTF
(
DRAM
, "Row buffer size %d bytes with %d columns…er„ow buffer\n",

122 
rowBufãrSize
, 
cŞumnsP”RowBufãr
);

124 
rowsP”Bªk
 = 
ÿ·c™y
 / (
rowBufãrSize
 * 
bªksP”Rªk
 * 
¿nksP”ChªÃl
);

126 ià(
¿nge
.
	`š‹¾—ved
()) {

127 ià(
chªÃls
 !ğ
¿nge
.
	`¡res
())

128 
	`·nic
("%s has %d interleaved‡ddress stripes but %d channel(s)\n",

129 
	`Çme
(), 
¿nge
.
	`¡res
(), 
chªÃls
);

131 ià(
addrM­pšg
 =ğ
Enums
::
RaBaChCo
) {

132 ià(
rowBufãrSize
 !ğ
¿nge
.
	`g¿nuÏr™y
()) {

133 
	`·nic
("Interleaving of %s doesn't match RaBaChCo‡ddress map\n",

134 
	`Çme
());

136 } ià(
addrM­pšg
 =ğ
Enums
::
RaBaCoCh
) {

137 ià(
bur¡Size
 !ğ
¿nge
.
	`g¿nuÏr™y
()) {

138 
	`·nic
("Interleaving of %s doesn't match RaBaCoCh‡ddress map\n",

139 
	`Çme
());

141 } ià(
addrM­pšg
 =ğ
Enums
::
CoRaBaCh
) {

142 ià(
bur¡Size
 !ğ
¿nge
.
	`g¿nuÏr™y
())

143 
	`·nic
("Interleaving of %s doesn't match CoRaBaCh‡ddress map\n",

144 
	`Çme
());

147 
	}
}

150 
	gSim¶eDRAM
::
	$¡¬tup
()

153 
	`´štP¬ams
();

156 
	`scheduË
(
»äeshEv’t
, 
	`curTick
(è+ 
tREFI
);

157 
	}
}

159 
Tick


160 
	gSim¶eDRAM
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

162 
	`DPRINTF
(
DRAM
, "»cvAtomic: % 0x%x\n", 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
());

165 
	`acûss
(
pkt
);

167 
Tick
 
Ï‹ncy
 = 0;

168 ià(!
pkt
->
	`memInhib™As£¹ed
(è&&…kt->
	`hasD©a
()) {

171 
Ï‹ncy
 = 
tRP
 + 
tRCD
 + 
tCL
;

173  
Ï‹ncy
;

174 
	}
}

176 
boŞ


177 
	gSim¶eDRAM
::
	$»adQueueFuÎ
(
ÃededEÁr›s
) const

179 
	`DPRINTF
(
DRAM
, "Read queue†imit %d, current size %d,ƒntries‚eeded %d\n",

180 
»adBufãrSize
, 
»adQueue
.
	`size
(è+ 
»¥Queue
.size(),

181 
ÃededEÁr›s
);

184 (
»adQueue
.
	`size
(è+ 
»¥Queue
.size(è+ 
ÃededEÁr›s
è> 
»adBufãrSize
;

185 
	}
}

187 
boŞ


188 
	gSim¶eDRAM
::
	$wr™eQueueFuÎ
(
ÃededEÁr›s
) const

190 
	`DPRINTF
(
DRAM
, "Write queue†imit %d, current size %d,ƒntries‚eeded %d\n",

191 
wr™eBufãrSize
, 
wr™eQueue
.
	`size
(), 
ÃededEÁr›s
);

192  (
wr™eQueue
.
	`size
(è+ 
ÃededEÁr›s
è> 
wr™eBufãrSize
;

193 
	}
}

195 
	gSim¶eDRAM
::
DRAMPack‘
*

196 
Sim¶eDRAM
::
	$decodeAddr
(
Pack‘PŒ
 
pkt
, 
Addr
 
d¿mPktAddr
, 
size
, 
boŞ
 
isR—d
)

201 
ušt8_t
 
¿nk
;

202 
ušt8_t
 
bªk
;

203 
ušt16_t
 
row
;

206 
Addr
 
addr
 = 
d¿mPktAddr
 / 
bur¡Size
;

210 ià(
addrM­pšg
 =ğ
Enums
::
RaBaChCo
) {

213 
addr
 =‡dd¸/ 
cŞumnsP”RowBufãr
;

216 
addr
 =‡dd¸/ 
chªÃls
;

220 
bªk
 = 
addr
 % 
bªksP”Rªk
;

221 
addr
 =‡dd¸/ 
bªksP”Rªk
;

225 
¿nk
 = 
addr
 % 
¿nksP”ChªÃl
;

226 
addr
 =‡dd¸/ 
¿nksP”ChªÃl
;

229 
row
 = 
addr
 % 
rowsP”Bªk
;

230 
addr
 =‡dd¸/ 
rowsP”Bªk
;

231 } ià(
addrM­pšg
 =ğ
Enums
::
RaBaCoCh
) {

233 
addr
 =‡dd¸/ 
chªÃls
;

236 
addr
 =‡dd¸/ 
cŞumnsP”RowBufãr
;

240 
bªk
 = 
addr
 % 
bªksP”Rªk
;

241 
addr
 =‡dd¸/ 
bªksP”Rªk
;

245 
¿nk
 = 
addr
 % 
¿nksP”ChªÃl
;

246 
addr
 =‡dd¸/ 
¿nksP”ChªÃl
;

249 
row
 = 
addr
 % 
rowsP”Bªk
;

250 
addr
 =‡dd¸/ 
rowsP”Bªk
;

251 } ià(
addrM­pšg
 =ğ
Enums
::
CoRaBaCh
) {

258 
addr
 =‡dd¸/ 
chªÃls
;

262 
bªk
 = 
addr
 % 
bªksP”Rªk
;

263 
addr
 =‡dd¸/ 
bªksP”Rªk
;

266 
¿nk
 = 
addr
 % 
¿nksP”ChªÃl
;

267 
addr
 =‡dd¸/ 
¿nksP”ChªÃl
;

271 
addr
 =‡dd¸/ 
cŞumnsP”RowBufãr
;

274 
row
 = 
addr
 % 
rowsP”Bªk
;

275 
addr
 =‡dd¸/ 
rowsP”Bªk
;

277 
	`·nic
("Unknown‡ddress mapping…olicy chosen!");

279 
	`as£¹
(
¿nk
 < 
¿nksP”ChªÃl
);

280 
	`as£¹
(
bªk
 < 
bªksP”Rªk
);

281 
	`as£¹
(
row
 < 
rowsP”Bªk
);

283 
	`DPRINTF
(
DRAM
, "Address: %lld Rank %d Bank %d Row %d\n",

284 
d¿mPktAddr
, 
¿nk
, 
bªk
, 
row
);

289 
ušt16_t
 
bªk_id
 = 
bªksP”Rªk
 * 
¿nk
 + 
bªk
;

290  
Ãw
 
	`DRAMPack‘
(
pkt
, 
isR—d
, 
¿nk
, 
bªk
, 
row
, 
bªk_id
, 
d¿mPktAddr
,

291 
size
, 
bªks
[
¿nk
][
bªk
]);

292 
	}
}

295 
	gSim¶eDRAM
::
	$addToR—dQueue
(
Pack‘PŒ
 
pkt
, 
pktCouÁ
)

299 
	`as£¹
(!
pkt
->
	`isWr™e
());

301 
	`as£¹
(
pktCouÁ
 != 0);

309 
Addr
 
addr
 = 
pkt
->
	`g‘Addr
();

310 
pktsS”viûdByWrQ
 = 0;

311 
Bur¡H–³r
* 
bur¡_h–³r
 = 
NULL
;

312 
út
 = 0; cÁ < 
pktCouÁ
; ++cnt) {

313 
size
 = 
¡d
::
	`mš
((
addr
 | (
bur¡Size
 - 1)) + 1,

314 
pkt
->
	`g‘Addr
(è+…kt->
	`g‘Size
()è- 
addr
;

315 
»adPktSize
[
	`ûLog2
(
size
)]++;

316 
»adBur¡s
++;

320 
boŞ
 
foundInWrQ
 = 
çl£
;

321 autØ
i
 = 
wr™eQueue
.
	`begš
(); i !ğwr™eQueue.
	`’d
(); ++i) {

324 ià((*
i
)->
addr
 <=‡ddr &&

325 (
addr
 + 
size
è<ğ((*
i
)->addr + (*i)->size)) {

326 
foundInWrQ
 = 
Œue
;

327 
£rviûdByWrQ
++;

328 
pktsS”viûdByWrQ
++;

329 
	`DPRINTF
(
DRAM
, "Reado‡ddr %lld with size %d serviced by "

330 "wr™queue\n", 
addr
, 
size
);

331 
by‹sR—dWrQ
 +ğ
bur¡Size
;

338 ià(!
foundInWrQ
) {

341 ià(
pktCouÁ
 > 1 && 
bur¡_h–³r
 =ğ
NULL
) {

342 
	`DPRINTF
(
DRAM
, "Reado‡ddr %lldranslateso %d "

343 "d¿m„eque¡s\n", 
pkt
->
	`g‘Addr
(), 
pktCouÁ
);

344 
bur¡_h–³r
 = 
Ãw
 
	`Bur¡H–³r
(
pktCouÁ
);

347 
DRAMPack‘
* 
d¿m_pkt
 = 
	`decodeAddr
(
pkt
, 
addr
, 
size
, 
Œue
);

348 
d¿m_pkt
->
bur¡H–³r
 = 
bur¡_h–³r
;

350 
	`as£¹
(!
	`»adQueueFuÎ
(1));

351 
rdQL’Pdf
[
»adQueue
.
	`size
(è+ 
»¥Queue
.size()]++;

353 
	`DPRINTF
(
DRAM
, "Addingo„ead queue\n");

355 
»adQueue
.
	`push_back
(
d¿m_pkt
);

358 
avgRdQL’
 = 
»adQueue
.
	`size
(è+ 
»¥Queue
.size();

362 
addr
 = (add¸| (
bur¡Size
 - 1)) + 1;

366 ià(
pktsS”viûdByWrQ
 =ğ
pktCouÁ
) {

367 
	`acûssAndRe¥Úd
(
pkt
, 
äÚ‹ndL©’cy
);

372 ià(
bur¡_h–³r
 !ğ
NULL
)

373 
bur¡_h–³r
->
bur¡sS”viûd
 = 
pktsS”viûdByWrQ
;

377 ià(!
ÃxtReqEv’t
.
	`scheduËd
(è&& !
¡İR—ds
) {

378 
	`DPRINTF
(
DRAM
, "Request scheduled immediately\n");

379 
	`scheduË
(
ÃxtReqEv’t
, 
	`curTick
());

381 
	}
}

384 
	gSim¶eDRAM
::
	$´oûssWr™eEv’t
()

386 
	`as£¹
(!
wr™eQueue
.
	`em±y
());

388 
	`DPRINTF
(
DRAM
, "Beginning DRAM Write\n");

389 
Tick
 
‹mp1
 
M5_VAR_USED
 = 
¡d
::
	`max
(
	`curTick
(), 
busBusyUÁ
);

390 
Tick
 
‹mp2
 
M5_VAR_USED
 = 
¡d
::
	`max
(
	`curTick
(), 
	`maxBªkF»eAt
());

392 
	`choo£NextWr™e
();

393 
DRAMPack‘
* 
d¿m_pkt
 = 
wr™eQueue
.
	`äÚt
();

395 
	`as£¹
(
d¿m_pkt
->
size
 <ğ
bur¡Size
);

396 
	`doDRAMAcûss
(
d¿m_pkt
);

398 
wr™eQueue
.
	`pİ_äÚt
();

399 
d–‘e
 
d¿m_pkt
;

400 
numWr™esThisTime
++;

402 
	`DPRINTF
(
DRAM
, "Completed %d writes, bus busy for %lldicks,"\

403 "bªk busy fÜ %Îdicks\n", 
numWr™esThisTime
,

404 
busBusyUÁ
 - 
‹mp1
, 
	`maxBªkF»eAt
(è- 
‹mp2
);

407 
avgWrQL’
 = 
wr™eQueue
.
	`size
();

409 ià(
numWr™esThisTime
 >ğ
wr™eHighTh»shŞd
) {

410 
	`DPRINTF
(
DRAM
, "H™ wr™th»shŞd %d\n", 
wr™eHighTh»shŞd
);

417 ià(((
wr™eQueue
.
	`size
(è<ğ
wr™eLowTh»shŞd
è&& !
»adQueue
.
	`em±y
()) ||

418 
wr™eQueue
.
	`em±y
()) {

419 
numWr™esThisTime
 = 0;

421 
busBusyUÁ
 +ğ
tWTR
;

422 
¡İR—ds
 = 
çl£
;

424 ià(!
ÃxtReqEv’t
.
	`scheduËd
())

425 
	`scheduË
(
ÃxtReqEv’t
, 
busBusyUÁ
);

427 
	`as£¹
(!
wr™eEv’t
.
	`scheduËd
());

428 
	`DPRINTF
(
DRAM
, "Nexˆwr™scheduËd‡ˆ%Îd\n", 
ÃwTime
);

429 
	`scheduË
(
wr™eEv’t
, 
ÃwTime
);

432 ià(
»ŒyWrReq
) {

433 
»ŒyWrReq
 = 
çl£
;

434 
pÜt
.
	`£ndR‘ry
();

438 ià(
wr™eQueue
.
	`em±y
(è&& 
»adQueue
.empty() &&

439 
»¥Queue
.
	`em±y
 (è&& 
d¿šMªag”
) {

440 
d¿šMªag”
->
	`sigÇlD¿šDÚe
();

441 
d¿šMªag”
 = 
NULL
;

443 
	}
}

447 
	gSim¶eDRAM
::
	$Œigg”Wr™es
()

449 
	`DPRINTF
(
DRAM
, "Wr™e Œigg”ed‡ˆ%Îd\n", 
	`curTick
());

451 
¡İR—ds
 = 
Œue
;

453 
wr™eS¹Time
 = 
¡d
::
	`max
(
busBusyUÁ
, 
	`curTick
()è+ 
tWTR
;

455 
	`DPRINTF
(
DRAM
, "Wr™e scheduËd‡ˆ%Îd\n", 
wr™eS¹Time
);

457 
	`as£¹
(
wr™eS¹Time
 >ğ
	`curTick
());

458 
	`as£¹
(!
wr™eEv’t
.
	`scheduËd
());

459 
	`scheduË
(
wr™eEv’t
, 
wr™eS¹Time
);

460 
	}
}

463 
	gSim¶eDRAM
::
	$addToWr™eQueue
(
Pack‘PŒ
 
pkt
, 
pktCouÁ
)

467 
	`as£¹
(
pkt
->
	`isWr™e
());

471 
Addr
 
addr
 = 
pkt
->
	`g‘Addr
();

472 
út
 = 0; cÁ < 
pktCouÁ
; ++cnt) {

473 
size
 = 
¡d
::
	`mš
((
addr
 | (
bur¡Size
 - 1)) + 1,

474 
pkt
->
	`g‘Addr
(è+…kt->
	`g‘Size
()è- 
addr
;

475 
wr™ePktSize
[
	`ûLog2
(
size
)]++;

476 
wr™eBur¡s
++;

482 
boŞ
 
m”ged
 = 
çl£
;

483 autØ
w
 = 
wr™eQueue
.
	`begš
();

485 !
m”ged
 && 
w
 !ğ
wr™eQueue
.
	`’d
()) {

488 ià((*
w
)->
addr
 >=‡ddr) {

492 ià((
addr
 + 
size
è>ğ((*
w
)->addr + (*w)->size)) {

495 
	`DPRINTF
(
DRAM
, "Merging write coveringƒxisting burst\n");

496 
m”ged
 = 
Œue
;

498 (*
w
)->
addr
 =‡ddr;

499 (*
w
)->
size
 = size;

500 } ià((
addr
 + 
size
è>ğ(*
w
)->addr &&

501 ((*
w
)->
addr
 + (*w)->
size
 -‡ddrè<ğ
bur¡Size
) {

505 
	`DPRINTF
(
DRAM
, "Merging write beforeƒxisting burst\n");

506 
m”ged
 = 
Œue
;

509 (*
w
)->
addr
 =‡ddr;

510 (*
w
)->
size
 = (*w)->
addr
 + (*w)->size -‡ddr;

516 ià(((*
w
)->
addr
 + (*w)->
size
) >= (addr + size)) {

519 
	`DPRINTF
(
DRAM
, "Merging write intoƒxisting burst\n");

520 
m”ged
 = 
Œue
;

522 } ià(((*
w
)->
addr
 + (*w)->
size
) >=‡ddr &&

523 (
addr
 + 
size
 - (*
w
)->addrè<ğ
bur¡Size
) {

527 
	`DPRINTF
(
DRAM
, "Merging write‡fterƒxisting burst\n");

528 
m”ged
 = 
Œue
;

531 (*
w
)->
size
 = 
addr
 + size - (*w)->addr;

534 ++
w
;

539 ià(!
m”ged
) {

540 
DRAMPack‘
* 
d¿m_pkt
 = 
	`decodeAddr
(
pkt
, 
addr
, 
size
, 
çl£
);

542 
	`as£¹
(
wr™eQueue
.
	`size
(è< 
wr™eBufãrSize
);

543 
wrQL’Pdf
[
wr™eQueue
.
	`size
()]++;

545 
	`DPRINTF
(
DRAM
, "Addingo write queue\n");

547 
wr™eQueue
.
	`push_back
(
d¿m_pkt
);

550 
avgWrQL’
 = 
wr™eQueue
.
	`size
();

554 
m”gedWrBur¡s
++;

558 
addr
 = (add¸| (
bur¡Size
 - 1)) + 1;

566 
	`acûssAndRe¥Úd
(
pkt
, 
äÚ‹ndL©’cy
);

569 ià(
wr™eQueue
.
	`size
(è>ğ
wr™eHighTh»shŞd
 && !
¡İR—ds
){

570 
	`Œigg”Wr™es
();

572 
	}
}

575 
	gSim¶eDRAM
::
	$´štP¬ams
() const

578 
	`DPRINTF
(
DRAM
,

589 
	`Çme
(), 
deviûsP”Rªk
, 
deviûBusWidth
, 
bur¡Size
, 
rowBufãrSize
,

590 
cŞumnsP”RowBufãr
, 
rowsP”Bªk
, 
bªksP”Rªk
, 
¿nksP”ChªÃl
,

591 
rowBufãrSize
 * 
rowsP”Bªk
 * 
bªksP”Rªk
 * 
¿nksP”ChªÃl
);

593 
¡ršg
 
scheduËr
 = 
memSchedPŞicy
 =ğ
Enums
::
fcfs
 ? "FCFS" : "FR-FCFS";

594 
¡ršg
 
add»ss_m­pšg
 = 
addrM­pšg
 =ğ
Enums
::
RaBaChCo
 ? "RaBaChCo" :

595 (
addrM­pšg
 =ğ
Enums
::
RaBaCoCh
 ? "RaBaCoCh" : "CoRaBaCh");

596 
¡ršg
 
·ge_pŞicy
 = 
·geMgmt
 =ğ
Enums
::
İ’
 ? "OPEN" :

597 (
·geMgmt
 =ğ
Enums
::
İ’_ad­tive
 ? "OPEN (adaptive)" : "CLOSE");

599 
	`DPRINTF
(
DRAM
,

607 
	`Çme
(), 
»adBufãrSize
, 
wr™eBufãrSize
, 
wr™eHighTh»shŞd
,

608 
scheduËr
, 
add»ss_m­pšg
, 
·ge_pŞicy
);

610 
	`DPRINTF
(
DRAM
, "Memory controller %siming specs\n" \

619 
	`Çme
(), 
tRCD
, 
tCL
, 
tRP
, 
tBURST
, 
tRFC
, 
tREFI
, 
tWTR
,

620 
aùiv©iÚLim™
, 
tXAW
);

621 
	}
}

624 
	gSim¶eDRAM
::
	$´štQs
() const {

625 
	`DPRINTF
(
DRAM
, "===READ QUEUE===\n\n");

626 autØ
i
 = 
»adQueue
.
	`begš
(è; i !ğ»adQueue.
	`’d
() ; ++i) {

627 
	`DPRINTF
(
DRAM
, "R—d %lu\n", (*
i
)->
addr
);

629 
	`DPRINTF
(
DRAM
, "\n===RESP QUEUE===\n\n");

630 autØ
i
 = 
»¥Queue
.
	`begš
(è; i !ğ»¥Queue.
	`’d
() ; ++i) {

631 
	`DPRINTF
(
DRAM
, "Re¥Ú£ %lu\n", (*
i
)->
addr
);

633 
	`DPRINTF
(
DRAM
, "\n===WRITE QUEUE===\n\n");

634 autØ
i
 = 
wr™eQueue
.
	`begš
(è; i !ğwr™eQueue.
	`’d
() ; ++i) {

635 
	`DPRINTF
(
DRAM
, "Wr™%lu\n", (*
i
)->
addr
);

637 
	}
}

639 
boŞ


640 
	gSim¶eDRAM
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

644 
x
 = 0; x < 
³ndšgD–‘e
.
	`size
(); x++)

645 
d–‘e
 
³ndšgD–‘e
[
x
];

646 
³ndšgD–‘e
.
	`ş—r
();

649 
	`DPRINTF
(
DRAM
, "recvTimingReq:„equest %s‡ddr %lld size %d\n",

650 
pkt
->
	`cmdSŒšg
(),…kt->
	`g‘Addr
(),…kt->
	`g‘Size
());

653 ià(
pkt
->
	`memInhib™As£¹ed
()) {

654 
	`DPRINTF
(
DRAM
,"Inhibited…acket -- Dropping it‚ow\n");

655 
³ndšgD–‘e
.
	`push_back
(
pkt
);

656  
Œue
;

660 ià(
numReqs
 % 1000000 == 0)

661 
	`´štQs
();

664 ià(
´evA¼iv®
 != 0) {

665 
tÙG­
 +ğ
	`curTick
(è- 
´evA¼iv®
;

667 
´evA¼iv®
 = 
	`curTick
();

674 
size
 = 
pkt
->
	`g‘Size
();

675 
off£t
 = 
pkt
->
	`g‘Addr
(è& (
bur¡Size
 - 1);

676 
d¿m_pkt_couÁ
 = 
	`divCe
(
off£t
 + 
size
, 
bur¡Size
);

679 ià(
pkt
->
	`isR—d
()) {

680 
	`as£¹
(
size
 != 0);

681 ià(
	`»adQueueFuÎ
(
d¿m_pkt_couÁ
)) {

682 
	`DPRINTF
(
DRAM
, "Read queue full,‚ot‡ccepting\n");

684 
»ŒyRdReq
 = 
Œue
;

685 
numRdR‘ry
++;

686  
çl£
;

688 
	`addToR—dQueue
(
pkt
, 
d¿m_pkt_couÁ
);

689 
»adReqs
++;

690 
numReqs
++;

691 
by‹sR—dSys
 +ğ
size
;

693 } ià(
pkt
->
	`isWr™e
()) {

694 
	`as£¹
(
size
 != 0);

695 ià(
	`wr™eQueueFuÎ
(
d¿m_pkt_couÁ
)) {

696 
	`DPRINTF
(
DRAM
, "Write queue full,‚ot‡ccepting\n");

698 
»ŒyWrReq
 = 
Œue
;

699 
numWrR‘ry
++;

700  
çl£
;

702 
	`addToWr™eQueue
(
pkt
, 
d¿m_pkt_couÁ
);

703 
wr™eReqs
++;

704 
numReqs
++;

705 
by‹sWr™‹nSys
 +ğ
size
;

708 
	`DPRINTF
(
DRAM
,"Neither„ead‚or write, ignoreiming\n");

709 
Ã™h”R—dNÜWr™e
++;

710 
	`acûssAndRe¥Úd
(
pkt
, 1);

713 
»ŒyRdReq
 = 
çl£
;

714 
»ŒyWrReq
 = 
çl£
;

715  
Œue
;

716 
	}
}

719 
	gSim¶eDRAM
::
	$´oûssRe¥ÚdEv’t
()

721 
	`DPRINTF
(
DRAM
,

724 
DRAMPack‘
* 
d¿m_pkt
 = 
»¥Queue
.
	`äÚt
();

726 ià(
d¿m_pkt
->
bur¡H–³r
) {

728 
d¿m_pkt
->
bur¡H–³r
->
bur¡sS”viûd
++;

729 ià(
d¿m_pkt
->
bur¡H–³r
->
bur¡sS”viûd
 ==

730 
d¿m_pkt
->
bur¡H–³r
->
bur¡CouÁ
) {

735 
	`acûssAndRe¥Úd
(
d¿m_pkt
->
pkt
, 
äÚ‹ndL©’cy
 + 
back’dL©’cy
);

736 
d–‘e
 
d¿m_pkt
->
bur¡H–³r
;

737 
d¿m_pkt
->
bur¡H–³r
 = 
NULL
;

741 
	`acûssAndRe¥Úd
(
d¿m_pkt
->
pkt
, 
äÚ‹ndL©’cy
 + 
back’dL©’cy
);

744 
d–‘e
 
»¥Queue
.
	`äÚt
();

745 
»¥Queue
.
	`pİ_äÚt
();

748 
avgRdQL’
 = 
»adQueue
.
	`size
(è+ 
»¥Queue
.size();

750 ià(!
»¥Queue
.
	`em±y
()) {

751 
	`as£¹
(
»¥Queue
.
	`äÚt
()->
»adyTime
 >ğ
	`curTick
());

752 
	`as£¹
(!
»¥ÚdEv’t
.
	`scheduËd
());

753 
	`scheduË
(
»¥ÚdEv’t
, 
»¥Queue
.
	`äÚt
()->
»adyTime
);

756 ià(
wr™eQueue
.
	`em±y
(è&& 
»adQueue
.empty() &&

757 
d¿šMªag”
) {

758 
d¿šMªag”
->
	`sigÇlD¿šDÚe
();

759 
d¿šMªag”
 = 
NULL
;

765 ià(
»ŒyRdReq
) {

766 
»ŒyRdReq
 = 
çl£
;

767 
pÜt
.
	`£ndR‘ry
();

769 
	}
}

772 
	gSim¶eDRAM
::
	$choo£NextWr™e
()

778 
	`as£¹
(!
wr™eQueue
.
	`em±y
());

780 ià(
wr™eQueue
.
	`size
() == 1) {

781 
	`DPRINTF
(
DRAM
, "Single write„equest,‚othingo do\n");

785 ià(
memSchedPŞicy
 =ğ
Enums
::
fcfs
) {

787 } ià(
memSchedPŞicy
 =ğ
Enums
::
äfcfs
) {

788 
	`»Üd”Queue
(
wr™eQueue
);

790 
	`·nic
("No scheduling…olicy chosen\n");

792 
	`DPRINTF
(
DRAM
, "Selected‚ext write„equest\n");

793 
	}
}

795 
boŞ


796 
	gSim¶eDRAM
::
	$choo£NextR—d
()

802 ià(
»adQueue
.
	`em±y
()) {

803 
	`DPRINTF
(
DRAM
, "No„ead„equesto select\n");

804  
çl£
;

808 ià(
»adQueue
.
	`size
() == 1)

809  
Œue
;

811 ià(
memSchedPŞicy
 =ğ
Enums
::
fcfs
) {

814 } ià(
memSchedPŞicy
 =ğ
Enums
::
äfcfs
) {

815 
	`»Üd”Queue
(
»adQueue
);

817 
	`·nic
("No scheduling…olicy chosen!\n");

819 
	`DPRINTF
(
DRAM
, "Selected‚ext„ead„equest\n");

820  
Œue
;

821 
	}
}

824 
	gSim¶eDRAM
::
»Üd”Queue
(
¡d
::
deque
<
DRAMPack‘
*>& 
queue
)

827 
ušt64_t
 
—¾›¡_bªks
 = 0;

831 
boŞ
 
	gfound_—¾›¡_pkt
 = 
çl£
;

832 autØ
	g£Ëùed_pkt_™
 = 
queue
.
begš
();

834 autØ
	gi
 = 
queue
.
begš
(); i !ğqueue.
’d
() ; ++i) {

835 
DRAMPack‘
* 
	gd¿m_pkt
 = *
i
;

836 cÚ¡ 
	gBªk
& 
	gbªk
 = 
d¿m_pkt
->
bªkRef
;

838 ià(
	gbªk
.
	gİ’Row
 =ğ
d¿m_pkt
->
row
) {

839 
DPRINTF
(
DRAM
, "Row buffer hit\n");

840 
	g£Ëùed_pkt_™
 = 
i
;

842 } ià(!
	gfound_—¾›¡_pkt
) {

844 ià(
	g—¾›¡_bªks
 == 0)

845 
—¾›¡_bªks
 = 
mšBªkF»eAt
(
queue
);

848 ià(
	gbªk
.
	gä“At
 <ğ
curTick
() ||

849 
b™s
(
—¾›¡_bªks
, 
d¿m_pkt
->
bªkId
, dram_pkt->bankId)) {

852 
	g£Ëùed_pkt_™
 = 
i
;

853 
	gfound_—¾›¡_pkt
 = 
Œue
;

858 
DRAMPack‘
* 
	g£Ëùed_pkt
 = *
£Ëùed_pkt_™
;

859 
	gqueue
.
”a£
(
£Ëùed_pkt_™
);

860 
	gqueue
.
push_äÚt
(
£Ëùed_pkt
);

864 
	gSim¶eDRAM
::
	$acûssAndRe¥Úd
(
Pack‘PŒ
 
pkt
, 
Tick
 
¡©ic_Ï‹ncy
)

866 
	`DPRINTF
(
DRAM
, "Re¥ÚdšgØAdd»s %Îd.. ",
pkt
->
	`g‘Addr
());

868 
boŞ
 
ÃedsRe¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
();

871 
	`acûss
(
pkt
);

874 ià(
ÃedsRe¥Ú£
) {

876 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

879 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

883 
pÜt
.
	`schedTimšgRe¥
(
pkt
, 
	`curTick
(è+ 
¡©ic_Ï‹ncy
);

887 
³ndšgD–‘e
.
	`push_back
(
pkt
);

890 
	`DPRINTF
(
DRAM
, "Done\n");

893 
	}
}

895 
	g·œ
<
	gTick
, Tick>

896 
	gSim¶eDRAM
::
	$e¡im©eL©’cy
(
DRAMPack‘
* 
d¿m_pkt
, 
Tick
 
šTime
)

904 
Tick
 
accL©
 = 0;

905 
Tick
 
bªkL©
 = 0;

906 
rowH™FÏg
 = 
çl£
;

907 
Tick
 
pÙ’tŸlAùTick
;

909 cÚ¡ 
Bªk
& 
bªk
 = 
d¿m_pkt
->
bªkRef
;

911 ià(
·geMgmt
 =ğ
Enums
::
İ’
 ||…ageMgmˆ=ğEnums::
İ’_ad­tive
) {

912 ià(
bªk
.
İ’Row
 =ğ
d¿m_pkt
->
row
) {

916 
rowH™FÏg
 = 
Œue
;

924 ià(
bªk
.
ä“At
 > 
šTime
) {

925 
accL©
 +ğ
bªk
.
ä“At
 - 
šTime
;

926 
bªkL©
 += 0;

929 
accL©
 +ğ
tCL
;

930 
bªkL©
 +ğ
tCL
;

937 
Tick
 
ä“Time
 = 
¡d
::
	`max
(
bªk
.
tRASDÚeAt
, bªk.
ä“At
);

939 ià(
ä“Time
 > 
šTime
)

940 
accL©
 +ğ
ä“Time
 - 
šTime
;

944 
Tick
 
´ech¬ge_d–ay
 = 
bªk
.
İ’Row
 =ğ-1 ? 0 : 
tRP
;

947 
pÙ’tŸlAùTick
 = 
šTime
 + 
accL©
 + 
´ech¬ge_d–ay
;

948 ià(
pÙ’tŸlAùTick
 < 
bªk
.
aùAÎowedAt
)

949 
accL©
 +ğ
bªk
.
aùAÎowedAt
 - 
pÙ’tŸlAùTick
;

951 
accL©
 +ğ
´ech¬ge_d–ay
 + 
tRCD
 + 
tCL
;

952 
bªkL©
 +ğ
´ech¬ge_d–ay
 + 
tRCD
 + 
tCL
;

954 } ià(
·geMgmt
 =ğ
Enums
::
şo£
) {

957 ià(
bªk
.
ä“At
 > 
šTime
)

958 
accL©
 +ğ
bªk
.
ä“At
 - 
šTime
;

961 
pÙ’tŸlAùTick
 = 
šTime
 + 
accL©
;

962 ià(
pÙ’tŸlAùTick
 < 
bªk
.
aùAÎowedAt
)

963 
accL©
 +ğ
bªk
.
aùAÎowedAt
 - 
pÙ’tŸlAùTick
;

967 
accL©
 +ğ
tRCD
 + 
tCL
;

968 
bªkL©
 +ğ
tRCD
 + 
tCL
;

970 
	`·nic
("No…age management…olicy chosen\n");

972 
	`DPRINTF
(
DRAM
, "Returning < %lld, %lld > fromƒstimateLatency()\n",

973 
bªkL©
, 
accL©
);

975  
	`make_·œ
(
bªkL©
, 
accL©
);

976 
	}
}

979 
	gSim¶eDRAM
::
	$´oûssNextReqEv’t
()

981 
	`scheduËNextReq
();

982 
	}
}

985 
	gSim¶eDRAM
::
	$»cÜdAùiv©e
(
Tick
 
aù_tick
, 
ušt8_t
 
¿nk
, ušt8_ˆ
bªk
)

987 
	`as£¹
(0 <ğ
¿nk
 &&„ªk < 
¿nksP”ChªÃl
);

988 
	`as£¹
(
aùTicks
[
¿nk
].
	`size
(è=ğ
aùiv©iÚLim™
);

990 
	`DPRINTF
(
DRAM
, "Aùiv©©ick %d\n", 
aù_tick
);

997 ià((
numBªksAùive
 =ğ0è&& (
aù_tick
 > 
¡¬tTickP»ch¬geAÎ
)) {

998 
´ech¬geAÎTime
 +ğ
aù_tick
 - 
¡¬tTickP»ch¬geAÎ
;

1004 ià(
·geMgmt
 =ğ
Enums
::
İ’
 ||…ageMgmˆ=ğEnums::
İ’_ad­tive
)

1005 ++
numBªksAùive
;

1008 
i
 = 0; i < 
bªksP”Rªk
; i++) {

1010 
bªks
[
¿nk
][
i
].
aùAÎowedAt
 = 
aù_tick
 + 
tRRD
;

1015 
bªks
[
¿nk
][
bªk
].
aùAÎowedAt
 = 
aù_tick
 + 
tRAS
 + 
tRP
;

1019 ià(
aùTicks
[
¿nk
].
	`em±y
())

1023 ià(
aùTicks
[
¿nk
].
	`back
(è&& (
aù_tick
 -‡ùTicks[¿nk].back()è< 
tXAW
) {

1025 
	`w¬n
("Got %d‡ctivates in window %d (%d - %d) which is smaller "

1026 "thª %d\n", 
aùiv©iÚLim™
, 
aù_tick
 - 
aùTicks
[
¿nk
].
	`back
(),

1027 
aù_tick
, 
aùTicks
[
¿nk
].
	`back
(), 
tXAW
);

1032 
aùTicks
[
¿nk
].
	`pİ_back
();

1035 
aùTicks
[
¿nk
].
	`push_äÚt
(
aù_tick
);

1040 ià(
aùTicks
[
¿nk
].
	`back
(è&& (
aù_tick
 -‡ùTicks[¿nk].back()è< 
tXAW
) {

1041 
	`DPRINTF
(
DRAM
, "EnforcingXAW with X = %d,‚ext‡ctivate‚oƒarlier "

1042 "thª %d\n", 
aùiv©iÚLim™
, 
aùTicks
[
¿nk
].
	`back
(è+ 
tXAW
);

1043 
j
 = 0; j < 
bªksP”Rªk
; j++)

1045 
bªks
[
¿nk
][
j
].
aùAÎowedAt
 = 
aùTicks
[¿nk].
	`back
(è+ 
tXAW
;

1047 
	}
}

1050 
	gSim¶eDRAM
::
	$doDRAMAcûss
(
DRAMPack‘
* 
d¿m_pkt
)

1053 
	`DPRINTF
(
DRAM
, "Timing‡ccesso‡ddr %lld,„ank/bank/row %d %d %d\n",

1054 
d¿m_pkt
->
addr
, d¿m_pkt->
¿nk
, d¿m_pkt->
bªk
, d¿m_pkt->
row
);

1057 
·œ
<
Tick
, Tick> 
Ït
 = 
	`e¡im©eL©’cy
(
d¿m_pkt
, 
	`curTick
());

1058 
Tick
 
bªkL©
 = 
Ït
.
fœ¡
;

1059 
Tick
 
acûssL©
 = 
Ït
.
£cÚd
;

1060 
Tick
 
aùTick
;

1067 
Tick
 
addD–ay
 = (
	`curTick
(è+ 
acûssL©
 < 
busBusyUÁ
) ?

1068 
busBusyUÁ
 - (
	`curTick
(è+ 
acûssL©
) : 0;

1070 
Bªk
& 
bªk
 = 
d¿m_pkt
->
bªkRef
;

1073 ià(
·geMgmt
 =ğ
Enums
::
İ’
 ||…ageMgmˆ=ğEnums::
İ’_ad­tive
) {

1074 
bªk
.
İ’Row
 = 
d¿m_pkt
->
row
;

1075 
bªk
.
ä“At
 = 
	`curTick
(è+ 
addD–ay
 + 
acûssL©
;

1076 
bªk
.
by‹sAcûs£d
 +ğ
bur¡Size
;

1080 ià(!
rowH™FÏg
) {

1082 
aùTick
 = 
bªk
.
ä“At
 - 
tCL
 - 
tRCD
;

1083 
bªk
.
tRASDÚeAt
 = 
aùTick
 + 
tRAS
;

1084 
	`»cÜdAùiv©e
(
aùTick
, 
d¿m_pkt
->
¿nk
, d¿m_pkt->
bªk
);

1088 
by‹sP”Aùiv©e
.
	`§m¶e
(
bªk
.
by‹sAcûs£d
);

1089 
bªk
.
by‹sAcûs£d
 = 0;

1092 ià(
·geMgmt
 =ğ
Enums
::
İ’_ad­tive
) {

1096 
boŞ
 
gÙ_mÜe_h™s
 = 
çl£
;

1097 
boŞ
 
gÙ_bªk_cÚæiù
 = 
çl£
;

1100 cÚ¡ 
deque
<
DRAMPack‘
*>& 
queue
 = 
d¿m_pkt
->
isR—d
 ? 
»adQueue
 :

1101 
wr™eQueue
;

1102 autØ
p
 = 
queue
.
	`begš
();

1105 ++
p
;

1109 !(
gÙ_mÜe_h™s
 && 
gÙ_bªk_cÚæiù
) &&

1110 
p
 !ğ
queue
.
	`’d
()) {

1111 
boŞ
 
§me_¿nk_bªk
 = (
d¿m_pkt
->
¿nk
 =ğ(*
p
)->rank) &&

1112 (
d¿m_pkt
->
bªk
 =ğ(*
p
)->bank);

1113 
boŞ
 
§me_row
 = 
d¿m_pkt
->
row
 =ğ(*
p
)->row;

1114 
gÙ_mÜe_h™s
 |ğ
§me_¿nk_bªk
 && 
§me_row
;

1115 
gÙ_bªk_cÚæiù
 |ğ
§me_¿nk_bªk
 && !
§me_row
;

1116 ++
p
;

1120 ià(!
gÙ_mÜe_h™s
 && 
gÙ_bªk_cÚæiù
) {

1121 
bªk
.
İ’Row
 = -1;

1122 
bªk
.
ä“At
 = 
¡d
::
	`max
(bªk.ä“At, bªk.
tRASDÚeAt
è+ 
tRP
;

1123 --
numBªksAùive
;

1124 ià(
numBªksAùive
 == 0) {

1125 
¡¬tTickP»ch¬geAÎ
 = 
¡d
::
	`max
(startTickPrechargeAll,

1126 
bªk
.
ä“At
);

1127 
	`DPRINTF
(
DRAM
, "All banks…recharged‡tick: %ld\n",

1128 
¡¬tTickP»ch¬geAÎ
);

1130 
	`DPRINTF
(
DRAM
, "Auto-´ech¬ged bªk: %d\n", 
d¿m_pkt
->
bªkId
);

1134 
	`DPRINTF
(
DRAM
, "doDRAMAcûss::bªk.ä“Aˆi %Îd\n", 
bªk
.
ä“At
);

1135 } ià(
·geMgmt
 =ğ
Enums
::
şo£
) {

1136 
aùTick
 = 
	`curTick
(è+ 
addD–ay
 + 
acûssL©
 - 
tRCD
 - 
tCL
;

1137 
	`»cÜdAùiv©e
(
aùTick
, 
d¿m_pkt
->
¿nk
, d¿m_pkt->
bªk
);

1142 
bªk
.
ä“At
 = 
¡d
::
	`max
(
aùTick
 + 
tRAS
 + 
tRP
,

1143 
aùTick
 + 
tRCD
 + 
tCL
 + 
tRP
);

1144 
	`DPRINTF
(
DRAM
, "doDRAMAcûss::bªk.ä“Aˆi %Îd\n", 
bªk
.
ä“At
);

1145 
by‹sP”Aùiv©e
.
	`§m¶e
(
bur¡Size
);

1146 
¡¬tTickP»ch¬geAÎ
 = 
¡d
::
	`max
(¡¬tTickP»ch¬geAÎ, 
bªk
.
ä“At
);

1148 
	`·nic
("No…age management…olicy chosen\n");

1151 
d¿m_pkt
->
»adyTime
 = 
	`curTick
(è+ 
addD–ay
 + 
acûssL©
 + 
tBURST
;

1154 
	`DPRINTF
(
DRAM
, "Req %lld: curtick is %lld‡ccessLat is %d " \

1156 "Schedulšg‡ˆ»adyTime\n", 
d¿m_pkt
->
addr
,

1157 
	`curTick
(), 
acûssL©
, 
d¿m_pkt
->
»adyTime
, 
busBusyUÁ
);

1160 
	`as£¹
 (
d¿m_pkt
->
»adyTime
 - 
busBusyUÁ
 >ğ
tBURST
);

1163 
busBusyUÁ
 = 
d¿m_pkt
->
»adyTime
;

1165 
	`DPRINTF
(
DRAM
,"Accessime is %lld\n",

1166 
d¿m_pkt
->
»adyTime
 - d¿m_pkt->
’ŒyTime
);

1169 
ÃwTime
 = (
busBusyUÁ
 > 
tRP
 + 
tRCD
 + 
tCL
) ?

1170 
¡d
::
	`max
(
busBusyUÁ
 - (
tRP
 + 
tRCD
 + 
tCL
), 
	`curTick
()) : curTick();

1173 ià(
d¿m_pkt
->
isR—d
) {

1174 ià(
rowH™FÏg
)

1175 
»adRowH™s
++;

1176 
by‹sR—dDRAM
 +ğ
bur¡Size
;

1177 
³rBªkRdBur¡s
[
d¿m_pkt
->
bªkId
]++;

1179 ià(
rowH™FÏg
)

1180 
wr™eRowH™s
++;

1181 
by‹sWr™‹n
 +ğ
bur¡Size
;

1182 
³rBªkWrBur¡s
[
d¿m_pkt
->
bªkId
]++;

1191 
tÙMemAccL©
 +ğ
d¿m_pkt
->
»adyTime
 - d¿m_pkt->
’ŒyTime
;

1192 
tÙBªkL©
 +ğ
bªkL©
;

1193 
tÙBusL©
 +ğ
tBURST
;

1194 
tÙQL©
 +ğ
d¿m_pkt
->
»adyTime
 - d¿m_pkt->
’ŒyTime
 - 
bªkL©
 - 
tBURST
;

1201 
	`moveToRe¥Q
();

1204 ià(!
ÃxtReqEv’t
.
	`scheduËd
(è&& !
¡İR—ds
){

1205 
	`scheduË
(
ÃxtReqEv’t
, 
ÃwTime
);

1207 ià(
ÃwTime
 < 
ÃxtReqEv’t
.
	`wh’
())

1208 
	`»scheduË
(
ÃxtReqEv’t
, 
ÃwTime
);

1210 
	}
}

1213 
	gSim¶eDRAM
::
	$moveToRe¥Q
()

1216 
DRAMPack‘
* 
d¿m_pkt
 = 
»adQueue
.
	`äÚt
();

1217 
»adQueue
.
	`pİ_äÚt
();

1220 
	`as£¹
(
d¿m_pkt
->
size
 <ğ
bur¡Size
);

1225 ià(
»¥Queue
.
	`em±y
()) {

1226 
»¥Queue
.
	`push_äÚt
(
d¿m_pkt
);

1227 
	`as£¹
(!
»¥ÚdEv’t
.
	`scheduËd
());

1228 
	`as£¹
(
d¿m_pkt
->
»adyTime
 >ğ
	`curTick
());

1229 
	`scheduË
(
»¥ÚdEv’t
, 
d¿m_pkt
->
»adyTime
);

1231 
boŞ
 
dÚe
 = 
çl£
;

1232 autØ
i
 = 
»¥Queue
.
	`begš
();

1233 !
dÚe
 && 
i
 !ğ
»¥Queue
.
	`’d
()) {

1234 ià((*
i
)->
»adyTime
 > 
d¿m_pkt
->readyTime) {

1235 
»¥Queue
.
	`š£¹
(
i
, 
d¿m_pkt
);

1236 
dÚe
 = 
Œue
;

1238 ++
i
;

1241 ià(!
dÚe
)

1242 
»¥Queue
.
	`push_back
(
d¿m_pkt
);

1244 
	`as£¹
(
»¥ÚdEv’t
.
	`scheduËd
());

1246 ià(
»¥Queue
.
	`äÚt
()->
»adyTime
 < 
»¥ÚdEv’t
.
	`wh’
()) {

1247 
	`as£¹
(
»¥Queue
.
	`äÚt
()->
»adyTime
 >ğ
	`curTick
());

1248 
	`»scheduË
(
»¥ÚdEv’t
, 
»¥Queue
.
	`äÚt
()->
»adyTime
);

1251 
	}
}

1254 
	gSim¶eDRAM
::
	$scheduËNextReq
()

1256 
	`DPRINTF
(
DRAM
, "Reached scheduleNextReq()\n");

1260 ià(!
	`choo£NextR—d
()) {

1265 ià(
d¿šMªag”
 && !
wr™eQueue
.
	`em±y
(è&& !
wr™eEv’t
.
	`scheduËd
())

1266 
	`Œigg”Wr™es
();

1268 
	`doDRAMAcûss
(
»adQueue
.
	`äÚt
());

1270 
	}
}

1272 
Tick


1273 
	gSim¶eDRAM
::
	$maxBªkF»eAt
() const

1275 
Tick
 
bªksF»e
 = 0;

1277 
i
 = 0; i < 
¿nksP”ChªÃl
; i++)

1278 
j
 = 0; j < 
bªksP”Rªk
; j++)

1279 
bªksF»e
 = 
¡d
::
	`max
(
bªks
[
i
][
j
].
ä“At
, banksFree);

1281  
bªksF»e
;

1282 
	}
}

1284 
ušt64_t


1285 
	gSim¶eDRAM
::
mšBªkF»eAt
(cÚ¡ 
deque
<
DRAMPack‘
*>& 
queue
) const

1287 
ušt64_t
 
bªk_mask
 = 0;

1288 
Tick
 
	gä“At
 = 
MaxTick
;

1292 
	gveùÜ
<
	gboŞ
> 
gÙ_wa™šg
(
¿nksP”ChªÃl
 * 
bªksP”Rªk
, 
çl£
);

1293 autØ
	gp
 = 
queue
.
begš
();… !ğqueue.
’d
(); ++p) {

1294 
	ggÙ_wa™šg
[(*
p
)->
bªkId
] = 
Œue
;

1297 
	gi
 = 0; i < 
	g¿nksP”ChªÃl
; i++) {

1298 
	gj
 = 0; j < 
	gbªksP”Rªk
; j++) {

1301 ià(
	ggÙ_wa™šg
[
i
 * 
bªksP”Rªk
 + 
j
] &&

1302 
	gbªks
[
i
][
j
].
	gä“At
 <ğ
ä“At
) {

1304 ià(
bªks
[
i
][
j
].
ä“At
 < freeAt)

1305 
bªk_mask
 = 0;

1307 
ušt8_t
 
	gb™_šdex
 = 
i
 * 
¿nksP”ChªÃl
 + 
j
;

1308 
»¶aûB™s
(
bªk_mask
, 
b™_šdex
, bit_index, 1);

1309 
	gä“At
 = 
bªks
[
i
][
j
].
ä“At
;

1313  
	gbªk_mask
;

1317 
	gSim¶eDRAM
::
	$´oûssReäeshEv’t
()

1319 
	`DPRINTF
(
DRAM
, "Reäeshšg‡ˆtick %ld\n", 
	`curTick
());

1321 
Tick
 
bªksF»e
 = 
¡d
::
	`max
(
	`curTick
(), 
	`maxBªkF»eAt
()è+ 
tRFC
;

1323 
i
 = 0; i < 
¿nksP”ChªÃl
; i++)

1324 
j
 = 0; j < 
bªksP”Rªk
; j++) {

1325 
bªks
[
i
][
j
].
ä“At
 = 
bªksF»e
;

1326 
bªks
[
i
][
j
].
İ’Row
 = -1;

1330 
numBªksAùive
 = 0;

1331 
¡¬tTickP»ch¬geAÎ
 = 
bªksF»e
;

1333 
	`scheduË
(
»äeshEv’t
, 
	`curTick
(è+ 
tREFI
);

1334 
	}
}

1337 
	gSim¶eDRAM
::
	$»gSts
()

1339 
usšg
 
Çme¥aû
 
Sts
;

1341 
Ab¡¿ùMemÜy
::
	`»gSts
();

1343 
»adReqs


1344 .
	`Çme
(name() + ".readReqs")

1345 .
	`desc
("Number of„ead„equests‡ccepted");

1347 
wr™eReqs


1348 .
	`Çme
(name() + ".writeReqs")

1349 .
	`desc
("Number of write„equests‡ccepted");

1351 
»adBur¡s


1352 .
	`Çme
(name() + ".readBursts")

1353 .
	`desc
("Number of DRAM„ead bursts, "

1356 
wr™eBur¡s


1357 .
	`Çme
(name() + ".writeBursts")

1358 .
	`desc
("Number of DRAM write bursts, "

1361 
£rviûdByWrQ


1362 .
	`Çme
(name() + ".servicedByWrQ")

1363 .
	`desc
("Number of DRAM„ead bursts serviced byhe write queue");

1365 
m”gedWrBur¡s


1366 .
	`Çme
(name() + ".mergedWrBursts")

1367 .
	`desc
("Number of DRAM write bursts merged with‡nƒxisting one");

1369 
Ã™h”R—dNÜWr™e


1370 .
	`Çme
(name() + ".neitherReadNorWriteReqs")

1371 .
	`desc
("Number of„equestshat‡re‚either„ead‚or write");

1373 
³rBªkRdBur¡s


1374 .
	`š™
(
bªksP”Rªk
 * 
¿nksP”ChªÃl
)

1375 .
	`Çme
(name() + ".perBankRdBursts")

1376 .
	`desc
("Per bank write bursts");

1378 
³rBªkWrBur¡s


1379 .
	`š™
(
bªksP”Rªk
 * 
¿nksP”ChªÃl
)

1380 .
	`Çme
(name() + ".perBankWrBursts")

1381 .
	`desc
("Per bank write bursts");

1383 
avgRdQL’


1384 .
	`Çme
(name() + ".avgRdQLen")

1385 .
	`desc
("Average„ead queue†ength whenƒnqueuing")

1386 .
	`´ecisiÚ
(2);

1388 
avgWrQL’


1389 .
	`Çme
(name() + ".avgWrQLen")

1390 .
	`desc
("Average write queue†ength whenƒnqueuing")

1391 .
	`´ecisiÚ
(2);

1393 
tÙQL©


1394 .
	`Çme
(name() + ".totQLat")

1395 .
	`desc
("Totalicks spent queuing");

1397 
tÙBªkL©


1398 .
	`Çme
(name() + ".totBankLat")

1399 .
	`desc
("Totalicks spent‡ccessing banks");

1401 
tÙBusL©


1402 .
	`Çme
(name() + ".totBusLat")

1403 .
	`desc
("Totalicks spent in databusransfers");

1405 
tÙMemAccL©


1406 .
	`Çme
(name() + ".totMemAccLat")

1407 .
	`desc
("Totalicks spent from burst creation until serviced "

1410 
avgQL©


1411 .
	`Çme
(name() + ".avgQLat")

1412 .
	`desc
("Average queueing delay…er DRAM burst")

1413 .
	`´ecisiÚ
(2);

1415 
avgQL©
 = 
tÙQL©
 / (
»adBur¡s
 - 
£rviûdByWrQ
);

1417 
avgBªkL©


1418 .
	`Çme
(name() + ".avgBankLat")

1419 .
	`desc
("Average bank‡ccess†atency…er DRAM burst")

1420 .
	`´ecisiÚ
(2);

1422 
avgBªkL©
 = 
tÙBªkL©
 / (
»adBur¡s
 - 
£rviûdByWrQ
);

1424 
avgBusL©


1425 .
	`Çme
(name() + ".avgBusLat")

1426 .
	`desc
("Average bus†atency…er DRAM burst")

1427 .
	`´ecisiÚ
(2);

1429 
avgBusL©
 = 
tÙBusL©
 / (
»adBur¡s
 - 
£rviûdByWrQ
);

1431 
avgMemAccL©


1432 .
	`Çme
(name() + ".avgMemAccLat")

1433 .
	`desc
("Average memory‡ccess†atency…er DRAM burst")

1434 .
	`´ecisiÚ
(2);

1436 
avgMemAccL©
 = 
tÙMemAccL©
 / (
»adBur¡s
 - 
£rviûdByWrQ
);

1438 
numRdR‘ry


1439 .
	`Çme
(name() + ".numRdRetry")

1440 .
	`desc
("Number ofimes„ead queue was full causing„etry");

1442 
numWrR‘ry


1443 .
	`Çme
(name() + ".numWrRetry")

1444 .
	`desc
("Number ofimes write queue was full causing„etry");

1446 
»adRowH™s


1447 .
	`Çme
(name() + ".readRowHits")

1448 .
	`desc
("Number of„ow buffer hits during„eads");

1450 
wr™eRowH™s


1451 .
	`Çme
(name() + ".writeRowHits")

1452 .
	`desc
("Number of„ow buffer hits during writes");

1454 
»adRowH™R©e


1455 .
	`Çme
(name() + ".readRowHitRate")

1456 .
	`desc
("Row buffer hit„ate for„eads")

1457 .
	`´ecisiÚ
(2);

1459 
»adRowH™R©e
 = (
»adRowH™s
 / (
»adBur¡s
 - 
£rviûdByWrQ
)) * 100;

1461 
wr™eRowH™R©e


1462 .
	`Çme
(name() + ".writeRowHitRate")

1463 .
	`desc
("Row buffer hit„ate for writes")

1464 .
	`´ecisiÚ
(2);

1466 
wr™eRowH™R©e
 = (
wr™eRowH™s
 / (
wr™eBur¡s
 - 
m”gedWrBur¡s
)) * 100;

1468 
»adPktSize


1469 .
	`š™
(
	`ûLog2
(
bur¡Size
) + 1)

1470 .
	`Çme
(name() + ".readPktSize")

1471 .
	`desc
("Read„equest sizes (log2)");

1473 
wr™ePktSize


1474 .
	`š™
(
	`ûLog2
(
bur¡Size
) + 1)

1475 .
	`Çme
(name() + ".writePktSize")

1476 .
	`desc
("Write„equest sizes (log2)");

1478 
rdQL’Pdf


1479 .
	`š™
(
»adBufãrSize
)

1480 .
	`Çme
(name() + ".rdQLenPdf")

1481 .
	`desc
("What„ead queue†ength does‡n incoming„eq see");

1483 
wrQL’Pdf


1484 .
	`š™
(
wr™eBufãrSize
)

1485 .
	`Çme
(name() + ".wrQLenPdf")

1486 .
	`desc
("What write queue†ength does‡n incoming„eq see");

1488 
by‹sP”Aùiv©e


1489 .
	`š™
(
rowBufãrSize
)

1490 .
	`Çme
(name() + ".bytesPerActivate")

1491 .
	`desc
("Bytes‡ccessed…er„ow‡ctivation")

1492 .
	`æags
(
noz”o
);

1494 
by‹sR—dDRAM


1495 .
	`Çme
(name() + ".bytesReadDRAM")

1496 .
	`desc
("Total‚umber of bytes„ead from DRAM");

1498 
by‹sR—dWrQ


1499 .
	`Çme
(name() + ".bytesReadWrQ")

1500 .
	`desc
("Total‚umber of bytes„ead from write queue");

1502 
by‹sWr™‹n


1503 .
	`Çme
(name() + ".bytesWritten")

1504 .
	`desc
("Total‚umber of bytes writteno DRAM");

1506 
by‹sR—dSys


1507 .
	`Çme
(name() + ".bytesReadSys")

1508 .
	`desc
("Total„ead bytes fromhe system interface side");

1510 
by‹sWr™‹nSys


1511 .
	`Çme
(name() + ".bytesWrittenSys")

1512 .
	`desc
("Total written bytes fromhe system interface side");

1514 
avgRdBW


1515 .
	`Çme
(name() + ".avgRdBW")

1516 .
	`desc
("Average DRAM„ead bandwidth in MiByte/s")

1517 .
	`´ecisiÚ
(2);

1519 
avgRdBW
 = (
by‹sR—dDRAM
 / 1000000è/ 
simSecÚds
;

1521 
avgWrBW


1522 .
	`Çme
(name() + ".avgWrBW")

1523 .
	`desc
("Average‡chieved write bandwidth in MiByte/s")

1524 .
	`´ecisiÚ
(2);

1526 
avgWrBW
 = (
by‹sWr™‹n
 / 1000000è/ 
simSecÚds
;

1528 
avgRdBWSys


1529 .
	`Çme
(name() + ".avgRdBWSys")

1530 .
	`desc
("Average system„ead bandwidth in MiByte/s")

1531 .
	`´ecisiÚ
(2);

1533 
avgRdBWSys
 = (
by‹sR—dSys
 / 1000000è/ 
simSecÚds
;

1535 
avgWrBWSys


1536 .
	`Çme
(name() + ".avgWrBWSys")

1537 .
	`desc
("Average system write bandwidth in MiByte/s")

1538 .
	`´ecisiÚ
(2);

1540 
avgWrBWSys
 = (
by‹sWr™‹nSys
 / 1000000è/ 
simSecÚds
;

1542 
³akBW


1543 .
	`Çme
(name() + ".peakBW")

1544 .
	`desc
("Theoretical…eak bandwidth in MiByte/s")

1545 .
	`´ecisiÚ
(2);

1547 
³akBW
 = (
SimClock
::
F»qu’cy
 / 
tBURST
è* 
bur¡Size
 / 1000000;

1549 
busUt


1550 .
	`Çme
(name() + ".busUtil")

1551 .
	`desc
("Data bus utilization in…ercentage")

1552 .
	`´ecisiÚ
(2);

1554 
busUt
 = (
avgRdBW
 + 
avgWrBW
è/ 
³akBW
 * 100;

1556 
tÙG­


1557 .
	`Çme
(name() + ".totGap")

1558 .
	`desc
("Total gap between„equests");

1560 
avgG­


1561 .
	`Çme
(name() + ".avgGap")

1562 .
	`desc
("Average gap between„equests")

1563 .
	`´ecisiÚ
(2);

1565 
avgG­
 = 
tÙG­
 / (
»adReqs
 + 
wr™eReqs
);

1568 
busUtR—d


1569 .
	`Çme
(name() + ".busUtilRead")

1570 .
	`desc
("Data bus utilization in…ercentage for„eads")

1571 .
	`´ecisiÚ
(2);

1573 
busUtR—d
 = 
avgRdBW
 / 
³akBW
 * 100;

1575 
busUtWr™e


1576 .
	`Çme
(name() + ".busUtilWrite")

1577 .
	`desc
("Data bus utilization in…ercentage for writes")

1578 .
	`´ecisiÚ
(2);

1580 
busUtWr™e
 = 
avgWrBW
 / 
³akBW
 * 100;

1582 
·geH™R©e


1583 .
	`Çme
(name() + ".pageHitRate")

1584 .
	`desc
("Row buffer hit„ate,„ead‡nd write combined")

1585 .
	`´ecisiÚ
(2);

1587 
·geH™R©e
 = (
wr™eRowH™s
 + 
»adRowH™s
) /

1588 (
wr™eBur¡s
 - 
m”gedWrBur¡s
 + 
»adBur¡s
 - 
£rviûdByWrQ
) * 100;

1590 
´ech¬geAÎP”ûÁ


1591 .
	`Çme
(name() + ".prechargeAllPercent")

1592 .
	`desc
("Percentage ofime for which DRAM has‡llhe banks in "

1594 .
	`´ecisiÚ
(2);

1596 
´ech¬geAÎP”ûÁ
 = 
´ech¬geAÎTime
 / 
simTicks
 * 100;

1597 
	}
}

1600 
	gSim¶eDRAM
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

1603 
	`funùiÚ®Acûss
(
pkt
);

1604 
	}
}

1606 
	gBa£SÏvePÜt
&

1607 
	gSim¶eDRAM
::
	$g‘SÏvePÜt
(cÚ¡ 
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

1609 ià(
if_Çme
 != "port") {

1610  
MemObjeù
::
	`g‘SÏvePÜt
(
if_Çme
, 
idx
);

1612  
pÜt
;

1614 
	}
}

1617 
	gSim¶eDRAM
::
	$d¿š
(
D¿šMªag”
 *
dm
)

1619 
couÁ
 = 
pÜt
.
	`d¿š
(
dm
);

1623 ià(!(
wr™eQueue
.
	`em±y
(è&& 
»adQueue
.empty() &&

1624 
»¥Queue
.
	`em±y
())) {

1625 
	`DPRINTF
(
D¿š
, "DRAM controller‚ot drained, write: %d,„ead: %d,"

1626 "„e¥: %d\n", 
wr™eQueue
.
	`size
(), 
»adQueue
.size(),

1627 
»¥Queue
.
	`size
());

1628 ++
couÁ
;

1629 
d¿šMªag”
 = 
dm
;

1634 ià(
»adQueue
.
	`em±y
(è&& !
wr™eQueue
.empty() &&

1635 !
wr™eEv’t
.
	`scheduËd
())

1636 
	`Œigg”Wr™es
();

1639 ià(
couÁ
)

1640 
	`£tD¿šS‹
(
D¿šabË
::
D¿ššg
);

1642 
	`£tD¿šS‹
(
D¿šabË
::
D¿šed
);

1643  
couÁ
;

1644 
	}
}

1646 
	gSim¶eDRAM
::
MemÜyPÜt
::MemÜyPÜt(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
Sim¶eDRAM
& 
_memÜy
)

1647 : 
QueuedSÏvePÜt
(
Çme
, &
_memÜy
, 
queue
), queue(_memÜy, *
this
),

1648 
	$memÜy
(
_memÜy
)

1649 { 
	}
}

1651 
AddrRªgeLi¡


1652 
	gSim¶eDRAM
::
MemÜyPÜt
::
	$g‘AddrRªges
() const

1654 
AddrRªgeLi¡
 
¿nges
;

1655 
¿nges
.
	`push_back
(
memÜy
.
	`g‘AddrRªge
());

1656  
¿nges
;

1657 
	}
}

1660 
	gSim¶eDRAM
::
MemÜyPÜt
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

1662 
pkt
->
	`pushLab–
(
memÜy
.
	`Çme
());

1664 ià(!
queue
.
	`checkFunùiÚ®
(
pkt
)) {

1668 
memÜy
.
	`»cvFunùiÚ®
(
pkt
);

1671 
pkt
->
	`pİLab–
();

1672 
	}
}

1674 
Tick


1675 
	gSim¶eDRAM
::
MemÜyPÜt
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

1677  
memÜy
.
	`»cvAtomic
(
pkt
);

1678 
	}
}

1680 
boŞ


1681 
	gSim¶eDRAM
::
MemÜyPÜt
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

1684  
memÜy
.
	`»cvTimšgReq
(
pkt
);

1685 
	}
}

1687 
Sim¶eDRAM
*

1688 
	gSim¶eDRAMP¬ams
::
	$ü—‹
()

1690  
Ãw
 
	`Sim¶eDRAM
(
this
);

1691 
	}
}

	@simple_dram.hh

50 #iâdeà
__MEM_SIMPLE_DRAM_HH__


51 
	#__MEM_SIMPLE_DRAM_HH__


	)

53 
	~<deque
>

55 
	~"ba£/¡©i¡ics.hh
"

56 
	~"’ums/AddrM­.hh
"

57 
	~"’ums/MemSched.hh
"

58 
	~"’ums/PageMªage.hh
"

59 
	~"mem/ab¡¿ù_mem.hh
"

60 
	~"mem/qpÜt.hh
"

61 
	~"·¿ms/Sim¶eDRAM.hh
"

62 
	~"sim/ev’tq.hh
"

83 şas 
	cSim¶eDRAM
 : 
public
 
Ab¡¿ùMemÜy


86 
´iv©e
:

90 şas 
	cMemÜyPÜt
 : 
public
 
QueuedSÏvePÜt


93 
SÏvePack‘Queue
 
queue
;

94 
	mSim¶eDRAM
& 
	mmemÜy
;

96 
	mpublic
:

98 
MemÜyPÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
Sim¶eDRAM
& 
_memÜy
);

100 
	m´Ùeùed
:

102 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

104 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

106 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
);

108 
vœtu®
 
AddrRªgeLi¡
 
g‘AddrRªges
() const;

116 
MemÜyPÜt
 
	gpÜt
;

121 
boŞ
 
	g»ŒyRdReq
;

122 
boŞ
 
	g»ŒyWrReq
;

127 
boŞ
 
	growH™FÏg
;

134 
boŞ
 
	g¡İR—ds
;

137 
	g¡d
::
veùÜ
<
¡d
::
deque
<
Tick
>> 
aùTicks
;

145 şas 
	cBªk


148 
	gpublic
:

150 cÚ¡ 
ušt32_t
 
INVALID_ROW
 = -1;

152 
ušt32_t
 
	gİ’Row
;

154 
Tick
 
	gä“At
;

155 
Tick
 
	gtRASDÚeAt
;

156 
Tick
 
	gaùAÎowedAt
;

158 
ušt32_t
 
	gby‹sAcûs£d
;

160 
Bªk
() :

161 
İ’Row
(
INVALID_ROW
), 
ä“At
(0), 
tRASDÚeAt
(0), 
aùAÎowedAt
(0),

162 
by‹sAcûs£d
(0)

172 şas 
	cBur¡H–³r
 {

174 
	gpublic
:

177 cÚ¡ 
bur¡CouÁ
;

180 
	gbur¡sS”viûd
;

182 
Bur¡H–³r
(
_bur¡CouÁ
)

183 : 
bur¡CouÁ
(
_bur¡CouÁ
), 
bur¡sS”viûd
(0)

191 şas 
	cDRAMPack‘
 {

193 
	gpublic
:

196 cÚ¡ 
Tick
 
’ŒyTime
;

199 
Tick
 
	g»adyTime
;

202 cÚ¡ 
Pack‘PŒ
 
	gpkt
;

204 cÚ¡ 
boŞ
 
	gisR—d
;

207 cÚ¡ 
ušt8_t
 
	g¿nk
;

208 cÚ¡ 
ušt8_t
 
	gbªk
;

209 cÚ¡ 
ušt16_t
 
	grow
;

216 cÚ¡ 
ušt16_t
 
	gbªkId
;

224 
Addr
 
	gaddr
;

230 
	gsize
;

236 
Bur¡H–³r
* 
	gbur¡H–³r
;

237 
	gBªk
& 
	gbªkRef
;

239 
DRAMPack‘
(
Pack‘PŒ
 
_pkt
, 
boŞ
 
is_»ad
, 
ušt8_t
 
_¿nk
, ušt8_ˆ
_bªk
,

240 
ušt16_t
 
_row
, ušt16_ˆ
bªk_id
, 
Addr
 
_addr
,

241 
_size
, 
Bªk
& 
bªk_»f
)

242 : 
’ŒyTime
(
curTick
()), 
»adyTime
(curTick()),

243 
pkt
(
_pkt
), 
isR—d
(
is_»ad
), 
¿nk
(
_¿nk
), 
bªk
(
_bªk
), 
row
(
_row
),

244 
bªkId
(
bªk_id
), 
addr
(
_addr
), 
size
(
_size
), 
bur¡H–³r
(
NULL
),

245 
bªkRef
(
bªk_»f
)

256 
´oûssWr™eEv’t
();

257 
	gEv’tW¿µ”
<
	gSim¶eDRAM
, &Sim¶eDRAM::
´oûssWr™eEv’t
> 
wr™eEv’t
;

259 
´oûssRe¥ÚdEv’t
();

260 
	gEv’tW¿µ”
<
	gSim¶eDRAM
, &Sim¶eDRAM::
´oûssRe¥ÚdEv’t
> 
»¥ÚdEv’t
;

262 
´oûssReäeshEv’t
();

263 
	gEv’tW¿µ”
<
	gSim¶eDRAM
, &Sim¶eDRAM::
´oûssReäeshEv’t
> 
»äeshEv’t
;

265 
´oûssNextReqEv’t
();

266 
	gEv’tW¿µ”
<
	gSim¶eDRAM
,&Sim¶eDRAM::
´oûssNextReqEv’t
> 
ÃxtReqEv’t
;

275 
boŞ
 
	$»adQueueFuÎ
(
pktCouÁ
) const;

283 
boŞ
 
	$wr™eQueueFuÎ
(
pktCouÁ
) const;

299 
	`addToR—dQueue
(
Pack‘PŒ
 
pkt
, 
pktCouÁ
);

312 
	`addToWr™eQueue
(
Pack‘PŒ
 
pkt
, 
pktCouÁ
);

324 
	`doDRAMAcûss
(
DRAMPack‘
* 
d¿m_pkt
);

330 
	`Œigg”Wr™es
();

341 
	`acûssAndRe¥Úd
(
Pack‘PŒ
 
pkt
, 
Tick
 
¡©ic_Ï‹ncy
);

355 
DRAMPack‘
* 
	`decodeAddr
(
Pack‘PŒ
 
pkt
, 
Addr
 
d¿mPktAddr
, 
size
, 
boŞ
 
isR—d
);

364 
boŞ
 
	`choo£NextR—d
();

371 
	`scheduËNextReq
();

385 
¡d
::
·œ
<
Tick
, Tick> 
	`e¡im©eL©’cy
(
DRAMPack‘
* 
d¿m_pkt
, Tick 
šTime
);

393 
	`moveToRe¥Q
();

398 
	`choo£NextWr™e
();

404 
	`»Üd”Queue
(
¡d
::
deque
<
DRAMPack‘
*>& 
queue
);

412 
Tick
 
	$maxBªkF»eAt
() const;

421 
ušt64_t
 
	`mšBªkF»eAt
(cÚ¡ 
¡d
::
deque
<
DRAMPack‘
*>& 
queue
) const;

429 
	`»cÜdAùiv©e
(
Tick
 
aù_tick
, 
ušt8_t
 
¿nk
, ušt8_ˆ
bªk
);

431 
	$´štP¬ams
() const;

432 
	$´štQs
() const;

437 
¡d
::
deque
<
DRAMPack‘
*> 
»adQueue
;

438 
¡d
::
deque
<
DRAMPack‘
*> 
wr™eQueue
;

448 
¡d
::
deque
<
DRAMPack‘
*> 
»¥Queue
;

454 
D¿šMªag”
 *
d¿šMªag”
;

460 
¡d
::
veùÜ
<¡d::veùÜ<
Bªk
> > 
bªks
;

468 cÚ¡ 
ušt32_t
 
deviûBusWidth
;

469 cÚ¡ 
ušt32_t
 
bur¡L’gth
;

470 cÚ¡ 
ušt32_t
 
deviûRowBufãrSize
;

471 cÚ¡ 
ušt32_t
 
deviûsP”Rªk
;

472 cÚ¡ 
ušt32_t
 
bur¡Size
;

473 cÚ¡ 
ušt32_t
 
rowBufãrSize
;

474 cÚ¡ 
ušt32_t
 
¿nksP”ChªÃl
;

475 cÚ¡ 
ušt32_t
 
bªksP”Rªk
;

476 cÚ¡ 
ušt32_t
 
chªÃls
;

477 
ušt32_t
 
rowsP”Bªk
;

478 
ušt32_t
 
cŞumnsP”RowBufãr
;

479 cÚ¡ 
ušt32_t
 
»adBufãrSize
;

480 cÚ¡ 
ušt32_t
 
wr™eBufãrSize
;

481 cÚ¡ 
wr™eHighTh»shŞdP”c
;

482 
ušt32_t
 
wr™eHighTh»shŞd
;

483 cÚ¡ 
wr™eLowTh»shŞdP”c
;

484 
ušt32_t
 
wr™eLowTh»shŞd
;

490 cÚ¡ 
Tick
 
tWTR
;

491 cÚ¡ 
Tick
 
tBURST
;

492 cÚ¡ 
Tick
 
tRCD
;

493 cÚ¡ 
Tick
 
tCL
;

494 cÚ¡ 
Tick
 
tRP
;

495 cÚ¡ 
Tick
 
tRAS
;

496 cÚ¡ 
Tick
 
tRFC
;

497 cÚ¡ 
Tick
 
tREFI
;

498 cÚ¡ 
Tick
 
tRRD
;

499 cÚ¡ 
Tick
 
tXAW
;

500 cÚ¡ 
ušt32_t
 
aùiv©iÚLim™
;

506 
Enums
::
MemSched
 
memSchedPŞicy
;

507 
Enums
::
AddrM­
 
addrM­pšg
;

508 
Enums
::
PageMªage
 
·geMgmt
;

515 cÚ¡ 
Tick
 
äÚ‹ndL©’cy
;

522 cÚ¡ 
Tick
 
back’dL©’cy
;

527 
Tick
 
busBusyUÁ
;

529 
Tick
 
wr™eS¹Time
;

530 
Tick
 
´evA¼iv®
;

531 
numReqs
;

534 
ušt32_t
 
numWr™esThisTime
;

540 
Tick
 
ÃwTime
;

543 
Sts
::
SÿÏr
 
»adReqs
;

544 
Sts
::
SÿÏr
 
wr™eReqs
;

545 
Sts
::
SÿÏr
 
»adBur¡s
;

546 
Sts
::
SÿÏr
 
wr™eBur¡s
;

547 
Sts
::
SÿÏr
 
by‹sR—dDRAM
;

548 
Sts
::
SÿÏr
 
by‹sR—dWrQ
;

549 
Sts
::
SÿÏr
 
by‹sWr™‹n
;

550 
Sts
::
SÿÏr
 
by‹sR—dSys
;

551 
Sts
::
SÿÏr
 
by‹sWr™‹nSys
;

552 
Sts
::
SÿÏr
 
£rviûdByWrQ
;

553 
Sts
::
SÿÏr
 
m”gedWrBur¡s
;

554 
Sts
::
SÿÏr
 
Ã™h”R—dNÜWr™e
;

555 
Sts
::
VeùÜ
 
³rBªkRdBur¡s
;

556 
Sts
::
VeùÜ
 
³rBªkWrBur¡s
;

557 
Sts
::
SÿÏr
 
numRdR‘ry
;

558 
Sts
::
SÿÏr
 
numWrR‘ry
;

559 
Sts
::
SÿÏr
 
tÙG­
;

560 
Sts
::
VeùÜ
 
»adPktSize
;

561 
Sts
::
VeùÜ
 
wr™ePktSize
;

562 
Sts
::
VeùÜ
 
rdQL’Pdf
;

563 
Sts
::
VeùÜ
 
wrQL’Pdf
;

564 
Sts
::
Hi¡og¿m
 
by‹sP”Aùiv©e
;

567 
Sts
::
SÿÏr
 
tÙQL©
;

568 
Sts
::
SÿÏr
 
tÙMemAccL©
;

569 
Sts
::
SÿÏr
 
tÙBusL©
;

570 
Sts
::
SÿÏr
 
tÙBªkL©
;

573 
Sts
::
FÜmuÏ
 
avgQL©
;

574 
Sts
::
FÜmuÏ
 
avgBªkL©
;

575 
Sts
::
FÜmuÏ
 
avgBusL©
;

576 
Sts
::
FÜmuÏ
 
avgMemAccL©
;

579 
Sts
::
FÜmuÏ
 
avgRdBW
;

580 
Sts
::
FÜmuÏ
 
avgWrBW
;

581 
Sts
::
FÜmuÏ
 
avgRdBWSys
;

582 
Sts
::
FÜmuÏ
 
avgWrBWSys
;

583 
Sts
::
FÜmuÏ
 
³akBW
;

584 
Sts
::
FÜmuÏ
 
busUt
;

585 
Sts
::
FÜmuÏ
 
busUtR—d
;

586 
Sts
::
FÜmuÏ
 
busUtWr™e
;

589 
Sts
::
Av”age
 
avgRdQL’
;

590 
Sts
::
Av”age
 
avgWrQL’
;

593 
Sts
::
SÿÏr
 
»adRowH™s
;

594 
Sts
::
SÿÏr
 
wr™eRowH™s
;

595 
Sts
::
FÜmuÏ
 
»adRowH™R©e
;

596 
Sts
::
FÜmuÏ
 
wr™eRowH™R©e
;

597 
Sts
::
FÜmuÏ
 
avgG­
;

600 
Sts
::
FÜmuÏ
 
·geH™R©e
;

601 
Sts
::
FÜmuÏ
 
´ech¬geAÎP”ûÁ
;

602 
Sts
::
SÿÏr
 
´ech¬geAÎTime
;

605 
Tick
 
¡¬tTickP»ch¬geAÎ
;

607 
numBªksAùive
;

613 
¡d
::
veùÜ
<
Pack‘PŒ
> 
³ndšgD–‘e
;

615 
public
:

617 
	`»gSts
();

619 
	`Sim¶eDRAM
(cÚ¡ 
Sim¶eDRAMP¬ams
* 
p
);

621 
	`d¿š
(
D¿šMªag”
* 
dm
);

623 
vœtu®
 
Ba£SÏvePÜt
& 
	`g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

624 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

626 
vœtu®
 
	`š™
();

627 
vœtu®
 
	`¡¬tup
();

629 
´Ùeùed
:

631 
Tick
 
	`»cvAtomic
(
Pack‘PŒ
 
pkt
);

632 
	`»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

633 
boŞ
 
	`»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

635 
	}
};

	@simple_mem.cc

45 
	~"ba£/¿ndom.hh
"

46 
	~"mem/sim¶e_mem.hh
"

48 
usšg
 
Çme¥aû
 
	g¡d
;

50 
	gSim¶eMemÜy
::
	$Sim¶eMemÜy
(cÚ¡ 
Sim¶eMemÜyP¬ams
* 
p
) :

51 
	`Ab¡¿ùMemÜy
(
p
),

52 
	`pÜt
(
	`Çme
(è+ ".pÜt", *
this
), 
	`Ï‹ncy
(
p
->
Ï‹ncy
),

53 
	`Ï‹ncy_v¬
(
p
->
Ï‹ncy_v¬
), 
	`bªdwidth
Õ->
bªdwidth
), 
	`isBusy
(
çl£
),

54 
	`»ŒyReq
(
çl£
), 
	`»ŒyRe¥
(false),

55 
	`»Ëa£Ev’t
(
this
), 
	`dequeueEv’t
Ñhis), 
	$d¿šMªag”
(
NULL
)

57 
	}
}

60 
	gSim¶eMemÜy
::
	$š™
()

64 ià(
pÜt
.
	`isCÚÃùed
()) {

65 
pÜt
.
	`£ndRªgeChªge
();

67 
	}
}

69 
Tick


70 
	gSim¶eMemÜy
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

72 
	`acûss
(
pkt
);

73  
pkt
->
	`memInhib™As£¹ed
(è? 0 : 
	`g‘L©’cy
();

74 
	}
}

77 
	gSim¶eMemÜy
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

79 
pkt
->
	`pushLab–
(
	`Çme
());

81 
	`funùiÚ®Acûss
(
pkt
);

84 autØ
i
 = 
·ck‘Queue
.
	`begš
(); i !ğ·ck‘Queue.
	`’d
(); ++i)

85 
pkt
->
	`checkFunùiÚ®
(
i
->pkt);

87 
pkt
->
	`pİLab–
();

88 
	}
}

90 
boŞ


91 
	gSim¶eMemÜy
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

95 
x
 = 0; x < 
³ndšgD–‘e
.
	`size
(); x++)

96 
d–‘e
 
³ndšgD–‘e
[
x
];

97 
³ndšgD–‘e
.
	`ş—r
();

99 ià(
pkt
->
	`memInhib™As£¹ed
()) {

102 
³ndšgD–‘e
.
	`push_back
(
pkt
);

103  
Œue
;

110 ià(
»ŒyReq
)

111  
çl£
;

115 ià(
isBusy
) {

116 
»ŒyReq
 = 
Œue
;

117  
çl£
;

121 
pkt
->
busFœ¡WÜdD–ay
 =…kt->
busLa¡WÜdD–ay
 = 0;

131 ià(
pkt
->
	`isR—d
(è||…kt->
	`isWr™e
()) {

134 
Tick
 
du¿tiÚ
 = 
pkt
->
	`g‘Size
(è* 
bªdwidth
;

139 ià(
du¿tiÚ
 != 0) {

140 
	`scheduË
(
»Ëa£Ev’t
, 
	`curTick
(è+ 
du¿tiÚ
);

141 
isBusy
 = 
Œue
;

147 
boŞ
 
ÃedsRe¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
();

148 
	`»cvAtomic
(
pkt
);

150 ià(
ÃedsRe¥Ú£
) {

153 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

157 
·ck‘Queue
.
	`push_back
(
	`Deã¼edPack‘
(
pkt
, 
	`curTick
(è+ 
	`g‘L©’cy
()));

158 ià(!
»ŒyRe¥
 && !
dequeueEv’t
.
	`scheduËd
())

159 
	`scheduË
(
dequeueEv’t
, 
·ck‘Queue
.
	`back
().
tick
);

161 
³ndšgD–‘e
.
	`push_back
(
pkt
);

164  
Œue
;

165 
	}
}

168 
	gSim¶eMemÜy
::
	$»Ëa£
()

170 
	`as£¹
(
isBusy
);

171 
isBusy
 = 
çl£
;

172 ià(
»ŒyReq
) {

173 
»ŒyReq
 = 
çl£
;

174 
pÜt
.
	`£ndR‘ry
();

176 
	}
}

179 
	gSim¶eMemÜy
::
	$dequeue
()

181 
	`as£¹
(!
·ck‘Queue
.
	`em±y
());

182 
Deã¼edPack‘
 
deã¼ed_pkt
 = 
·ck‘Queue
.
	`äÚt
();

184 
»ŒyRe¥
 = !
pÜt
.
	`£ndTimšgRe¥
(
deã¼ed_pkt
.
pkt
);

186 ià(!
»ŒyRe¥
) {

187 
·ck‘Queue
.
	`pİ_äÚt
();

191 ià(!
·ck‘Queue
.
	`em±y
()) {

194 
	`»scheduË
(
dequeueEv’t
,

195 
¡d
::
	`max
(
·ck‘Queue
.
	`äÚt
().
tick
, 
	`curTick
()), 
Œue
);

196 } ià(
d¿šMªag”
) {

197 
d¿šMªag”
->
	`sigÇlD¿šDÚe
();

198 
d¿šMªag”
 = 
NULL
;

201 
	}
}

203 
Tick


204 
	gSim¶eMemÜy
::
	$g‘L©’cy
() const

206  
Ï‹ncy
 +

207 (
Ï‹ncy_v¬
 ? 
¿ndom_mt
.
¿ndom
<
Tick
>(0,†atency_var) : 0);

208 
	}
}

211 
	gSim¶eMemÜy
::
	$»cvR‘ry
()

213 
	`as£¹
(
»ŒyRe¥
);

215 
	`dequeue
();

216 
	}
}

218 
	gBa£SÏvePÜt
 &

219 
	gSim¶eMemÜy
::
g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
 &
if_Çme
, 
PÜtID
 
idx
)

221 ià(
	gif_Çme
 != "port") {

222  
MemObjeù
::
g‘SÏvePÜt
(
if_Çme
, 
idx
);

224  
	gpÜt
;

229 
	gSim¶eMemÜy
::
	$d¿š
(
D¿šMªag”
 *
dm
)

231 
couÁ
 = 0;

234 ià(!
·ck‘Queue
.
	`em±y
()) {

235 
couÁ
 += 1;

236 
d¿šMªag”
 = 
dm
;

239 ià(
couÁ
)

240 
	`£tD¿šS‹
(
D¿šabË
::
D¿ššg
);

242 
	`£tD¿šS‹
(
D¿šabË
::
D¿šed
);

243  
couÁ
;

244 
	}
}

246 
	gSim¶eMemÜy
::
MemÜyPÜt
::MemÜyPÜt(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
,

247 
Sim¶eMemÜy
& 
_memÜy
)

248 : 
SÏvePÜt
(
_Çme
, &
_memÜy
), 
	$memÜy
(
_memÜy
)

249 { 
	}
}

251 
AddrRªgeLi¡


252 
	gSim¶eMemÜy
::
MemÜyPÜt
::
	$g‘AddrRªges
() const

254 
AddrRªgeLi¡
 
¿nges
;

255 
¿nges
.
	`push_back
(
memÜy
.
	`g‘AddrRªge
());

256  
¿nges
;

257 
	}
}

259 
Tick


260 
	gSim¶eMemÜy
::
MemÜyPÜt
::
	$»cvAtomic
(
Pack‘PŒ
 
pkt
)

262  
memÜy
.
	`»cvAtomic
(
pkt
);

263 
	}
}

266 
	gSim¶eMemÜy
::
MemÜyPÜt
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

268 
memÜy
.
	`»cvFunùiÚ®
(
pkt
);

269 
	}
}

271 
boŞ


272 
	gSim¶eMemÜy
::
MemÜyPÜt
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

274  
memÜy
.
	`»cvTimšgReq
(
pkt
);

275 
	}
}

278 
	gSim¶eMemÜy
::
MemÜyPÜt
::
	$»cvR‘ry
()

280 
memÜy
.
	`»cvR‘ry
();

281 
	}
}

283 
Sim¶eMemÜy
*

284 
	gSim¶eMemÜyP¬ams
::
	$ü—‹
()

286  
Ãw
 
	`Sim¶eMemÜy
(
this
);

287 
	}
}

	@simple_mem.hh

49 #iâdeà
__SIMPLE_MEMORY_HH__


50 
	#__SIMPLE_MEMORY_HH__


	)

52 
	~<deque
>

54 
	~"mem/ab¡¿ù_mem.hh
"

55 
	~"mem/pÜt.hh
"

56 
	~"·¿ms/Sim¶eMemÜy.hh
"

64 şas 
	cSim¶eMemÜy
 : 
public
 
Ab¡¿ùMemÜy


67 
´iv©e
:

73 şas 
	cDeã¼edPack‘


76 
public
:

78 cÚ¡ 
Tick
 
tick
;

79 cÚ¡ 
Pack‘PŒ
 
	mpkt
;

81 
Deã¼edPack‘
(
Pack‘PŒ
 
_pkt
, 
Tick
 
_tick
è: 
tick
(_tick), 
pkt
(_pkt)

85 şas 
	cMemÜyPÜt
 : 
public
 
SÏvePÜt


88 
´iv©e
:

90 
Sim¶eMemÜy
& 
memÜy
;

92 
	gpublic
:

94 
MemÜyPÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
, 
Sim¶eMemÜy
& 
_memÜy
);

96 
	g´Ùeùed
:

98 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
);

100 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

102 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

104 
»cvR‘ry
();

106 
AddrRªgeLi¡
 
g‘AddrRªges
() const;

110 
MemÜyPÜt
 
	gpÜt
;

116 cÚ¡ 
Tick
 
	gÏ‹ncy
;

121 cÚ¡ 
Tick
 
	gÏ‹ncy_v¬
;

128 
	g¡d
::
deque
<
Deã¼edPack‘
> 
·ck‘Queue
;

135 cÚ¡ 
	gbªdwidth
;

141 
boŞ
 
	gisBusy
;

147 
boŞ
 
	g»ŒyReq
;

153 
boŞ
 
	g»ŒyRe¥
;

159 
»Ëa£
();

161 
	gEv’tW¿µ”
<
	gSim¶eMemÜy
, &Sim¶eMemÜy::
»Ëa£
> 
»Ëa£Ev’t
;

167 
dequeue
();

169 
	gEv’tW¿µ”
<
	gSim¶eMemÜy
, &Sim¶eMemÜy::
dequeue
> 
dequeueEv’t
;

176 
Tick
 
	$g‘L©’cy
() const;

182 
¡d
::
veùÜ
<
Pack‘PŒ
> 
³ndšgD–‘e
;

188 
D¿šMªag”
 *
d¿šMªag”
;

190 
public
:

192 
	`Sim¶eMemÜy
(cÚ¡ 
Sim¶eMemÜyP¬ams
 *
p
);

194 
	`d¿š
(
D¿šMªag”
 *
dm
);

196 
Ba£SÏvePÜt
& 
	`g‘SÏvePÜt
(cÚ¡ 
¡d
::
¡ršg
& 
if_Çme
,

197 
PÜtID
 
idx
 = 
Inv®idPÜtID
);

198 
	`š™
();

200 
´Ùeùed
:

202 
Tick
 
	`»cvAtomic
(
Pack‘PŒ
 
pkt
);

204 
	`»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

206 
boŞ
 
	`»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

208 
	`»cvR‘ry
();

210 
	}
};

	@tport.cc

44 
	~"mem/mem_objeù.hh
"

45 
	~"mem/Üt.hh
"

47 
	gSim¶eTimšgPÜt
::
Sim¶eTimšgPÜt
(cÚ¡ 
¡d
::
¡ršg
& 
_Çme
,

48 
MemObjeù
* 
_owÃr
) :

49 
QueuedSÏvePÜt
(
_Çme
, 
_owÃr
, 
queueIm¶
), 
	$queueIm¶
(*
_owÃr
, *
this
)

51 
	}
}

54 
	gSim¶eTimšgPÜt
::
	$»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
)

56 ià(!
queue
.
	`checkFunùiÚ®
(
pkt
)) {

58 
	`»cvAtomic
(
pkt
);

60 
	}
}

62 
boŞ


63 
	gSim¶eTimšgPÜt
::
	$»cvTimšgReq
(
Pack‘PŒ
 
pkt
)

67 
x
 = 0; x < 
³ndšgD–‘e
.
	`size
(); x++)

68 
d–‘e
 
³ndšgD–‘e
[
x
];

69 
³ndšgD–‘e
.
	`ş—r
();

73 ià(
pkt
->
	`memInhib™As£¹ed
())

74 
	`·nic
("SimpleTimingPort should‚ever see‡n inhibited„equest\n");

76 
boŞ
 
ÃedsRe¥Ú£
 = 
pkt
->
	`ÃedsRe¥Ú£
();

77 
Tick
 
Ï‹ncy
 = 
	`»cvAtomic
(
pkt
);

79 ià(
ÃedsRe¥Ú£
) {

82 
	`as£¹
(
pkt
->
	`isRe¥Ú£
());

83 
	`schedTimšgRe¥
(
pkt
, 
	`curTick
(è+ 
Ï‹ncy
);

88 
³ndšgD–‘e
.
	`push_back
(
pkt
);

91  
Œue
;

92 
	}
}

	@tport.hh

44 #iâdeà
__MEM_TPORT_HH__


45 
	#__MEM_TPORT_HH__


	)

53 
	~"mem/qpÜt.hh
"

60 şas 
	cSim¶eTimšgPÜt
 : 
public
 
QueuedSÏvePÜt


63 
´iv©e
:

71 
SÏvePack‘Queue
 
queueIm¶
;

73 
	m´Ùeùed
:

76 
»cvFunùiÚ®
(
Pack‘PŒ
 
pkt
);

79 
boŞ
 
»cvTimšgReq
(
Pack‘PŒ
 
pkt
);

81 
vœtu®
 
Tick
 
»cvAtomic
(
Pack‘PŒ
 
pkt
) = 0;

88 
	m¡d
::
veùÜ
<
Pack‘PŒ
> 
³ndšgD–‘e
;

91 
	mpublic
:

104 
Sim¶eTimšgPÜt
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
, 
MemObjeù
* 
owÃr
);

106 
	mvœtu®
 ~
	$Sim¶eTimšgPÜt
() { }

108 
	}
};

	@/usr/include/fcntl.h

24 #iâdef 
_FCNTL_H


25 
	#_FCNTL_H
 1

	)

27 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 
	~<b™s/fú.h
>

37 #ifdeà
__USE_XOPEN


38 
	~<sys/¡©.h
>

41 #ifdef 
__USE_MISC


42 #iâdeà
R_OK


45 
	#R_OK
 4

	)

46 
	#W_OK
 2

	)

47 
	#X_OK
 1

	)

48 
	#F_OK
 0

	)

53 #ifdeà
__USE_XOPEN


54 
	#SEEK_SET
 0

	)

55 
	#SEEK_CUR
 1

	)

56 
	#SEEK_END
 2

	)

64 
fú
 (
__fd
, 
__cmd
, ...);

72 #iâdeà
__USE_FILE_OFFSET64


73 
	$İ’
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

75 #ifdeà
__REDIRECT


76 
	`__REDIRECT
 (
İ’
, (
__cÚ¡
 *
__fe
, 
__oæag
, ...), 
İ’64
)

77 
	`__nÚnuÎ
 ((1));

79 
	#İ’
 
İ’64


	)

82 #ifdeà
__USE_LARGEFILE64


83 
	$İ’64
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

86 #ifdeà
__USE_ATFILE


96 #iâdeà
__USE_FILE_OFFSET64


97 
	$İ’©
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

98 
	`__nÚnuÎ
 ((2));

100 #ifdeà
__REDIRECT


101 
	`__REDIRECT
 (
İ’©
, (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
,

102 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

104 
	#İ’©
 
İ’©64


	)

108 
	$İ’©64
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

109 
	`__nÚnuÎ
 ((2));

117 #iâdeà
__USE_FILE_OFFSET64


118 
	$ü—t
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

120 #ifdeà
__REDIRECT


121 
	`__REDIRECT
 (
ü—t
, (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
),

122 
ü—t64
è
	`__nÚnuÎ
 ((1));

124 
	#ü—t
 
ü—t64


	)

127 #ifdeà
__USE_LARGEFILE64


128 
	$ü—t64
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

131 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

132 && !
defšed
 
__USE_POSIX
))

141 
	#F_ULOCK
 0

	)

142 
	#F_LOCK
 1

	)

143 
	#F_TLOCK
 2

	)

144 
	#F_TEST
 3

	)

146 #iâdeà
__USE_FILE_OFFSET64


147 
	`lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
);

149 #ifdeà
__REDIRECT


150 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

152 
	#lockf
 
lockf64


	)

155 #ifdeà
__USE_LARGEFILE64


156 
	`lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
);

160 #ifdeà
__USE_XOPEN2K


163 #iâdeà
__USE_FILE_OFFSET64


164 
	$posix_çdvi£
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
,

165 
__advi£
è
__THROW
;

167 #ifdeà
__REDIRECT_NTH


168 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

169 
__off64_t
 
__Ën
, 
__advi£
),

170 
posix_çdvi£64
);

172 
	#posix_çdvi£
 
posix_çdvi£64


	)

175 #ifdeà
__USE_LARGEFILE64


176 
	$posix_çdvi£64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
,

177 
__advi£
è
__THROW
;

185 #iâdeà
__USE_FILE_OFFSET64


186 
	`posix_çÎoÿ‹
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

188 #ifdeà
__REDIRECT


189 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

190 
__off64_t
 
__Ën
),

191 
posix_çÎoÿ‹64
);

193 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

196 #ifdeà
__USE_LARGEFILE64


197 
	`posix_çÎoÿ‹64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
);

203 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše
 \

204 && 
defšed
 
__va_¬g_·ck_Ën


205 
	~<b™s/fú2.h
>

208 
__END_DECLS


	@/usr/include/inttypes.h

23 #iâdeà
_INTTYPES_H


24 
	#_INTTYPES_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	~<¡dšt.h
>

31 #iâdeà
____gwch¬_t_defšed


32 #ifdeà
__ılu¥lus


33 
	#__gwch¬_t
 
wch¬_t


	)

34 #–ià
defšed
 
__WCHAR_TYPE__


35 
__WCHAR_TYPE__
 
	t__gwch¬_t
;

37 
	#__Ãed_wch¬_t


	)

38 
	~<¡ddef.h
>

39 
wch¬_t
 
	t__gwch¬_t
;

41 
	#____gwch¬_t_defšed
 1

	)

47 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_FORMAT_MACROS


49 #ià
__WORDSIZE
 == 64

50 
	#__PRI64_PREFIX
 "l"

	)

51 
	#__PRIPTR_PREFIX
 "l"

	)

53 
	#__PRI64_PREFIX
 "Î"

	)

54 
	#__PRIPTR_PREFIX


	)

60 
	#PRId8
 "d"

	)

61 
	#PRId16
 "d"

	)

62 
	#PRId32
 "d"

	)

63 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

65 
	#PRIdLEAST8
 "d"

	)

66 
	#PRIdLEAST16
 "d"

	)

67 
	#PRIdLEAST32
 "d"

	)

68 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIdFAST8
 "d"

	)

71 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

72 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

73 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

76 
	#PRIi8
 "i"

	)

77 
	#PRIi16
 "i"

	)

78 
	#PRIi32
 "i"

	)

79 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

81 
	#PRIiLEAST8
 "i"

	)

82 
	#PRIiLEAST16
 "i"

	)

83 
	#PRIiLEAST32
 "i"

	)

84 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIiFAST8
 "i"

	)

87 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

88 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

89 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

92 
	#PRIo8
 "o"

	)

93 
	#PRIo16
 "o"

	)

94 
	#PRIo32
 "o"

	)

95 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

97 
	#PRIoLEAST8
 "o"

	)

98 
	#PRIoLEAST16
 "o"

	)

99 
	#PRIoLEAST32
 "o"

	)

100 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIoFAST8
 "o"

	)

103 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

104 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

105 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

108 
	#PRIu8
 "u"

	)

109 
	#PRIu16
 "u"

	)

110 
	#PRIu32
 "u"

	)

111 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

113 
	#PRIuLEAST8
 "u"

	)

114 
	#PRIuLEAST16
 "u"

	)

115 
	#PRIuLEAST32
 "u"

	)

116 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIuFAST8
 "u"

	)

119 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

120 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

121 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

124 
	#PRIx8
 "x"

	)

125 
	#PRIx16
 "x"

	)

126 
	#PRIx32
 "x"

	)

127 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

129 
	#PRIxLEAST8
 "x"

	)

130 
	#PRIxLEAST16
 "x"

	)

131 
	#PRIxLEAST32
 "x"

	)

132 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIxFAST8
 "x"

	)

135 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

136 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

137 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

140 
	#PRIX8
 "X"

	)

141 
	#PRIX16
 "X"

	)

142 
	#PRIX32
 "X"

	)

143 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

145 
	#PRIXLEAST8
 "X"

	)

146 
	#PRIXLEAST16
 "X"

	)

147 
	#PRIXLEAST32
 "X"

	)

148 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

150 
	#PRIXFAST8
 "X"

	)

151 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

152 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

153 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

157 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

158 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

159 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

160 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

161 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

162 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

166 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

167 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

168 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

169 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

170 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

171 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

177 
	#SCNd8
 "hhd"

	)

178 
	#SCNd16
 "hd"

	)

179 
	#SCNd32
 "d"

	)

180 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

182 
	#SCNdLEAST8
 "hhd"

	)

183 
	#SCNdLEAST16
 "hd"

	)

184 
	#SCNdLEAST32
 "d"

	)

185 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNdFAST8
 "hhd"

	)

188 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

189 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

190 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

193 
	#SCNi8
 "hhi"

	)

194 
	#SCNi16
 "hi"

	)

195 
	#SCNi32
 "i"

	)

196 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

198 
	#SCNiLEAST8
 "hhi"

	)

199 
	#SCNiLEAST16
 "hi"

	)

200 
	#SCNiLEAST32
 "i"

	)

201 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNiFAST8
 "hhi"

	)

204 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

205 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

206 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

209 
	#SCNu8
 "hhu"

	)

210 
	#SCNu16
 "hu"

	)

211 
	#SCNu32
 "u"

	)

212 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

214 
	#SCNuLEAST8
 "hhu"

	)

215 
	#SCNuLEAST16
 "hu"

	)

216 
	#SCNuLEAST32
 "u"

	)

217 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNuFAST8
 "hhu"

	)

220 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

221 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

222 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

225 
	#SCNo8
 "hho"

	)

226 
	#SCNo16
 "ho"

	)

227 
	#SCNo32
 "o"

	)

228 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

230 
	#SCNoLEAST8
 "hho"

	)

231 
	#SCNoLEAST16
 "ho"

	)

232 
	#SCNoLEAST32
 "o"

	)

233 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNoFAST8
 "hho"

	)

236 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

237 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

238 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

241 
	#SCNx8
 "hhx"

	)

242 
	#SCNx16
 "hx"

	)

243 
	#SCNx32
 "x"

	)

244 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

246 
	#SCNxLEAST8
 "hhx"

	)

247 
	#SCNxLEAST16
 "hx"

	)

248 
	#SCNxLEAST32
 "x"

	)

249 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

251 
	#SCNxFAST8
 "hhx"

	)

252 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

253 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

254 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

258 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

259 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

260 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

261 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

262 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

265 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

266 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

267 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

268 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

269 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

274 
	g__BEGIN_DECLS


276 #ià
__WORDSIZE
 == 64

281 
	mquÙ
;

282 
	m»m
;

283 } 
	timaxdiv_t
;

290 
	mquÙ
;

291 
	m»m
;

292 } 
	timaxdiv_t
;

298 
štmax_t
 
	$imaxabs
 (
štmax_t
 
__n
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

301 
imaxdiv_t
 
	$imaxdiv
 (
štmax_t
 
__num”
, iÁmax_ˆ
__d’om
)

302 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

305 
štmax_t
 
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

306 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

309 
uštmax_t
 
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

310 ** 
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

313 
štmax_t
 
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

314 
__gwch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

315 
__THROW
;

318 
uštmax_t
 
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

319 
__gwch¬_t
 ** 
__»¡riù
 
__’d±r
, 
__ba£
)

320 
__THROW
;

322 #ifdeà
__USE_EXTERN_INLINES


324 #ià
__WORDSIZE
 == 64

326 
	$__¡¹Ş_š‹º®
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

327 **
__»¡riù
 
__’d±r
,

328 
__ba£
, 
__group
)

329 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

331 
__ex‹º_šlše
 
štmax_t


332 
	`__NTH
 (
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

333 
ba£
))

335  
	`__¡¹Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

336 
	}
}

338 
	$__¡¹oul_š‹º®
 (
__cÚ¡
 *

339 
__»¡riù
 
__ÅŒ
,

340 ** 
__»¡riù
 
__’d±r
,

341 
__ba£
, 
__group
)

342 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

344 
__ex‹º_šlše
 
uštmax_t


345 
	`__NTH
 (
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

346 
ba£
))

348  
	`__¡¹oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

349 
	}
}

351 
	$__wc¡Ş_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 * 
__»¡riù
 
__ÅŒ
,

352 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

353 
__ba£
, 
__group
)

354 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

356 
__ex‹º_šlše
 
štmax_t


357 
	`__NTH
 (
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

358 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

360  
	`__wc¡Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

361 
	}
}

363 
	$__wc¡oul_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

364 
__»¡riù
 
__ÅŒ
,

365 
__gwch¬_t
 **

366 
__»¡riù
 
__’d±r
,

367 
__ba£
, 
__group
)

368 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

370 
__ex‹º_šlše
 
uštmax_t


371 
	`__NTH
 (
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

372 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

374  
	`__wc¡oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

375 
	}
}

379 
__ex‹nsiÚ__


380 
	$__¡¹Şl_š‹º®
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

381 **
__»¡riù
 
__’d±r
,

382 
__ba£
, 
__group
)

383 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

385 
__ex‹º_šlše
 
štmax_t


386 
	`__NTH
 (
	$¡¹oimax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

387 
ba£
))

389  
	`__¡¹Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

390 
	}
}

392 
__ex‹nsiÚ__


393 
	$__¡¹ouÎ_š‹º®
 (
__cÚ¡
 *

394 
__»¡riù
 
__ÅŒ
,

396 
__»¡riù
 
__’d±r
,

397 
__ba£
,

398 
__group
)

399 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

401 
__ex‹º_šlše
 
uštmax_t


402 
	`__NTH
 (
	$¡¹oumax
 (
__cÚ¡
 *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

403 
ba£
))

405  
	`__¡¹ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

406 
	}
}

408 
__ex‹nsiÚ__


409 
	$__wc¡Şl_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

410 
__»¡riù
 
__ÅŒ
,

411 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

412 
__ba£
, 
__group
)

413 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

415 
__ex‹º_šlše
 
štmax_t


416 
	`__NTH
 (
	$wc¡oimax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

417 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

419  
	`__wc¡Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

420 
	}
}

423 
__ex‹nsiÚ__


424 
	$__wc¡ouÎ_š‹º®
 (
__cÚ¡
 
__gwch¬_t
 *

425 
__»¡riù
 
__ÅŒ
,

426 
__gwch¬_t
 **

427 
__»¡riù
 
__’d±r
,

428 
__ba£
,

429 
__group
)

430 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

432 
__ex‹º_šlše
 
uštmax_t


433 
	`__NTH
 (
	$wc¡oumax
 (
__cÚ¡
 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

434 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

436  
	`__wc¡ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

437 
	}
}

442 
	g__END_DECLS


	@/usr/include/sys/mman.h

20 #iâdef 
_SYS_MMAN_H


21 
	#_SYS_MMAN_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	~<b™s/ty³s.h
>

25 
	#__Ãed_size_t


	)

26 
	~<¡ddef.h
>

28 #iâdeà
__off_t_defšed


29 #iâdeà
__USE_FILE_OFFSET64


30 
__off_t
 
	toff_t
;

32 
__off64_t
 
	toff_t
;

34 
	#__off_t_defšed


	)

37 #iâdeà
__mode_t_defšed


38 
__mode_t
 
	tmode_t
;

39 
	#__mode_t_defšed


	)

42 
	~<b™s/mmª.h
>

45 
	#MAP_FAILED
 ((*è-1)

	)

47 
	g__BEGIN_DECLS


57 #iâdeà
__USE_FILE_OFFSET64


58 *
	$mm­
 (*
__addr
, 
size_t
 
__Ën
, 
__´Ù
,

59 
__æags
, 
__fd
, 
__off_t
 
__off£t
è
__THROW
;

61 #ifdeà
__REDIRECT_NTH


62 * 
	`__REDIRECT_NTH
 (
mm­
,

63 (*
__addr
, 
size_t
 
__Ën
, 
__´Ù
,

64 
__æags
, 
__fd
, 
__off64_t
 
__off£t
),

65 
mm­64
);

67 
	#mm­
 
mm­64


	)

70 #ifdeà
__USE_LARGEFILE64


71 *
	$mm­64
 (*
__addr
, 
size_t
 
__Ën
, 
__´Ù
,

72 
__æags
, 
__fd
, 
__off64_t
 
__off£t
è
__THROW
;

77 
	$munm­
 (*
__addr
, 
size_t
 
__Ën
è
__THROW
;

82 
	$m´Ùeù
 (*
__addr
, 
size_t
 
__Ën
, 
__´Ù
è
__THROW
;

90 
	`msync
 (*
__addr
, 
size_t
 
__Ën
, 
__æags
);

92 #ifdeà
__USE_BSD


95 
	$madvi£
 (*
__addr
, 
size_t
 
__Ën
, 
__adviû
è
__THROW
;

97 #ifdeà
__USE_XOPEN2K


99 
	$posix_madvi£
 (*
__addr
, 
size_t
 
__Ën
, 
__adviû
è
__THROW
;

104 
	$mlock
 (
__cÚ¡
 *
__addr
, 
size_t
 
__Ën
è
__THROW
;

107 
	$muÆock
 (
__cÚ¡
 *
__addr
, 
size_t
 
__Ën
è
__THROW
;

112 
	$mlock®l
 (
__æags
è
__THROW
;

116 
	$muÆock®l
 (è
__THROW
;

118 #ifdeà
__USE_MISC


124 
	$mšcÜe
 (*
__¡¬t
, 
size_t
 
__Ën
, *
__vec
)

125 
__THROW
;

128 #ifdeà
__USE_GNU


134 *
	$m»m­
 (*
__addr
, 
size_t
 
__Şd_Ën
, size_ˆ
__Ãw_Ën
,

135 
__æags
, ...è
__THROW
;

139 
	$»m­_fe_·ges
 (*
__¡¬t
, 
size_t
 
__size
, 
__´Ù
,

140 
size_t
 
__pgoff
, 
__æags
è
__THROW
;

145 
	`shm_İ’
 (
__cÚ¡
 *
__Çme
, 
__oæag
, 
mode_t
 
__mode
);

148 
	`shm_uÆšk
 (
__cÚ¡
 *
__Çme
);

150 
__END_DECLS


	@/usr/include/sys/types.h

24 #iâdef 
_SYS_TYPES_H


25 
	#_SYS_TYPES_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


31 
	~<b™s/ty³s.h
>

33 #ifdef 
__USE_BSD


34 #iâdeà
__u_ch¬_defšed


35 
__u_ch¬
 
	tu_ch¬
;

36 
__u_shÜt
 
	tu_shÜt
;

37 
__u_št
 
	tu_št
;

38 
__u_lÚg
 
	tu_lÚg
;

39 
__quad_t
 
	tquad_t
;

40 
__u_quad_t
 
	tu_quad_t
;

41 
__fsid_t
 
	tfsid_t
;

42 
	#__u_ch¬_defšed


	)

46 
__loff_t
 
	tloff_t
;

48 #iâdeà
__šo_t_defšed


49 #iâdeà
__USE_FILE_OFFSET64


50 
__šo_t
 
	tšo_t
;

52 
__šo64_t
 
	tšo_t
;

54 
	#__šo_t_defšed


	)

56 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


57 
__šo64_t
 
	tšo64_t
;

58 
	#__šo64_t_defšed


	)

61 #iâdeà
__dev_t_defšed


62 
__dev_t
 
	tdev_t
;

63 
	#__dev_t_defšed


	)

66 #iâdeà
__gid_t_defšed


67 
__gid_t
 
	tgid_t
;

68 
	#__gid_t_defšed


	)

71 #iâdeà
__mode_t_defšed


72 
__mode_t
 
	tmode_t
;

73 
	#__mode_t_defšed


	)

76 #iâdeà
__Æšk_t_defšed


77 
__Æšk_t
 
	tÆšk_t
;

78 
	#__Æšk_t_defšed


	)

81 #iâdeà
__uid_t_defšed


82 
__uid_t
 
	tuid_t
;

83 
	#__uid_t_defšed


	)

86 #iâdeà
__off_t_defšed


87 #iâdeà
__USE_FILE_OFFSET64


88 
__off_t
 
	toff_t
;

90 
__off64_t
 
	toff_t
;

92 
	#__off_t_defšed


	)

94 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


95 
__off64_t
 
	toff64_t
;

96 
	#__off64_t_defšed


	)

99 #iâdeà
__pid_t_defšed


100 
__pid_t
 
	tpid_t
;

101 
	#__pid_t_defšed


	)

104 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
è&& !defšed 
__id_t_defšed


105 
__id_t
 
	tid_t
;

106 
	#__id_t_defšed


	)

109 #iâdeà
__ssize_t_defšed


110 
__ssize_t
 
	tssize_t
;

111 
	#__ssize_t_defšed


	)

114 #ifdef 
__USE_BSD


115 #iâdeà
__daddr_t_defšed


116 
__daddr_t
 
	tdaddr_t
;

117 
__ÿddr_t
 
	tÿddr_t
;

118 
	#__daddr_t_defšed


	)

122 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
è&& !defšed 
__key_t_defšed


123 
__key_t
 
	tkey_t
;

124 
	#__key_t_defšed


	)

127 #ifdeà
__USE_XOPEN


128 
	#__Ãed_şock_t


	)

130 
	#__Ãed_time_t


	)

131 
	#__Ãed_tim”_t


	)

132 
	#__Ãed_şockid_t


	)

133 
	~<time.h
>

135 #ifdeà
__USE_XOPEN


136 #iâdeà
__u£cÚds_t_defšed


137 
__u£cÚds_t
 
	tu£cÚds_t
;

138 
	#__u£cÚds_t_defšed


	)

140 #iâdeà
__su£cÚds_t_defšed


141 
__su£cÚds_t
 
	tsu£cÚds_t
;

142 
	#__su£cÚds_t_defšed


	)

146 
	#__Ãed_size_t


	)

147 
	~<¡ddef.h
>

149 #ifdeà
__USE_MISC


151 
	tulÚg
;

152 
	tushÜt
;

153 
	tušt
;

158 #ià!
__GNUC_PREREQ
 (2, 7)

161 #iâdeà
__št8_t_defšed


162 
	#__št8_t_defšed


	)

163 
	tšt8_t
;

164 
	tšt16_t
;

165 
	tšt32_t
;

166 #ià
__WORDSIZE
 == 64

167 
	tšt64_t
;

168 #–ià
__GLIBC_HAVE_LONG_LONG


169 
__ex‹nsiÚ__
 
	tšt64_t
;

174 
	tu_št8_t
;

175 
	tu_št16_t
;

176 
	tu_št32_t
;

177 #ià
__WORDSIZE
 == 64

178 
	tu_št64_t
;

179 #–ià
__GLIBC_HAVE_LONG_LONG


180 
__ex‹nsiÚ__
 
	tu_št64_t
;

183 
	t»gi¡”_t
;

188 
	#__štN_t
(
N
, 
MODE
) \

189 ##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

190 
	t__u_štN_t
(
	tN
, 
	tMODE
) \

191 
	tu_št
##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

193 #iâdeà
	t__št8_t_defšed


194 
	t__št8_t_defšed


	)

195 
	t__štN_t
 (8, 
	t__QI__
);

196 
__štN_t
 (16, 
__HI__
);

197 
__štN_t
 (32, 
__SI__
);

198 
__štN_t
 (64, 
__DI__
);

201 
__u_štN_t
 (8, 
__QI__
);

202 
__u_štN_t
 (16, 
__HI__
);

203 
__u_štN_t
 (32, 
__SI__
);

204 
__u_štN_t
 (64, 
__DI__
);

206 
	t»gi¡”_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__wÜd__
)));

212 
	#__BIT_TYPES_DEFINED__
 1

	)

215 #ifdef 
__USE_BSD


217 
	~<’dŸn.h
>

220 
	~<sys/£Ëù.h
>

223 
	~<sys/sysmaüos.h
>

227 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__blksize_t_defšed


228 
__blksize_t
 
	tblksize_t
;

229 
	#__blksize_t_defšed


	)

233 #iâdeà
__USE_FILE_OFFSET64


234 #iâdeà
__blkút_t_defšed


235 
__blkút_t
 
	tblkút_t
;

236 
	#__blkút_t_defšed


	)

238 #iâdeà
__fsblkút_t_defšed


239 
__fsblkút_t
 
	tfsblkút_t
;

240 
	#__fsblkút_t_defšed


	)

242 #iâdeà
__fsfút_t_defšed


243 
__fsfút_t
 
	tfsfút_t
;

244 
	#__fsfút_t_defšed


	)

247 #iâdeà
__blkút_t_defšed


248 
__blkút64_t
 
	tblkút_t
;

249 
	#__blkút_t_defšed


	)

251 #iâdeà
__fsblkút_t_defšed


252 
__fsblkút64_t
 
	tfsblkút_t
;

253 
	#__fsblkút_t_defšed


	)

255 #iâdeà
__fsfút_t_defšed


256 
__fsfút64_t
 
	tfsfút_t
;

257 
	#__fsfút_t_defšed


	)

261 #ifdeà
__USE_LARGEFILE64


262 
__blkút64_t
 
	tblkút64_t
;

263 
__fsblkút64_t
 
	tfsblkút64_t
;

264 
__fsfút64_t
 
	tfsfút64_t
;

269 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


270 
	~<b™s/±h»adty³s.h
>

273 
	g__END_DECLS


	@/usr/include/sys/user.h

19 #iâdeà
_SYS_USER_H


20 
	#_SYS_USER_H
 1

	)

26 
	~<b™s/wÜdsize.h
>

27 
	~<uni¡d.h
>

29 #ià
__WORDSIZE
 == 64

31 
	su£r_å»gs_¡ruù


33 
__ušt16_t
 
	mcwd
;

34 
__ušt16_t
 
	mswd
;

35 
__ušt16_t
 
	máw
;

36 
__ušt16_t
 
	mfİ
;

37 
__ušt64_t
 
	mr
;

38 
__ušt64_t
 
	mrdp
;

39 
__ušt32_t
 
	mmxc¤
;

40 
__ušt32_t
 
	mmxü_mask
;

41 
__ušt32_t
 
	m¡_¥aû
[32];

42 
__ušt32_t
 
	mxmm_¥aû
[64];

43 
__ušt32_t
 
	m·ddšg
[24];

46 
	su£r_»gs_¡ruù


48 
	mr15
;

49 
	mr14
;

50 
	mr13
;

51 
	mr12
;

52 
	mrbp
;

53 
	mrbx
;

54 
	mr11
;

55 
	mr10
;

56 
	mr9
;

57 
	mr8
;

58 
	m¿x
;

59 
	mrcx
;

60 
	mrdx
;

61 
	mrsi
;

62 
	mrdi
;

63 
	mÜig_¿x
;

64 
	mr
;

65 
	mcs
;

66 
	meæags
;

67 
	mr¥
;

68 
	mss
;

69 
	mfs_ba£
;

70 
	mgs_ba£
;

71 
	mds
;

72 
	mes
;

73 
	mfs
;

74 
	mgs
;

77 
	su£r


79 
u£r_»gs_¡ruù
 
	m»gs
;

80 
	mu_åv®id
;

81 
u£r_å»gs_¡ruù
 
	mi387
;

82 
	mu_tsize
;

83 
	mu_dsize
;

84 
	mu_ssize
;

85 
	m¡¬t_code
;

86 
	m¡¬t_¡ack
;

87 
	msigÇl
;

88 
	m»£rved
;

89 
u£r_»gs_¡ruù
* 
	mu_¬0
;

90 
u£r_å»gs_¡ruù
* 
	mu_å¡©e
;

91 
	mmagic
;

92 
	mu_comm
 [32];

93 
	mu_debug»g
 [8];

98 
	su£r_å»gs_¡ruù


100 
	mcwd
;

101 
	mswd
;

102 
	mtwd
;

103 
	mf
;

104 
	mfcs
;

105 
	mfoo
;

106 
	mfos
;

107 
	m¡_¥aû
 [20];

110 
	su£r_åx»gs_¡ruù


112 
	mcwd
;

113 
	mswd
;

114 
	mtwd
;

115 
	mfİ
;

116 
	mf
;

117 
	mfcs
;

118 
	mfoo
;

119 
	mfos
;

120 
	mmxc¤
;

121 
	m»£rved
;

122 
	m¡_¥aû
[32];

123 
	mxmm_¥aû
[32];

124 
	m·ddšg
[56];

127 
	su£r_»gs_¡ruù


129 
	mebx
;

130 
	mecx
;

131 
	medx
;

132 
	mesi
;

133 
	medi
;

134 
	mebp
;

135 
	m—x
;

136 
	mxds
;

137 
	mxes
;

138 
	mxfs
;

139 
	mxgs
;

140 
	mÜig_—x
;

141 
	me
;

142 
	mxcs
;

143 
	meæags
;

144 
	me¥
;

145 
	mxss
;

148 
	su£r


150 
u£r_»gs_¡ruù
 
	m»gs
;

151 
	mu_åv®id
;

152 
u£r_å»gs_¡ruù
 
	mi387
;

153 
	mu_tsize
;

154 
	mu_dsize
;

155 
	mu_ssize
;

156 
	m¡¬t_code
;

157 
	m¡¬t_¡ack
;

158 
	msigÇl
;

159 
	m»£rved
;

160 
u£r_»gs_¡ruù
* 
	mu_¬0
;

161 
u£r_å»gs_¡ruù
* 
	mu_å¡©e
;

162 
	mmagic
;

163 
	mu_comm
 [32];

164 
	mu_debug»g
 [8];

168 
	#PAGE_SIZE
 (
	`syscÚf
(
_SC_PAGESIZE
))

	)

169 
	#PAGE_MASK
 (~(
PAGE_SIZE
-1))

	)

170 
	#NBPG
 
PAGE_SIZE


	)

171 
	#UPAGES
 1

	)

172 
	#HOST_TEXT_START_ADDR
 (
u
.
¡¬t_code
)

	)

173 
	#HOST_STACK_END_ADDR
 (
u
.
¡¬t_¡ack
 + u.
u_ssize
 * 
NBPG
)

	)

	@/usr/include/unistd.h

23 #iâdef 
_UNISTD_H


24 
	#_UNISTD_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


33 #ifdeà
__USE_XOPEN2K8


35 
	#_POSIX_VERSION
 200809L

	)

36 #–ià
defšed
 
__USE_XOPEN2K


38 
	#_POSIX_VERSION
 200112L

	)

39 #–ià
defšed
 
__USE_POSIX199506


41 
	#_POSIX_VERSION
 199506L

	)

42 #–ià
defšed
 
__USE_POSIX199309


44 
	#_POSIX_VERSION
 199309L

	)

47 
	#_POSIX_VERSION
 199009L

	)

53 #ifdeà
__USE_XOPEN2K8


54 
	#__POSIX2_THIS_VERSION
 200809L

	)

56 #–ià
defšed
 
__USE_XOPEN2K


58 
	#__POSIX2_THIS_VERSION
 200112L

	)

59 #–ià
defšed
 
__USE_POSIX199506


61 
	#__POSIX2_THIS_VERSION
 199506L

	)

64 
	#__POSIX2_THIS_VERSION
 199209L

	)

68 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

72 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

76 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

80 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

84 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

87 #ifdeà
__USE_XOPEN2K8


88 
	#_XOPEN_VERSION
 700

	)

89 #–ià
defšed
 
__USE_XOPEN2K


90 
	#_XOPEN_VERSION
 600

	)

91 #–ià
defšed
 
__USE_UNIX98


92 
	#_XOPEN_VERSION
 500

	)

94 
	#_XOPEN_VERSION
 4

	)

98 
	#_XOPEN_XCU_VERSION
 4

	)

101 
	#_XOPEN_XPG2
 1

	)

102 
	#_XOPEN_XPG3
 1

	)

103 
	#_XOPEN_XPG4
 1

	)

106 
	#_XOPEN_UNIX
 1

	)

109 
	#_XOPEN_CRYPT
 1

	)

113 
	#_XOPEN_ENH_I18N
 1

	)

116 
	#_XOPEN_LEGACY
 1

	)

203 
	~<b™s/posix_İt.h
>

206 #ifdeà
__USE_UNIX98


207 
	~<b™s/’vœÚm’ts.h
>

211 
	#STDIN_FILENO
 0

	)

212 
	#STDOUT_FILENO
 1

	)

213 
	#STDERR_FILENO
 2

	)

218 
	~<b™s/ty³s.h
>

220 #iâdef 
__ssize_t_defšed


221 
__ssize_t
 
	tssize_t
;

222 
	#__ssize_t_defšed


	)

225 
	#__Ãed_size_t


	)

226 
	#__Ãed_NULL


	)

227 
	~<¡ddef.h
>

229 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


232 #iâdeà
__gid_t_defšed


233 
__gid_t
 
	tgid_t
;

234 
	#__gid_t_defšed


	)

237 #iâdeà
__uid_t_defšed


238 
__uid_t
 
	tuid_t
;

239 
	#__uid_t_defšed


	)

242 #iâdeà
__off_t_defšed


243 #iâdeà
__USE_FILE_OFFSET64


244 
__off_t
 
	toff_t
;

246 
__off64_t
 
	toff_t
;

248 
	#__off_t_defšed


	)

250 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


251 
__off64_t
 
	toff64_t
;

252 
	#__off64_t_defšed


	)

255 #iâdeà
__u£cÚds_t_defšed


256 
__u£cÚds_t
 
	tu£cÚds_t
;

257 
	#__u£cÚds_t_defšed


	)

260 #iâdeà
__pid_t_defšed


261 
__pid_t
 
	tpid_t
;

262 
	#__pid_t_defšed


	)

266 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


267 #iâdeà
__šŒ_t_defšed


268 
__šŒ_t
 
	tšŒ_t
;

269 
	#__šŒ_t_defšed


	)

273 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


274 #iâdeà
__sockËn_t_defšed


275 
__sockËn_t
 
	tsockËn_t
;

276 
	#__sockËn_t_defšed


	)

282 
	#R_OK
 4

	)

283 
	#W_OK
 2

	)

284 
	#X_OK
 1

	)

285 
	#F_OK
 0

	)

288 
	$acûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

290 #ifdeà
__USE_GNU


293 
	$euidacûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

294 
__THROW
 
	`__nÚnuÎ
 ((1));

297 
	$—cûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

298 
__THROW
 
	`__nÚnuÎ
 ((1));

301 #ifdeà
__USE_ATFILE


305 
	$çcûs§t
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__ty³
, 
__æag
)

306 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

311 #iâdef 
_STDIO_H


312 
	#SEEK_SET
 0

	)

313 
	#SEEK_CUR
 1

	)

314 
	#SEEK_END
 2

	)

317 #ià
defšed
 
__USE_BSD
 && !defšed 
L_SET


319 
	#L_SET
 
SEEK_SET


	)

320 
	#L_INCR
 
SEEK_CUR


	)

321 
	#L_XTND
 
SEEK_END


	)

330 #iâdeà
__USE_FILE_OFFSET64


331 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

333 #ifdeà
__REDIRECT_NTH


334 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

335 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

336 
l£ek64
);

338 
	#l£ek
 
l£ek64


	)

341 #ifdeà
__USE_LARGEFILE64


342 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

343 
__THROW
;

350 
	`şo£
 (
__fd
);

357 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

363 
ssize_t
 
	$wr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
è
__wur
;

365 #ifdeà
__USE_UNIX98


366 #iâdeà
__USE_FILE_OFFSET64


373 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

374 
__off_t
 
__off£t
è
__wur
;

381 
ssize_t
 
	$pwr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

382 
__off_t
 
__off£t
è
__wur
;

384 #ifdeà
__REDIRECT


385 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

386 
__off64_t
 
__off£t
),

387 
´—d64
è
__wur
;

388 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, 
__cÚ¡
 *
__buf
,

389 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

390 
pwr™e64
è
__wur
;

392 
	#´—d
 
´—d64


	)

393 
	#pwr™e
 
pwr™e64


	)

397 #ifdeà
__USE_LARGEFILE64


401 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

402 
__off64_t
 
__off£t
è
__wur
;

405 
ssize_t
 
	$pwr™e64
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

406 
__off64_t
 
__off£t
è
__wur
;

414 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

416 #ifdeà
__USE_GNU


419 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

429 
	$®¬m
 (
__£cÚds
è
__THROW
;

441 
	`¦“p
 (
__£cÚds
);

443 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


448 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

449 
__THROW
;

456 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

465 
	`·u£
 ();

469 
	$chown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

470 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

472 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


474 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

479 
	$lchown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

480 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

484 #ifdeà
__USE_ATFILE


487 
	$fchowÇt
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
,

488 
__gid_t
 
__group
, 
__æag
)

489 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

493 
	$chdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

495 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


497 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

507 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

509 #ifdef 
__USE_GNU


513 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

516 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


520 *
	$g‘wd
 (*
__buf
)

521 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

526 
	$dup
 (
__fd
è
__THROW
 
__wur
;

529 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

531 #ifdeà
__USE_GNU


534 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

538 **
__’vœÚ
;

539 #ifdeà
__USE_GNU


540 **
’vœÚ
;

546 
	$execve
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[],

547 *
__cÚ¡
 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1));

549 #ifdeà
__USE_XOPEN2K8


552 
	$ãxecve
 (
__fd
, *
__cÚ¡
 
__¬gv
[], *__cÚ¡ 
__’vp
[])

553 
__THROW
;

558 
	$execv
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[])

559 
__THROW
 
	`__nÚnuÎ
 ((1));

563 
	$exeşe
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

564 
__THROW
 
	`__nÚnuÎ
 ((1));

568 
	$exeş
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

569 
__THROW
 
	`__nÚnuÎ
 ((1));

573 
	$execvp
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[])

574 
__THROW
 
	`__nÚnuÎ
 ((1));

579 
	$exeşp
 (
__cÚ¡
 *
__fe
, __cÚ¡ *
__¬g
, ...)

580 
__THROW
 
	`__nÚnuÎ
 ((1));

582 #ifdeà
__USE_GNU


585 
	$execv³
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[],

586 *
__cÚ¡
 
__’vp
[])

587 
__THROW
 
	`__nÚnuÎ
 ((1));

591 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


593 
	$niû
 (
__šc
è
__THROW
 
__wur
;

598 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

604 
	~<b™s/cÚâame.h
>

607 
	$·thcÚf
 (
__cÚ¡
 *
__·th
, 
__Çme
)

608 
__THROW
 
	`__nÚnuÎ
 ((1));

611 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

614 
	$syscÚf
 (
__Çme
è
__THROW
;

616 #ifdef 
__USE_POSIX2


618 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

623 
__pid_t
 
	$g‘pid
 (è
__THROW
;

626 
__pid_t
 
	$g‘µid
 (è
__THROW
;

630 #iâdeà
__FAVOR_BSD


631 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

633 #ifdeà
__REDIRECT_NTH


634 
__pid_t
 
	`__REDIRECT_NTH
 (
g‘pg½
, (__pid_ˆ
__pid
), 
__g‘pgid
);

636 
	#g‘pg½
 
__g‘pgid


	)

641 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

642 #ifdeà
__USE_XOPEN_EXTENDED


643 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

650 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

652 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


663 #iâdeà
__FAVOR_BSD


667 
	$£g½
 (è
__THROW
;

672 #ifdeà
__REDIRECT_NTH


673 
	`__REDIRECT_NTH
 (
£g½
, (
__pid_t
 
__pid
, __pid_ˆ
__pg½
), 
£gid
);

675 
	#£g½
 
£gid


	)

684 
__pid_t
 
	$£tsid
 (è
__THROW
;

686 #ifdeà
__USE_XOPEN_EXTENDED


688 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

692 
__uid_t
 
	$g‘uid
 (è
__THROW
;

695 
__uid_t
 
	$g‘euid
 (è
__THROW
;

698 
__gid_t
 
	$g‘gid
 (è
__THROW
;

701 
__gid_t
 
	$g‘egid
 (è
__THROW
;

706 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

708 #ifdef 
__USE_GNU


710 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

717 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
;

719 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


722 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
;

725 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


727 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
;

734 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
;

736 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


739 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
;

742 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


744 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
;

747 #ifdeà
__USE_GNU


750 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

751 
__THROW
;

755 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

756 
__THROW
;

760 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

761 
__THROW
;

765 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

766 
__THROW
;

773 
__pid_t
 
	$fÜk
 (è
__THROW
;

775 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


780 
__pid_t
 
	$vfÜk
 (è
__THROW
;

786 *
	$‰yÇme
 (
__fd
è
__THROW
;

790 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

791 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

795 
	$i§‰y
 (
__fd
è
__THROW
;

797 #ià
defšed
 
__USE_BSD
 \

798 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

801 
	$‰y¦Ù
 (è
__THROW
;

806 
	$lšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

807 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

809 #ifdeà
__USE_ATFILE


812 
	$lšk©
 (
__äomfd
, 
__cÚ¡
 *
__äom
, 
__tofd
,

813 
__cÚ¡
 *
__to
, 
__æags
)

814 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

817 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


819 
	$symlšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

820 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

825 
ssize_t
 
	$»adlšk
 (
__cÚ¡
 *
__»¡riù
 
__·th
,

826 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

827 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

830 #ifdeà
__USE_ATFILE


832 
	$symlšk©
 (
__cÚ¡
 *
__äom
, 
__tofd
,

833 
__cÚ¡
 *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

836 
ssize_t
 
	$»adlšk©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

837 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

838 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

842 
	$uÆšk
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

844 #ifdeà
__USE_ATFILE


846 
	$uÆšk©
 (
__fd
, 
__cÚ¡
 *
__Çme
, 
__æag
)

847 
__THROW
 
	`__nÚnuÎ
 ((2));

851 
	$rmdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

855 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

858 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

865 *
	`g‘logš
 ();

866 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


873 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

876 #ifdef 
__USE_BSD


878 
	$£ogš
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

882 #ifdef 
__USE_POSIX2


886 
	#__Ãed_g‘İt


	)

887 
	~<g‘İt.h
>

891 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98


895 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

899 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

902 
	$£tho¡Çme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

903 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

907 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

913 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

914 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

915 
	$£tdomašÇme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

916 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

922 
	$vhªgup
 (è
__THROW
;

925 
	$»voke
 (
__cÚ¡
 *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

933 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

934 
size_t
 
__off£t
, 
__sÿË
)

935 
__THROW
 
	`__nÚnuÎ
 ((1));

941 
	$acù
 (
__cÚ¡
 *
__Çme
è
__THROW
;

945 *
	$g‘u£rsh–l
 (è
__THROW
;

946 
	$’du£rsh–l
 (è
__THROW
;

947 
	$£tu£rsh–l
 (è
__THROW
;

953 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

957 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

960 
	$chroÙ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

964 *
	$g‘·ss
 (
__cÚ¡
 *
__´om±
è
	`__nÚnuÎ
 ((1));

968 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


973 
	`fsync
 (
__fd
);

977 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


980 
	`g‘ho¡id
 ();

983 
	$sync
 (è
__THROW
;

988 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

993 
	$g‘dbËsize
 (è
__THROW
;

997 #iâdeà
__USE_FILE_OFFSET64


998 
	$Œunÿ‹
 (
__cÚ¡
 *
__fe
, 
__off_t
 
__Ëngth
)

999 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1001 #ifdeà
__REDIRECT_NTH


1002 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

1003 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
),

1004 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1006 
	#Œunÿ‹
 
Œunÿ‹64


	)

1009 #ifdeà
__USE_LARGEFILE64


1010 
	$Œunÿ‹64
 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
)

1011 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1016 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1019 #iâdeà
__USE_FILE_OFFSET64


1020 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1022 #ifdeà
__REDIRECT_NTH


1023 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1024 
árunÿ‹64
è
__wur
;

1026 
	#árunÿ‹
 
árunÿ‹64


	)

1029 #ifdeà
__USE_LARGEFILE64


1030 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1036 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


1040 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1046 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1050 #ifdeà
__USE_MISC


1061 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1066 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1078 
	#F_ULOCK
 0

	)

1079 
	#F_LOCK
 1

	)

1080 
	#F_TLOCK
 2

	)

1081 
	#F_TEST
 3

	)

1083 #iâdeà
__USE_FILE_OFFSET64


1084 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1086 #ifdeà
__REDIRECT


1087 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1088 
lockf64
è
__wur
;

1090 
	#lockf
 
lockf64


	)

1093 #ifdeà
__USE_LARGEFILE64


1094 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1099 #ifdeà
__USE_GNU


1104 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1105 (
__ex‹nsiÚ__
 \

1106 ({ 
__»suÉ
; \

1107 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1108 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1109 
__»suÉ
; 
	}
}))

	)

1112 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1115 
fd©async
 (
__fdes
);

1121 #ifdef 
__USE_XOPEN


1123 *
	$üy±
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__§É
)

1124 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1128 
	$’üy±
 (*
__block
, 
__edæag
è
__THROW
 
	`__nÚnuÎ
 ((1));

1135 
	$swab
 (
__cÚ¡
 *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1136 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1142 #ifdeà
__USE_XOPEN


1144 *
	$ù”mid
 (*
__s
è
__THROW
;

1149 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


1150 
	~<b™s/uni¡d.h
>

1153 
__END_DECLS


	@/usr/include/zlib.h

31 #iâdeà
ZLIB_H


32 
	#ZLIB_H


	)

34 
	~"zcÚf.h
"

36 #ifdeà
__ılu¥lus


40 
	#ZLIB_VERSION
 "1.2.3.3"

	)

41 
	#ZLIB_VERNUM
 0x1233

	)

42 
	#ZLIB_VER_MAJOR
 1

	)

43 
	#ZLIB_VER_MINOR
 2

	)

44 
	#ZLIB_VER_REVISION
 3

	)

80 
voidpf
 (*
	t®loc_func
è
	tOF
((
	tvoidpf
 
	tİaque
, 
	tuIÁ
 
	t™ems
, uIÁ 
	tsize
));

81 (*
ä“_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	tadd»ss
));

83 
š‹º®_¡©e
;

85 
	sz_¡»am_s
 {

86 
By‹f
 *
Ãxt_š
;

87 
uIÁ
 
ava_š
;

88 
uLÚg
 
tÙ®_š
;

90 
By‹f
 *
Ãxt_out
;

91 
uIÁ
 
ava_out
;

92 
uLÚg
 
tÙ®_out
;

94 *
msg
;

95 
š‹º®_¡©e
 
FAR
 *
¡©e
;

97 
®loc_func
 
z®loc
;

98 
ä“_func
 
zä“
;

99 
voidpf
 
İaque
;

101 
d©a_ty³
;

102 
uLÚg
 
adËr
;

103 
uLÚg
 
»£rved
;

104 } 
	tz_¡»am
;

106 
z_¡»am
 
	tFAR
 *
	tz_¡»amp
;

112 
	sgz_h—d”_s
 {

113 
‹xt
;

114 
uLÚg
 
time
;

115 
xæags
;

116 
os
;

117 
By‹f
 *
exŒa
;

118 
uIÁ
 
exŒa_Ën
;

119 
uIÁ
 
exŒa_max
;

120 
By‹f
 *
Çme
;

121 
uIÁ
 
Çme_max
;

122 
By‹f
 *
comm’t
;

123 
uIÁ
 
comm_max
;

124 
hüc
;

125 
dÚe
;

127 } 
	tgz_h—d”
;

129 
gz_h—d”
 
	tFAR
 *
	tgz_h—d”p
;

165 
	#Z_NO_FLUSH
 0

	)

166 
	#Z_PARTIAL_FLUSH
 1

	)

167 
	#Z_SYNC_FLUSH
 2

	)

168 
	#Z_FULL_FLUSH
 3

	)

169 
	#Z_FINISH
 4

	)

170 
	#Z_BLOCK
 5

	)

173 
	#Z_OK
 0

	)

174 
	#Z_STREAM_END
 1

	)

175 
	#Z_NEED_DICT
 2

	)

176 
	#Z_ERRNO
 (-1)

	)

177 
	#Z_STREAM_ERROR
 (-2)

	)

178 
	#Z_DATA_ERROR
 (-3)

	)

179 
	#Z_MEM_ERROR
 (-4)

	)

180 
	#Z_BUF_ERROR
 (-5)

	)

181 
	#Z_VERSION_ERROR
 (-6)

	)

186 
	#Z_NO_COMPRESSION
 0

	)

187 
	#Z_BEST_SPEED
 1

	)

188 
	#Z_BEST_COMPRESSION
 9

	)

189 
	#Z_DEFAULT_COMPRESSION
 (-1)

	)

192 
	#Z_FILTERED
 1

	)

193 
	#Z_HUFFMAN_ONLY
 2

	)

194 
	#Z_RLE
 3

	)

195 
	#Z_FIXED
 4

	)

196 
	#Z_DEFAULT_STRATEGY
 0

	)

199 
	#Z_BINARY
 0

	)

200 
	#Z_TEXT
 1

	)

201 
	#Z_ASCII
 
Z_TEXT


	)

202 
	#Z_UNKNOWN
 2

	)

205 
	#Z_DEFLATED
 8

	)

208 
	#Z_NULL
 0

	)

210 
	#zlib_v”siÚ
 
	`zlibV”siÚ
()

	)

215 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
zlibV”siÚ
 
OF
(());

245 
ZEXTERN
 
ZEXPORT
 
deæ©e
 
OF
((
z_¡»amp
 
¡rm
, 
æush
));

331 
ZEXTERN
 
ZEXPORT
 
deæ©eEnd
 
OF
((
z_¡»amp
 
¡rm
));

370 
ZEXTERN
 
ZEXPORT
 
šæ©e
 
OF
((
z_¡»amp
 
¡rm
, 
æush
));

469 
ZEXTERN
 
ZEXPORT
 
šæ©eEnd
 
OF
((
z_¡»amp
 
¡rm
));

545 
ZEXTERN
 
ZEXPORT
 
deæ©eS‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

546 cÚ¡ 
By‹f
 *
diùiÚ¬y
,

547 
uIÁ
 
diùL’gth
));

584 
ZEXTERN
 
ZEXPORT
 
deæ©eCİy
 
OF
((
z_¡»amp
 
de¡
,

585 
z_¡»amp
 
sourû
));

602 
ZEXTERN
 
ZEXPORT
 
deæ©eRe£t
 
OF
((
z_¡»amp
 
¡rm
));

613 
ZEXTERN
 
ZEXPORT
 
deæ©eP¬ams
 
OF
((
z_¡»amp
 
¡rm
,

614 
Ëv–
,

615 
¡¿‹gy
));

634 
ZEXTERN
 
ZEXPORT
 
deæ©eTuÃ
 
OF
((
z_¡»amp
 
¡rm
,

635 
good_Ëngth
,

636 
max_Ïzy
,

637 
niû_Ëngth
,

638 
max_chaš
));

651 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
deæ©eBound
 
OF
((
z_¡»amp
 
¡rm
,

652 
uLÚg
 
sourûL’
));

661 
ZEXTERN
 
ZEXPORT
 
deæ©ePrime
 
OF
((
z_¡»amp
 
¡rm
,

662 
b™s
,

663 
v®ue
));

677 
ZEXTERN
 
ZEXPORT
 
deæ©eS‘H—d”
 
OF
((
z_¡»amp
 
¡rm
,

678 
gz_h—d”p
 
h—d
));

748 
ZEXTERN
 
ZEXPORT
 
šæ©eS‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

749 cÚ¡ 
By‹f
 *
diùiÚ¬y
,

750 
uIÁ
 
diùL’gth
));

770 
ZEXTERN
 
ZEXPORT
 
šæ©eSync
 
OF
((
z_¡»amp
 
¡rm
));

785 
ZEXTERN
 
ZEXPORT
 
šæ©eCİy
 
OF
((
z_¡»amp
 
de¡
,

786 
z_¡»amp
 
sourû
));

801 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£t
 
OF
((
z_¡»amp
 
¡rm
));

811 
ZEXTERN
 
ZEXPORT
 
šæ©ePrime
 
OF
((
z_¡»amp
 
¡rm
,

812 
b™s
,

813 
v®ue
));

827 
ZEXTERN
 
ZEXPORT
 
šæ©eG‘H—d”
 
OF
((
z_¡»amp
 
¡rm
,

828 
gz_h—d”p
 
h—d
));

889 (*
š_func
è
	tOF
((
	tFAR
 *, FAR * FAR *));

890 (*
out_func
è
	tOF
((
	tFAR
 *, FAR *, ));

892 
ZEXTERN
 
ZEXPORT
 
šæ©eBack
 
OF
((
z_¡»amp
 
¡rm
,

893 
š_func
 
š
, 
FAR
 *
š_desc
,

894 
out_func
 
out
, 
FAR
 *
out_desc
));

961 
ZEXTERN
 
ZEXPORT
 
šæ©eBackEnd
 
OF
((
z_¡»amp
 
¡rm
));

969 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
zlibCompeFÏgs
 
OF
(());

1021 
ZEXTERN
 
ZEXPORT
 
com´ess
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1022 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
));

1036 
ZEXTERN
 
ZEXPORT
 
com´ess2
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1037 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
,

1038 
Ëv–
));

1052 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
com´essBound
 
OF
((uLÚg 
sourûL’
));

1059 
ZEXTERN
 
ZEXPORT
 
uncom´ess
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1060 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
));

1078 
voidp
 
	tgzFe
;

1098 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzdİ’
 
OF
((
fd
, cÚ¡ *
mode
));

1111 
ZEXTERN
 
ZEXPORT
 
gz£¬ams
 
OF
((
gzFe
 
fe
, 
Ëv–
, 
¡¿‹gy
));

1119 
ZEXTERN
 
ZEXPORT
 
gz»ad
 
OF
((
gzFe
 
fe
, 
voidp
 
buf
, 
Ën
));

1127 
ZEXTERN
 
ZEXPORT
 
gzwr™e
 
OF
((
gzFe
 
fe
,

1128 
voidpc
 
buf
, 
Ën
));

1135 
ZEXTERN
 
ZEXPORTVA
 
gz´štf
 
OF
((
gzFe
 
fe
, cÚ¡ *
fÜm©
, ...));

1148 
ZEXTERN
 
ZEXPORT
 
gzputs
 
OF
((
gzFe
 
fe
, cÚ¡ *
s
));

1155 
ZEXTERN
 * 
ZEXPORT
 
gzg‘s
 
OF
((
gzFe
 
fe
, *
buf
, 
Ën
));

1164 
ZEXTERN
 
ZEXPORT
 
gzputc
 
OF
((
gzFe
 
fe
, 
c
));

1170 
ZEXTERN
 
ZEXPORT
 
gzg‘c
 
OF
((
gzFe
 
fe
));

1176 
ZEXTERN
 
ZEXPORT
 
gzung‘c
 
OF
((
c
, 
gzFe
 
fe
));

1186 
ZEXTERN
 
ZEXPORT
 
gzæush
 
OF
((
gzFe
 
fe
, 
æush
));

1215 
ZEXTERN
 
ZEXPORT
 
gz»wšd
 
OF
((
gzFe
 
fe
));

1232 
ZEXTERN
 
ZEXPORT
 
gzeof
 
OF
((
gzFe
 
fe
));

1238 
ZEXTERN
 
ZEXPORT
 
gzdœeù
 
OF
((
gzFe
 
fe
));

1244 
ZEXTERN
 
ZEXPORT
 
gzşo£
 
OF
((
gzFe
 
fe
));

1252 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
gz”rÜ
 
OF
((
gzFe
 
fe
, *
”ºum
));

1264 
ZEXTERN
 
ZEXPORT
 
gzş—»¼
 
OF
((
gzFe
 
fe
));

1279 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32
 
OF
((uLÚg 
adËr
, cÚ¡ 
By‹f
 *
buf
, 
uIÁ
 
Ën
));

1305 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32
 
OF
((uLÚg 
üc
, cÚ¡ 
By‹f
 *
buf
, 
uIÁ
 
Ën
));

1337 
ZEXTERN
 
ZEXPORT
 
deæ©eIn™_
 
OF
((
z_¡»amp
 
¡rm
, 
Ëv–
,

1338 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1339 
ZEXTERN
 
ZEXPORT
 
šæ©eIn™_
 
OF
((
z_¡»amp
 
¡rm
,

1340 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1341 
ZEXTERN
 
ZEXPORT
 
deæ©eIn™2_
 
OF
((
z_¡»amp
 
¡rm
, 
Ëv–
, 
m‘hod
,

1342 
wšdowB™s
, 
memLev–
,

1343 
¡¿‹gy
, cÚ¡ *
v”siÚ
,

1344 
¡»am_size
));

1345 
ZEXTERN
 
ZEXPORT
 
šæ©eIn™2_
 
OF
((
z_¡»amp
 
¡rm
, 
wšdowB™s
,

1346 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1347 
ZEXTERN
 
ZEXPORT
 
šæ©eBackIn™_
 
OF
((
z_¡»amp
 
¡rm
, 
wšdowB™s
,

1348 
FAR
 *
wšdow
,

1349 cÚ¡ *
v”siÚ
,

1350 
¡»am_size
));

1351 
	#deæ©eIn™
(
¡rm
, 
Ëv–
) \

1352 
	`deæ©eIn™_
((
¡rm
), (
Ëv–
), 
ZLIB_VERSION
, (
z_¡»am
))

	)

1353 
	#šæ©eIn™
(
¡rm
) \

1354 
	`šæ©eIn™_
((
¡rm
), 
ZLIB_VERSION
, (
z_¡»am
))

	)

1355 
	#deæ©eIn™2
(
¡rm
, 
Ëv–
, 
m‘hod
, 
wšdowB™s
, 
memLev–
, 
¡¿‹gy
) \

1356 
	`deæ©eIn™2_
((
¡rm
),(
Ëv–
),(
m‘hod
),(
wšdowB™s
),(
memLev–
),\

1357 (
¡¿‹gy
), 
ZLIB_VERSION
, (
z_¡»am
))

	)

1358 
	#šæ©eIn™2
(
¡rm
, 
wšdowB™s
) \

1359 
	`šæ©eIn™2_
((
¡rm
), (
wšdowB™s
), 
ZLIB_VERSION
, (
z_¡»am
))

	)

1360 
	#šæ©eBackIn™
(
¡rm
, 
wšdowB™s
, 
wšdow
) \

1361 
	`šæ©eBackIn™_
((
¡rm
), (
wšdowB™s
), (
wšdow
), \

1362 
ZLIB_VERSION
, (
z_¡»am
))

	)

1364 #ià
defšed
(
_LARGEFILE64_SOURCE
)

1365 
	#z_off64_t
 
off64_t


	)

1367 #ià
_FILE_OFFSET_BITS
 == 64

1368 
	#z_off64_t
 
off_t


	)

1372 #ià
defšed
(
_LARGEFILE64_SOURCE
è|| 
_FILE_OFFSET_BITS
 == 64

1373 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’64
 
OF
((const *, const *));

1374 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFe
, z_off64_t, ));

1375 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz‹Î64
 
OF
((
gzFe
));

1376 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše64
 
OF
((uLÚg, uLÚg, 
z_off64_t
));

1377 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše64
 
OF
((uLÚg, uLÚg, 
z_off64_t
));

1380 #ià
_FILE_OFFSET_BITS
 == 64

1381 
	#gzİ’
 
gzİ’64


	)

1382 
	#gz£ek
 
gz£ek64


	)

1383 
	#gz‹Î
 
gz‹Î64


	)

1384 
	#adËr32_combše
 
adËr32_combše64


	)

1385 
	#üc32_combše
 
üc32_combše64


	)

1387 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’
 
OF
((const *, const *));

1388 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek
 
OF
((
gzFe
, z_off_t, ));

1389 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz‹Î
 
OF
((
gzFe
));

1390 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1391 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1394 #ià!
defšed
(
ZUTIL_H
è&& !defšed(
NO_DUMMY_DECL
)

1395 
	sš‹º®_¡©e
 {
dummy
;};

1398 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
zE¼Ü
 
OF
(());

1399 
ZEXTERN
 
ZEXPORT
 
šæ©eSyncPošt
 
OF
((
z_¡»amp
));

1400 
ZEXTERN
 cÚ¡ 
uLÚgf
 * 
ZEXPORT
 
g‘_üc_bË
 
OF
(());

1401 
ZEXTERN
 
ZEXPORT
 
šæ©eUnd”mše
 
OF
((
z_¡»amp
, ));

1403 #ifdeà
__ılu¥lus


	@/usr/include/bits/confname.h

21 #iâdeà
_UNISTD_H


28 
	m_PC_LINK_MAX
,

29 
	#_PC_LINK_MAX
 
_PC_LINK_MAX


	)

30 
	m_PC_MAX_CANON
,

31 
	#_PC_MAX_CANON
 
_PC_MAX_CANON


	)

32 
	m_PC_MAX_INPUT
,

33 
	#_PC_MAX_INPUT
 
_PC_MAX_INPUT


	)

34 
	m_PC_NAME_MAX
,

35 
	#_PC_NAME_MAX
 
_PC_NAME_MAX


	)

36 
	m_PC_PATH_MAX
,

37 
	#_PC_PATH_MAX
 
_PC_PATH_MAX


	)

38 
	m_PC_PIPE_BUF
,

39 
	#_PC_PIPE_BUF
 
_PC_PIPE_BUF


	)

40 
	m_PC_CHOWN_RESTRICTED
,

41 
	#_PC_CHOWN_RESTRICTED
 
_PC_CHOWN_RESTRICTED


	)

42 
	m_PC_NO_TRUNC
,

43 
	#_PC_NO_TRUNC
 
_PC_NO_TRUNC


	)

44 
	m_PC_VDISABLE
,

45 
	#_PC_VDISABLE
 
_PC_VDISABLE


	)

46 
	m_PC_SYNC_IO
,

47 
	#_PC_SYNC_IO
 
_PC_SYNC_IO


	)

48 
	m_PC_ASYNC_IO
,

49 
	#_PC_ASYNC_IO
 
_PC_ASYNC_IO


	)

50 
	m_PC_PRIO_IO
,

51 
	#_PC_PRIO_IO
 
_PC_PRIO_IO


	)

52 
	m_PC_SOCK_MAXBUF
,

53 
	#_PC_SOCK_MAXBUF
 
_PC_SOCK_MAXBUF


	)

54 
	m_PC_FILESIZEBITS
,

55 
	#_PC_FILESIZEBITS
 
_PC_FILESIZEBITS


	)

56 
	m_PC_REC_INCR_XFER_SIZE
,

57 
	#_PC_REC_INCR_XFER_SIZE
 
_PC_REC_INCR_XFER_SIZE


	)

58 
	m_PC_REC_MAX_XFER_SIZE
,

59 
	#_PC_REC_MAX_XFER_SIZE
 
_PC_REC_MAX_XFER_SIZE


	)

60 
	m_PC_REC_MIN_XFER_SIZE
,

61 
	#_PC_REC_MIN_XFER_SIZE
 
_PC_REC_MIN_XFER_SIZE


	)

62 
	m_PC_REC_XFER_ALIGN
,

63 
	#_PC_REC_XFER_ALIGN
 
_PC_REC_XFER_ALIGN


	)

64 
	m_PC_ALLOC_SIZE_MIN
,

65 
	#_PC_ALLOC_SIZE_MIN
 
_PC_ALLOC_SIZE_MIN


	)

66 
	m_PC_SYMLINK_MAX
,

67 
	#_PC_SYMLINK_MAX
 
_PC_SYMLINK_MAX


	)

68 
	m_PC_2_SYMLINKS


69 
	#_PC_2_SYMLINKS
 
_PC_2_SYMLINKS


	)

75 
	m_SC_ARG_MAX
,

76 
	#_SC_ARG_MAX
 
_SC_ARG_MAX


	)

77 
	m_SC_CHILD_MAX
,

78 
	#_SC_CHILD_MAX
 
_SC_CHILD_MAX


	)

79 
	m_SC_CLK_TCK
,

80 
	#_SC_CLK_TCK
 
_SC_CLK_TCK


	)

81 
	m_SC_NGROUPS_MAX
,

82 
	#_SC_NGROUPS_MAX
 
_SC_NGROUPS_MAX


	)

83 
	m_SC_OPEN_MAX
,

84 
	#_SC_OPEN_MAX
 
_SC_OPEN_MAX


	)

85 
	m_SC_STREAM_MAX
,

86 
	#_SC_STREAM_MAX
 
_SC_STREAM_MAX


	)

87 
	m_SC_TZNAME_MAX
,

88 
	#_SC_TZNAME_MAX
 
_SC_TZNAME_MAX


	)

89 
	m_SC_JOB_CONTROL
,

90 
	#_SC_JOB_CONTROL
 
_SC_JOB_CONTROL


	)

91 
	m_SC_SAVED_IDS
,

92 
	#_SC_SAVED_IDS
 
_SC_SAVED_IDS


	)

93 
	m_SC_REALTIME_SIGNALS
,

94 
	#_SC_REALTIME_SIGNALS
 
_SC_REALTIME_SIGNALS


	)

95 
	m_SC_PRIORITY_SCHEDULING
,

96 
	#_SC_PRIORITY_SCHEDULING
 
_SC_PRIORITY_SCHEDULING


	)

97 
	m_SC_TIMERS
,

98 
	#_SC_TIMERS
 
_SC_TIMERS


	)

99 
	m_SC_ASYNCHRONOUS_IO
,

100 
	#_SC_ASYNCHRONOUS_IO
 
_SC_ASYNCHRONOUS_IO


	)

101 
	m_SC_PRIORITIZED_IO
,

102 
	#_SC_PRIORITIZED_IO
 
_SC_PRIORITIZED_IO


	)

103 
	m_SC_SYNCHRONIZED_IO
,

104 
	#_SC_SYNCHRONIZED_IO
 
_SC_SYNCHRONIZED_IO


	)

105 
	m_SC_FSYNC
,

106 
	#_SC_FSYNC
 
_SC_FSYNC


	)

107 
	m_SC_MAPPED_FILES
,

108 
	#_SC_MAPPED_FILES
 
_SC_MAPPED_FILES


	)

109 
	m_SC_MEMLOCK
,

110 
	#_SC_MEMLOCK
 
_SC_MEMLOCK


	)

111 
	m_SC_MEMLOCK_RANGE
,

112 
	#_SC_MEMLOCK_RANGE
 
_SC_MEMLOCK_RANGE


	)

113 
	m_SC_MEMORY_PROTECTION
,

114 
	#_SC_MEMORY_PROTECTION
 
_SC_MEMORY_PROTECTION


	)

115 
	m_SC_MESSAGE_PASSING
,

116 
	#_SC_MESSAGE_PASSING
 
_SC_MESSAGE_PASSING


	)

117 
	m_SC_SEMAPHORES
,

118 
	#_SC_SEMAPHORES
 
_SC_SEMAPHORES


	)

119 
	m_SC_SHARED_MEMORY_OBJECTS
,

120 
	#_SC_SHARED_MEMORY_OBJECTS
 
_SC_SHARED_MEMORY_OBJECTS


	)

121 
	m_SC_AIO_LISTIO_MAX
,

122 
	#_SC_AIO_LISTIO_MAX
 
_SC_AIO_LISTIO_MAX


	)

123 
	m_SC_AIO_MAX
,

124 
	#_SC_AIO_MAX
 
_SC_AIO_MAX


	)

125 
	m_SC_AIO_PRIO_DELTA_MAX
,

126 
	#_SC_AIO_PRIO_DELTA_MAX
 
_SC_AIO_PRIO_DELTA_MAX


	)

127 
	m_SC_DELAYTIMER_MAX
,

128 
	#_SC_DELAYTIMER_MAX
 
_SC_DELAYTIMER_MAX


	)

129 
	m_SC_MQ_OPEN_MAX
,

130 
	#_SC_MQ_OPEN_MAX
 
_SC_MQ_OPEN_MAX


	)

131 
	m_SC_MQ_PRIO_MAX
,

132 
	#_SC_MQ_PRIO_MAX
 
_SC_MQ_PRIO_MAX


	)

133 
	m_SC_VERSION
,

134 
	#_SC_VERSION
 
_SC_VERSION


	)

135 
	m_SC_PAGESIZE
,

136 
	#_SC_PAGESIZE
 
_SC_PAGESIZE


	)

137 
	#_SC_PAGE_SIZE
 
_SC_PAGESIZE


	)

138 
	m_SC_RTSIG_MAX
,

139 
	#_SC_RTSIG_MAX
 
_SC_RTSIG_MAX


	)

140 
	m_SC_SEM_NSEMS_MAX
,

141 
	#_SC_SEM_NSEMS_MAX
 
_SC_SEM_NSEMS_MAX


	)

142 
	m_SC_SEM_VALUE_MAX
,

143 
	#_SC_SEM_VALUE_MAX
 
_SC_SEM_VALUE_MAX


	)

144 
	m_SC_SIGQUEUE_MAX
,

145 
	#_SC_SIGQUEUE_MAX
 
_SC_SIGQUEUE_MAX


	)

146 
	m_SC_TIMER_MAX
,

147 
	#_SC_TIMER_MAX
 
_SC_TIMER_MAX


	)

151 
	m_SC_BC_BASE_MAX
,

152 
	#_SC_BC_BASE_MAX
 
_SC_BC_BASE_MAX


	)

153 
	m_SC_BC_DIM_MAX
,

154 
	#_SC_BC_DIM_MAX
 
_SC_BC_DIM_MAX


	)

155 
	m_SC_BC_SCALE_MAX
,

156 
	#_SC_BC_SCALE_MAX
 
_SC_BC_SCALE_MAX


	)

157 
	m_SC_BC_STRING_MAX
,

158 
	#_SC_BC_STRING_MAX
 
_SC_BC_STRING_MAX


	)

159 
	m_SC_COLL_WEIGHTS_MAX
,

160 
	#_SC_COLL_WEIGHTS_MAX
 
_SC_COLL_WEIGHTS_MAX


	)

161 
	m_SC_EQUIV_CLASS_MAX
,

162 
	#_SC_EQUIV_CLASS_MAX
 
_SC_EQUIV_CLASS_MAX


	)

163 
	m_SC_EXPR_NEST_MAX
,

164 
	#_SC_EXPR_NEST_MAX
 
_SC_EXPR_NEST_MAX


	)

165 
	m_SC_LINE_MAX
,

166 
	#_SC_LINE_MAX
 
_SC_LINE_MAX


	)

167 
	m_SC_RE_DUP_MAX
,

168 
	#_SC_RE_DUP_MAX
 
_SC_RE_DUP_MAX


	)

169 
	m_SC_CHARCLASS_NAME_MAX
,

170 
	#_SC_CHARCLASS_NAME_MAX
 
_SC_CHARCLASS_NAME_MAX


	)

172 
	m_SC_2_VERSION
,

173 
	#_SC_2_VERSION
 
_SC_2_VERSION


	)

174 
	m_SC_2_C_BIND
,

175 
	#_SC_2_C_BIND
 
_SC_2_C_BIND


	)

176 
	m_SC_2_C_DEV
,

177 
	#_SC_2_C_DEV
 
_SC_2_C_DEV


	)

178 
	m_SC_2_FORT_DEV
,

179 
	#_SC_2_FORT_DEV
 
_SC_2_FORT_DEV


	)

180 
	m_SC_2_FORT_RUN
,

181 
	#_SC_2_FORT_RUN
 
_SC_2_FORT_RUN


	)

182 
	m_SC_2_SW_DEV
,

183 
	#_SC_2_SW_DEV
 
_SC_2_SW_DEV


	)

184 
	m_SC_2_LOCALEDEF
,

185 
	#_SC_2_LOCALEDEF
 
_SC_2_LOCALEDEF


	)

187 
	m_SC_PII
,

188 
	#_SC_PII
 
_SC_PII


	)

189 
	m_SC_PII_XTI
,

190 
	#_SC_PII_XTI
 
_SC_PII_XTI


	)

191 
	m_SC_PII_SOCKET
,

192 
	#_SC_PII_SOCKET
 
_SC_PII_SOCKET


	)

193 
	m_SC_PII_INTERNET
,

194 
	#_SC_PII_INTERNET
 
_SC_PII_INTERNET


	)

195 
	m_SC_PII_OSI
,

196 
	#_SC_PII_OSI
 
_SC_PII_OSI


	)

197 
	m_SC_POLL
,

198 
	#_SC_POLL
 
_SC_POLL


	)

199 
	m_SC_SELECT
,

200 
	#_SC_SELECT
 
_SC_SELECT


	)

201 
	m_SC_UIO_MAXIOV
,

202 
	#_SC_UIO_MAXIOV
 
_SC_UIO_MAXIOV


	)

203 
	m_SC_IOV_MAX
 = 
_SC_UIO_MAXIOV
,

204 
	#_SC_IOV_MAX
 
_SC_IOV_MAX


	)

205 
	m_SC_PII_INTERNET_STREAM
,

206 
	#_SC_PII_INTERNET_STREAM
 
_SC_PII_INTERNET_STREAM


	)

207 
	m_SC_PII_INTERNET_DGRAM
,

208 
	#_SC_PII_INTERNET_DGRAM
 
_SC_PII_INTERNET_DGRAM


	)

209 
	m_SC_PII_OSI_COTS
,

210 
	#_SC_PII_OSI_COTS
 
_SC_PII_OSI_COTS


	)

211 
	m_SC_PII_OSI_CLTS
,

212 
	#_SC_PII_OSI_CLTS
 
_SC_PII_OSI_CLTS


	)

213 
	m_SC_PII_OSI_M
,

214 
	#_SC_PII_OSI_M
 
_SC_PII_OSI_M


	)

215 
	m_SC_T_IOV_MAX
,

216 
	#_SC_T_IOV_MAX
 
_SC_T_IOV_MAX


	)

219 
	m_SC_THREADS
,

220 
	#_SC_THREADS
 
_SC_THREADS


	)

221 
	m_SC_THREAD_SAFE_FUNCTIONS
,

222 
	#_SC_THREAD_SAFE_FUNCTIONS
 
_SC_THREAD_SAFE_FUNCTIONS


	)

223 
	m_SC_GETGR_R_SIZE_MAX
,

224 
	#_SC_GETGR_R_SIZE_MAX
 
_SC_GETGR_R_SIZE_MAX


	)

225 
	m_SC_GETPW_R_SIZE_MAX
,

226 
	#_SC_GETPW_R_SIZE_MAX
 
_SC_GETPW_R_SIZE_MAX


	)

227 
	m_SC_LOGIN_NAME_MAX
,

228 
	#_SC_LOGIN_NAME_MAX
 
_SC_LOGIN_NAME_MAX


	)

229 
	m_SC_TTY_NAME_MAX
,

230 
	#_SC_TTY_NAME_MAX
 
_SC_TTY_NAME_MAX


	)

231 
	m_SC_THREAD_DESTRUCTOR_ITERATIONS
,

232 
	#_SC_THREAD_DESTRUCTOR_ITERATIONS
 
_SC_THREAD_DESTRUCTOR_ITERATIONS


	)

233 
	m_SC_THREAD_KEYS_MAX
,

234 
	#_SC_THREAD_KEYS_MAX
 
_SC_THREAD_KEYS_MAX


	)

235 
	m_SC_THREAD_STACK_MIN
,

236 
	#_SC_THREAD_STACK_MIN
 
_SC_THREAD_STACK_MIN


	)

237 
	m_SC_THREAD_THREADS_MAX
,

238 
	#_SC_THREAD_THREADS_MAX
 
_SC_THREAD_THREADS_MAX


	)

239 
	m_SC_THREAD_ATTR_STACKADDR
,

240 
	#_SC_THREAD_ATTR_STACKADDR
 
_SC_THREAD_ATTR_STACKADDR


	)

241 
	m_SC_THREAD_ATTR_STACKSIZE
,

242 
	#_SC_THREAD_ATTR_STACKSIZE
 
_SC_THREAD_ATTR_STACKSIZE


	)

243 
	m_SC_THREAD_PRIORITY_SCHEDULING
,

244 
	#_SC_THREAD_PRIORITY_SCHEDULING
 
_SC_THREAD_PRIORITY_SCHEDULING


	)

245 
	m_SC_THREAD_PRIO_INHERIT
,

246 
	#_SC_THREAD_PRIO_INHERIT
 
_SC_THREAD_PRIO_INHERIT


	)

247 
	m_SC_THREAD_PRIO_PROTECT
,

248 
	#_SC_THREAD_PRIO_PROTECT
 
_SC_THREAD_PRIO_PROTECT


	)

249 
	m_SC_THREAD_PROCESS_SHARED
,

250 
	#_SC_THREAD_PROCESS_SHARED
 
_SC_THREAD_PROCESS_SHARED


	)

252 
	m_SC_NPROCESSORS_CONF
,

253 
	#_SC_NPROCESSORS_CONF
 
_SC_NPROCESSORS_CONF


	)

254 
	m_SC_NPROCESSORS_ONLN
,

255 
	#_SC_NPROCESSORS_ONLN
 
_SC_NPROCESSORS_ONLN


	)

256 
	m_SC_PHYS_PAGES
,

257 
	#_SC_PHYS_PAGES
 
_SC_PHYS_PAGES


	)

258 
	m_SC_AVPHYS_PAGES
,

259 
	#_SC_AVPHYS_PAGES
 
_SC_AVPHYS_PAGES


	)

260 
	m_SC_ATEXIT_MAX
,

261 
	#_SC_ATEXIT_MAX
 
_SC_ATEXIT_MAX


	)

262 
	m_SC_PASS_MAX
,

263 
	#_SC_PASS_MAX
 
_SC_PASS_MAX


	)

265 
	m_SC_XOPEN_VERSION
,

266 
	#_SC_XOPEN_VERSION
 
_SC_XOPEN_VERSION


	)

267 
	m_SC_XOPEN_XCU_VERSION
,

268 
	#_SC_XOPEN_XCU_VERSION
 
_SC_XOPEN_XCU_VERSION


	)

269 
	m_SC_XOPEN_UNIX
,

270 
	#_SC_XOPEN_UNIX
 
_SC_XOPEN_UNIX


	)

271 
	m_SC_XOPEN_CRYPT
,

272 
	#_SC_XOPEN_CRYPT
 
_SC_XOPEN_CRYPT


	)

273 
	m_SC_XOPEN_ENH_I18N
,

274 
	#_SC_XOPEN_ENH_I18N
 
_SC_XOPEN_ENH_I18N


	)

275 
	m_SC_XOPEN_SHM
,

276 
	#_SC_XOPEN_SHM
 
_SC_XOPEN_SHM


	)

278 
	m_SC_2_CHAR_TERM
,

279 
	#_SC_2_CHAR_TERM
 
_SC_2_CHAR_TERM


	)

280 
	m_SC_2_C_VERSION
,

281 
	#_SC_2_C_VERSION
 
_SC_2_C_VERSION


	)

282 
	m_SC_2_UPE
,

283 
	#_SC_2_UPE
 
_SC_2_UPE


	)

285 
	m_SC_XOPEN_XPG2
,

286 
	#_SC_XOPEN_XPG2
 
_SC_XOPEN_XPG2


	)

287 
	m_SC_XOPEN_XPG3
,

288 
	#_SC_XOPEN_XPG3
 
_SC_XOPEN_XPG3


	)

289 
	m_SC_XOPEN_XPG4
,

290 
	#_SC_XOPEN_XPG4
 
_SC_XOPEN_XPG4


	)

292 
	m_SC_CHAR_BIT
,

293 
	#_SC_CHAR_BIT
 
_SC_CHAR_BIT


	)

294 
	m_SC_CHAR_MAX
,

295 
	#_SC_CHAR_MAX
 
_SC_CHAR_MAX


	)

296 
	m_SC_CHAR_MIN
,

297 
	#_SC_CHAR_MIN
 
_SC_CHAR_MIN


	)

298 
	m_SC_INT_MAX
,

299 
	#_SC_INT_MAX
 
_SC_INT_MAX


	)

300 
	m_SC_INT_MIN
,

301 
	#_SC_INT_MIN
 
_SC_INT_MIN


	)

302 
	m_SC_LONG_BIT
,

303 
	#_SC_LONG_BIT
 
_SC_LONG_BIT


	)

304 
	m_SC_WORD_BIT
,

305 
	#_SC_WORD_BIT
 
_SC_WORD_BIT


	)

306 
	m_SC_MB_LEN_MAX
,

307 
	#_SC_MB_LEN_MAX
 
_SC_MB_LEN_MAX


	)

308 
	m_SC_NZERO
,

309 
	#_SC_NZERO
 
_SC_NZERO


	)

310 
	m_SC_SSIZE_MAX
,

311 
	#_SC_SSIZE_MAX
 
_SC_SSIZE_MAX


	)

312 
	m_SC_SCHAR_MAX
,

313 
	#_SC_SCHAR_MAX
 
_SC_SCHAR_MAX


	)

314 
	m_SC_SCHAR_MIN
,

315 
	#_SC_SCHAR_MIN
 
_SC_SCHAR_MIN


	)

316 
	m_SC_SHRT_MAX
,

317 
	#_SC_SHRT_MAX
 
_SC_SHRT_MAX


	)

318 
	m_SC_SHRT_MIN
,

319 
	#_SC_SHRT_MIN
 
_SC_SHRT_MIN


	)

320 
	m_SC_UCHAR_MAX
,

321 
	#_SC_UCHAR_MAX
 
_SC_UCHAR_MAX


	)

322 
	m_SC_UINT_MAX
,

323 
	#_SC_UINT_MAX
 
_SC_UINT_MAX


	)

324 
	m_SC_ULONG_MAX
,

325 
	#_SC_ULONG_MAX
 
_SC_ULONG_MAX


	)

326 
	m_SC_USHRT_MAX
,

327 
	#_SC_USHRT_MAX
 
_SC_USHRT_MAX


	)

329 
	m_SC_NL_ARGMAX
,

330 
	#_SC_NL_ARGMAX
 
_SC_NL_ARGMAX


	)

331 
	m_SC_NL_LANGMAX
,

332 
	#_SC_NL_LANGMAX
 
_SC_NL_LANGMAX


	)

333 
	m_SC_NL_MSGMAX
,

334 
	#_SC_NL_MSGMAX
 
_SC_NL_MSGMAX


	)

335 
	m_SC_NL_NMAX
,

336 
	#_SC_NL_NMAX
 
_SC_NL_NMAX


	)

337 
	m_SC_NL_SETMAX
,

338 
	#_SC_NL_SETMAX
 
_SC_NL_SETMAX


	)

339 
	m_SC_NL_TEXTMAX
,

340 
	#_SC_NL_TEXTMAX
 
_SC_NL_TEXTMAX


	)

342 
	m_SC_XBS5_ILP32_OFF32
,

343 
	#_SC_XBS5_ILP32_OFF32
 
_SC_XBS5_ILP32_OFF32


	)

344 
	m_SC_XBS5_ILP32_OFFBIG
,

345 
	#_SC_XBS5_ILP32_OFFBIG
 
_SC_XBS5_ILP32_OFFBIG


	)

346 
	m_SC_XBS5_LP64_OFF64
,

347 
	#_SC_XBS5_LP64_OFF64
 
_SC_XBS5_LP64_OFF64


	)

348 
	m_SC_XBS5_LPBIG_OFFBIG
,

349 
	#_SC_XBS5_LPBIG_OFFBIG
 
_SC_XBS5_LPBIG_OFFBIG


	)

351 
	m_SC_XOPEN_LEGACY
,

352 
	#_SC_XOPEN_LEGACY
 
_SC_XOPEN_LEGACY


	)

353 
	m_SC_XOPEN_REALTIME
,

354 
	#_SC_XOPEN_REALTIME
 
_SC_XOPEN_REALTIME


	)

355 
	m_SC_XOPEN_REALTIME_THREADS
,

356 
	#_SC_XOPEN_REALTIME_THREADS
 
_SC_XOPEN_REALTIME_THREADS


	)

358 
	m_SC_ADVISORY_INFO
,

359 
	#_SC_ADVISORY_INFO
 
_SC_ADVISORY_INFO


	)

360 
	m_SC_BARRIERS
,

361 
	#_SC_BARRIERS
 
_SC_BARRIERS


	)

362 
	m_SC_BASE
,

363 
	#_SC_BASE
 
_SC_BASE


	)

364 
	m_SC_C_LANG_SUPPORT
,

365 
	#_SC_C_LANG_SUPPORT
 
_SC_C_LANG_SUPPORT


	)

366 
	m_SC_C_LANG_SUPPORT_R
,

367 
	#_SC_C_LANG_SUPPORT_R
 
_SC_C_LANG_SUPPORT_R


	)

368 
	m_SC_CLOCK_SELECTION
,

369 
	#_SC_CLOCK_SELECTION
 
_SC_CLOCK_SELECTION


	)

370 
	m_SC_CPUTIME
,

371 
	#_SC_CPUTIME
 
_SC_CPUTIME


	)

372 
	m_SC_THREAD_CPUTIME
,

373 
	#_SC_THREAD_CPUTIME
 
_SC_THREAD_CPUTIME


	)

374 
	m_SC_DEVICE_IO
,

375 
	#_SC_DEVICE_IO
 
_SC_DEVICE_IO


	)

376 
	m_SC_DEVICE_SPECIFIC
,

377 
	#_SC_DEVICE_SPECIFIC
 
_SC_DEVICE_SPECIFIC


	)

378 
	m_SC_DEVICE_SPECIFIC_R
,

379 
	#_SC_DEVICE_SPECIFIC_R
 
_SC_DEVICE_SPECIFIC_R


	)

380 
	m_SC_FD_MGMT
,

381 
	#_SC_FD_MGMT
 
_SC_FD_MGMT


	)

382 
	m_SC_FIFO
,

383 
	#_SC_FIFO
 
_SC_FIFO


	)

384 
	m_SC_PIPE
,

385 
	#_SC_PIPE
 
_SC_PIPE


	)

386 
	m_SC_FILE_ATTRIBUTES
,

387 
	#_SC_FILE_ATTRIBUTES
 
_SC_FILE_ATTRIBUTES


	)

388 
	m_SC_FILE_LOCKING
,

389 
	#_SC_FILE_LOCKING
 
_SC_FILE_LOCKING


	)

390 
	m_SC_FILE_SYSTEM
,

391 
	#_SC_FILE_SYSTEM
 
_SC_FILE_SYSTEM


	)

392 
	m_SC_MONOTONIC_CLOCK
,

393 
	#_SC_MONOTONIC_CLOCK
 
_SC_MONOTONIC_CLOCK


	)

394 
	m_SC_MULTI_PROCESS
,

395 
	#_SC_MULTI_PROCESS
 
_SC_MULTI_PROCESS


	)

396 
	m_SC_SINGLE_PROCESS
,

397 
	#_SC_SINGLE_PROCESS
 
_SC_SINGLE_PROCESS


	)

398 
	m_SC_NETWORKING
,

399 
	#_SC_NETWORKING
 
_SC_NETWORKING


	)

400 
	m_SC_READER_WRITER_LOCKS
,

401 
	#_SC_READER_WRITER_LOCKS
 
_SC_READER_WRITER_LOCKS


	)

402 
	m_SC_SPIN_LOCKS
,

403 
	#_SC_SPIN_LOCKS
 
_SC_SPIN_LOCKS


	)

404 
	m_SC_REGEXP
,

405 
	#_SC_REGEXP
 
_SC_REGEXP


	)

406 
	m_SC_REGEX_VERSION
,

407 
	#_SC_REGEX_VERSION
 
_SC_REGEX_VERSION


	)

408 
	m_SC_SHELL
,

409 
	#_SC_SHELL
 
_SC_SHELL


	)

410 
	m_SC_SIGNALS
,

411 
	#_SC_SIGNALS
 
_SC_SIGNALS


	)

412 
	m_SC_SPAWN
,

413 
	#_SC_SPAWN
 
_SC_SPAWN


	)

414 
	m_SC_SPORADIC_SERVER
,

415 
	#_SC_SPORADIC_SERVER
 
_SC_SPORADIC_SERVER


	)

416 
	m_SC_THREAD_SPORADIC_SERVER
,

417 
	#_SC_THREAD_SPORADIC_SERVER
 
_SC_THREAD_SPORADIC_SERVER


	)

418 
	m_SC_SYSTEM_DATABASE
,

419 
	#_SC_SYSTEM_DATABASE
 
_SC_SYSTEM_DATABASE


	)

420 
	m_SC_SYSTEM_DATABASE_R
,

421 
	#_SC_SYSTEM_DATABASE_R
 
_SC_SYSTEM_DATABASE_R


	)

422 
	m_SC_TIMEOUTS
,

423 
	#_SC_TIMEOUTS
 
_SC_TIMEOUTS


	)

424 
	m_SC_TYPED_MEMORY_OBJECTS
,

425 
	#_SC_TYPED_MEMORY_OBJECTS
 
_SC_TYPED_MEMORY_OBJECTS


	)

426 
	m_SC_USER_GROUPS
,

427 
	#_SC_USER_GROUPS
 
_SC_USER_GROUPS


	)

428 
	m_SC_USER_GROUPS_R
,

429 
	#_SC_USER_GROUPS_R
 
_SC_USER_GROUPS_R


	)

430 
	m_SC_2_PBS
,

431 
	#_SC_2_PBS
 
_SC_2_PBS


	)

432 
	m_SC_2_PBS_ACCOUNTING
,

433 
	#_SC_2_PBS_ACCOUNTING
 
_SC_2_PBS_ACCOUNTING


	)

434 
	m_SC_2_PBS_LOCATE
,

435 
	#_SC_2_PBS_LOCATE
 
_SC_2_PBS_LOCATE


	)

436 
	m_SC_2_PBS_MESSAGE
,

437 
	#_SC_2_PBS_MESSAGE
 
_SC_2_PBS_MESSAGE


	)

438 
	m_SC_2_PBS_TRACK
,

439 
	#_SC_2_PBS_TRACK
 
_SC_2_PBS_TRACK


	)

440 
	m_SC_SYMLOOP_MAX
,

441 
	#_SC_SYMLOOP_MAX
 
_SC_SYMLOOP_MAX


	)

442 
	m_SC_STREAMS
,

443 
	#_SC_STREAMS
 
_SC_STREAMS


	)

444 
	m_SC_2_PBS_CHECKPOINT
,

445 
	#_SC_2_PBS_CHECKPOINT
 
_SC_2_PBS_CHECKPOINT


	)

447 
	m_SC_V6_ILP32_OFF32
,

448 
	#_SC_V6_ILP32_OFF32
 
_SC_V6_ILP32_OFF32


	)

449 
	m_SC_V6_ILP32_OFFBIG
,

450 
	#_SC_V6_ILP32_OFFBIG
 
_SC_V6_ILP32_OFFBIG


	)

451 
	m_SC_V6_LP64_OFF64
,

452 
	#_SC_V6_LP64_OFF64
 
_SC_V6_LP64_OFF64


	)

453 
	m_SC_V6_LPBIG_OFFBIG
,

454 
	#_SC_V6_LPBIG_OFFBIG
 
_SC_V6_LPBIG_OFFBIG


	)

456 
	m_SC_HOST_NAME_MAX
,

457 
	#_SC_HOST_NAME_MAX
 
_SC_HOST_NAME_MAX


	)

458 
	m_SC_TRACE
,

459 
	#_SC_TRACE
 
_SC_TRACE


	)

460 
	m_SC_TRACE_EVENT_FILTER
,

461 
	#_SC_TRACE_EVENT_FILTER
 
_SC_TRACE_EVENT_FILTER


	)

462 
	m_SC_TRACE_INHERIT
,

463 
	#_SC_TRACE_INHERIT
 
_SC_TRACE_INHERIT


	)

464 
	m_SC_TRACE_LOG
,

465 
	#_SC_TRACE_LOG
 
_SC_TRACE_LOG


	)

467 
	m_SC_LEVEL1_ICACHE_SIZE
,

468 
	#_SC_LEVEL1_ICACHE_SIZE
 
_SC_LEVEL1_ICACHE_SIZE


	)

469 
	m_SC_LEVEL1_ICACHE_ASSOC
,

470 
	#_SC_LEVEL1_ICACHE_ASSOC
 
_SC_LEVEL1_ICACHE_ASSOC


	)

471 
	m_SC_LEVEL1_ICACHE_LINESIZE
,

472 
	#_SC_LEVEL1_ICACHE_LINESIZE
 
_SC_LEVEL1_ICACHE_LINESIZE


	)

473 
	m_SC_LEVEL1_DCACHE_SIZE
,

474 
	#_SC_LEVEL1_DCACHE_SIZE
 
_SC_LEVEL1_DCACHE_SIZE


	)

475 
	m_SC_LEVEL1_DCACHE_ASSOC
,

476 
	#_SC_LEVEL1_DCACHE_ASSOC
 
_SC_LEVEL1_DCACHE_ASSOC


	)

477 
	m_SC_LEVEL1_DCACHE_LINESIZE
,

478 
	#_SC_LEVEL1_DCACHE_LINESIZE
 
_SC_LEVEL1_DCACHE_LINESIZE


	)

479 
	m_SC_LEVEL2_CACHE_SIZE
,

480 
	#_SC_LEVEL2_CACHE_SIZE
 
_SC_LEVEL2_CACHE_SIZE


	)

481 
	m_SC_LEVEL2_CACHE_ASSOC
,

482 
	#_SC_LEVEL2_CACHE_ASSOC
 
_SC_LEVEL2_CACHE_ASSOC


	)

483 
	m_SC_LEVEL2_CACHE_LINESIZE
,

484 
	#_SC_LEVEL2_CACHE_LINESIZE
 
_SC_LEVEL2_CACHE_LINESIZE


	)

485 
	m_SC_LEVEL3_CACHE_SIZE
,

486 
	#_SC_LEVEL3_CACHE_SIZE
 
_SC_LEVEL3_CACHE_SIZE


	)

487 
	m_SC_LEVEL3_CACHE_ASSOC
,

488 
	#_SC_LEVEL3_CACHE_ASSOC
 
_SC_LEVEL3_CACHE_ASSOC


	)

489 
	m_SC_LEVEL3_CACHE_LINESIZE
,

490 
	#_SC_LEVEL3_CACHE_LINESIZE
 
_SC_LEVEL3_CACHE_LINESIZE


	)

491 
	m_SC_LEVEL4_CACHE_SIZE
,

492 
	#_SC_LEVEL4_CACHE_SIZE
 
_SC_LEVEL4_CACHE_SIZE


	)

493 
	m_SC_LEVEL4_CACHE_ASSOC
,

494 
	#_SC_LEVEL4_CACHE_ASSOC
 
_SC_LEVEL4_CACHE_ASSOC


	)

495 
	m_SC_LEVEL4_CACHE_LINESIZE
,

496 
	#_SC_LEVEL4_CACHE_LINESIZE
 
_SC_LEVEL4_CACHE_LINESIZE


	)

499 
	m_SC_IPV6
 = 
_SC_LEVEL1_ICACHE_SIZE
 + 50,

500 
	#_SC_IPV6
 
_SC_IPV6


	)

501 
	m_SC_RAW_SOCKETS
,

502 
	#_SC_RAW_SOCKETS
 
_SC_RAW_SOCKETS


	)

504 
	m_SC_V7_ILP32_OFF32
,

505 
	#_SC_V7_ILP32_OFF32
 
_SC_V7_ILP32_OFF32


	)

506 
	m_SC_V7_ILP32_OFFBIG
,

507 
	#_SC_V7_ILP32_OFFBIG
 
_SC_V7_ILP32_OFFBIG


	)

508 
	m_SC_V7_LP64_OFF64
,

509 
	#_SC_V7_LP64_OFF64
 
_SC_V7_LP64_OFF64


	)

510 
	m_SC_V7_LPBIG_OFFBIG
,

511 
	#_SC_V7_LPBIG_OFFBIG
 
_SC_V7_LPBIG_OFFBIG


	)

513 
	m_SC_SS_REPL_MAX
,

514 
	#_SC_SS_REPL_MAX
 
_SC_SS_REPL_MAX


	)

516 
	m_SC_TRACE_EVENT_NAME_MAX
,

517 
	#_SC_TRACE_EVENT_NAME_MAX
 
_SC_TRACE_EVENT_NAME_MAX


	)

518 
	m_SC_TRACE_NAME_MAX
,

519 
	#_SC_TRACE_NAME_MAX
 
_SC_TRACE_NAME_MAX


	)

520 
	m_SC_TRACE_SYS_MAX
,

521 
	#_SC_TRACE_SYS_MAX
 
_SC_TRACE_SYS_MAX


	)

522 
	m_SC_TRACE_USER_EVENT_MAX
,

523 
	#_SC_TRACE_USER_EVENT_MAX
 
_SC_TRACE_USER_EVENT_MAX


	)

525 
	m_SC_XOPEN_STREAMS
,

526 
	#_SC_XOPEN_STREAMS
 
_SC_XOPEN_STREAMS


	)

528 
	m_SC_THREAD_ROBUST_PRIO_INHERIT
,

529 
	#_SC_THREAD_ROBUST_PRIO_INHERIT
 
_SC_THREAD_ROBUST_PRIO_INHERIT


	)

530 
	m_SC_THREAD_ROBUST_PRIO_PROTECT


531 
	#_SC_THREAD_ROBUST_PRIO_PROTECT
 
_SC_THREAD_ROBUST_PRIO_PROTECT


	)

537 
	m_CS_PATH
,

538 
	#_CS_PATH
 
_CS_PATH


	)

540 
	m_CS_V6_WIDTH_RESTRICTED_ENVS
,

541 
	#_CS_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

542 
	#_CS_POSIX_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

544 
	m_CS_GNU_LIBC_VERSION
,

545 
	#_CS_GNU_LIBC_VERSION
 
_CS_GNU_LIBC_VERSION


	)

546 
	m_CS_GNU_LIBPTHREAD_VERSION
,

547 
	#_CS_GNU_LIBPTHREAD_VERSION
 
_CS_GNU_LIBPTHREAD_VERSION


	)

549 
	m_CS_V5_WIDTH_RESTRICTED_ENVS
,

550 
	#_CS_V5_WIDTH_RESTRICTED_ENVS
 
_CS_V5_WIDTH_RESTRICTED_ENVS


	)

551 
	#_CS_POSIX_V5_WIDTH_RESTRICTED_ENVS
 
_CS_V5_WIDTH_RESTRICTED_ENVS


	)

553 
	m_CS_V7_WIDTH_RESTRICTED_ENVS
,

554 
	#_CS_V7_WIDTH_RESTRICTED_ENVS
 
_CS_V7_WIDTH_RESTRICTED_ENVS


	)

555 
	#_CS_POSIX_V7_WIDTH_RESTRICTED_ENVS
 
_CS_V7_WIDTH_RESTRICTED_ENVS


	)

557 
	m_CS_LFS_CFLAGS
 = 1000,

558 
	#_CS_LFS_CFLAGS
 
_CS_LFS_CFLAGS


	)

559 
	m_CS_LFS_LDFLAGS
,

560 
	#_CS_LFS_LDFLAGS
 
_CS_LFS_LDFLAGS


	)

561 
	m_CS_LFS_LIBS
,

562 
	#_CS_LFS_LIBS
 
_CS_LFS_LIBS


	)

563 
	m_CS_LFS_LINTFLAGS
,

564 
	#_CS_LFS_LINTFLAGS
 
_CS_LFS_LINTFLAGS


	)

565 
	m_CS_LFS64_CFLAGS
,

566 
	#_CS_LFS64_CFLAGS
 
_CS_LFS64_CFLAGS


	)

567 
	m_CS_LFS64_LDFLAGS
,

568 
	#_CS_LFS64_LDFLAGS
 
_CS_LFS64_LDFLAGS


	)

569 
	m_CS_LFS64_LIBS
,

570 
	#_CS_LFS64_LIBS
 
_CS_LFS64_LIBS


	)

571 
	m_CS_LFS64_LINTFLAGS
,

572 
	#_CS_LFS64_LINTFLAGS
 
_CS_LFS64_LINTFLAGS


	)

574 
	m_CS_XBS5_ILP32_OFF32_CFLAGS
 = 1100,

575 
	#_CS_XBS5_ILP32_OFF32_CFLAGS
 
_CS_XBS5_ILP32_OFF32_CFLAGS


	)

576 
	m_CS_XBS5_ILP32_OFF32_LDFLAGS
,

577 
	#_CS_XBS5_ILP32_OFF32_LDFLAGS
 
_CS_XBS5_ILP32_OFF32_LDFLAGS


	)

578 
	m_CS_XBS5_ILP32_OFF32_LIBS
,

579 
	#_CS_XBS5_ILP32_OFF32_LIBS
 
_CS_XBS5_ILP32_OFF32_LIBS


	)

580 
	m_CS_XBS5_ILP32_OFF32_LINTFLAGS
,

581 
	#_CS_XBS5_ILP32_OFF32_LINTFLAGS
 
_CS_XBS5_ILP32_OFF32_LINTFLAGS


	)

582 
	m_CS_XBS5_ILP32_OFFBIG_CFLAGS
,

583 
	#_CS_XBS5_ILP32_OFFBIG_CFLAGS
 
_CS_XBS5_ILP32_OFFBIG_CFLAGS


	)

584 
	m_CS_XBS5_ILP32_OFFBIG_LDFLAGS
,

585 
	#_CS_XBS5_ILP32_OFFBIG_LDFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LDFLAGS


	)

586 
	m_CS_XBS5_ILP32_OFFBIG_LIBS
,

587 
	#_CS_XBS5_ILP32_OFFBIG_LIBS
 
_CS_XBS5_ILP32_OFFBIG_LIBS


	)

588 
	m_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
,

589 
	#_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LINTFLAGS


	)

590 
	m_CS_XBS5_LP64_OFF64_CFLAGS
,

591 
	#_CS_XBS5_LP64_OFF64_CFLAGS
 
_CS_XBS5_LP64_OFF64_CFLAGS


	)

592 
	m_CS_XBS5_LP64_OFF64_LDFLAGS
,

593 
	#_CS_XBS5_LP64_OFF64_LDFLAGS
 
_CS_XBS5_LP64_OFF64_LDFLAGS


	)

594 
	m_CS_XBS5_LP64_OFF64_LIBS
,

595 
	#_CS_XBS5_LP64_OFF64_LIBS
 
_CS_XBS5_LP64_OFF64_LIBS


	)

596 
	m_CS_XBS5_LP64_OFF64_LINTFLAGS
,

597 
	#_CS_XBS5_LP64_OFF64_LINTFLAGS
 
_CS_XBS5_LP64_OFF64_LINTFLAGS


	)

598 
	m_CS_XBS5_LPBIG_OFFBIG_CFLAGS
,

599 
	#_CS_XBS5_LPBIG_OFFBIG_CFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_CFLAGS


	)

600 
	m_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
,

601 
	#_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LDFLAGS


	)

602 
	m_CS_XBS5_LPBIG_OFFBIG_LIBS
,

603 
	#_CS_XBS5_LPBIG_OFFBIG_LIBS
 
_CS_XBS5_LPBIG_OFFBIG_LIBS


	)

604 
	m_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
,

605 
	#_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS


	)

607 
	m_CS_POSIX_V6_ILP32_OFF32_CFLAGS
,

608 
	#_CS_POSIX_V6_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_CFLAGS


	)

609 
	m_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
,

610 
	#_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LDFLAGS


	)

611 
	m_CS_POSIX_V6_ILP32_OFF32_LIBS
,

612 
	#_CS_POSIX_V6_ILP32_OFF32_LIBS
 
_CS_POSIX_V6_ILP32_OFF32_LIBS


	)

613 
	m_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
,

614 
	#_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS


	)

615 
	m_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
,

616 
	#_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS


	)

617 
	m_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
,

618 
	#_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS


	)

619 
	m_CS_POSIX_V6_ILP32_OFFBIG_LIBS
,

620 
	#_CS_POSIX_V6_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V6_ILP32_OFFBIG_LIBS


	)

621 
	m_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
,

622 
	#_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS


	)

623 
	m_CS_POSIX_V6_LP64_OFF64_CFLAGS
,

624 
	#_CS_POSIX_V6_LP64_OFF64_CFLAGS
 
_CS_POSIX_V6_LP64_OFF64_CFLAGS


	)

625 
	m_CS_POSIX_V6_LP64_OFF64_LDFLAGS
,

626 
	#_CS_POSIX_V6_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LDFLAGS


	)

627 
	m_CS_POSIX_V6_LP64_OFF64_LIBS
,

628 
	#_CS_POSIX_V6_LP64_OFF64_LIBS
 
_CS_POSIX_V6_LP64_OFF64_LIBS


	)

629 
	m_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
,

630 
	#_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LINTFLAGS


	)

631 
	m_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
,

632 
	#_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS


	)

633 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
,

634 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS


	)

635 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
,

636 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LIBS


	)

637 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
,

638 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS


	)

640 
	m_CS_POSIX_V7_ILP32_OFF32_CFLAGS
,

641 
	#_CS_POSIX_V7_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_CFLAGS


	)

642 
	m_CS_POSIX_V7_ILP32_OFF32_LDFLAGS
,

643 
	#_CS_POSIX_V7_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_LDFLAGS


	)

644 
	m_CS_POSIX_V7_ILP32_OFF32_LIBS
,

645 
	#_CS_POSIX_V7_ILP32_OFF32_LIBS
 
_CS_POSIX_V7_ILP32_OFF32_LIBS


	)

646 
	m_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS
,

647 
	#_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS


	)

648 
	m_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS
,

649 
	#_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS


	)

650 
	m_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS
,

651 
	#_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS


	)

652 
	m_CS_POSIX_V7_ILP32_OFFBIG_LIBS
,

653 
	#_CS_POSIX_V7_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V7_ILP32_OFFBIG_LIBS


	)

654 
	m_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS
,

655 
	#_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS


	)

656 
	m_CS_POSIX_V7_LP64_OFF64_CFLAGS
,

657 
	#_CS_POSIX_V7_LP64_OFF64_CFLAGS
 
_CS_POSIX_V7_LP64_OFF64_CFLAGS


	)

658 
	m_CS_POSIX_V7_LP64_OFF64_LDFLAGS
,

659 
	#_CS_POSIX_V7_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V7_LP64_OFF64_LDFLAGS


	)

660 
	m_CS_POSIX_V7_LP64_OFF64_LIBS
,

661 
	#_CS_POSIX_V7_LP64_OFF64_LIBS
 
_CS_POSIX_V7_LP64_OFF64_LIBS


	)

662 
	m_CS_POSIX_V7_LP64_OFF64_LINTFLAGS
,

663 
	#_CS_POSIX_V7_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V7_LP64_OFF64_LINTFLAGS


	)

664 
	m_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS
,

665 
	#_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS


	)

666 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS
,

667 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS


	)

668 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LIBS
,

669 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LIBS


	)

670 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS


671 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS


	)

	@/usr/include/bits/environments.h

19 #iâdeà
_UNISTD_H


23 
	~<b™s/wÜdsize.h
>

43 #ià
__WORDSIZE
 == 64

57 
	#_POSIX_V7_LPBIG_OFFBIG
 -1

	)

58 
	#_POSIX_V6_LPBIG_OFFBIG
 -1

	)

59 
	#_XBS5_LPBIG_OFFBIG
 -1

	)

62 
	#_POSIX_V7_LP64_OFF64
 1

	)

63 
	#_POSIX_V6_LP64_OFF64
 1

	)

64 
	#_XBS5_LP64_OFF64
 1

	)

70 
	#_POSIX_V7_ILP32_OFF32
 1

	)

71 
	#_POSIX_V7_ILP32_OFFBIG
 1

	)

72 
	#_POSIX_V6_ILP32_OFF32
 1

	)

73 
	#_POSIX_V6_ILP32_OFFBIG
 1

	)

74 
	#_XBS5_ILP32_OFF32
 1

	)

75 
	#_XBS5_ILP32_OFFBIG
 1

	)

92 
	#__ILP32_OFF32_CFLAGS
 "-m32"

	)

93 
	#__ILP32_OFFBIG_CFLAGS
 "-m32 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64"

	)

94 
	#__ILP32_OFF32_LDFLAGS
 "-m32"

	)

95 
	#__ILP32_OFFBIG_LDFLAGS
 "-m32"

	)

96 
	#__LP64_OFF64_CFLAGS
 "-m64"

	)

97 
	#__LP64_OFF64_LDFLAGS
 "-m64"

	)

	@/usr/include/bits/fcntl.h

20 #iâdef 
_FCNTL_H


24 
	~<sys/ty³s.h
>

25 
	~<b™s/wÜdsize.h
>

26 #ifdeà
__USE_GNU


27 
	~<b™s/uio.h
>

33 
	#O_ACCMODE
 0003

	)

34 
	#O_RDONLY
 00

	)

35 
	#O_WRONLY
 01

	)

36 
	#O_RDWR
 02

	)

37 
	#O_CREAT
 0100

	)

38 
	#O_EXCL
 0200

	)

39 
	#O_NOCTTY
 0400

	)

40 
	#O_TRUNC
 01000

	)

41 
	#O_APPEND
 02000

	)

42 
	#O_NONBLOCK
 04000

	)

43 
	#O_NDELAY
 
O_NONBLOCK


	)

44 
	#O_SYNC
 010000

	)

45 
	#O_FSYNC
 
O_SYNC


	)

46 
	#O_ASYNC
 020000

	)

48 #ifdeà
__USE_GNU


49 
	#O_DIRECT
 040000

	)

50 
	#O_DIRECTORY
 0200000

	)

51 
	#O_NOFOLLOW
 0400000

	)

52 
	#O_NOATIME
 01000000

	)

53 
	#O_CLOEXEC
 02000000

	)

59 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


60 
	#O_DSYNC
 
O_SYNC


	)

61 
	#O_RSYNC
 
O_SYNC


	)

64 #ifdeà
__USE_LARGEFILE64


65 #ià
__WORDSIZE
 == 64

66 
	#O_LARGEFILE
 0

	)

68 
	#O_LARGEFILE
 0100000

	)

73 
	#F_DUPFD
 0

	)

74 
	#F_GETFD
 1

	)

75 
	#F_SETFD
 2

	)

76 
	#F_GETFL
 3

	)

77 
	#F_SETFL
 4

	)

78 #ià
__WORDSIZE
 == 64

79 
	#F_GETLK
 5

	)

80 
	#F_SETLK
 6

	)

81 
	#F_SETLKW
 7

	)

83 
	#F_GETLK64
 5

	)

84 
	#F_SETLK64
 6

	)

85 
	#F_SETLKW64
 7

	)

87 #iâdeà
__USE_FILE_OFFSET64


88 
	#F_GETLK
 5

	)

89 
	#F_SETLK
 6

	)

90 
	#F_SETLKW
 7

	)

92 
	#F_GETLK
 
F_GETLK64


	)

93 
	#F_SETLK
 
F_SETLK64


	)

94 
	#F_SETLKW
 
F_SETLKW64


	)

96 
	#F_GETLK64
 12

	)

97 
	#F_SETLK64
 13

	)

98 
	#F_SETLKW64
 14

	)

101 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98


102 
	#F_SETOWN
 8

	)

103 
	#F_GETOWN
 9

	)

106 #ifdeà
__USE_GNU


107 
	#F_SETSIG
 10

	)

108 
	#F_GETSIG
 11

	)

109 
	#F_SETOWN_EX
 15

	)

110 
	#F_GETOWN_EX
 16

	)

113 #ifdeà
__USE_GNU


114 
	#F_SETLEASE
 1024

	)

115 
	#F_GETLEASE
 1025

	)

116 
	#F_NOTIFY
 1026

	)

117 
	#F_DUPFD_CLOEXEC
 1030

	)

122 
	#FD_CLOEXEC
 1

	)

125 
	#F_RDLCK
 0

	)

126 
	#F_WRLCK
 1

	)

127 
	#F_UNLCK
 2

	)

130 
	#F_EXLCK
 4

	)

131 
	#F_SHLCK
 8

	)

133 #ifdeà
__USE_BSD


135 
	#LOCK_SH
 1

	)

136 
	#LOCK_EX
 2

	)

137 
	#LOCK_NB
 4

	)

139 
	#LOCK_UN
 8

	)

142 #ifdeà
__USE_GNU


143 
	#LOCK_MAND
 32

	)

144 
	#LOCK_READ
 64

	)

145 
	#LOCK_WRITE
 128

	)

146 
	#LOCK_RW
 192

	)

149 #ifdeà
__USE_GNU


151 
	#DN_ACCESS
 0x00000001

	)

152 
	#DN_MODIFY
 0x00000002

	)

153 
	#DN_CREATE
 0x00000004

	)

154 
	#DN_DELETE
 0x00000008

	)

155 
	#DN_RENAME
 0x00000010

	)

156 
	#DN_ATTRIB
 0x00000020

	)

157 
	#DN_MULTISHOT
 0x80000000

	)

160 
	sæock


162 
	ml_ty³
;

163 
	ml_wh’û
;

164 #iâdeà
__USE_FILE_OFFSET64


165 
__off_t
 
	ml_¡¬t
;

166 
__off_t
 
	ml_Ën
;

168 
__off64_t
 
	ml_¡¬t
;

169 
__off64_t
 
	ml_Ën
;

171 
__pid_t
 
	ml_pid
;

174 #ifdeà
__USE_LARGEFILE64


175 
	sæock64


177 
	ml_ty³
;

178 
	ml_wh’û
;

179 
__off64_t
 
	ml_¡¬t
;

180 
__off64_t
 
	ml_Ën
;

181 
__pid_t
 
	ml_pid
;

185 #ifdeà
__USE_GNU


187 
	e__pid_ty³


189 
	mF_OWNER_TID
 = 0,

190 
	mF_OWNER_PID
,

191 
	mF_OWNER_GID


195 
	sf_owÃr_ex


197 
__pid_ty³
 
	mty³
;

198 
__pid_t
 
	mpid
;

204 #ifdef 
__USE_BSD


205 
	#FAPPEND
 
O_APPEND


	)

206 
	#FFSYNC
 
O_FSYNC


	)

207 
	#FASYNC
 
O_ASYNC


	)

208 
	#FNONBLOCK
 
O_NONBLOCK


	)

209 
	#FNDELAY
 
O_NDELAY


	)

213 #ifdeà
__USE_XOPEN2K


214 
	#POSIX_FADV_NORMAL
 0

	)

215 
	#POSIX_FADV_RANDOM
 1

	)

216 
	#POSIX_FADV_SEQUENTIAL
 2

	)

217 
	#POSIX_FADV_WILLNEED
 3

	)

218 
	#POSIX_FADV_DONTNEED
 4

	)

219 
	#POSIX_FADV_NOREUSE
 5

	)

223 #ifdeà
__USE_GNU


225 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

228 
	#SYNC_FILE_RANGE_WRITE
 2

	)

231 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

236 
	#SPLICE_F_MOVE
 1

	)

237 
	#SPLICE_F_NONBLOCK
 2

	)

240 
	#SPLICE_F_MORE
 4

	)

241 
	#SPLICE_F_GIFT
 8

	)

245 #ifdeà
__USE_ATFILE


246 
	#AT_FDCWD
 -100

	)

249 
	#AT_SYMLINK_NOFOLLOW
 0x100

	)

250 
	#AT_REMOVEDIR
 0x200

	)

252 
	#AT_SYMLINK_FOLLOW
 0x400

	)

253 
	#AT_EACCESS
 0x200

	)

257 
	g__BEGIN_DECLS


259 #ifdeà
__USE_GNU


262 
ssize_t
 
	$»adah—d
 (
__fd
, 
__off64_t
 
__off£t
, 
size_t
 
__couÁ
)

263 
__THROW
;

267 
	`sync_fe_¿nge
 (
__fd
, 
__off64_t
 
__äom
, __off64_ˆ
__to
,

268 
__æags
);

272 
ssize_t
 
	`vm¥liû
 (
__fdout
, cÚ¡ 
iovec
 *
__iov
,

273 
size_t
 
__couÁ
, 
__æags
);

276 
ssize_t
 
	`¥liû
 (
__fdš
, 
__off64_t
 *
__offš
, 
__fdout
,

277 
__off64_t
 *
__offout
, 
size_t
 
__Ën
,

278 
__æags
);

281 
ssize_t
 
	`‹e
 (
__fdš
, 
__fdout
, 
size_t
 
__Ën
,

282 
__æags
);

285 #iâdeà
__USE_FILE_OFFSET64


286 
	`çÎoÿ‹
 (
__fd
, 
__mode
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

288 #ifdeà
__REDIRECT


289 
	`__REDIRECT
 (
çÎoÿ‹
, (
__fd
, 
__mode
, 
__off64_t
 
__off£t
,

290 
__off64_t
 
__Ën
),

291 
çÎoÿ‹64
);

293 
	#çÎoÿ‹
 
çÎoÿ‹64


	)

296 #ifdeà
__USE_LARGEFILE64


297 
	`çÎoÿ‹64
 (
__fd
, 
__mode
, 
__off64_t
 
__off£t
,

298 
__off64_t
 
__Ën
);

302 
__END_DECLS


	@/usr/include/bits/fcntl2.h

20 #iâdef 
_FCNTL_H


26 #iâdeà
__USE_FILE_OFFSET64


27 
	$__İ’_2
 (
__cÚ¡
 *
__·th
, 
__oæag
è
	`__nÚnuÎ
 ((1));

28 
	`__REDIRECT
 (
__İ’_®Ÿs
, (
__cÚ¡
 *
__·th
, 
__oæag
, ...),

29 
İ’
è
	`__nÚnuÎ
 ((1));

31 
	`__REDIRECT
 (
__İ’_2
, (
__cÚ¡
 *
__·th
, 
__oæag
),

32 
__İ’64_2
è
	`__nÚnuÎ
 ((1));

33 
	`__REDIRECT
 (
__İ’_®Ÿs
, (
__cÚ¡
 *
__·th
, 
__oæag
, ...),

34 
İ’64
è
	`__nÚnuÎ
 ((1));

36 
	`__”rÜdeş
 (
__İ’_too_mªy_¬gs
,

38 
	`__”rÜdeş
 (
__İ’_missšg_mode
,

41 
__ex‹º_®ways_šlše
 

42 
	$İ’
 (
__cÚ¡
 *
__·th
, 
__oæag
, ...)

44 ià(
	`__va_¬g_·ck_Ën
 () > 1)

45 
	`__İ’_too_mªy_¬gs
 ();

47 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

49 ià((
__oæag
 & 
O_CREAT
è!ğ0 && 
	`__va_¬g_·ck_Ën
 () < 1)

51 
	`__İ’_missšg_mode
 ();

52  
	`__İ’_2
 (
__·th
, 
__oæag
);

54  
	`__İ’_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

57 ià(
	`__va_¬g_·ck_Ën
 () < 1)

58  
	`__İ’_2
 (
__·th
, 
__oæag
);

60  
	`__İ’_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

61 
	}
}

64 #ifdeà
__USE_LARGEFILE64


65 
	$__İ’64_2
 (
__cÚ¡
 *
__·th
, 
__oæag
è
	`__nÚnuÎ
 ((1));

66 
	`__REDIRECT
 (
__İ’64_®Ÿs
, (
__cÚ¡
 *
__·th
, 
__oæag
,

67 ...), 
İ’64
è
	`__nÚnuÎ
 ((1));

68 
	`__”rÜdeş
 (
__İ’64_too_mªy_¬gs
,

70 
	`__”rÜdeş
 (
__İ’64_missšg_mode
,

73 
__ex‹º_®ways_šlše
 

74 
	$İ’64
 (
__cÚ¡
 *
__·th
, 
__oæag
, ...)

76 ià(
	`__va_¬g_·ck_Ën
 () > 1)

77 
	`__İ’64_too_mªy_¬gs
 ();

79 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

81 ià((
__oæag
 & 
O_CREAT
è!ğ0 && 
	`__va_¬g_·ck_Ën
 () < 1)

83 
	`__İ’64_missšg_mode
 ();

84  
	`__İ’64_2
 (
__·th
, 
__oæag
);

86  
	`__İ’64_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

89 ià(
	`__va_¬g_·ck_Ën
 () < 1)

90  
	`__İ’64_2
 (
__·th
, 
__oæag
);

92  
	`__İ’64_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

93 
	}
}

97 #ifdeà
__USE_ATFILE


98 #iâdeà
__USE_FILE_OFFSET64


99 
	$__İ’©_2
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__oæag
)

100 
	`__nÚnuÎ
 ((2));

101 
	`__REDIRECT
 (
__İ’©_®Ÿs
, (
__fd
, 
__cÚ¡
 *
__·th
,

102 
__oæag
, ...), 
İ’©
)

103 
	`__nÚnuÎ
 ((2));

105 
	`__REDIRECT
 (
__İ’©_2
, (
__fd
, 
__cÚ¡
 *
__·th
,

106 
__oæag
), 
__İ’©64_2
)

107 
	`__nÚnuÎ
 ((2));

108 
	`__REDIRECT
 (
__İ’©_®Ÿs
, (
__fd
, 
__cÚ¡
 *
__·th
,

109 
__oæag
, ...), 
İ’©64
)

110 
	`__nÚnuÎ
 ((2));

112 
	`__”rÜdeş
 (
__İ’©_too_mªy_¬gs
,

114 
	`__”rÜdeş
 (
__İ’©_missšg_mode
,

117 
__ex‹º_®ways_šlše
 

118 
	$İ’©
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__oæag
, ...)

120 ià(
	`__va_¬g_·ck_Ën
 () > 1)

121 
	`__İ’©_too_mªy_¬gs
 ();

123 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

125 ià((
__oæag
 & 
O_CREAT
è!ğ0 && 
	`__va_¬g_·ck_Ën
 () < 1)

127 
	`__İ’©_missšg_mode
 ();

128  
	`__İ’©_2
 (
__fd
, 
__·th
, 
__oæag
);

130  
	`__İ’©_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

133 ià(
	`__va_¬g_·ck_Ën
 () < 1)

134  
	`__İ’©_2
 (
__fd
, 
__·th
, 
__oæag
);

136  
	`__İ’©_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

137 
	}
}

140 #ifdeà
__USE_LARGEFILE64


141 
	$__İ’©64_2
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__oæag
)

142 
	`__nÚnuÎ
 ((2));

143 
	`__REDIRECT
 (
__İ’©64_®Ÿs
, (
__fd
, 
__cÚ¡
 *
__·th
,

144 
__oæag
, ...), 
İ’©64
)

145 
	`__nÚnuÎ
 ((2));

146 
	`__”rÜdeş
 (
__İ’©64_too_mªy_¬gs
,

148 
	`__”rÜdeş
 (
__İ’©64_missšg_mode
,

151 
__ex‹º_®ways_šlše
 

152 
	$İ’©64
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__oæag
, ...)

154 ià(
	`__va_¬g_·ck_Ën
 () > 1)

155 
	`__İ’©64_too_mªy_¬gs
 ();

157 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

159 ià((
__oæag
 & 
O_CREAT
è!ğ0 && 
	`__va_¬g_·ck_Ën
 () < 1)

161 
	`__İ’©64_missšg_mode
 ();

162  
	`__İ’©64_2
 (
__fd
, 
__·th
, 
__oæag
);

164  
	`__İ’©64_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

167 ià(
	`__va_¬g_·ck_Ën
 () < 1)

168  
	`__İ’©64_2
 (
__fd
, 
__·th
, 
__oæag
);

170  
	`__İ’©64_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

171 
	}
}

	@/usr/include/bits/mman.h

20 #iâdeà
_SYS_MMAN_H


33 
	#PROT_READ
 0x1

	)

34 
	#PROT_WRITE
 0x2

	)

35 
	#PROT_EXEC
 0x4

	)

36 
	#PROT_NONE
 0x0

	)

37 
	#PROT_GROWSDOWN
 0x01000000

	)

39 
	#PROT_GROWSUP
 0x02000000

	)

43 
	#MAP_SHARED
 0x01

	)

44 
	#MAP_PRIVATE
 0x02

	)

45 #ifdeà
__USE_MISC


46 
	#MAP_TYPE
 0x0à

	)

50 
	#MAP_FIXED
 0x10

	)

51 #ifdeà
__USE_MISC


52 
	#MAP_FILE
 0

	)

53 
	#MAP_ANONYMOUS
 0x20

	)

54 
	#MAP_ANON
 
MAP_ANONYMOUS


	)

55 
	#MAP_32BIT
 0x40

	)

59 #ifdeà
__USE_MISC


60 
	#MAP_GROWSDOWN
 0x00100

	)

61 
	#MAP_DENYWRITE
 0x00800

	)

62 
	#MAP_EXECUTABLE
 0x01000

	)

63 
	#MAP_LOCKED
 0x02000

	)

64 
	#MAP_NORESERVE
 0x04000

	)

65 
	#MAP_POPULATE
 0x08000

	)

66 
	#MAP_NONBLOCK
 0x10000

	)

67 
	#MAP_STACK
 0x20000

	)

71 
	#MS_ASYNC
 1

	)

72 
	#MS_SYNC
 4

	)

73 
	#MS_INVALIDATE
 2

	)

76 
	#MCL_CURRENT
 1

	)

77 
	#MCL_FUTURE
 2

	)

81 #ifdeà
__USE_GNU


82 
	#MREMAP_MAYMOVE
 1

	)

83 
	#MREMAP_FIXED
 2

	)

87 #ifdeà
__USE_BSD


88 
	#MADV_NORMAL
 0

	)

89 
	#MADV_RANDOM
 1

	)

90 
	#MADV_SEQUENTIAL
 2

	)

91 
	#MADV_WILLNEED
 3

	)

92 
	#MADV_DONTNEED
 4

	)

93 
	#MADV_REMOVE
 9

	)

94 
	#MADV_DONTFORK
 10

	)

95 
	#MADV_DOFORK
 11

	)

96 
	#MADV_MERGEABLE
 12

	)

97 
	#MADV_UNMERGEABLE
 13

	)

98 
	#MADV_HWPOISON
 100

	)

102 #ifdeà
__USE_XOPEN2K


103 
	#POSIX_MADV_NORMAL
 0

	)

104 
	#POSIX_MADV_RANDOM
 1

	)

105 
	#POSIX_MADV_SEQUENTIAL
 2

	)

106 
	#POSIX_MADV_WILLNEED
 3

	)

107 
	#POSIX_MADV_DONTNEED
 4

	)

	@/usr/include/bits/posix_opt.h

20 #iâdef 
_BITS_POSIX_OPT_H


21 
	#_BITS_POSIX_OPT_H
 1

	)

24 
	#_POSIX_JOB_CONTROL
 1

	)

27 
	#_POSIX_SAVED_IDS
 1

	)

30 
	#_POSIX_PRIORITY_SCHEDULING
 200809L

	)

33 
	#_POSIX_SYNCHRONIZED_IO
 200809L

	)

36 
	#_POSIX_FSYNC
 200809L

	)

39 
	#_POSIX_MAPPED_FILES
 200809L

	)

42 
	#_POSIX_MEMLOCK
 200809L

	)

45 
	#_POSIX_MEMLOCK_RANGE
 200809L

	)

48 
	#_POSIX_MEMORY_PROTECTION
 200809L

	)

51 
	#_POSIX_CHOWN_RESTRICTED
 0

	)

55 
	#_POSIX_VDISABLE
 '\0'

	)

58 
	#_POSIX_NO_TRUNC
 1

	)

61 
	#_XOPEN_REALTIME
 1

	)

64 
	#_XOPEN_REALTIME_THREADS
 1

	)

67 
	#_XOPEN_SHM
 1

	)

70 
	#_POSIX_THREADS
 200809L

	)

73 
	#_POSIX_REENTRANT_FUNCTIONS
 1

	)

74 
	#_POSIX_THREAD_SAFE_FUNCTIONS
 200809L

	)

77 
	#_POSIX_THREAD_PRIORITY_SCHEDULING
 200809L

	)

80 
	#_POSIX_THREAD_ATTR_STACKSIZE
 200809L

	)

83 
	#_POSIX_THREAD_ATTR_STACKADDR
 200809L

	)

86 
	#_POSIX_THREAD_PRIO_INHERIT
 200809L

	)

90 
	#_POSIX_THREAD_PRIO_PROTECT
 200809L

	)

92 #ifdeà
__USE_XOPEN2K8


94 
	#_POSIX_THREAD_ROBUST_PRIO_INHERIT
 200809L

	)

97 
	#_POSIX_THREAD_ROBUST_PRIO_PROTECT
 -1

	)

101 
	#_POSIX_SEMAPHORES
 200809L

	)

104 
	#_POSIX_REALTIME_SIGNALS
 200809L

	)

107 
	#_POSIX_ASYNCHRONOUS_IO
 200809L

	)

108 
	#_POSIX_ASYNC_IO
 1

	)

110 
	#_LFS_ASYNCHRONOUS_IO
 1

	)

112 
	#_POSIX_PRIORITIZED_IO
 200809L

	)

115 
	#_LFS64_ASYNCHRONOUS_IO
 1

	)

118 
	#_LFS_LARGEFILE
 1

	)

119 
	#_LFS64_LARGEFILE
 1

	)

120 
	#_LFS64_STDIO
 1

	)

123 
	#_POSIX_SHARED_MEMORY_OBJECTS
 200809L

	)

126 
	#_POSIX_CPUTIME
 0

	)

129 
	#_POSIX_THREAD_CPUTIME
 0

	)

132 
	#_POSIX_REGEXP
 1

	)

135 
	#_POSIX_READER_WRITER_LOCKS
 200809L

	)

138 
	#_POSIX_SHELL
 1

	)

141 
	#_POSIX_TIMEOUTS
 200809L

	)

144 
	#_POSIX_SPIN_LOCKS
 200809L

	)

147 
	#_POSIX_SPAWN
 200809L

	)

150 
	#_POSIX_TIMERS
 200809L

	)

153 
	#_POSIX_BARRIERS
 200809L

	)

156 
	#_POSIX_MESSAGE_PASSING
 200809L

	)

159 
	#_POSIX_THREAD_PROCESS_SHARED
 200809L

	)

162 
	#_POSIX_MONOTONIC_CLOCK
 0

	)

165 
	#_POSIX_CLOCK_SELECTION
 200809L

	)

168 
	#_POSIX_ADVISORY_INFO
 200809L

	)

171 
	#_POSIX_IPV6
 200809L

	)

174 
	#_POSIX_RAW_SOCKETS
 200809L

	)

177 
	#_POSIX2_CHAR_TERM
 200809L

	)

180 
	#_POSIX_SPORADIC_SERVER
 -1

	)

181 
	#_POSIX_THREAD_SPORADIC_SERVER
 -1

	)

184 
	#_POSIX_TRACE
 -1

	)

185 
	#_POSIX_TRACE_EVENT_FILTER
 -1

	)

186 
	#_POSIX_TRACE_INHERIT
 -1

	)

187 
	#_POSIX_TRACE_LOG
 -1

	)

190 
	#_POSIX_TYPED_MEMORY_OBJECTS
 -1

	)

	@/usr/include/bits/pthreadtypes.h

20 #iâdeà
_BITS_PTHREADTYPES_H


21 
	#_BITS_PTHREADTYPES_H
 1

	)

23 
	~<b™s/wÜdsize.h
>

25 #ià
__WORDSIZE
 == 64

26 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

27 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

28 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

29 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

30 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

31 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

32 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

33 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

34 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

36 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

37 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

38 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

39 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

40 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

41 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

42 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

43 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

44 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

50 
	t±h»ad_t
;

55 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

56 
	m__®ign
;

57 } 
	t±h»ad_©Œ_t
;

60 #ià
__WORDSIZE
 == 64

61 
	s__±h»ad_š‹º®_li¡


63 
__±h»ad_š‹º®_li¡
 *
	m__´ev
;

64 
__±h»ad_š‹º®_li¡
 *
	m__Ãxt
;

65 } 
	t__±h»ad_li¡_t
;

67 
	s__±h»ad_š‹º®_¦i¡


69 
__±h»ad_š‹º®_¦i¡
 *
	m__Ãxt
;

70 } 
	t__±h»ad_¦i¡_t
;

78 
	s__±h»ad_mu‹x_s


80 
	m__lock
;

81 
	m__couÁ
;

82 
	m__owÃr
;

83 #ià
__WORDSIZE
 == 64

84 
	m__nu£rs
;

88 
	m__kšd
;

89 #ià
__WORDSIZE
 == 64

90 
	m__¥šs
;

91 
__±h»ad_li¡_t
 
	m__li¡
;

92 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

94 
	m__nu£rs
;

95 
__ex‹nsiÚ__
 union

97 
	m__¥šs
;

98 
__±h»ad_¦i¡_t
 
	m__li¡
;

101 } 
	m__d©a
;

102 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

103 
	m__®ign
;

104 } 
	t±h»ad_mu‹x_t
;

108 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

109 
	m__®ign
;

110 } 
	t±h»ad_mu‹x©Œ_t
;

119 
	m__lock
;

120 
	m__fu‹x
;

121 
__ex‹nsiÚ__
 
	m__tÙ®_£q
;

122 
__ex‹nsiÚ__
 
	m__wakeup_£q
;

123 
__ex‹nsiÚ__
 
	m__wok’_£q
;

124 *
	m__mu‹x
;

125 
	m__nwa™”s
;

126 
	m__brßdÿ¡_£q
;

127 } 
	m__d©a
;

128 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

129 
__ex‹nsiÚ__
 
	m__®ign
;

130 } 
	t±h»ad_cÚd_t
;

134 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

135 
	m__®ign
;

136 } 
	t±h»ad_cÚd©Œ_t
;

140 
	t±h»ad_key_t
;

144 
	t±h»ad_Úû_t
;

147 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


152 #ià
__WORDSIZE
 == 64

155 
	m__lock
;

156 
	m__Ä_»ad”s
;

157 
	m__»ad”s_wakeup
;

158 
	m__wr™”_wakeup
;

159 
	m__Ä_»ad”s_queued
;

160 
	m__Ä_wr™”s_queued
;

161 
	m__wr™”
;

162 
	m__sh¬ed
;

163 
	m__·d1
;

164 
	m__·d2
;

167 
	m__æags
;

168 } 
	m__d©a
;

172 
	m__lock
;

173 
	m__Ä_»ad”s
;

174 
	m__»ad”s_wakeup
;

175 
	m__wr™”_wakeup
;

176 
	m__Ä_»ad”s_queued
;

177 
	m__Ä_wr™”s_queued
;

180 
	m__æags
;

181 
	m__sh¬ed
;

182 
	m__·d1
;

183 
	m__·d2
;

184 
	m__wr™”
;

185 } 
	m__d©a
;

187 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

188 
	m__®ign
;

189 } 
	t±h»ad_rwlock_t
;

193 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

194 
	m__®ign
;

195 } 
	t±h»ad_rwlock©Œ_t
;

199 #ifdeà
__USE_XOPEN2K


201 vŞ©
	t±h»ad_¥šlock_t
;

208 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

209 
	m__®ign
;

210 } 
	t±h»ad_b¬r›r_t
;

214 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

215 
	m__®ign
;

216 } 
	t±h»ad_b¬r›¿‰r_t
;

220 #ià
__WORDSIZE
 == 32

222 
	#__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
	`__»g·rm__
 (1)))

	)

	@/usr/include/bits/types.h

24 #iâdef 
_BITS_TYPES_H


25 
	#_BITS_TYPES_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/wÜdsize.h
>

31 
	t__u_ch¬
;

32 
	t__u_shÜt
;

33 
	t__u_št
;

34 
	t__u_lÚg
;

37 sigÃd 
	t__št8_t
;

38 
	t__ušt8_t
;

39 sigÃd 
	t__št16_t
;

40 
	t__ušt16_t
;

41 sigÃd 
	t__št32_t
;

42 
	t__ušt32_t
;

43 #ià
__WORDSIZE
 == 64

44 sigÃd 
	t__št64_t
;

45 
	t__ušt64_t
;

46 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


47 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

48 
__ex‹nsiÚ__
 
	t__ušt64_t
;

52 #ià
__WORDSIZE
 == 64

53 
	t__quad_t
;

54 
	t__u_quad_t
;

55 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


56 
__ex‹nsiÚ__
 
	t__quad_t
;

57 
__ex‹nsiÚ__
 
	t__u_quad_t
;

61 
	m__v®
[2];

62 } 
	t__quad_t
;

65 
__u_lÚg
 
	m__v®
[2];

66 } 
	t__u_quad_t
;

99 
	#__S16_TYPE
 

	)

100 
	#__U16_TYPE
 

	)

101 
	#__S32_TYPE
 

	)

102 
	#__U32_TYPE
 

	)

103 
	#__SLONGWORD_TYPE
 

	)

104 
	#__ULONGWORD_TYPE
 

	)

105 #ià
__WORDSIZE
 == 32

106 
	#__SQUAD_TYPE
 
__quad_t


	)

107 
	#__UQUAD_TYPE
 
__u_quad_t


	)

108 
	#__SWORD_TYPE
 

	)

109 
	#__UWORD_TYPE
 

	)

110 
	#__SLONG32_TYPE
 

	)

111 
	#__ULONG32_TYPE
 

	)

112 
	#__S64_TYPE
 
__quad_t


	)

113 
	#__U64_TYPE
 
__u_quad_t


	)

116 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

117 #–ià
__WORDSIZE
 == 64

118 
	t__SQUAD_TYPE
 

	)

119 
	t__UQUAD_TYPE
 

	)

120 
	t__SWORD_TYPE
 

	)

121 
	t__UWORD_TYPE
 

	)

122 
	t__SLONG32_TYPE
 

	)

123 
	t__ULONG32_TYPE
 

	)

124 
	t__S64_TYPE
 

	)

125 
	t__U64_TYPE
 

	)

127 
	t__STD_TYPE
 

	)

131 
	~<b™s/ty³sizes.h
>

134 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

135 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

136 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

137 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

138 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

139 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

140 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

141 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

142 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

143 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

144 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

145 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__şock_t
;

146 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

147 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

148 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

149 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

150 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

151 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

153 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

154 
__STD_TYPE
 
__SWBLK_T_TYPE
 
	g__swblk_t
;

155 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

158 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__şockid_t
;

161 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

164 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

169 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

170 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

173 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

174 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

177 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfút_t
;

178 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfút64_t
;

180 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

184 
__off64_t
 
	t__loff_t
;

185 
__quad_t
 *
	t__qaddr_t
;

186 *
	t__ÿddr_t
;

189 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

192 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

195 #undeà
__STD_TYPE


	@/usr/include/bits/unistd.h

20 #iâdeà
_UNISTD_H


24 
ssize_t
 
	$__»ad_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

25 
size_t
 
__buæ’
è
__wur
;

26 
ssize_t
 
	`__REDIRECT
 (
__»ad_®Ÿs
, (
__fd
, *
__buf
,

27 
size_t
 
__nby‹s
), 
»ad
è
__wur
;

28 
ssize_t
 
	`__REDIRECT
 (
__»ad_chk_w¬n
,

29 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

30 
size_t
 
__buæ’
), 
__»ad_chk
)

31 
__wur
 
	`__w¬Ç‰r
 ("read called with bigger†engthhan size of "

34 
__ex‹º_®ways_šlše
 
__wur
 
ssize_t


35 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
)

37 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

39 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

40  
	`__»ad_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
	`__bos0
 (__buf));

42 ià(
__nby‹s
 > 
	`__bos0
 (
__buf
))

43  
	`__»ad_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
	`__bos0
 (__buf));

45  
	`__»ad_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
);

46 
	}
}

48 #ifdeà
__USE_UNIX98


49 
ssize_t
 
	$__´—d_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

50 
__off_t
 
__off£t
, 
size_t
 
__bufsize
è
__wur
;

51 
ssize_t
 
	$__´—d64_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

52 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
è
__wur
;

53 
ssize_t
 
	`__REDIRECT
 (
__´—d_®Ÿs
,

54 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

55 
__off_t
 
__off£t
), 
´—d
è
__wur
;

56 
ssize_t
 
	`__REDIRECT
 (
__´—d64_®Ÿs
,

57 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

58 
__off64_t
 
__off£t
), 
´—d64
è
__wur
;

59 
ssize_t
 
	`__REDIRECT
 (
__´—d_chk_w¬n
,

60 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

61 
__off_t
 
__off£t
, 
size_t
 
__bufsize
), 
__´—d_chk
)

62 
__wur
 
	`__w¬Ç‰r
 ("pread called with bigger†engthhan size of "

64 
ssize_t
 
	`__REDIRECT
 (
__´—d64_chk_w¬n
,

65 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

66 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
),

67 
__´—d64_chk
)

68 
__wur
 
	`__w¬Ç‰r
 ("pread64 called with bigger†engthhan size of "

71 #iâdeà
__USE_FILE_OFFSET64


72 
__ex‹º_®ways_šlše
 
__wur
 
ssize_t


73 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off_t
 
__off£t
)

75 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

77 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

78  
	`__´—d_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

80 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

81  
	`__´—d_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

82 
	`__bos0
 (
__buf
));

84  
	`__´—d_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

85 
	}
}

87 
__ex‹º_®ways_šlše
 
__wur
 
ssize_t


88 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
)

90 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

92 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

93  
	`__´—d64_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

95 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

96  
	`__´—d64_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

97 
	`__bos0
 (
__buf
));

100  
	`__´—d64_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

101 
	}
}

104 #ifdeà
__USE_LARGEFILE64


105 
__ex‹º_®ways_šlše
 
__wur
 
ssize_t


106 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
)

108 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

110 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

111  
	`__´—d64_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

113 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

114  
	`__´—d64_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

115 
	`__bos0
 (
__buf
));

118  
	`__´—d64_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

119 
	}
}

123 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


124 
ssize_t
 
	$__»adlšk_chk
 (
__cÚ¡
 *
__»¡riù
 
__·th
,

125 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

126 
size_t
 
__buæ’
)

127 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

128 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk_®Ÿs
,

129 (
__cÚ¡
 *
__»¡riù
 
__·th
,

130 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
), 
»adlšk
)

131 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

132 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk_chk_w¬n
,

133 (
__cÚ¡
 *
__»¡riù
 
__·th
,

134 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

135 
size_t
 
__buæ’
), 
__»adlšk_chk
)

136 
	`__nÚnuÎ
 ((1, 2)è
__wur
 
	`__w¬Ç‰r
 ("readlink called with bigger†ength "

139 
__ex‹º_®ways_šlše
 
	`__nÚnuÎ
 ((1, 2)è
__wur
 
ssize_t


140 
	`__NTH
 (
	$»adlšk
 (
__cÚ¡
 *
__»¡riù
 
__·th
, *__»¡riù 
__buf
,

141 
size_t
 
__Ën
))

143 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

145 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

146  
	`__»adlšk_chk
 (
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

148 iàĞ
__Ën
 > 
	`__bos
 (
__buf
))

149  
	`__»adlšk_chk_w¬n
 (
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

151  
	`__»adlšk_®Ÿs
 (
__·th
, 
__buf
, 
__Ën
);

152 
	}
}

155 #ifdeà
__USE_ATFILE


156 
ssize_t
 
	$__»adlšk©_chk
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

157 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

158 
size_t
 
__buæ’
)

159 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

160 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk©_®Ÿs
,

161 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

162 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
),

163 
»adlšk©
)

164 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

165 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk©_chk_w¬n
,

166 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

167 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

168 
size_t
 
__buæ’
), 
__»adlšk©_chk
)

169 
	`__nÚnuÎ
 ((2, 3)è
__wur
 
	`__w¬Ç‰r
 ("readlinkat called with bigger "

173 
__ex‹º_®ways_šlše
 
	`__nÚnuÎ
 ((2, 3)è
__wur
 
ssize_t


174 
	`__NTH
 (
	$»adlšk©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

175 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
))

177 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

179 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

180  
	`__»adlšk©_chk
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

182 ià(
__Ën
 > 
	`__bos
 (
__buf
))

183  
	`__»adlšk©_chk_w¬n
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
,

184 
	`__bos
 (
__buf
));

186  
	`__»adlšk©_®Ÿs
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
);

187 
	}
}

190 *
	$__g‘cwd_chk
 (*
__buf
, 
size_t
 
__size
, size_ˆ
__buæ’
)

191 
__THROW
 
__wur
;

192 *
	`__REDIRECT_NTH
 (
__g‘cwd_®Ÿs
,

193 (*
__buf
, 
size_t
 
__size
), 
g‘cwd
è
__wur
;

194 *
	`__REDIRECT_NTH
 (
__g‘cwd_chk_w¬n
,

195 (*
__buf
, 
size_t
 
__size
, size_ˆ
__buæ’
),

196 
__g‘cwd_chk
)

197 
__wur
 
	`__w¬Ç‰r
 ("getcwd caller with bigger†engthhan size of "

200 
__ex‹º_®ways_šlše
 
__wur
 *

201 
	`__NTH
 (
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
))

203 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

205 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
))

206  
	`__g‘cwd_chk
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

208 ià(
__size
 > 
	`__bos
 (
__buf
))

209  
	`__g‘cwd_chk_w¬n
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

211  
	`__g‘cwd_®Ÿs
 (
__buf
, 
__size
);

212 
	}
}

214 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


215 *
	$__g‘wd_chk
 (*
__buf
, 
size_t
 
buæ’
)

216 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

217 *
	`__REDIRECT_NTH
 (
__g‘wd_w¬n
, (*
__buf
), 
g‘wd
)

218 
	`__nÚnuÎ
 ((1)è
__wur
 
	`__w¬Ç‰r
 ("please use getcwd instead,‡s getwd "

221 
__ex‹º_®ways_šlše
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
 *

222 
	`__NTH
 (
	$g‘wd
 (*
__buf
))

224 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

225  
	`__g‘wd_chk
 (
__buf
, 
	`__bos
 (__buf));

226  
	`__g‘wd_w¬n
 (
__buf
);

227 
	}
}

230 
size_t
 
	$__cÚf¡r_chk
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
,

231 
size_t
 
__buæ’
è
__THROW
;

232 
size_t
 
	`__REDIRECT_NTH
 (
__cÚf¡r_®Ÿs
, (
__Çme
, *
__buf
,

233 
size_t
 
__Ën
), 
cÚf¡r
);

234 
size_t
 
	`__REDIRECT_NTH
 (
__cÚf¡r_chk_w¬n
,

235 (
__Çme
, *
__buf
, 
size_t
 
__Ën
,

236 
size_t
 
__buæ’
), 
__cÚf¡r_chk
)

237 
	`__w¬Ç‰r
 ("confstr called with bigger†engthhan size of destination "

240 
__ex‹º_®ways_šlše
 
size_t


241 
	`__NTH
 (
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
))

243 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

245 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

246  
	`__cÚf¡r_chk
 (
__Çme
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

248 ià(
	`__bos
 (
__buf
è< 
__Ën
)

249  
	`__cÚf¡r_chk_w¬n
 (
__Çme
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

251  
	`__cÚf¡r_®Ÿs
 (
__Çme
, 
__buf
, 
__Ën
);

252 
	}
}

255 
	$__g‘groups_chk
 (
__size
, 
__gid_t
 
__li¡
[], 
size_t
 
__li¡Ën
)

256 
__THROW
 
__wur
;

257 
	`__REDIRECT_NTH
 (
__g‘groups_®Ÿs
, (
__size
, 
__gid_t
 
__li¡
[]),

258 
g‘groups
è
__wur
;

259 
	`__REDIRECT_NTH
 (
__g‘groups_chk_w¬n
,

260 (
__size
, 
__gid_t
 
__li¡
[], 
size_t
 
__li¡Ën
),

261 
__g‘groups_chk
)

262 
__wur
 
	`__w¬Ç‰r
 ("getgroups called with bigger group counthan what "

265 
__ex‹º_®ways_šlše
 

266 
	`__NTH
 (
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]))

268 ià(
	`__bos
 (
__li¡
è!ğ(
size_t
) -1)

270 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
) || __size < 0)

271  
	`__g‘groups_chk
 (
__size
, 
__li¡
, 
	`__bos
 (__list));

273 ià(
__size
 *  (
__gid_t
è> 
	`__bos
 (
__li¡
))

274  
	`__g‘groups_chk_w¬n
 (
__size
, 
__li¡
, 
	`__bos
 (__list));

276  
	`__g‘groups_®Ÿs
 (
__size
, 
__li¡
);

277 
	}
}

280 
	$__‰yÇme_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

281 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

282 
	`__REDIRECT_NTH
 (
__‰yÇme_r_®Ÿs
, (
__fd
, *
__buf
,

283 
size_t
 
__buæ’
), 
‰yÇme_r
)

284 
	`__nÚnuÎ
 ((2));

285 
	`__REDIRECT_NTH
 (
__‰yÇme_r_chk_w¬n
,

286 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

287 
size_t
 
__Ä—l
), 
__‰yÇme_r_chk
)

288 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ttyname_r called with bigger buflenhan "

291 
__ex‹º_®ways_šlše
 

292 
	`__NTH
 (
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

294 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

296 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

297  
	`__‰yÇme_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

299 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

300  
	`__‰yÇme_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

302  
	`__‰yÇme_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

303 
	}
}

306 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


307 
	$__g‘logš_r_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

308 
	`__nÚnuÎ
 ((1));

309 
	`__REDIRECT
 (
__g‘logš_r_®Ÿs
, (*
__buf
, 
size_t
 
__buæ’
),

310 
g‘logš_r
è
	`__nÚnuÎ
 ((1));

311 
	`__REDIRECT
 (
__g‘logš_r_chk_w¬n
,

312 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

313 
__g‘logš_r_chk
)

314 
	`__nÚnuÎ
 ((1)è
	`__w¬Ç‰r
 ("getlogin_r called with bigger buflenhan "

317 
__ex‹º_®ways_šlše
 

318 
	$g‘logš_r
 (*
__buf
, 
size_t
 
__buæ’
)

320 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

322 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

323  
	`__g‘logš_r_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

325 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

326  
	`__g‘logš_r_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

328  
	`__g‘logš_r_®Ÿs
 (
__buf
, 
__buæ’
);

329 
	}
}

333 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98


334 
	$__g‘ho¡Çme_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

335 
__THROW
 
	`__nÚnuÎ
 ((1));

336 
	`__REDIRECT_NTH
 (
__g‘ho¡Çme_®Ÿs
, (*
__buf
, 
size_t
 
__buæ’
),

337 
g‘ho¡Çme
è
	`__nÚnuÎ
 ((1));

338 
	`__REDIRECT_NTH
 (
__g‘ho¡Çme_chk_w¬n
,

339 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

340 
__g‘ho¡Çme_chk
)

341 
	`__nÚnuÎ
 ((1)è
	`__w¬Ç‰r
 ("gethostname called with bigger buflenhan "

344 
__ex‹º_®ways_šlše
 

345 
	`__NTH
 (
	$g‘ho¡Çme
 (*
__buf
, 
size_t
 
__buæ’
))

347 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

349 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

350  
	`__g‘ho¡Çme_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

352 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

353  
	`__g‘ho¡Çme_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

355  
	`__g‘ho¡Çme_®Ÿs
 (
__buf
, 
__buæ’
);

356 
	}
}

360 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

361 
	$__g‘domašÇme_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

362 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

363 
	`__REDIRECT_NTH
 (
__g‘domašÇme_®Ÿs
, (*
__buf
,

364 
size_t
 
__buæ’
),

365 
g‘domašÇme
è
	`__nÚnuÎ
 ((1)è
__wur
;

366 
	`__REDIRECT_NTH
 (
__g‘domašÇme_chk_w¬n
,

367 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

368 
__g‘domašÇme_chk
)

369 
	`__nÚnuÎ
 ((1)è
__wur
 
	`__w¬Ç‰r
 ("getdomainname called with bigger "

373 
__ex‹º_®ways_šlše
 

374 
	`__NTH
 (
	$g‘domašÇme
 (*
__buf
, 
size_t
 
__buæ’
))

376 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

378 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

379  
	`__g‘domašÇme_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

381 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

382  
	`__g‘domašÇme_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

384  
	`__g‘domašÇme_®Ÿs
 (
__buf
, 
__buæ’
);

385 
	}
}

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__


4 
	#__WORDSIZE
 64

	)

5 
	#__WORDSIZE_COMPAT32
 1

	)

7 
	#__WORDSIZE
 32

	)

	@/usr/include/endian.h

19 #iâdef 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<ã©u»s.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<b™s/’dŸn.h
>

41 #iâdeà
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

54 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

59 #ifdeà
__USE_BSD


61 
	~<b™s/by‹sw­.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è(x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è(x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è(x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è(x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è(x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

19 #iâdef 
_FEATURES_H


20 
	#_FEATURES_H
 1

	)

95 #undeà
__USE_ISOC99


96 #undeà
__USE_ISOC95


97 #undeà
__USE_POSIX


98 #undeà
__USE_POSIX2


99 #undeà
__USE_POSIX199309


100 #undeà
__USE_POSIX199506


101 #undeà
__USE_XOPEN


102 #undeà
__USE_XOPEN_EXTENDED


103 #undeà
__USE_UNIX98


104 #undeà
__USE_XOPEN2K


105 #undeà
__USE_XOPEN2K8


106 #undeà
__USE_LARGEFILE


107 #undeà
__USE_LARGEFILE64


108 #undeà
__USE_FILE_OFFSET64


109 #undeà
__USE_BSD


110 #undeà
__USE_SVID


111 #undeà
__USE_MISC


112 #undeà
__USE_ATFILE


113 #undeà
__USE_GNU


114 #undeà
__USE_REENTRANT


115 #undeà
__USE_FORTIFY_LEVEL


116 #undeà
__FAVOR_BSD


117 #undeà
__KERNEL_STRICT_NAMES


121 #iâdeà
_LOOSE_KERNEL_NAMES


122 
	#__KERNEL_STRICT_NAMES


	)

126 
	#__USE_ANSI
 1

	)

135 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


136 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

137 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

139 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

144 #ià
defšed
 
_BSD_SOURCE
 && \

145 !(
defšed
 
	g_POSIX_SOURCE
 || defšed 
	g_POSIX_C_SOURCE
 || \

146 
defšed
 
	g_XOPEN_SOURCE
 || defšed 
	g_XOPEN_SOURCE_EXTENDED
 || \

147 
defšed
 
	g_GNU_SOURCE
 || defšed 
	g_SVID_SOURCE
)

148 
	#__FAVOR_BSD
 1

	)

152 #ifdeà
_GNU_SOURCE


153 #undeà
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #undeà
_POSIX_SOURCE


156 
	#_POSIX_SOURCE
 1

	)

157 #undeà
_POSIX_C_SOURCE


158 
	#_POSIX_C_SOURCE
 200809L

	)

159 #undeà
_XOPEN_SOURCE


160 
	#_XOPEN_SOURCE
 700

	)

161 #undeà
_XOPEN_SOURCE_EXTENDED


162 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

163 #undeà
_LARGEFILE64_SOURCE


164 
	#_LARGEFILE64_SOURCE
 1

	)

165 #undeà
_BSD_SOURCE


166 
	#_BSD_SOURCE
 1

	)

167 #undeà
_SVID_SOURCE


168 
	#_SVID_SOURCE
 1

	)

169 #undeà
_ATFILE_SOURCE


170 
	#_ATFILE_SOURCE
 1

	)

175 #ià(!
defšed
 
__STRICT_ANSI__
 && !defšed 
_ISOC99_SOURCE
 && \

176 !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 && \

177 !
defšed
 
	g_XOPEN_SOURCE
 && !defšed 
	g_XOPEN_SOURCE_EXTENDED
 && \

178 !
defšed
 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
)

179 
	#_BSD_SOURCE
 1

	)

180 
	#_SVID_SOURCE
 1

	)

187 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

188 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

189 
	#__USE_ISOC99
 1

	)

193 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

194 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

195 
	#__USE_ISOC95
 1

	)

200 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

201 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

202 
	#_POSIX_SOURCE
 1

	)

203 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

204 
	#_POSIX_C_SOURCE
 2

	)

205 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

206 
	#_POSIX_C_SOURCE
 199506L

	)

207 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

208 
	#_POSIX_C_SOURCE
 200112L

	)

210 
	#_POSIX_C_SOURCE
 200809L

	)

212 
	#__USE_POSIX_IMPLICITLY
 1

	)

215 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


216 
	#__USE_POSIX
 1

	)

219 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


220 
	#__USE_POSIX2
 1

	)

223 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

224 
	#__USE_POSIX199309
 1

	)

227 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

228 
	#__USE_POSIX199506
 1

	)

231 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

232 
	#__USE_XOPEN2K
 1

	)

233 #undeà
__USE_ISOC99


234 
	#__USE_ISOC99
 1

	)

237 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

238 
	#__USE_XOPEN2K8
 1

	)

239 #undeà
_ATFILE_SOURCE


240 
	#_ATFILE_SOURCE
 1

	)

243 #ifdef 
_XOPEN_SOURCE


244 
	#__USE_XOPEN
 1

	)

245 #ià(
_XOPEN_SOURCE
 - 0) >= 500

246 
	#__USE_XOPEN_EXTENDED
 1

	)

247 
	#__USE_UNIX98
 1

	)

248 #undeà
_LARGEFILE_SOURCE


249 
	#_LARGEFILE_SOURCE
 1

	)

250 #ià(
_XOPEN_SOURCE
 - 0) >= 600

251 #ià(
_XOPEN_SOURCE
 - 0) >= 700

252 
	#__USE_XOPEN2K8
 1

	)

254 
	#__USE_XOPEN2K
 1

	)

255 #undeà
__USE_ISOC99


256 
	#__USE_ISOC99
 1

	)

259 #ifdeà
_XOPEN_SOURCE_EXTENDED


260 
	#__USE_XOPEN_EXTENDED
 1

	)

265 #ifdeà
_LARGEFILE_SOURCE


266 
	#__USE_LARGEFILE
 1

	)

269 #ifdeà
_LARGEFILE64_SOURCE


270 
	#__USE_LARGEFILE64
 1

	)

273 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

274 
	#__USE_FILE_OFFSET64
 1

	)

277 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


278 
	#__USE_MISC
 1

	)

281 #ifdef 
_BSD_SOURCE


282 
	#__USE_BSD
 1

	)

285 #ifdef 
_SVID_SOURCE


286 
	#__USE_SVID
 1

	)

289 #ifdef 
_ATFILE_SOURCE


290 
	#__USE_ATFILE
 1

	)

293 #ifdef 
_GNU_SOURCE


294 
	#__USE_GNU
 1

	)

297 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


298 
	#__USE_REENTRANT
 1

	)

301 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

302 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

303 #ià
_FORTIFY_SOURCE
 > 1

304 
	#__USE_FORTIFY_LEVEL
 2

	)

306 
	#__USE_FORTIFY_LEVEL
 1

	)

309 
	#__USE_FORTIFY_LEVEL
 0

	)

313 
	~<b™s/´edefs.h
>

316 
	#__STDC_ISO_10646__
 200009L

	)

324 #undeà
__GNU_LIBRARY__


325 
	#__GNU_LIBRARY__
 6

	)

329 
	#__GLIBC__
 2

	)

330 
	#__GLIBC_MINOR__
 11

	)

332 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

333 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

336 #ià
defšed
 
__GNUC__
 \

337 || (
defšed
 
	g__PGI
 && defšed 
	g__i386__
 ) \

338 || (
defšed
 
	g__INTEL_COMPILER
 && (defšed 
	g__i386__
 || defšed 
	g__Ÿ64__
)) \

339 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

340 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

344 #iâdeà
__ASSEMBLER__


345 #iâdeà
_SYS_CDEFS_H


346 
	~<sys/cdefs.h
>

351 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


352 
	#__USE_LARGEFILE
 1

	)

353 
	#__USE_LARGEFILE64
 1

	)

359 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

360 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

361 && 
defšed
 
	g__ex‹º_šlše


362 
	#__USE_EXTERN_INLINES
 1

	)

367 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

368 && (
defšed
 
	g_LIBC
 || !defšed 
	g__OPTIMIZE_SIZE__
è&& !defšed 
	g__NO_INLINE__
 \

369 && 
defšed
 
	g__ex‹º_šlše


370 
	#__USE_EXTERN_INLINES_IN_LIBC
 1

	)

378 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

21 #iâdeà
_GETOPT_H


23 #iâdeà
__Ãed_g‘İt


24 
	#_GETOPT_H
 1

	)

34 #ià!
defšed
 
__GNU_LIBRARY__


35 
	~<ùy³.h
>

38 #iâdeà
__THROW


39 #iâdeà
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

42 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__ılu¥lus


59 *
İrg
;

73 
İtšd
;

78 
İ‹¼
;

82 
İtİt
;

84 #iâdeà
__Ãed_g‘İt


106 
	sİtiÚ


108 cÚ¡ *
	gÇme
;

111 
	ghas_¬g
;

112 *
	gæag
;

113 
	gv®
;

118 
	#no_¬gum’t
 0

	)

119 
	#»quœed_¬gum’t
 1

	)

120 
	#İtiÚ®_¬gum’t
 2

	)

148 #ifdeà
__GNU_LIBRARY__


152 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

153 
__THROW
;

155 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

156 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


160 #ifdeà
__REDIRECT


161 
__REDIRECT
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

162 cÚ¡ *
__shÜtİts
),

163 
__posix_g‘İt
è
__THROW
;

165 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

166 cÚ¡ *
__shÜtİts
è
__THROW
;

167 
	#g‘İt
 
__posix_g‘İt


	)

171 
g‘İt
 ();

174 #iâdeà
__Ãed_g‘İt


175 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

176 cÚ¡ *
__shÜtİts
,

177 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

178 
__THROW
;

179 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

180 cÚ¡ *
__shÜtİts
,

181 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

182 
__THROW
;

186 #ifdef 
__ılu¥lus


191 #undeà
__Ãed_g‘İt


	@/usr/include/stdint.h

23 #iâdeà
_STDINT_H


24 
	#_STDINT_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wch¬.h
>

28 
	~<b™s/wÜdsize.h
>

35 #iâdeà
__št8_t_defšed


36 
	#__št8_t_defšed


	)

37 sigÃd 
	tšt8_t
;

38 
	tšt16_t
;

39 
	tšt32_t
;

40 #ià
__WORDSIZE
 == 64

41 
	tšt64_t
;

43 
__ex‹nsiÚ__


44 
	tšt64_t
;

49 
	tušt8_t
;

50 
	tušt16_t
;

51 #iâdeà
__ušt32_t_defšed


52 
	tušt32_t
;

53 
	#__ušt32_t_defšed


	)

55 #ià
__WORDSIZE
 == 64

56 
	tušt64_t
;

58 
__ex‹nsiÚ__


59 
	tušt64_t
;

66 sigÃd 
	tšt_Ëa¡8_t
;

67 
	tšt_Ëa¡16_t
;

68 
	tšt_Ëa¡32_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_Ëa¡64_t
;

72 
__ex‹nsiÚ__


73 
	tšt_Ëa¡64_t
;

77 
	tušt_Ëa¡8_t
;

78 
	tušt_Ëa¡16_t
;

79 
	tušt_Ëa¡32_t
;

80 #ià
__WORDSIZE
 == 64

81 
	tušt_Ëa¡64_t
;

83 
__ex‹nsiÚ__


84 
	tušt_Ëa¡64_t
;

91 sigÃd 
	tšt_ç¡8_t
;

92 #ià
__WORDSIZE
 == 64

93 
	tšt_ç¡16_t
;

94 
	tšt_ç¡32_t
;

95 
	tšt_ç¡64_t
;

97 
	tšt_ç¡16_t
;

98 
	tšt_ç¡32_t
;

99 
__ex‹nsiÚ__


100 
	tšt_ç¡64_t
;

104 
	tušt_ç¡8_t
;

105 #ià
__WORDSIZE
 == 64

106 
	tušt_ç¡16_t
;

107 
	tušt_ç¡32_t
;

108 
	tušt_ç¡64_t
;

110 
	tušt_ç¡16_t
;

111 
	tušt_ç¡32_t
;

112 
__ex‹nsiÚ__


113 
	tušt_ç¡64_t
;

118 #ià
__WORDSIZE
 == 64

119 #iâdeà
__šŒ_t_defšed


120 
	tšŒ_t
;

121 
	#__šŒ_t_defšed


	)

123 
	tušŒ_t
;

125 #iâdeà
__šŒ_t_defšed


126 
	tšŒ_t
;

127 
	#__šŒ_t_defšed


	)

129 
	tušŒ_t
;

134 #ià
__WORDSIZE
 == 64

135 
	tštmax_t
;

136 
	tuštmax_t
;

138 
__ex‹nsiÚ__


139 
	tštmax_t
;

140 
__ex‹nsiÚ__


141 
	tuštmax_t
;

147 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_LIMIT_MACROS


149 #ià
__WORDSIZE
 == 64

150 
	#__INT64_C
(
c
èø## 
L


	)

151 
	#__UINT64_C
(
c
èø## 
UL


	)

153 
	#__INT64_C
(
c
èø## 
LL


	)

154 
	#__UINT64_C
(
c
èø## 
ULL


	)

160 
	#INT8_MIN
 (-128)

	)

161 
	#INT16_MIN
 (-32767-1)

	)

162 
	#INT32_MIN
 (-2147483647-1)

	)

163 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

165 
	#INT8_MAX
 (127)

	)

166 
	#INT16_MAX
 (32767)

	)

167 
	#INT32_MAX
 (2147483647)

	)

168 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

171 
	#UINT8_MAX
 (255)

	)

172 
	#UINT16_MAX
 (65535)

	)

173 
	#UINT32_MAX
 (4294967295U)

	)

174 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

178 
	#INT_LEAST8_MIN
 (-128)

	)

179 
	#INT_LEAST16_MIN
 (-32767-1)

	)

180 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

181 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

183 
	#INT_LEAST8_MAX
 (127)

	)

184 
	#INT_LEAST16_MAX
 (32767)

	)

185 
	#INT_LEAST32_MAX
 (2147483647)

	)

186 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

189 
	#UINT_LEAST8_MAX
 (255)

	)

190 
	#UINT_LEAST16_MAX
 (65535)

	)

191 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

192 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

196 
	#INT_FAST8_MIN
 (-128)

	)

197 #ià
__WORDSIZE
 == 64

198 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

199 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

201 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

202 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

204 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

206 
	#INT_FAST8_MAX
 (127)

	)

207 #ià
__WORDSIZE
 == 64

208 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

209 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

211 
	#INT_FAST16_MAX
 (2147483647)

	)

212 
	#INT_FAST32_MAX
 (2147483647)

	)

214 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

217 
	#UINT_FAST8_MAX
 (255)

	)

218 #ià
__WORDSIZE
 == 64

219 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

220 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

222 
	#UINT_FAST16_MAX
 (4294967295U)

	)

223 
	#UINT_FAST32_MAX
 (4294967295U)

	)

225 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

229 #ià
__WORDSIZE
 == 64

230 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

231 
	#INTPTR_MAX
 (9223372036854775807L)

	)

232 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

234 
	#INTPTR_MIN
 (-2147483647-1)

	)

235 
	#INTPTR_MAX
 (2147483647)

	)

236 
	#UINTPTR_MAX
 (4294967295U)

	)

241 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

243 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

246 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

252 #ià
__WORDSIZE
 == 64

253 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

254 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

256 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

257 
	#PTRDIFF_MAX
 (2147483647)

	)

261 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

262 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

265 #ià
__WORDSIZE
 == 64

266 
	#SIZE_MAX
 (18446744073709551615UL)

	)

268 
	#SIZE_MAX
 (4294967295U)

	)

272 #iâdeà
WCHAR_MIN


274 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

275 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

279 
	#WINT_MIN
 (0u)

	)

280 
	#WINT_MAX
 (4294967295u)

	)

287 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_CONSTANT_MACROS


290 
	#INT8_C
(
c
è
	)
c

291 
	#INT16_C
(
c
è
	)
c

292 
	#INT32_C
(
c
è
	)
c

293 #ià
__WORDSIZE
 == 64

294 
	#INT64_C
(
c
èø## 
L


	)

296 
	#INT64_C
(
c
èø## 
LL


	)

300 
	#UINT8_C
(
c
è
	)
c

301 
	#UINT16_C
(
c
è
	)
c

302 
	#UINT32_C
(
c
èø## 
U


	)

303 #ià
__WORDSIZE
 == 64

304 
	#UINT64_C
(
c
èø## 
UL


	)

306 
	#UINT64_C
(
c
èø## 
ULL


	)

310 #ià
__WORDSIZE
 == 64

311 
	#INTMAX_C
(
c
èø## 
L


	)

312 
	#UINTMAX_C
(
c
èø## 
UL


	)

314 
	#INTMAX_C
(
c
èø## 
LL


	)

315 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/sys/select.h

22 #iâdeà
_SYS_SELECT_H


23 
	#_SYS_SELECT_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

31 
	~<b™s/£Ëù.h
>

34 
	~<b™s/sig£t.h
>

36 #iâdeà
__sig£t_t_defšed


37 
	#__sig£t_t_defšed


	)

38 
__sig£t_t
 
	tsig£t_t
;

42 
	#__Ãed_time_t


	)

43 
	#__Ãed_time¥ec


	)

44 
	~<time.h
>

45 
	#__Ãed_timev®


	)

46 
	~<b™s/time.h
>

48 #iâdeà
__su£cÚds_t_defšed


49 
__su£cÚds_t
 
	tsu£cÚds_t
;

50 
	#__su£cÚds_t_defšed


	)

55 
	t__fd_mask
;

58 #undeà
__NFDBITS


59 #undeà
__FDELT


60 #undeà
__FDMASK


62 
	#__NFDBITS
 (8 * (è (
__fd_mask
))

	)

63 
	#__FDELT
(
d
è((dè/ 
__NFDBITS
)

	)

64 
	#__FDMASK
(
d
è((
__fd_mask
è1 << ((dè% 
__NFDBITS
))

	)

71 #ifdeà
__USE_XOPEN


72 
__fd_mask
 
	mfds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
è((£t)->
fds_b™s
)

	)

75 
__fd_mask
 
	m__fds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

76 
	#__FDS_BITS
(
£t
è((£t)->
__fds_b™s
)

	)

78 } 
	tfd_£t
;

81 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

83 #ifdeà
__USE_MISC


85 
__fd_mask
 
	tfd_mask
;

88 
	#NFDBITS
 
__NFDBITS


	)

93 
	#FD_SET
(
fd
, 
fd£
è
	`__FD_SET
 (fd, fd£)

	)

94 
	#FD_CLR
(
fd
, 
fd£
è
	`__FD_CLR
 (fd, fd£)

	)

95 
	#FD_ISSET
(
fd
, 
fd£
è
	`__FD_ISSET
 (fd, fd£)

	)

96 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
 (fd£)

	)

99 
__BEGIN_DECLS


109 
£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

110 
fd_£t
 *
__»¡riù
 
__wr™efds
,

111 
fd_£t
 *
__»¡riù
 
__exû±fds
,

112 
timev®
 *
__»¡riù
 
__timeout
);

114 #ifdeà
__USE_XOPEN2K


121 
p£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

122 
fd_£t
 *
__»¡riù
 
__wr™efds
,

123 
fd_£t
 *
__»¡riù
 
__exû±fds
,

124 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
,

125 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__sigmask
);

128 
	g__END_DECLS


	@/usr/include/sys/stat.h

24 #iâdef 
_SYS_STAT_H


25 
	#_SYS_STAT_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	~<b™s/ty³s.h
>

31 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K
 || defšed 
__USE_MISC
 \

32 || 
defšed
 
	g__USE_ATFILE


33 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


34 
	#__Ãed_time_t


	)

36 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ATFILE


37 
	#__Ãed_time¥ec


	)

39 
	~<time.h
>

42 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


45 #iâdeà
__dev_t_defšed


46 
__dev_t
 
	tdev_t
;

47 
	#__dev_t_defšed


	)

50 #iâdeà
__gid_t_defšed


51 
__gid_t
 
	tgid_t
;

52 
	#__gid_t_defšed


	)

55 #iâdeà
__šo_t_defšed


56 #iâdeà
__USE_FILE_OFFSET64


57 
__šo_t
 
	tšo_t
;

59 
__šo64_t
 
	tšo_t
;

61 
	#__šo_t_defšed


	)

64 #iâdeà
__mode_t_defšed


65 
__mode_t
 
	tmode_t
;

66 
	#__mode_t_defšed


	)

69 #iâdeà
__Æšk_t_defšed


70 
__Æšk_t
 
	tÆšk_t
;

71 
	#__Æšk_t_defšed


	)

74 #iâdeà
__off_t_defšed


75 #iâdeà
__USE_FILE_OFFSET64


76 
__off_t
 
	toff_t
;

78 
__off64_t
 
	toff_t
;

80 
	#__off_t_defšed


	)

83 #iâdeà
__uid_t_defšed


84 
__uid_t
 
	tuid_t
;

85 
	#__uid_t_defšed


	)

89 #ifdeà
__USE_UNIX98


90 #iâdeà
__blkút_t_defšed


91 #iâdeà
__USE_FILE_OFFSET64


92 
__blkút_t
 
	tblkút_t
;

94 
__blkút64_t
 
	tblkút_t
;

96 
	#__blkút_t_defšed


	)

99 #iâdeà
__blksize_t_defšed


100 
__blksize_t
 
	tblksize_t
;

101 
	#__blksize_t_defšed


	)

105 
	g__BEGIN_DECLS


107 
	~<b™s/¡©.h
>

109 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


110 
	#S_IFMT
 
__S_IFMT


	)

111 
	#S_IFDIR
 
__S_IFDIR


	)

112 
	#S_IFCHR
 
__S_IFCHR


	)

113 
	#S_IFBLK
 
__S_IFBLK


	)

114 
	#S_IFREG
 
__S_IFREG


	)

115 #ifdeà
__S_IFIFO


116 
	#S_IFIFO
 
__S_IFIFO


	)

118 #ifdeà
__S_IFLNK


119 
	#S_IFLNK
 
__S_IFLNK


	)

121 #ià(
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_UNIX98
) \

122 && 
defšed
 
	g__S_IFSOCK


123 
	#S_IFSOCK
 
__S_IFSOCK


	)

129 
	#__S_ISTYPE
(
mode
, 
mask
è(((modeè& 
__S_IFMT
è=ğ(mask))

	)

131 
	#S_ISDIR
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFDIR
)

	)

132 
	#S_ISCHR
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFCHR
)

	)

133 
	#S_ISBLK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFBLK
)

	)

134 
	#S_ISREG
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFREG
)

	)

135 #ifdeà
__S_IFIFO


136 
	#S_ISFIFO
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFIFO
)

	)

138 #ifdeà
__S_IFLNK


139 
	#S_ISLNK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFLNK
)

	)

142 #ià
defšed
 
__USE_BSD
 && !defšed 
__S_IFLNK


143 
	#S_ISLNK
(
mode
è0

	)

146 #ià(
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K
) \

147 && 
defšed
 
	g__S_IFSOCK


148 
	#S_ISSOCK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFSOCK
)

	)

155 #ifdef 
__USE_POSIX199309


156 
	#S_TYPEISMQ
(
buf
è
	`__S_TYPEISMQ
(buf)

	)

157 
	#S_TYPEISSEM
(
buf
è
	`__S_TYPEISSEM
(buf)

	)

158 
	#S_TYPEISSHM
(
buf
è
	`__S_TYPEISSHM
(buf)

	)

164 
	#S_ISUID
 
__S_ISUID


	)

165 
	#S_ISGID
 
__S_ISGID


	)

167 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


169 
	#S_ISVTX
 
__S_ISVTX


	)

172 
	#S_IRUSR
 
__S_IREAD


	)

173 
	#S_IWUSR
 
__S_IWRITE


	)

174 
	#S_IXUSR
 
__S_IEXEC


	)

176 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

178 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_BSD


179 
	#S_IREAD
 
S_IRUSR


	)

180 
	#S_IWRITE
 
S_IWUSR


	)

181 
	#S_IEXEC
 
S_IXUSR


	)

184 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

185 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

186 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

188 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

190 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

191 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

192 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

194 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

197 #ifdef 
__USE_BSD


199 
	#ACCESSPERMS
 (
S_IRWXU
|
S_IRWXG
|
S_IRWXO
è

	)

200 
	#ALLPERMS
 (
S_ISUID
|
S_ISGID
|
S_ISVTX
|
S_IRWXU
|
S_IRWXG
|
S_IRWXO
)

	)

201 
	#DEFFILEMODE
 (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IWGRP
|
S_IROTH
|
S_IWOTH
)

	)

203 
	#S_BLKSIZE
 512

	)

207 #iâdeà
__USE_FILE_OFFSET64


209 
	$¡©
 (
__cÚ¡
 *
__»¡riù
 
__fe
,

210 
¡©
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

214 
	$f¡©
 (
__fd
, 
¡©
 *
__buf
è
__THROW
 
	`__nÚnuÎ
 ((2));

216 #ifdeà
__REDIRECT_NTH


217 
	`__REDIRECT_NTH
 (
¡©
, (
__cÚ¡
 *
__»¡riù
 
__fe
,

218 
¡©
 *
__»¡riù
 
__buf
), 
¡©64
)

219 
	`__nÚnuÎ
 ((1, 2));

220 
	`__REDIRECT_NTH
 (
f¡©
, (
__fd
, 
¡©
 *
__buf
), 
f¡©64
)

221 
	`__nÚnuÎ
 ((2));

223 
	#¡©
 
¡©64


	)

224 
	#f¡©
 
f¡©64


	)

227 #ifdeà
__USE_LARGEFILE64


228 
	$¡©64
 (
__cÚ¡
 *
__»¡riù
 
__fe
,

229 
¡©64
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

230 
	$f¡©64
 (
__fd
, 
¡©64
 *
__buf
è
__THROW
 
	`__nÚnuÎ
 ((2));

233 #ifdeà
__USE_ATFILE


237 #iâdeà
__USE_FILE_OFFSET64


238 
	$f¡©©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fe
,

239 
¡©
 *
__»¡riù
 
__buf
, 
__æag
)

240 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

242 #ifdeà
__REDIRECT_NTH


243 
	`__REDIRECT_NTH
 (
f¡©©
, (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fe
,

244 
¡©
 *
__»¡riù
 
__buf
,

245 
__æag
),

246 
f¡©©64
è
	`__nÚnuÎ
 ((2, 3));

248 
	#f¡©©
 
f¡©©64


	)

252 #ifdeà
__USE_LARGEFILE64


253 
	$f¡©©64
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fe
,

254 
¡©64
 *
__»¡riù
 
__buf
, 
__æag
)

255 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

259 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


260 #iâdeà
__USE_FILE_OFFSET64


263 
	$l¡©
 (
__cÚ¡
 *
__»¡riù
 
__fe
,

264 
¡©
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

266 #ifdeà
__REDIRECT_NTH


267 
	`__REDIRECT_NTH
 (
l¡©
,

268 (
__cÚ¡
 *
__»¡riù
 
__fe
,

269 
¡©
 *
__»¡riù
 
__buf
), 
l¡©64
)

270 
	`__nÚnuÎ
 ((1, 2));

272 
	#l¡©
 
l¡©64


	)

275 #ifdeà
__USE_LARGEFILE64


276 
	$l¡©64
 (
__cÚ¡
 *
__»¡riù
 
__fe
,

277 
¡©64
 *
__»¡riù
 
__buf
)

278 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

284 
	$chmod
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
)

285 
__THROW
 
	`__nÚnuÎ
 ((1));

287 #ifdeà
__USE_BSD


291 
	$lchmod
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
)

292 
__THROW
 
	`__nÚnuÎ
 ((1));

296 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


297 
	$fchmod
 (
__fd
, 
__mode_t
 
__mode
è
__THROW
;

300 #ifdeà
__USE_ATFILE


303 
	$fchmod©
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
,

304 
__æag
)

305 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

312 
__mode_t
 
	$umask
 (
__mode_t
 
__mask
è
__THROW
;

314 #ifdef 
__USE_GNU


317 
__mode_t
 
	$g‘umask
 (è
__THROW
;

321 
	$mkdœ
 (
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
)

322 
__THROW
 
	`__nÚnuÎ
 ((1));

324 #ifdeà
__USE_ATFILE


328 
	$mkdœ©
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
)

329 
__THROW
 
	`__nÚnuÎ
 ((2));

335 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


336 
	$mknod
 (
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
)

337 
__THROW
 
	`__nÚnuÎ
 ((1));

339 #ifdeà
__USE_ATFILE


343 
	$mknod©
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
,

344 
__dev_t
 
__dev
è
__THROW
 
	`__nÚnuÎ
 ((2));

350 
	$mkfifo
 (
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
)

351 
__THROW
 
	`__nÚnuÎ
 ((1));

353 #ifdeà
__USE_ATFILE


357 
	$mkfifßt
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
)

358 
__THROW
 
	`__nÚnuÎ
 ((2));

361 #ifdeà
__USE_ATFILE


364 
	$utim’§t
 (
__fd
, 
__cÚ¡
 *
__·th
,

365 
__cÚ¡
 
time¥ec
 
__times
[2],

366 
__æags
)

367 
__THROW
 
	`__nÚnuÎ
 ((2));

370 #ifdeà
__USE_XOPEN2K8


372 
	$futim’s
 (
__fd
, 
__cÚ¡
 
time¥ec
 
__times
[2]è
__THROW
;

390 #iâdeà
_STAT_VER


391 
	#_STAT_VER
 0

	)

393 #iâdeà
_MKNOD_VER


394 
	#_MKNOD_VER
 0

	)

398 #iâdeà
__USE_FILE_OFFSET64


399 
	$__fx¡©
 (
__v”
, 
__fdes
, 
¡©
 *
__¡©_buf
)

400 
__THROW
 
	`__nÚnuÎ
 ((3));

401 
	$__x¡©
 (
__v”
, 
__cÚ¡
 *
__f’ame
,

402 
¡©
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

403 
	$__lx¡©
 (
__v”
, 
__cÚ¡
 *
__f’ame
,

404 
¡©
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

405 
	$__fx¡©©
 (
__v”
, 
__fdes
, 
__cÚ¡
 *
__f’ame
,

406 
¡©
 *
__¡©_buf
, 
__æag
)

407 
__THROW
 
	`__nÚnuÎ
 ((3, 4));

409 #ifdeà
__REDIRECT_NTH


410 
	`__REDIRECT_NTH
 (
__fx¡©
, (
__v”
, 
__fdes
,

411 
¡©
 *
__¡©_buf
), 
__fx¡©64
)

412 
	`__nÚnuÎ
 ((3));

413 
	`__REDIRECT_NTH
 (
__x¡©
, (
__v”
, 
__cÚ¡
 *
__f’ame
,

414 
¡©
 *
__¡©_buf
), 
__x¡©64
)

415 
	`__nÚnuÎ
 ((2, 3));

416 
	`__REDIRECT_NTH
 (
__lx¡©
, (
__v”
, 
__cÚ¡
 *
__f’ame
,

417 
¡©
 *
__¡©_buf
), 
__lx¡©64
)

418 
	`__nÚnuÎ
 ((2, 3));

419 
	`__REDIRECT_NTH
 (
__fx¡©©
, (
__v”
, 
__fdes
,

420 
__cÚ¡
 *
__f’ame
,

421 
¡©
 *
__¡©_buf
, 
__æag
),

422 
__fx¡©©64
è
	`__nÚnuÎ
 ((3, 4));

425 
	#__fx¡©
 
__fx¡©64


	)

426 
	#__x¡©
 
__x¡©64


	)

427 
	#__lx¡©
 
__lx¡©64


	)

431 #ifdeà
__USE_LARGEFILE64


432 
	$__fx¡©64
 (
__v”
, 
__fdes
, 
¡©64
 *
__¡©_buf
)

433 
__THROW
 
	`__nÚnuÎ
 ((3));

434 
	$__x¡©64
 (
__v”
, 
__cÚ¡
 *
__f’ame
,

435 
¡©64
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

436 
	$__lx¡©64
 (
__v”
, 
__cÚ¡
 *
__f’ame
,

437 
¡©64
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

438 
	$__fx¡©©64
 (
__v”
, 
__fdes
, 
__cÚ¡
 *
__f’ame
,

439 
¡©64
 *
__¡©_buf
, 
__æag
)

440 
__THROW
 
	`__nÚnuÎ
 ((3, 4));

442 
	$__xmknod
 (
__v”
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
,

443 
__dev_t
 *
__dev
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

445 
	$__xmknod©
 (
__v”
, 
__fd
, 
__cÚ¡
 *
__·th
,

446 
__mode_t
 
__mode
, 
__dev_t
 *
__dev
)

447 
__THROW
 
	`__nÚnuÎ
 ((3, 5));

449 #ià
defšed
 
__GNUC__
 && __GNUC__ >ğ2 && defšed 
__USE_EXTERN_INLINES_IN_LIBC


452 
__ex‹º_šlše
 

453 
	`__NTH
 (
	$¡©
 (
__cÚ¡
 *
__·th
, 
¡©
 *
__¡©buf
))

455  
	`__x¡©
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

456 
	}
}

458 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


459 
__ex‹º_šlše
 

460 
__NTH
 (
	$l¡©
 (
__cÚ¡
 *
__·th
, 
¡©
 *
__¡©buf
))

462  
	`__lx¡©
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

463 
	}
}

466 
__ex‹º_šlše
 

467 
__NTH
 (
	$f¡©
 (
__fd
, 
¡©
 *
__¡©buf
))

469  
	`__fx¡©
 (
_STAT_VER
, 
__fd
, 
__¡©buf
);

470 
	}
}

472 #ifdeà
__USE_ATFILE


473 
__ex‹º_šlše
 

474 
__NTH
 (
	$f¡©©
 (
__fd
, 
__cÚ¡
 *
__f’ame
, 
¡©
 *
__¡©buf
,

475 
__æag
))

477  
	`__fx¡©©
 (
_STAT_VER
, 
__fd
, 
__f’ame
, 
__¡©buf
, 
__æag
);

478 
	}
}

481 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_BSD


482 
__ex‹º_šlše
 

483 
__NTH
 (
	$mknod
 (
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
))

485  
	`__xmknod
 (
_MKNOD_VER
, 
__·th
, 
__mode
, &
__dev
);

486 
	}
}

489 #ifdeà
__USE_ATFILE


490 
__ex‹º_šlše
 

491 
__NTH
 (
	$mknod©
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
,

492 
__dev_t
 
__dev
))

494  
	`__xmknod©
 (
_MKNOD_VER
, 
__fd
, 
__·th
, 
__mode
, &
__dev
);

495 
	}
}

498 #ià
defšed
 
__USE_LARGEFILE64
 \

499 && (! 
defšed
 
	g__USE_FILE_OFFSET64
 \

500 || (
defšed
 
	g__REDIRECT_NTH
 && defšed 
	g__OPTIMIZE__
))

501 
__ex‹º_šlše
 

502 
__NTH
 (
	$¡©64
 (
__cÚ¡
 *
__·th
, 
¡©64
 *
__¡©buf
))

504  
	`__x¡©64
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

505 
	}
}

507 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


508 
__ex‹º_šlše
 

509 
__NTH
 (
	$l¡©64
 (
__cÚ¡
 *
__·th
, 
¡©64
 *
__¡©buf
))

511  
	`__lx¡©64
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

512 
	}
}

515 
__ex‹º_šlše
 

516 
__NTH
 (
	$f¡©64
 (
__fd
, 
¡©64
 *
__¡©buf
))

518  
	`__fx¡©64
 (
_STAT_VER
, 
__fd
, 
__¡©buf
);

519 
	}
}

521 #ifdeà
__USE_ATFILE


522 
__ex‹º_šlše
 

523 
__NTH
 (
	$f¡©©64
 (
__fd
, 
__cÚ¡
 *
__f’ame
, 
¡©64
 *
__¡©buf
,

524 
__æag
))

526  
	`__fx¡©©64
 (
_STAT_VER
, 
__fd
, 
__f’ame
, 
__¡©buf
, 
__æag
);

527 
	}
}

534 
	g__END_DECLS


	@/usr/include/sys/sysmacros.h

21 #iâdeà
_SYS_SYSMACROS_H


22 
	#_SYS_SYSMACROS_H
 1

	)

24 
	~<ã©u»s.h
>

29 #ifdeà
__GLIBC_HAVE_LONG_LONG


30 
__ex‹nsiÚ__


31 
	$gnu_dev_majÜ
 (
__dev
)

32 
__THROW
;

33 
__ex‹nsiÚ__


34 
	$gnu_dev_mšÜ
 (
__dev
)

35 
__THROW
;

36 
__ex‹nsiÚ__


37 
	$gnu_dev_makedev
 (
__majÜ
,

38 
__mšÜ
)

39 
__THROW
;

41 #ià
defšed
 
__GNUC__
 && __GNUC__ >ğ2 && defšed 
__USE_EXTERN_INLINES


42 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

43 
	`__NTH
 (
	$gnu_dev_majÜ
 (
__dev
))

45  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

46 
	}
}

48 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

49 
__NTH
 (
	$gnu_dev_mšÜ
 (
__dev
))

51  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

52 
	}
}

54 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

55 
__NTH
 (
	$gnu_dev_makedev
 (
__majÜ
, 
__mšÜ
))

57  ((
__mšÜ
 & 0xffè| ((
__majÜ
 & 0xfff) << 8)

58 | (((è(
__mšÜ
 & ~0xff)) << 12)

59 | (((è(
__majÜ
 & ~0xfff)) << 32));

60 
	}
}

65 
	#majÜ
(
dev
è
	`gnu_dev_majÜ
 (dev)

	)

66 
	#mšÜ
(
dev
è
	`gnu_dev_mšÜ
 (dev)

	)

67 
	#makedev
(
maj
, 
mš
è
	`gnu_dev_makedev
 (maj, mš)

	)

	@/usr/include/time.h

23 #iâdef 
_TIME_H


25 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

26 ! 
defšed
 
	g__Ãed_time¥ec
)

27 
	#_TIME_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 #ifdef 
_TIME_H


36 
	#__Ãed_size_t


	)

37 
	#__Ãed_NULL


	)

38 
	~<¡ddef.h
>

42 
	~<b™s/time.h
>

45 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


46 #iâdeà
CLK_TCK


47 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

53 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

54 
	#__şock_t_defšed
 1

	)

56 
	~<b™s/ty³s.h
>

58 
__BEGIN_NAMESPACE_STD


60 
__şock_t
 
	tşock_t
;

61 
	g__END_NAMESPACE_STD


62 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


63 
	$__USING_NAMESPACE_STD
(
şock_t
)

67 #undeà
__Ãed_şock_t


69 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

70 
	#__time_t_defšed
 1

	)

72 
	~<b™s/ty³s.h
>

74 
__BEGIN_NAMESPACE_STD


76 
__time_t
 
	ttime_t
;

77 
__END_NAMESPACE_STD


78 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


79 
	$__USING_NAMESPACE_STD
(
time_t
)

83 #undeà
__Ãed_time_t


85 #ià!
defšed
 
__şockid_t_defšed
 && \

86 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

87 
	#__şockid_t_defšed
 1

	)

89 
	~<b™s/ty³s.h
>

92 
__şockid_t
 
	tşockid_t
;

95 #undeà
__şockid_time_t


97 #ià!
defšed
 
__tim”_t_defšed
 && \

98 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

99 
	#__tim”_t_defšed
 1

	)

101 
	~<b™s/ty³s.h
>

104 
__tim”_t
 
	ttim”_t
;

107 #undeà
__Ãed_tim”_t


110 #ià!
defšed
 
__time¥ec_defšed
 && \

111 ((
defšed
 
_TIME_H
 && \

112 (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
)) || \

113 
defšed
 
__Ãed_time¥ec
)

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 
__cÚ¡
 *
tm_zÚe
;

149 
__tm_gmtoff
;

150 
__cÚ¡
 *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 
__BEGIN_NAMESPACE_STD


183 
şock_t
 
	$şock
 (è
__THROW
;

186 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

189 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

190 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

193 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

199 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

200 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

201 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

202 
__END_NAMESPACE_STD


204 #ifdeà
__USE_XOPEN


207 *
	$¡½time
 (
__cÚ¡
 *
__»¡riù
 
__s
,

208 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
)

209 
__THROW
;

212 #ifdeà
__USE_XOPEN2K8


215 
	~<xloÿË.h
>

217 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

218 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

219 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

220 
__loÿË_t
 
__loc
è
__THROW
;

223 #ifdeà
__USE_GNU


224 *
	$¡½time_l
 (
__cÚ¡
 *
__»¡riù
 
__s
,

225 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

230 
__BEGIN_NAMESPACE_STD


233 
tm
 *
	$gmtime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

237 
tm
 *
	$loÿÉime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

238 
__END_NAMESPACE_STD


240 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


243 
tm
 *
	$gmtime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

244 
tm
 *
__»¡riù
 
__
è
__THROW
;

248 
tm
 *
	$loÿÉime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

249 
tm
 *
__»¡riù
 
__
è
__THROW
;

252 
__BEGIN_NAMESPACE_STD


255 *
	$asùime
 (
__cÚ¡
 
tm
 *
__
è
__THROW
;

258 *
	$ùime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

259 
__END_NAMESPACE_STD


261 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


266 *
	$asùime_r
 (
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

267 *
__»¡riù
 
__buf
è
__THROW
;

270 *
	$ùime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

271 *
__»¡riù
 
__buf
è
__THROW
;

276 *
__tzÇme
[2];

277 
__daylight
;

278 
__timezÚe
;

281 #ifdef 
__USE_POSIX


283 *
tzÇme
[2];

287 
	$tz£t
 (è
__THROW
;

290 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


291 
daylight
;

292 
timezÚe
;

295 #ifdeà
__USE_SVID


298 
	$¡ime
 (
__cÚ¡
 
time_t
 *
__wh’
è
__THROW
;

304 
	#__i¦—p
(
y—r
) \

305 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

308 #ifdeà
__USE_MISC


313 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

316 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

319 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

323 #ifdeà
__USE_POSIX199309


328 
	`Çno¦“p
 (
__cÚ¡
 
time¥ec
 *
__»que¡ed_time
,

329 
time¥ec
 *
__»maššg
);

333 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

336 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

339 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, 
__cÚ¡
 
time¥ec
 *
__
)

340 
__THROW
;

342 #ifdeà
__USE_XOPEN2K


347 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

348 
__cÚ¡
 
time¥ec
 *
__»q
,

349 
time¥ec
 *
__»m
);

352 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

357 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

358 
sigev’t
 *
__»¡riù
 
__evp
,

359 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

362 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

365 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

366 
__cÚ¡
 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

367 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

370 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

371 
__THROW
;

374 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

378 #ifdeà
__USE_XOPEN_EXTENDED


390 
g‘d©e_”r
;

399 
tm
 *
	`g‘d©e
 (
__cÚ¡
 *
__¡ršg
);

402 #ifdeà
__USE_GNU


413 
	`g‘d©e_r
 (
__cÚ¡
 *
__»¡riù
 
__¡ršg
,

414 
tm
 *
__»¡riù
 
__»sbuå
);

417 
__END_DECLS


	@/usr/include/zconf.h

8 #iâdeà
ZCONF_H


9 
	#ZCONF_H


	)

17 #ifdeà
Z_PREFIX


20 
	#_di¡_code
 
z__di¡_code


	)

21 
	#_Ëngth_code
 
z__Ëngth_code


	)

22 
	#_Œ_®ign
 
z__Œ_®ign


	)

23 
	#_Œ_æush_block
 
z__Œ_æush_block


	)

24 
	#_Œ_š™
 
z__Œ_š™


	)

25 
	#_Œ_¡Üed_block
 
z__Œ_¡Üed_block


	)

26 
	#_Œ_Îy
 
z__Œ_Îy


	)

27 
	#adËr32
 
z_adËr32


	)

28 
	#adËr32_combše
 
z_adËr32_combše


	)

29 
	#com´ess
 
z_com´ess


	)

30 
	#com´ess2
 
z_com´ess2


	)

31 
	#com´essBound
 
z_com´essBound


	)

32 
	#üc32
 
z_üc32


	)

33 
	#üc32_combše
 
z_üc32_combše


	)

34 
	#deæ©e
 
z_deæ©e


	)

35 
	#deæ©eBound
 
z_deæ©eBound


	)

36 
	#deæ©eCİy
 
z_deæ©eCİy


	)

37 
	#deæ©eEnd
 
z_deæ©eEnd


	)

38 
	#deæ©eIn™2_
 
z_deæ©eIn™2_


	)

39 
	#deæ©eIn™_
 
z_deæ©eIn™_


	)

40 
	#deæ©eP¬ams
 
z_deæ©eP¬ams


	)

41 
	#deæ©ePrime
 
z_deæ©ePrime


	)

42 
	#deæ©eRe£t
 
z_deæ©eRe£t


	)

43 
	#deæ©eS‘DiùiÚ¬y
 
z_deæ©eS‘DiùiÚ¬y


	)

44 
	#deæ©eS‘H—d”
 
z_deæ©eS‘H—d”


	)

45 
	#deæ©eTuÃ
 
z_deæ©eTuÃ


	)

46 
	#deæ©e_cİyright
 
z_deæ©e_cİyright


	)

47 
	#g‘_üc_bË
 
z_g‘_üc_bË


	)

48 
	#gzş—»¼
 
z_gzş—»¼


	)

49 
	#gzşo£
 
z_gzşo£


	)

50 
	#gzdœeù
 
z_gzdœeù


	)

51 
	#gzdİ’
 
z_gzdİ’


	)

52 
	#gzeof
 
z_gzeof


	)

53 
	#gz”rÜ
 
z_gz”rÜ


	)

54 
	#gzæush
 
z_gzæush


	)

55 
	#gzg‘c
 
z_gzg‘c


	)

56 
	#gzg‘s
 
z_gzg‘s


	)

57 
	#gzİ’
 
z_gzİ’


	)

58 
	#gz´štf
 
z_gz´štf


	)

59 
	#gzputc
 
z_gzputc


	)

60 
	#gzputs
 
z_gzputs


	)

61 
	#gz»ad
 
z_gz»ad


	)

62 
	#gz»wšd
 
z_gz»wšd


	)

63 
	#gz£ek
 
z_gz£ek


	)

64 
	#gz£¬ams
 
z_gz£¬ams


	)

65 
	#gz‹Î
 
z_gz‹Î


	)

66 
	#gzung‘c
 
z_gzung‘c


	)

67 
	#gzwr™e
 
z_gzwr™e


	)

68 
	#šæ©e
 
z_šæ©e


	)

69 
	#šæ©eBack
 
z_šæ©eBack


	)

70 
	#šæ©eBackEnd
 
z_šæ©eBackEnd


	)

71 
	#šæ©eBackIn™_
 
z_šæ©eBackIn™_


	)

72 
	#šæ©eCİy
 
z_šæ©eCİy


	)

73 
	#šæ©eEnd
 
z_šæ©eEnd


	)

74 
	#šæ©eG‘H—d”
 
z_šæ©eG‘H—d”


	)

75 
	#šæ©eIn™2_
 
z_šæ©eIn™2_


	)

76 
	#šæ©eIn™_
 
z_šæ©eIn™_


	)

77 
	#šæ©ePrime
 
z_šæ©ePrime


	)

78 
	#šæ©eRe£t
 
z_šæ©eRe£t


	)

79 
	#šæ©eS‘DiùiÚ¬y
 
z_šæ©eS‘DiùiÚ¬y


	)

80 
	#šæ©eSync
 
z_šæ©eSync


	)

81 
	#šæ©eSyncPošt
 
z_šæ©eSyncPošt


	)

82 
	#šæ©e_cİyright
 
z_šæ©e_cİyright


	)

83 
	#šæ©e_ç¡
 
z_šæ©e_ç¡


	)

84 
	#šæ©e_bË
 
z_šæ©e_bË


	)

85 
	#uncom´ess
 
z_uncom´ess


	)

86 
	#zE¼Ü
 
z_zE¼Ü


	)

87 
	#z_”rmsg
 
z_z_”rmsg


	)

88 
	#zÿÎoc
 
z_zÿÎoc


	)

89 
	#zcä“
 
z_zcä“


	)

90 
	#zlibCompeFÏgs
 
z_zlibCompeFÏgs


	)

91 
	#zlibV”siÚ
 
z_zlibV”siÚ


	)

94 
	#By‹
 
z_By‹


	)

95 
	#By‹f
 
z_By‹f


	)

96 
	#®loc_func
 
z_®loc_func


	)

97 
	#ch¬f
 
z_ch¬f


	)

98 
	#ä“_func
 
z_ä“_func


	)

99 
	#gzFe
 
z_gzFe


	)

100 
	#gz_h—d”
 
z_gz_h—d”


	)

101 
	#gz_h—d”p
 
z_gz_h—d”p


	)

102 
	#š_func
 
z_š_func


	)

103 
	#štf
 
z_štf


	)

104 
	#out_func
 
z_out_func


	)

105 
	#uIÁ
 
z_uIÁ


	)

106 
	#uIÁf
 
z_uIÁf


	)

107 
	#uLÚg
 
z_uLÚg


	)

108 
	#uLÚgf
 
z_uLÚgf


	)

109 
	#voidp
 
z_voidp


	)

110 
	#voidp
 
z_voidp


	)

111 
	#voidpc
 
z_voidpc


	)

112 
	#voidpc
 
z_voidpc


	)

113 
	#voidpf
 
z_voidpf


	)

114 
	#voidpf
 
z_voidpf


	)

115 
	#z_¡»am
 
z_z_¡»am


	)

116 
	#z_¡»amp
 
z_z_¡»amp


	)

119 
	#gz_h—d”_s
 
z_gz_h—d”_s


	)

120 
	#š‹º®_¡©e
 
z_š‹º®_¡©e


	)

121 
	#z_¡»am_s
 
z_z_¡»am_s


	)

125 #ià
defšed
(
__MSDOS__
è&& !defšed(
MSDOS
)

126 
	#MSDOS


	)

128 #ià(
defšed
(
OS_2
è|| defšed(
__OS2__
)è&& !defšed(
OS2
)

129 
	#OS2


	)

131 #ià
defšed
(
_WINDOWS
è&& !defšed(
WINDOWS
)

132 
	#WINDOWS


	)

134 #ià
defšed
(
_WIN32
è|| defšed(
_WIN32_WCE
è|| defšed(
__WIN32__
)

135 #iâdeà
WIN32


136 
	#WIN32


	)

139 #ià(
defšed
(
MSDOS
è|| defšed(
OS2
è|| defšed(
WINDOWS
)è&& !defšed(
WIN32
)

140 #ià!
defšed
(
__GNUC__
è&& !defšed(
__FLAT__
è&& !defšed(
__386__
)

141 #iâdeà
SYS16BIT


142 
	#SYS16BIT


	)

151 #ifdeà
SYS16BIT


152 
	#MAXSEG_64K


	)

154 #ifdeà
MSDOS


155 
	#UNALIGNED_OK


	)

158 #ifdeà
__STDC_VERSION__


159 #iâdeà
STDC


160 
	#STDC


	)

162 #ià
__STDC_VERSION__
 >= 199901L

163 #iâdeà
STDC99


164 
	#STDC99


	)

168 #ià!
defšed
(
STDC
è&& (defšed(
__STDC__
è|| defšed(
__ılu¥lus
))

169 
	#STDC


	)

171 #ià!
defšed
(
STDC
è&& (defšed(
__GNUC__
è|| defšed(
__BORLANDC__
))

172 
	#STDC


	)

174 #ià!
defšed
(
STDC
è&& (defšed(
MSDOS
è|| defšed(
WINDOWS
è|| defšed(
WIN32
))

175 
	#STDC


	)

177 #ià!
defšed
(
STDC
è&& (defšed(
OS2
è|| defšed(
__HOS_AIX__
))

178 
	#STDC


	)

181 #ià
defšed
(
__OS400__
è&& !defšed(
STDC
)

182 
	#STDC


	)

185 #iâdeà
STDC


187 cÚ¡

	)

192 #ià
defšed
(
__MWERKS__
)||defšed(
­¶ec
)||defšed(
THINK_C
)||defšed(
__SC__
)

193 
	#NO_DUMMY_DECL


	)

197 #iâdeà
MAX_MEM_LEVEL


198 #ifdeà
MAXSEG_64K


199 
	#MAX_MEM_LEVEL
 8

	)

201 
	#MAX_MEM_LEVEL
 9

	)

210 #iâdeà
MAX_WBITS


211 
	#MAX_WBITS
 15

	)

229 #iâdeà
OF


230 #ifdeà
STDC


231 
	#OF
(
¬gs
è
	)
args

233 
	#OF
(
¬gs
è()

	)

243 #ifdeà
SYS16BIT


244 #ià
defšed
(
M_I86SM
è|| defšed(
M_I86MM
)

246 
	#SMALL_MEDIUM


	)

247 #ifdeà
_MSC_VER


248 
	#FAR
 
_çr


	)

250 
	#FAR
 
çr


	)

253 #ià(
defšed
(
__SMALL__
è|| defšed(
__MEDIUM__
))

255 
	#SMALL_MEDIUM


	)

256 #ifdeà
__BORLANDC__


257 
	#FAR
 
_çr


	)

259 
	#FAR
 
çr


	)

264 #ià
defšed
(
WINDOWS
è|| defšed(
WIN32
)

268 #ifdeà
ZLIB_DLL


269 #ià
defšed
(
WIN32
è&& (!defšed(
__BORLANDC__
) || (__BORLANDC__ >= 0x500))

270 #ifdeà
ZLIB_INTERNAL


271 
	#ZEXTERN
 
	`__deş¥ec
(
dÎexpÜt
)

	)

273 
	#ZEXTERN
 
	`__deş¥ec
(
dÎimpÜt
)

	)

281 #ifdeà
ZLIB_WINAPI


282 #ifdeà
FAR


283 #undeà
FAR


285 
	~<wšdows.h
>

288 
	#ZEXPORT
 
WINAPI


	)

289 #ifdeà
WIN32


290 
	#ZEXPORTVA
 
WINAPIV


	)

292 
	#ZEXPORTVA
 
FAR
 
CDECL


	)

297 #ià
defšed
 (
__BEOS__
)

298 #ifdeà
ZLIB_DLL


299 #ifdeà
ZLIB_INTERNAL


300 
	#ZEXPORT
 
	`__deş¥ec
(
dÎexpÜt
)

	)

301 
	#ZEXPORTVA
 
	`__deş¥ec
(
dÎexpÜt
)

	)

303 
	#ZEXPORT
 
	`__deş¥ec
(
dÎimpÜt
)

	)

304 
	#ZEXPORTVA
 
	`__deş¥ec
(
dÎimpÜt
)

	)

309 #ifdeà
HAVE_VISIBILITY_PRAGMA


310 
	#ZEXTERN
 
	`__©Œibu‹__
((
	`visib™y
 ("deçuÉ"))è

	)

313 #iâdeà
ZEXTERN


314 
	#ZEXTERN
 

	)

316 #iâdeà
ZEXPORT


317 
	#ZEXPORT


	)

319 #iâdeà
ZEXPORTVA


320 
	#ZEXPORTVA


	)

323 #iâdeà
FAR


324 
	#FAR


	)

327 #ià!
defšed
(
__MACTYPES__
)

328 
	tBy‹
;

330 
	tuIÁ
;

331 
	tuLÚg
;

333 #ifdeà
SMALL_MEDIUM


335 
	#By‹f
 
By‹
 
FAR


	)

337 
By‹
 
	tFAR
 
	tBy‹f
;

339 
	tFAR
 
	tch¬f
;

340 
	tFAR
 
	tštf
;

341 
uIÁ
 
	tFAR
 
	tuIÁf
;

342 
uLÚg
 
	tFAR
 
	tuLÚgf
;

344 #ifdeà
STDC


345 cÚ¡ *
	tvoidpc
;

346 
	tFAR
 *
	tvoidpf
;

347 *
	tvoidp
;

349 
By‹
 cÚ¡ *
	tvoidpc
;

350 
By‹
 
	tFAR
 *
	tvoidpf
;

351 
By‹
 *
	tvoidp
;

354 
	~"zlibdefs.h
"

356 #ifdeà
_LARGEFILE64_SOURCE


357 
	~<sys/ty³s.h
>

360 #iâdeà
SEEK_SET


361 
	#SEEK_SET
 0

	)

362 
	#SEEK_CUR
 1

	)

363 
	#SEEK_END
 2

	)

365 #iâdeà
z_off_t


366 
	#z_off_t
 

	)

369 #ià
defšed
(
__OS400__
)

370 
	#NO_v¢´štf


	)

373 #ià
defšed
(
__MVS__
)

374 
	#NO_v¢´štf


	)

378 #ià
defšed
(
__MVS__
)

379 #´agm¨
m­
(
deæ©eIn™_
,"DEIN")

380 #´agm¨
m­
(
deæ©eIn™2_
,"DEIN2")

381 #´agm¨
m­
(
deæ©eEnd
,"DEEND")

382 #´agm¨
m­
(
deæ©eBound
,"DEBND")

383 #´agm¨
m­
(
šæ©eIn™_
,"ININ")

384 #´agm¨
m­
(
šæ©eIn™2_
,"ININ2")

385 #´agm¨
m­
(
šæ©eEnd
,"INEND")

386 #´agm¨
m­
(
šæ©eSync
,"INSY")

387 #´agm¨
m­
(
šæ©eS‘DiùiÚ¬y
,"INSEDI")

388 #´agm¨
m­
(
com´essBound
,"CMBND")

389 #´agm¨
m­
(
šæ©e_bË
,"INTABL")

390 #´agm¨
m­
(
šæ©e_ç¡
,"INFA")

391 #´agm¨
m­
(
šæ©e_cİyright
,"INCOPY")

	@/usr/include/bits/byteswap.h

21 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


25 #iâdeà
_BITS_BYTESWAP_H


26 
	#_BITS_BYTESWAP_H
 1

	)

28 
	~<b™s/wÜdsize.h
>

31 
	#__bsw­_cÚ¡ªt_16
(
x
) \

32 ((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8))

	)

34 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

35 
	#__bsw­_16
(
x
) \

36 (
__ex‹nsiÚ__
 \

37 ({ 
__v
, 
__x
 = (
x
); \

38 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

39 
__v
 = 
	`__bsw­_cÚ¡ªt_16
 (
__x
); \

41 
	`__asm__
 ("rorw $8, %w0" \

42 : "ô" (
__v
) \

43 : "0" (
__x
) \

45 
__v
; }))

	)

48 
	#__bsw­_16
(
x
) \

49 (
__ex‹nsiÚ__
 \

50 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_16
 (__x); }))

	)

55 
	#__bsw­_cÚ¡ªt_32
(
x
) \

56 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

57 (((
x
è& 0x0000ff00è<< 8è| (((xè& 0x000000ffè<< 24))

	)

59 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

60 #ià
__WORDSIZE
 =ğ64 || (
defšed
 
__i486__
 || defšed 
__³Áium__
 \

61 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

62 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

63 || 
defšed
 
	g__k6__
 || defšed 
	g__nocÚa__
 \

64 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__geode__
 \

65 || 
defšed
 
	g__amdçm10__
)

68 
	#__bsw­_32
(
x
) \

69 (
__ex‹nsiÚ__
 \

70 ({ 
__v
, 
__x
 = (
x
); \

71 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

72 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

74 
	`__asm__
 ("bsw­ %0" : "ô" (
__v
è: "0" (
__x
)); \

75 
__v
; }))

	)

77 
	#__bsw­_32
(
x
) \

78 (
__ex‹nsiÚ__
 \

79 ({ 
__v
, 
__x
 = (
x
); \

80 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

81 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

83 
	`__asm__
 ("rorw $8, %w0;" \

86 : "ô" (
__v
) \

87 : "0" (
__x
) \

89 
__v
; }))

	)

92 
	#__bsw­_32
(
x
) \

93 (
__ex‹nsiÚ__
 \

94 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_32
 (__x); }))

	)

98 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

100 
	#__bsw­_cÚ¡ªt_64
(
x
) \

101 ((((
x
) & 0xff00000000000000ull) >> 56) \

102 | (((
x
) & 0x00ff000000000000ull) >> 40) \

103 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

104 | (((
x
) & 0x000000ff00000000ull) >> 8) \

105 | (((
x
) & 0x00000000ff000000ull) << 8) \

106 | (((
x
) & 0x0000000000ff0000ull) << 24) \

107 | (((
x
) & 0x000000000000ff00ull) << 40) \

108 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

110 #ià
__WORDSIZE
 == 64

111 
	#__bsw­_64
(
x
) \

112 (
__ex‹nsiÚ__
 \

113 ({ 
__v
, 
__x
 = (
x
); \

114 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

115 
__v
 = 
	`__bsw­_cÚ¡ªt_64
 (
__x
); \

117 
	`__asm__
 ("bsw­ %q0" : "ô" (
__v
è: "0" (
__x
)); \

118 
__v
; }))

	)

120 
	#__bsw­_64
(
x
) \

121 (
__ex‹nsiÚ__
 \

122 ({ uniÚ { 
__ex‹nsiÚ__
 
__Î
; \

123 
__l
[2]; } 
__w
, 
__r
; \

124 ià(
	`__butš_cÚ¡ªt_p
 (
x
)) \

125 
__r
.
__Î
 = 
	`__bsw­_cÚ¡ªt_64
 (
x
); \

128 
__w
.
__Î
 = (
x
); \

129 
__r
.
__l
[0] = 
	`__bsw­_32
 (
__w
.__l[1]); \

130 
__r
.
__l
[1] = 
	`__bsw­_32
 (
__w
.__l[0]); \

132 
__r
.
__Î
; }))

	)

	@/usr/include/bits/endian.h

3 #iâdeà
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/predefs.h

19 #iâdeà
_FEATURES_H


23 #iâdeà
_PREDEFS_H


24 
	#_PREDEFS_H


	)

27 
	#__STDC_IEC_559__
 1

	)

28 
	#__STDC_IEC_559_COMPLEX__
 1

	)

	@/usr/include/bits/select.h

19 #iâdeà
_SYS_SELECT_H


23 
	~<b™s/wÜdsize.h
>

26 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

28 #ià
__WORDSIZE
 == 64

29 
	#__FD_ZERO_STOS
 "¡osq"

	)

31 
	#__FD_ZERO_STOS
 "¡o¦"

	)

34 
	#__FD_ZERO
(
fd¥
) \

36 
__d0
, 
__d1
; \

37 
__asm__
 
	`__vŞ©e__
 ("şd;„•; " 
__FD_ZERO_STOS
 \

38 : "=c" (
__d0
), "=D" (
__d1
) \

39 : "a" (0), "0" ( (
fd_£t
) \

40 /  (
__fd_mask
)), \

41 "1" (&
	`__FDS_BITS
 (
fd¥
)[0]) \

43 } 0)

	)

49 
	#__FD_ZERO
(
£t
) \

51 
__i
; \

52 
fd_£t
 *
__¬r
 = (
£t
); \

53 
__i
 = 0; __˜<  (
fd_£t
è/  (
__fd_mask
); ++__i) \

54 
	`__FDS_BITS
 (
__¬r
)[
__i
] = 0; \

55 } 0)

	)

59 
	#__FD_SET
(
d
, 
£t
è(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] |ğ
	`__FDMASK
 (d))

	)

60 
	#__FD_CLR
(
d
, 
£t
è(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] &ğ~
	`__FDMASK
 (d))

	)

61 
	#__FD_ISSET
(
d
, 
£t
) \

62 ((
	`__FDS_BITS
 (
£t
)[
	`__FDELT
 (
d
)] & 
	`__FDMASK
 (d)è!ğ0)

	)

	@/usr/include/bits/sigset.h

21 #iâdef 
_SIGSET_H_ty³s


22 
	#_SIGSET_H_ty³s
 1

	)

24 
	t__sig_©omic_t
;

28 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

31 
	m__v®
[
_SIGSET_NWORDS
];

32 } 
	t__sig£t_t
;

43 #ià!
defšed
 
_SIGSET_H_âs
 && defšed 
_SIGNAL_H


44 
	#_SIGSET_H_âs
 1

	)

46 #iâdeà
_EXTERN_INLINE


47 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

51 
	#__sigmask
(
sig
) \

52 (((è1è<< (((
sig
è- 1è% (8 *  ())))

	)

55 
	#__sigwÜd
(
sig
è(((sigè- 1è/ (8 *  ()))

	)

57 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

58 
	#__sigem±y£t
(
£t
) \

59 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

60 
sig£t_t
 *
__£t
 = (
£t
); \

61 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = 0; \

62 0; }))

	)

63 
	#__sigfl£t
(
£t
) \

64 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

65 
sig£t_t
 *
__£t
 = (
£t
); \

66 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = ~0UL; \

67 0; }))

	)

69 #ifdeà
__USE_GNU


73 
	#__sigi£m±y£t
(
£t
) \

74 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

75 cÚ¡ 
sig£t_t
 *
__£t
 = (
£t
); \

76 
__»t
 = 
__£t
->
__v®
[--
__út
]; \

77 !
__»t
 && --
__út
 >= 0) \

78 
__»t
 = 
__£t
->
__v®
[
__út
]; \

79 
__»t
 =ğ0; }))

	)

80 
	#__sigªd£t
(
de¡
, 
Ëá
, 
right
) \

81 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

82 
sig£t_t
 *
__de¡
 = (
de¡
); \

83 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

84 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

85 --
__út
 >= 0) \

86 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

87 & 
__right
->
__v®
[
__út
]); \

88 0; }))

	)

89 
	#__sigÜ£t
(
de¡
, 
Ëá
, 
right
) \

90 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

91 
sig£t_t
 *
__de¡
 = (
de¡
); \

92 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

93 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

94 --
__út
 >= 0) \

95 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

96 | 
__right
->
__v®
[
__út
]); \

97 0; }))

	)

104 
__sigismemb”
 (
__cÚ¡
 
__sig£t_t
 *, );

105 
__sigadd£t
 (
__sig£t_t
 *, );

106 
__sigd–£t
 (
__sig£t_t
 *, );

108 #ifdeà
__USE_EXTERN_INLINES


109 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

110 
_EXTERN_INLINE
 \

111 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

113 
__mask
 = 
	`__sigmask
 (
__sig
); \

114 
__wÜd
 = 
	`__sigwÜd
 (
__sig
); \

115  
BODY
; \

116 }

	)

118 
__SIGSETFN
 (
__sigismemb”
, (
__£t
->
__v®
[
__wÜd
] & 
__mask
è? 1 : 0, 
__cÚ¡
)

119 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__v®
[
__wÜd
] |ğ
__mask
), 0), )

120 
__SIGSETFN
 (
__sigd–£t
, ((
__£t
->
__v®
[
__wÜd
] &ğ~
__mask
), 0), )

122 #undeà
__SIGSETFN


	@/usr/include/bits/stat.h

19 #iâdeà
_SYS_STAT_H


24 
	#_STAT_VER_KERNEL
 0

	)

26 #ià
__WORDSIZE
 == 32

27 
	#_STAT_VER_SVR4
 2

	)

28 
	#_STAT_VER_LINUX
 3

	)

31 
	#_MKNOD_VER_LINUX
 1

	)

32 
	#_MKNOD_VER_SVR4
 2

	)

33 
	#_MKNOD_VER
 
_MKNOD_VER_LINUX


	)

35 
	#_STAT_VER_LINUX
 1

	)

38 
	#_MKNOD_VER_LINUX
 0

	)

41 
	#_STAT_VER
 
_STAT_VER_LINUX


	)

43 
	s¡©


45 
__dev_t
 
	m¡_dev
;

46 #ià
__WORDSIZE
 == 32

47 
	m__·d1
;

49 #ià
__WORDSIZE
 =ğ64 || !
defšed
 
__USE_FILE_OFFSET64


50 
__šo_t
 
	m¡_šo
;

52 
__šo_t
 
	m__¡_šo
;

54 #ià
__WORDSIZE
 == 32

55 
__mode_t
 
	m¡_mode
;

56 
__Æšk_t
 
	m¡_Æšk
;

58 
__Æšk_t
 
	m¡_Æšk
;

59 
__mode_t
 
	m¡_mode
;

61 
__uid_t
 
	m¡_uid
;

62 
__gid_t
 
	m¡_gid
;

63 #ià
__WORDSIZE
 == 64

64 
	m__·d0
;

66 
__dev_t
 
	m¡_rdev
;

67 #ià
__WORDSIZE
 == 32

68 
	m__·d2
;

70 #ià
__WORDSIZE
 =ğ64 || !
defšed
 
__USE_FILE_OFFSET64


71 
__off_t
 
	m¡_size
;

73 
__off64_t
 
	m¡_size
;

75 
__blksize_t
 
	m¡_blksize
;

76 #ià
__WORDSIZE
 =ğ64 || !
defšed
 
__USE_FILE_OFFSET64


77 
__blkút_t
 
	m¡_blocks
;

79 
__blkút64_t
 
	m¡_blocks
;

81 #ifdeà
__USE_MISC


88 
time¥ec
 
	m¡_©im
;

89 
time¥ec
 
	m¡_mtim
;

90 
time¥ec
 
	m¡_ùim
;

91 
	#¡_©ime
 
¡_©im
.
tv_£c


	)

92 
	#¡_mtime
 
¡_mtim
.
tv_£c


	)

93 
	#¡_ùime
 
¡_ùim
.
tv_£c


	)

95 
__time_t
 
	m¡_©ime
;

96 
	m¡_©im’£c
;

97 
__time_t
 
	m¡_mtime
;

98 
	m¡_mtim’£c
;

99 
__time_t
 
	m¡_ùime
;

100 
	m¡_ùim’£c
;

102 #ià
__WORDSIZE
 == 64

103 
	m__unu£d
[3];

105 #iâdeà
__USE_FILE_OFFSET64


106 
	m__unu£d4
;

107 
	m__unu£d5
;

109 
__šo64_t
 
	m¡_šo
;

114 #ifdeà
__USE_LARGEFILE64


116 
	s¡©64


118 
__dev_t
 
	m¡_dev
;

119 #ià
__WORDSIZE
 == 64

120 
__šo64_t
 
	m¡_šo
;

121 
__Æšk_t
 
	m¡_Æšk
;

122 
__mode_t
 
	m¡_mode
;

124 
	m__·d1
;

125 
__šo_t
 
	m__¡_šo
;

126 
__mode_t
 
	m¡_mode
;

127 
__Æšk_t
 
	m¡_Æšk
;

129 
__uid_t
 
	m¡_uid
;

130 
__gid_t
 
	m¡_gid
;

131 #ià
__WORDSIZE
 == 64

132 
	m__·d0
;

133 
__dev_t
 
	m¡_rdev
;

134 
__off_t
 
	m¡_size
;

136 
__dev_t
 
	m¡_rdev
;

137 
	m__·d2
;

138 
__off64_t
 
	m¡_size
;

140 
__blksize_t
 
	m¡_blksize
;

141 
__blkút64_t
 
	m¡_blocks
;

142 #ifdeà
__USE_MISC


149 
time¥ec
 
	m¡_©im
;

150 
time¥ec
 
	m¡_mtim
;

151 
time¥ec
 
	m¡_ùim
;

152 
	#¡_©ime
 
¡_©im
.
tv_£c


	)

153 
	#¡_mtime
 
¡_mtim
.
tv_£c


	)

154 
	#¡_ùime
 
¡_ùim
.
tv_£c


	)

156 
__time_t
 
	m¡_©ime
;

157 
	m¡_©im’£c
;

158 
__time_t
 
	m¡_mtime
;

159 
	m¡_mtim’£c
;

160 
__time_t
 
	m¡_ùime
;

161 
	m¡_ùim’£c
;

163 #ià
__WORDSIZE
 == 64

164 
	m__unu£d
[3];

166 
__šo64_t
 
	m¡_šo
;

172 
	#_STATBUF_ST_BLKSIZE


	)

173 
	#_STATBUF_ST_RDEV


	)

175 
	#_STATBUF_ST_NSEC


	)

179 
	#__S_IFMT
 0170000

	)

182 
	#__S_IFDIR
 0040000

	)

183 
	#__S_IFCHR
 0020000

	)

184 
	#__S_IFBLK
 0060000

	)

185 
	#__S_IFREG
 0100000

	)

186 
	#__S_IFIFO
 0010000

	)

187 
	#__S_IFLNK
 0120000

	)

188 
	#__S_IFSOCK
 0140000

	)

192 
	#__S_TYPEISMQ
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

193 
	#__S_TYPEISSEM
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

194 
	#__S_TYPEISSHM
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

198 
	#__S_ISUID
 04000

	)

199 
	#__S_ISGID
 02000

	)

200 
	#__S_ISVTX
 01000

	)

201 
	#__S_IREAD
 0400

	)

202 
	#__S_IWRITE
 0200

	)

203 
	#__S_IEXEC
 0100

	)

205 #ifdeà
__USE_ATFILE


206 
	#UTIME_NOW
 ((1È<< 30è- 1l)

	)

207 
	#UTIME_OMIT
 ((1È<< 30è- 2l)

	)

	@/usr/include/bits/time.h

24 #iâdeà
__Ãed_timev®


25 #iâdeà
_BITS_TIME_H


26 
	#_BITS_TIME_H
 1

	)

34 
	#CLOCKS_PER_SEC
 1000000l

	)

36 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


39 
	~<b™s/ty³s.h
>

40 
__syscÚf
 ();

41 
	#CLK_TCK
 ((
__şock_t
è
	`__syscÚf
 (2)è

	)

44 #ifdeà
__USE_POSIX199309


46 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

50 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

52 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

55 
	#TIMER_ABSTIME
 1

	)

61 #ifdeà
__Ãed_timev®


62 #undeà
__Ãed_timev®


63 #iâdeà
_STRUCT_TIMEVAL


64 
	#_STRUCT_TIMEVAL
 1

	)

65 
	~<b™s/ty³s.h
>

69 
	stimev®


71 
__time_t
 
	mtv_£c
;

72 
__su£cÚds_t
 
	mtv_u£c
;

	@/usr/include/bits/typesizes.h

20 #iâdeà
_BITS_TYPES_H


24 #iâdef 
_BITS_TYPESIZES_H


25 
	#_BITS_TYPESIZES_H
 1

	)

30 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

31 
	#__UID_T_TYPE
 
__U32_TYPE


	)

32 
	#__GID_T_TYPE
 
__U32_TYPE


	)

33 
	#__INO_T_TYPE
 
__ULONGWORD_TYPE


	)

34 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

35 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

36 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

37 
	#__OFF_T_TYPE
 
__SLONGWORD_TYPE


	)

38 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

39 
	#__PID_T_TYPE
 
__S32_TYPE


	)

40 
	#__RLIM_T_TYPE
 
__ULONGWORD_TYPE


	)

41 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

42 
	#__BLKCNT_T_TYPE
 
__SLONGWORD_TYPE


	)

43 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

44 
	#__FSBLKCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

45 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

46 
	#__FSFILCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

47 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

48 
	#__ID_T_TYPE
 
__U32_TYPE


	)

49 
	#__CLOCK_T_TYPE
 
__SLONGWORD_TYPE


	)

50 
	#__TIME_T_TYPE
 
__SLONGWORD_TYPE


	)

51 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

52 
	#__SUSECONDS_T_TYPE
 
__SLONGWORD_TYPE


	)

53 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

54 
	#__SWBLK_T_TYPE
 
__SLONGWORD_TYPE


	)

55 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

56 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

57 
	#__TIMER_T_TYPE
 *

	)

58 
	#__BLKSIZE_T_TYPE
 
__SLONGWORD_TYPE


	)

59 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

60 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

63 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/uio.h

19 #ià!
defšed
 
_SYS_UIO_H
 && !defšed 
_FCNTL_H


23 #iâdeà
_BITS_UIO_H


24 
	#_BITS_UIO_H
 1

	)

26 
	~<sys/ty³s.h
>

40 
	#UIO_MAXIOV
 1024

	)

44 
	siovec


46 *
	miov_ba£
;

47 
size_t
 
	miov_Ën
;

	@/usr/include/bits/wchar.h

20 #iâdeà
_BITS_WCHAR_H


21 
	#_BITS_WCHAR_H
 1

	)

24 #ifdeà
__WCHAR_MAX__


25 
	#__WCHAR_MAX
 
__WCHAR_MAX__


	)

27 
	#__WCHAR_MAX
 (2147483647)

	)

32 #ifdeà
__WCHAR_UNSIGNED__


33 
	#__WCHAR_MIN
 
L
'\0'

	)

37 #–ià
L
'\0' - 1 > 0

38 
	#__WCHAR_MIN
 
L
'\0'

	)

40 
	#__WCHAR_MIN
 (-
__WCHAR_MAX
 - 1)

	)

	@/usr/include/ctype.h

24 #iâdef 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

30 
	g__BEGIN_DECLS


32 #iâdeà
_ISb™


41 
	~<’dŸn.h
>

42 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


43 
	#_ISb™
(
b™
è(1 << (b™))

	)

45 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

50 
	m_ISuµ”
 = 
_ISb™
 (0),

51 
	m_ISlow”
 = 
_ISb™
 (1),

52 
	m_IS®pha
 = 
_ISb™
 (2),

53 
	m_ISdig™
 = 
_ISb™
 (3),

54 
	m_ISxdig™
 = 
_ISb™
 (4),

55 
	m_IS¥aû
 = 
_ISb™
 (5),

56 
	m_IS´št
 = 
_ISb™
 (6),

57 
	m_ISg¿ph
 = 
_ISb™
 (7),

58 
	m_ISbÏnk
 = 
_ISb™
 (8),

59 
	m_ISúŒl
 = 
_ISb™
 (9),

60 
	m_ISpunù
 = 
_ISb™
 (10),

61 
	m_IS®num
 = 
_ISb™
 (11)

81 
__cÚ¡
 **
	$__ùy³_b_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

83 
__cÚ¡
 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

85 
__cÚ¡
 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

86 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

91 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

92 
	#__tßscii
(
c
è((cè& 0x7fè

	)

94 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

96 
__BEGIN_NAMESPACE_STD


102 
	`__exùy³
 (
i§Êum
);

103 
	`__exùy³
 (
i§Íha
);

104 
	`__exùy³
 (
isúŒl
);

105 
	`__exùy³
 (
isdig™
);

106 
	`__exùy³
 (
i¦ow”
);

107 
	`__exùy³
 (
isg¿ph
);

108 
	`__exùy³
 (
i¥ršt
);

109 
	`__exùy³
 (
i¥unù
);

110 
	`__exùy³
 (
is¥aû
);

111 
	`__exùy³
 (
isuµ”
);

112 
	`__exùy³
 (
isxdig™
);

116 
	$tŞow”
 (
__c
è
__THROW
;

119 
	$touµ”
 (
__c
è
__THROW
;

121 
__END_NAMESPACE_STD


125 #ifdef 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
	`__exùy³
 (
isbÏnk
);

130 
__END_NAMESPACE_C99


133 #ifdeà
__USE_GNU


135 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

138 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


142 
	$i§scii
 (
__c
è
__THROW
;

146 
	$tßscii
 (
__c
è
__THROW
;

150 
	`__exùy³
 (
_touµ”
);

151 
	`__exùy³
 (
_tŞow”
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

156 (
__ex‹nsiÚ__
 \

157 ({ 
__»s
; \

158 ià( (
c
) > 1) \

160 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

166 
__»s
 = 
f
 
¬gs
; \

169 
__»s
 = (
a
)[(è(
c
)]; \

170 
__»s
; 
	}
}))

	)

172 #ià!
defšed
 
__NO_CTYPE
 && !defšed 
__ılu¥lus


173 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

174 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

175 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

176 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

177 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

178 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

179 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

180 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

181 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

182 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

183 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

185 #ifdeà
__USE_ISOC99


186 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

189 #ifdeà
__USE_EXTERN_INLINES


190 
__ex‹º_šlše
 

191 
__NTH
 (
	$tŞow”
 (
__c
))

193  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

194 
	}
}

196 
__ex‹º_šlše
 

197 
__NTH
 (
	$touµ”
 (
__c
))

199  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

200 
	}
}

203 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


204 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

205 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

208 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


209 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

210 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

212 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

213 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

219 #ifdeà
__USE_XOPEN2K8


233 
	~<xloÿË.h
>

237 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

238 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

240 
	#__exùy³_l
(
Çme
) \

241 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

247 
__exùy³_l
 (
i§Êum_l
);

248 
__exùy³_l
 (
i§Íha_l
);

249 
__exùy³_l
 (
isúŒl_l
);

250 
__exùy³_l
 (
isdig™_l
);

251 
__exùy³_l
 (
i¦ow”_l
);

252 
__exùy³_l
 (
isg¿ph_l
);

253 
__exùy³_l
 (
i¥ršt_l
);

254 
__exùy³_l
 (
i¥unù_l
);

255 
__exùy³_l
 (
is¥aû_l
);

256 
__exùy³_l
 (
isuµ”_l
);

257 
__exùy³_l
 (
isxdig™_l
);

259 
__exùy³_l
 (
isbÏnk_l
);

263 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

264 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

267 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

268 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

270 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


271 
	#__tŞow”_l
(
c
, 
loÿË
) \

272 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

273 
	#__touµ”_l
(
c
, 
loÿË
) \

274 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

275 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

276 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

280 #iâdeà
__NO_CTYPE


281 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

282 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

283 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

284 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

285 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

286 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

287 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

288 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

289 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

290 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

291 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

293 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

295 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


296 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

297 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

300 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

301 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

302 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

303 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

304 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

305 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

306 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

307 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

308 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

309 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

310 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

312 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

314 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


315 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

316 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

323 
__END_DECLS


	@/usr/include/gnu/stubs.h

4 
	~<b™s/wÜdsize.h
>

6 #ià
__WORDSIZE
 == 32

7 
	~<gnu/¡ubs-32.h
>

8 #–ià
__WORDSIZE
 == 64

9 
	~<gnu/¡ubs-64.h
>

	@/usr/include/sys/cdefs.h

20 #iâdef 
_SYS_CDEFS_H


21 
	#_SYS_CDEFS_H
 1

	)

24 #iâdeà
_FEATURES_H


25 
	~<ã©u»s.h
>

31 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


36 #undeà
__P


37 #undeà
__PMT


39 #ifdeà
__GNUC__


46 #ià!
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

47 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

48 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
)è
	)
fct

50 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

51 
	#__THROW
 
	`throw
 ()

	)

52 
	#__NTH
(
fù
èfù 
	`throw
 ()

	)

54 
	#__THROW


	)

55 
	#__NTH
(
fù
è
	)
fct

61 
	#__šlše


	)

63 
	#__THROW


	)

64 
	#__NTH
(
fù
è
	)
fct

66 
	#__cÚ¡
 cÚ¡

	)

67 
	#__sigÃd
 sigÃd

	)

68 
	#__vŞ©e
 vŞ©e

	)

74 
	#__P
(
¬gs
è
	)
args

75 
	#__PMT
(
¬gs
è
	)
args

80 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

81 
	#__STRING
(
x
è#x

	)

84 
	#__±r_t
 *

	)

85 
	#__lÚg_doubË_t
 

	)

89 #ifdef 
__ılu¥lus


90 
	#__BEGIN_DECLS
 "C" {

	)

91 
	#__END_DECLS
 }

	)

93 
	#__BEGIN_DECLS


	)

94 
	#__END_DECLS


	)

103 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES


104 
	#__BEGIN_NAMESPACE_STD
 
Çme¥aû
 
¡d
 {

	)

105 
	#__END_NAMESPACE_STD
 }

	)

106 
	#__USING_NAMESPACE_STD
(
Çme
è
usšg
 
¡d
::Çme;

	)

107 
	#__BEGIN_NAMESPACE_C99
 
Çme¥aû
 
__c99
 {

	)

108 
	#__END_NAMESPACE_C99
 }

	)

109 
	#__USING_NAMESPACE_C99
(
Çme
è
usšg
 
__c99
::Çme;

	)

114 
	#__BEGIN_NAMESPACE_STD


	)

115 
	#__END_NAMESPACE_STD


	)

116 
	#__USING_NAMESPACE_STD
(
Çme
)

	)

117 
	#__BEGIN_NAMESPACE_C99


	)

118 
	#__END_NAMESPACE_C99


	)

119 
	#__USING_NAMESPACE_C99
(
Çme
)

	)

124 #iâdeà
__BOUNDED_POINTERS__


125 
	#__bounded


	)

126 
	#__unbounded


	)

127 
	#__±rv®ue


	)

132 
	#__bos
(
±r
è
	`__butš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
è
	`__butš_objeù_size
 (±r, 0)

	)

135 #ià
__GNUC_PREREQ
 (4,3)

136 
	#__w¬ndeş
(
Çme
, 
msg
) \

137 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

138 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

139 
	#__”rÜdeş
(
Çme
, 
msg
) \

140 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

142 
	#__w¬ndeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

143 
	#__w¬Ç‰r
(
msg
)

	)

144 
	#__”rÜdeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

148 #ià
__GNUC_PREREQ
 (2,97)

150 
	#__æex¬r
 []

	)

152 #ifdeà
__GNUC__


153 
	#__æex¬r
 [0]

	)

155 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

156 
	#__æex¬r
 []

	)

159 
	#__æex¬r
 [1]

	)

175 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

177 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

178 #ifdeà
__ılu¥lus


179 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

180 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

182 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

183 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

185 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

186 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

199 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

200 
	#__©Œibu‹__
(
xyz
è

	)

206 #ià
__GNUC_PREREQ
 (2,96)

207 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

209 
	#__©Œibu‹_m®loc__


	)

215 #ià
__GNUC_PREREQ
 (2,96)

216 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

218 
	#__©Œibu‹_pu»__


	)

224 #ià
__GNUC_PREREQ
 (3,1)

225 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

226 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

228 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

229 
	#__©Œibu‹_nošlše__


	)

233 #ià
__GNUC_PREREQ
 (3,2)

234 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

236 
	#__©Œibu‹_d•»ÿ‹d__


	)

245 #ià
__GNUC_PREREQ
 (2,8)

246 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

248 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

255 #ià
__GNUC_PREREQ
 (2,97)

256 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

257 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

259 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

264 #ià
__GNUC_PREREQ
 (3,3)

265 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

267 
	#__nÚnuÎ
(
·¿ms
)

	)

272 #ià
__GNUC_PREREQ
 (3,4)

273 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

274 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

275 #ià
__USE_FORTIFY_LEVEL
 > 0

276 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

279 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

281 #iâdeà
__wur


282 
	#__wur


	)

286 #ià
__GNUC_PREREQ
 (3,2)

287 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

289 
	#__®ways_šlše
 
__šlše


	)

294 #ià!
defšed
 
__ılu¥lus
 || 
__GNUC_PREREQ
 (4,3)

295 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__ılu¥lus


296 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

297 #ià
__GNUC_PREREQ
 (4,3)

298 
	#__ex‹º_®ways_šlše
 \

299 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
, 
__¬tificŸl__
))

	)

301 
	#__ex‹º_®ways_šlše
 \

302 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

305 
	#__ex‹º_šlše
 
__šlše


	)

306 #ià
__GNUC_PREREQ
 (4,3)

307 
	#__ex‹º_®ways_šlše
 \

308 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

310 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

317 #ià
__GNUC_PREREQ
 (4,3)

318 
	#__va_¬g_·ck
(è
	`__butš_va_¬g_·ck
 ()

	)

319 
	#__va_¬g_·ck_Ën
(è
	`__butš_va_¬g_·ck_Ën
 ()

	)

326 #ià!
__GNUC_PREREQ
 (2,8)

327 
	#__ex‹nsiÚ__


	)

331 #ià!
__GNUC_PREREQ
 (2,92)

332 
	#__»¡riù


	)

338 #ià
__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


339 
	#__»¡riù_¬r
 
__»¡riù


	)

341 #ifdeà
__GNUC__


342 
	#__»¡riù_¬r


	)

344 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

345 
	#__»¡riù_¬r
 
»¡riù


	)

348 
	#__»¡riù_¬r


	)

353 
	~<b™s/wÜdsize.h
>

355 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


356 
	#__LDBL_COMPAT
 1

	)

357 #ifdeà
__REDIRECT


358 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

359 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

360 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

361 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

362 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

363 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

364 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

365 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

366 
	#__LDBL_REDIR_DECL
(
Çme
) \

367 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

368 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

369 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

370 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

371 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

374 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


375 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

376 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

377 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

378 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

379 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

380 #ifdeà
__REDIRECT


381 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

382 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

383 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

	@/usr/include/xlocale.h

21 #iâdeà
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loÿË_¡ruù


31 
loÿË_d©a
 *
	m__loÿËs
[13];

34 cÚ¡ *
	m__ùy³_b
;

35 cÚ¡ *
	m__ùy³_tŞow”
;

36 cÚ¡ *
	m__ùy³_touµ”
;

39 cÚ¡ *
	m__Çmes
[13];

40 } *
	t__loÿË_t
;

43 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/zlibdefs.h

6 
	~<sys/ty³s.h
>

7 
	~<uni¡d.h
>

8 #ifdeà
VMS


9 
	~<unixio.h
>

11 #iâdeà
z_off_t


12 
	#z_off_t
 
off_t


	)

	@/usr/include/gnu/stubs-32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub___k”Ãl_co¦


	)

11 
	#__¡ub___k”Ãl_sšl


	)

12 
	#__¡ub___k”Ãl_Æ


	)

13 
	#__¡ub_chæags


	)

14 
	#__¡ub_ç‰ach


	)

15 
	#__¡ub_fchæags


	)

16 
	#__¡ub_fd‘ach


	)

17 
	#__¡ub_g‰y


	)

18 
	#__¡ub_lchmod


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ç‰ach


	)

13 
	#__¡ub_fchæags


	)

14 
	#__¡ub_fd‘ach


	)

15 
	#__¡ub_g‘msg


	)

16 
	#__¡ub_g‰y


	)

17 
	#__¡ub_lchmod


	)

18 
	#__¡ub_putmsg


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@
1
.
1
/usr/include
346
10924
abstract_mem.cc
abstract_mem.hh
addr_mapper.cc
addr_mapper.hh
bridge.cc
bridge.hh
bus.cc
bus.hh
cache/base.cc
cache/base.hh
cache/blk.cc
cache/blk.hh
cache/cache.cc
cache/cache.hh
cache/cache_impl.hh
cache/mshr.cc
cache/mshr.hh
cache/mshr_queue.cc
cache/mshr_queue.hh
cache/prefetch/base.cc
cache/prefetch/base.hh
cache/prefetch/ghb.cc
cache/prefetch/ghb.hh
cache/prefetch/stride.cc
cache/prefetch/stride.hh
cache/prefetch/tagged.cc
cache/prefetch/tagged.hh
cache/tags/base.cc
cache/tags/base.hh
cache/tags/cacheset.hh
cache/tags/fa_lru.cc
cache/tags/fa_lru.hh
cache/tags/lru.cc
cache/tags/lru.hh
coherent_bus.cc
coherent_bus.hh
comm_monitor.cc
comm_monitor.hh
fs_translating_port_proxy.cc
fs_translating_port_proxy.hh
mem_object.cc
mem_object.hh
mport.cc
mport.hh
noncoherent_bus.cc
noncoherent_bus.hh
packet.cc
packet.hh
packet_access.hh
packet_queue.cc
packet_queue.hh
page_table.cc
page_table.hh
physical.cc
physical.hh
port.cc
port.hh
port_proxy.cc
port_proxy.hh
qport.hh
request.hh
ruby/buffers/MessageBuffer.cc
ruby/buffers/MessageBuffer.hh
ruby/buffers/MessageBufferNode.cc
ruby/buffers/MessageBufferNode.hh
ruby/common/Address.cc
ruby/common/Address.hh
ruby/common/Consumer.cc
ruby/common/Consumer.hh
ruby/common/DataBlock.cc
ruby/common/DataBlock.hh
ruby/common/Global.cc
ruby/common/Global.hh
ruby/common/Histogram.cc
ruby/common/Histogram.hh
ruby/common/NetDest.cc
ruby/common/NetDest.hh
ruby/common/Set.cc
ruby/common/Set.hh
ruby/common/SubBlock.cc
ruby/common/SubBlock.hh
ruby/common/TypeDefines.hh
ruby/filters/AbstractBloomFilter.hh
ruby/filters/BlockBloomFilter.cc
ruby/filters/BlockBloomFilter.hh
ruby/filters/BulkBloomFilter.cc
ruby/filters/BulkBloomFilter.hh
ruby/filters/GenericBloomFilter.cc
ruby/filters/GenericBloomFilter.hh
ruby/filters/H3BloomFilter.cc
ruby/filters/H3BloomFilter.hh
ruby/filters/LSB_CountingBloomFilter.cc
ruby/filters/LSB_CountingBloomFilter.hh
ruby/filters/MultiBitSelBloomFilter.cc
ruby/filters/MultiBitSelBloomFilter.hh
ruby/filters/MultiGrainBloomFilter.cc
ruby/filters/MultiGrainBloomFilter.hh
ruby/filters/NonCountingBloomFilter.cc
ruby/filters/NonCountingBloomFilter.hh
ruby/network/BasicLink.cc
ruby/network/BasicLink.hh
ruby/network/BasicRouter.cc
ruby/network/BasicRouter.hh
ruby/network/Network.cc
ruby/network/Network.hh
ruby/network/Topology.cc
ruby/network/Topology.hh
ruby/network/fault_model/FaultModel.cc
ruby/network/fault_model/FaultModel.hh
ruby/network/garnet/BaseGarnetNetwork.cc
ruby/network/garnet/BaseGarnetNetwork.hh
ruby/network/garnet/NetworkHeader.hh
ruby/network/garnet/fixed-pipeline/CreditLink_d.hh
ruby/network/garnet/fixed-pipeline/GarnetLink_d.cc
ruby/network/garnet/fixed-pipeline/GarnetLink_d.hh
ruby/network/garnet/fixed-pipeline/GarnetNetwork_d.cc
ruby/network/garnet/fixed-pipeline/GarnetNetwork_d.hh
ruby/network/garnet/fixed-pipeline/InputUnit_d.cc
ruby/network/garnet/fixed-pipeline/InputUnit_d.hh
ruby/network/garnet/fixed-pipeline/NetworkInterface_d.cc
ruby/network/garnet/fixed-pipeline/NetworkInterface_d.hh
ruby/network/garnet/fixed-pipeline/NetworkLink_d.cc
ruby/network/garnet/fixed-pipeline/NetworkLink_d.hh
ruby/network/garnet/fixed-pipeline/OutVcState_d.cc
ruby/network/garnet/fixed-pipeline/OutVcState_d.hh
ruby/network/garnet/fixed-pipeline/OutputUnit_d.cc
ruby/network/garnet/fixed-pipeline/OutputUnit_d.hh
ruby/network/garnet/fixed-pipeline/Router_d.cc
ruby/network/garnet/fixed-pipeline/Router_d.hh
ruby/network/garnet/fixed-pipeline/RoutingUnit_d.cc
ruby/network/garnet/fixed-pipeline/RoutingUnit_d.hh
ruby/network/garnet/fixed-pipeline/SWallocator_d.cc
ruby/network/garnet/fixed-pipeline/SWallocator_d.hh
ruby/network/garnet/fixed-pipeline/Switch_d.cc
ruby/network/garnet/fixed-pipeline/Switch_d.hh
ruby/network/garnet/fixed-pipeline/VCallocator_d.cc
ruby/network/garnet/fixed-pipeline/VCallocator_d.hh
ruby/network/garnet/fixed-pipeline/VirtualChannel_d.cc
ruby/network/garnet/fixed-pipeline/VirtualChannel_d.hh
ruby/network/garnet/fixed-pipeline/flitBuffer_d.cc
ruby/network/garnet/fixed-pipeline/flitBuffer_d.hh
ruby/network/garnet/fixed-pipeline/flit_d.cc
ruby/network/garnet/fixed-pipeline/flit_d.hh
ruby/network/garnet/flexible-pipeline/FlexibleConsumer.hh
ruby/network/garnet/flexible-pipeline/GarnetLink.cc
ruby/network/garnet/flexible-pipeline/GarnetLink.hh
ruby/network/garnet/flexible-pipeline/GarnetNetwork.cc
ruby/network/garnet/flexible-pipeline/GarnetNetwork.hh
ruby/network/garnet/flexible-pipeline/InVcState.cc
ruby/network/garnet/flexible-pipeline/InVcState.hh
ruby/network/garnet/flexible-pipeline/NetworkInterface.cc
ruby/network/garnet/flexible-pipeline/NetworkInterface.hh
ruby/network/garnet/flexible-pipeline/NetworkLink.cc
ruby/network/garnet/flexible-pipeline/NetworkLink.hh
ruby/network/garnet/flexible-pipeline/OutVcState.cc
ruby/network/garnet/flexible-pipeline/OutVcState.hh
ruby/network/garnet/flexible-pipeline/Router.cc
ruby/network/garnet/flexible-pipeline/Router.hh
ruby/network/garnet/flexible-pipeline/VCarbiter.cc
ruby/network/garnet/flexible-pipeline/VCarbiter.hh
ruby/network/garnet/flexible-pipeline/flit.cc
ruby/network/garnet/flexible-pipeline/flit.hh
ruby/network/garnet/flexible-pipeline/flitBuffer.cc
ruby/network/garnet/flexible-pipeline/flitBuffer.hh
ruby/network/orion/Allocator/Arbiter.cc
ruby/network/orion/Allocator/Arbiter.hh
ruby/network/orion/Allocator/MatrixArbiter.cc
ruby/network/orion/Allocator/MatrixArbiter.hh
ruby/network/orion/Allocator/RRArbiter.cc
ruby/network/orion/Allocator/RRArbiter.hh
ruby/network/orion/Allocator/SWAllocator.cc
ruby/network/orion/Allocator/SWAllocator.hh
ruby/network/orion/Allocator/VCAllocator.cc
ruby/network/orion/Allocator/VCAllocator.hh
ruby/network/orion/Buffer/AmpUnit.cc
ruby/network/orion/Buffer/AmpUnit.hh
ruby/network/orion/Buffer/BitlineUnit.cc
ruby/network/orion/Buffer/BitlineUnit.hh
ruby/network/orion/Buffer/Buffer.cc
ruby/network/orion/Buffer/Buffer.hh
ruby/network/orion/Buffer/DecoderUnit.cc
ruby/network/orion/Buffer/DecoderUnit.hh
ruby/network/orion/Buffer/MemUnit.cc
ruby/network/orion/Buffer/MemUnit.hh
ruby/network/orion/Buffer/OutdrvUnit.cc
ruby/network/orion/Buffer/OutdrvUnit.hh
ruby/network/orion/Buffer/PrechargeUnit.cc
ruby/network/orion/Buffer/PrechargeUnit.hh
ruby/network/orion/Buffer/Register.cc
ruby/network/orion/Buffer/Register.hh
ruby/network/orion/Buffer/SRAM.cc
ruby/network/orion/Buffer/SRAM.hh
ruby/network/orion/Buffer/WordlineUnit.cc
ruby/network/orion/Buffer/WordlineUnit.hh
ruby/network/orion/Clock.cc
ruby/network/orion/Clock.hh
ruby/network/orion/ConfigFile.cc
ruby/network/orion/ConfigFile.hh
ruby/network/orion/Crossbar/Crossbar.cc
ruby/network/orion/Crossbar/Crossbar.hh
ruby/network/orion/Crossbar/MatrixCrossbar.cc
ruby/network/orion/Crossbar/MatrixCrossbar.hh
ruby/network/orion/Crossbar/MultreeCrossbar.cc
ruby/network/orion/Crossbar/MultreeCrossbar.hh
ruby/network/orion/FlipFlop.cc
ruby/network/orion/FlipFlop.hh
ruby/network/orion/NetworkPower.cc
ruby/network/orion/NetworkPower.hh
ruby/network/orion/OrionConfig.cc
ruby/network/orion/OrionConfig.hh
ruby/network/orion/OrionLink.cc
ruby/network/orion/OrionLink.hh
ruby/network/orion/OrionRouter.cc
ruby/network/orion/OrionRouter.hh
ruby/network/orion/TechParameter.cc
ruby/network/orion/TechParameter.hh
ruby/network/orion/Type.hh
ruby/network/orion/Wire.cc
ruby/network/orion/Wire.hh
ruby/network/orion/orion.hh
ruby/network/simple/PerfectSwitch.cc
ruby/network/simple/PerfectSwitch.hh
ruby/network/simple/SimpleLink.cc
ruby/network/simple/SimpleLink.hh
ruby/network/simple/SimpleNetwork.cc
ruby/network/simple/SimpleNetwork.hh
ruby/network/simple/Switch.cc
ruby/network/simple/Switch.hh
ruby/network/simple/Throttle.cc
ruby/network/simple/Throttle.hh
ruby/profiler/AccessTraceForAddress.cc
ruby/profiler/AccessTraceForAddress.hh
ruby/profiler/AddressProfiler.cc
ruby/profiler/AddressProfiler.hh
ruby/profiler/MemCntrlProfiler.cc
ruby/profiler/MemCntrlProfiler.hh
ruby/profiler/Profiler.cc
ruby/profiler/Profiler.hh
ruby/profiler/StoreTrace.cc
ruby/profiler/StoreTrace.hh
ruby/recorder/CacheRecorder.cc
ruby/recorder/CacheRecorder.hh
ruby/slicc_interface/AbstractCacheEntry.cc
ruby/slicc_interface/AbstractCacheEntry.hh
ruby/slicc_interface/AbstractController.cc
ruby/slicc_interface/AbstractController.hh
ruby/slicc_interface/AbstractEntry.cc
ruby/slicc_interface/AbstractEntry.hh
ruby/slicc_interface/AbstractProtocol.hh
ruby/slicc_interface/Message.hh
ruby/slicc_interface/NetworkMessage.hh
ruby/slicc_interface/RubyRequest.cc
ruby/slicc_interface/RubyRequest.hh
ruby/slicc_interface/RubySlicc_ComponentMapping.hh
ruby/slicc_interface/RubySlicc_Util.hh
ruby/slicc_interface/RubySlicc_includes.hh
ruby/structures/Prefetcher.cc
ruby/structures/Prefetcher.hh
ruby/system/AbstractReplacementPolicy.hh
ruby/system/BankedArray.cc
ruby/system/BankedArray.hh
ruby/system/CacheMemory.cc
ruby/system/CacheMemory.hh
ruby/system/DMASequencer.cc
ruby/system/DMASequencer.hh
ruby/system/DirectoryMemory.cc
ruby/system/DirectoryMemory.hh
ruby/system/LRUPolicy.hh
ruby/system/MachineID.hh
ruby/system/MemoryControl.cc
ruby/system/MemoryControl.hh
ruby/system/MemoryNode.cc
ruby/system/MemoryNode.hh
ruby/system/MemoryVector.hh
ruby/system/PerfectCacheMemory.hh
ruby/system/PersistentTable.cc
ruby/system/PersistentTable.hh
ruby/system/PseudoLRUPolicy.hh
ruby/system/RubyMemoryControl.cc
ruby/system/RubyMemoryControl.hh
ruby/system/RubyPort.cc
ruby/system/RubyPort.hh
ruby/system/RubyPortProxy.cc
ruby/system/RubyPortProxy.hh
ruby/system/Sequencer.cc
ruby/system/Sequencer.hh
ruby/system/SparseMemory.cc
ruby/system/SparseMemory.hh
ruby/system/System.cc
ruby/system/System.hh
ruby/system/TBETable.hh
ruby/system/TimerTable.cc
ruby/system/TimerTable.hh
ruby/system/WireBuffer.cc
ruby/system/WireBuffer.hh
se_translating_port_proxy.cc
se_translating_port_proxy.hh
simple_dram.cc
simple_dram.hh
simple_mem.cc
simple_mem.hh
tport.cc
tport.hh
/usr/include/fcntl.h
/usr/include/inttypes.h
/usr/include/sys/mman.h
/usr/include/sys/types.h
/usr/include/sys/user.h
/usr/include/unistd.h
/usr/include/zlib.h
/usr/include/bits/confname.h
/usr/include/bits/environments.h
/usr/include/bits/fcntl.h
/usr/include/bits/fcntl2.h
/usr/include/bits/mman.h
/usr/include/bits/posix_opt.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/types.h
/usr/include/bits/unistd.h
/usr/include/bits/wordsize.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/stdint.h
/usr/include/sys/select.h
/usr/include/sys/stat.h
/usr/include/sys/sysmacros.h
/usr/include/time.h
/usr/include/zconf.h
/usr/include/bits/byteswap.h
/usr/include/bits/endian.h
/usr/include/bits/predefs.h
/usr/include/bits/select.h
/usr/include/bits/sigset.h
/usr/include/bits/stat.h
/usr/include/bits/time.h
/usr/include/bits/typesizes.h
/usr/include/bits/uio.h
/usr/include/bits/wchar.h
/usr/include/ctype.h
/usr/include/gnu/stubs.h
/usr/include/sys/cdefs.h
/usr/include/xlocale.h
/usr/include/zlibdefs.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
